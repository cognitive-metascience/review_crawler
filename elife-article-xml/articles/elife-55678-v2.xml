<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">55678</article-id><article-id pub-id-type="doi">10.7554/eLife.55678</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group><subj-group subj-group-type="heading"><subject>Physics of Living Systems</subject></subj-group></article-categories><title-group><article-title>Quantitative modeling of the effect of antigen dosage on B-cell affinity distributions in maturating germinal centers</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-175040"><name><surname>Molari</surname><given-names>Marco</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8838-4093</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-175042"><name><surname>Eyer</surname><given-names>Klaus</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-175041"><name><surname>Baudry</surname><given-names>Jean</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-116451"><name><surname>Cocco</surname><given-names>Simona</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-1852-7789</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-37041"><name><surname>Monasson</surname><given-names>Rémi</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-4459-0204</contrib-id><email>monasson@lpt.ens.fr</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>Laboratoire de Physique de l’École Normale Supérieure, ENS, PSL University, CNRS UMR8023, Sorbonne Université, Université Paris-Diderot, Sorbonne Paris Cité</institution><addr-line><named-content content-type="city">Paris</named-content></addr-line><country>France</country></aff><aff id="aff2"><label>2</label><institution>Laboratory for Functional Immune Repertoire Analysis, Institute of Pharmaceutical Sciences, ETH Zurich</institution><addr-line><named-content content-type="city">Zurich</named-content></addr-line><country>Switzerland</country></aff><aff id="aff3"><label>3</label><institution>Laboratoire Colloides et Materiaux Divises (LCMD), Chemistry, Biology and Innovation (CBI), ESPCI, PSL Research and CNRS</institution><addr-line><named-content content-type="city">Paris</named-content></addr-line><country>France</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Nourmohammad</surname><given-names>Armita</given-names></name><role>Reviewing Editor</role><aff><institution>University of Washington</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Barkai</surname><given-names>Naama</given-names></name><role>Senior Editor</role><aff><institution>Weizmann Institute of Science</institution><country>Israel</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>15</day><month>06</month><year>2020</year></pub-date><pub-date pub-type="collection"><year>2020</year></pub-date><volume>9</volume><elocation-id>e55678</elocation-id><history><date date-type="received" iso-8601-date="2020-02-02"><day>02</day><month>02</month><year>2020</year></date><date date-type="accepted" iso-8601-date="2020-06-12"><day>12</day><month>06</month><year>2020</year></date></history><permissions><copyright-statement>© 2020, Molari et al</copyright-statement><copyright-year>2020</copyright-year><copyright-holder>Molari et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-55678-v2.pdf"/><abstract><p>Affinity maturation is a complex dynamical process allowing the immune system to generate antibodies capable of recognizing antigens. We introduce a model for the evolution of the distribution of affinities across the antibody population in germinal centers. The model is amenable to detailed mathematical analysis and gives insight on the mechanisms through which antigen availability controls the rate of maturation and the expansion of the antibody population. It is also capable, upon maximum-likelihood inference of the parameters, to reproduce accurately the distributions of affinities of IgG-secreting cells we measure in mice immunized against Tetanus Toxoid under largely varying conditions (antigen dosage, delay between injections). Both model and experiments show that the average population affinity depends non-monotonically on the antigen dosage. We show that combining quantitative modeling and statistical inference is a concrete way to investigate biological processes underlying affinity maturation (such as selection permissiveness), hardly accessible through measurements.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>affinity maturation</kwd><kwd>B-cell</kwd><kwd>antigen dosage</kwd><kwd>statistical inference</kwd><kwd>systems modeling</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010663</institution-id><institution>H2020 European Research Council</institution></institution-wrap></funding-source><award-id>80336</award-id><principal-award-recipient><name><surname>Eyer</surname><given-names>Klaus</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR-17-CE30-0021 RBMPro</award-id><principal-award-recipient><name><surname>Monasson</surname><given-names>Rémi</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR-10-LABX-31</award-id><principal-award-recipient><name><surname>Baudry</surname><given-names>Jean</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR- 10-EQPX-34</award-id><principal-award-recipient><name><surname>Baudry</surname><given-names>Jean</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR-10-IDEX-0001-02 PSL</award-id><principal-award-recipient><name><surname>Baudry</surname><given-names>Jean</given-names></name><name><surname>Cocco</surname><given-names>Simona</given-names></name><name><surname>Monasson</surname><given-names>Rémi</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Detailed and inferred model reproduces B-cell affinity distributions measured in mice immunized according to various protocols and explains non-monotonous effects of antigen dosage on maturation.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Vaccines are undoubtedly one of the most effective preventive procedure ever developed and have even been used to eradicate diseases (<xref ref-type="bibr" rid="bib30">Greenwood, 2014</xref>; <xref ref-type="bibr" rid="bib59">Nanni et al., 2017</xref>). In many cases, vaccine-mediated protection can be directly linked to the generation of an antigen-specific antibody repertoire (<xref ref-type="bibr" rid="bib58">Nakaya et al., 2015</xref>; <xref ref-type="bibr" rid="bib47">Li et al., 2014</xref>), such as for tetanus toxoid (TT) vaccination (<xref ref-type="bibr" rid="bib90">WHO, 2017</xref>; <xref ref-type="bibr" rid="bib21">Ershler et al., 1982</xref>). The repertoire, a term detailing the present antibody variants within an organism, is adapted upon vaccination to include vaccine-specific clones (<xref ref-type="bibr" rid="bib45">Lavinder et al., 2014</xref>; <xref ref-type="bibr" rid="bib46">Lee et al., 2017</xref>). The processes that shape and expand this repertoire upon vaccination are highly complex and dynamic and are strongly linked to affinity maturation (AM) (<xref ref-type="bibr" rid="bib39">Keck et al., 2016</xref>; <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>; <xref ref-type="bibr" rid="bib3">Allen et al., 2007a</xref>). AM entails a series of mechanisms through which the immune system is able to produce potent high-affinity and antigen-specific antibodies (Abs) (<xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>; <xref ref-type="bibr" rid="bib15">De Silva and Klein, 2015</xref>; <xref ref-type="bibr" rid="bib8">Bannard and Cyster, 2017</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib18">Eisen, 2014</xref>; <xref ref-type="bibr" rid="bib83">Victora and Mesin, 2014</xref>). Briefly speaking, AM is achieved through the combination of random mutations and selection for Antigen (Ag) binding. AM takes place in microanatomical structures, known as germinal centers (GCs). GCs are initially seeded by B-lymphocytes from the naive repertoire with sufficient affinity to bind the Ag. This initial affinity is achieved thanks to the great diversity of the immune repertoire, generated by processes such as VDJ recombination (<xref ref-type="bibr" rid="bib20">Elhanati et al., 2015</xref>). B-cells in GCs iteratively migrate through two areas, called the GC light and dark zones (LZ/DZ). In DZ, cells duplicate and are subject to a high mutation rate through a process known as <italic>Somatic Hypermutation</italic> (SHM). Cells then migrate out of DZ to LZ, where they are selected for Ag binding through a process involving interaction with follicular T-helper cells. Selected cells migrate then back to DZ for further duplications. This combination of random mutations and selection for Ag binding constitute a Darwinian evolutionary process, which progressively enhances the affinity of the B-cell population for the Ag.</p><p>In practice, AM is induced through administration of some dose of attenuated Ag, often mixed with adjuvants and other additives that have both immune-stimulatory effect and facilitate retention of Ag for longer periods of time (<xref ref-type="bibr" rid="bib5">Asensio et al., 2019</xref>; <xref ref-type="bibr" rid="bib34">HogenEsch et al., 2018</xref>; <xref ref-type="bibr" rid="bib6">Awate et al., 2013</xref>; <xref ref-type="bibr" rid="bib13">Coffman et al., 2010</xref>). Whilst the adjuvant and additives define the nature of the immune response (<xref ref-type="bibr" rid="bib13">Coffman et al., 2010</xref>), Ag dose is a major variable in AM (<xref ref-type="bibr" rid="bib18">Eisen, 2014</xref>; <xref ref-type="bibr" rid="bib25">Foote and Eisen, 1995</xref>; <xref ref-type="bibr" rid="bib38">Kang et al., 2015</xref>). High-affinity cells are discriminated and selected based on their capacity to bind Ag, and the amount of available Ag therefore tunes the strength of the applied Darwinian selection, that is defining the selection pressure (<xref ref-type="bibr" rid="bib38">Kang et al., 2015</xref>; <xref ref-type="bibr" rid="bib7">Baer et al., 1954</xref>; <xref ref-type="bibr" rid="bib79">Tam et al., 2016</xref>). For example in reference (<xref ref-type="bibr" rid="bib38">Kang et al., 2015</xref>), based on measurements of Abs affinity in rabbit sera following hapten immunization (<xref ref-type="bibr" rid="bib19">Eisen and Siskind, 1964</xref>), the authors observed that average affinity decreased and heterogeneity increased with Ag dosage, suggesting that the latter was controlling the strength of selection: low and high dosages corresponded to, respectively, strong and weak selections (<xref ref-type="bibr" rid="bib29">Goidl et al., 1968</xref>; <xref ref-type="bibr" rid="bib63">Nussenzweig and Benacerraf, 1967</xref>; <xref ref-type="bibr" rid="bib79">Tam et al., 2016</xref>). However, experimental evidence exists suggesting that Ag dosage has also a non-trivial effect on the efficacy of affinity maturation. This selection will be applied in the highly complex and dynamic environment of the immune response and the dose-response curve for some vaccines is not a saturating function of the Ag dose (<xref ref-type="bibr" rid="bib67">Rhodes et al., 2019</xref>). Experiments showed that there was an intermediate range of concentrations for optimal stimulation of the immune system, leading the authors to advocate the development of data-informed models to guide the vaccine dose decision-making process, for example in the cases of tuberculosis, malaria, HIV (<xref ref-type="bibr" rid="bib67">Rhodes et al., 2019</xref>). Models for AM were proposed to investigate this aspect and to help developing protocols in the field of vaccine design. Examples include the study of optimal immunization strategies against highly mutable pathogens such as HIV (<xref ref-type="bibr" rid="bib70">Shaffer et al., 2016</xref>; <xref ref-type="bibr" rid="bib88">Wang, 2017</xref>; <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>) and the influence of Ag administration kinetic on the humoral response (<xref ref-type="bibr" rid="bib79">Tam et al., 2016</xref>); a review of Germinal Center Reaction models and their ingredients can be found in <xref ref-type="bibr" rid="bib11">Buchauer and Wardemann, 2019</xref>.</p><p>A second open issue concerning AM is to characterize in a quantitative way the selection acting in the GC, in particular how <italic>permissive</italic> it is (<xref ref-type="bibr" rid="bib8">Bannard and Cyster, 2017</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib84">Victora and Mouquet, 2018</xref>; <xref ref-type="bibr" rid="bib36">Inoue et al., 2018</xref>). Through mechanisms such as bystander activation (<xref ref-type="bibr" rid="bib10">Bernasconi, 2002</xref>; <xref ref-type="bibr" rid="bib23">Eyer et al., 2020</xref>; <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>) GC selection can indeed allow intermediate- and low-affinity clones to survive (<xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>). These phenomena generate a wider diversity than previously appreciated, especially when considering complex Ags displaying different epitopes (<xref ref-type="bibr" rid="bib43">Kuraoka et al., 2016</xref>). In <xref ref-type="bibr" rid="bib24">Finney et al., 2018</xref> for example the authors try to characterize the GC response to complex Ags such as influenza vaccine, as opposed to simple ones such as haptens. While in the latter case, a strong homogenizing selection and affinity maturation is observed, for complex Ags response is more polyclonal and a consistent part of the GC population (20–30%) is composed of low-affinity clones. This suggests a more permissive nature of the GC selection, in which even low-affinity clones have a non-zero probability of passing the selection. Permissiveness could for example be useful against mutable pathogens, where maintaining a pool of general cross-reactive cells might be a better strategy than only selecting for the best strain-specific binders.</p><p>In this paper, we tackle the question of how the Ag dosage and the time delay between subsequent vaccine injections can influence the quality of immunization, measured as the Ag affinity of the B-cell population that respond to a further antigenic challenge. Thanks to the technique developed in <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref> we were able to access full experimental affinity <italic>distribution</italic> of splenic Ab-secreting cells (Ab-SCs) extracted from mice following TT immunization. These distributions constitute a much more detailed information than other affinity measurement, such as average serum affinity, which only summarize them in a single number that is often related to their average. We introduce a computational model, inspired by previous work (<xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>), that is capable of reproducing these distribution under different immunization schemes, in which both the Ag dosage and the delay between injections can be varied. We aim at studying the mechanisms underlying the observed optimality of Ab affinity at intermediate dosages through detailed mathematical analysis of the model. In addition to this, our aim is to probe how restrictive GC selection is in our particular immunization protocol, and therefore we include in the model some parameters that encode for permissiveness and stochasticity. We use inference techniques to find the most likely value of the parameters given the observed data. This allow us to have information on quantities that are not directly measurable in experiments.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Stochastic model for affinity maturation</title><p>We model the stochastic evolution of the distribution of binding energies of a population of B-cells during the affinity maturation (AM) process. A virtual population of B-cells in the GC is subject to iterative rounds of duplication, mutation and selection, see <xref ref-type="fig" rid="fig1">Figure 1</xref> (<xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>). Each B-cell in our model is characterized by the binding energy <inline-formula><mml:math id="inf1"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> between its receptor and the Ag; <inline-formula><mml:math id="inf2"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> is measured in units of <inline-formula><mml:math id="inf3"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf4"><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:math></inline-formula> is Boltzmann constant and <inline-formula><mml:math id="inf5"><mml:mi>T</mml:mi></mml:math></inline-formula> the organism temperature (This choice of unit is standard in biophysics, and allows one to simply express Boltzmann factors as <inline-formula><mml:math id="inf6"><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>; in practice, <inline-formula><mml:math id="inf7"><mml:mrow><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>1</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mo>≃</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>24</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> kcal). This energy is related to the dissociation constant <inline-formula><mml:math id="inf8"><mml:msub><mml:mi>K</mml:mi><mml:mi>d</mml:mi></mml:msub></mml:math></inline-formula> between the B-cell receptor and the Ag through <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is here expressed in Molar units, other choices of units would shift energies by a constant amount. Hence, lower energies correspond to higher affinities (For example, the dissociation constant <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> 1 μM corresponds to the energy <inline-formula><mml:math id="inf11"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>13.8</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>, and a tenfold decrease in affinity (with <inline-formula><mml:math id="inf12"><mml:msub><mml:mi>K</mml:mi><mml:mi>d</mml:mi></mml:msub></mml:math></inline-formula> varying from 1 μM to 10 μM) corresponds to an increase in binding energy of 2.3). The main objective of our model is to track the evolution of the distribution of binding energies across the B-cell population, <inline-formula><mml:math id="inf13"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, during the GC maturation process. Tracking the full distribution is important for later comparison with experimental data, which themselves consist of affinity distributions. We now describe the main ingredients of the model.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Sketch of the germinal center reaction (inner part) and effects of the main reaction steps on the distribution of the binding energies (<inline-formula><mml:math id="inf14"><mml:mi>ϵ</mml:mi></mml:math></inline-formula>, equivalent to the logarithm of the dissociation constant <inline-formula><mml:math id="inf15"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>d</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) of the B-cell population (histograms on the outer part).</title><p>A red-to-green color-scale is used to depict the affinity of both B-cell receptors in the inner part of the scheme and in the outer binding-energy histograms. Upon Ag administration GCs start to form, seeded by cells from the naive pool having enough affinity to bind the Ag. If the Ag has already been encountered also reactivated memory cells (MC) created during previous GC reactions can take part in the seeding. At the beginning of the evolution round cells duplicate twice in the GC dark zone and, due to somatic hypermutation, have a high probability of developing a mutation affecting their affinity. Most of the mutations have deleterious effects but, rarely, a mutation can improve affinity. As a result the initial population (1) grows in size and decreases its average affinity (2). After duplication cells migrate to the light zone, where they try to bind Ag displayed on the surface of follicular dendritic cells. Failure to bind Ag eventually triggers apoptosis. The probability for a cell to successfully bind the Ag depends both on its affinity for the Ag and on the amount of Ag available. Cells with binding energy higher than a threshold value <inline-formula><mml:math id="inf16"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> are stochastically removed (3). The Ag concentration shifts this threshold by a quantity <inline-formula><mml:math id="inf17"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula>. B-cells able to bind the Ag will then internalize it and display it on MHC-II complexes for T-cells to recognize, and then compete to receive T-cell help. We model this competition by stochastic removal of cells with binding energy above a threshold <inline-formula><mml:math id="inf18"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> that depends on the affinity of the rest of the population (4). As before Ag concentration shifts this threshold. Moreover to account for the finite total amount of T-cell help available we also enforce a finite carrying capacity at this step. Surviving cells may then differentiate into either MC that could seed future GCs or Ab-producing plasma cells (PC). MCs and PCs are collected in the MC/PC populations (5), while the rest of non-differentiated cells will re-enter the dark zone and undergo further cycles of evolution. Eventually Ag depletion will drive the population to extinction.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig1-v2.tif"/></fig><sec id="s2-1-1"><title>Ag dynamics</title><p>In the course of AM, the concentration <inline-formula><mml:math id="inf19"><mml:mi>C</mml:mi></mml:math></inline-formula> of Ag varies over time, due both to gradual release from the adjuvant matrix and to decay and consumption (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). At time of injection Ag molecules are trapped in the adjuvant matrix, which constitutes an Ag reservoir. Ag is then quickly released at a fast rate <inline-formula><mml:math id="inf20"><mml:msup><mml:mi>k</mml:mi><mml:mo>+</mml:mo></mml:msup></mml:math></inline-formula>. Due to recycling of Ag from surface of follicular dendritic cells (FDCs) to endosomal compartments (<xref ref-type="bibr" rid="bib32">Heesters et al., 2013</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>) available Ag decays at a slow rate <inline-formula><mml:math id="inf21"><mml:msubsup><mml:mi>k</mml:mi><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>, and are consumed by B-cells at a faster rate, <inline-formula><mml:math id="inf22"><mml:mrow><mml:mpadded width="+1.7pt"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, proportional to the number <inline-formula><mml:math id="inf23"><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:math></inline-formula> of B-cells. As the amount of Ag is depleted, selection of B-cell is more and more stringent, and the GC eventually dies out.</p><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Effect of different antigen dosages on model evolution.</title><p>(<bold>A</bold>) Schematic representation of the Antigen (Ag) dynamics. Upon injection Ag is added to the reservoir. From there it is gradually released at a rate <inline-formula><mml:math id="inf24"><mml:msup><mml:mi>k</mml:mi><mml:mo>+</mml:mo></mml:msup></mml:math></inline-formula> and becomes available for B-cells to bind. Available Ag is removed through decay at a constant slow rate <inline-formula><mml:math id="inf25"><mml:msubsup><mml:mi>k</mml:mi><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula> and consumption by the B-cells at rate <inline-formula><mml:math id="inf26"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup><mml:mo>⁢</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, proportional to the size of the B-cell population. (<bold>B</bold>) Histogram of the B-cell populations at different times (1,2,4,8,12 weeks after Ag administration) for two simulations of the model at two different values of administered Ag dosage (1 <inline-formula><mml:math id="inf27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> - blue, 10 <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> - orange). Ag Dosage <inline-formula><mml:math id="inf29"><mml:mi>D</mml:mi></mml:math></inline-formula> is converted to Ag concentration <inline-formula><mml:math id="inf30"><mml:mi>C</mml:mi></mml:math></inline-formula> through the inferred proportionality constant <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mi>D</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>23</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. Notice that low dosage entails a faster maturation, albeit having a shorter total duration. (<bold>C</bold>) Evolution of Ag concentration (top), number of B-cells in germinal center (middle) and average binding energy of the population (bottom) for the same two simulations as a function of time from Ag administration. Vertical grey lines corresponds to time points for which the full affinity distribution is displayed in panel (B). (<bold>D</bold>) cumulative final populations of differentiated cells at the end of evolution (memory cells - top, plasma cells - bottom) for the two simulations. Colors encode Ag dosage as in panel B and C. Simulations were performed with variant (<bold>C</bold>) and parameters given in <xref ref-type="table" rid="table1">Table 1</xref>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig2-v2.tif"/></fig></sec><sec id="s2-1-2"><title>GC affinity maturation</title><p>The GC is initialized with <inline-formula><mml:math id="inf32"><mml:msub><mml:mi>N</mml:mi><mml:mtext>found</mml:mtext></mml:msub></mml:math></inline-formula> founder clones from the population of naive responders (<xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>). Their binding energies <inline-formula><mml:math id="inf33"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> are independently drawn from a Gaussian distribution, with mean <inline-formula><mml:math id="inf34"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula> and standard deviation <inline-formula><mml:math id="inf35"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula> (Histogram one in <xref ref-type="fig" rid="fig1">Figure 1</xref>). During the initial phase of colonization and expansion, these founder clones duplicate uniformly (without mutation) to produce a population of <inline-formula><mml:math id="inf36"><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> B-cells. We do not model this initial phase, and start our simulation <inline-formula><mml:math id="inf37"><mml:msub><mml:mi>T</mml:mi><mml:mtext>GC</mml:mtext></mml:msub></mml:math></inline-formula> days after Ag injection, when the GC is mature (<xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>; <xref ref-type="bibr" rid="bib15">De Silva and Klein, 2015</xref>).</p><p>During each evolution round (of duration <inline-formula><mml:math id="inf38"><mml:msub><mml:mi>T</mml:mi><mml:mtext>turn</mml:mtext></mml:msub></mml:math></inline-formula> hours), all cells are assumed to divide twice, independently of their affinity. If the number of cells in the population, <inline-formula><mml:math id="inf39"><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:math></inline-formula>, exceeds some threshold value <inline-formula><mml:math id="inf40"><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:math></inline-formula> during the division process, each cell is removed with probability <inline-formula><mml:math id="inf41"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, so that on average only <inline-formula><mml:math id="inf42"><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:math></inline-formula> cells are left. Imposing a finite carrying capacity to the GC takes into account limitations on its growth, due to the availability of metabolic resources or the finite amount of T-cell help.</p><p>At division B-cells have probability <inline-formula><mml:math id="inf43"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:math></inline-formula> of developing mutations through a process known as <italic>Somatic Hyper-Mutation</italic>. Mutations can be lethal, neutral, or affinity-affecting with probabilities equal to, respectively, <inline-formula><mml:math id="inf44"><mml:msub><mml:mi>p</mml:mi><mml:mtext>l</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf45"><mml:msub><mml:mi>p</mml:mi><mml:mtext>s</mml:mtext></mml:msub></mml:math></inline-formula>, or <inline-formula><mml:math id="inf46"><mml:msub><mml:mi>p</mml:mi><mml:mtext>a</mml:mtext></mml:msub></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib94">Zhang and Shakhnovich, 2010</xref>). In the latter case, the binding energy of the cell is added a random contribution, <inline-formula><mml:math id="inf47"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, drawn from a log-normal distribution <inline-formula><mml:math id="inf48"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib65">Ovchinnikov et al., 2018</xref>), see <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1.A</xref>. Most affinity-affecting mutations are deleterious, that is correspond to <inline-formula><mml:math id="inf49"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> (Histogram 2 in <xref ref-type="fig" rid="fig1">Figure 1</xref>).</p><p>After duplication B-cells are first selected according to their capability to bind Ags exposed on FDCs (<xref ref-type="fig" rid="fig1">Figure 1</xref> top right). The probability for a cell to survive this selection step is a decreasing function of its binding energy <inline-formula><mml:math id="inf50"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> and increases with the concentration <inline-formula><mml:math id="inf51"><mml:mi>C</mml:mi></mml:math></inline-formula> of Ag on FDCs; it is given by<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mpadded width="+5pt"><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mpadded></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf52"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> is a threshold binding energy (<xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1C</xref>). As a consequence, cells with high binding energy (larger than <inline-formula><mml:math id="inf53"><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>) are likely to be removed from the population, compare Histograms 2 and 3 in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p><p>Following internalization, B-cells load the Ag on MHC molecules on their surface (<xref ref-type="bibr" rid="bib62">Nowosad et al., 2016</xref>; <xref ref-type="bibr" rid="bib60">Natkanski et al., 2013</xref>; <xref ref-type="bibr" rid="bib9">Batista and Neuberger, 2000</xref>). By probing these molecules T follicular helper cells provide survival signals to the B-cells with high Ag affinity (<xref ref-type="fig" rid="fig1">Figure 1</xref>, ‘Competition for T-cell help’) (<xref ref-type="bibr" rid="bib4">Allen et al., 2007b</xref>; <xref ref-type="bibr" rid="bib74">Shulman et al., 2014</xref>; <xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>; <xref ref-type="bibr" rid="bib16">Depoil et al., 2005</xref>). The probability that a B-cell with binding energy <inline-formula><mml:math id="inf54"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> survives this second step of selection is<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>T</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>a</mml:mi><mml:mo>-</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo rspace="7.5pt" stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mpadded></mml:mrow></mml:mrow><mml:mo rspace="22.5pt">,</mml:mo><mml:mtext>with</mml:mtext></mml:mrow></mml:mrow><mml:mo mathvariant="italic" separator="true"> </mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mpadded width="+5pt"><mml:msub><mml:mrow><mml:mo stretchy="false">⟨</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:mpadded></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The threshold energy <inline-formula><mml:math id="inf55"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> depends on the current state of the B-cell population in the GC, as a result of the competition amongst these cells for getting the survival signal from T-helper cells, see Histogram four in <xref ref-type="fig" rid="fig1">Figure 1</xref>. Parameter <inline-formula><mml:math id="inf56"><mml:mi>a</mml:mi></mml:math></inline-formula> represents the probability for any B-cells to be selected due to stochastic effects (e.g. bystander activation [<xref ref-type="bibr" rid="bib35">Horns et al., 2019</xref>]) even with very low affinity; it is introduced to reproduce the observation that selection in GCs is permissive in the presence of complex Ags such as the ones found in vaccines (<xref ref-type="bibr" rid="bib24">Finney et al., 2018</xref>). Parameter <inline-formula><mml:math id="inf57"><mml:mi>b</mml:mi></mml:math></inline-formula> instead represents the probability for a B-cell to fail selection at high affinity. The introduction of <inline-formula><mml:math id="inf58"><mml:mi>b</mml:mi></mml:math></inline-formula> comes from the experimental observation that part of the population of apoptotic cells in GCs has high affinity for the antigen (<xref ref-type="bibr" rid="bib49">Mayer et al., 2017</xref>); the removal of these cells could result from stochastic effects (<xref ref-type="bibr" rid="bib44">Lau and Brink, 2020</xref>).</p><p>We will consider three variants of the above selection process: (A) two-step selection described in <xref ref-type="disp-formula" rid="equ1 equ2">Equations 1 and 2</xref>; (B) same two-step selection, but without permissiveness, that is with <inline-formula><mml:math id="inf59"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>; (C) simpler selection process based on competition for T-cell help only, that is <xref ref-type="disp-formula" rid="equ2">Equation 2</xref>, but allowing for permissiveness.</p></sec><sec id="s2-1-3"><title>Differentiation into plasma and memory cells</title><p>Clones that successfully survive selection differentiate with probability <inline-formula><mml:math id="inf60"><mml:msub><mml:mi>p</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:math></inline-formula> in either Ab-producing plasma cells (PCs) or long-lived memory cells (MCs), or start a new evolution cycle with probability <inline-formula><mml:math id="inf61"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>. The probabilities of differentiation into MC and PC, respectively, <inline-formula><mml:math id="inf62"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>MC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf63"><mml:mrow><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>MC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, depend on the time following Ag injection <inline-formula><mml:math id="inf64"><mml:mi>t</mml:mi></mml:math></inline-formula> (early vs. late response) (<xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref>). The MC cell fate is more likely at the beginning of evolution and the PC is more likely towards the end, effectively resulting in a temporal switch occurring around day 11 after injection (<xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref>; <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1B</xref>). The MC and PC populations (Histograms five in <xref ref-type="fig" rid="fig1">Figure 1</xref>) grow at each evolution step, as more and more clones differentiate.</p><p>Administering a recall Ag injection some time after vaccination generates responders Ab-secreting cells (Ab-SCs). These cells comprise both MCs, that can be stimulated to differentiate and produce Abs upon new Ag encounter (<xref ref-type="bibr" rid="bib51">McHeyzer-Williams et al., 2015</xref>; <xref ref-type="bibr" rid="bib17">Dogan et al., 2009</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib36">Inoue et al., 2018</xref>), and residual PCs formed during previous maturations; PCs belonging to the long-lived pool are capable of surviving up to a human lifetime in the absence of division (<xref ref-type="bibr" rid="bib92">Wong and Bhattacharya, 2019</xref>; <xref ref-type="bibr" rid="bib14">Crotty et al., 2003</xref>). The affinity distribution of Ab-SCs is assumed to be a weighted mixture of the MC and PC populations, with fractions equal respectively to <inline-formula><mml:math id="inf65"><mml:mi>g</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf66"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:math></inline-formula>, where the value of <inline-formula><mml:math id="inf67"><mml:mi>g</mml:mi></mml:math></inline-formula> is expected to depend on the conditions under which the system is probed.</p><p>Cells harvested from the spleen originate from multiple GCs. To account for this phenomenon, we carry out several parallel stochastic simulations of GCs (<inline-formula><mml:math id="inf68"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>GCs</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>20</mml:mn></mml:mrow></mml:math></inline-formula>); the GCs are initialized with different populations of founders, and produce different Ab-SC populations. The distribution of affinities, averaged over the GCs, is our outcome and can be compared to experimental results. We choose not to introduce interactions between the evolving GCs, due to the lack of experimental quantification of possible GC-crosstalk.</p></sec><sec id="s2-1-4"><title>GC reinitialization</title><p>When a second Ag injection is performed after the end of the first GC reaction a new GC is initiated. The population of <inline-formula><mml:math id="inf69"><mml:msub><mml:mi>N</mml:mi><mml:mtext>found</mml:mtext></mml:msub></mml:math></inline-formula> founder clones for the new GC is composed of both new GC B-cells with naive precursors having sufficient affinity to bind the Ag, and reactivated MCs accumulated during the past evolution (<xref ref-type="bibr" rid="bib51">McHeyzer-Williams et al., 2015</xref>; <xref ref-type="bibr" rid="bib17">Dogan et al., 2009</xref>; <xref ref-type="bibr" rid="bib36">Inoue et al., 2018</xref>). The probability for a founder cell to be extracted from the MC pool is <inline-formula><mml:math id="inf70"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>/</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf71"><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub></mml:math></inline-formula> is the number of MCs accumulated up to the time of the second injection. This hypothesis reflects the fact that we expect more reactivated MCs to colonize the newly formed GC if more MCs were produced in the previous maturation. However, one could also consider this ratio to be constant (see appendix sect. 6 'Possible model variations').</p><p>If the Ag injection occurs before the end of the first GC reaction, only the MC produced so far are considered to seed the second GC reaction. This initial exchange of MCs is the only interaction between the two GCs, which evolve independently at later times.</p></sec><sec id="s2-1-5"><title>Values of model parameters</title><p>The values of all but nine model parameters listed above were extracted from existing literature, see description in appendix section (Model definition and parameters choice) and table of parameter values in <xref ref-type="table" rid="table1">Table 1</xref>. The remaining nine parameters, which were either not precisely known or strongly dependent on our experimental protocol, were fitted from the experimental data through a Maximum-Likelihood inference procedure for each selection variant (A), (B) or (C); the inference procedure is described in Materials and methods and in appendix sect. 4. These fitted parameters describe: the initial distribution of affinities (<inline-formula><mml:math id="inf72"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf73"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>), the Ag-binding selection threshold (<inline-formula><mml:math id="inf74"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>, not included in variant (C)), the Ag-comsumption rate per B-cell (<inline-formula><mml:math id="inf75"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>), the permissiveness characterizing parameters (<inline-formula><mml:math id="inf76"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf77"><mml:mi>b</mml:mi></mml:math></inline-formula>, not included in variant (B)), the contribution <inline-formula><mml:math id="inf78"><mml:mi>g</mml:mi></mml:math></inline-formula> of MC to Ab-SC population (for the 1- and 4-day protocols in our experiments), and the conversion factor <inline-formula><mml:math id="inf79"><mml:mi>α</mml:mi></mml:math></inline-formula> between vaccine Ag dosage <inline-formula><mml:math id="inf80"><mml:mi>D</mml:mi></mml:math></inline-formula> in units of mass and dimensionless injected concentration <inline-formula><mml:math id="inf81"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mtext>inj</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> (we express <inline-formula><mml:math id="inf82"><mml:mi>α</mml:mi></mml:math></inline-formula> as a mass, which makes concentrations dimensionless).</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>List of parameters in the model and of their values.</title><p>Binding energies are expressed in units of <inline-formula><mml:math id="inf83"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>, and times in days (d) or hours (h). The last nine parameters were inferred within selection variant (C), except <inline-formula><mml:math id="inf84"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>, whose reported value refers to variant (A), which includes Ag-binding selection.</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="4">Values of model parameters</th></tr><tr><th>Symbol</th><th>Value</th><th>Meaning</th><th>Source</th></tr></thead><tbody><tr><td><inline-formula><mml:math id="inf85"><mml:msub><mml:mi>T</mml:mi><mml:mtext>turn</mml:mtext></mml:msub></mml:math></inline-formula></td><td>12 h</td><td>Duration of an evolution turn</td><td><xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref></td></tr><tr><td><inline-formula><mml:math id="inf86"><mml:msub><mml:mi>T</mml:mi><mml:mtext>GC</mml:mtext></mml:msub></mml:math></inline-formula></td><td>6 d</td><td>Time for GC formation after injection</td><td><xref ref-type="bibr" rid="bib15">De Silva and Klein, 2015</xref>; <xref ref-type="bibr" rid="bib37">Jacob et al., 1993</xref>; <xref ref-type="bibr" rid="bib50">McHeyzer-Williams et al., 1993</xref></td></tr><tr><td><inline-formula><mml:math id="inf87"><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:math></inline-formula></td><td>2500</td><td>GC max population size</td><td><xref ref-type="bibr" rid="bib18">Eisen, 2014</xref>; <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref></td></tr><tr><td><inline-formula><mml:math id="inf88"><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula></td><td>2500</td><td>Initial GC population size</td><td><xref ref-type="bibr" rid="bib18">Eisen, 2014</xref>; <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref></td></tr><tr><td><inline-formula><mml:math id="inf89"><mml:msub><mml:mi>N</mml:mi><mml:mtext>found</mml:mtext></mml:msub></mml:math></inline-formula></td><td>100</td><td>Number of GC founder clones</td><td><xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref></td></tr><tr><td><inline-formula><mml:math id="inf90"><mml:msub><mml:mi>p</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:math></inline-formula></td><td>10%</td><td>Probability of differentiation</td><td><xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>; <xref ref-type="bibr" rid="bib54">Meyer-Hermann et al., 2012</xref>; <xref ref-type="bibr" rid="bib64">Oprea and Perelson, 1997</xref></td></tr><tr><td><inline-formula><mml:math id="inf91"><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:math></inline-formula></td><td>11 d</td><td>Switch time in MC/PC differentiation</td><td><xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref></td></tr><tr><td><inline-formula><mml:math id="inf92"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula></td><td>2 d</td><td>Switching timescale in MC/PC differentiation</td><td><xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref></td></tr><tr><td><inline-formula><mml:math id="inf93"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:math></inline-formula></td><td>14%</td><td>Prob. of mutation per division</td><td><xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>; <xref ref-type="bibr" rid="bib52">McKean et al., 1984</xref>; <xref ref-type="bibr" rid="bib40">Kleinstein et al., 2003</xref></td></tr><tr><td><inline-formula><mml:math id="inf94"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>s</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>l</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>aa</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula></td><td>50%, 30%, 20%</td><td>Probability of a mutation to be silent/lethal/affinity-affecting</td><td><xref ref-type="bibr" rid="bib94">Zhang and Shakhnovich, 2010</xref>; <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>; <xref ref-type="bibr" rid="bib88">Wang, 2017</xref></td></tr><tr><td><inline-formula><mml:math id="inf95"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></td><td><xref ref-type="disp-formula" rid="equ18">Equation 18</xref></td><td>Distribution of affinity-affecting mutations</td><td><xref ref-type="bibr" rid="bib65">Ovchinnikov et al., 2018</xref></td></tr><tr><td><inline-formula><mml:math id="inf96"><mml:msup><mml:mi>k</mml:mi><mml:mo>+</mml:mo></mml:msup></mml:math></inline-formula></td><td>0.98 /d</td><td>Ag release rate</td><td><xref ref-type="bibr" rid="bib48">MacLean et al., 2001</xref></td></tr><tr><td><inline-formula><mml:math id="inf97"><mml:msubsup><mml:mi>k</mml:mi><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula></td><td><inline-formula><mml:math id="inf98"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1.22</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></td><td>Ag decay rate</td><td><xref ref-type="bibr" rid="bib81">Tew and Mandel, 1979</xref></td></tr><tr><td><inline-formula><mml:math id="inf99"><mml:mi>a</mml:mi></mml:math></inline-formula></td><td>0.12</td><td>Baseline selection success probability</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf100"><mml:mi>b</mml:mi></mml:math></inline-formula></td><td>0.66</td><td>Baseline selection failure probability</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf101"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula></td><td>-14.60</td><td>Mean binding energy of seeder clones generated by naive precursors</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf102"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula></td><td>1.66</td><td>Standard deviation of the seeder clones binding energy distribution</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf103"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula></td><td><inline-formula><mml:math id="inf104"><mml:mrow><mml:mrow><mml:mn>2.07</mml:mn><mml:mo>×</mml:mo><mml:mpadded width="+1.7pt"><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mpadded></mml:mrow><mml:mo>/</mml:mo><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:math></inline-formula></td><td>Ag consumption rate per B-cell</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf105"><mml:mi>α</mml:mi></mml:math></inline-formula></td><td><inline-formula><mml:math id="inf106"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>2.3</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></td><td>Concentration to dosage conversion factor</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf107"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula></td><td>0.56</td><td>MC fraction in Ab-SC population for measurement 1 day after boost</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf108"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula></td><td>0</td><td>MC fraction in Ab-SC population for measurement 4 days after second injection</td><td>Max-likelihood fit</td></tr><tr><td><inline-formula><mml:math id="inf109"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula></td><td>-13.59</td><td>Threshold Ag binding energy <inline-formula><mml:math id="inf110"><mml:msup><mml:mi/><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula></td><td>Max-likelihood fit</td></tr></tbody></table></table-wrap></sec></sec><sec id="s2-2"><title>Phenomenology of the stochastic affinity maturation model</title><sec id="s2-2-1"><title>Schematic evolution of the affinity distribution in the course of maturation</title><p>In <xref ref-type="fig" rid="fig2">Figure 2 B, C and D</xref> we report the result of two stochastic simulations of our model on a protocol consisting of a single Ag injection. The simulations differ by the administered Ag dosages <inline-formula><mml:math id="inf111"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (blue) or 10 (orange) <inline-formula><mml:math id="inf112"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The founder clones population is the same in the two simulations in order to eliminate differences coming from variations in the affinities of the initial population. For both concentrations, the main phases in the evolution of the GC can be summarized as follows. After injection and before the start of the GC reaction at day six the amount of available Ag increases due to gradual release from the adjuvant matrix, while consumption exponentially increases. At the beginning of the simulation (day 6) the GC is at maximum capacity and the driving contribution to Ag depletion is consumption by B-cells, which occurs at a rate <inline-formula><mml:math id="inf113"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup><mml:mo>⁢</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mtext>max</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). This consumption continues until Ag concentration reaches a critical value, at which selection pressure becomes strong enough to reduce the population size (despite the duplication step) and eventually drives GCs to extinction (<xref ref-type="fig" rid="fig2">Figure 2C</xref>).</p></sec><sec id="s2-2-2"><title>Maturation induces progressive loss of clonality</title><p>We investigated how the changes in affinity reflect changes in the clonal population in the GC. Recent experiments <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>; <xref ref-type="bibr" rid="bib1">Abbott et al., 2018</xref>; <xref ref-type="bibr" rid="bib43">Kuraoka et al., 2016</xref> have shown that maturation is accompanied by various degrees of homogenizing selection, that is, a reduction of clonality, leading in some cases to strong clonal dominance. We assess the impact of homogenizing selection in our model by keeping trace of the offspring of each founder clone in the stochastic evolution of a single GC for a 4 weeks time-span. The evolution of clonality is reported for two representative simulations in <xref ref-type="fig" rid="fig3">Figure 3A, B</xref>. The plot report the cumulative composition of the population as a function of time; the offspring of each founder clone is represented by a different color, associated to the binding energy of the founder clone, see color scale on the right. In the simulation reported in <xref ref-type="fig" rid="fig3">Figure 3A</xref>, a single clonal family ensued from a high-affinity clone progressively expands, and constitutes around 70% of the total GC population at 4 weeks. In the simulation reported in <xref ref-type="fig" rid="fig3">Figure 3B</xref>, no clone dominates the population, and the GC maintains its polyclonality throughout maturation, with many good affinity clones sharing substantial fractions of the GC.</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Simulated GCs present different levels of homogenization.</title><p>(<bold>A</bold>) Example of homogenizing selection in GC evolution. Population size as a function of time for each clonal family in stochastic simulations of a single GC. The GC were initiated with an injected antigen dosage of <inline-formula><mml:math id="inf114"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. The color of the clonal family reflects the initial binding energy of the founder clone according to the color-scale on the right. On top, we report the fraction of the final population composed by the most expanded clonal family. In this example, the progeny of a single high-affinity founder clone (dark blue) progressively takes over the GC, and at week 4 constitutes around 70% of the GC B-cell population. (<bold>B</bold>) Example of heterogeneous GC evolution. Contrary to the previous example, many clonal families coexist, without one dominant clone taking over the GC. (<bold>C</bold>) Evolution of the distribution of the most-expanded clone fraction. We perform 1000 stochastic simulations and evaluate the fraction of the population constituted by the most-expanded clone at each time (cf colors in the legend). Distributions show the percentage of simulations falling in 10 bins splitting equally the [0,1] interval according to the values of their dominant clone fractions. Notice the presence of heterogeneous and homogeneous GCs at week 4. (<bold>D</bold>) Scatter plot of final (week 4) population fraction versus initial binding energy for the most-expanded clone; the straight line shows the best linear fit (<inline-formula><mml:math id="inf115"><mml:mrow><mml:msup><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>≃</mml:mo><mml:mn>0.49</mml:mn></mml:mrow></mml:math></inline-formula>). The presence of a clone with high initial affinity favors the advent of a homogeneous GC.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig3-v2.tif"/></fig><p>To quantify the evolution of homogenization over time, we estimated the fraction of the population constituted by the most expanded clone at each given time, where 100% would correspond to the GC being completely populated by the offspring of a single founder clone. In <xref ref-type="fig" rid="fig3">Figure 3C</xref>, we plot the distribution of this most-expanded-clone fraction 1000 stochastic simulations at four different time-points (1,2,3,4 weeks after injection). All GCs in our simulations are highly polyclonal at the beginning, with each clone constituting 1% of the initial population. As time goes on, however, more and more GCs feature a dominant clone, sometimes with a very high population fraction. The median of the frequency distribution at week 4 is around 30%, meaning that in half of the simulated GCs a single clonal family makes up for more than 30% of the total B-cell population. Finally, in <xref ref-type="fig" rid="fig3">Figure 3D</xref> we plot, for each simulation, the final (week 4) fraction of the population corresponding to the most-abundant clonal family against its initial binding energy. As expected homogenization correlates with the presence of a high-affinity founder precursor.</p></sec><sec id="s2-2-3"><title>Efficacy of affinity maturation varies non monotonically with Ag dosage</title><p>Inspection of <xref ref-type="disp-formula" rid="equ1 equ2">Equations 1 and 2</xref> shows that the role of Ag concentration in our model is to shift the selection thresholds by <inline-formula><mml:math id="inf116"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula>. This shift has two different consequences. First, its affects the speed of affinity maturation, that is, the decrease in the population average binding energy per round of evolution. The histograms in <xref ref-type="fig" rid="fig2">Figure 2B</xref> (area reflects the size of the population) and the curve for the average binding energy of the population in <xref ref-type="fig" rid="fig2">Figure 2C</xref> show that smaller Ag dosages correspond to faster affinity maturation. Secondly, strong or weak selection resulting from, respectively, small or large concentrations also affects the changes over time in the size of the B-cell population, which in turns impacts the Ag-consumption rates and, therefore, the lifetime of the GC. This can be again visualized by comparing population evolutions on the histograms of <xref ref-type="fig" rid="fig2">Figure 2B</xref> and on the curve of the population size in <xref ref-type="fig" rid="fig2">Figure 2C</xref>.</p><p>These two competing effects concur to shape the final MCs and PCs binding energy distribution (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). Protection against future pathogen encounters will be granted by these cells, and as such their affinity distribution can be used as an indicator to estimate the success and quality of the immunization procedure.</p><p>Because of the double role that Ag concentration plays in controlling the maturation rate and the duration of the GC reaction, in our model the optimal average binding energy of the MC and PC population is achieved at intermediate Ag dosages. Intuitively, this can be explained by observing that, while small Ag dosages cause faster affinity gains, they also result in fast population decrease and short maturation. Therefore in this scenario only a few high-affinity cells will be produced. Conversely, if the dosage is too high then a lot of mediocre or intermediate affinity clones will accumulate, and the high-affinity clones obtained at the end of the evolution process will be in minority. Only intermediate dosages realize a good combination of good maturation speed and population survival. In order to better understand this phenomenon, we can introduce a deterministic version of the model, which is both able to reproduce the average of stochastic simulations and is also amenable to detailed mathematical analysis.</p></sec></sec><sec id="s2-3"><title>Resolution of the model offers insight on effect of ag dosage</title><sec id="s2-3-1"><title>Deterministic evolution reproduces stochastic simulations</title><p>In order to gain insight on the non-monotonic effects of concentration onto affinity maturation, we introduce a deterministic version of the model, which formally becomes exact in the limit of very large sizes <inline-formula><mml:math id="inf117"><mml:mi>N</mml:mi></mml:math></inline-formula>. In practice, when the size of the population is big enough, the distribution of binding energies can be considered as continuous. The evolution of this continuous distribution <inline-formula><mml:math id="inf118"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> over time (number of rounds) <inline-formula><mml:math id="inf119"><mml:mi>t</mml:mi></mml:math></inline-formula> becomes deterministic (Materials and methods); in other words, the stochastic nature of the underlying process disappears in this limit. This introduces a twofold advantage. Firstly, studying deterministic rather than stochastic evolution is a significant simplification, which allows mathematical analysis, see section (Theoretical analysis at fixed concentration) Secondly, numerically evaluating the average outcome of an immunization scheme is computationally much cheaper if done through the deterministic model rather than by averaging many stochastic simulations. This is of paramount importance when using our stochastic fitting procedure, which requires simulating the system for many different values of the parameters.</p><p>As a first check, we compare the predictions of the deterministic solution of the model with the corresponding averages for the stochastic simulations to verify that they are in good agreement. For example in <xref ref-type="fig" rid="app1fig2">Apendix 1—figure 2A-D</xref>, we show the size of the GC B-cell population, and the average binding energies for the GC B-cell, MC and PC populations, averaged over 1000 simulations, which are in very good agreement with their theoretical counterparts. Notice that the model looses accuracy when the population size is too small (cf accuracy of predictions for GC B-cells average binding energies in <xref ref-type="fig" rid="app1fig2">Apendix 1—figure 2C</xref>), as expected. However, these finite-size effects are generally irrelevant, since low-population size states contribute only marginally to the final MCs/PCs distributions we are interested in (cf accuracy of predictions for MCs and PCs average binding energies in <xref ref-type="fig" rid="app1fig2">Apendix 1—figure 2B and D</xref>). The deterministic theory is therefore able to accurately predict the full Ab-SC distributions (see <xref ref-type="fig" rid="app1fig3">Apendix 1—figure 7</xref>, blue distributions correspond to the deterministic solution, and green histograms to the average distribution over 1000 stochastic simulations).</p></sec><sec id="s2-3-2"><title>Theoretical analysis at fixed concentration</title><p>We can gain deep insight on the role of Ag concentration in regulating maturation by studying the theoretical solution of the model in the special case of constant Ag concentration <inline-formula><mml:math id="inf120"><mml:mi>C</mml:mi></mml:math></inline-formula>. To be able to observe asymptotic population expansion, we momentarily relax the maximum population size constraint, and set <inline-formula><mml:math id="inf121"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">∞</mml:mi></mml:mrow></mml:math></inline-formula>. Furthermore, for variants (A) and (B), we consider that the cells in the population have high enough affinity to successfully overcome the first selection step, that is <inline-formula><mml:math id="inf122"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>≪</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>; this assumption is not necessary for variant (C), which does not include Ag-binding selection. The effects of these simplifications will be discussed below.</p><p>In <xref ref-type="fig" rid="fig4">Figure 4A</xref>, we report the evolution of the distribution of binding energies with constant Ag concentration <inline-formula><mml:math id="inf123"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>30</mml:mn></mml:mrow></mml:math></inline-formula> (top right). Notice that the distribution is not normalized to one, but to the number of cells in the population. Color encodes time from the beginning of the GC evolution. We observe that, as the number <inline-formula><mml:math id="inf124"><mml:mi>t</mml:mi></mml:math></inline-formula> of evolution rounds increases, the size of the population increases exponentially with a growth rate <inline-formula><mml:math id="inf125"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> (top left) and the average binding energy shifts linearly, with a speed <inline-formula><mml:math id="inf126"><mml:mi>u</mml:mi></mml:math></inline-formula> (bottom left). The distribution of binding energies therefore evolves as a travelling wave of profile <inline-formula><mml:math id="inf127"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>, with exponentially increasing size:<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mrow><mml:mrow><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>≃</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>ϕ</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>×</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>-</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>u</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo rspace="7.5pt" stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>This behavior can be mathematically established, and the growth rate <inline-formula><mml:math id="inf128"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> and maturation speed <inline-formula><mml:math id="inf129"><mml:mi>u</mml:mi></mml:math></inline-formula> computed by solving an appropriate eigenvalue equation. To do so, we introduce the evolution operator <inline-formula><mml:math id="inf130"><mml:mi mathvariant="bold">𝐄</mml:mi></mml:math></inline-formula> that describes how the distribution of binding energies evolves after each round of maturation. Briefly speaking, <inline-formula><mml:math id="inf131"><mml:mrow><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>ϵ</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the average number of B-cells with energy <inline-formula><mml:math id="inf132"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> produced, through the duplication, selection and mutation steps by an ancestor cell of energy <inline-formula><mml:math id="inf133"><mml:msup><mml:mi>ϵ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math></inline-formula> (Materials and methods); it depends on the Ag concentration <inline-formula><mml:math id="inf134"><mml:mi>C</mml:mi></mml:math></inline-formula> through the selection step, see <xref ref-type="disp-formula" rid="equ2">Equation 2</xref>. The travelling wave behavior for the distribution of binding energies expressed in <xref ref-type="disp-formula" rid="equ3">Equation 3</xref> implies that<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mrow><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup></mml:mpadded><mml:mo>⁢</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo largeop="true" symmetric="true">∫</mml:mo><mml:mrow><mml:mrow><mml:mo>𝑑</mml:mo><mml:mpadded width="+2.8pt"><mml:msup><mml:mi>ϵ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mpadded></mml:mrow><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mi>ϵ</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo rspace="5.3pt" stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>ϵ</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo rspace="7.5pt" stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>This eigenvalue equation can be solved to determine the growth rate <inline-formula><mml:math id="inf135"><mml:mi>ϕ</mml:mi></mml:math></inline-formula>, the wave (maturation) speed <inline-formula><mml:math id="inf136"><mml:mi>u</mml:mi></mml:math></inline-formula>, and the wave profile <inline-formula><mml:math id="inf137"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> as functions of the concentration <inline-formula><mml:math id="inf138"><mml:mi>C</mml:mi></mml:math></inline-formula>. More details on eigenvalue equation <xref ref-type="disp-formula" rid="equ4">Equation 4</xref> and on how it can be numerically solved can be found in Materials and methods Eigenvalue equation and phase diagram and Appendix (Theoretical solution and eigenvalue equation).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Asymptotic evolution at constant Ag concentration.</title><p>(<bold>A</bold>) Analysis of the asymptotic deterministic evolution for the large-size limit of the model, at constant available concentration <inline-formula><mml:math id="inf139"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>30</mml:mn></mml:mrow></mml:math></inline-formula>. Top left: size of the population vs. number of maturation rounds, showing the exponential increase at rate <inline-formula><mml:math id="inf140"><mml:mi>ϕ</mml:mi></mml:math></inline-formula>. Bottom left: average binding energy of the B-cell population, decreasing linearly with speed <inline-formula><mml:math id="inf141"><mml:mi>u</mml:mi></mml:math></inline-formula>. Top right: evolution of the binding energy distribution, normalized to the number of cells in the GC, shows a travelling-wave behavior. Different times are represented with different colors, according to the color-scale on the right. Bottom right: distributions of binding energies, shifted by the time-dependent factor <inline-formula><mml:math id="inf142"><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and rescaled by the exponential factor <inline-formula><mml:math id="inf143"><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Notice the convergence to the invariant distribution <inline-formula><mml:math id="inf144"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>. (<bold>B</bold>) Values of the growth rate <inline-formula><mml:math id="inf145"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> (top) and maturation speed <inline-formula><mml:math id="inf146"><mml:mi>u</mml:mi></mml:math></inline-formula> (bottom) as functions of the Ag concentration <inline-formula><mml:math id="inf147"><mml:mi>C</mml:mi></mml:math></inline-formula>. The points at which the two quantities are zeros define the two critical concentration <inline-formula><mml:math id="inf148"><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> and <inline-formula><mml:math id="inf149"><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> (red and purple vertical dashed lines). They split the asymptotic behavior of the system at constant Ag concentration in three different regimes: extinction for <inline-formula><mml:math id="inf150"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="inf151"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), maturation for <inline-formula><mml:math id="inf152"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="inf153"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf154"><mml:mrow><mml:mi>u</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) and finally stagnation for <inline-formula><mml:math id="inf155"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&gt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="inf156"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> but <inline-formula><mml:math id="inf157"><mml:mrow><mml:mi>u</mml:mi><mml:mo>≳</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). Results were obtained using parameter values reported in <xref ref-type="table" rid="table1">Table 1</xref>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig4-v2.tif"/></fig><p>Results are shown in <xref ref-type="fig" rid="fig4">Figure 4B</xref>. Two special values of the concentration are <inline-formula><mml:math id="inf158"><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>, the concentration at which the growth rate <inline-formula><mml:math id="inf159"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> vanishes, and <inline-formula><mml:math id="inf160"><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, the concentration at which the maturation speed <inline-formula><mml:math id="inf161"><mml:mi>u</mml:mi></mml:math></inline-formula> vanishes. Distinct regimes of maturation are found, depending on the dosage <inline-formula><mml:math id="inf162"><mml:mi>C</mml:mi></mml:math></inline-formula>:</p><list list-type="bullet"><list-item><p>At low Ag concentration <inline-formula><mml:math id="inf163"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, both <inline-formula><mml:math id="inf164"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf165"><mml:mi>u</mml:mi></mml:math></inline-formula> are negative: the strong selection pressure produces high affinity clones and maturation is fast, but the number of cells decreases exponentially, leading to a quick extinction of the population.</p></list-item><list-item><p>At high concentration <inline-formula><mml:math id="inf166"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&gt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, the selection pressure is too weak to compensate the deleterious drift due to mutations, and binding energies increase on average at each round (<inline-formula><mml:math id="inf167"><mml:mrow><mml:mi>u</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). The growth rate <inline-formula><mml:math id="inf168"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> is positive, hence an exponentially increasing number of poor-quality B-cells are produced.</p></list-item><list-item><p>In the intermediate range of concentration, <inline-formula><mml:math id="inf169"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, we have both population expansion (positive growth rate <inline-formula><mml:math id="inf170"><mml:mi>ϕ</mml:mi></mml:math></inline-formula>) and affinity maturation (negative maturation speed <inline-formula><mml:math id="inf171"><mml:mi>u</mml:mi></mml:math></inline-formula>). The most efficient maturations are obtained for values of <inline-formula><mml:math id="inf172"><mml:mi>C</mml:mi></mml:math></inline-formula> slightly exceeding <inline-formula><mml:math id="inf173"><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>, as <inline-formula><mml:math id="inf174"><mml:mi>u</mml:mi></mml:math></inline-formula> is very close to 0 for values of <inline-formula><mml:math id="inf175"><mml:mi>C</mml:mi></mml:math></inline-formula> tending to <inline-formula><mml:math id="inf176"><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> (<xref ref-type="fig" rid="fig4">Figure 4B</xref>).</p></list-item></list><p>The above analysis provides a detailed picture of the effect of Ag concentration on population growth and maturation, even when realistic constraints are reintroduced. First, if we forbid the population to expand indefinitely and enforce the maximum carrying capacity (<inline-formula><mml:math id="inf177"><mml:msub><mml:mi>N</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:math></inline-formula>) again, the value of <inline-formula><mml:math id="inf178"><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is not modified, since this constraint has no effect on affinity. It also does not influences the regime <inline-formula><mml:math id="inf179"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> in which the population contracts (<inline-formula><mml:math id="inf180"><mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). However, it prevents the population from expanding, thus setting effectively the maximum asymptotic growth rate to <inline-formula><mml:math id="inf181"><mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> if <inline-formula><mml:math id="inf182"><mml:mrow><mml:mi>C</mml:mi><mml:mo>≥</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>. Second, if we reintroduce Ag-binding selection we observe no difference in asymptotic behavior when the population is maturating (<inline-formula><mml:math id="inf183"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf184"><mml:mrow><mml:mi>u</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). However for high concentration <inline-formula><mml:math id="inf185"><mml:mrow><mml:mi>C</mml:mi><mml:mo>&gt;</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> a positive asymptotic velocity is not possible, since in this case the distribution will eventually reach the threshold Ag-binding energy and this selection will prevent further affinity decrease. This limits the maximum asymptotic velocity to 0 and maximum growth rate to <inline-formula><mml:math id="inf186"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Finally, when the Ag concentration is not kept constant but varies during immunization through consumption and decay (<xref ref-type="fig" rid="fig2">Figure 2A</xref>), the maturation behaviors observed during GC evolution (<xref ref-type="fig" rid="fig2">Figure 2B and C</xref>) can be understood depending on whether the value <inline-formula><mml:math id="inf187"><mml:mi>C</mml:mi></mml:math></inline-formula> of the concentration crosses the boundaries <inline-formula><mml:math id="inf188"><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi/><mml:mo>*</mml:mo><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> or <inline-formula><mml:math id="inf189"><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> over time.</p></sec></sec><sec id="s2-4"><title>Model distributions of affinities match experimental measurements in immunized mice</title><sec id="s2-4-1"><title>Probing immunization outcome through single-cell affinity measurements</title><p>We compare our model predictions for the effects of Ag dosage and release schedule to experimental data from mice immunization against TT (Materials and methods). These data consist of single-cell affinity measurements performed on IgG Secreting Cells (IgG-SCs) extracted from mice spleen following immunization. In practice, we immunize mice according to different immunization schemes, described below. Following immunization cells from the spleen are harvested, purified and the affinity of single IgG-SCs is measured according to the protocol developed in <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>. By pooling all the measurements from mice immunized according to the same scheme we are able to obtain a full affinity distribution, such as the ones reported in <xref ref-type="fig" rid="fig5">Figure 5</xref> (orange histograms, for each histogram the number of mice and pooled measurements is indicated). Measurements are limited by experimental sensitivity. In particular, only affinities above the minimum affinity limit of <inline-formula><mml:math id="inf190"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>500</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, that is energies below <inline-formula><mml:math id="inf191"><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>max</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>23.03</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> are measurable. In addition, our measurement technique cannot resolve affinities higher than <inline-formula><mml:math id="inf192"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The range of energies accessible to measurements is represented with the gray shaded area in the histograms of <xref ref-type="fig" rid="fig5">Figure 5</xref>. These distributions give us an affinity snapshot of the Ab-producing cell population; they contain much more information than average quantities, such as the average serum affinity. Our approach allows to probe both tails of the affinity spectrum, and to fully test the effectiveness of the immunization procedure. In our experiments we test three different immunization protocols, schematized in <xref ref-type="fig" rid="fig5">Figure 5</xref> (top row). Scheme 1 consists of two injections of a dose <inline-formula><mml:math id="inf193"><mml:mi>D</mml:mi></mml:math></inline-formula> of Ag, separated by a 4 weeks interval. Cells are harvested 4 days after the second injections. In the first injection, the Ag is mixed with Complete Freund’s Adjuvant (CFA), whilst in the second Incomplete Freund’s Adjuvant (IFA) is used. In this protocol, we tested five different Ag dosages: <inline-formula><mml:math id="inf194"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> and 10 <inline-formula><mml:math id="inf195"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT. Only four of them are reported in <xref ref-type="fig" rid="fig5">Figure 5</xref> but the rest can be found in <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref>. Scheme 2 (see <xref ref-type="fig" rid="fig5">Figure 5</xref> middle column) is identical to scheme one up to the second injection. At this point, after an additional 4 weeks delay, a boost injection of <inline-formula><mml:math id="inf196"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> pure TT is administered and cells are harvested 1 day later. Tested dosages are <inline-formula><mml:math id="inf197"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> and 10 <inline-formula><mml:math id="inf198"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT. Finally, scheme 3 (see <xref ref-type="fig" rid="fig5">Figure 5</xref> right column) is the same as scheme two with a differences. Instead of varying the injected Ag dosage, which is kept constant at <inline-formula><mml:math id="inf199"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT, in this scheme the time delay between the first two injections <inline-formula><mml:math id="inf200"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> is varied. We test four different values for this delay: <inline-formula><mml:math id="inf201"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> = 1, 2, 4 and 8 weeks. These protocols have also been used in <xref ref-type="bibr" rid="bib23">Eyer et al., 2020</xref>, and thanks to the multiple injections they allow us to study the effect of memory recall in subsequent immunizations.</p><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Comparison between model-predicted and experimentally measured affinity distributions of antibody-secreting cells (Ab-SCs) for different immunization protocols.</title><p>A schematic representation of the protocol used is reported on top of each column. Scheme 1 (left column) consists of two injections at the same Ag dosage <inline-formula><mml:math id="inf202"><mml:mi>D</mml:mi></mml:math></inline-formula>, separated by a 4 weeks delay. Cells are harvested 4 days after the second injection. Scheme 2 (middle column) is the same as scheme one until the second injection. Then, after an additional 4 weeks delay, a supplementary boost injection of 1µg pure TT is administered, and cells are harvested one day later. Scheme 3 (right column) is the same as Scheme two but the TT-dosage <inline-formula><mml:math id="inf203"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>⁢</mml:mo><mml:mi>μ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> of the first two injections is kept constant, and instead the delay <inline-formula><mml:math id="inf204"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> between them is varied. Experimental data (orange histograms) consists in measurements of affinities of IgG-secreting cells extracted from mice spleen. The experimental sensitivity range (<inline-formula><mml:math id="inf205"><mml:mrow><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.1</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>nM</mml:mi></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>500</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>nM</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, or equivalently <inline-formula><mml:math id="inf206"><mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>23.03</mml:mn></mml:mrow><mml:mo>≥</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>≥</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>14.51</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>) is delimited by the gray shaded area. Blue curves represent the expected binding energy distribution of the Ab-SCs population according to our theory under the same model conditions. For a good comparison, all the distributions are normalized so that the area under the curve is unitary for the part below the experimental sensitivity threshold. For every histogram, we indicate the number of single cell experimental measurements that make up the experimental distribution (black), the number of different mice from which the measurements were pooled (black), and the value of the varied immunization scheme parameter, corresponding to dosage <inline-formula><mml:math id="inf207"><mml:mi>D</mml:mi></mml:math></inline-formula> (pink) in μg of TT for the first two schemes and time delay <inline-formula><mml:math id="inf208"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> (blue) in days for the third.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig5-v2.tif"/></fig></sec><sec id="s2-4-2"><title>Inference of model parameters and match with full experimental affinity distributions</title><p>We now use the full variety of the data (distributions of affinities obtained with different immunization protocols) to compute and maximize the likelihood of the model as a function of the parameter values. Our objective is two-fold. First, we expect the inferred parameters to provide insights on hardly measurable features of AM, in particular, on the complex steps of selection in our model. Secondly, we show that a single set of parameters is able to accurately reproduce all the experimental measurements corresponding to different situations.</p><p>We have implemented a version of the <italic>Parallel Tempering</italic> algorithm (<xref ref-type="bibr" rid="bib77">Swendsen and Wang, 1986</xref>; <xref ref-type="bibr" rid="bib76">Sugita and Okamoto, 1999</xref>) to perform a stochastic search in parameter space and progressively maximize the likelihood <inline-formula><mml:math id="inf209"><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:math></inline-formula> for the selection variant (A), (B), and (C). For each point in the parameter space, the deterministic model is simulated according to the immunization scheme considered, see <xref ref-type="fig" rid="fig5">Figure 5</xref>. In particular, for scheme one the prediction consists in the simulation of a single GC with variable injected dosage <inline-formula><mml:math id="inf210"><mml:mi>D</mml:mi></mml:math></inline-formula> lasting at most for 4 weeks. Since cells are harvested 4 days after the second injection, we consider the Ab-SCs population to be comprised of a mixture of MC and PC according to the MC fraction <inline-formula><mml:math id="inf211"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, whose value is inferred to be zero (i.e. in this case the Ab-SC population comprises only PCs). For scheme 2 and 3 instead we consider two GC simulations, one per injection. We vary either the injected dosage <inline-formula><mml:math id="inf212"><mml:mi>D</mml:mi></mml:math></inline-formula> or the time between the two injections <inline-formula><mml:math id="inf213"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> according to the protocol in exam. The second GC simulation, initiated 6 days after the second injection, can be seeded by MCs collected during the first GC evolution up to the injection time. Moreover, since cells are harvested 1 day after boost we consider the MC fraction in the Ab-SC population to be <inline-formula><mml:math id="inf214"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>. The affinity distribution of Ab-SCs obtained with the deterministic model is then used to compute the likelihood of the experimentally measured affinities of the IgG-SCs, under all tested immunization schemes. Cells sampled from the spleen can originate from different GCs, but, as long as these GCs have equal defining parameters, their average evolution is the same, and their multiplicity does not affect the inference procedure. See Materials and methods and appendix sect. 4 ('Maximum likelihood fit procedure') for a more detailed description of the procedure. Notice that the inference of many parameters is made possible by the richness of information contained in the experimental affinity distributions.</p><p>As an outcome, we obtain the log-likelihoods of the three variants listed above: <inline-formula><mml:math id="inf215"><mml:mrow><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:msup><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>7400.37</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> for full two-step selection, <inline-formula><mml:math id="inf216"><mml:mrow><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:msup><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>7459.39</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> for non-permissive two-step selection, and <inline-formula><mml:math id="inf217"><mml:mrow><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:msup><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>7400.67</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> for T-cell-based selection (see <xref ref-type="fig" rid="app1fig9">Appendix 1—figure 9</xref> for the inferred parameters value in all cases). A fair comparison between these three hypothesis must however acknowledge that (B) and (C) have, respectively, 2 and 1 less parameter to fit the data than (A). We therefore resort to the so-called Bayesian Information Criterion (BIC), which takes into account the number of parameters by estimating the volume in the parameter space around the peak in likelihood. BIC is defined as <inline-formula><mml:math id="inf218"><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf219"><mml:mi>k</mml:mi></mml:math></inline-formula> is the number of parameters in the model and <inline-formula><mml:math id="inf220"><mml:mi>n</mml:mi></mml:math></inline-formula> is the number of data points available for the inference. We obtain BIC<sup>(A)</sup> = 14877.3, BIC<sup>(B)</sup> = 14978.3, BIC<sup>(C)</sup> = 14869.4. We conclude that the model to be chosen (with lowest BIC) is (C) (Notice that variant (C) is also preferred based on an alternative to BIC, the Akaike Information Criterion, defined through AIC <inline-formula><mml:math id="inf221"><mml:mrow><mml:mi/><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> (AIC<sup>(A)</sup> = 14818.7, AIC<sup>(B)</sup> = 14932.8, AIC<sup>(C)</sup> = 14817.3). Including Ag-binding selection improves slightly the likelihood, but less than expected from the introduction of an extra parameter (<inline-formula><mml:math id="inf222"><mml:msub><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi>A</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>). On the contrary, the large increase in BIC when forbiding permissiveness shows that non-zero values for <inline-formula><mml:math id="inf223"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> are definitely needed to fit the data. Within variant (C) the values of the eight model parameters that maximize the likelihood are (see <xref ref-type="table" rid="table1">Table 1</xref>): <inline-formula><mml:math id="inf224"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>2.07</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf225"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>14.59</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf226"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.66</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf227"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>.12</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf228"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>.66</mml:mn></mml:mrow></mml:math></inline-formula>, as well as <inline-formula><mml:math id="inf229"><mml:mrow><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>56</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> for the values of <inline-formula><mml:math id="inf230"><mml:mi>g</mml:mi></mml:math></inline-formula> corresponding to the measurements of affinities, respectively, 1 day after boost injection (immunization scheme 2 and 3) or 4 days after the second injection (scheme 1), and the dosage-to-concentration conversion factor <inline-formula><mml:math id="inf231"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>23</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> which allows us to convert Ag dosages in units of mass into dimensionless concentrations. In <xref ref-type="fig" rid="fig5">Figure 5</xref> we report for every experimentally measured affinity distribution (orange histograms) the maximum-likelihood corresponding prediction according to the deterministic model evolution (blue curves; for good comparison normalization considers only the area of the curve below the experimental sensitivity threshold). Under all tested immunization schemes, we observe a very good agreement between theory and experiments. See <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref> for the full plot including all experimental conditions.</p></sec><sec id="s2-4-3"><title>Effect of varying Ag dosage and time between injections</title><p>In <xref ref-type="fig" rid="fig6">Figure 6</xref>, we report average measures performed on the affinity distributions for the three different schemes (scheme 1 to 3, left to right) considered. The measurements are the average binding affinity (top) and the high energy fraction (bottom). The latter is defined as the fraction of cells in the population having binding affinity higher than <inline-formula><mml:math id="inf232"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mtext>h-aff</mml:mtext></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>50</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, or equivalently <inline-formula><mml:math id="inf233"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>h-aff</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>16.8</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. In the figure we compare experimental values (orange) with the theoretical prediction of the deterministic model (blue line) and the stochastic simulations (light green shaded area corresponds to the standard deviation over 1000 stochastic simulations). To convey a measure of experimental individual variability, for each immunization scheme we report single-mouse measurements as orange crosses, connected by vertical lines; Orange empty dots represent instead averages over the pooled data. As cells measured from a mouse spleen can originate from different GCs, for example 20 to 50 GCs per spleen section were reported in <xref ref-type="bibr" rid="bib91">Wittenbrink et al., 2011</xref>, we also display in a darker shade of green the standard deviation of the mean of 20 simulations of the stochastic model. This allows us to estimate the expected variations of the binding energy or other quantities due to the existence of multiple GCs. For all the schemes considered, we observe a very good agreement between the stochastic model and theoretical predictions, showing that the infinite size limit is a good approximation to the average stochastic evolution. This agreement also extends to full distributions (compare green histograms and blue curves in <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref>).</p><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Comparison between data and model prediction for the average binding energy (top) and high affinity fraction (bottom) of the Ab-secreting cell population under the three different immunization schemes (scheme 1 - left, scheme 2 - center, scheme 3 - right).</title><p>The high-affinity fraction corresponds to the fraction of measured cells having binding affinity <inline-formula><mml:math id="inf234"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>50</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, or equivalently binding energy <inline-formula><mml:math id="inf235"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>&lt;</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mpadded width="+2.8pt"><mml:mn>16.8</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. On the x axis we report the variable quantity in the scheme, which is administered dosage <inline-formula><mml:math id="inf236"><mml:mi>D</mml:mi></mml:math></inline-formula> for schemes 1 and 2 and delay between injection <inline-formula><mml:math id="inf237"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> for scheme 3. Green shaded areas indicate the results of the stochastic model simulations. The light area covers one standard deviation around the average result for a single simulation, while the dark area corresponds to the standard deviation for the mean over 20 simulations. This quantifies the expected variation for populations of cells extracted from a spleen, that could potentially have been generated by many different GCs. Results are evaluated over 1000 different stochastic simulations per condition tested. The deterministic solution of the model, in blue, reproduces well the average over stochastic simulations in all the considered schemes. Data coming from experimental affinity measurement of IgG-secreting cells extracted from spleen of immunized mice are reported in orange. Orange empty dots represent averages over the data pooled from multiple mice immunized according to the same scheme, while orange crosses represent averages for measurements from a single mice. Crosses are connected with a vertical dashed line in order to convey a measure of individual variability. Notice that the number of mice per scheme considered can vary, see <xref ref-type="fig" rid="fig5">Figure 5</xref> and <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref>). In order to compare these data with our model, both for the stochastic simulations and the theoretical solution we take into account the experimental sensitivity range when evaluating averages.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-fig6-v2.tif"/></fig><p>Most importantly, for all schemes, model and data are in very good agreement. In schemes 1 and 2 in particular both show the existence of an optimal intermediate dosage corresponding to maximal affinity of the Ab-secreting cells recalled population. This experimental observation can now be interpreted with the theoretical analysis introduced in section (Theoretical analysis at fixed concentration).</p><p>In scheme 3, we observe that experimental data show a slight increase in affinity for longer injection delays, and so does our model. This is presumably due to a combination of two effects. Firstly, the fact that higher affinity cells are produced late in the response, and waiting more before harvesting cells allows for higher affinity cells to be created. Secondly, giving the first GC time to produce high-affinity MCs is beneficial since then these cells can then colonize the second GC and continue their maturation even further there.</p></sec></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><sec id="s3-1"><title>Summary and significance</title><p>In this paper, we have investigated the relationship between Ag dosage and quality of immunization outcome. Several studies (<xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>; <xref ref-type="bibr" rid="bib38">Kang et al., 2015</xref>; <xref ref-type="bibr" rid="bib19">Eisen and Siskind, 1964</xref>; <xref ref-type="bibr" rid="bib29">Goidl et al., 1968</xref>; <xref ref-type="bibr" rid="bib63">Nussenzweig and Benacerraf, 1967</xref>) report the fact that better affinity maturation is not always favored by higher doses of Ag, but can instead be enhanced by lower doses. Similarly, the strength of a response to a vaccine, usually measured through the count of responding cells, may show a bell-like curve at intermediate dosages, and understanding the mechanisms underlying this behavior and locating the optimal Ag dose are of crucial importance (<xref ref-type="bibr" rid="bib67">Rhodes et al., 2019</xref>). Our works provide quantitative theoretical and experimental support to these findings. In particular, the stochastic model for affinity maturation we consider here is capable of explaining and accounting for the existence of an intermediate optimal Ag dosage, that results in the highest average affinity of the recalled population. While our model is inspired by previous studies of the evolution of a population of B-cells in a Germinal Center during Affinity Maturation, such as (<xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>, it differs in two substantial ways.</p><p>First, our model is amenable to detailed mathematical analysis. We show that the stochastic evolution of the distribution of binding energies can be accurately approximated by a deterministic dynamics (see <xref ref-type="fig" rid="fig6">Figure 6</xref>), which we resolve exactly. Under constant Ag concentration, the distribution of binding energies behaves as a traveling wave, whose speed and growth rate can be recovered by solving an appropriate eigenvalue <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>. The dependence of these two quantities on Ag concentration reveals the role Ag availability plays in controlling the strength of selection, both in the generated data and models. In particular, high Ag dosage results in low selection pressure and no maturation, and conversely too low Ag dosage in high selection pressure and population extinction. Only intermediate Ag concentration and intermediate selection pressure ensures both population survival and successful AM.</p><p>Second, we show that a single set of parameters of our model is able to reproduce quantitatively the many distributions of single-cell affinities measured on IgG-SC extracted from mice immunized against TT corresponding to multiple protocols largely varying in Ag dosages and delays between injections. To determine the best parameters, we introduce a maximum-likelihood-based inference method. Our inference method fully exploits the results of the experimental technique, developed in <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>, giving access not to the average affinity, as titer measurement would, but to the complete affinity distribution of the recalled Ab-SC population. This population information is crucial for accurate inference of the model parameters and for a meaningful validation of the model. Furthermore, the inferred parameters provide insights on the internal processes of affinity maturation, such as on the role of permissiveness, as discussed later. Inference techniques are powerful instruments in this respect, since they help us investigate experimentally unaccessible features of the system through their indirect but measurable effects. Our inference procedure is very flexible and can readily be applied to new datasets, providing ad-hoc estimates of parameters for different antigens or even different organisms.</p></sec><sec id="s3-2"><title>Maturation as combination of beneficial mutations and selection of high-affinity precursors</title><p>Our stochastic model for affinity maturation is subject to homogenizing selection (<xref ref-type="fig" rid="fig3">Figure 3</xref>), to degrees depending on the presence of a high-affinity precursor (<xref ref-type="fig" rid="fig3">Figure 3D</xref>), in agreement with experimental evidence (<xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>; <xref ref-type="bibr" rid="bib1">Abbott et al., 2018</xref>). In addition, the initial choice of founder clones accounts for a large part of the stochasticity in the maturation outcome (<xref ref-type="fig" rid="app1fig3">Appendix 1—figure 3E to H</xref>), Hence, in our model, selective expansion of high-affinity precursors plays an important role in affinity enhancement. Affinity enhancement is also obtained through the accumulation of beneficial mutations. When observing the distribution of beneficial and deleterious mutations in the MC and PC populations (<xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref>), one finds that, even though on average cells accumulate very few mutations during the AM process, selection tends to favor the fixation of beneficial mutations and the disappearance of deleterious ones.</p></sec><sec id="s3-3"><title>Stochastic effects in fitness waves</title><p>Both the mathematical analysis and the inference procedure are made possible by the fact that our stochastic maturation model is well-approximated by its deterministic counterpart. This is usually not the case when describing the evolution of fitness waves (<xref ref-type="bibr" rid="bib61">Neher and Walczak, 2018</xref>). In many systems, stochastic fluctuations may play a major role, for example when the evolving population passes through a bottleneck, and transiently has very low size, before increasing again. Fluctuations may also be acquire crucial importance when the evolution lasts so long that the leading edge of the fitness wave has time to exponentially amplify and govern the bulk of the population. Here, experimentally measured quantities, such as the distribution of affinities, are the outcome of an average over multiple GC reactions in the spleen. While single simulated GCs show signs of individuality, see homogenizing selection and the evolution of clonality in <xref ref-type="fig" rid="fig3">Figure 3</xref>, the average product of multiple GCs is well-approximated by our deterministic theory. Moreover, stochastic effects are also partially mitigated by the fact that we consider quantities related to the integral over time of the fitness wave evolution, namely, the MC and PC distributions. Hence temporal fluctuations are smoothed out. Another factor contributing to this mitigation is the limited selection we infer. The permissiveness of selection results in a less drastic decrease of the population size, and a reduced sensitivity to fluctuations from the leading edge of the fitness wave.</p></sec><sec id="s3-4"><title>Permissiveness in GC selection</title><p>The role of permissiveness in germinal center selection is still an open question (<xref ref-type="bibr" rid="bib8">Bannard and Cyster, 2017</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib84">Victora and Mouquet, 2018</xref>). Through phenomena such as bystander activation (<xref ref-type="bibr" rid="bib35">Horns et al., 2019</xref>) and stochastic noise, GC selection may also allow intermediate- and low-affinity clones to survive, rather than maturing exclusively via selection of the few best clones (<xref ref-type="bibr" rid="bib44">Lau and Brink, 2020</xref>; <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>). These phenomena generate a wider diversity than previously appreciated, especially when considering complex Ags displaying different epitopes (<xref ref-type="bibr" rid="bib43">Kuraoka et al., 2016</xref>). In <xref ref-type="bibr" rid="bib24">Finney et al., 2018</xref> for example the authors try to characterize the GC response to complex Ags such as influenza vaccine, as opposed to simple ones such as haptens. While in the latter case a strong homogenizing selection and affinity maturation is observed, for complex Ags response is more polyclonal and a consistent part of the GC population (20–30%) is composed of low-affinity clones. This suggests a more permissive nature of the GC selection, in which even low-affinity clones have a non-zero probability of receiving T-cell help.</p><p>To model these effects, we have introduced two parameters, <inline-formula><mml:math id="inf238"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf239"><mml:mi>b</mml:mi></mml:math></inline-formula>, in the competitive selection process involving survival signals from <inline-formula><mml:math id="inf240"><mml:mi>T</mml:mi></mml:math></inline-formula>-helper cells, see <xref ref-type="disp-formula" rid="equ2">Equation 2</xref> and <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1D</xref>. <inline-formula><mml:math id="inf241"><mml:mi>a</mml:mi></mml:math></inline-formula> corresponds to the baseline probability for cells to survive a selection step, while <inline-formula><mml:math id="inf242"><mml:mi>b</mml:mi></mml:math></inline-formula> is equal to the probability for cells to fail selection even if they have high affinity; this could be due for example to the limited availability of T-cell help, which could increase the stochasticity of the selection process (<xref ref-type="bibr" rid="bib42">Krishna and Bachman, 2018</xref>). The role of the parameters <inline-formula><mml:math id="inf243"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf244"><mml:mi>b</mml:mi></mml:math></inline-formula> in controlling the population evolution is studied in section appendix (Permissive and stochastic selection: effect of a, b parameters Our maximum likelihood fit of the data yields <inline-formula><mml:math id="inf245"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0.12</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf246"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0.66</mml:mn></mml:mrow></mml:math></inline-formula>. These values imply that the probability that a high-affinity cell to survive the second step of selection is <inline-formula><mml:math id="inf247"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>34</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, about two and a half times the probability for a low-affinity cell, given by <inline-formula><mml:math id="inf248"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>12</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This observation is in support for the permissive and stochastic nature of selection, at least in our experimental conditions. The non-permissive variant of our model with base-line levels <inline-formula><mml:math id="inf249"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ2">Equation 2</xref>, referred to as variant (B), offers a much worse fit of the data, even when taking into account the smaller number of parameters of this variant (see appendix 'Possible model variations').</p></sec><sec id="s3-5"><title>GCs entry selection does not seem to be restrictive</title><p>Our inference procedure supports the statistical prevalence of variant (C), with T-cell-based selection only, with respect to (A), which included Ag-binding selection. The fact that Ag-binding selection does not seem to be a limiting step for GC colonization, at least in the range of our experimentally measurable affinities, is compatible with experiments performed in <xref ref-type="bibr" rid="bib69">Schwickert et al., 2011</xref>, in which it is shown that in absence of high affinity competitors even clones with low affinity (as low as <inline-formula><mml:math id="inf250"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mn>8</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> or equivalently <inline-formula><mml:math id="inf251"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>∼</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>11.7</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>) can colonize GCs. This is also in accordance with the fact that selection in GCs should be relatively permissive (<xref ref-type="bibr" rid="bib8">Bannard and Cyster, 2017</xref>; <xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>) in order not to limit the diversity of the repertoire. Let us emphasize, however, that the difference in the BIC of the two selection models is rather weak and that our conclusion is contingent on the data set collected and analyzed here.</p></sec><sec id="s3-6"><title>Fractions of PCs and MCs amongst Ab-SCs</title><p>Our experimental setup does not allow us to identify whether the IgG-SCs we observe originate from reactivated MCs or residual PCs generated during previous immunizations. We therefore compared the experimental measurements with a weighted mixture of the MC and PC populations predicted by our model. This mixture, which we call the Ab-SC population, represents the population of cells that respond to antigenic challenge under particular conditions. We introduced the parameters <inline-formula><mml:math id="inf252"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf253"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, corresponding to the fraction of reactivated MCs in the Ab-SC populations when measurement is performed one day after boost or four days after the second injection, and fit their value on the experimental measurements. The result of our inference procedure indicates that, when the system is probed 1 day after pure TT boost, most of the response consists in reactivated memory cells (<inline-formula><mml:math id="inf254"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>56</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>). This is in agreement with experimental observations performed in <xref ref-type="bibr" rid="bib23">Eyer et al., 2020</xref>, in which the frequency of IgG-SCs increased from 0.6 ± 0.1% to 1.6 ± 0.2% one day after the boost, indicating that around 64% of IgG-SCs were not present before the boost. When the measurement is performed 4 days after the second injection then we predict that the vast majority of responders consist of residual PCs (<inline-formula><mml:math id="inf255"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, with a confidence interval extending to 6%, <xref ref-type="fig" rid="app1fig6">Appendix 1—figure 6</xref>). This is consistent with experimental data (unpublished), which indicate that the majority of IgG-SCs are still active 28 days after CFA immunization, and will be secreting at +4 days.</p><p>Concerning the biological difference between the MC and PC populations, it has been observed that MCs show on average less maturation than PCs (<xref ref-type="bibr" rid="bib36">Inoue et al., 2018</xref>; <xref ref-type="bibr" rid="bib71">Shinnakasu et al., 2016</xref>; <xref ref-type="bibr" rid="bib72">Shinnakasu and Kurosaki, 2017</xref>), a feature that is reproduced in our model (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) as a consequence of the temporal switch we introduced (<xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1B</xref>) and might be important in maintaining diversity in the response, especially against highly mutable pathogens, and mitigating original antigenic sin (<xref ref-type="bibr" rid="bib75">Suan et al., 2017</xref>; <xref ref-type="bibr" rid="bib56">Morens et al., 2010</xref>). The results of our inference are in agreement with the fact that experimentally we observe a higher affinity of the responders if measurement is performed 4 days after the last injection (scheme 1) rather than 1 day after boost (schemes 2,3). This difference in affinity could also originate from some form of selection acting on the responder population during the first days of the response, which could selectively expand high-affinity clones in the time between Ag challenge and measurement. Including this selection in the model would result in a different estimate of the fractions <inline-formula><mml:math id="inf256"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf257"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>. However, for simplicity and lack of explicit experimental evidence we did not include this selection in the model.</p></sec><sec id="s3-7"><title>Model limitations and discussion</title><p>In building the model, we chose to only keep the minimal features that could allow us to understand the existence of an optimal dosage and be able to reproduce experimental observations, while still being mathematically tractable. Among the simplifications, the number of duplications per cell is considered independent of the cell affinity. It has been, however, shown that an affinity correlates with GC dark zone dwelling time and number of divisions (<xref ref-type="bibr" rid="bib28">Gitlin et al., 2015</xref>). This phenomenon introduces an effective fitness difference, which is in practice qualitatively accounted for by the selection terms in our model. Moreover, we consider the distribution of affinity-affecting mutations <inline-formula><mml:math id="inf258"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> to be independent of the clone’s affinity, similarly to <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>; <xref ref-type="bibr" rid="bib88">Wang, 2017</xref>; <xref ref-type="bibr" rid="bib94">Zhang and Shakhnovich, 2010</xref>. In reality, independence holds only away from affinity peaks in the Ab sequence space; close to these peaks, affinity-increasing mutations become rare, and it is expected that Ag affinity of clones eventually saturate, while the binding energy can take arbitrarily low values in our model. However, in the regime defined by the values of the parameters inferred on our experimental data, MCs and PCs generated by our stochastic model accumulate on average very few mutations in the course of evolution (appendix, Quantifying beneficial and deleterious mutation events and <xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref>), with the maximum number of beneficial mutations accumulated being compatible with experimental evidence (<xref ref-type="bibr" rid="bib26">Gérard et al., 2020</xref>) ( appendix Quantifying beneficial and deleterious mutation events). <bold>I</bold>n this regime, mutations account for only a part of the maturation, the rest being achieved through selection of high-affinity founder clones ( appendix Quantifying beneficial and deleterious mutation events). This is in line with the limited maturation observed in our experiments. In cases where the saturation effect may become relevant, other approaches to model the effect of affinity-affecting mutations might be more appropriate, for example the introduction of a ‘shape space’ representation (<xref ref-type="bibr" rid="bib70">Shaffer et al., 2016</xref>; <xref ref-type="bibr" rid="bib87">Wang et al., 2016</xref>). The model and results reported here do not include Ab-feedback (<xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>), the phenomenon by which GC B-cells not only have to compete amongst themselves for Ag acquisition but also with Abs produced earlier in maturation (<xref ref-type="bibr" rid="bib8">Bannard and Cyster, 2017</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib93">Zhang et al., 2013</xref>), which could prevent B-cells from internalizing Ag by binding to it. We did not include Ab-feedback in our model, however preliminary investigations (not shown) suggest that it would not affect the existence of an optimal dosage range. GC lifetimes reported in literature vary considerably, from 1 to 2 weeks for soluble protein boosting to several months or longer for certain infections (<xref ref-type="bibr" rid="bib84">Victora and Mouquet, 2018</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>). In alum immunizations GC lifetimes of 3–4 weeks have been observed (<xref ref-type="bibr" rid="bib78">Takahashi et al., 1998</xref>). In our simulations, a long lifetime for GCs is observed and for a high dose of Ag they can have an effective lifetime lasting up to 3 months (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2E</xref>). The concentration of Ag is crucial in determining the strength of selection and the lifetime of the GC in our model. In reality, Ag dosage value also controls the initiation of the GC and AM. In particular, one could expect that for very low dosages the GC reaction would not be initiated at all. For simplicity, we avoid including this phenomenon in our model, and GC reaction takes place in our simulations even at very low Ag dosages, with the result that very few, highly affine MC are produced in this regime. To avoid a discontinuity with respect to the case of null Ag dosage, <inline-formula><mml:math id="inf259"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, in which we expect the measured B-cell population to originate directly from naive precursors, we perform differentiation at the beginning of the simulation round, before mutations and selection (see appendix 'Model definition and parameters choice'). This generates a core of low-affinity MCs keeping the average affinity of the population close to <inline-formula><mml:math id="inf260"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, even when few additional high-affinity MCs are added. However, this might be an unnecessary caution, since when looking at the data we observe that even the lowest tested dosage (<inline-formula><mml:math id="inf261"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT, <xref ref-type="fig" rid="fig5">Figure 5</xref>) shows the hallmark of maturation when compared to the the case of zero dosage (<inline-formula><mml:math id="inf262"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT, <xref ref-type="fig" rid="fig5">Figure 5</xref>). This signals that in the dosage range considered in our experiments we expect maturation to occur. Furthermore, in our model Ag inputs, for example resulting from a new injection, cannot enter a GC while the maturation process is ongoing. Our choice is partly justified by the observation that injecting an Ag bolus when a GC maturation process is in place mostly results in disruption of the ongoing GC reaction (<xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>; <xref ref-type="bibr" rid="bib66">Pulendran et al., 1995</xref>; <xref ref-type="bibr" rid="bib73">Shokat and Goodnow, 1995</xref>; <xref ref-type="bibr" rid="bib31">Han et al., 1995</xref>; <xref ref-type="bibr" rid="bib82">Victora et al., 2010</xref>). We only model a single ‘average’ GC, whose output is assumed to be representative of the outcome of AM. In reality, MC and PC populations are generated by many parallel GC reactions, which could in principle weakly interact via invasion of clones from one GC to another (<xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>; <xref ref-type="bibr" rid="bib84">Victora and Mouquet, 2018</xref>). Last of all, to test the robustness of some of our hypothesis we performed the inference procedure under slightly different conditions. In particuar, we considered the effect of increasing the Ag decay rate, of setting <inline-formula><mml:math id="inf263"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mem</mml:mtext></mml:msub></mml:math></inline-formula> to be a constant and not depend on the number of MCs accumulated during evolution, and also of considering the MC/PC time-switch to be only partial, with a residual production of MCs all along the evolution. We verified that even in these case the model is in good agreement with the data. The results are reported in appendix sect. 6.</p></sec><sec id="s3-8"><title>Outlooks</title><p>As shown above our model for AM is simple enough to be amenable to detailed mathematical analysis and, yet, is able to accurately reproduce the full affinity distributions of Ab-SCs generated during the immunization process. This finding suggests several extensions to the current work. First our model could be used to predict the outcome of more complex immunization protocols than the ones investigated experimentally in this work. In particular, it would be interesting to consider the case of continuous delivery methods (osmotic pumps, repeated injections…) (<xref ref-type="bibr" rid="bib79">Tam et al., 2016</xref>; <xref ref-type="bibr" rid="bib12">Cirelli et al., 2019</xref>), through which the Ag concentration can be precisely controlled over time, and make predictions for the optimal delivery process. Secondly, the quantitative fit of the model parameters was made here possible thanks to the maximum-likelihood algorithm we have introduced, which is flexible and robust. Our inference procedure, whose code is made available with the publication (see Materials and methods code and data availability), could be readily applied to to different measurements, as well as to variants of the present models, with extra parameters corresponding to features of the affinity maturation process that are hardly experimentally accessible, such as selection permissiveness. The combination of quantitative modeling with inference appears as a promising tool to understand the mechanisms governing the immune response and to guide the development of strategies to control and direct it.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Experimental procedure</title><sec id="s4-1-1"><title>Observation chamber assembly</title><p>For the 2D observation chamber, we used glass microscopy slides as top and bottom covers (76 × 26×1 mm, Marienfeld). Two access holes of 1 mm diameter were generated in the top glass slide using laser ablation (C180II, Axys Laser). Afterwards, both slides were thoroughly cleaned using soap, water and ethanol, and the two glass slides were exposed to air plasma (60 W) for 10 min (Femto, Diener Electronics). After plasma treatment, double sided thermos-responsive tape (series 1375, Orafol), beforehand cut into shape using a cutting plotter (CE-6000–40, Graphtec), was stuck onto the glass slides and the chamber sealed. The chamber was heated to 150° C and pressed with 7 bar for 5 min to reduce the height to enable a monolayer of droplets only. Next, two nanoports (N333-01, Idex) were glued to the access holes. Subsequently, the surface of the 2D chamber was treated using fluoro-silane (Aquapel, Aquapel) to render the surface hydrophobic. Lastly, the chamber was dried under nitrogen, and subsequently filled with fluorinated oil (Novec HFE7500, 3M) and sealed until used. The chamber was re-used multiple times, and when properly stored, was used for up to 2 months. Cleaning was performed after each experiment by flushing fluorinated oil to remove droplets, and the chamber was stored filled with HFE7500 until the next use.</p></sec><sec id="s4-1-2"><title>Droplet generator</title><p>Microfluidic PDMS chip for droplet generation were fabricated as previously described (<xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>).</p></sec><sec id="s4-1-3"><title>Aqueous phase I</title><p>Preparation of cells for droplet creation. For droplet generation, cellular suspensions were centrifuged (300 g, 5 min). and washed once in droplet media comprising RPMI w/o phenol red with supplemented 5% KnockOut Serum Replacement (both ThermoFisher), 0.5% recombinant human serum albumin (A9986, Sigma), 25 mM HEPES pH 7.4, 1% Pen/Strep and 0.1% Pluronic F-137 (all ThermoFisher). The cells were re-suspended in droplet media to achieve a <inline-formula><mml:math id="inf264"><mml:mi>λ</mml:mi></mml:math></inline-formula> (mean number of cells per droplet) of 0.2–0.4.</p></sec><sec id="s4-1-4"><title>Aqueous phase II</title><p>Beads and reagents. Paramagnetic nanoparticles were prepared as described before (<xref ref-type="bibr" rid="bib23">Eyer et al., 2020</xref>). Before use, the nanoparticles were re-suspended thoroughly.</p></sec><sec id="s4-1-5"><title>Data acquisition</title><p>Droplets were generated as previously described (<xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>), and the emulsion was directly injected into the 2D observation chamber. After chamber filling was complete, the chamber was gently closed and mounted onto an inverted fluorescence microscope (Ti Eclipse, Nikon). Two neodymium magnets (BZX082, K and J Magnetics) were placed on each side of the chamber during observation to hold the bead lines in place. Excitation light was provided by a LED source (SOLA light engine, Lumencor Inc). Fluorescence for the specific channels were recorded using appropriate band pass filters (GFP and TRITC filter sets, Nikon, and Cy5 filter set, Semrock) and camera settings (Orca Flash 4, Hamamatsu) at room temperature (25° C) and ambient oxygen concentration. Images were acquired using a 10x objective (NA 0.45). An array of 10 × 10 images were acquired for each experiment, every 7.5 min in all channels over 37.5 min (five measurements total).</p></sec><sec id="s4-1-6"><title>Data analysis</title><p>Data was analysed using a custom-made Matlab script (Mathworks). The resulting raw data were exported to Excel (Microsoft), and sorted for droplets that showed an increase in anti-IgG relocation over time above a threshold (<xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>). The selected droplets were controlled visually for the presence of a cell, and the absence of any fluorescent particles, relocation on cells (i.e. dead cells) or droplet movement. The so-selected droplets were analyzed to calculate dissociation constants as described previously (<xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>). The limit of detection of the instrument allows for the resolution of dissociation constants <inline-formula><mml:math id="inf265"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>500</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> (see <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>), therefore measurements with lower affinity were discarded. Moreover, cells with very high affinity <inline-formula><mml:math id="inf266"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0.1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> could be observed, but their affinity could not be determined more precisely (see also <xref ref-type="bibr" rid="bib22">Eyer et al., 2017</xref>) and was set to <inline-formula><mml:math id="inf267"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p></sec></sec><sec id="s4-2"><title>Immunization of mice</title><p>The mice used herein were part of the study as published elsewhere (<xref ref-type="bibr" rid="bib23">Eyer et al., 2020</xref>). In short, BALB-C mice were purchased from Janvier Labs (age 6–8 weeks at start, female) and housed in the animal facilities of Institute Pasteur during experimentation. All immunizations were made intraperitoneal. Each condition was replicated three times in the same cohort (<inline-formula><mml:math id="inf268"><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>); except when explicitly stated otherwise. From each mouse, between 20’−100’000 cells were assayed in an experimental run.</p></sec><sec id="s4-3"><title>Extraction of IgG-SCs</title><p>Spleens were harvested at the indicated time points of the immunization schedule. Spleen cell suspensions were recovered following disassociating using a 40 µm cell strainer. Cellular suspensions were pelleted at 300 g for 5 min, and red blood cell lysis was performed for 1 min using BD Pharm Lyse (BD). Cells were washed twice with MACS buffer and re-suspended in 3 ml of MACS buffer. These cells were further processed according to the manufacturer’s protocol using the Pan B Cell Isolation Kit II (Miltenyi) on a MultiMACS Cell24 Separator Plus (Miltenyi, program depletion). Purity of B-cell lineage was usually above 90% (data not shown).</p></sec><sec id="s4-4"><title>Antigen dynamics</title><p>Ag concentration dynamically changes in parallel with the evolution of the GC. Initially an amount <inline-formula><mml:math id="inf269"><mml:msub><mml:mi>C</mml:mi><mml:mtext>inj</mml:mtext></mml:msub></mml:math></inline-formula> of Ag is administered through injection (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). The value of <inline-formula><mml:math id="inf270"><mml:msub><mml:mi>C</mml:mi><mml:mtext>inj</mml:mtext></mml:msub></mml:math></inline-formula> determines the initial amount of Ag trapped in the adjuvant matrix, setting the initial value of the Ag reservoir concentration (<xref ref-type="disp-formula" rid="equ5">Equation 5</xref>, right). For the sake of comparison with experiments <inline-formula><mml:math id="inf271"><mml:msub><mml:mi>C</mml:mi><mml:mtext>inj</mml:mtext></mml:msub></mml:math></inline-formula> is proportional to the injected Ag dosage <inline-formula><mml:math id="inf272"><mml:mi>D</mml:mi></mml:math></inline-formula> up to a conversion factor <inline-formula><mml:math id="inf273"><mml:mi>α</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf274"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mtext>inj</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, inferred through maximum likelihood fit of the data. The available (<inline-formula><mml:math id="inf275"><mml:msub><mml:mi>C</mml:mi><mml:mtext>av</mml:mtext></mml:msub></mml:math></inline-formula>, appearing in the selection probabilities in <xref ref-type="disp-formula" rid="equ1 equ2">Equations 1 and 2</xref>) and reservoir (<inline-formula><mml:math id="inf276"><mml:msub><mml:mi>C</mml:mi><mml:mtext>res</mml:mtext></mml:msub></mml:math></inline-formula>) concentrations then evolve as described in the main text (<xref ref-type="fig" rid="fig2">Figure 2A</xref>) under the action of release, decay and consumption according to the following equations:<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>inj</mml:mtext></mml:mrow></mml:msub></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>av</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>∅</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>av</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>During GC formation (<inline-formula><mml:math id="inf277"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>GC formation</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>6</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>) the number of B-cells, <inline-formula><mml:math id="inf278"><mml:msubsup><mml:mi>N</mml:mi><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula>, appearing in the rate of Ag consumption increases exponentially up to the maximal size <inline-formula><mml:math id="inf279"><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mi>i</mml:mi><mml:mi>B</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>500</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. More details on the concentration evolution can be found in appendix Model definition and parameters choice.</p></sec><sec id="s4-5"><title>Deterministic evolution</title><p>In the deterministic/infinite size approximation, the stochastic processes that model one round of GC maturation can be written as operators acting on the distribution <inline-formula><mml:math id="inf280"><mml:mi>ρ</mml:mi></mml:math></inline-formula> of binding energies <inline-formula><mml:math id="inf281"><mml:mi>ϵ</mml:mi></mml:math></inline-formula>.</p><list list-type="bullet"><list-item><p>Cell duplication is represented by the amplification operator, consisting in a simple multiplication:</p></list-item></list><p><disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi mathvariant="bold">𝐀</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+2.8pt"><mml:mn>2</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><list list-type="bullet"><list-item><p>Mutations are encoded by convolution of the distribution of energies with a mutation kernel <inline-formula><mml:math id="inf282"><mml:msub><mml:mi>K</mml:mi><mml:mtext>eff</mml:mtext></mml:msub></mml:math></inline-formula> that includes the effect of silent, affinity affecting and lethal mutations (see <xref ref-type="disp-formula" rid="equ26">Equation 26</xref> and appendix sect. 3 'Theoretical solution and eigenvalue equation'):</p></list-item></list><p><disp-formula id="equ8"><label>(8)</label><mml:math id="m8"><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo largeop="true" symmetric="true">∫</mml:mo><mml:mrow><mml:mrow><mml:mo>𝑑</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:mi>ϵ</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mtext>eff</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo rspace="5.3pt" stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>-</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><list list-type="bullet"><list-item><p>Selection for Ag binding (<xref ref-type="disp-formula" rid="equ9">Equation 9</xref>) and T-cell help (<xref ref-type="disp-formula" rid="equ10">Equation 10</xref>) are encoded simply by a product with the respective probabilities (<xref ref-type="disp-formula" rid="equ1 equ2">Equations 1 and 2</xref>), where for the latter the probability depends on <inline-formula><mml:math id="inf283"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> which in turns depends on the distribution of binding energies, making the operator not linear:</p></list-item></list><p><disp-formula id="equ9"><label>(9)</label><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mtext>Ag</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>Ag</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ10"><label>(10)</label><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mtext>T</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>T</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mtext> </mml:mtext><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mtext>with</mml:mtext><mml:mspace width="1em"/><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∫</mml:mo><mml:mi>d</mml:mi><mml:mi>ϵ</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thinmathspace"/><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mo>∫</mml:mo><mml:mi>d</mml:mi><mml:mi>ϵ</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mtext> </mml:mtext><mml:mo>.</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><list list-type="bullet"><list-item><p>Finally, the carrying capacity (<xref ref-type="disp-formula" rid="equ11">Equation 11</xref>) and the differentiation (<xref ref-type="disp-formula" rid="equ12">Equation 12</xref>) processes correspond to multiplications:</p></list-item></list><p><disp-formula id="equ11"><label>(11)</label><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="bold">N</mml:mi></mml:mrow><mml:mspace width="thickmathspace"/><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mo form="prefix" movablelimits="true">min</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mo form="prefix" movablelimits="true">max</mml:mo></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mi>N</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mtext> </mml:mtext><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mtext>with</mml:mtext><mml:mspace width="1em"/><mml:msup><mml:mi>N</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mo>∫</mml:mo><mml:mi>d</mml:mi><mml:mi>ϵ</mml:mi><mml:mspace width="thickmathspace"/><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mtext> </mml:mtext><mml:mo>,</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ12"><label>(12)</label><mml:math id="m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="bold">D</mml:mi></mml:mrow><mml:mspace width="thickmathspace"/><mml:mo stretchy="false">[</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>The distribution of binding energies at round <inline-formula><mml:math id="inf284"><mml:mi>t</mml:mi></mml:math></inline-formula> then evolves through <inline-formula><mml:math id="inf285"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐄</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where the complete operator is <inline-formula><mml:math id="inf286"><mml:mrow><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐃</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐍</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>T</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, we indicate with <inline-formula><mml:math id="inf287"><mml:mrow><mml:mi mathvariant="bold">𝐑</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐀</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐀</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> the operator encoding for two rounds of mutations and amplification. The evolution operator features, in order of application, two rounds of amplification and mutation, Ag-binding selection, T-cell help selection, carrying capacity and differentiation. Notice that for variant (C), there is no Ag-binding selection, and <inline-formula><mml:math id="inf288"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> is replaced with the identity operator.</p></sec><sec id="s4-6"><title>Eigenvalue equation and phase diagram</title><p>The growth rate <inline-formula><mml:math id="inf289"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> and the maturation velocity <inline-formula><mml:math id="inf290"><mml:mi>u</mml:mi></mml:math></inline-formula> shown in <xref ref-type="fig" rid="fig4">Figure 4</xref> are characteristic of the travelling wave nature of the distribution of energies <inline-formula><mml:math id="inf291"><mml:mi>ρ</mml:mi></mml:math></inline-formula> at large ‘times’. When Ag-binding selection is irrelevant (as is the case at large times if <inline-formula><mml:math id="inf292"><mml:mrow><mml:mi>u</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) and the carrying capacity constraint is omitted, the evolution operator simplifies into<disp-formula id="equ13"><label>(13)</label><mml:math id="m13"><mml:mrow><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐃</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐍</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>T</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mrow><mml:mo>→</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐃</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>T</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>In one round of maturation, we expect the travelling distribution <inline-formula><mml:math id="inf293"><mml:mrow><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> to be shifted by <inline-formula><mml:math id="inf294"><mml:mi>u</mml:mi></mml:math></inline-formula> along the energy axis, and to be multiplied by <inline-formula><mml:math id="inf295"><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup></mml:math></inline-formula>. Without loss of generality, we may choose <inline-formula><mml:math id="inf296"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> such that <inline-formula><mml:math id="inf297"><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> ; any other choice would merely consists in a translation of <inline-formula><mml:math id="inf298"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> along the energy axis. Hence, <inline-formula><mml:math id="inf299"><mml:mi mathvariant="bold">𝐄</mml:mi></mml:math></inline-formula> is now a linear operator, and <inline-formula><mml:math id="inf300"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> satisfies the eigenvalue <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>. In other words, the operator <inline-formula><mml:math id="inf301"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>⋅</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf302"><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the shift operator <inline-formula><mml:math id="inf303"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, has for largest eigenvalue <inline-formula><mml:math id="inf304"><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup></mml:math></inline-formula> and associated eigenvector <inline-formula><mml:math id="inf305"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>. As all the entries of <inline-formula><mml:math id="inf306"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>⋅</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi></mml:mrow></mml:math></inline-formula> are positive, the Perron-Frobenius theorem ensures that <inline-formula><mml:math id="inf307"><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup></mml:math></inline-formula> is the top eigenvalue associated to the unique eigenvector <inline-formula><mml:math id="inf308"><mml:msup><mml:mi>ρ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> with all its components positive.</p><p>In practice, given a guess value for <inline-formula><mml:math id="inf309"><mml:mi>u</mml:mi></mml:math></inline-formula>, one can iterate <inline-formula><mml:math id="inf310"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>⋅</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi></mml:mrow></mml:math></inline-formula> a sufficient number of times to determine its top eigenvector <inline-formula><mml:math id="inf311"><mml:mrow><mml:mi>v</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>;</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, and compute <inline-formula><mml:math id="inf312"><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> through<disp-formula id="equ14"><label>(14)</label><mml:math id="m14"><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mpadded width="+5pt"><mml:mfrac><mml:mrow><mml:mo largeop="true" symmetric="true">∫</mml:mo><mml:mrow><mml:mrow><mml:mo>𝑑</mml:mo><mml:mpadded width="+1.7pt"><mml:mi>ϵ</mml:mi></mml:mpadded></mml:mrow><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>v</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>;</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mo largeop="true" symmetric="true">∫</mml:mo><mml:mrow><mml:mrow><mml:mo>𝑑</mml:mo><mml:mpadded width="+1.7pt"><mml:mi>ϵ</mml:mi></mml:mpadded></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>v</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>;</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mpadded></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The value of <inline-formula><mml:math id="inf313"><mml:mi>u</mml:mi></mml:math></inline-formula> is then tuned until <inline-formula><mml:math id="inf314"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. For a graphical representation of the resolution procedure and details on the numerical scheme used, see <xref ref-type="fig" rid="app1fig4">Appendix 1—figure 4</xref> and appendix Theoretical solution and eigenvalue equation.</p></sec><sec id="s4-7"><title>Maximum likelihood parameters determination</title><p>Nine parameters of the model have been obtained through maximum likelihood fit of the data:</p><list list-type="bullet"><list-item><p>the conversion factor <inline-formula><mml:math id="inf315"><mml:mi>α</mml:mi></mml:math></inline-formula>, which allows for conversion between experimental administered Ag dosage <inline-formula><mml:math id="inf316"><mml:mi>D</mml:mi></mml:math></inline-formula>, measured in micrograms, and the dimensionless administered Ag concentration of our model, <inline-formula><mml:math id="inf317"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>the Ag consumption rate per B-cell <inline-formula><mml:math id="inf318"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>, which controls the GC lifetime and also the extent of the affinity maturation.</p></list-item><list-item><p>the mean <inline-formula><mml:math id="inf319"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula> and variance <inline-formula><mml:math id="inf320"><mml:msubsup><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> of the Gaussian binding energy distribution for the GC seeder clones, elicited directly from the naive population.</p></list-item><list-item><p>the binding energy threshold <inline-formula><mml:math id="inf321"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> for a B-cell to be able to bind Ag with sufficient affinity to internalize it (cf <xref ref-type="disp-formula" rid="equ1">Equation 1</xref>). This parameter does not appear in variant (C), where selection is mediated by T-helper cells only.</p></list-item><list-item><p>The T-cell selection characteristic coefficients, <inline-formula><mml:math id="inf322"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf323"><mml:mi>b</mml:mi></mml:math></inline-formula>, encoding respectively the baseline probabilities to survive or not survive selection, see <xref ref-type="disp-formula" rid="equ2">Equation 2</xref> and <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1.D</xref>.</p></list-item><list-item><p>The weight parameters <inline-formula><mml:math id="inf324"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf325"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, representing the MC fraction in the measured population of IgG-SCs for the two protocols, respectively for schemes 2 and 3 with measurement one day after boost, and scheme 1 with measurement 4 days after second injection.</p></list-item></list><p>We use a procedure that maximizes the average likelihood of experimental affinity measurements. To do so, we perform the following steps:</p><list list-type="order"><list-item><p>For each of the 15 different experimental conditions <inline-formula><mml:math id="inf326"><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:math></inline-formula> (five different dosages in scheme 1, plus seven different dosages in scheme 2, plus four different injection delays in scheme 3, minus the experiment at dosage 10 <inline-formula><mml:math id="inf327"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> TT and 4 weeks delay between injection which is repeated, being present in both schemes 2 and 3) we evaluate the log-likelihood of the experimental measurements through</p><list list-type="simple"><list-item><p><disp-formula id="equ15"><label>(15)</label><mml:math id="m15"><mml:mrow><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi>ln</mml:mi></mml:mpadded><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mtext>Ab-SC</mml:mtext></mml:msub></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p></list-item></list></list-item><list-item><p>where <inline-formula><mml:math id="inf328"><mml:msub><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are the binding energy (<inline-formula><mml:math id="inf329"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) single-cell measurements performed in condition <inline-formula><mml:math id="inf330"><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:math></inline-formula>, and <inline-formula><mml:math id="inf331"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mtext>Ab-SC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the normalized distribution of binding energies of Ab-SC predicted by the deterministic version of the model, and defined as a weighted sum of the normalized MC and PC distributions with MC fraction <inline-formula><mml:math id="inf332"><mml:mi>g</mml:mi></mml:math></inline-formula>: <inline-formula><mml:math id="inf333"><mml:mrow><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mtext>Ab-SC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mpadded width="+5pt"><mml:mi>g</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mtext>MC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>g</mml:mi></mml:mrow><mml:mo rspace="7.5pt" stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mtext>PC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. This fraction is either <inline-formula><mml:math id="inf334"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula> or <inline-formula><mml:math id="inf335"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, depending on the condition <inline-formula><mml:math id="inf336"><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:math></inline-formula> considered (scheme 2,3 or scheme 1). For good comparison with the data the final normalization is done for the part of the distribution inside the experimental sensitivity range <inline-formula><mml:math id="inf337"><mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>23.03</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>min</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>max</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>14.51</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. Notice that a measurement equal to <inline-formula><mml:math id="inf338"><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>min</mml:mi></mml:msub></mml:math></inline-formula> could in truth originate from any lower value of the energy, a situation not taken into account in the above expression for the log-likelihood. In our dataset, however, only four such measurements are present; they have a very weak influence on the results.</p></list-item><list-item><p>Last of all we sum the log-likelihoods over all the conditions <inline-formula><mml:math id="inf339"><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:math></inline-formula> considered for the three different schemes to get the total log-likelihood:</p><list list-type="simple"><list-item><p><disp-formula id="equ16"><label>(16)</label><mml:math id="m16"><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi>ln</mml:mi></mml:mpadded><mml:mo>⁡</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">∑</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi></mml:munder><mml:mrow><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi>ln</mml:mi></mml:mpadded><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒮</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p></list-item></list></list-item><list-item><p>We maximize this global log-likelihood over the space of the nine parameters through the implementation of the <italic>parallel tempering</italic> algorithm, whose details are specified in appendix section Maximum likelihood fit procedure and <xref ref-type="fig" rid="app1fig5">Appendix 1—figure 5</xref> and <xref ref-type="fig" rid="app1fig6">6</xref>. We chose this algorithm because it ensures an effective search of the maximum even in a rugged parameter landscape.</p></list-item><list-item><p>Notice that the total log-likelihood <inline-formula><mml:math id="inf340"><mml:mrow><mml:mpadded width="+2.8pt"><mml:mi>ln</mml:mi></mml:mpadded><mml:mo>⁡</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is sensitive to the number of measurements, which can vary considerably between different conditions. As such when performing the maximization the algorithm favors accuracy over the distributions with the higher number of measurements. Notice also that by evaluating the total likelihood in this manner we neglect the fact that multiple single cell measurements can come from the same stochastic realization of the process and can present some degree of correlation. To validate this inference procedure we generated 10 synthetic datasets using our stochastic model (see <xref ref-type="fig" rid="app1fig11">Appendix 1—figure 11</xref>), with the same number of measurements per scheme as in the experimental dataset. We then inferred, for each synthetic dataset, the values of the parameters, and compared them to their groundtruth. On average all values of the parameters were correctly recovered, see appendix section Validation of inference procedure on artificially generated data and <xref ref-type="table" rid="app1table1">Appendix 1—table 1</xref>.</p></list-item></list></sec><sec id="s4-8"><title>Code and data availability</title><p>The code containing the implementation of our stochastic and deterministic model is made publicly available in the following repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/mmolari/affinity_maturation">https://github.com/mmolari/affinity_maturation</ext-link>; (<xref ref-type="bibr" rid="bib55">Molari, 2020</xref>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/affinity_maturation">https://github.com/elifesciences-publications/affinity_maturation</ext-link>). The repository also includes the experimental dataset, the code to run the inference procedure and the code to reproduce the figures of the main paper (<xref ref-type="fig" rid="fig2">Figures 2</xref>–<xref ref-type="fig" rid="fig6">6</xref>). Please refer to <monospace>README.md</monospace> file for further details.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>This work was supported by the CELLIGO project funded by the French government through BPIFrance under the frame ‘Programme d’Investissements d’Avenir’ (PIA), the ‘Institut Pierre-Gilles de Gennes’ through the laboratoire d’excellence, ‘Investissements d’avenir’ programs ANR-10-IDEX-0001–02 PSL, ANR-10-EQPX-34, ANR-10-LABX-31 and ANR CE30-0021-01 (RBMPro). EK acknowledges generous funding from the ‘The Branco Weiss Fellowship - Society in Science’ and received funding from the European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation programme (Grant agreement No. 80336). We would like to further acknowledge the help of Dr. C Castrillon and Dr. P Bruhns for the work with the murine model system.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing - original draft</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Data curation, Funding acquisition, Investigation, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Funding acquisition, Investigation, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Formal analysis, Supervision, Funding acquisition, Investigation, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Formal analysis, Supervision, Funding acquisition, Investigation, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: Experiments using mice were validated by the CETEA ethics committee number 89 (Institut Pasteur, Paris, France) under #2013-0103, and by the French Ministry of Research under agreement #00513.02.</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="sdata1"><label>Source data 1.</label><caption><title>Single-cell affinity measurement sheet.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-55678-data1-v2.xlsx"/></supplementary-material><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="pdf" mimetype="application" xlink:href="elife-55678-transrepform-v2.pdf"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>All the data analysed in this work are reported in the supporting excel file attached to the submission. These data come from (1) new experiments reported in the present work, and (2) previously published experiments, see Eyer et al., 2017 (referenced in manuscript). The code containing the implementation of our stochastic and deterministic model is made publicly available in the following repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/mmolari/affinity_maturation">https://github.com/mmolari/affinity_maturation</ext-link> (copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/affinity_maturation">https://github.com/elifesciences-publications/affinity_maturation</ext-link>). The repository also includes the experimental dataset, the code to run the inference procedure and the code to reproduce the figures of the main paper (Figures 2 to 6). Please refer to README.md file for further details.</p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abbott</surname> <given-names>RK</given-names></name><name><surname>Lee</surname> <given-names>JH</given-names></name><name><surname>Menis</surname> <given-names>S</given-names></name><name><surname>Skog</surname> <given-names>P</given-names></name><name><surname>Rossi</surname> <given-names>M</given-names></name><name><surname>Ota</surname> <given-names>T</given-names></name><name><surname>Kulp</surname> <given-names>DW</given-names></name><name><surname>Bhullar</surname> <given-names>D</given-names></name><name><surname>Kalyuzhniy</surname> <given-names>O</given-names></name><name><surname>Havenar-Daughton</surname> <given-names>C</given-names></name><name><surname>Schief</surname> <given-names>WR</given-names></name><name><surname>Nemazee</surname> <given-names>D</given-names></name><name><surname>Crotty</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Precursor frequency and affinity determine B cell competitive fitness in germinal centers, tested with Germline-Targeting HIV vaccine immunogens</article-title><source>Immunity</source><volume>48</volume><fpage>133</fpage><lpage>146</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2017.11.023</pub-id><pub-id pub-id-type="pmid">29287996</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Akaike</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="1974">1974</year><chapter-title>A new look at the statistical model identification</chapter-title><person-group person-group-type="editor"><name><surname>Parzen</surname> <given-names>E</given-names></name><name><surname>Tanabe</surname> <given-names>K</given-names></name><name><surname>Kitagawa</surname> <given-names>G</given-names></name></person-group><source>Selected Papers of Hirotugu Akaike</source><publisher-name>Springer</publisher-name><fpage>215</fpage><lpage>222</lpage><pub-id pub-id-type="doi">10.1007/978-1-4612-1694-0</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname> <given-names>CD</given-names></name><name><surname>Okada</surname> <given-names>T</given-names></name><name><surname>Cyster</surname> <given-names>JG</given-names></name></person-group><year iso-8601-date="2007">2007a</year><article-title>Germinal-center organization and cellular dynamics</article-title><source>Immunity</source><volume>27</volume><fpage>190</fpage><lpage>202</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2007.07.009</pub-id><pub-id pub-id-type="pmid">17723214</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname> <given-names>CD</given-names></name><name><surname>Okada</surname> <given-names>T</given-names></name><name><surname>Tang</surname> <given-names>HL</given-names></name><name><surname>Cyster</surname> <given-names>JG</given-names></name></person-group><year iso-8601-date="2007">2007b</year><article-title>Imaging of germinal center selection events during affinity maturation</article-title><source>Science</source><volume>315</volume><fpage>528</fpage><lpage>531</lpage><pub-id pub-id-type="doi">10.1126/science.1136736</pub-id><pub-id pub-id-type="pmid">17185562</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Asensio</surname> <given-names>MA</given-names></name><name><surname>Lim</surname> <given-names>YW</given-names></name><name><surname>Wayham</surname> <given-names>N</given-names></name><name><surname>Stadtmiller</surname> <given-names>K</given-names></name><name><surname>Edgar</surname> <given-names>RC</given-names></name><name><surname>Leong</surname> <given-names>J</given-names></name><name><surname>Leong</surname> <given-names>R</given-names></name><name><surname>Mizrahi</surname> <given-names>RA</given-names></name><name><surname>Adams</surname> <given-names>MS</given-names></name><name><surname>Simons</surname> <given-names>JF</given-names></name><name><surname>Spindler</surname> <given-names>MJ</given-names></name><name><surname>Johnson</surname> <given-names>DS</given-names></name><name><surname>Adler</surname> <given-names>AS</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Antibody repertoire analysis of mouse immunization protocols using microfluidics and molecular genomics</article-title><source>mAbs</source><volume>11</volume><fpage>870</fpage><lpage>883</lpage><pub-id pub-id-type="doi">10.1080/19420862.2019.1583995</pub-id><pub-id pub-id-type="pmid">30898066</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Awate</surname> <given-names>S</given-names></name><name><surname>Babiuk</surname> <given-names>LA</given-names></name><name><surname>Mutwiri</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Mechanisms of Action of Adjuvants</article-title><source>Frontiers in Immunology</source><volume>4</volume><elocation-id>114</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2013.00114</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baer</surname> <given-names>H</given-names></name><name><surname>Bringaze</surname> <given-names>JK</given-names></name><name><surname>McNamee</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1954">1954</year><article-title>The effect of the dose of bacterial polysaccharide antigen on antibody production in mice</article-title><source>Journal of Bacteriology</source><volume>67</volume><fpage>123</fpage><lpage>124</lpage><pub-id pub-id-type="doi">10.1128/JB.67.1.123-124.1954</pub-id><pub-id pub-id-type="pmid">13117824</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bannard</surname> <given-names>O</given-names></name><name><surname>Cyster</surname> <given-names>JG</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Germinal centers: programmed for affinity maturation and antibody diversification</article-title><source>Current Opinion in Immunology</source><volume>45</volume><fpage>21</fpage><lpage>30</lpage><pub-id pub-id-type="doi">10.1016/j.coi.2016.12.004</pub-id><pub-id pub-id-type="pmid">28088708</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Batista</surname> <given-names>FD</given-names></name><name><surname>Neuberger</surname> <given-names>MS</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>B cells extract and present immobilized antigen: implications for affinity discrimination</article-title><source>The EMBO Journal</source><volume>19</volume><fpage>513</fpage><lpage>520</lpage><pub-id pub-id-type="doi">10.1093/emboj/19.4.513</pub-id><pub-id pub-id-type="pmid">10675320</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bernasconi</surname> <given-names>NL</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Maintenance of serological memory by polyclonal activation of human memory B cells</article-title><source>Science</source><volume>298</volume><fpage>2199</fpage><lpage>2202</lpage><pub-id pub-id-type="doi">10.1126/science.1076071</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buchauer</surname> <given-names>L</given-names></name><name><surname>Wardemann</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Calculating germinal centre reactions</article-title><source>Current Opinion in Systems Biology</source><volume>18</volume><fpage>1</fpage><lpage>8</lpage><pub-id pub-id-type="doi">10.1016/j.coisb.2019.10.004</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cirelli</surname> <given-names>KM</given-names></name><name><surname>Carnathan</surname> <given-names>DG</given-names></name><name><surname>Nogal</surname> <given-names>B</given-names></name><name><surname>Martin</surname> <given-names>JT</given-names></name><name><surname>Rodriguez</surname> <given-names>OL</given-names></name><name><surname>Upadhyay</surname> <given-names>AA</given-names></name><name><surname>Enemuo</surname> <given-names>CA</given-names></name><name><surname>Gebru</surname> <given-names>EH</given-names></name><name><surname>Choe</surname> <given-names>Y</given-names></name><name><surname>Viviano</surname> <given-names>F</given-names></name><name><surname>Nakao</surname> <given-names>C</given-names></name><name><surname>Pauthner</surname> <given-names>MG</given-names></name><name><surname>Reiss</surname> <given-names>S</given-names></name><name><surname>Cottrell</surname> <given-names>CA</given-names></name><name><surname>Smith</surname> <given-names>ML</given-names></name><name><surname>Bastidas</surname> <given-names>R</given-names></name><name><surname>Gibson</surname> <given-names>W</given-names></name><name><surname>Wolabaugh</surname> <given-names>AN</given-names></name><name><surname>Melo</surname> <given-names>MB</given-names></name><name><surname>Cossette</surname> <given-names>B</given-names></name><name><surname>Kumar</surname> <given-names>V</given-names></name><name><surname>Patel</surname> <given-names>NB</given-names></name><name><surname>Tokatlian</surname> <given-names>T</given-names></name><name><surname>Menis</surname> <given-names>S</given-names></name><name><surname>Kulp</surname> <given-names>DW</given-names></name><name><surname>Burton</surname> <given-names>DR</given-names></name><name><surname>Murrell</surname> <given-names>B</given-names></name><name><surname>Schief</surname> <given-names>WR</given-names></name><name><surname>Bosinger</surname> <given-names>SE</given-names></name><name><surname>Ward</surname> <given-names>AB</given-names></name><name><surname>Watson</surname> <given-names>CT</given-names></name><name><surname>Silvestri</surname> <given-names>G</given-names></name><name><surname>Irvine</surname> <given-names>DJ</given-names></name><name><surname>Crotty</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Slow delivery immunization enhances HIV neutralizing antibody and germinal center responses via modulation of immunodominance</article-title><source>Cell</source><volume>177</volume><fpage>1153</fpage><lpage>1171</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.04.012</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coffman</surname> <given-names>RL</given-names></name><name><surname>Sher</surname> <given-names>A</given-names></name><name><surname>Seder</surname> <given-names>RA</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Vaccine adjuvants: putting innate immunity to work</article-title><source>Immunity</source><volume>33</volume><fpage>492</fpage><lpage>503</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2010.10.002</pub-id><pub-id pub-id-type="pmid">21029960</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Crotty</surname> <given-names>S</given-names></name><name><surname>Felgner</surname> <given-names>P</given-names></name><name><surname>Davies</surname> <given-names>H</given-names></name><name><surname>Glidewell</surname> <given-names>J</given-names></name><name><surname>Villarreal</surname> <given-names>L</given-names></name><name><surname>Ahmed</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Cutting edge: long-term B cell memory in humans after smallpox vaccination</article-title><source>The Journal of Immunology</source><volume>171</volume><fpage>4969</fpage><lpage>4973</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.171.10.4969</pub-id><pub-id pub-id-type="pmid">14607890</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>De Silva</surname> <given-names>NS</given-names></name><name><surname>Klein</surname> <given-names>U</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Dynamics of B cells in germinal centres</article-title><source>Nature Reviews Immunology</source><volume>15</volume><fpage>137</fpage><lpage>148</lpage><pub-id pub-id-type="doi">10.1038/nri3804</pub-id><pub-id pub-id-type="pmid">25656706</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Depoil</surname> <given-names>D</given-names></name><name><surname>Zaru</surname> <given-names>R</given-names></name><name><surname>Guiraud</surname> <given-names>M</given-names></name><name><surname>Chauveau</surname> <given-names>A</given-names></name><name><surname>Harriague</surname> <given-names>J</given-names></name><name><surname>Bismuth</surname> <given-names>G</given-names></name><name><surname>Utzny</surname> <given-names>C</given-names></name><name><surname>Müller</surname> <given-names>S</given-names></name><name><surname>Valitutti</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Immunological synapses are versatile structures enabling selective T cell polarization</article-title><source>Immunity</source><volume>22</volume><fpage>185</fpage><lpage>194</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2004.12.010</pub-id><pub-id pub-id-type="pmid">15723807</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dogan</surname> <given-names>I</given-names></name><name><surname>Bertocci</surname> <given-names>B</given-names></name><name><surname>Vilmont</surname> <given-names>V</given-names></name><name><surname>Delbos</surname> <given-names>F</given-names></name><name><surname>Mégret</surname> <given-names>J</given-names></name><name><surname>Storck</surname> <given-names>S</given-names></name><name><surname>Reynaud</surname> <given-names>CA</given-names></name><name><surname>Weill</surname> <given-names>JC</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Multiple layers of B cell memory with different effector functions</article-title><source>Nature Immunology</source><volume>10</volume><fpage>1292</fpage><lpage>1299</lpage><pub-id pub-id-type="doi">10.1038/ni.1814</pub-id><pub-id pub-id-type="pmid">19855380</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eisen</surname> <given-names>HN</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Affinity enhancement of antibodies: how low-affinity antibodies produced early in immune responses are followed by high-affinity antibodies later and in memory B-cell responses</article-title><source>Cancer Immunology Research</source><volume>2</volume><fpage>381</fpage><lpage>392</lpage><pub-id pub-id-type="doi">10.1158/2326-6066.CIR-14-0029</pub-id><pub-id pub-id-type="pmid">24795350</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eisen</surname> <given-names>HN</given-names></name><name><surname>Siskind</surname> <given-names>GW</given-names></name></person-group><year iso-8601-date="1964">1964</year><article-title>Variations in affinities of antibodies during the immune response</article-title><source>Biochemistry</source><volume>3</volume><fpage>996</fpage><lpage>1008</lpage><pub-id pub-id-type="doi">10.1021/bi00895a027</pub-id><pub-id pub-id-type="pmid">14214095</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhanati</surname> <given-names>Y</given-names></name><name><surname>Sethna</surname> <given-names>Z</given-names></name><name><surname>Marcou</surname> <given-names>Q</given-names></name><name><surname>Callan</surname> <given-names>CG</given-names></name><name><surname>Mora</surname> <given-names>T</given-names></name><name><surname>Walczak</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Inferring processes underlying B-cell repertoire diversity</article-title><source>Philosophical Transactions of the Royal Society B: Biological Sciences</source><volume>370</volume><elocation-id>20140243</elocation-id><pub-id pub-id-type="doi">10.1098/rstb.2014.0243</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ershler</surname> <given-names>WB</given-names></name><name><surname>Moore</surname> <given-names>AL</given-names></name><name><surname>Hacker</surname> <given-names>MP</given-names></name></person-group><year iso-8601-date="1982">1982</year><article-title>Specific in vivo and in vitro antibody response to tetanus toxoid immunization</article-title><source>Clinical and Experimental Immunology</source><volume>49</volume><elocation-id>552</elocation-id><pub-id pub-id-type="pmid">6756720</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eyer</surname> <given-names>K</given-names></name><name><surname>Doineau</surname> <given-names>RCL</given-names></name><name><surname>Castrillon</surname> <given-names>CE</given-names></name><name><surname>Briseño-Roa</surname> <given-names>L</given-names></name><name><surname>Menrath</surname> <given-names>V</given-names></name><name><surname>Mottet</surname> <given-names>G</given-names></name><name><surname>England</surname> <given-names>P</given-names></name><name><surname>Godina</surname> <given-names>A</given-names></name><name><surname>Brient-Litzler</surname> <given-names>E</given-names></name><name><surname>Nizak</surname> <given-names>C</given-names></name><name><surname>Jensen</surname> <given-names>A</given-names></name><name><surname>Griffiths</surname> <given-names>AD</given-names></name><name><surname>Bibette</surname> <given-names>J</given-names></name><name><surname>Bruhns</surname> <given-names>P</given-names></name><name><surname>Baudry</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Single-cell deep phenotyping of IgG-secreting cells for high-resolution immune monitoring</article-title><source>Nature Biotechnology</source><volume>35</volume><fpage>977</fpage><lpage>982</lpage><pub-id pub-id-type="doi">10.1038/nbt.3964</pub-id><pub-id pub-id-type="pmid">28892076</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eyer</surname> <given-names>K</given-names></name><name><surname>Castrillon</surname> <given-names>C</given-names></name><name><surname>Chenon</surname> <given-names>G</given-names></name><name><surname>Bibette</surname> <given-names>J</given-names></name><name><surname>Griffiths</surname> <given-names>AD</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The quantitative assessment of the secreted IgG repertoire after recall to evaluate the quality of immunizations</article-title><source>The Journal of Immunology</source><comment>In press</comment></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finney</surname> <given-names>J</given-names></name><name><surname>Yeh</surname> <given-names>CH</given-names></name><name><surname>Kelsoe</surname> <given-names>G</given-names></name><name><surname>Kuraoka</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Germinal center responses to complex antigens</article-title><source>Immunological Reviews</source><volume>284</volume><fpage>42</fpage><lpage>50</lpage><pub-id pub-id-type="doi">10.1111/imr.12661</pub-id><pub-id pub-id-type="pmid">29944756</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Foote</surname> <given-names>J</given-names></name><name><surname>Eisen</surname> <given-names>HN</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Kinetic and affinity limits on antibodies produced during immune responses</article-title><source>PNAS</source><volume>92</volume><fpage>1254</fpage><lpage>1256</lpage><pub-id pub-id-type="doi">10.1073/pnas.92.5.1254</pub-id><pub-id pub-id-type="pmid">7877964</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gérard</surname> <given-names>A</given-names></name><name><surname>Woolfe</surname> <given-names>A</given-names></name><name><surname>Mottet</surname> <given-names>G</given-names></name><name><surname>Reichen</surname> <given-names>M</given-names></name><name><surname>Castrillon</surname> <given-names>C</given-names></name><name><surname>Menrath</surname> <given-names>V</given-names></name><name><surname>Ellouze</surname> <given-names>S</given-names></name><name><surname>Poitou</surname> <given-names>A</given-names></name><name><surname>Doineau</surname> <given-names>R</given-names></name><name><surname>Briseno-Roa</surname> <given-names>L</given-names></name><name><surname>Canales-Herrerias</surname> <given-names>P</given-names></name><name><surname>Mary</surname> <given-names>P</given-names></name><name><surname>Rose</surname> <given-names>G</given-names></name><name><surname>Ortega</surname> <given-names>C</given-names></name><name><surname>Delincé</surname> <given-names>M</given-names></name><name><surname>Essono</surname> <given-names>S</given-names></name><name><surname>Jia</surname> <given-names>B</given-names></name><name><surname>Iannascoli</surname> <given-names>B</given-names></name><name><surname>Richard-Le Goff</surname> <given-names>O</given-names></name><name><surname>Kumar</surname> <given-names>R</given-names></name><name><surname>Stewart</surname> <given-names>SN</given-names></name><name><surname>Pousse</surname> <given-names>Y</given-names></name><name><surname>Shen</surname> <given-names>B</given-names></name><name><surname>Grosselin</surname> <given-names>K</given-names></name><name><surname>Saudemont</surname> <given-names>B</given-names></name><name><surname>Sautel-Caillé</surname> <given-names>A</given-names></name><name><surname>Godina</surname> <given-names>A</given-names></name><name><surname>McNamara</surname> <given-names>S</given-names></name><name><surname>Eyer</surname> <given-names>K</given-names></name><name><surname>Millot</surname> <given-names>GA</given-names></name><name><surname>Baudry</surname> <given-names>J</given-names></name><name><surname>England</surname> <given-names>P</given-names></name><name><surname>Nizak</surname> <given-names>C</given-names></name><name><surname>Jensen</surname> <given-names>A</given-names></name><name><surname>Griffiths</surname> <given-names>AD</given-names></name><name><surname>Bruhns</surname> <given-names>P</given-names></name><name><surname>Brenan</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>High-throughput single-cell activity-based screening and sequencing of antibodies using droplet microfluidics</article-title><source>Nature Biotechnology</source><volume>38</volume><fpage>715</fpage><lpage>721</lpage><pub-id pub-id-type="doi">10.1038/s41587-020-0466-7</pub-id><pub-id pub-id-type="pmid">32231335</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gitlin</surname> <given-names>AD</given-names></name><name><surname>Shulman</surname> <given-names>Z</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Clonal selection in the germinal centre by regulated proliferation and hypermutation</article-title><source>Nature</source><volume>509</volume><fpage>637</fpage><lpage>640</lpage><pub-id pub-id-type="doi">10.1038/nature13300</pub-id><pub-id pub-id-type="pmid">24805232</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gitlin</surname> <given-names>AD</given-names></name><name><surname>Mayer</surname> <given-names>CT</given-names></name><name><surname>Oliveira</surname> <given-names>TY</given-names></name><name><surname>Shulman</surname> <given-names>Z</given-names></name><name><surname>Jones</surname> <given-names>MJ</given-names></name><name><surname>Koren</surname> <given-names>A</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>HUMORAL IMMUNITY. T cell help controls the speed of the cell cycle in germinal center B cells</article-title><source>Science</source><volume>349</volume><fpage>643</fpage><lpage>646</lpage><pub-id pub-id-type="doi">10.1126/science.aac4919</pub-id><pub-id pub-id-type="pmid">26184917</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goidl</surname> <given-names>EA</given-names></name><name><surname>Paul</surname> <given-names>WE</given-names></name><name><surname>Siskind</surname> <given-names>GW</given-names></name><name><surname>Benacerraf</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="1968">1968</year><article-title>The effect of antigen dose and time after immunization on the amount and affinity of anti-hapten antibody</article-title><source>The Journal of Immunology</source><volume>100</volume><fpage>371</fpage><lpage>375</lpage></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Greenwood</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The contribution of vaccination to global health: past, present and future</article-title><source>Philosophical Transactions of the Royal Society B: Biological Sciences</source><volume>369</volume><elocation-id>20130433</elocation-id><pub-id pub-id-type="doi">10.1098/rstb.2013.0433</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Han</surname> <given-names>S</given-names></name><name><surname>Zheng</surname> <given-names>B</given-names></name><name><surname>Dal Porto</surname> <given-names>J</given-names></name><name><surname>Kelsoe</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>In situ studies of the primary immune response to (4-hydroxy-3-nitrophenyl)acetyl. IV. Affinity-dependent, antigen-driven B cell apoptosis in germinal centers as a mechanism for maintaining self-tolerance</article-title><source>The Journal of Experimental Medicine</source><volume>182</volume><fpage>1635</fpage><lpage>1644</lpage><pub-id pub-id-type="doi">10.1084/jem.182.6.1635</pub-id><pub-id pub-id-type="pmid">7500008</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heesters</surname> <given-names>BA</given-names></name><name><surname>Chatterjee</surname> <given-names>P</given-names></name><name><surname>Kim</surname> <given-names>YA</given-names></name><name><surname>Gonzalez</surname> <given-names>SF</given-names></name><name><surname>Kuligowski</surname> <given-names>MP</given-names></name><name><surname>Kirchhausen</surname> <given-names>T</given-names></name><name><surname>Carroll</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Endocytosis and recycling of immune complexes by follicular dendritic cells enhances B cell antigen binding and activation</article-title><source>Immunity</source><volume>38</volume><fpage>1164</fpage><lpage>1175</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2013.02.023</pub-id><pub-id pub-id-type="pmid">23770227</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heesters</surname> <given-names>BA</given-names></name><name><surname>Myers</surname> <given-names>RC</given-names></name><name><surname>Carroll</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Follicular dendritic cells: dynamic antigen libraries</article-title><source>Nature Reviews Immunology</source><volume>14</volume><fpage>495</fpage><lpage>504</lpage><pub-id pub-id-type="doi">10.1038/nri3689</pub-id><pub-id pub-id-type="pmid">24948364</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>HogenEsch</surname> <given-names>H</given-names></name><name><surname>O'Hagan</surname> <given-names>DT</given-names></name><name><surname>Fox</surname> <given-names>CB</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Optimizing the utilization of aluminum adjuvants in vaccines: you might just get what you want</article-title><source>Npj Vaccines</source><volume>3</volume><fpage>1</fpage><lpage>11</lpage><pub-id pub-id-type="doi">10.1038/s41541-018-0089-x</pub-id><pub-id pub-id-type="pmid">30323958</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Horns</surname> <given-names>F</given-names></name><name><surname>Dekker</surname> <given-names>CL</given-names></name><name><surname>Quake</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Transcriptional program of memory B cell activation, broadly binding anti-influenza antibodies, and bystander activation after vaccination revealed by single-cell transcriptomics</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/709337</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Inoue</surname> <given-names>T</given-names></name><name><surname>Moran</surname> <given-names>I</given-names></name><name><surname>Shinnakasu</surname> <given-names>R</given-names></name><name><surname>Phan</surname> <given-names>TG</given-names></name><name><surname>Kurosaki</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Generation of memory B cells and their reactivation</article-title><source>Immunological Reviews</source><volume>283</volume><fpage>138</fpage><lpage>149</lpage><pub-id pub-id-type="doi">10.1111/imr.12640</pub-id><pub-id pub-id-type="pmid">29664566</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jacob</surname> <given-names>J</given-names></name><name><surname>Przylepa</surname> <given-names>J</given-names></name><name><surname>Miller</surname> <given-names>C</given-names></name><name><surname>Kelsoe</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>In situ studies of the primary immune response to (4-hydroxy-3-nitrophenyl)acetyl. III. the kinetics of V region mutation and selection in germinal center B cells</article-title><source>The Journal of Experimental Medicine</source><volume>178</volume><fpage>1293</fpage><lpage>1307</lpage><pub-id pub-id-type="doi">10.1084/jem.178.4.1293</pub-id><pub-id pub-id-type="pmid">8376935</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname> <given-names>M</given-names></name><name><surname>Eisen</surname> <given-names>TJ</given-names></name><name><surname>Eisen</surname> <given-names>EA</given-names></name><name><surname>Chakraborty</surname> <given-names>AK</given-names></name><name><surname>Eisen</surname> <given-names>HN</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Affinity inequality among serum antibodies that originate in lymphoid germinal centers</article-title><source>PLOS ONE</source><volume>10</volume><elocation-id>e0139222</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0139222</pub-id><pub-id pub-id-type="pmid">26444899</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keck</surname> <given-names>ZY</given-names></name><name><surname>Wang</surname> <given-names>Y</given-names></name><name><surname>Lau</surname> <given-names>P</given-names></name><name><surname>Lund</surname> <given-names>G</given-names></name><name><surname>Rangarajan</surname> <given-names>S</given-names></name><name><surname>Fauvelle</surname> <given-names>C</given-names></name><name><surname>Liao</surname> <given-names>GC</given-names></name><name><surname>Holtsberg</surname> <given-names>FW</given-names></name><name><surname>Warfield</surname> <given-names>KL</given-names></name><name><surname>Aman</surname> <given-names>MJ</given-names></name><name><surname>Pierce</surname> <given-names>BG</given-names></name><name><surname>Fuerst</surname> <given-names>TR</given-names></name><name><surname>Bailey</surname> <given-names>JR</given-names></name><name><surname>Baumert</surname> <given-names>TF</given-names></name><name><surname>Mariuzza</surname> <given-names>RA</given-names></name><name><surname>Kneteman</surname> <given-names>NM</given-names></name><name><surname>Foung</surname> <given-names>SK</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Affinity maturation of a broadly neutralizing human monoclonal antibody that prevents acute hepatitis C virus infection in mice</article-title><source>Hepatology</source><volume>64</volume><fpage>1922</fpage><lpage>1933</lpage><pub-id pub-id-type="doi">10.1002/hep.28850</pub-id><pub-id pub-id-type="pmid">27641232</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kleinstein</surname> <given-names>SH</given-names></name><name><surname>Louzoun</surname> <given-names>Y</given-names></name><name><surname>Shlomchik</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Estimating hypermutation rates from clonal tree data</article-title><source>The Journal of Immunology</source><volume>171</volume><fpage>4639</fpage><lpage>4649</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.171.9.4639</pub-id><pub-id pub-id-type="pmid">14568938</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Knežević</surname> <given-names>M</given-names></name><name><surname>Jiang</surname> <given-names>H</given-names></name><name><surname>Wang</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Active tuning of synaptic patterns enhances immune discrimination</article-title><source>Physical Review Letters</source><volume>121</volume><elocation-id>238101</elocation-id><pub-id pub-id-type="doi">10.1103/PhysRevLett.121.238101</pub-id><pub-id pub-id-type="pmid">30576186</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krishna</surname> <given-names>V</given-names></name><name><surname>Bachman</surname> <given-names>KE</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A mechanism of T cell dependent selection of antigen engaged germinal center B cells</article-title><source>PLOS ONE</source><volume>13</volume><elocation-id>e0200241</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0200241</pub-id><pub-id pub-id-type="pmid">30138347</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuraoka</surname> <given-names>M</given-names></name><name><surname>Schmidt</surname> <given-names>AG</given-names></name><name><surname>Nojima</surname> <given-names>T</given-names></name><name><surname>Feng</surname> <given-names>F</given-names></name><name><surname>Watanabe</surname> <given-names>A</given-names></name><name><surname>Kitamura</surname> <given-names>D</given-names></name><name><surname>Harrison</surname> <given-names>SC</given-names></name><name><surname>Kepler</surname> <given-names>TB</given-names></name><name><surname>Kelsoe</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Complex antigens drive permissive clonal selection in germinal centers</article-title><source>Immunity</source><volume>44</volume><fpage>542</fpage><lpage>552</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2016.02.010</pub-id><pub-id pub-id-type="pmid">26948373</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lau</surname> <given-names>AW</given-names></name><name><surname>Brink</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Selection in the germinal center</article-title><source>Current Opinion in Immunology</source><volume>63</volume><fpage>29</fpage><lpage>34</lpage><pub-id pub-id-type="doi">10.1016/j.coi.2019.11.001</pub-id><pub-id pub-id-type="pmid">31835060</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lavinder</surname> <given-names>JJ</given-names></name><name><surname>Wine</surname> <given-names>Y</given-names></name><name><surname>Giesecke</surname> <given-names>C</given-names></name><name><surname>Ippolito</surname> <given-names>GC</given-names></name><name><surname>Horton</surname> <given-names>AP</given-names></name><name><surname>Lungu</surname> <given-names>OI</given-names></name><name><surname>Hoi</surname> <given-names>KH</given-names></name><name><surname>DeKosky</surname> <given-names>BJ</given-names></name><name><surname>Murrin</surname> <given-names>EM</given-names></name><name><surname>Wirth</surname> <given-names>MM</given-names></name><name><surname>Ellington</surname> <given-names>AD</given-names></name><name><surname>Dörner</surname> <given-names>T</given-names></name><name><surname>Marcotte</surname> <given-names>EM</given-names></name><name><surname>Boutz</surname> <given-names>DR</given-names></name><name><surname>Georgiou</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Identification and characterization of the constituent human serum antibodies elicited by vaccination</article-title><source>PNAS</source><volume>111</volume><fpage>2259</fpage><lpage>2264</lpage><pub-id pub-id-type="doi">10.1073/pnas.1317793111</pub-id><pub-id pub-id-type="pmid">24469811</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname> <given-names>CH</given-names></name><name><surname>Romain</surname> <given-names>G</given-names></name><name><surname>Yan</surname> <given-names>W</given-names></name><name><surname>Watanabe</surname> <given-names>M</given-names></name><name><surname>Charab</surname> <given-names>W</given-names></name><name><surname>Todorova</surname> <given-names>B</given-names></name><name><surname>Lee</surname> <given-names>J</given-names></name><name><surname>Triplett</surname> <given-names>K</given-names></name><name><surname>Donkor</surname> <given-names>M</given-names></name><name><surname>Lungu</surname> <given-names>OI</given-names></name><name><surname>Lux</surname> <given-names>A</given-names></name><name><surname>Marshall</surname> <given-names>N</given-names></name><name><surname>Lindorfer</surname> <given-names>MA</given-names></name><name><surname>Goff</surname> <given-names>OR</given-names></name><name><surname>Balbino</surname> <given-names>B</given-names></name><name><surname>Kang</surname> <given-names>TH</given-names></name><name><surname>Tanno</surname> <given-names>H</given-names></name><name><surname>Delidakis</surname> <given-names>G</given-names></name><name><surname>Alford</surname> <given-names>C</given-names></name><name><surname>Taylor</surname> <given-names>RP</given-names></name><name><surname>Nimmerjahn</surname> <given-names>F</given-names></name><name><surname>Varadarajan</surname> <given-names>N</given-names></name><name><surname>Bruhns</surname> <given-names>P</given-names></name><name><surname>Zhang</surname> <given-names>YJ</given-names></name><name><surname>Georgiou</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>IgG fc domains that bind C1q but not effector fcγ receptors delineate the importance of complement-mediated effector functions</article-title><source>Nature Immunology</source><volume>18</volume><fpage>889</fpage><lpage>898</lpage><pub-id pub-id-type="doi">10.1038/ni.3770</pub-id><pub-id pub-id-type="pmid">28604720</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname> <given-names>S</given-names></name><name><surname>Rouphael</surname> <given-names>N</given-names></name><name><surname>Duraisingham</surname> <given-names>S</given-names></name><name><surname>Romero-Steiner</surname> <given-names>S</given-names></name><name><surname>Presnell</surname> <given-names>S</given-names></name><name><surname>Davis</surname> <given-names>C</given-names></name><name><surname>Schmidt</surname> <given-names>DS</given-names></name><name><surname>Johnson</surname> <given-names>SE</given-names></name><name><surname>Milton</surname> <given-names>A</given-names></name><name><surname>Rajam</surname> <given-names>G</given-names></name><name><surname>Kasturi</surname> <given-names>S</given-names></name><name><surname>Carlone</surname> <given-names>GM</given-names></name><name><surname>Quinn</surname> <given-names>C</given-names></name><name><surname>Chaussabel</surname> <given-names>D</given-names></name><name><surname>Palucka</surname> <given-names>AK</given-names></name><name><surname>Mulligan</surname> <given-names>MJ</given-names></name><name><surname>Ahmed</surname> <given-names>R</given-names></name><name><surname>Stephens</surname> <given-names>DS</given-names></name><name><surname>Nakaya</surname> <given-names>HI</given-names></name><name><surname>Pulendran</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Molecular signatures of antibody responses derived from a systems biology study of five human vaccines</article-title><source>Nature Immunology</source><volume>15</volume><fpage>195</fpage><lpage>204</lpage><pub-id pub-id-type="doi">10.1038/ni.2789</pub-id><pub-id pub-id-type="pmid">24336226</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>MacLean</surname> <given-names>DS</given-names></name><name><surname>Robertson</surname> <given-names>JD</given-names></name><name><surname>Jay</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Monitoring the retention of a protein antigen in complete Freund's adjuvant, alum, and pluronic F-127 gel formulations by X-ray fluorescence</article-title><source>Pharmaceutical Development and Technology</source><volume>6</volume><fpage>241</fpage><lpage>246</lpage><pub-id pub-id-type="doi">10.1081/PDT-100002200</pub-id><pub-id pub-id-type="pmid">11416998</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mayer</surname> <given-names>CT</given-names></name><name><surname>Gazumyan</surname> <given-names>A</given-names></name><name><surname>Kara</surname> <given-names>EE</given-names></name><name><surname>Gitlin</surname> <given-names>AD</given-names></name><name><surname>Golijanin</surname> <given-names>J</given-names></name><name><surname>Viant</surname> <given-names>C</given-names></name><name><surname>Pai</surname> <given-names>J</given-names></name><name><surname>Oliveira</surname> <given-names>TY</given-names></name><name><surname>Wang</surname> <given-names>Q</given-names></name><name><surname>Escolano</surname> <given-names>A</given-names></name><name><surname>Medina-Ramirez</surname> <given-names>M</given-names></name><name><surname>Sanders</surname> <given-names>RW</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>The microanatomic segregation of selection by apoptosis in the germinal center</article-title><source>Science</source><volume>358</volume><elocation-id>eaao2602</elocation-id><pub-id pub-id-type="doi">10.1126/science.aao2602</pub-id><pub-id pub-id-type="pmid">28935768</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McHeyzer-Williams</surname> <given-names>MG</given-names></name><name><surname>McLean</surname> <given-names>MJ</given-names></name><name><surname>Lalor</surname> <given-names>PA</given-names></name><name><surname>Nossal</surname> <given-names>GJ</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Antigen-driven B cell differentiation in vivo</article-title><source>The Journal of Experimental Medicine</source><volume>178</volume><fpage>295</fpage><lpage>307</lpage><pub-id pub-id-type="doi">10.1084/jem.178.1.295</pub-id><pub-id pub-id-type="pmid">8315385</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McHeyzer-Williams</surname> <given-names>LJ</given-names></name><name><surname>Milpied</surname> <given-names>PJ</given-names></name><name><surname>Okitsu</surname> <given-names>SL</given-names></name><name><surname>McHeyzer-Williams</surname> <given-names>MG</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Class-switched memory B cells remodel BCRs within secondary germinal centers</article-title><source>Nature Immunology</source><volume>16</volume><fpage>296</fpage><lpage>305</lpage><pub-id pub-id-type="doi">10.1038/ni.3095</pub-id><pub-id pub-id-type="pmid">25642821</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McKean</surname> <given-names>D</given-names></name><name><surname>Huppi</surname> <given-names>K</given-names></name><name><surname>Bell</surname> <given-names>M</given-names></name><name><surname>Staudt</surname> <given-names>L</given-names></name><name><surname>Gerhard</surname> <given-names>W</given-names></name><name><surname>Weigert</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>Generation of antibody diversity in the immune response of BALB/c mice to influenza virus hemagglutinin</article-title><source>PNAS</source><volume>81</volume><fpage>3180</fpage><lpage>3184</lpage><pub-id pub-id-type="doi">10.1073/pnas.81.10.3180</pub-id><pub-id pub-id-type="pmid">6203114</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mesin</surname> <given-names>L</given-names></name><name><surname>Ersching</surname> <given-names>J</given-names></name><name><surname>Victora</surname> <given-names>GD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Germinal center B cell dynamics</article-title><source>Immunity</source><volume>45</volume><fpage>471</fpage><lpage>482</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2016.09.001</pub-id><pub-id pub-id-type="pmid">27653600</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meyer-Hermann</surname> <given-names>M</given-names></name><name><surname>Mohr</surname> <given-names>E</given-names></name><name><surname>Pelletier</surname> <given-names>N</given-names></name><name><surname>Zhang</surname> <given-names>Y</given-names></name><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Toellner</surname> <given-names>KM</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A theory of germinal center B cell selection, division, and exit</article-title><source>Cell Reports</source><volume>2</volume><fpage>162</fpage><lpage>174</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2012.05.010</pub-id><pub-id pub-id-type="pmid">22840406</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Molari</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>Affinity maturation simulation</data-title><source>GitHub</source><version designator="3.7.4">3.7.4</version><ext-link ext-link-type="uri" xlink:href="https://github.com/mmolari/affinity_maturation">https://github.com/mmolari/affinity_maturation</ext-link></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morens</surname> <given-names>DM</given-names></name><name><surname>Burke</surname> <given-names>DS</given-names></name><name><surname>Halstead</surname> <given-names>SB</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>The wages of original antigenic sin</article-title><source>Emerging Infectious Diseases</source><volume>16</volume><fpage>1023</fpage><lpage>1024</lpage><pub-id pub-id-type="doi">10.3201/eid1606.100453</pub-id><pub-id pub-id-type="pmid">20507764</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murugan</surname> <given-names>R</given-names></name><name><surname>Buchauer</surname> <given-names>L</given-names></name><name><surname>Triller</surname> <given-names>G</given-names></name><name><surname>Kreschel</surname> <given-names>C</given-names></name><name><surname>Costa</surname> <given-names>G</given-names></name><name><surname>Pidelaserra Martí</surname> <given-names>G</given-names></name><name><surname>Imkeller</surname> <given-names>K</given-names></name><name><surname>Busse</surname> <given-names>CE</given-names></name><name><surname>Chakravarty</surname> <given-names>S</given-names></name><name><surname>Sim</surname> <given-names>BKL</given-names></name><name><surname>Hoffman</surname> <given-names>SL</given-names></name><name><surname>Levashina</surname> <given-names>EA</given-names></name><name><surname>Kremsner</surname> <given-names>PG</given-names></name><name><surname>Mordmüller</surname> <given-names>B</given-names></name><name><surname>Höfer</surname> <given-names>T</given-names></name><name><surname>Wardemann</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Clonal selection drives protective memory B cell responses in controlled human malaria infection</article-title><source>Science Immunology</source><volume>3</volume><elocation-id>eaap8029</elocation-id><pub-id pub-id-type="doi">10.1126/sciimmunol.aap8029</pub-id><pub-id pub-id-type="pmid">29453292</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakaya</surname> <given-names>HI</given-names></name><name><surname>Hagan</surname> <given-names>T</given-names></name><name><surname>Duraisingham</surname> <given-names>SS</given-names></name><name><surname>Lee</surname> <given-names>EK</given-names></name><name><surname>Kwissa</surname> <given-names>M</given-names></name><name><surname>Rouphael</surname> <given-names>N</given-names></name><name><surname>Frasca</surname> <given-names>D</given-names></name><name><surname>Gersten</surname> <given-names>M</given-names></name><name><surname>Mehta</surname> <given-names>AK</given-names></name><name><surname>Gaujoux</surname> <given-names>R</given-names></name><name><surname>Li</surname> <given-names>G-M</given-names></name><name><surname>Gupta</surname> <given-names>S</given-names></name><name><surname>Ahmed</surname> <given-names>R</given-names></name><name><surname>Mulligan</surname> <given-names>MJ</given-names></name><name><surname>Shen-Orr</surname> <given-names>S</given-names></name><name><surname>Blomberg</surname> <given-names>BB</given-names></name><name><surname>Subramaniam</surname> <given-names>S</given-names></name><name><surname>Pulendran</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Systems analysis of immunity to influenza vaccination across multiple years and in diverse populations reveals shared molecular signatures</article-title><source>Immunity</source><volume>43</volume><fpage>1186</fpage><lpage>1198</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2015.11.012</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nanni</surname> <given-names>A</given-names></name><name><surname>Meredith</surname> <given-names>S</given-names></name><name><surname>Gati</surname> <given-names>S</given-names></name><name><surname>Holm</surname> <given-names>K</given-names></name><name><surname>Harmon</surname> <given-names>T</given-names></name><name><surname>Ginsberg</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Strengthening global vaccine access for adolescents and adults</article-title><source>Vaccine</source><volume>35</volume><fpage>6823</fpage><lpage>6827</lpage><pub-id pub-id-type="doi">10.1016/j.vaccine.2017.10.023</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Natkanski</surname> <given-names>E</given-names></name><name><surname>Lee</surname> <given-names>WY</given-names></name><name><surname>Mistry</surname> <given-names>B</given-names></name><name><surname>Casal</surname> <given-names>A</given-names></name><name><surname>Molloy</surname> <given-names>JE</given-names></name><name><surname>Tolar</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>B cells use mechanical energy to discriminate antigen affinities</article-title><source>Science</source><volume>340</volume><fpage>1587</fpage><lpage>1590</lpage><pub-id pub-id-type="doi">10.1126/science.1237572</pub-id><pub-id pub-id-type="pmid">23686338</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Neher</surname> <given-names>RA</given-names></name><name><surname>Walczak</surname> <given-names>AN</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Progress and open problems in evolutionary dynamics</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1804.07720">https://arxiv.org/abs/1804.07720</ext-link></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nowosad</surname> <given-names>CR</given-names></name><name><surname>Spillane</surname> <given-names>KM</given-names></name><name><surname>Tolar</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Germinal center B cells recognize antigen through a specialized immune synapse architecture</article-title><source>Nature Immunology</source><volume>17</volume><fpage>870</fpage><lpage>877</lpage><pub-id pub-id-type="doi">10.1038/ni.3458</pub-id><pub-id pub-id-type="pmid">27183103</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nussenzweig</surname> <given-names>V</given-names></name><name><surname>Benacerraf</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="1967">1967</year><article-title>Antihapten antibody specificity and L chain type</article-title><source>The Journal of Experimental Medicine</source><volume>126</volume><fpage>727</fpage><lpage>743</lpage><pub-id pub-id-type="doi">10.1084/jem.126.4.727</pub-id><pub-id pub-id-type="pmid">4168100</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oprea</surname> <given-names>M</given-names></name><name><surname>Perelson</surname> <given-names>AS</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Somatic mutation leads to efficient affinity maturation when centrocytes recycle back to centroblasts</article-title><source>Journal of Immunology</source><volume>158</volume><fpage>5155</fpage><lpage>5162</lpage></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ovchinnikov</surname> <given-names>V</given-names></name><name><surname>Louveau</surname> <given-names>JE</given-names></name><name><surname>Barton</surname> <given-names>JP</given-names></name><name><surname>Karplus</surname> <given-names>M</given-names></name><name><surname>Chakraborty</surname> <given-names>AK</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Role of framework mutations and antibody flexibility in the evolution of broadly neutralizing antibodies</article-title><source>eLife</source><volume>7</volume><elocation-id>e33038</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.33038</pub-id><pub-id pub-id-type="pmid">29442996</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pulendran</surname> <given-names>B</given-names></name><name><surname>Kannourakis</surname> <given-names>G</given-names></name><name><surname>Nouri</surname> <given-names>S</given-names></name><name><surname>Smith</surname> <given-names>KG</given-names></name><name><surname>Nossal</surname> <given-names>GJ</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Soluble antigen can cause enhanced apoptosis of germinal-centre B cells</article-title><source>Nature</source><volume>375</volume><fpage>331</fpage><lpage>334</lpage><pub-id pub-id-type="doi">10.1038/375331a0</pub-id><pub-id pub-id-type="pmid">7753199</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rhodes</surname> <given-names>SJ</given-names></name><name><surname>Knight</surname> <given-names>GM</given-names></name><name><surname>Kirschner</surname> <given-names>DE</given-names></name><name><surname>White</surname> <given-names>RG</given-names></name><name><surname>Evans</surname> <given-names>TG</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Dose finding for new vaccines: the role for immunostimulation/immunodynamic modelling</article-title><source>Journal of Theoretical Biology</source><volume>465</volume><fpage>51</fpage><lpage>55</lpage><pub-id pub-id-type="doi">10.1016/j.jtbi.2019.01.017</pub-id><pub-id pub-id-type="pmid">30639297</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwarz</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1978">1978</year><article-title>Estimating the dimension of a model</article-title><source>The Annals of Statistics</source><volume>6</volume><fpage>461</fpage><lpage>464</lpage><pub-id pub-id-type="doi">10.1214/aos/1176344136</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwickert</surname> <given-names>TA</given-names></name><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Fooksman</surname> <given-names>DR</given-names></name><name><surname>Kamphorst</surname> <given-names>AO</given-names></name><name><surname>Mugnier</surname> <given-names>MR</given-names></name><name><surname>Gitlin</surname> <given-names>AD</given-names></name><name><surname>Dustin</surname> <given-names>ML</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>A dynamic T cell-limited checkpoint regulates affinity-dependent B cell entry into the germinal center</article-title><source>Journal of Experimental Medicine</source><volume>208</volume><fpage>1243</fpage><lpage>1252</lpage><pub-id pub-id-type="doi">10.1084/jem.20102477</pub-id><pub-id pub-id-type="pmid">21576382</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shaffer</surname> <given-names>JS</given-names></name><name><surname>Moore</surname> <given-names>PL</given-names></name><name><surname>Kardar</surname> <given-names>M</given-names></name><name><surname>Chakraborty</surname> <given-names>AK</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Optimal immunization cocktails can promote induction of broadly neutralizing abs against highly mutable pathogens</article-title><source>PNAS</source><volume>113</volume><fpage>E7039</fpage><lpage>E7048</lpage><pub-id pub-id-type="doi">10.1073/pnas.1614940113</pub-id><pub-id pub-id-type="pmid">27791170</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shinnakasu</surname> <given-names>R</given-names></name><name><surname>Inoue</surname> <given-names>T</given-names></name><name><surname>Kometani</surname> <given-names>K</given-names></name><name><surname>Moriyama</surname> <given-names>S</given-names></name><name><surname>Adachi</surname> <given-names>Y</given-names></name><name><surname>Nakayama</surname> <given-names>M</given-names></name><name><surname>Takahashi</surname> <given-names>Y</given-names></name><name><surname>Fukuyama</surname> <given-names>H</given-names></name><name><surname>Okada</surname> <given-names>T</given-names></name><name><surname>Kurosaki</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Regulated selection of germinal-center cells into the memory B cell compartment</article-title><source>Nature Immunology</source><volume>17</volume><fpage>861</fpage><lpage>869</lpage><pub-id pub-id-type="doi">10.1038/ni.3460</pub-id><pub-id pub-id-type="pmid">27158841</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shinnakasu</surname> <given-names>R</given-names></name><name><surname>Kurosaki</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Regulation of memory B and plasma cell differentiation</article-title><source>Current Opinion in Immunology</source><volume>45</volume><fpage>126</fpage><lpage>131</lpage><pub-id pub-id-type="doi">10.1016/j.coi.2017.03.003</pub-id><pub-id pub-id-type="pmid">28359033</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shokat</surname> <given-names>KM</given-names></name><name><surname>Goodnow</surname> <given-names>CC</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Antigen-induced B-cell death and elimination during germinal-centre immune responses</article-title><source>Nature</source><volume>375</volume><fpage>334</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1038/375334a0</pub-id><pub-id pub-id-type="pmid">7753200</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shulman</surname> <given-names>Z</given-names></name><name><surname>Gitlin</surname> <given-names>AD</given-names></name><name><surname>Weinstein</surname> <given-names>JS</given-names></name><name><surname>Lainez</surname> <given-names>B</given-names></name><name><surname>Esplugues</surname> <given-names>E</given-names></name><name><surname>Flavell</surname> <given-names>RA</given-names></name><name><surname>Craft</surname> <given-names>JE</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Dynamic signaling by T follicular helper cells during germinal center B cell selection</article-title><source>Science</source><volume>345</volume><fpage>1058</fpage><lpage>1062</lpage><pub-id pub-id-type="doi">10.1126/science.1257861</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Suan</surname> <given-names>D</given-names></name><name><surname>Sundling</surname> <given-names>C</given-names></name><name><surname>Brink</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Plasma cell and memory B cell differentiation from the germinal center</article-title><source>Current Opinion in Immunology</source><volume>45</volume><fpage>97</fpage><lpage>102</lpage><pub-id pub-id-type="doi">10.1016/j.coi.2017.03.006</pub-id><pub-id pub-id-type="pmid">28319733</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sugita</surname> <given-names>Y</given-names></name><name><surname>Okamoto</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Replica-exchange molecular dynamics method for protein folding</article-title><source>Chemical Physics Letters</source><volume>314</volume><fpage>141</fpage><lpage>151</lpage><pub-id pub-id-type="doi">10.1016/S0009-2614(99)01123-9</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Swendsen</surname> <given-names>RH</given-names></name><name><surname>Wang</surname> <given-names>JS</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>Replica monte carlo simulation of spin glasses</article-title><source>Physical Review Letters</source><volume>57</volume><fpage>2607</fpage><lpage>2609</lpage><pub-id pub-id-type="doi">10.1103/PhysRevLett.57.2607</pub-id><pub-id pub-id-type="pmid">10033814</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Takahashi</surname> <given-names>Y</given-names></name><name><surname>Dutta</surname> <given-names>PR</given-names></name><name><surname>Cerasoli</surname> <given-names>DM</given-names></name><name><surname>Kelsoe</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>In situ studies of the primary immune response to (4-hydroxy-3-nitrophenyl)acetyl. V. affinity maturation develops in two stages of clonal selection</article-title><source>Journal of Experimental Medicine</source><volume>187</volume><fpage>885</fpage><lpage>895</lpage><pub-id pub-id-type="doi">10.1084/jem.187.6.885</pub-id><pub-id pub-id-type="pmid">9500791</pub-id></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tam</surname> <given-names>HH</given-names></name><name><surname>Melo</surname> <given-names>MB</given-names></name><name><surname>Kang</surname> <given-names>M</given-names></name><name><surname>Pelet</surname> <given-names>JM</given-names></name><name><surname>Ruda</surname> <given-names>VM</given-names></name><name><surname>Foley</surname> <given-names>MH</given-names></name><name><surname>Hu</surname> <given-names>JK</given-names></name><name><surname>Kumari</surname> <given-names>S</given-names></name><name><surname>Crampton</surname> <given-names>J</given-names></name><name><surname>Baldeon</surname> <given-names>AD</given-names></name><name><surname>Sanders</surname> <given-names>RW</given-names></name><name><surname>Moore</surname> <given-names>JP</given-names></name><name><surname>Crotty</surname> <given-names>S</given-names></name><name><surname>Langer</surname> <given-names>R</given-names></name><name><surname>Anderson</surname> <given-names>DG</given-names></name><name><surname>Chakraborty</surname> <given-names>AK</given-names></name><name><surname>Irvine</surname> <given-names>DJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Sustained antigen availability during germinal center initiation enhances antibody responses to vaccination</article-title><source>PNAS</source><volume>113</volume><fpage>E6639</fpage><lpage>E6648</lpage><pub-id pub-id-type="doi">10.1073/pnas.1606050113</pub-id><pub-id pub-id-type="pmid">27702895</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tas</surname> <given-names>JM</given-names></name><name><surname>Mesin</surname> <given-names>L</given-names></name><name><surname>Pasqual</surname> <given-names>G</given-names></name><name><surname>Targ</surname> <given-names>S</given-names></name><name><surname>Jacobsen</surname> <given-names>JT</given-names></name><name><surname>Mano</surname> <given-names>YM</given-names></name><name><surname>Chen</surname> <given-names>CS</given-names></name><name><surname>Weill</surname> <given-names>JC</given-names></name><name><surname>Reynaud</surname> <given-names>CA</given-names></name><name><surname>Browne</surname> <given-names>EP</given-names></name><name><surname>Meyer-Hermann</surname> <given-names>M</given-names></name><name><surname>Victora</surname> <given-names>GD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Visualizing antibody affinity maturation in germinal centers</article-title><source>Science</source><volume>351</volume><fpage>1048</fpage><lpage>1054</lpage><pub-id pub-id-type="doi">10.1126/science.aad3439</pub-id><pub-id pub-id-type="pmid">26912368</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tew</surname> <given-names>JG</given-names></name><name><surname>Mandel</surname> <given-names>TE</given-names></name></person-group><year iso-8601-date="1979">1979</year><article-title>Prolonged antigen half-life in the lymphoid follicles of specifically immunized mice</article-title><source>Immunology</source><volume>37</volume><elocation-id>69</elocation-id><pub-id pub-id-type="pmid">468304</pub-id></element-citation></ref><ref id="bib82"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Schwickert</surname> <given-names>TA</given-names></name><name><surname>Fooksman</surname> <given-names>DR</given-names></name><name><surname>Kamphorst</surname> <given-names>AO</given-names></name><name><surname>Meyer-Hermann</surname> <given-names>M</given-names></name><name><surname>Dustin</surname> <given-names>ML</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Germinal center dynamics revealed by multiphoton microscopy with a photoactivatable fluorescent reporter</article-title><source>Cell</source><volume>143</volume><fpage>592</fpage><lpage>605</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2010.10.032</pub-id><pub-id pub-id-type="pmid">21074050</pub-id></element-citation></ref><ref id="bib83"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Mesin</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Clonal and cellular dynamics in germinal centers</article-title><source>Current Opinion in Immunology</source><volume>28</volume><fpage>90</fpage><lpage>96</lpage><pub-id pub-id-type="doi">10.1016/j.coi.2014.02.010</pub-id><pub-id pub-id-type="pmid">24681449</pub-id></element-citation></ref><ref id="bib84"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Mouquet</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>What are the primary limitations in B-Cell affinity maturation, and how much affinity maturation can we drive with vaccination?</article-title><source>Cold Spring Harbor Perspectives in Biology</source><volume>10</volume><elocation-id>a029389</elocation-id><pub-id pub-id-type="doi">10.1101/cshperspect.a029389</pub-id></element-citation></ref><ref id="bib85"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Victora</surname> <given-names>GD</given-names></name><name><surname>Nussenzweig</surname> <given-names>MC</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Germinal centers</article-title><source>Annual Review of Immunology</source><volume>30</volume><fpage>429</fpage><lpage>457</lpage><pub-id pub-id-type="doi">10.1146/annurev-immunol-020711-075032</pub-id><pub-id pub-id-type="pmid">22224772</pub-id></element-citation></ref><ref id="bib86"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>S</given-names></name><name><surname>Mata-Fink</surname> <given-names>J</given-names></name><name><surname>Kriegsman</surname> <given-names>B</given-names></name><name><surname>Hanson</surname> <given-names>M</given-names></name><name><surname>Irvine</surname> <given-names>DJ</given-names></name><name><surname>Eisen</surname> <given-names>HN</given-names></name><name><surname>Burton</surname> <given-names>DR</given-names></name><name><surname>Wittrup</surname> <given-names>KD</given-names></name><name><surname>Kardar</surname> <given-names>M</given-names></name><name><surname>Chakraborty</surname> <given-names>AK</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Manipulating the selection forces during affinity maturation to generate cross-reactive HIV antibodies</article-title><source>Cell</source><volume>160</volume><fpage>785</fpage><lpage>797</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.01.027</pub-id><pub-id pub-id-type="pmid">25662010</pub-id></element-citation></ref><ref id="bib87"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>P</given-names></name><name><surname>Shih</surname> <given-names>CM</given-names></name><name><surname>Qi</surname> <given-names>H</given-names></name><name><surname>Lan</surname> <given-names>YH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A stochastic model of the germinal center integrating local antigen competition, individualistic T-B interactions, and B cell receptor signaling</article-title><source>The Journal of Immunology</source><volume>197</volume><fpage>1169</fpage><lpage>1182</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.1600411</pub-id><pub-id pub-id-type="pmid">27421481</pub-id></element-citation></ref><ref id="bib88"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Optimal sequential immunization can focus antibody responses against diversity loss and distraction</article-title><source>PLOS Computational Biology</source><volume>13</volume><elocation-id>e1005336</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005336</pub-id><pub-id pub-id-type="pmid">28135270</pub-id></element-citation></ref><ref id="bib89"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weisel</surname> <given-names>FJ</given-names></name><name><surname>Zuccarino-Catania</surname> <given-names>GV</given-names></name><name><surname>Chikina</surname> <given-names>M</given-names></name><name><surname>Shlomchik</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A temporal switch in the germinal center determines differential output of memory B and plasma cells</article-title><source>Immunity</source><volume>44</volume><fpage>116</fpage><lpage>130</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2015.12.004</pub-id><pub-id pub-id-type="pmid">26795247</pub-id></element-citation></ref><ref id="bib90"><element-citation publication-type="journal"><person-group person-group-type="author"><collab>WHO</collab></person-group><year iso-8601-date="2017">2017</year><article-title>Tetanus vaccines: who position paper, February 2017 - Recommendations</article-title><source>Vaccine</source><volume>36</volume><elocation-id>2018</elocation-id><pub-id pub-id-type="doi">10.1016/j.vaccine.2017.02.034</pub-id></element-citation></ref><ref id="bib91"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wittenbrink</surname> <given-names>N</given-names></name><name><surname>Klein</surname> <given-names>A</given-names></name><name><surname>Weiser</surname> <given-names>AA</given-names></name><name><surname>Schuchhardt</surname> <given-names>J</given-names></name><name><surname>Or-Guil</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Is there a typical germinal center? A large-scale immunohistological study on the cellular composition of germinal centers during the hapten-carrier-driven primary immune response in mice</article-title><source>The Journal of Immunology</source><volume>187</volume><fpage>6185</fpage><lpage>6196</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.1101440</pub-id><pub-id pub-id-type="pmid">22102720</pub-id></element-citation></ref><ref id="bib92"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname> <given-names>R</given-names></name><name><surname>Bhattacharya</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Basics of memory B-cell responses: lessons from and for the real world</article-title><source>Immunology</source><volume>156</volume><fpage>120</fpage><lpage>129</lpage><pub-id pub-id-type="doi">10.1111/imm.13019</pub-id></element-citation></ref><ref id="bib93"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname> <given-names>Y</given-names></name><name><surname>Meyer-Hermann</surname> <given-names>M</given-names></name><name><surname>George</surname> <given-names>LA</given-names></name><name><surname>Figge</surname> <given-names>MT</given-names></name><name><surname>Khan</surname> <given-names>M</given-names></name><name><surname>Goodall</surname> <given-names>M</given-names></name><name><surname>Young</surname> <given-names>SP</given-names></name><name><surname>Reynolds</surname> <given-names>A</given-names></name><name><surname>Falciani</surname> <given-names>F</given-names></name><name><surname>Waisman</surname> <given-names>A</given-names></name><name><surname>Notley</surname> <given-names>CA</given-names></name><name><surname>Ehrenstein</surname> <given-names>MR</given-names></name><name><surname>Kosco-Vilbois</surname> <given-names>M</given-names></name><name><surname>Toellner</surname> <given-names>KM</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Germinal center B cells govern their own fate via antibody feedback</article-title><source>The Journal of Experimental Medicine</source><volume>210</volume><fpage>457</fpage><lpage>464</lpage><pub-id pub-id-type="doi">10.1084/jem.20120150</pub-id><pub-id pub-id-type="pmid">23420879</pub-id></element-citation></ref><ref id="bib94"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname> <given-names>J</given-names></name><name><surname>Shakhnovich</surname> <given-names>EI</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Optimality of mutation and selection in germinal centers</article-title><source>PLOS Computational Biology</source><volume>6</volume><elocation-id>e1000800</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1000800</pub-id><pub-id pub-id-type="pmid">20532164</pub-id></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><boxed-text><sec id="s8" sec-type="appendix"><title>1. Model definition and parameters choice</title><p>Mature GCs usually appear 5–7 days after Ag administration. During this time a population of up to hundreds different founder clones colonizes the GC and expands to a total size of a few thousand B-cells. The first mutations in the repertoire are observed around day 6 (<xref ref-type="bibr" rid="bib37">Jacob et al., 1993</xref>; <xref ref-type="bibr" rid="bib50">McHeyzer-Williams et al., 1993</xref>). Early GCs are highly polyclonal and contain 50 to 200 clones according to <xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>. In agreement with these experimental findings at the time of Ag injection we pick a population of <inline-formula><mml:math id="inf341"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>found</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mrow></mml:math></inline-formula> founder clones. The affinities of these clones are extracted independently from an initial gaussian distribution whose mean and variance are chosen via the maximum-likelihood procedure described in appendix sect. 4 ('Maximum likelihood fit procedure') and it matches the experimental distribution of germline responders (i.e. splenic IgG-SCs that are observed 1 day after boost of pure Ag, Appendix 1—figure 7 in scheme two and Ag dosage <inline-formula><mml:math id="inf342"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). During the time of GC formation the founder clones expand uniformly without mutating. We chose to start our simulation at <inline-formula><mml:math id="inf343"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mtext>GC</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> days after Ag injection. At this point, the GCs are almost fully formed (<xref ref-type="bibr" rid="bib15">De Silva and Klein, 2015</xref>). The simulation starts with the GC at its maximal size, set to <inline-formula><mml:math id="inf344"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mtext>max</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>2500</mml:mn></mml:mrow></mml:math></inline-formula> clones. The maximal size is in agreement with (<xref ref-type="bibr" rid="bib18">Eisen, 2014</xref>) which reports around 3000 cells per GC, or (<xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>) in which GCs are said to contain up to a few thousands B-cells. However, we stress that GCs are heterogeneous in size (<xref ref-type="bibr" rid="bib91">Wittenbrink et al., 2011</xref>).</p><p>From here the model proceeds in evolution rounds. Similarly to <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref> we set the duration of a round to <inline-formula><mml:math id="inf345"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>turn</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>12</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">h</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. This number is consistent with timing of cell migration (<xref ref-type="bibr" rid="bib82">Victora et al., 2010</xref>; <xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>). We neglect the fact that high affinity cells are found to dwell longer in the GC dark zone (<xref ref-type="bibr" rid="bib27">Gitlin et al., 2014</xref>) undergoing additional divisions. In addition to this the fact that the average cell-cycle time is 12 hr or longer (<xref ref-type="bibr" rid="bib4">Allen et al., 2007b</xref>) indicates that 12 hr is probably a lower limit for the round duration.</p><p>As described in the main text each round consists in cell division with somatic hypermutation, selection for Ag binding, selection for T-cell help and differentiation. In our simulations before starting the first round we perform only once differentiation. This is done in order to recover the good average energy limit at low Ag concentrations. In fact when Ag dosage is small the population quickly goes extinct, while at the same time maturating very fast. Performing differentiation first provides a nucleus of low-affinity germline-like clones whose binding energy controls the average binding energy of the MC population, even if few high-affinity clones are added later. Notice that this does not change the asymptotic behavior of the model, since it would be equivalent to simply changing the order of operations in the round.</p><p>Proceeding with the standard turn order then the first operation performed is cell division and somatic hypermutation. During a round we consider cells to divide twice (<xref ref-type="bibr" rid="bib53">Mesin et al., 2016</xref>). In GC dark zone cells up-regulate their expression of Activation-Induced Cytidine Deaminase. This enzyme increases the DNA mutation rate, inducing mutations in the region coding for the BCR and possibly changing the affinity for the Ag. Mutation rate has been estimated to an average of 10<sup>-3</sup> mutations per base pair per division (<xref ref-type="bibr" rid="bib52">McKean et al., 1984</xref>; <xref ref-type="bibr" rid="bib40">Kleinstein et al., 2003</xref>). Similarly to <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref> in which the total binding energy consisted in the sum of contributions from 46 different residues, we consider <inline-formula><mml:math id="inf346"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>res</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mrow></mml:math></inline-formula> residues to contribute to the binding energy. The probability that upon division at least a mutation occurs in any of the 150 bp coding for these residues can be estimated as <inline-formula><mml:math id="inf347"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>150</mml:mn></mml:msup></mml:mrow><mml:mo>∼</mml:mo><mml:mn>0.14</mml:mn></mml:mrow></mml:math></inline-formula>. As done in <xref ref-type="bibr" rid="bib86">Wang et al., 2015</xref>; <xref ref-type="bibr" rid="bib94">Zhang and Shakhnovich, 2010</xref>; <xref ref-type="bibr" rid="bib88">Wang, 2017</xref> at every division and for each daughter cell independently we consider a <inline-formula><mml:math id="inf348"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>sil</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>.5</mml:mn></mml:mrow></mml:math></inline-formula> probability of developing a silent mutation, in which case the binding energy of the daughter cell remains unchanged, a probability <inline-formula><mml:math id="inf349"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>let</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>.3</mml:mn></mml:mrow></mml:math></inline-formula> of undergoing a lethal mutation, in which case the cell is removed, and finally a probability <inline-formula><mml:math id="inf350"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>.2</mml:mn></mml:mrow></mml:math></inline-formula> of developing an affinity-affecting mutation. These change the binding energy of the daughter cell by adding a variation <inline-formula><mml:math id="inf351"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. As done in <xref ref-type="bibr" rid="bib88">Wang, 2017</xref> the variation follows a lognormal distribution <inline-formula><mml:math id="inf352"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1A</xref>)<disp-formula id="equ17"><label>(17)</label><mml:math id="m17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtext>Lognorm</mml:mtext><mml:mo stretchy="false">[</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>σ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>x</mml:mi><mml:mi>σ</mml:mi><mml:msqrt><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mi>x</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mi>x</mml:mi><mml:mo>≤</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ18"><label>(18)</label><mml:math id="m18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mtext>aa</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mtext>Lognorm</mml:mtext><mml:mo stretchy="false">[</mml:mo><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1.9</mml:mn><mml:mo>,</mml:mo><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><fig id="app1fig1" position="float"><label>Appendix 1—figure 1.</label><caption><title>Effect of affinity-affecting mutations, differentiation time-switch and survival probability.</title><p>(<bold>A</bold>) Plot of the affinity-affecting kernel <inline-formula><mml:math id="inf353"><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. Only around 5% of the affinity-affecting mutations increase affinity (green part of the curve for <inline-formula><mml:math id="inf354"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). (<bold>B</bold>) Probability of MC <inline-formula><mml:math id="inf355"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and PC <inline-formula><mml:math id="inf356"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> differentiation as a function of time from Ag injection (<inline-formula><mml:math id="inf357"><mml:mi>t</mml:mi></mml:math></inline-formula> in days). (<bold>C</bold>) Probability <inline-formula><mml:math id="inf358"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that a B-cell survives Ag-binding selection process as a function of its binding energy <inline-formula><mml:math id="inf359"><mml:mi>ϵ</mml:mi></mml:math></inline-formula>, see <xref ref-type="disp-formula" rid="equ19">Equation 19</xref>. On the x-axis we mark the threshold energy <inline-formula><mml:math id="inf360"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>. (D) Probability <inline-formula><mml:math id="inf361"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>T</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that a B-cell survives the T-cell selection process as a function of its binding energy <inline-formula><mml:math id="inf362"><mml:mi>ϵ</mml:mi></mml:math></inline-formula>, see <xref ref-type="disp-formula" rid="equ20">Equation 20</xref>. On the x-axis we mark the threshold binding energy <inline-formula><mml:math id="inf363"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula>, which depends on the binding energy distribution of the rest of the B-cell population, see <xref ref-type="disp-formula" rid="equ20">Equation 20</xref>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig1-v2.tif"/></fig><p>The parameters of the distribution are chosen so that only 5% of the mutations confer an increase in affinity, while the vast majority causes an affinity decrease. As a result of this process after the two mutations the population size increases almost 4-fold in size (two duplications but some cells are eliminated due to lethal mutations) and the average affinity decreases slightly due to the mainly negative effect of mutations (cf <xref ref-type="fig" rid="fig1">Figure 1</xref> main text, histograms 1 to 2).</p><p>After duplication we implement selection. In order to avoid apoptosis cells must bind and internalize a sufficient amount of Ag. The amount of Ag internalized depends both on the affinity of the BCR and on the availability of Ag on the surface of the FDC (<xref ref-type="bibr" rid="bib62">Nowosad et al., 2016</xref>; <xref ref-type="bibr" rid="bib41">Knežević et al., 2018</xref>; <xref ref-type="bibr" rid="bib9">Batista and Neuberger, 2000</xref>). We model this process by expressing the probability of survival of a cell with BCR having binding energy <inline-formula><mml:math id="inf364"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> as described in the main text:<disp-formula id="equ19"><label>(19)</label><mml:math id="m19"><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p>A sketch of this function is shown in <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1C</xref>. The value of the threshold binding energy has been obtained via maximum likelihood fit of the data, which yields for example <inline-formula><mml:math id="inf365"><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>13.59</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> for variant A. This selection is not in present variant C of the model.</p><p>At the second step of selection, the one leading maturation in our model, B-cells compete to receive a survival signal from T-cells. T-cells in GCs are motile and continuously scan the surface of B-cells, sensing for density of pMHC-II complexes (<xref ref-type="bibr" rid="bib74">Shulman et al., 2014</xref>). Cells with the highest pMHC-II density receive survival signal preferentially (<xref ref-type="bibr" rid="bib16">Depoil et al., 2005</xref>; <xref ref-type="bibr" rid="bib85">Victora and Nussenzweig, 2012</xref>). We again express the probability of survival through<disp-formula id="equ20"><label>(20)</label><mml:math id="m20"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mtext>T</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>a</mml:mi><mml:mo>-</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mpadded></mml:mrow></mml:mrow><mml:mo rspace="22.5pt">,</mml:mo><mml:mtext>with</mml:mtext></mml:mrow></mml:mrow><mml:mo mathvariant="italic" separator="true"> </mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mpadded width="+5pt"><mml:msub><mml:mrow><mml:mo stretchy="false">⟨</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:mpadded></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The parameters <inline-formula><mml:math id="inf366"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf367"><mml:mi>b</mml:mi></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ20">Equation 20</xref> represent, respectively, the probability of survival at very high energy and the deficit in probability of survival at very low binding energy. Their effect is better discussed in appendix section (Permissive and stochastic selection: effect of a, b parameters). The formula interpolates smoothly between these two values, as depicted in <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1D</xref>. The threshold binding energy <inline-formula><mml:math id="inf368"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> depends on the population’s binding energy distribution, introducing competition between the cells; the symbol <inline-formula><mml:math id="inf369"><mml:msub><mml:mrow><mml:mo stretchy="false">⟨</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>⁢</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> indicates the average of the quantity over the current GC population.</p><p>Cells that are able to survive selection can either re-enter the dark zone and start a new round of evolution or differentiate into Ab-producing PCs or quiescent MCs that can be reactivated upon future Ag injection. There is evidence that MC/PC output undergoes a temporal switch: MCs are preferentially produced early in the response (<xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref>). Moreover there seems to be an affinity bias in differentiation (<xref ref-type="bibr" rid="bib72">Shinnakasu and Kurosaki, 2017</xref>). Even though experiments show that affinity plays a role in deciding fate (<xref ref-type="bibr" rid="bib71">Shinnakasu et al., 2016</xref>) simply by implementing a time-switch in the MC/PC differentiation probability (respectively <inline-formula><mml:math id="inf370"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>MC</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf371"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>PC</mml:mtext></mml:msub></mml:math></inline-formula>, <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1B</xref>) we effectively recover both of these observations. The parameters of these functions (<inline-formula><mml:math id="inf372"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>11</mml:mn><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf373"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>) are chosen so as to be compatible with <xref ref-type="bibr" rid="bib89">Weisel et al., 2016</xref>:<disp-formula id="equ21"><label>(21)</label><mml:math id="m21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>MC</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ22"><label>(22)</label><mml:math id="m22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>PC</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Notice that the sum of the two is constant <inline-formula><mml:math id="inf374"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>MC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>PC</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>diff</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, compatible with seminal studies (<xref ref-type="bibr" rid="bib64">Oprea and Perelson, 1997</xref>) that estimated that around 90% of the cells recirculate in the dark zone. In the model we consider for simplicity a complete switch, meaning that for <inline-formula><mml:math id="inf375"><mml:mrow><mml:mi>t</mml:mi><mml:mo>≫</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> the probability of generating MCs decreases asymptotically to zero. In appendix section (Permissive and stochastic selection: effect of a, b parameters), we discuss the more realistic case of a partial switch, in which there is a residual probability of MC production even for <inline-formula><mml:math id="inf376"><mml:mrow><mml:mi>t</mml:mi><mml:mo>≫</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>.</p><p>If new Ag is administered, we consider a new GCR to start. The new GC is colonized partly by new B-cells coming from the naive pool and partly by reactivated MCs (<xref ref-type="bibr" rid="bib36">Inoue et al., 2018</xref>). We allow only MCs that have already been generated at time of the second injection to colonize the new GC. This is done by picking a set of <inline-formula><mml:math id="inf377"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>2500</mml:mn></mml:mrow></mml:math></inline-formula> cells from the naive pool, with binding energies extracted from the same initial Gaussian distribution, and adding to them all the MCs generated up to the time of second injection. The founder clones of the new GC will consist of <inline-formula><mml:math id="inf378"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mrow></mml:math></inline-formula> cells randomly extracted from this cumulative population. Notice that the probability of extracting a MC from the cumulative population is an increasing function of the number <inline-formula><mml:math id="inf379"><mml:msub><mml:mi>N</mml:mi><mml:mtext>MC</mml:mtext></mml:msub></mml:math></inline-formula> of MCs extracted at time of injection: <inline-formula><mml:math id="inf380"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>MC</mml:mtext></mml:msub><mml:mo>/</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mtext>MC</mml:mtext></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. In appendix sect. 12 we discuss instead the case in which the probability of extracting a seeder clone from the memory pool is set to a constant <inline-formula><mml:math id="inf381"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>0.3</mml:mn></mml:mrow></mml:math></inline-formula>.</p><p>The concentration of Ag evolves as explained in the main text according to the differential <xref ref-type="disp-formula" rid="equ5 equ6">Equations 5 and 6</xref> (main text). These equations account for Ag release, decay and consumption. The release rate was evaluated considering a half-life of 17 hr for Ag in CFA (<xref ref-type="bibr" rid="bib48">MacLean et al., 2001</xref>), which gives a value for the release rate of <inline-formula><mml:math id="inf382"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mn>0.98</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. Ag on FDCs can be maintained for a long time, up to a year (<xref ref-type="bibr" rid="bib33">Heesters et al., 2014</xref>), through a mechanism of endocytosis and recycling of immune complexes (<xref ref-type="bibr" rid="bib32">Heesters et al., 2013</xref>). To reproduce this long clearance time, we take Ag lifetime to be 8.1 weeks, as measured in popliteal lymph nodes of mice (<xref ref-type="bibr" rid="bib81">Tew and Mandel, 1979</xref>). This results in a Ag decay rate of <inline-formula><mml:math id="inf383"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>∅</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mn>0.012</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The case of a faster Ag-decay is discussed in appendix sect. 6 ('Possible model variations'). Finally, the consumption rate per B-cell <inline-formula><mml:math id="inf384"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>2.07</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> (variant C, see main text) is obtained via the maximum likelihood fit procedure described in appendix sect. 4 ('Maximum likelihood fit procedure'). This quantity controls both the GC lifetime and the extent of AM at the end of evolution. For the range of Ag dosages considered simulated GCs have an effective lifetime that vary between 1 or 2 weeks and 3 months (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2E</xref>), compatible with lifetimes of real GCs (<xref ref-type="bibr" rid="bib84">Victora and Mouquet, 2018</xref>). <xref ref-type="disp-formula" rid="equ5 equ6">Equations 5 and 6</xref> (main text) are continuous in time. To include them in our discrete timestep model, we perform an update of the values of the reservoir and available concentrations <inline-formula><mml:math id="inf385"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mtext>av</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf386"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mtext>res</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at each round <inline-formula><mml:math id="inf387"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> after selection for T-cell help and before differentiation. The Ag removal rate is given by the cumulative effect of decay and consumption: <inline-formula><mml:math id="inf388"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mi>t</mml:mi><mml:mo>-</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mi mathvariant="normal">∅</mml:mi><mml:mo>-</mml:mo></mml:msubsup><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msubsup><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, and changes at each evolution round due to its dependence on the number of B-cells <inline-formula><mml:math id="inf389"><mml:msubsup><mml:mi>N</mml:mi><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula> at this stage of the round. The values of the concentrations at the next round <inline-formula><mml:math id="inf390"><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> are obtained by evolving the corresponding quantities at round <inline-formula><mml:math id="inf391"><mml:mi>t</mml:mi></mml:math></inline-formula> for a time <inline-formula><mml:math id="inf392"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>12</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">h</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> equivalent to the duration of the round:<disp-formula id="equ23"><label>(23)</label><mml:math id="m23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thinmathspace"/><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ24"><label>(24)</label><mml:math id="m24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>av</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>av</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thinmathspace"/><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thinmathspace"/><mml:mfrac><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mspace width="thinmathspace"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><fig id="app1fig2" position="float"><label>Appendix 1—figure 2.</label><caption><title>Deterministic and stochastic evoliution comparison.</title><p>(<bold>A to D</bold>) Comparison between average evolution of the system and prediction of our deterministic model. The average is performed over 1000 independent GCR simulations at injected dosage of Ag <inline-formula><mml:math id="inf393"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The black dashed line corresponds to the average stochastic trajectory, the shaded blue area covers one standard deviation from the trajectory mean, and the orange lines correspond to the prediction of the deterministic model. Number of GC B-cells (<bold>A</bold>) and average energy of GC B-cells (<bold>C</bold>), MCs (<bold>B</bold>) and PCs (<bold>D</bold>) as a function of time from Ag injection. (<bold>E</bold>) Average lifetime and effective lifetime of GCs as a function of administered Ag dosage. The latter corresponds to the time at which the GC decays to 1% of its initial size. We compare the average over 1000 stochastic simulations (blue and green plots, shaded area corresponds to one standard deviation from the mean) to the theoretical prediction (orange and red lines). Due to finite-size effects, the theory in general slightly underestimates the lifetime of the GC.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig2-v2.tif"/></fig><p>At times smaller than the GC formation time <inline-formula><mml:math id="inf394"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>GC</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>6</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> we do not account for GC evolution but we account for the evolution of concentration. This is done as in the previous equations but in this case the total consumption rate is evaluated considering an exponentially increasing number of cells, that starting from one at injection exponentially grows to <inline-formula><mml:math id="inf395"><mml:msub><mml:mi>N</mml:mi><mml:mtext>max</mml:mtext></mml:msub></mml:math></inline-formula> at the time of GC formation. In particular concentration update at the end of round <inline-formula><mml:math id="inf396"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mn>11</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> is done considering the following number of B-cells consuming Ag:<disp-formula id="equ25"><label>(25)</label><mml:math id="m25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>×</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>turn</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>GC</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mspace width="1em"/><mml:mtext> for</mml:mtext><mml:mspace width="1em"/><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>12</mml:mn><mml:mo>=</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>GC</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mtext>turn</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In our simulations, GC evolution stops either naturally when Ag depletion leads to population extinction, or when the total simulation time is elapsed and cells are harvested, in which case the simulation is stopped irrespective of the population size and only cells produced up to that point are considered. The total simulation time depends on the immunization scheme considered and is set to match the time elapsed between injection and experimental measurement.</p></sec><sec id="s9" sec-type="appendix"><title>2. Stochastic model analysis</title><p>In order to have some insight on the way our stochastic model evolves and to gauge the magnitude of stochastic effects in <xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2A to D</xref> we report the average evolution of 1000 independent GC Reaction (GCR) simulations, performed at an injected Ag dosage of <inline-formula><mml:math id="inf397"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The average trajectory is reported as a black dashed line and shaded area covers one standard deviation around the mean. Increase of noise in the average binding energy of GC B-cells as a function of time is due to the fact that at each time the average is performed only over the surviving GCs, thus as progressively GCRs end the average becomes more noisy (and also becomes biased to represent only surviving trajectories). We compare the evolution of the stochastic model with the theoretical prediction (orangle lines). As observed in the main text the theoretical prediction performs well at high population size, and loses accuracy for small population sizes (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2A, C</xref>). However, since most of the MC and PC population is generated at time of high population expansion the average energy of these two populations is always well estimated (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2B, D</xref>). The inaccuracy at small population sizes comes mainly from an overestimation of the selection pressure in our theoretical solution. In fact, the threshold binding energy for T-cell selection <inline-formula><mml:math id="inf398"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> (cf appendix <xref ref-type="disp-formula" rid="equ20">Equation 20</xref>) is sensitive to the high-affinity tail of the population affinity distribution. As the population size diminishes this tail gets progressively less populated and the value of <inline-formula><mml:math id="inf399"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> deviates from its theoretical prediction, evaluated under the infinite-size limit. This slight decrease of selection pressure at the end of the GC lifetime increases slightly the survival time and generates a slight slow-down in maturation. Moreover, in order to estimate the lifetime of GCs in our model we evaluate average and standard deviation of lifetimes of 1000 independent GC simulations for different values of injected Ag dosage. Since in the simulations GCs can also have a more or less long period of small population size prior to extinction (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2A</xref>) we also evaluate an ‘effective’ lifetime, considering the GC effectively extinguished when its size reaches 1% of its original size. These lifetimes (<xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2E</xref>) depend on the amount of Ag administered and can vary between few weeks to few months. The same overestimation of the selection pressure at small population sizes leads the theory to slightly underestimate the lifetime of stochastic simulations.</p><p>Recent experiments estimated the number of different clones in early GC to be between 50 and 200 (<xref ref-type="bibr" rid="bib80">Tas et al., 2016</xref>). In our stochastic model, we consider the population of founder clones to be composed of 100 cells. The limited number of founders controls the diversity of the initial population and increases the stochasticity in evolution. However, it does not strongly influence the average outcome. To verify this we compare 1000 stochastic simulations of the standard model (single Ag injection of <inline-formula><mml:math id="inf400"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> of Ag, model scenario C) with a modified version in which the number of founder clones was set equal to the number of cells in the initial population (2500 cells). Results are reported in <xref ref-type="fig" rid="app1fig3">Appendix 1—figure 3A to D</xref>. We observe that limiting the initial population diversity increases stochasticity in evolution, but does not impact much the average evolution trajectory and outcome. This is especially evident when observing MC/PC population evolution (panels B and D). The final average binding energies of these populations are very similar, but the standard deviation around the mean is halved in for the initial population with more founders.</p><fig id="app1fig3" position="float"><label>Appendix 1—figure 3.</label><caption><title>Influence of number and affinity of founder clones on evolution stochasticity.</title><p>(<bold>A to D</bold>) Effect of increasing the number of founder clones in the population. We compare 1000 stochastic simulations of the standard version of the model (blue) with a modified version in which every cell in the initial population (2500 cells total) originates from a different founder clone, and has therefore a different affinity (orange). Solid lines represent average trajectories and the shaded area covers one standard deviation from the mean. The plots represent the number of GC B-cell (<bold>A</bold>), their average binding energy (<bold>C</bold>), and the average binding energy of MC (<bold>B</bold>) and PC (<bold>D</bold>) population as a function of time from Ag injection. (<bold>E</bold> to <bold>H</bold>) Stochastic contribution of the initial founder clones population. We compare 1000 stochastic simulations of the standard version of the model (blue) with a modified version in which GCs are initialzied with the same 100 founder clones (orange). We observe that the initial choice of founder clones plays an important role in evolution and explains most of the variation observed in the outcome. Figures E to H display the same quantities as A to D.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig3-v2.tif"/></fig><p>This observation raises the question of how much the outcome of evolution is controlled by the particular initial choice of the founder clones. In <xref ref-type="fig" rid="app1fig3">Appendix 1—figure 3E to H</xref> we quantify this by comparing 1000 stochastic GC evolutions of the standard model (injected Ag dosage <inline-formula><mml:math id="inf401"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, model scenario C), in which the founder population was re-extracted every time, with a modified version in which the founder population was kept the same amongst all stochastic trials. In the latter case, we observe a considerable reduction in stochasticity, indicating that the outcome depends strongly on the initial founder clones choice. This is also in line with the observations made in section 'Maturation induces progressive loss of clonality' and <xref ref-type="fig" rid="fig3">Figure 3D</xref> (main text), where we show that the presence of a high-affinity founder clones correlates with a stronger homogenizing selection.</p></sec><sec id="s10" sec-type="appendix"><title>3. Theoretical solution and eigenvalue equation</title><p>As described in the main text the theoretical solution of the model is obtained by performing the limit of infinite size <inline-formula><mml:math id="inf402"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>→</mml:mo><mml:mi mathvariant="normal">∞</mml:mi></mml:mrow></mml:math></inline-formula>, upon which the evolution of the system becomes deterministic. All the stochastic processes can be implemented via an operator, whose explicit expression is provided in Materials and methods, and which acts on the distribution <inline-formula><mml:math id="inf403"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This function is the product between the binding energy distribution of the population and the population size. In this formalism, the total evolution operator is a combination of the duplication and mutation, selection, normalization and differentiation operators: <inline-formula><mml:math id="inf404"><mml:mrow><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐃</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐍</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>T</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, where the operator <inline-formula><mml:math id="inf405"><mml:mrow><mml:mi mathvariant="bold">𝐑</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐀</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐀</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> encodes for two rounds of duplication with mutation. The mutation operator <inline-formula><mml:math id="inf406"><mml:mi mathvariant="bold">𝐌</mml:mi></mml:math></inline-formula> in particular consists in a convolution of the distribution <inline-formula><mml:math id="inf407"><mml:mi>ρ</mml:mi></mml:math></inline-formula> with a mutation kernel <inline-formula><mml:math id="inf408"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>eff</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> lethal, silent and affinity-affecting nature of the mutations. This kernel is defined as follows:<disp-formula id="equ26"><label>(26)</label><mml:math id="m26"><mml:mrow><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>eff</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>aa</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>s</mml:mtext></mml:msub></mml:mrow></mml:mrow><mml:mo rspace="5.3pt" stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>The first term corresponds to affinity-affecting mutations, whose probability is the product between the probability of developing a mutation and the probability for this mutation to be affinity-affecting <inline-formula><mml:math id="inf409"><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>aa</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>. The expression for the affinity-affecting mutation probability <inline-formula><mml:math id="inf410"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mtext>aa</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the one in <xref ref-type="disp-formula" rid="equ18">Equation 18</xref>. The second term encodes silent mutations, occurring with probability <inline-formula><mml:math id="inf411"><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>s</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>, and also absence of mutations, with probability <inline-formula><mml:math id="inf412"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>. Lethal mutations occurs with probability <inline-formula><mml:math id="inf413"><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>l</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> but since their effect is the removal of cells in the population this contribution is multiplied by zero and is not present in the kernel expression. The contribution of lethal mutation makes so that the normalization of this kernel is not unitary: <inline-formula><mml:math id="inf414"><mml:mrow><mml:mrow><mml:mo largeop="true" symmetric="true">∫</mml:mo><mml:mrow><mml:mrow><mml:mo>𝑑</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:mi>ϵ</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mtext>eff</mml:mtext></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:msub><mml:mi>p</mml:mi><mml:mtext>mut</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>l</mml:mtext></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. In the main text, we show how under constant Ag concentration the affinity distribution of the population behaves as a traveling wave whose velocity and growth rate can be found via an eigenvalue equation. This eigenvalue equation reads <inline-formula><mml:math id="inf415"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf416"><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the translation operator that shifts the distribution of a value <inline-formula><mml:math id="inf417"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and we consider the restricted evolution operator <inline-formula><mml:math id="inf418"><mml:mrow><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi mathvariant="bold">𝐃</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mpadded width="+1.7pt"><mml:msub><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mtext>T</mml:mtext></mml:msub></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐑</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>.</p><p>To verify the correctness of our eigenvalue equation theoretical prediction, we solve the eigenvalue problem at a given Ag concentration <inline-formula><mml:math id="inf419"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, graphically illustrating the procedure, and show that the theoretical prediction matches the asymptotic behavior of the system. As a first step we set the value of <inline-formula><mml:math id="inf420"><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> in the T-cell help selection operator. This choice constitutes simply a gauge-fixing that removes the translational invariance of our solution, and it also linearizes the evolution operator. Since we do not a priori know the value of the shift <inline-formula><mml:math id="inf421"><mml:mi mathvariant="normal">Δ</mml:mi></mml:math></inline-formula> we solve the eigenvalue equation <inline-formula><mml:math id="inf422"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> for different values of the shift. In <xref ref-type="fig" rid="app1fig4">Appendix 1—figure 4</xref> we plot the maximum eigenvalue eigenvectors (distributions in A, color encodes the value of <inline-formula><mml:math id="inf423"><mml:mi mathvariant="normal">Δ</mml:mi></mml:math></inline-formula>) and their corresponding log-eigenvalues (C, representing the growth rate) as a function of the shift <inline-formula><mml:math id="inf424"><mml:mi mathvariant="normal">Δ</mml:mi></mml:math></inline-formula>. In order for our solution to be consistent it must satisfy the condition <inline-formula><mml:math id="inf425"><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. Therefore we evaluate <inline-formula><mml:math id="inf426"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> after performing mutations for all the solutions at varying values of the shift (<xref ref-type="fig" rid="app1fig4">Appendix 1—figure 4B</xref>) and we pick the one (<inline-formula><mml:math id="inf427"><mml:msup><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula>) for which this condition is satisfied as the eigenproblem solution. Upon repeated application of the restricted evolution operator we expect the population to asymptotically grow and shift at the values of <inline-formula><mml:math id="inf428"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> and <inline-formula><mml:math id="inf429"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> corresponding to this solution. In <xref ref-type="fig" rid="app1fig4">Appendix 1—figure 4D</xref>, we verify this by plotting the evolution of the normalized affinity distribution of the population, re-shifted on its mean, upon repeated application of the evolution operator, and compare it with the eigenproblem solution (black dashed lines). Moreover, in E and F we compare the instantaneous growth rate and energy shift with the eigenproblem solution predictions. Color in the three plots encodes to the evolution round. We observe that in all three cases the asymptotic prediction is matched.</p><fig id="app1fig4" position="float"><label>Appendix 1—figure 4.</label><caption><title>Asymptotic evolution matches the solution of the eigenvalue equation.</title><p>We check that upon repetition of the evolution operator the system converges at the eigenvalue equation solution. For a given constant Ag concentration (<inline-formula><mml:math id="inf430"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> in our case) we solve the eigenvalue equation <inline-formula><mml:math id="inf431"><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mi>ϕ</mml:mi></mml:msup><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐄</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> for various values of the shift <inline-formula><mml:math id="inf432"><mml:mi mathvariant="normal">Δ</mml:mi></mml:math></inline-formula>. In A we report the maximum eigenvalue eigenfunctions. By virtue of the Perron-Frobenius theorem these consist of only positive values. Color represent the value of the shift <inline-formula><mml:math id="inf433"><mml:mi mathvariant="normal">Δ</mml:mi></mml:math></inline-formula> for the corresponding solution. In B and C, we plot the value of <inline-formula><mml:math id="inf434"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> after mutation and of the growth rate <inline-formula><mml:math id="inf435"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> for every solution. The consistency condition requires us to pick the eigenfunction for whom the value of <inline-formula><mml:math id="inf436"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> after mutation is zero. This corresponds to the value <inline-formula><mml:math id="inf437"><mml:msup><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> represented in vertical red dashed line and the value of the growth rate <inline-formula><mml:math id="inf438"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> in horizontal green dashed line. In panels D, E, F, we consider repeated application of the evolution operator to the binding energy distribution at constant Ag concentration <inline-formula><mml:math id="inf439"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>. Color encodes the number of applications of this operator. In D and E, we report respectively the growth rate and shift of the mean per evolution turn, and in F the full distribution of binding energies, normalized to the population size. All the quantities converge to their theoretical expectation given by the chosen solution of the eigenvalue equation, reported as green and red dashed lines.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig4-v2.tif"/></fig><p>To numerically solve the eigenvalue equation and obtain the results displayed in <xref ref-type="fig" rid="app1fig4">Appendix 1—figure 4</xref>, operators were implemented as square matrices by discretizing the interval of energy <inline-formula><mml:math id="inf440"><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>20</mml:mn></mml:mrow><mml:mo rspace="4.2pt" stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> with a discretization step of <inline-formula><mml:math id="inf441"><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.002</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>. The maximum eigenvalue and corresponding eigenvector were obtained by repeated application of the restricted evolution and shift operators on an initially normal distribution with zero mean and unit variance. The application was repeated until the L1 distance between the normalized distributions before and after application of the operator was less than 10<sup>-5</sup>. This numerical procedure however is computationally expensive, since solving the eigenproblem for a particular value of the Ag concentration <inline-formula><mml:math id="inf442"><mml:mi>C</mml:mi></mml:math></inline-formula> requires the creation and repeated application of large matrices for many values of the shift <inline-formula><mml:math id="inf443"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. A less demanding numerical method to obtain the value of μ and <inline-formula><mml:math id="inf444"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> consists in simply simulating the evolution of the population under constant Ag concentration <inline-formula><mml:math id="inf445"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and without carrying capacity constraint and Ag-binding selection, until convergence to the asymptotic travelling-wave state is reached with sufficient precision. This second technique was used to evaluate the values of <inline-formula><mml:math id="inf446"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf447"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> displayed in <xref ref-type="fig" rid="fig4">Figure 4B</xref>. In this case, the simulation domain was set to the interval <inline-formula><mml:math id="inf448"><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>100</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mn>50</mml:mn><mml:mo rspace="5.3pt" stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>, with a discretization step of <inline-formula><mml:math id="inf449"><mml:mrow><mml:mpadded width="+2.8pt"><mml:mn>0.01</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>. Evolution of the distribution of binding energies was repeated until the following three conditions were met at the same time. First, the L1 distance between the normalized distributions before and after evolution, once they were re-centered around their mean, was less than 5 × 10<sup>-5</sup>. Second, the relative change of the growth rate and wave speed between two rounds of evolution was less than 5 × 10<sup>-5</sup>. Finally, as a safety check we also require that at the moment of convergence the mean of the distribution is more than five standard deviations away from the boundaries of the simulation domain.</p></sec><sec id="s11" sec-type="appendix"><title>4. Maximum likelihood fit procedure</title><p>Nine model parameters <inline-formula><mml:math id="inf450"><mml:mi mathvariant="bold">𝐩</mml:mi></mml:math></inline-formula> = (<inline-formula><mml:math id="inf451"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf452"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf453"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf454"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="inf455"><mml:mi>α</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf456"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf457"><mml:mi>b</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf458"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf459"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>) were inferred via the maximum likelihood procedure described in Materials and methods. This procedure makes use of the full experimental affinity distribution. Here, we give a more detailed description of the procedure and add considerations on the variation range of the parameters.</p><p>The stochastic maximization procedure is based on an implementation of the <italic>Parallel Tempering</italic> technique. This technique, used in the context of molecular dynamics simulations (<xref ref-type="bibr" rid="bib76">Sugita and Okamoto, 1999</xref>), consists in simulating different copies of a system at different temperatures, and then allowing the copies to exchange their states with adequate probabilities so that low-energy states are correctly sampled at low temperatures. This is particularly advantageous when the energy landscape is rugged, and low-temperature simulations tend to get stuck in local energy minima, while high-temperature simulation explore the whole space without being able to locate the minima precisely. Allowing for state-exchange between different temperature simulations makes so that high-temperature simulations can help low-temperature ones exit local minima in the energy space and converge to the global optimum, <xref ref-type="fig" rid="app1fig5">Appendix 1—figure 5A</xref>.</p><fig id="app1fig5" position="float"><label>Appendix 1—figure 5.</label><caption><title>Parallel tempering helps exiting local minima in stochastic likelihood maximization.</title><p><bold>A</bold>: intuitive representation of the advantage of Parallel Tempering. When a Monte Carlo simulation is run at low temperature (<inline-formula><mml:math id="inf460"><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math></inline-formula>) the system reaches a low-energy state but can get stuck in local energy minima. Conversely at high temperature (<inline-formula><mml:math id="inf461"><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></inline-formula>) the system is free to explore a larger portion of the space, but is unable to localize the energy minimum. By allowing the states to exchange their temperature when favorable, the high temperature simulation can help the low temperature simulation exit from a local minimum trap and converge to the global energy minimum. <bold>B</bold>: Simulation trajectories in energy space as a function of the simulation round for inference on variant C of the model. The energy difference is defined as <inline-formula><mml:math id="inf462"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf463"><mml:msub><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:math></inline-formula> is the maximum likelihood recovered by the inference algorithm. Colors encode different temperatures according to the colorbar on the right. Grey dots mark points in which trajectories exchange temperatures. To display both large variations and values equal to zero the energy scale is logarithmic for values of <inline-formula><mml:math id="inf464"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and linear for energies <inline-formula><mml:math id="inf465"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig5-v2.tif"/></fig><p>Here, we consider the space of all possible values of the parameters as our configuration space, and use the log-likelihood (see Materials and methods for definition) as a proxy for minus the energy. Our algorithm can be summarized as follows. A number <inline-formula><mml:math id="inf466"><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> of copies of the parameter set is initialized, and at each copy is assigned a simulation temperature <inline-formula><mml:math id="inf467"><mml:mi>T</mml:mi></mml:math></inline-formula> logarithmically evenly spaced between 10<sup>3</sup> and 10<sup>-3</sup>. The maximization procedure consists in 10,000 rounds of iterative parameter changes and temperature exchanges. For each proposed parameter change, the likelihood difference <inline-formula><mml:math id="inf468"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> between the new and the original set of parameters is evaluated, and the change is accepted with probability <inline-formula><mml:math id="inf469"><mml:mrow><mml:mi>min</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mo>/</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf470"><mml:mi>T</mml:mi></mml:math></inline-formula> is the temperature associated to the parameter set. In the exchange phase the difference in log-likelihood <inline-formula><mml:math id="inf471"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and in inverse temperature <inline-formula><mml:math id="inf472"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>β</mml:mi></mml:mrow></mml:math></inline-formula> is evaluated for any two parameters sets with consecutive temperatures. An exchange of the two parameters sets is then performed with probability <inline-formula><mml:math id="inf473"><mml:mrow><mml:mi>min</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:mi>β</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. At the end of the last round the value of the parameters <inline-formula><mml:math id="inf474"><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mtext>best</mml:mtext></mml:msub></mml:math></inline-formula> that maximized the likelihood is returned. In <xref ref-type="fig" rid="app1fig5">Appendix 1—figure 5B</xref> we report the trajectories in energy space of all the parameter sets for the inference performed using variant C of selection (see main text), in which eight parameters are inferred (all but the threshold binding energy <inline-formula><mml:math id="inf475"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>, which is removed in this variant). The energy for each parameter set is evaluated from the difference in log-likelihood with the best value, <inline-formula><mml:math id="inf476"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mtext>best</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. Notice how trajectories at high temperature explore the space by being able to visit low-likelihood (high-energy) zones of the parameter space. Conversely, low-temperature trajectories gradually converge to the value of the parameters that maximizes the likelihood.</p><p>The likelihood-maximization procedure is algorithmically described by the following pseudocode:</p><table-wrap id="inlinetable1" position="anchor"><table frame="hsides" rules="groups"><tbody><tr valign="top"><td><bold>Algorithm</bold>: Stochastic likelihood maximization procedure</td></tr><tr valign="top"><td>Given the initial parameters choice <inline-formula><mml:math id="inf477"><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi mathvariant="bold">𝐢𝐧𝐢𝐭</mml:mi></mml:msub></mml:math></inline-formula>; <break/>Initialize 10 copies of the system with parameter value <inline-formula><mml:math id="inf478"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi mathvariant="bold">𝐢𝐧𝐢𝐭</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="inf479"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>⁢</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>; <break/>Set the simulation temperature of each copy of the system at <inline-formula><mml:math id="inf480"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>11</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, so that <inline-formula><mml:math id="inf481"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf482"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mn>10</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>; <break/><bold>for</bold> <inline-formula><mml:math id="inf483"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> <bold>to</bold> 10'000 <bold>do:</bold> <break/>     <bold>for</bold> <inline-formula><mml:math id="inf484"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> <bold>to</bold> 10 <bold>do:</bold> <break/>          Generate a new randomly mutated parameter set <inline-formula><mml:math id="inf485"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> <break/>          according to the rule specified in the text; <break/>          Evaluate the log-likelihood difference induced by <break/>          the new set of parameters <inline-formula><mml:math id="inf486"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> ; <break/>          With probability <inline-formula><mml:math id="inf487"><mml:mrow><mml:mi>min</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> accept <inline-formula><mml:math id="inf488"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">←</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> or else keep <inline-formula><mml:math id="inf489"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">←</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> ; for <break/>     <bold>for</bold> <inline-formula><mml:math id="inf490"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> <bold>to</bold> 9 <bold>do</bold> <break/>          Evaluate the likelihood difference <inline-formula><mml:math id="inf491"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> between <break/>          two adjacent copies of the model; <break/>          Evaluate the inverse temperature difference <inline-formula><mml:math id="inf492"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>β</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>; <break/>          With probability <inline-formula><mml:math id="inf493"><mml:mrow><mml:mi>min</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mpadded width="+2.8pt"><mml:mi>β</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> perform the state exchange <inline-formula><mml:math id="inf494"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>↔</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>; <break/>Find <inline-formula><mml:math id="inf495"><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>t</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>arg</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mi>max</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>; <break/><bold>return</bold> <inline-formula><mml:math id="inf496"><mml:mrow><mml:msub><mml:mi mathvariant="bold">𝐩</mml:mi><mml:mtext>best</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐩</mml:mi><mml:msup><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:msup><mml:mi>t</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math></inline-formula></td></tr></tbody></table></table-wrap><p>Where the initial parameters choice was set to <inline-formula><mml:math id="inf497"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold">p</mml:mi><mml:mrow><mml:mi mathvariant="bold">i</mml:mi><mml:mi mathvariant="bold">n</mml:mi><mml:mi mathvariant="bold">i</mml:mi><mml:mi mathvariant="bold">t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>naive</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>14.6</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf498"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.6</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf499"><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>13.6</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf500"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf501"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.025</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf502"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf503"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Single parameter changes are generated as a function of noise level <inline-formula><mml:math id="inf504"><mml:mi>η</mml:mi></mml:math></inline-formula>:</p><list list-type="bullet"><list-item><p>For <inline-formula><mml:math id="inf505"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf506"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> variation is performed by adding a random number extracted with uniform probability in the interval <inline-formula><mml:math id="inf507"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>10</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>η</mml:mi></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>10</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>η</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>For positive parameters <inline-formula><mml:math id="inf508"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf509"><mml:mi>α</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf510"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula> the variation is performed multiplicatively by introducing a percentage change of the parameter uniformly extracted in the interval <inline-formula><mml:math id="inf511"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>η</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>η</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>For the fractions <inline-formula><mml:math id="inf512"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf513"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf514"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf515"><mml:mi>b</mml:mi></mml:math></inline-formula> variations are performed by adding a random number uniformly extracted in the interval <inline-formula><mml:math id="inf516"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mi>η</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mo>+</mml:mo><mml:mi>η</mml:mi></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. After the addition some constraints are enforced: the resulting number is constrained in the interval [0, 1], and as a consequence of the definition of the survival probability (<xref ref-type="disp-formula" rid="equ19 equ20">Equations 19, 20</xref>) also <inline-formula><mml:math id="inf517"><mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>+</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> is imposed.</p></list-item></list><p>We set the noise level to depend on the temperature of the system considered, so that higher-temperature simulations also have a higher level of noise, allowing them a faster exploration of the parameter space, while low temperature simulation will perform only a fine-tuning of the parameters. This allows for a more precise convergence. In particular we set <inline-formula><mml:math id="inf518"><mml:mi>η</mml:mi></mml:math></inline-formula> to be logarithmically evenly spaced between 10<sup>-2</sup> and 10<sup>-1</sup>. Furthermore we propose changes for all the parameters for the four higher-temperature simulations, while changes affect only one randomly chosen parameter for the four lower-temperature simulations.</p><p>In <xref ref-type="fig" rid="app1fig6">Appendix 1—figure 6</xref>, we display the evolution of the parameter set that reaches the highest log-likelihood during the maximization procedure. In <xref ref-type="fig" rid="app1fig6">Appendix 1—figure 6A</xref> we report the log-likelihood and the temperature as a function of the round of maximization. Notice how high-temperature states correlate with big fluctuations in the log-likelyhood and in the values of parameters. The peak likelihood value is reached at round 9970, when the trajectory was at the lowest temperature. In <xref ref-type="fig" rid="app1fig6">Appendix 1—figure 6B</xref> we report the evolution of the nine parameters during the maximization rounds. Orange shaded area cover one standard deviation of the posterior distribution around the maximum-likelihood estimate (MLE) of the parameters. This was obtained by approximating the posterior with a Gaussian distribution around the ML value, with a quadratic fit of the log-likelihood variation <inline-formula><mml:math id="inf519"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> generated by small variations (±5%) of single parameters around the MLE (<xref ref-type="fig" rid="app1fig6">Appendix 1—figure 6C</xref>).</p><fig id="app1fig6" position="float"><label>Appendix 1—figure 6.</label><caption><title>Convergence of the stochastic likelihood maximization procedure for variant C of the model (see main text).</title><p>In this variant 8 of the model parameters are inferred (<inline-formula><mml:math id="inf520"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf521"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf522"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="inf523"><mml:mi>α</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf524"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf525"><mml:mi>b</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf526"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf527"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>). (<bold>A</bold>) Values of the log-likelihood <inline-formula><mml:math id="inf528"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:math></inline-formula> and the temperature <inline-formula><mml:math id="inf529"><mml:mi>T</mml:mi></mml:math></inline-formula> for the parameter set that reached peak likelihood. (<bold>B</bold>) Evolution of the parameter values during the maximization procedure for the same set (blue lines). Maximum likelihood (ML) estimates of the parameters are marked as orange dashed lines. Orange shaded area cover one standard deviation of the posterior distribution around the ML value, evaluated through a Gaussian approximation of the posterior distribution and the quadratic fit of the log-likelihood displayed in panel C. (<bold>C</bold>) Likelihood variation <inline-formula><mml:math id="inf530"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> of the posterior distribution for a small (±5%) variation of single parameters around their ML values (vertical black dashed lines). The peaked shapes of <inline-formula><mml:math id="inf531"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> confirm the convergence of the maximization procedure for all parameters. Orange dashed curves represent quadratic fit of <inline-formula><mml:math id="inf532"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi class="ltx_font_mathcaligraphic">ℒ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, used to estimate the orange confidence interval in (<bold>B</bold>).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig6-v2.tif"/></fig><p>For completeness in <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref>, we report the comparison between the experimental measurements (orange histograms) and the maximum-likelihood fit of the theoretical model (blue curves) for all the different immunization schemes and all different values of the injected dosage <inline-formula><mml:math id="inf533"><mml:mi>D</mml:mi></mml:math></inline-formula> and time delay between injections <inline-formula><mml:math id="inf534"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> used for the fit. All these distributions were used for the likelihood evaluation. The normalization of the distributions is done considering only the part inside the experimental sensitivity range. We find good agreement under all different schemes. Moreover we also report the comparison between the theoretical solution and the stochastic simulations of the model (green histograms, average over 1000 stochastic simulations). This comparison shows that for all regimes considered the theoretical solution is a very good approximation to the stochastic model.</p><fig id="app1fig7" position="float"><label>Appendix 1—figure 7.</label><caption><title>Affinity distributions, comparison between experiments and model prediction for all tested conditions.</title><p>Comparison between experimental measurements (orange histograms), stochastic model (green histograms), and theoretical solution (blue curve) for affinity distributions of antibody-secreting cells (Ab-SCs) under all the different immunization protocols (see main text for the description of the schemes). Experimental data (orange histograms) consists in measurements of affinities of IgG-secreting cells extracted from mice spleen. The number of mice and single-cell measurements is indicated for each histogram (black). The experimental sensitivity range (<inline-formula><mml:math id="inf535"><mml:mrow><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.1</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>nM</mml:mi></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>500</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>nM</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, or equivalently <inline-formula><mml:math id="inf536"><mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>23.03</mml:mn></mml:mrow><mml:mo>≥</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>≥</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mn>14.51</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>) is delimited by the gray shaded area. Blue curves represent the expected binding energy distribution of the Ab-SCs population according to our theory under the same model conditions. For a good comparison all the distributions are normalized so that the area under the curve is unitary for the part inside the experimental sensitivity threshold. For every histogram, we indicate the value of the varied immunization scheme parameter, corresponding to dosage <inline-formula><mml:math id="inf537"><mml:mi>D</mml:mi></mml:math></inline-formula> (pink) for the first two schemes and time delay <inline-formula><mml:math id="inf538"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> (blue) for the third.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig7-v2.tif"/></fig><p>This likelihood maximization procedure is very general and can be easily extended to the inference of any set of parameters in our model, or to other experimental datasets.</p></sec><sec id="s12" sec-type="appendix"><title>5. Permissive and stochastic selection: effect of <inline-formula><mml:math id="inf539"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf540"><mml:mi>b</mml:mi></mml:math></inline-formula> parameters</title><p>Parameters <inline-formula><mml:math id="inf541"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf542"><mml:mi>b</mml:mi></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ19 equ20">Equations 19, 20</xref> represent respectively the probability for a B-cell to pass or to fail a selection step irrespective from their affinity. Parameter <inline-formula><mml:math id="inf543"><mml:mi>a</mml:mi></mml:math></inline-formula> can be related to the ‘permissiveness’ of selection, quantifying how likely is for a cell to be positively selected even if its affinity is small. Parameter <inline-formula><mml:math id="inf544"><mml:mi>b</mml:mi></mml:math></inline-formula> conversely encodes the stochasticity in selection, by virtue of which even high affinity cells are not granted survival (e.g. if they don’t manage to encounter enough T-cells). For simplicity we define these parameters as constants, but one could immagine that their value may change over time, for example it may be related to the availability of T-cell help. Here we investigate the effect of these parameters on the asymptotic wave-like behavior of the system. This asymptotic behavior is characterized by two quantities: the asymptotic growth rate <inline-formula><mml:math id="inf545"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and the asymptotic maturation speed <inline-formula><mml:math id="inf546"><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, as defined in the main text <xref ref-type="disp-formula" rid="equ3">Equation 3</xref>. These quantities are functions of the Ag concentration <inline-formula><mml:math id="inf547"><mml:mi>C</mml:mi></mml:math></inline-formula>. In <xref ref-type="fig" rid="app1fig8">Appendix 1—figure 8</xref> we report how these functions change when the parameters <inline-formula><mml:math id="inf548"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf549"><mml:mi>b</mml:mi></mml:math></inline-formula> are progressively increased. In these tests, we consider only the effect of one parameter at a time and we set the value of the other to its standard value <inline-formula><mml:math id="inf550"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0.13</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf551"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0.66</mml:mn></mml:mrow></mml:math></inline-formula>. By making the selection more permissive and allowing for survival of even low-affinity cells, parameter <inline-formula><mml:math id="inf552"><mml:mi>a</mml:mi></mml:math></inline-formula> has a double effect on the asymptotic behavior: on the one hand it decreases the asymptotic wave velocity and slows down maturation (<xref ref-type="fig" rid="app1fig8">Appendix 1—figure 8E</xref>), and on the other hand it increases the growth rate of the population (<xref ref-type="fig" rid="app1fig8">Appendix 1—figure 8C</xref>). On the contrary, increasing parameter <inline-formula><mml:math id="inf553"><mml:mi>b</mml:mi></mml:math></inline-formula> corresponds to increasing the chance that high-affinity cells are selected out of the population. This both decreases the growth rate (<xref ref-type="fig" rid="app1fig8">Appendix 1—figure 8D</xref>) and also the maturation speed (<xref ref-type="fig" rid="app1fig8">Appendix 1—figure 8F</xref>).</p><fig id="app1fig8" position="float"><label>Appendix 1—figure 8.</label><caption><title>Effect of the terms <inline-formula><mml:math id="inf554"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf555"><mml:mi>b</mml:mi></mml:math></inline-formula> on the model asymptotic behavior.</title><p>On the top row we plot the corresponding T-cell selection survival probability (setting for simplicity <inline-formula><mml:math id="inf556"><mml:mrow><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf557"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>) respectively in the case <inline-formula><mml:math id="inf558"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0.66</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf559"><mml:mi>a</mml:mi></mml:math></inline-formula> varying from 0 to 0.3 (A) and <inline-formula><mml:math id="inf560"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0.12</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf561"><mml:mi>b</mml:mi></mml:math></inline-formula> varying from 0 to 0.6 (B). Values of the parameters <inline-formula><mml:math id="inf562"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf563"><mml:mi>b</mml:mi></mml:math></inline-formula> are color-coded as showed in the legend. In C and E we show the effect of varying <inline-formula><mml:math id="inf564"><mml:mi>a</mml:mi></mml:math></inline-formula> on the asymptotic growth rate <inline-formula><mml:math id="inf565"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> and evolution speed <inline-formula><mml:math id="inf566"><mml:mi>u</mml:mi></mml:math></inline-formula> (we set as before <inline-formula><mml:math id="inf567"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0.66</mml:mn></mml:mrow></mml:math></inline-formula>). Notice how increasing <inline-formula><mml:math id="inf568"><mml:mi>a</mml:mi></mml:math></inline-formula> both slows down evolution and increases the growth rate. In D and F, we report the same quantities for variation of the parameter <inline-formula><mml:math id="inf569"><mml:mi>b</mml:mi></mml:math></inline-formula> (while <inline-formula><mml:math id="inf570"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0.12</mml:mn></mml:mrow></mml:math></inline-formula>). Increasing <inline-formula><mml:math id="inf571"><mml:mi>b</mml:mi></mml:math></inline-formula> decreases both the growth rate and the maturation speed.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig8-v2.tif"/></fig><p>The selection process in affinity maturation has both a <italic>purifying</italic> and <italic>promoting</italic> effect. On the one hand it must negatively select clones that accumulated negative mutations, purifying the population from low-fitness individuals. On the other hand, it must also grant the survival and amplification of the clones that developed affinity-improving mutations. These two properties of selection are weakened by parameters <inline-formula><mml:math id="inf572"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf573"><mml:mi>b</mml:mi></mml:math></inline-formula> in our model, since they respectively grant survival of low-affinity clones and can cause the removal of high-affinity ones. According to our inference procedure parameters <inline-formula><mml:math id="inf574"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf575"><mml:mi>b</mml:mi></mml:math></inline-formula> together seem to account for 79% of the selection probability, making so that affinity can make the survival probability vary of only about 21%. This slows down maturation considerably, since it removes any deterrent against accumulating deleterious mutations. The fact that the inference procedure indicated a high value for these parameters suggests that selection in GCs may be permissive, at least for complex Ags, as suggested in <xref ref-type="bibr" rid="bib57">Murugan et al., 2018</xref>.</p></sec><sec id="s13" sec-type="appendix"><title>6. Possible model variations</title><p>In order to test the relative importance of different model parameters we performed the inference procedure using three different variants for selection (see main text). Variant A corresponds to the inference of all nine inferred model parameters (<inline-formula><mml:math id="inf576"><mml:msub><mml:mi>μ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf577"><mml:msub><mml:mi>σ</mml:mi><mml:mtext>naive</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf578"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="inf579"><mml:mi>α</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf580"><mml:mi>a</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf581"><mml:mi>b</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf582"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf583"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf584"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula>). Variant B corresponds to the case in which stochasticity and permissivity parameters <inline-formula><mml:math id="inf585"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf586"><mml:mi>b</mml:mi></mml:math></inline-formula> are set to zero and only the remaining seven parameters are inferred. In variant C instead Ag-binding selection is neglected, and all eight parameters with the exclusion of <inline-formula><mml:math id="inf587"><mml:msub><mml:mi>ϵ</mml:mi><mml:mtext>Ag</mml:mtext></mml:msub></mml:math></inline-formula> are inferred. The resulting maximum likelihood estimate (MLE) of the parameters, along with the corresponding value of the likelihood, is reported for the three cases in <xref ref-type="fig" rid="app1fig9">Appendix 1—figure 9</xref>. The result of the inference procedure show that the removal of Ag-binding selection (variant A vs C, 9 vs 8 parameters) causes only a very modest decrease in log-likelihood, while the removal of stochasticity in T-cell help selection (variant A vs B, 9 vs 7 parameters) generates a consistent log-likelihood decrease. As described in the main text, both the Bayesian Information Criterion (BIC) (<xref ref-type="bibr" rid="bib68">Schwarz, 1978</xref>) and Akaike Information Criterion (AIC) (<xref ref-type="bibr" rid="bib2">Akaike, 1974</xref>) are in support of removing the former but not the latter, and accept variant C.</p><fig id="app1fig9" position="float"><label>Appendix 1—figure 9.</label><caption><title>Result of the inference procedure on the five variations of the model and comparison with the standard version of the model.</title><p>The variations are described in appendix sect. 6 (Possible model variations). Top: final maximum value of the log-likelihood obtained with the inference procedure (black). Bottom: maximum-likelihood estimate of all of the inferred parameters (blue). Horizontal grey dashed lines mark parameters that are absent in the variant of the model considered.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig9-v2.tif"/></fig><p>Moreover, to show that the model is robust under minor modifications of the hypotheses we consider three minor variations, keeping variant C of selection, and show that they generate similar MLE predictions for the model parameters. First, we test the effect of introducing a residual asymptotic rate of MC/PC production. This case is labelled <italic>soft MC/PC timeswitch</italic>. For simplicity in the model we introduced a complete time-switch between MC and PC production in GCs, making so that asymptotically only PCs are produced for <inline-formula><mml:math id="inf588"><mml:mrow><mml:mi>t</mml:mi><mml:mo>≫</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>diff</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> (cf appendix <xref ref-type="disp-formula" rid="equ22">Equations 21, 22</xref> and <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1B</xref>). In this modification instead we introduce a residual rate of MC/PC production <inline-formula><mml:math id="inf589"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mtext>res</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo lspace="0pt" rspace="3.5pt">%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> modifying appendix <xref ref-type="disp-formula" rid="equ21 equ22">Equations 21, 22</xref> as:<disp-formula id="equ27"><label>(27)</label><mml:math id="m27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>MC</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ28"><label>(28)</label><mml:math id="m28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>PC</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mtext>res</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mtext>diff</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>This makes so that the fraction of MCs in the differentiated population interpolates between ∼90% at small times and ∼10% at big times, granting some residual production of MCs at all times. Applying the inference procedure on this more realistic version of the model results in a better final likelihood than the standard (variant C) version. The inferred values of the parameters are on average similar to the ones obtained with the standard version of the model, with the difference of <inline-formula><mml:math id="inf590"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf591"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula>. While the inequality <inline-formula><mml:math id="inf592"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> still holds, the MLE for these parameter is higher than in the standard case. This can be expected since these parameters control the fraction of MCs in the elicited Ab-SC population, and in this version of the model the MC population contains differentiated cells that would have belonged to the PC compartment in the standard version.</p><p>A further modification involves the fraction of seeder clones extracted from the MC population when colonizing a GC. At the second injection some of the seeder clones for the new GC are extracted from the MC population generated following the first injection. The probability of extracting a seeder clone from the MC pool and not from the initial germline distribution depends in the standard version of the model on the number of accumulated memory cells <inline-formula><mml:math id="inf593"><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub></mml:math></inline-formula> as <inline-formula><mml:math id="inf594"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>/</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> (cf main text section Stochastic model for affinity maturation). This should account for the fact that intuitively if more MCs were produced in the previous maturation then also more should be recalled. However one could more simply suppose this probability to be constant. We test this case by setting <inline-formula><mml:math id="inf595"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>mem</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0.3</mml:mn></mml:mrow></mml:math></inline-formula>. This change generates only a very small likelihood decrease with respect to the standard version of the model, while the MLE for all parameters is almost unchanged.</p><p>Finally, we also test the effect of increasing the rate of Ag decay, multiplying it by a factor three (case labelled <italic>faster Ag decay</italic>). This results in a slight increase in the maximum likelihood, and the values of all the model parameters are again compatible with the one of the standard version of the model, with the exception of the Ag consumption rate <inline-formula><mml:math id="inf596"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula> which decreases to compensate the faster decay rate.</p></sec><sec id="s14" sec-type="appendix"><title>7. Quantifying beneficial and deleterious mutation events</title><p>To quantify the number and impact of mutation events in our simulations we execute 1000 stochastic simulations of a single GC, at an injected Ag dosage of <inline-formula><mml:math id="inf597"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. In each simulation and for each cell we keep track of the number of beneficial and deleterious mutations that each cell accumulates during the course of evolution on the residues we consider (<inline-formula><mml:math id="inf598"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>res</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mrow></mml:math></inline-formula>, see appendix sect. 1 Model definition and parameters choice). Results are reported in <xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref>. In the top row we display the average number of cells for any value of beneficial and deleterious mutations number and at different times: 10, 30 and 50 days after Ag injection. To have an idea of the population size and maturation state at these timepoints one can refer to <xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2</xref>, in which stochastic simulations are performed under the same conditions. In our simulations after the first days of maturation deleterious mutations start to appear (see <xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref>, t = 10). These are the first mutations to appear since they are much more likely than beneficial mutations (95% vs 5%, see <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1A</xref>). However during the course of evolution these are gradually removed by selection, until eventually beneficial mutations, despite being much rarer, start to dominate (see <xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref>, t = 50).</p><fig id="app1fig10" position="float"><label>Appendix 1—figure 10.</label><caption><title>Distribution of beneficial and deleterious mutations over 1000 stochastic germinal center simulations at injected Ag dosage <inline-formula><mml:math id="inf599"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>.</title><p>Color represents the average number of cells that have developed the specified number of beneficial and deleterious mutations for any examined population, according to the color-scale on the right. Top: distribution of mutation numbers in the GC population taken at different times (respectively, 10, 30 or 50 days after Ag injection from left to right). Notice that not all of the populations have the same total size. Bottom: distribution of mutation numbers for the final MC and PC distributions. The average number of total mutations accumulated is 0.13 for MCs and 0.54 for PCs. This number has to be compared to the total number of residues considered (<inline-formula><mml:math id="inf600"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mtext>res</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mrow></mml:math></inline-formula>).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig10-v2.tif"/></fig><p>In the bottom row of <xref ref-type="fig" rid="app1fig10">Appendix 1—figure 10</xref> we display in the same way the number of mutations in the MC and PC population. The former is composed of cells that differentiate early ( <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1B</xref> and <xref ref-type="disp-formula" rid="equ21 equ22">Equations 21, 22</xref>) and therefore bear less mutations than the PC population. However, in both cases the vast majority of cells harbor very few mutations, with the average number of mutations per cell being 0.13 for MCs and 0.54 for PCs. The accumulation of more than 4–5 beneficial mutations in a single cell is very rare. These numbers are compatible with experiments performed in a recent work (<xref ref-type="bibr" rid="bib26">Gérard et al., 2020</xref>), in which mice were immunized against Tetanus Toxoid following a protocol similar to the one used in our experiments. The analysis of high-affinity binders showed an average of 6 non-synonymous mutations on the antibody heavy-chain variable region <inline-formula><mml:math id="inf601"><mml:msub><mml:mi>V</mml:mi><mml:mi>H</mml:mi></mml:msub></mml:math></inline-formula> and three mutations in the light-chain variable region <inline-formula><mml:math id="inf602"><mml:msub><mml:mi>V</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:math></inline-formula>.</p><p>Our model neglects saturation of beneficial mutations, that is the phenomenon by which beneficial mutations cannot be accumulated indefinitely but become rarer as the cell approaches maximum possible affinity. This is partly justified here by the observation that, at least for the inferred value of model parameters, few beneficial mutations are found to accumulate in our simulations. Even when considering clones with the highest number of beneficial mutations, the number of mutations accumulated in our model is compatible with experiments (<xref ref-type="bibr" rid="bib26">Gérard et al., 2020</xref>). As a final remark, notice that even though MCs are not as strongly skewed towards beneficial mutations as PCs, their average affinity is higher than the one of the starting population (cf <xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2B</xref>). This is because amongst the founder clones selection will expand the ones having higher affinity (cf <xref ref-type="fig" rid="fig3">Figure 3</xref>), which will then be overly-represented in the MC population. This shows that in our model maturation is achieved only partially by accumulation of beneficial mutations, the rest being obtained through selective expansion of high-affinity precursors, as also shown in section 'Maturation induces progressive loss of clonality' of the main paper, and confirmed by the strong dependence of the maturation outcome on the initial founder clones population (see <xref ref-type="fig" rid="app1fig3">Appendix 1—figure 3E to H</xref>).</p></sec><sec id="s15" sec-type="appendix"><title>8. Validation of inference procedure on artificially generated data</title><p>To test the reliability of our inference algorithm we generate 10 artificial datasets using our stochastic model and we apply to them the inference procedure. We then compare the inferred values of the parameters with the real value used to generate the data. To verify that the experimental measurements at our disposal are sufficient to infer the model parameters, when generating the data we took into account the size and composition of the experimental dataset. In particular, we generate each artificial dataset as follows. For every experimentally tested conditions (15 conditions in total, consisting in five tested dosages for scheme 1, seven dosages for scheme 2 and 4 delays for scheme 3, with condition <inline-formula><mml:math id="inf603"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf604"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> = 4 weeks shared between scheme 2 and 3) we run as many stochastic simulations as mice tested for that particular condition. Then from every simulation we extract from the responders population a number of cells equal to the one obtained from each mouse. Extraction of cells is done keeping into account the experimental detection range, therefore we exclude cells having affinity lower that <inline-formula><mml:math id="inf605"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>500</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, and set any affinity higher than the high-affinity threshold <inline-formula><mml:math id="inf606"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> equal to the threshold. Stochastic simulations of each scheme are done in model scenario C, using the standard value of the parameters with one exception: to account for the fact that each mouse contains multiple GCs we raised the number of founder clones in each GC to 2500 instead of 100. This amounts to introducing a greater diversity in the initial population, which in turns reduces the stochasticity in the evolution outcome (see also <xref ref-type="fig" rid="app1fig3">Appendix 1—figure 3A to D</xref> and appendix sect. 2 'Stochastic model analysis') and is similar in spirit to averaging between multiple GCs, as it is the case for the experimental measurements of cells extracted from the spleen of mice. This generation procedure was re-executed 10 times, resulting in 10 different datasets. As an example, in <xref ref-type="fig" rid="app1fig11">Appendix 1—figure 11B</xref> we show the binding energy distribution of the 10 generated datasets for condition <inline-formula><mml:math id="inf607"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> of Ag in scheme 2 (histograms in gray). The histograms are close to the prediction of the deterministic model (blue curves), but with some deviations due to stochastic sampling. The average binding energy of the population for all considered condition is reported in <xref ref-type="fig" rid="app1fig11">Appendix 1—figure 11A</xref>. Again, the average binding energy of the generated populations (gray crosses) is close to the prediction of the deterministic model (blue dot), and as expected the noise is higher for the conditions where a smaller amount of experimental measurement was performed (compare with number of measurements displayed in <xref ref-type="fig" rid="app1fig7">Appendix 1—figure 7</xref>).</p><fig id="app1fig11" position="float"><label>Appendix 1—figure 11.</label><caption><title>Generation of realistic datasets, matching the statistics of the experimental one, for inference procedure validation.</title><p>(<bold>A</bold>) Average binding energy of responders populations in the 10 artificially generated datasets (gray) for the 15 experimentally tested conditions, vs the same quantity as predicted by simulations of the deterministic model. The condition to which the measurement are referred is reported on the y-axis, in the form of the scheme used, the Ag dosage injected (<inline-formula><mml:math id="inf608"><mml:mi>D</mml:mi></mml:math></inline-formula>) and/or the time delay between injection (<inline-formula><mml:math id="inf609"><mml:mi>T</mml:mi></mml:math></inline-formula>). (<bold>B</bold>) Distribution of generated binding energies in the 10 generated dataset (gray), compared to the distribution of binding energies predicted by the deterministic model (blue), for the condition corresponding to the injection of <inline-formula><mml:math id="inf610"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> of Ag in scheme 2.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-55678-app1-fig11-v2.tif"/></fig><p>We then run the inference procedure on each artificially generated dataset, using the same setup and initial condition as the ones used to infer model parameters on the real data, under scenario C. The average results of the inference are reported in <xref ref-type="table" rid="app1table1">Appendix 1—table 1</xref>. For every model parameter, the average inferred value is close to the real value used to generate the data, demonstrating that the amount of experimental measurements at our disposal are sufficient for a good recovery of the model parameters.</p><table-wrap id="app1table1" position="float"><label>Appendix 1—table 1.</label><caption><title>Average results of the inference procedure on the 10 artificially generated datasets.</title><p>For each model parameter, we report the value used to generate the data (left), and the mean (middle) and standard deviation (right) over the 10 inferred values.</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Parameter</th><th>Value used to generate data</th><th>Mean of inferred values</th><th>Std of inferred values</th></tr></thead><tbody><tr><td><inline-formula><mml:math id="inf611"><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula></td><td>−14.59</td><td>−14.76</td><td>0.22</td></tr><tr><td><inline-formula><mml:math id="inf612"><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula></td><td>1.66</td><td>1.59</td><td>0.11</td></tr><tr><td><inline-formula><mml:math id="inf613"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>B</mml:mi><mml:mo>-</mml:mo></mml:msubsup></mml:math></inline-formula></td><td>2.07e-05</td><td>1.82e-05</td><td>0.71e-05</td></tr><tr><td><inline-formula><mml:math id="inf614"><mml:msub><mml:mi>g</mml:mi><mml:mtext>recall</mml:mtext></mml:msub></mml:math></inline-formula></td><td>0.56</td><td>0.55</td><td>0.11</td></tr><tr><td><inline-formula><mml:math id="inf615"><mml:msub><mml:mi>g</mml:mi><mml:mtext>imm</mml:mtext></mml:msub></mml:math></inline-formula></td><td>0</td><td>0.009</td><td>0.022</td></tr><tr><td><inline-formula><mml:math id="inf616"><mml:mi>α</mml:mi></mml:math></inline-formula></td><td>0.023</td><td>0.032</td><td>0.019</td></tr><tr><td><inline-formula><mml:math id="inf617"><mml:mi>a</mml:mi></mml:math></inline-formula></td><td>0.120</td><td>0.125</td><td>0.094</td></tr><tr><td><inline-formula><mml:math id="inf618"><mml:mi>b</mml:mi></mml:math></inline-formula></td><td>0.661</td><td>0.659</td><td>0.008</td></tr></tbody></table></table-wrap></sec></boxed-text></app></app-group></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.55678.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Nourmohammad</surname><given-names>Armita</given-names></name><role>Reviewing Editor</role><aff><institution>University of Washington</institution><country>United States</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Mayer</surname><given-names>Andreas</given-names> </name><role>Reviewer</role><aff><institution>Princeton University</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>DeWitt III</surname><given-names>William S</given-names></name><role>Reviewer</role><aff><institution>Fred Hutchinson Cancer Research Center</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>This manuscript presents a mathematical model of affinity maturation, which quantitatively fits single cell measurements of B-cell affinities during maturation. The main experimental finding is that maturation speed has an optimum at intermediate antigen dosage. This phenomenon is elegantly explained in the model by a trade-off between selection strength, which is stronger at small antigen dosage, and length of maturation, which is prolonged at high dosage. Overall, this work introduces a novel theoretical framework for B-cell maturation and brings an intuitive insight into the underlying forces that drive the affinity maturation of B-cells.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;Quantitative modeling of the effect of antigen dosage on B-cell affinity distributions in maturating germinal centers&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by Naama Barkai as the Senior Editor, a Reviewing Editor, and two reviewers. The following individuals involved in review of your submission have agreed to reveal their identity: Andreas Mayer (Reviewer #1); William S DeWitt III (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>This manuscript presents a mathematical model of affinity maturation, which quantitatively fits single cell measurements of B cell affinity dynamics. The main experimental finding is that maturation speed has an optimum at intermediate antigen dosage. This phenomenon is elegantly explained in the model by a trade-off between selection strength, which is stronger at small antigen dosage, and length of maturation, which is prolonged at high dosage. More broadly, a notable contribution of the work is to introduce a novel theoretical framework, which provides intuitive insight into what drives maturation dynamics and allows more rigorous parameter inference than in prior work.</p><p>The reviewers agree that the manuscript presents an interesting approach to address B-cell maturation, but they raise major concerns that we would like to see addressed.</p><p>Essential revisions:</p><p>1) One major concern is about the compatibility of the proposed dynamics with a number of recent experiments that show a rapid emergence of clonal dominance in a significant fraction of germinal centers (e.g. Tas et al., 2016, Abbott et al., 2018). This incompatibility is certainly concerning. However, we also agree that the data presented in the paper is not a product of a single germinal center (GC) but rather are cells harvested from spleens, which can contain tens of GCs at a given time point. In other words, despite the current claim, which needs to be revised, the manuscript is presenting an effective model for multiple GCs in one spleen. Each of these GCs may contain homogenized populations of cells (consistent with Tas et al.,), but the spleen data may show maintenance of diversity arising from distinct clonal populations established in different GCs.</p><p>Given this discrepancy, there are multiple issues that need to be addressed:</p><p>1.1) Simulation and modeling extension should be added to systematically include heterogeneous GC structures within a spleen.</p><p>1.2) The picture presented in the current work in which the stochastic dynamics within a germinal center is well-described by a deterministic traveling wave dynamics in affinity space seems to be in contradiction with the earlier findings (Tas et al., 2016). Importantly, as evolutionary trajectories approach affinity fitness peaks, it will become increasingly difficult for affinity-increasing mutations to occur. Subsection 'Model limitations and discussion' states &quot;we believe this saturation effect is not relevant to model the limited maturation observed in experiments&quot;. This needs more justification, considering the convergent outcomes found in some studies (e.g. Tas et al.,). It's not obvious that the traveling wave asymptote is obtained in GC dynamics.</p><p>We propose that the authors explicitly demonstrate a specific scenario (e.g. through simulations) that their model provides at least a correct effective description for evolution of cells harvested from a spleen. Traveling wave approach might be a more realistic effective model for multiple GCs than for affinity maturation in a single GC, as currently presented.</p><p>2) The lack of any validation for ML inference procedure is a serious limitation. The manuscript describes a rugged likelihood surface for which convex optimization would be inadequate for arriving at the maximum likelihood estimation (MLE). The authors use parallel tempering to cope with this, which allows sampling across multiple local minima. However, there is no attempt to validate that model parameters can be accurately recovered by this procedure. It is not enough to say that the data are fit well as many points in the high dimensional parameter space may fit the data well. Therefore, the authors should demonstrate that model parameters can reliably be recovered from simulated data for a range of parameter values. It would be more convincing if the authors can further show that recovery is not severely impacted by model assumptions that were adopted for analytical tractability but can be violated in simulations (i.e. model misspecification). Without such validation on simulated data, it is difficult to reliably trust the parameter inference from experimental data.</p><p>3) The manuscript describes a computational method for simulation and for inferring parameters from affinity data, but the computational implementation is not made available. Access to the implementation is needed for several reasons: (1) more complete peer review will be possible if reviewers are able to assess the implementation details and even run the code, (2) reproducibility of the results, (3) upon publication, it will be more feasible for other researchers to use or build on this work. We ask the authors to make their code available to the reviewers for the next revision.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.55678.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) One major concern is about the compatibility of the proposed dynamics with a number of recent experiments that show a rapid emergence of clonal dominance in a significant fraction of germinal centers (e.g. Tas et al., 2016, Abbott et al., 2018). This incompatibility is certainly concerning. However, we also agree that the data presented in the paper is not a product of a single germinal center (GC) but rather are cells harvested from spleens, which can contain tens of GCs at a given time point. In other words, despite the current claim, which needs to be revised, the manuscript is presenting an effective model for multiple GCs in one spleen. Each of these GCs may contain homogenized populations of cells (consistent with Tas et al.,), but the spleen data may show maintenance of diversity arising from distinct clonal populations established in different GCs.</p><p>Given this discrepancy, there are multiple issues that need to be addressed:</p><p>1.1) Simulation and modeling extension should be added to systematically include heterogeneous GC structures within a spleen.</p><p>1.2) The picture presented in the current work in which the stochastic dynamics within a germinal center is well-described by a deterministic traveling wave dynamics in affinity space seems to be in contradiction with the earlier findings (Tas et al., 2016). Importantly, as evolutionary trajectories approach affinity fitness peaks, it will become increasingly difficult for affinity-increasing mutations to occur. Subsection 'Model limitations and discussion' states &quot;we believe this saturation effect is not relevant to model the limited maturation observed in experiments&quot;. This needs more justification, considering the convergent outcomes found in some studies (e.g. Tas et al.,). It's not obvious that the traveling wave asymptote is obtained in GC dynamics.</p><p>We propose that the authors explicitly demonstrate a specific scenario (e.g. through simulations) that their model provides at least a correct effective description for evolution of cells harvested from a spleen. Traveling wave approach might be a more realistic effective model for multiple GCs than for affinity maturation in a single GC, as currently presented.</p></disp-quote><p>The reviewers are concerned by the incompatibility of our stochastic evolution model, which gives rise (on average and at 'long' times) to a travelling maturation wave, with recent experimental evidence that GCs can be quickly dominated by single clones. This is an important concern, and we would like to answer comment 1.1 in four points.</p><p>First, we fully agree with the reviewers on the relevance of the experiments by Tas et al., (2016) and Abbott et al., (2018), showing various degrees of homogenizing selection (some GCs are quickly dominated by a single clone others stay heterogeneous throughout evolution). To demonstrate that our model can account for this phenomenon we have introduced a minimal modification, consisting in seeding the GC with 100 founder clones (rather than 2,500 as in the previous manuscript). This number was chosen based on Tas et al., (2016)’s estimate ranging from 50 to 200 clones in early GCs. The binding energy of each founder clone is independently extracted from the Gaussian distribution of 'naive' binding energies. During the time of GC formation these clones expand uniformly without mutating, up to a total population of 2,500 cells at day 6 after injection, at which point the GC simulation starts. This modification reduces the diversity of the initial population (but not its size) to a more realistic level. It also allows us to follow the evolution of different clonal families, which was not done in the first version of the manuscript. We observe that this evolution is compatible with the experimental evidence cited above. In particular, in Figure 3 we demonstrate that stochastic simulations of our GCs show different degrees of homogenizing selection (Figure 3A, B), with half of the simulation featuring a clonal family that, by day 28, expands to and 30% of the total GC population (Figure 3C). Moreover, we show that homogenization correlates with the presence of a high-affinity founder (Figure 3D).</p><p>Second, considering that GC is seeded by 'only' 100 founder clones rather than 2500 distinct clones drawn from the same naive distribution, as was done in the previous manuscript, has no impact on the average evolution of GCs, but it increases the level of stochasticity of the outcome of the maturation process (cf Appendix 1—Figure 3A to D). Therefore, our deterministic evolution model remains valid and correctly describes the average evolution of one GC.</p><p>Third, as rightly pointed out by the reviewers, the cells we measure from spleens are the cumulative outcome of many different GC reactions. While the physical and biological defining constants may vary from GC to GC, this structural variability cannot be inferred from our experimental data that give access to the population averaged affinity distribution. We thus omit this variability and assume that all GCs are defined with the same effective model parameters, but are seeded with different, independently drawn founder clones. This population of heterogeneous GC mature independently from each other, and we collect PCs and MCs at the end of the process. Considering multiple GCs rather than a single one does not have any impact on the average distribution of affinities, which is again given by our deterministic evolution model. Therefore, it is licit to use the average distribution in our inference procedure to extract the effective model parameters from the set of experimentally measured affinities, as explain in the Materials and methods section. Notice that the level of noise (fluctuations around this average distribution) is reduced when averaging over multiple GCs; We take this effect into account through the rescaled level of noise corresponding to the average over 20 different stochastic simulations (see Figure 6).</p><p>Fourth, we also agree with the reviewers that the 'traveling wave' description we employ in our paper is exact for the deterministic evolution model only. In other words, the traveling wave is true only on average over the stochastic evolution of one or more GCs.</p><p>As a summary, in the amended manuscript, we have changed the initial population of our GC to make it more realistic. Consequently, our stochastic maturation model does show homogenizing selection and the resulting affinity distribution is described on average by a traveling wave. We have made these two essential points much clearer in the new manuscript. We would also like to thank the reviewers for their important comment. We believe that the changes that were introduced following their recommendation, in particular the addition of Figure 3 and of the corresponding paragraph, substantially improved our paper.</p><p>We now discuss comment 1.2 and potential saturation effect in mutations. We have quantified the numbers of mutations accumulated by MCs and PCs during the course of evolution in our stochastic model (see Appendix 1—Figure 10 and Appendix 1 subsection 'Quantifying beneficial and deleterious mutation events'). For both populations these numbers are small on average (<italic>&lt;</italic> 1, Appendix 1 subsection 'Quantifying beneficial and deleterious mutation events'), with very few cells accumulating more than 4-5 beneficial mutations. This is especially true for the MC population, in which most of the mutations accumulated are deleterious. This observation shows that maturation in our model mainly comes from simple selection of high-affinity precursor, and only partially by additional mutations increasing their affinity. Consequently, we believe that neglecting the saturation effect of beneficial mutations is an acceptable approximation, at least in the regime of the inferred values of the parameters. In addition, the maximum number of accumulated beneficial mutations (4-5) is also compatible with recent experiments [G´erard et al., 2020], in which mice were immunized against Tetanos Toxoid with a protocol similar to the ones we consider. The authors quantified the mutational load on high-affinity binders (<italic>K<sub>d</sub> </italic>∼ 1 nM) and found an average of 9 non-synonymous mutations on the antibody heavy and light chain variable regions. These experimental results confirm that the number of mutation events considered in our model is not unrealistically high despite the absence of saturation mechanism.</p><disp-quote content-type="editor-comment"><p>2) The lack of any validation for ML inference procedure is a serious limitation. The manuscript describes a rugged likelihood surface for which convex optimization would be inadequate for arriving at the maximum likelihood estimation (MLE). The authors use parallel tempering to cope with this, which allows sampling across multiple local minima. However, there is no attempt to validate that model parameters can be accurately recovered by this procedure. It is not enough to say that the data are fit well as many points in the high dimensional parameter space may fit the data well. Therefore, the authors should demonstrate that model parameters can reliably be recovered from simulated data for a range of parameter values. It would be more convincing if the authors can further show that recovery is not severely impacted by model assumptions that were adopted for analytical tractability but can be violated in simulations (i.e. model misspecification). Without such validation on simulated data, it is difficult to reliably trust the parameter inference from experimental data.</p></disp-quote><p>We certainly agree that our likelihood is a complicated function of the parameters to be inferred, and there is no guarantee that the absolute maximum is found, despite the use of parallel tempering and the care brought to the numerics. Following the reviewers’ advice:</p><p>We generated multiple synthetic datasets (cf Appendix 1—Figure 11 and Appendix 1 subsection. 'Validation of inference procedure on artificially generated data'). Each dataset was generated from our stochastic maturation model with the set of parameters inferred from the experimental data and reported in the manuscript. The simulations were carried out under the same immunization schemes as in the experimental dataset, and we extracted the same number of (synthetic) cells from the simulated responders as in the mice we have experimentally studied. In this way, the size and format of each synthetic dataset was identical to the experimental one. Notice that, to gain time, we did not introduce 100 founder clones per GC and averaged over multiple GCs, but rather considered 2500 founder clones; this does not affect the mean affinity distribution and the amplitude of the fluctuations is comparable to what is expected from the average over tens of GC, see Figure 6 and Appendix 1— Figure 3A to D.</p><p>The inference procedure was then run on each synthetic dataset. In Appendix 1—table 1 we report the average and standard deviation of the values of the inferred parameters. We find a good match between the results of the multiple inferences and the ground truth values of the parameters (that is, their values inferred from the experimental data and used to generate the synthetic data).</p><p>These results, reported in the appendix of the new manuscript, show that our inference procedure is consistent and reliable, despite the roughness of the likelihood and the limited number of available data.</p><disp-quote content-type="editor-comment"><p>3) The manuscript describes a computational method for simulation and for inferring parameters from affinity data, but the computational implementation is not made available. Access to the implementation is needed for several reasons: (1) more complete peer review will be possible if reviewers are able to assess the implementation details and even run the code, (2) reproducibility of the results, (3) upon publication, it will be more feasible for other researchers to use or build on this work. We ask the authors to make their code available to the reviewers for the next revision.</p></disp-quote><p>All the code necessary to produce the figures in the main paper will be made available in the following online repository: https://github.com/mmolari/affinity_maturation. This includes the library to simulate immunization schemes, with both the stochastic and deterministic model, and the inference algorithm. The repository contains a file (parallel tempering.py) that executes the maximum-likelihood inference procedure and recovers the values of parameters reported in the paper. The code that reproduces the figures of the main paper is included in the form of Jupyter notebooks. We also added a short tutorial on how to implement custom immunization scheme simulations, import new datasets and run the inference procedure on them (see readme and docs folder). To maximize readability the code is extensively commented.</p></body></sub-article></article>