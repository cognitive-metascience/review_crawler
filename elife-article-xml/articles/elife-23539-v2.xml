<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1d3 20150301//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1d3" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="hwp">eLife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">23539</article-id><article-id pub-id-type="doi">10.7554/eLife.23539</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Microbiology and Infectious Disease</subject></subj-group></article-categories><title-group><article-title>The cyanobacterial circadian clock follows midday in vivo and in vitro</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-75747"><name><surname>Leypunskiy</surname><given-names>Eugene</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3335-1099</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="par-1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-75748"><name><surname>Lin</surname><given-names>Jenny</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-84703"><name><surname>Yoo</surname><given-names>Haneul</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-75749"><name><surname>Lee</surname><given-names>UnJin</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="par-2"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-11060"><name><surname>Dinner</surname><given-names>Aaron R</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-8328-6427</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="corresp" rid="cor1">*</xref><xref ref-type="other" rid="par-3"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-24330"><name><surname>Rust</surname><given-names>Michael J</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-7207-4020</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="corresp" rid="cor2">*</xref><xref ref-type="other" rid="par-4"/><xref ref-type="other" rid="par-5"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Graduate Program in Biophysical Sciences</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Biochemistry and Molecular Biology</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Department of Ecology and Evolution</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Department of Chemistry</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff5"><label>5</label><institution content-type="dept">James Franck Institute</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff6"><label>6</label><institution content-type="dept">Department of Molecular Genetics and Cell Biology</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff><aff id="aff7"><label>7</label><institution content-type="dept">Department of Physics</institution>, <institution>The University of Chicago</institution>, <addr-line><named-content content-type="city">Chicago</named-content></addr-line>, <country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Barkai</surname><given-names>Naama</given-names></name><role>Reviewing editor</role><aff><institution>Weizmann Institute of Science</institution>, <country>Israel</country></aff></contrib></contrib-group><author-notes><corresp id="cor1"><email>dinner@uchicago.edu</email> (ARD);</corresp><corresp id="cor2"><email>mrust@uchicago.edu</email> (MJR)</corresp></author-notes><pub-date date-type="pub" publication-format="electronic"><day>07</day><month>07</month><year>2017</year></pub-date><pub-date pub-type="collection"><year>2017</year></pub-date><volume>6</volume><elocation-id>e23539</elocation-id><history><date date-type="received"><day>22</day><month>11</month><year>2016</year></date><date date-type="accepted"><day>06</day><month>07</month><year>2017</year></date></history><permissions><copyright-statement>© 2017, Leypunskiy et al</copyright-statement><copyright-year>2017</copyright-year><copyright-holder>Leypunskiy et al</copyright-holder><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-23539-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.23539.001</object-id><p>Circadian rhythms are biological oscillations that schedule daily changes in physiology. Outside the laboratory, circadian clocks do not generally free-run but are driven by daily cues whose timing varies with the seasons. The principles that determine how circadian clocks align to these external cycles are not well understood. Here, we report experimental platforms for driving the cyanobacterial circadian clock both in vivo and in vitro. We find that the phase of the circadian rhythm follows a simple scaling law in light-dark cycles, tracking midday across conditions with variable day length. The core biochemical oscillator comprised of the Kai proteins behaves similarly when driven by metabolic pulses in vitro, indicating that such dynamics are intrinsic to these proteins. We develop a general mathematical framework based on instantaneous transformation of the clock cycle by external cues, which successfully predicts clock behavior under many cycling environments.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.001">http://dx.doi.org/10.7554/eLife.23539.001</ext-link></p></abstract><abstract abstract-type="executive-summary"><object-id pub-id-type="doi">10.7554/eLife.23539.002</object-id><title>eLife digest</title><p>All life forms on the surface of our planet face an environment that cycles between day and night as the Earth rotates around its axis. To deal with these regular changes, organisms from bacteria to humans have internal rhythms, called circadian clocks, that coordinate different aspects of these organisms’ lives, from growth to the urge to sleep, with the day-night cycle.</p><p>The simplest of all known circadian clocks is found in bacteria called cyanobacteria, which live in bodies of water all around the world. Like plants, these microorganisms can harness the energy in sunlight to fuel their growth. The internal clock of cyanobacteria is remarkable because it can be rebuilt in the laboratory using just three components, proteins called KaiA, KaiB and KaiC. When mixed together in a test tube, these proteins spontaneously generate a 24-hour cycle in which KaiC gets chemically modified by the addition and removal of a phosphate group. These chemical modifications on KaiC are like the hands of the clock that tell the time of day.</p><p>Much work on the internal clock of cyanobacteria has focused on how the clock proteins generate rhythms. What has been less clear is how this rhythm works in an environment that changes between day and night and from season to season. For example, away from the equator, the length of the day changes throughout the year. Changes in day length are important for cyanobacteria because they can grow only during the day and must rest at night. Yet, it was not understood how this microorganism's clock adjusts to days of different length.</p><p>To address this question, Leypunskiy et al. made a device to grow cyanobacteria in many different light-dark cycles while monitoring their circadian rhythm. The experiments revealed a fairly simple result: the internal clock time is always the same at the middle of the day, regardless of how long the day is. Next, Leypunskiy et al. developed a way to study how the clock proteins in the test tube respond to chemical signals mimicking day and night. Unexpectedly, this showed that the Kai proteins themselves have the ability to track the middle of the day. It turns out that these proteins are not only able to generate a 24-hour rhythm, but also to correctly align it to the day-night cycle.</p><p>Together, these findings will guide other researchers to better understand the molecular origins of how circadian clocks align to the day-night cycle. Moreover, by showing that the effects of a light-dark cycle on a circadian clock can be mimicked in a test tube, these results open the doors to using the tools of biochemistry to understand how circadian clocks work in natural environments.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.002">http://dx.doi.org/10.7554/eLife.23539.002</ext-link></p></abstract><kwd-group kwd-group-type="author-keywords"><title>Author Keywords</title><kwd>cyanobacteria</kwd><kwd>circadian</kwd><kwd>dynamical systems</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research Organism</title><kwd>Other</kwd></kwd-group><funding-group><award-group id="par-1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>5T32EB9412-5</award-id><principal-award-recipient><name><surname>Leypunskiy</surname><given-names>Eugene</given-names></name></principal-award-recipient></award-group><award-group id="par-2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>T32GM07197</award-id><principal-award-recipient><name><surname>Lee</surname><given-names>UnJin</given-names></name></principal-award-recipient></award-group><award-group id="par-3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000001</institution-id><institution>National Science Foundation</institution></institution-wrap></funding-source><award-id>PHY-1305542</award-id><principal-award-recipient><name><surname>Dinner</surname><given-names>Aaron R</given-names></name></principal-award-recipient></award-group><award-group id="par-4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000875</institution-id><institution>Pew Charitable Trusts</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Rust</surname><given-names>Michael J</given-names></name></principal-award-recipient></award-group><award-group id="par-5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000057</institution-id><institution>National Institute of General Medical Sciences</institution></institution-wrap></funding-source><award-id>R01GM107369-01</award-id><principal-award-recipient><name><surname>Rust</surname><given-names>Michael J</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta><meta-name>elife-xml-version</meta-name><meta-value>2.5</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>The cyanobacterial core clock tracks midday regardless of day length, which can be understood in terms of a model for how the environment alters the clock limit cycle.</meta-value></custom-meta><custom-meta><meta-name>eLife Digest</meta-name><meta-value>2.5</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Circadian clocks generate biological rhythms that temporally organize physiology to match the 24 hr diurnal cycle. Although these clocks continue to oscillate in constant laboratory conditions, in natural environments they are driven by the external cycle of day and night. Because of latitude-dependent changes in the duration of day and night throughout the year, clock architectures must incorporate mechanisms that respond appropriately to environmental signals, such as dawn and dusk, whose schedule changes throughout the year. Data from several species indicate that circadian clocks adapt to different day lengths by modulating their phases relative to the light-dark cycle (<xref ref-type="bibr" rid="bib6">de Montaigu et al., 2015</xref>; <xref ref-type="bibr" rid="bib39">Rémi et al., 2010</xref>). In this way, circadian oscillators are able to coordinate physiological events relative to specific times of day and, in multicellular organisms, specialized mechanisms exist that allow oscillators in different cells to follow distinct times of day (<xref ref-type="bibr" rid="bib12">Herzog, 2007</xref>; <xref ref-type="bibr" rid="bib4">Daan et al., 2003</xref>). Because the biochemical circuits governing circadian rhythms and light-dark sensing in such organisms are complex, it has been difficult to identify which features of circadian systems are responsible for seasonal adaptation. More generally, it remains unclear what features oscillators must have to respond appropriately to varying light-dark cycles and how those features are implemented molecularly in specific systems.</p><p>Cyanobacteria present a unique opportunity to elucidate molecular mechanisms in circadian biology because the core oscillator responsible for driving genome-wide transcriptional rhythms can be reconstituted using purified KaiABC proteins, and these proteins have been extensively studied biochemically in constant conditions (<xref ref-type="bibr" rid="bib27">Nishiwaki et al., 2004</xref>; <xref ref-type="bibr" rid="bib41">Rust et al., 2007</xref>). Cyanobacteria must contend with large seasonal variations in day length because their natural aquatic environments span a wide range of latitudes (<xref ref-type="bibr" rid="bib9">Flombaum et al., 2013</xref>). Yet, comparatively little is known about how the cyanobacterial clock functions when driven by light-dark cycles that mimic days in different seasons.</p><p>To study how the circadian clock is affected by light-dark cycles with different day lengths, we developed multiplexed LED illumination devices to grow cyanobacteria in a wide range of light-dark conditions (<xref ref-type="fig" rid="fig1">Figure 1A</xref>). We used square-wave illumination patterns in our experiments, and used the times of lights-on and lights-off as experimental analogs of dawn and dusk, respectively. We defined the day length (<italic>τ</italic>) as the total time the lights are on each day (<xref ref-type="fig" rid="fig1">Figure 1A</xref>). We found that the circadian rhythm in the cyanobacterium <italic>Synechococcus elongatus</italic> PCC 7942 (<italic>S. elongatus</italic>) follows a simple rule: the phase of clock-driven gene expression scales linearly with day length and remains fixed relative to the middle of the day over a wide range of day lengths.<fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.003</object-id><label>Figure 1.</label><caption><title>Phase of the cyanobacterial circadian rhythm scales linearly with day length.</title><p>(<bold>A</bold>) LED array device used to grow <italic>S. elongatus</italic> in programmable light-dark cycles. Cells grown in a 96-well plate on solid media (lower plate, <italic>green circles</italic>) are illuminated from above by LEDs (<italic>red circles</italic>). An Arduino microcontroller is used to dynamically change LED intensity in different columns of the plate (<italic>inset</italic>). Luminescence from the bottom plate is read out every 30 min on a plate reader. Drawing not to scale. (<bold>B</bold>) Drive-and-release strategy to measure phase of the circadian clock under light-dark (LD) cycling. Cells were exposed to five entraining LD cycles and then released into constant light. Bioluminescence signals (P<italic><sub>kaiBC</sub>::luxAB</italic>) from each well were separated into individual ‘day’ and ‘night’ windows. Data from night portions of the experiment were omitted from analysis (<italic>gray bars</italic>), and data from the day portions of the experiment were aligned to zero baseline and normalized to unit variance. Dashed lines indicate time of peak reporter signal calculated by parabolic fitting. See Computational methods for details. (<bold>C</bold>) Peak time of bioluminescence (P<italic><sub>kaiBC</sub>::luxAB</italic>) in light-dark cycles of different day length (<italic>red squares</italic>) was quantified by local parabolic fitting around the first maximum of the oscillation after release into constant light. Error bars represent standard deviations of peak time estimates from technical replicates (n = 4–8). Slope of the linear fit (<italic>red line</italic>, <italic>m</italic> = 0.53 ± 0.01) was determined by linear regression. <italic>Dashed and dotted black lines</italic> indicate scaling of phase with day length for dawn- and dusk-tracking oscillators; <italic>green line</italic> indicates midday-tracking behavior.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.003">http://dx.doi.org/10.7554/eLife.23539.003</ext-link></p><p><supplementary-material id="SD1-data"><object-id pub-id-type="doi">10.7554/eLife.23539.004</object-id><label>Figure 1—source data 1.</label><caption><title>Source data for <xref ref-type="fig" rid="fig1">Figure 1B</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.004">http://dx.doi.org/10.7554/eLife.23539.004</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig1-data1-v2.xlsx"/></supplementary-material></p><p><supplementary-material id="SD2-data"><object-id pub-id-type="doi">10.7554/eLife.23539.005</object-id><label>Figure 1—source data 2.</label><caption><title>Source data for <xref ref-type="fig" rid="fig1">Figure 1C</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.005">http://dx.doi.org/10.7554/eLife.23539.005</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig1-data2-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD3-data"><object-id pub-id-type="doi">10.7554/eLife.23539.006</object-id><label>Figure 1—source data 3.</label><caption><title>Source data for bioluminescence trajectories in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.006">http://dx.doi.org/10.7554/eLife.23539.006</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig1-data3-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD4-data"><object-id pub-id-type="doi">10.7554/eLife.23539.007</object-id><label>Figure 1—source data 4.</label><caption><title>Source data for Kendall’s τ correlations in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.007">http://dx.doi.org/10.7554/eLife.23539.007</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig1-data4-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD5-data"><object-id pub-id-type="doi">10.7554/eLife.23539.008</object-id><label>Figure 1—source data 5.</label><caption><title>Source data for <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2A–E</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.008">http://dx.doi.org/10.7554/eLife.23539.008</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig1-data5-v2.xlsx"/></supplementary-material></p><p><supplementary-material id="SD6-data"><object-id pub-id-type="doi">10.7554/eLife.23539.009</object-id><label>Figure 1—source data 6.</label><caption><title>Source data for <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3A</xref>, showing bioluminescence output from the <italic>purF</italic> repoter.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.009">http://dx.doi.org/10.7554/eLife.23539.009</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig1-data6-v2.xlsx"/></supplementary-material></p><p><supplementary-material id="SD7-data"><object-id pub-id-type="doi">10.7554/eLife.23539.010</object-id><label>Figure 1—source data 7.</label><caption><title>Source data for <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3B</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.010">http://dx.doi.org/10.7554/eLife.23539.010</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig1-data7-v2.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig1-v2"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.011</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Bioluminescence recordings from <italic>P<sub>kaiBC</sub>::luxAB</italic> reporter in light-dark cycles.</title><p>(<italic>left</italic>) Selected bioluminescence traces (<italic>P<sub>kaiBC</sub>::luxAB, black</italic>) recorded from individual wells of the 96-well LED array device in conditions simulating day-night cycles of different day length (same dataset as in <xref ref-type="fig" rid="fig1">Figure 1B–C</xref>). Data recorded in the dark (<italic>gray bars</italic>) and in the first two hours after lights-on were omitted from analysis. Each trajectory was normalized to the mean and variance of the bioluminescence signal recorded after the release into constant light, and trajectories recorded after release into constant light were fit to sinusoids (<italic>green</italic>). For illustration purposes here, trajectories were aligned to zero baseline. See Computational methods for fitting details. (<italic>right</italic>) Similarity between the bioluminescence rhythms (<italic>P<sub>kaiBC</sub>::luxAB)</italic> recorded during light-dark entrainment and after release into free running conditions. Nonparametric correlation coefficient (Kendall’s <italic>τ</italic>) between bioluminescence trajectories recorded in the light during entrainment (days 1–5) and the corresponding time period after release into constant light (e.g. a 16-hr window in LL for LD 16:8). See Computational methods for details.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.011">http://dx.doi.org/10.7554/eLife.23539.011</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig1-figsupp1-v2"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.012</object-id><label>Figure 1—figure supplement 2.</label><caption><title>The circadian rhythm of <italic>S. elongatus</italic> rapidly entrains to 24 hr diurnal cycles with 8–16 hr of daylight.</title><p>(<bold>A</bold>) Peak times of <italic>P<sub>kaiBC</sub>::luxAB</italic> reporter after release into LL from 1 to 7 LD cycles of different day length (LD 8:16, LD 12:12 or LD 16:8), as estimated by sinusoidal regression. Error bars represent the standard deviation (σ) of technical replicates (n = 6–8 replicates per condition). Lines mark linear fits to the data. (<bold>B</bold>) Slope <italic>m</italic> of clock phase scaling with day length stabilizes after three light-dark cycles. Slope of linear fits in (<bold>A</bold>) plotted against day length in diurnal cycles. Error bars mark uncertainty in fit slope (±<italic>σ</italic>). (<bold>C</bold>) Slope <italic>m</italic> of clock phase scaling with day length, as estimated by parabolic regression (see Computational methods). (<bold>D and E</bold>) Free-running period of <italic>P<sub>kaiBC</sub>::luxAB</italic> reporter rhythms, as estimated from sinusoidal fits (<bold>D</bold>) or local parabolic fits (<bold>E</bold>), recorded in continuous light after entrainment to 24 hr cycles with 8, 12, or 16 hr of daylight.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.012">http://dx.doi.org/10.7554/eLife.23539.012</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig1-figsupp2-v2"/></fig><fig id="fig1s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.013</object-id><label>Figure 1—figure supplement 3.</label><caption><title>Bioluminescence recordings from <italic>P<sub>purF</sub>::luxAB</italic> reporter in light-dark cycles.</title><p>(<bold>A</bold>) Rhythms in bioluminescence in continuous light recorded from a dawn gene reporter (<italic>PpurF::luxAB)</italic> after entrainment to 24 hr light-dark cycles of different day length <italic>τ</italic> (LD 8:16, LD 10:14, LD 14:10, LD 18:6). Following the protocol in <xref ref-type="fig" rid="fig1">Figure 1</xref>, cells received five light-dark cycles and were then placed under continuous illumination. Bioluminescence trajectories from first 72 hr after release into constant conditions were aligned to zero baseline and normalized to unit variance. (<bold>B</bold>) Peak times of the <italic>PpurF::luxAB</italic> reporter in constant light after entrainment with five LD cycles of different day length (LD 4:20 to LD 20:4). Peak times were determined by local parabolic regression (see Computational methods). Error bars represent standard errors of technical replicates (n = 4–8). Straight lines represent linear fits to data from wells entrained to day lengths at least 8 hr long.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.013">http://dx.doi.org/10.7554/eLife.23539.013</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig1-figsupp3-v2"/></fig></fig-group></p><p>We biochemically simulated seasonal effects in the reconstituted KaiABC oscillator by driving the Kai proteins with pulses of nucleotides on a 24 hr cycle, simulating in vivo metabolic conditions during day and night. Remarkably, this in vitro system shows a similar linear scaling of clock phase with simulated day length, indicating that core mechanisms for seasonal adaptation are intrinsic to the Kai proteins. We developed a minimal mathematical model for oscillator entrainment based on rapid transitions between distinct day and night clock cycles. The model can account for the ability to track midday if the phase shifts caused by dawn and dusk depend linearly on clock time with appropriate slopes. By calibrating this model with independent measurements in vitro and in vivo, we were able to predict the results of phase response experiments, and the behavior of the clock in non-24 hr light-dark cycles.</p><p>The essential feature of the model, the linear dependences of phase shifts on clock time, has a simple geometric interpretation in terms of the deformation of the clock orbit caused by a transition between light and dark. Thus, the entrained behavior of the circadian clock can be captured quantitatively by a mathematical framework with a small number of parameters. This framework in turn can be used to guide the design of experiments that probe the molecular origins of key mathematical features. The precisely defined nature of the cyanobacterial clock facilitates such experiments, but the model is general, so we expect it to be useful for other organisms as well.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Cyanobacteria respond to seasonal changes in day length by aligning the phase of circadian gene expression relative to midday</title><p><italic>S. elongatus</italic> is a photosynthetic bacterium whose physiology is closely tied to light and dark. In constant light, the circadian clock exerts pervasive control over gene expression: most transcripts cycle in abundance with ≈24 hr period, with the majority of transcripts peaking either near subjective morning (dawn genes), or nearly 12 hr later, at subjective nightfall (dusk genes) (<xref ref-type="bibr" rid="bib23">Liu et al., 1995</xref>; <xref ref-type="bibr" rid="bib16">Ito et al., 2009</xref>). In the dark, however, growth stops, and most gene expression is highly repressed (<xref ref-type="bibr" rid="bib13">Hosokawa et al., 2011</xref>; <xref ref-type="bibr" rid="bib45">Tomita et al., 2005</xref>; <xref ref-type="bibr" rid="bib29">Pattanayak et al., 2015</xref>). Thus, portions of the circadian gene expression program that fall into nighttime hours are strongly attenuated.</p><p>Viewed in this way, the hours between dawn and dusk provide a limited window for gene expression, so that winter months at high latitude provide fewer daylight hours for this cyanobacterium to accomplish biosynthetic tasks relative to summer months. We surmised that an important function for the circadian clock in this organism might be to schedule gene expression appropriately during daylight hours, when biosynthetic resources are available. We thus expected that asymmetric light-dark cycles mimicking days in different seasons would realign the clock cycle.</p><p>To systematically study how circadian gene expression in <italic>S. elongatus</italic> adjusts to asymmetric light-dark schedules, we built a microcontroller-driven LED array device and used it to grow cells in 24 hr day-night cycles with photoperiod (day length) varying from 4 to 20 hr (<xref ref-type="fig" rid="fig1">Figure 1A</xref>). This LED array was coupled to a plate reader that allowed us to monitor clock output—gene expression from clock-driven promoters—using strains engineered with luminescent reporters of representative dusk (<italic>kaiBC</italic>) and dawn (<italic>purF</italic>) genes.</p><p>In these experiments, the circadian clock stably entrained to light-dark cycles with a wide range of day lengths (<italic>τ</italic> = 8–16 hr) within roughly 3 days (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplements 1</xref> and <xref ref-type="fig" rid="fig1s2">2</xref>). We found that the phase of the oscillation, that is, when the peak clock output signal occurred relative to dawn, varied systematically as a function of day length. In general, longer days resulted in the peak reporter signal occurring later in the day (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). By plotting the time of peak reporter signal versus day length, we found that the driven behavior of the clock follows a simple scaling law: the clock phase is proportional to day length (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). The proportionality constant, <italic>m</italic>, falls in an intermediate range (<xref ref-type="table" rid="tbl1">Table 1</xref>) between the limits corresponding to either dawn (<italic>m</italic> = 0) or dusk (<italic>m</italic> = 1) fully resetting the clock. The linear relationship between clock phase and day length with slope <italic>m</italic> ≈ 0.5 implies that cyanobacteria set their clocks to reach the same internal time at the middle of the daylight hours, independent of day length. This entrainment behavior is not unique to the <italic>kaiBC</italic> promoter; a reporter for <italic>purF</italic>, a representative of the dawn class of genes, shows similar scaling behavior (<xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>).<table-wrap id="tbl1" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.014</object-id><label>Table 1.</label><caption><p>Summary of biologically independent in vivo experiments measuring entrainment to 24 hr light-dark cycles of varying day length and corresponding estimates of <italic>m</italic>, the proportionality coefficient between the peak time of <italic>P<sub>kaiBC</sub>::luxAB</italic> reporter and day length during light-dark entrainment.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.014">http://dx.doi.org/10.7554/eLife.23539.014</ext-link></p></caption><table frame="hsides" rules="groups"><thead><tr><th valign="top">Figure</th><th valign="top">Driving period <italic>T</italic> (hr)</th><th valign="top">Day length <italic>τ</italic> (hr)</th><th valign="top">Slope <italic>m</italic> ± <italic>SD of estimate</italic></th></tr></thead><tbody><tr><td valign="top"><xref ref-type="fig" rid="fig1">Figure 1C</xref></td><td valign="top">24</td><td valign="top">4, 6, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20</td><td valign="top">0.55 ± 0.02 (sinusoidal fitting) <break/>0.53 ± 0.01 (parabolic fitting)</td></tr><tr><td valign="top"><xref ref-type="fig" rid="fig1">Figure 1—figure supplement 2</xref></td><td valign="top">24</td><td valign="top">8, 12, 16</td><td valign="top">0.47 ± 0.03 (sinusoidal fitting) <break/>0.57 ± 0.02 (parabolic fitting)</td></tr><tr><td valign="top"><xref ref-type="fig" rid="fig5">Figure 5C</xref></td><td valign="top">22, 23, 24, 25, 26</td><td valign="top">8, 10, 12, 14</td><td valign="top">0.51 ± 0.11 (sinusoidal fitting)</td></tr></tbody></table></table-wrap></p><p>The fact that the core oscillator of the cyanobacterial circadian clock can be reconstituted in vitro from purified Kai proteins (<xref ref-type="bibr" rid="bib26">Nakajima et al., 2005</xref>; <xref ref-type="bibr" rid="bib19">Kageyama et al., 2006</xref>) naturally led to the question of whether the ability to track midday in vivo is intrinsic to the core oscillator, or if it requires additional factors present in the cell. We thus sought to extend the reconstituted system such that we could drive the biochemical oscillator with rhythmic input signals.</p></sec><sec id="s2-2"><title>In vitro reconstitution of seasonal clock response</title><p>A purified mixture of the KaiA, KaiB, and KaiC proteins spontaneously generates a stable circadian rhythm in KaiC phosphorylation and in the formation of KaiB-KaiC complexes (<xref ref-type="bibr" rid="bib26">Nakajima et al., 2005</xref>; <xref ref-type="bibr" rid="bib19">Kageyama et al., 2006</xref>). Although the Kai proteins are not light-sensitive, recent work has shown that they are sensitive to metabolite pools that shift in response to changes in photosynthetic activity in the cell: KaiA is sensitive to the redox state of quinones, and KaiC phosphorylation is sensitive to the ATP/ADP ratio (<xref ref-type="bibr" rid="bib40">Rust et al., 2011</xref>; <xref ref-type="bibr" rid="bib20">Kim et al., 2012</xref>; <xref ref-type="bibr" rid="bib32">Phong et al., 2013</xref>). We thus developed a protocol to mimic repeated light-dark cycles in vitro by cycling the ATP/ADP ratio between physiologically relevant levels experienced during the day and night (<xref ref-type="bibr" rid="bib30">Pattanayak et al., 2014</xref>), using ADP addition to simulate nightfall ([ATP]/([ATP]+[ADP]) ≈ 25%) followed by buffer exchange into an ATP-only buffer to simulate dawn ([ATP]/([ATP]+[ADP]) ≈ 100%) (<xref ref-type="fig" rid="fig2">Figure 2A</xref>).<fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.015</object-id><label>Figure 2.</label><caption><title>Reconstitution of the seasonal clock response in vitro.</title><p>(<bold>A</bold>) Buffer exchange protocol to simulate metabolic driving of the clock. To mimic daytime in vitro, purified Kai proteins (<italic>green, blue and red symbols</italic>) were incubated in ‘day’ reaction buffer containing ATP. ADP was added to mimic nightfall ([ATP]/([ATP]+[ADP]) ≈ 25%). At simulated dawn, reactions were returned to ‘day’ buffer via buffer exchange. (<bold>B</bold>) Example traces of KaiC phosphorylation rhythm from in vitro reactions mimicking LD 18:6 (<italic>top</italic>), LD 12:12 (<italic>middle</italic>), and LD 6:18 (<italic>bottom</italic>). (<bold>C</bold>) Phase of KaiABC oscillation scales linearly with simulated day length (time spent in ‘day’ buffer), as assessed by the peak time of KaiC phosphorylation (<italic>black squares</italic>) or peak time of fluorescence polarization (<italic>cyan squares</italic> and <italic>circles</italic>, for two replicates) of fluorescently labeled KaiB. Peak times of fluorescence polarization were estimated from sinusoidal fits to oscillations recorded in free-running conditions after entraining the oscillator with three metabolic cycles. Peak time of %P-KaiC was estimated by fitting sinusoids to KaiC phosphorylation time series from the third day of reactions. Error bars represent uncertainty of fit phase from sinusoidal regression. Lines of best fit were determined by linear regression (<italic>cyan squares: m</italic> = 0.39 ± 0.06, <italic>cyan circles: m</italic> = 0.36 ± 0.04, <italic>black: m</italic> = 0.51 ± 0.04). In vivo data (from <xref ref-type="fig" rid="fig1">Figure 1C</xref>) is plotted in <italic>red</italic>. Scaling of entrained phase was measured once via KaiC phosphorylation analysis (<italic>black</italic>) and twice using the fluorescence polarization probe (<italic>cyan squares</italic> and <italic>circles</italic>) with an independent preparation of proteins.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.015">http://dx.doi.org/10.7554/eLife.23539.015</ext-link></p><p><supplementary-material id="SD8-data"><object-id pub-id-type="doi">10.7554/eLife.23539.016</object-id><label>Figure 2—source data 1.</label><caption><title>Source data for <xref ref-type="fig" rid="fig2">Figure 2B</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.016">http://dx.doi.org/10.7554/eLife.23539.016</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig2-data1-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD9-data"><object-id pub-id-type="doi">10.7554/eLife.23539.017</object-id><label>Figure 2—source data 2.</label><caption><title>Source data for <xref ref-type="fig" rid="fig2">Figure 2C</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.017">http://dx.doi.org/10.7554/eLife.23539.017</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig2-data2-v2.xlsx"/></supplementary-material></p><p><supplementary-material id="SD10-data"><object-id pub-id-type="doi">10.7554/eLife.23539.018</object-id><label>Figure 2—source data 3.</label><caption><title>Source data for <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.018">http://dx.doi.org/10.7554/eLife.23539.018</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig2-data3-v2.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.019</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Validation of KaiB fluorescence polarization reporter against KaiC phosphorylation rhythm.</title><p>(<italic>top</italic>) Fluorescence polarization of KaiABC mixture probed with fluorescently labeled KaiB exhibits ≈24 hr rhythms (<italic>black and blue squares</italic>). (<italic>bottom</italic>) KaiC phosphorylation rhythm of the same reaction mixtures as in the top panel (<italic>black and blue squares</italic>). <italic>Black vs blue markers</italic> show data from two identical reactions started at different times. Curves show best-fit sinusoids, where all fits share a common period; the phase offset between out-of-phase reactions was also a shared parameter across fits to polarization and phosphorylation datasets. This experiment was performed once.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.019">http://dx.doi.org/10.7554/eLife.23539.019</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig2-figsupp1-v2"/></fig></fig-group></p><p>We found that the KaiC phosphorylation rhythm readily responded to this metabolite pulsing protocol (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Stepping down to lower ATP/ADP conditions promoted dephosphorylation, in accord with previously published observations (<xref ref-type="bibr" rid="bib30">Pattanayak et al., 2014</xref>). Conversely, stepping up to higher ATP/ADP conditions favored phosphorylation (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Pulsing the ATP/ADP ratio in this way caused the KaiC phosphorylation rhythm to synchronize to the external cycle. By the third cycle, the oscillator appeared to have stably entrained, and, similar to the clock behavior that we observed in live cells, longer times in daytime buffer led to later peak phosphorylation times. We estimated peak times for these oscillator reactions during the third entraining cycle and found that the phase of the in vitro rhythm scales linearly in proportion with simulated day length (<xref ref-type="fig" rid="fig2">Figure 2C</xref>), with KaiC phosphorylation rhythm peaking roughly 3 hr after the midpoint of simulated daytime, suggesting that the reconstituted Kai oscillator is capable of tracking the approximate midday point of an externally imposed metabolic rhythm.</p><p>To more accurately measure the scaling of entrained phase with day length in KaiABC oscillator reactions, we turned to a fluorescence polarization probe that enables automated measurement of oscillator state with high temporal resolution (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>) (<xref ref-type="bibr" rid="bib1">Chang et al., 2012</xref>; <xref ref-type="bibr" rid="bib11">Heisler et al., 2017</xref>). We used this assay to determine clock phases in free-running conditions after entraining the Kai proteins with three metabolic cycles, analogous to the design of the in vivo experiments. We again measured linear scaling of the entrained phase, albeit with a lower slope than the estimate from sparser gel-based measurements of KaiC phosphorylation (<italic>m</italic> = 0.38 ± 0.07 for polarization probe vs. <italic>m</italic> = 0.51 ± 0.04 for phosphorylation data, <xref ref-type="fig" rid="fig2">Figure 2C</xref>). Despite the variability in our estimates of <italic>m</italic>, these measurements suggest that the in vitro oscillator successfully captures the essential feature of seasonal entrainment we observed in vivo: linear scaling of entrained phase with an intermediate slope.</p><p>In the cell, the Kai proteins interact with histidine kinases and a network of other factors absent from the reconstituted system, ultimately leading to rhythms in transcription across the genome, including the <italic>kai</italic> genes themselves (<xref ref-type="bibr" rid="bib44">Takai et al., 2006</xref>; <xref ref-type="bibr" rid="bib10">Gutu et al., 2013</xref>; <xref ref-type="bibr" rid="bib24">Markson et al., 2013</xref>). These additional factors may account for the differences we observe between proportionality constants in vitro and in vivo, and the time delay between KaiC phosphorylation and luminescent output of the <italic>kaiBC</italic> expression reporter is likely responsible for the offset in <xref ref-type="fig" rid="fig2">Figure 2C</xref>. While these considerations suggest that care must be taken in connecting the in vitro and in vivo results, they also underscore the significance of our observation that the Kai oscillator proteins by themselves are sufficient to yield the linear response of the system to altered day length. We therefore sought to use this in vitro model of seasonality to uncover the biochemical basis of the linear seasonal clock response.</p></sec><sec id="s2-3"><title>Seasonal adaptation of the circadian oscillator can be decomposed into step responses to individual metabolic cues</title><p>In the purified system, the entraining cues are steps between high and low ATP/ADP that simulate dawn and dusk. We therefore sought to decompose the seasonal adaptation of the clock into step responses following each metabolic transition. This approach is related to the limit cycle theory of oscillators: if we assume that a unique stable orbit exists for both the day and night conditions, then a metabolic transition forces the system to adjust from its current cycle to one associated with the new condition. If relaxation to the new orbit occurs rapidly relative to the length of the day—that is, if the light and dark orbits are strongly attracting—then the state of the oscillator at each transition can be specified simply by a phase angle on that orbit. In this limit, the response of the system is fully determined by instantaneous phase shifts caused by the transitions. Mathematically, we describe this limit as an oscillator comprised of a single phase variable, <inline-formula><mml:math id="inf1"><mml:mi>θ</mml:mi></mml:math></inline-formula>, that runs along a fixed limit cycle trajectory at constant speed (see Appendix 1). The responses to dark-to-light or light-to-dark transitions are then represented by phase shifts that are specified by the functions <inline-formula><mml:math id="inf2"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf3"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, respectively.</p><p>To determine whether this fast-relaxation approximation can describe phase shifts in the core Kai oscillator, and to study their biochemical basis, we measured the <inline-formula><mml:math id="inf4"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf5"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> shift functions in our reconstituted system. To measure the <inline-formula><mml:math id="inf6"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> function, we incubated the Kai proteins in daytime buffer, then transferred them into nighttime buffer at various times throughout the circadian cycle and studied how the oscillation was affected. As above, we assayed oscillator response in separate experiments using either SDS-PAGE to measure KaiC phosphorylation or the fluorescence polarization probe to achieve high temporal resolution. Example time series from the fluorescence polarization measurements are shown in <xref ref-type="fig" rid="fig3">Figure 3A–B</xref>.<fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.020</object-id><label>Figure 3.</label><caption><title>Clock responses to metabolic steps mimicking dawn (step up) and dusk (step down).</title><p>(<bold>A</bold>) Phase shift in fluorescence polarization (<italic>red curve</italic>) caused by a shift to a buffer that mimics the nucleotide pool at night ([ATP]/([ATP]+[ADP]) ≈ 25%, <italic>gray bar</italic>). The control reaction remained in the original buffer (<italic>black curve</italic>). (<bold>B</bold>) Phase shift in fluorescence polarization (<italic>blue curve</italic>) caused by a shift from night buffer back to day buffer ([ATP]/([ATP]+[ADP]) ≈ 100%, <italic>beige bar</italic>). (<bold>C, D</bold>) Summary of phase shifts caused by metabolic step-down (<bold>C</bold>) or step-up (<bold>D</bold>) perturbations throughout the clock cycle. Simulated day-night or night-day steps were administered as in (<bold>A</bold>) and (<bold>B</bold>). Different colors represent independent measurements. To estimate the phase of each reaction, trajectories were fit to sinusoids. Phase shifts were determined relative to the respective control reactions. The times at which buffer steps were administered were converted to circadian time (CT 0 corresponds to the estimated trough of KaiC phosphorylation based on <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). Colored arrows indicate clock phases when metabolic shifts occur in entrained conditions. (<bold>E, F</bold>) Analogs of (<bold>C, D</bold>) for the gel-based phosphorylation measurements on an independent preparation of Kai proteins. Error bars represent standard deviations calculated by bootstrapping (see Computational methods). Horizontal error bars are smaller than marker widths.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.020">http://dx.doi.org/10.7554/eLife.23539.020</ext-link></p><p><supplementary-material id="SD11-data"><object-id pub-id-type="doi">10.7554/eLife.23539.021</object-id><label>Figure 3—source data 1.</label><caption><title>Source data for <xref ref-type="fig" rid="fig3">Figure 3A–B</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.021">http://dx.doi.org/10.7554/eLife.23539.021</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig3-data1-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD12-data"><object-id pub-id-type="doi">10.7554/eLife.23539.022</object-id><label>Figure 3—source data 2.</label><caption><title>Source data for <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.022">http://dx.doi.org/10.7554/eLife.23539.022</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig3-data2-v2.xlsx"/></supplementary-material></p><p><supplementary-material id="SD13-data"><object-id pub-id-type="doi">10.7554/eLife.23539.023</object-id><label>Figure 3—source data 3.</label><caption><title>Source data for <xref ref-type="fig" rid="fig3">Figure 3E–F</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.023">http://dx.doi.org/10.7554/eLife.23539.023</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig3-data3-v2.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig3-v2"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.024</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Example calculation of phase shifts in response to metabolic step transitions.</title><p>Phase shifts are computed from the difference in phase of the control reaction and the perturbed reaction evaluated at the time of the step. Phase of each reaction at the time of the step (<italic>green dashed line</italic>) is calculated based on the sinusoidal fit to the normalized fluorescence polarization trajectory for that reaction. Periods of the oscillator in day and night conditions were fit globally to all reactions measured in one experiment. See Computational methods for fitting details.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.024">http://dx.doi.org/10.7554/eLife.23539.024</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig3-figsupp1-v2"/></fig><fig id="fig3s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.025</object-id><label>Figure 3—figure supplement 2.</label><caption><title>Experimentally measured step-response functions predict entrainment to driving periods near 24 hr.</title><p>(<bold>A</bold>) Entrainment simulations with driving periods 4–48 hr were performed for 1000 cycles, and phases at the end of nighttime (immediately before the action of <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) of the last 920 cycles were plotted. Simulation results are double-plotted along the vertical axis for clarity. In each simulation, the oscillator runs at constant angular speed in the light and dark, and experiences instantaneous phase shifts at dawn and dusk, according to the values of <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. Refer to <xref ref-type="fig" rid="fig4">Figure 4A</xref> for an illustration of a single entrainment simulation.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.025">http://dx.doi.org/10.7554/eLife.23539.025</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig3-figsupp2-v2"/></fig></fig-group></p><p>We proceeded to calculate phase shifts from these measurements, taking into consideration that a switch to nighttime buffer conditions could affect the oscillator in two ways: the phase of the oscillation can shift, and the oscillator period may change, both of which can change the relative timing of peaks. To separate these effects, it is necessary to collect enough data to accurately determine the period, and then extrapolate backwards to infer the instantaneous phase shift at the time of buffer exchange. We detail our procedure for analyzing these data to extract phase shifts in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>. We used an analogous design to measure the reverse steps from nighttime to daytime buffer (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). Plotted together in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, the extrapolated phase shifts measure the sensitivity of the clock to individual light and dark steps throughout the 24 hr day.</p><p>The measured <inline-formula><mml:math id="inf10"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> step-response functions show that the phase of the purified KaiABC oscillator is responsive to both step-up and step-down metabolic changes. For example, a day-to-night shift lengthens the period of the clock by about 2 hr, and, when it is applied at subjective morning, leads to an instantaneous phase delay of about 3 hr (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). On the other hand, a night-to-day transition in the middle of subjective night shortens the period and causes a phase advance of about 1.5 hr.</p><p>These measurements characterize how the oscillator responds to a metabolic step-change throughout the entire clock cycle. However, when the clock is stably synchronized to a cycling environment, dawn and dusk fall only in a limited window of clock phases. To determine this window, we returned to our measurements in <xref ref-type="fig" rid="fig2">Figure 2C</xref>. We identified phases that correspond to dawn or dusk in entrained conditions mimicking LD 6:18 to LD 18:6 and marked these phases on the <inline-formula><mml:math id="inf12"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf13"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> functions (<xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, colored arrows). These points fell on gradually changing, approximately linear, regions of both curves, spanning roughly 6 hr windows near subjective dawn (for <inline-formula><mml:math id="inf14"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) and subjective dusk (for <inline-formula><mml:math id="inf15"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>). Because these regions of <inline-formula><mml:math id="inf16"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf17"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> represent phase shifts comparable in magnitude but opposite in sign, we hypothesized that their opposing forces could enable oscillator entrainment to light-dark cycles.</p><p>To check this hypothesis, we simulated a simple (phase-only) oscillator that runs at constant frequencies in the light and dark and adjusts its phase in response to dawn and dusk according to the phase shift functions that we measured in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref> (see Computational methods). This model maps the one-dimensional phase variable from one cycle to the next according to <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. We analyzed the stability properties of this map and found that the oscillator could entrain with a unique phase to driving periods of within 4–5 hr of its natural circadian period. Outside this range, the oscillator failed to entrain or exhibited more complex dynamics (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2</xref>).</p><p>We proceeded to test whether the measured <inline-formula><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> step-response functions could successfully reproduce the entrainment of the oscillator to repeated 24 hr metabolic cycles of varying day length, shown in <xref ref-type="fig" rid="fig2">Figure 2</xref>. When subjected to light-dark cycles in simulations, the oscillator model stably entrains to the diurnal schedule within two-to-five cycles (<xref ref-type="fig" rid="fig4">Figure 4A–B</xref>, <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1A</xref>). Importantly, the simulated entrained phase scales linearly with day length with a slope similar to the experimental data, indicating that the driven clock response can indeed be decomposed into a series of step responses to environmental transitions (<xref ref-type="fig" rid="fig4">Figure 4C</xref>).<fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.026</object-id><label>Figure 4.</label><caption><title>Entrainment of the phase oscillator model to a driving cycle.</title><p>(<bold>A</bold>) Schematic of a phase-only oscillator that responds to dawn and dusk with instantaneous phase shifts. The oscillator runs at constant velocities <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> during the day and <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> at night (<italic>green lines</italic>), except for dawn and dusk where sudden shifts occur (<italic>red and blue arrows</italic>). This simulation illustrates entrainment to a LD 12:12 cycle for an oscillator with <inline-formula><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> (1/23.7 hr), <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> (1/25.7 hr), and <inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> as experimentally measured for the KaiABC oscillator (see main text, Computational Methods). Refer to <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1B</xref> for illustrations of <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf29"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> used in this simulation. (<bold>B</bold>) Simulated approach to stable entrainment in the model (as in <xref ref-type="fig" rid="fig4">Figure 4A</xref>) for light-dark cycles of different day length (<italic>τ</italic> = 8–14 hr). (<bold>C</bold>) Simulated seasonal response of an oscillator that responds rapidly to light-dark cues according to the phase shift functions in <xref ref-type="fig" rid="fig3">Figure 3C</xref> (see text). In simulations, <inline-formula><mml:math id="inf30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is defined as the time when oscillator phase <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> equals π rad (0.5 cycles), corresponding to the peak of KaiC phosphorylation. Shaded areas correspond to standard deviations of entrainment simulations using the four possible combinations of <inline-formula><mml:math id="inf32"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf33"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> functions shown in <xref ref-type="fig" rid="fig3">Figure 3(C–D)</xref>. <italic>Blue squares and circles</italic> indicate experimentally determined entrained phases measured using the fluorescence polarization reporter in <xref ref-type="fig" rid="fig2">Figure 2C</xref>. Peak times in polarization data were converted to equivalent peak KaiC phosphorylation times using the measured phase offset for the polarization reporter (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). Error bars on in vitro data show uncertainty of fit phase.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.026">http://dx.doi.org/10.7554/eLife.23539.026</ext-link></p><p><supplementary-material id="SD14-data"><object-id pub-id-type="doi">10.7554/eLife.23539.027</object-id><label>Figure 4—source data 1.</label><caption><title>Source data for <xref ref-type="fig" rid="fig4">Figure 4C</xref>.</title><p>This file contains data from in vitro entrainment measurements shown as blue circles and squares.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.027">http://dx.doi.org/10.7554/eLife.23539.027</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig4-data1-v2.csv"/></supplementary-material></p><p><supplementary-material id="SD15-data"><object-id pub-id-type="doi">10.7554/eLife.23539.028</object-id><label>Figure 4—source data 2.</label><caption><title>Source data for <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>.</title><p>This file contains in vitro entrainment measurements shown as blue squares in <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2B</xref>.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.028">http://dx.doi.org/10.7554/eLife.23539.028</ext-link></p></caption><media mime-subtype="octet-stream" mimetype="application" xlink:href="elife-23539-fig4-data2-v2.csv"/></supplementary-material></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig4-v2"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.029</object-id><label>Figure 4—figure supplement 1.</label><caption><title>Example simulation of a phase oscillator governed by one set of experimentally determined <inline-formula><mml:math id="inf34"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf35"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> functions and subjected to a driving cycle.</title><p>(<bold>A</bold>) The phase oscillator reaches stable entrainment within 3–5 light-dark cycles (<italic>τ</italic> = 10–14 hr) for a wide range of starting phases. Simulation parameters same as in <xref ref-type="fig" rid="fig4">Figure 4B</xref>; <inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> as shown in (<bold>B</bold>) below. (<bold>B</bold>) Example pair of step response functions, denoted <inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, measured using the fluorescence-polarization reporter of KaiB-KaiC binding (magenta and blue curves in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>). Colored circles mark phases corresponding to dawn (on <inline-formula><mml:math id="inf40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) and dusk (on <inline-formula><mml:math id="inf41"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) in seasonal entrainment simulations of different day length <italic>τ</italic> (see color bar). <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 refers to the phase when the minimum of the KaiC phosphorylation rhythm occurs. See Computational methods for details.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.029">http://dx.doi.org/10.7554/eLife.23539.029</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig4-figsupp1-v2"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.030</object-id><label>Figure 4—figure supplement 2.</label><caption><title>Simulations of seasonal entrainment for a phase oscillator driven by linearized step-response functions (<inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf44"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>).</title><p>(<bold>A</bold>) Simulated seasonal response of phase oscillators governed by the four possible combinations of nonlinear <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> step-response functions in <xref ref-type="fig" rid="fig3">Figure 3(C–D)</xref> (<italic>blue shaded areas</italic>) and their linearized versions <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> (<italic>shaded green areas</italic>). In simulations, <inline-formula><mml:math id="inf49"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is defined as the time when oscillator phase <inline-formula><mml:math id="inf50"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> equals π rad (0.5 cycles), corresponding to the peak of KaiC phosphorylation. In vitro measurements overlaid in blue as in <xref ref-type="fig" rid="fig4">Figure 4C</xref>. (<bold>B</bold>) Simulated seasonal response of phase oscillators governed by step-response functions measured for an independent preparation of clock proteins using SDS-PAGE analysis of KaiC phosphorylation <xref ref-type="fig" rid="fig3">Figure 3(E–F)</xref>. Shaded areas correspond to standard deviations determined by bootstrapping (see Computational methods). <italic>Blue squares</italic> show seasonal response measured in the purified KaiABC oscillator using the same preparation of proteins and measured via SDS-PAGE (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is defined as in (<bold>B</bold>) above. Error bars represent uncertainty of fit phase from sinusoidal regression. (<bold>C</bold>) Example pair of step-response functions <inline-formula><mml:math id="inf52"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf53"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and their linearized versions, <inline-formula><mml:math id="inf54"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, used in simulations in (<bold>A</bold>) above and measured using the fluorescence-polarization reporter of KaiB-KaiC binding (magenta and blue curves in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>). Colored circles mark stably entrained phases corresponding to dawn (for <inline-formula><mml:math id="inf56"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) and dusk (for <inline-formula><mml:math id="inf57"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) in simulations of different day length <italic>τ</italic> (see color bar). <inline-formula><mml:math id="inf58"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 refers to the minimum of the KaiC phosphorylation rhythm. See Computational methods for details.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.030">http://dx.doi.org/10.7554/eLife.23539.030</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-23539-fig4-figsupp2-v2"/></fig><fig id="fig4s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.031</object-id><label>Figure 4—figure supplement 3.</label><caption><title>Dependence of the slope of entrained phase on the slopes of step response functions.</title><p>Heat map of slope <italic>m</italic>, describing the scaling of oscillator peak time with day length, as a function of the slopes <italic>l</italic> and <italic>d</italic> of linear <inline-formula><mml:math id="inf59"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf60"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> step response functions and oscillator frequencies in light and dark (<inline-formula><mml:math id="inf61"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf62"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) (see main text and Appendix 1). This relationship is described by <inline-formula><mml:math id="inf63"><mml:mrow><mml:mi>m</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>. The ratio of oscillator frequencies in light and dark was estimated to be <inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.93</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> based on the analysis of datasets in <xref ref-type="fig" rid="fig3">Figure 3(C–D)</xref>. Dashed isolines connect all points with <italic>m</italic> = 0.53 (<italic>left</italic>) and <italic>m</italic> = 0.38 (<italic>right</italic>), corresponding to our estimates of scaling coefficients in vivo and in vitro in <xref ref-type="fig" rid="fig2">Figure 2(C)</xref>. The approximate range of values of <italic>l</italic> and <italic>d</italic> estimated from experimental measurements in <xref ref-type="fig" rid="fig3">Figure 3(C–D)</xref> is indicated by the white crosshair. Crosshair lengths represent mean±standard deviation of estimates of <italic>l</italic> and <italic>d</italic> determined by bootstrapping, as described in Computational methods. Negative values of <italic>m</italic> are colored in grey.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.031">http://dx.doi.org/10.7554/eLife.23539.031</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-23539-fig4-figsupp3-v2"/></fig></fig-group></p><p>As described above, we also measured <inline-formula><mml:math id="inf65"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf66"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> step-response functions with a separate preparation of Kai proteins using a gel-based assay to read out the phase of the KaiC phosphorylation rhythm (<xref ref-type="fig" rid="fig3">Figure 3E–F</xref>). Although the absolute magnitude of the step responses in these measurements was larger, they still predict linear scaling of entrained phase in simulations for day lengths between 6 and 14 hr (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2B</xref>). The discrepancy in magnitude between these measurements may point to differences in sensitivity to input cues between different preparations of Kai proteins, or to a slight perturbative effect of fluorescently labeled KaiB.</p><p>We found that simulated entrainment of the phase oscillator model was particularly sensitive to the regions surrounding subjective dusk (for <inline-formula><mml:math id="inf67"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>) and subjective dawn (for <inline-formula><mml:math id="inf68"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3E–F</xref>, <italic>colored arrows</italic>). Because the fluorescence polarization approach allows us to measure many conditions in an automated way over many days, and thus to disentangle phase shifts from period differences (<xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>), these higher time resolution measurements better constrain the portions of the response functions critical for entrainment.</p><p>Given the observation that oscillator entrainment was sensitive to local shapes of <inline-formula><mml:math id="inf69"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf70"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, we wondered if midday tracking requires a specific form of these response functions or if certain generic features are sufficient. Based on our observation that <inline-formula><mml:math id="inf71"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf72"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> in the KaiABC system are approximately linear in the regions used during metabolic entrainment, we asked whether linear <inline-formula><mml:math id="inf73"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf74"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> would result in a linear dependence of clock phase on day length.</p></sec><sec id="s2-4"><title>Linear regions of step-response functions underlie proportional tracking of day length</title><p>Consider a phase oscillator driven by light-dark cycles of period <italic>T</italic> and day length <italic>τ</italic> (<xref ref-type="fig" rid="fig7">Figure 7</xref>). When the oscillator is entrained (phase-locked) to the light-dark cycle, the oscillator returns to the same state by the end of a full cycle. Starting from an initial phase <inline-formula><mml:math id="inf75"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, the clock accumulates phase <inline-formula><mml:math id="inf76"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> during the day, then experiences a phase shift of magnitude <inline-formula><mml:math id="inf77"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> at dusk, accumulates phase <inline-formula><mml:math id="inf78"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> at night, and finally responds to dawn with a phase shift <inline-formula><mml:math id="inf79"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>:<fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.032</object-id><label>Figure 7.</label><caption><title>Phase oscillator entrainment.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.032">http://dx.doi.org/10.7554/eLife.23539.032</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-23539-fig7-v2"/></fig></p><p>Here all angles are measured in units of cycles (<inline-formula><mml:math id="inf80"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1</mml:mn><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">y</mml:mi><mml:mi mathvariant="normal">c</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>), and <inline-formula><mml:math id="inf81"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> are the oscillator frequencies in the light and dark, respectively. For stable entrainment, the effects of <inline-formula><mml:math id="inf83"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at dawn and <inline-formula><mml:math id="inf84"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> at dusk must balance the phase accumulated by the oscillator, so that the phase returns to the same point at the end of each cycle.</p><p>This expression for the entrained clock phase scales linearly with day length if its derivative with respect to <italic>τ</italic> is constant. The simplest way to achieve this condition is if <inline-formula><mml:math id="inf85"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf86"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are themselves linear functions of <inline-formula><mml:math id="inf87"><mml:mi>θ</mml:mi></mml:math></inline-formula>, such that <inline-formula><mml:math id="inf88"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf89"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> over the relevant range of clock times. If oscillator frequency is the same in light and dark, as is approximately true for the Kai oscillator (<inline-formula><mml:math id="inf90"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> 0.93 ± 0.01, see Computational methods), the peak time of the oscillation (measured in hours after dawn) can be expressed as <inline-formula><mml:math id="inf91"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mi>m</mml:mi><mml:mi>τ</mml:mi><mml:mo>+</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula>, with the slope <inline-formula><mml:math id="inf92"><mml:mrow><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mo>(</mml:mo><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> determined by the slopes of the linear <inline-formula><mml:math id="inf93"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf94"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> functions. If the day and night oscillator frequencies differ, we still obtain a linear dependence on day length, but with an altered expression for the proportionality constant <italic>m</italic> (see Appendix 1). This expression for <italic>m</italic> imposes constraints on values of <italic>l</italic> and <italic>d</italic> required for an oscillator to track different portions of the day-night cycle. <xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref> highlights the requirements on <italic>l</italic> and <italic>d</italic> for a midday-tracking clock.</p><p>To determine whether <inline-formula><mml:math id="inf95"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf96"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for the Kai oscillator are in line with these mathematical requirements, we examined the linear portions of the step-response functions in <xref ref-type="fig" rid="fig3">Figure 3</xref>. Indeed, the slopes of <inline-formula><mml:math id="inf97"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf98"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from the fluorescence polarization assay (<italic>l</italic> = 0.34 ± 0.03, <italic>d</italic> = 0.38 ± 0.05) predict an <italic>m</italic> value consistent with our measurements of the entrained in vitro oscillator using the same method (<italic>m</italic>(<italic>l</italic>, <italic>d</italic>) = 0.34 ± 0.04, calculated in the linear model vs. <italic>m</italic> = 0.38 ± 0.07, measured) (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>).</p><p>Because <inline-formula><mml:math id="inf99"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf100"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> are periodic functions on a circle, they cannot be linear everywhere with non-integer slope. However, maintaining the linear scaling of phase with day length only requires that both <inline-formula><mml:math id="inf101"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf102"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> be linear over the range of clock times when dawn and dusk occur, respectively, with the nonlinearities required to satisfy periodicity appearing at other times. The exact width of the linear region of <inline-formula><mml:math id="inf103"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf104"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> depends on <italic>m</italic> and the range of day lengths that the oscillator is required to track. For example, an oscillator capable of tracking midday (<italic>m</italic> = 0.5) over a 12 hr range of day lengths requires that <inline-formula><mml:math id="inf105"><mml:mrow><mml:mo> </mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf106"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> be linear over at least one quarter of the cycle. This criterion is met by the measured <inline-formula><mml:math id="inf107"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf108"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figures 3C-D</xref>).</p><p>To further test whether entrainment of the Kai system can be described by this framework, we returned to our phase oscillator simulations (<xref ref-type="fig" rid="fig4">Figure 4</xref>). When we replaced our experimentally measured <inline-formula><mml:math id="inf109"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf110"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>functions with linear approximations, the simulated oscillator exhibited a similar scaling of entrained phase over a wide range of day lengths (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2A–B</xref>). The linear approximations work because the regions where the step response functions deviate strongly from linearity are avoided in our entrainment simulations (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2C</xref>).</p><p>Together, these results indicate that the driven behavior of the cyanobacterial circadian clock in 24 hr cycles can be approximated as a simple oscillator that shifts in response to light-dark transitions with a sensitivity that varies linearly with phase. To test whether this linear mathematical framework holds more generally and to understand how the cyanobacterial clock responds to a broader range of environments, we sought to measure clock response to a variety of external conditions with both single and repeated light-dark transitions.</p></sec><sec id="s2-5"><title>The behavior of the driven circadian clock across diverse conditions can be collapsed to a simple mathematical representation</title><p>The phase oscillator model described above was inspired by the observation of linear scaling of clock phase in 24 hr days with various day lengths. The key model assumptions are (i) a unique clock cycle in the light and in the dark, (ii) rapid relaxation from one cycle to another when conditions change, and (iii) sensitivity to environmental changes that varies linearly with clock time. While these assumptions hold, the model should be capable of describing the behavior of a biological clock in arbitrary fluctuating environments. For example, the response to a single dark pulse can be decomposed into sequential step-down and step-up responses.</p><p>To test the range of validity of this mathematical model, we used our LED array system (<xref ref-type="fig" rid="fig1">Figure 1A</xref>) to collect data on <italic>S. elongatus</italic> clock function in response to dark pulses administered at different clock times. This corresponds to a classical phase response curve (PRC) analysis, a commonly used tool in circadian biology for characterizing the response of a biological clock to perturbations. We also probed clock responses to dark pulses of varying lengths (a so-called ‘wedge’ analysis), and to repeated light-dark cycles with periods different from 24 hr. Our phase oscillator model predicts that the quantitative response to these various perturbations should all be related through the step-up and step-down functions (see Appendix 1). One specific prediction of the model is that changing the time at which a dark pulse begins and the duration of a dark pulse should have separable linear effects on the oscillator, which would manifest as linear curves in phase response and wedge analyses. These experimental data and a fit of our linear model to the results are presented in <xref ref-type="fig" rid="fig5">Figure 5</xref>. The lines of best fit in <xref ref-type="fig" rid="fig5">Figure 5A–C</xref> were obtained from a global fit to all of the datasets, with two fitting parameters that fix the slopes of the regression lines across all conditions (Appendix 1). The overall agreement between the model and data suggest that limited data on clock response can be successfully extrapolated to other conditions using this approach.<fig-group><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.033</object-id><label>Figure 5.</label><caption><title>Phase oscillator model with linear phase shift functions predicts entrainment of the cyanobacterial clock to different light-dark (LD) patterns.</title><p>In all panels, error bars represent standard deviations (n = 4–8 technical replicates per point). Lines are fit globally to all three datasets in (<bold>A</bold>)-(<bold>C</bold>). See Computational methods for details. (<bold>A</bold>) Phase resetting analysis. Phase shifts of bioluminescence rhythm (P<italic><sub>kaiBC</sub>::luxAB</italic>) due to 12 hr dark pulses (<italic>δ</italic> = 12 hr) administered throughout the circadian cycle. The experimental protocol is represented schematically above the graph. Cells were exposed to one 12 hr dark pulse and released into constant light; 12 hr dark pulses were administered at the indicated times. <italic>θ(t<sub>DP</sub>)</italic> is the clock phase at beginning of the dark pulse, with <inline-formula><mml:math id="inf111"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 defined as clock phase at the trough of the bioluminescence rhythm. (<bold>B</bold>) Wedge analysis. Phase shifts of bioluminescence rhythm (P<italic><sub>kaiBC</sub>::luxAB</italic>) due to dark pulses of varied length (<italic>δ</italic> = 8–16 hr) administered near subjective dusk (36 or 39 hr after an initial 12 hr dark pulse). Clock phases at the beginning of the dark pulse are listed in parentheses; <inline-formula><mml:math id="inf112"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 is defined as clock phase at the trough of the bioluminescence rhythm. The experimental protocol is represented schematically above the graph. (<bold>C</bold>) Seasonal response in non-24 hour environmental cycles. Cells were grown in LD cycles with period T = 22–26 hr and day length <italic>τ</italic> = 8–14 hr (see schematic on left). After five entraining cycles, cells were released into LL and the phase of the circadian rhythm was estimated by sinusoidal regression.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.033">http://dx.doi.org/10.7554/eLife.23539.033</ext-link></p><p><supplementary-material id="SD16-data"><object-id pub-id-type="doi">10.7554/eLife.23539.034</object-id><label>Figure 5—source data 1.</label><caption><title>Source data for <xref ref-type="fig" rid="fig5">Figure 5A–C</xref>.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.034">http://dx.doi.org/10.7554/eLife.23539.034</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-23539-fig5-data1-v2.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig5-v2"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.035</object-id><label>Figure 5—figure supplement 1.</label><caption><title>Simulation of a phase-resetting curve.</title><p>(<italic>left</italic>) Simulated phase-resetting curve due to a 12 hr dark pulse for a phase oscillator governed by linear step-response functions <inline-formula><mml:math id="inf113"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf114"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> (<italic>right</italic>), as in in <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>. Colored circles indicate phases at the beginning of the dark pulse (see color bar). <inline-formula><mml:math id="inf115"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 refers to the trough of the KaiC phosphorylation rhythm.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.035">http://dx.doi.org/10.7554/eLife.23539.035</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig5-figsupp1-v2"/></fig></fig-group></p><p>To understand the implications of these results, consider the phase response curve (PRC) for a 12 hr dark pulse (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). Although phase response analyses frequently separate PRCs into regions of low sensitivity to perturbation (‘dead zones’) followed by highly nonlinear regions with large phase shifts, our model suggests a different interpretation (<xref ref-type="bibr" rid="bib30">Pattanayak et al., 2014</xref>; <xref ref-type="bibr" rid="bib18">Johnson, 1999</xref>; <xref ref-type="bibr" rid="bib42">Schmitz et al., 2000</xref>; <xref ref-type="bibr" rid="bib31">Pfeuty et al., 2011</xref>). Clock response is weakest at times when nightfall is expected (<italic>t</italic> = 36 and 60 hr) and increases gradually with clock time. The slowly changing regions of the PRC are well described by line segments with the same slope, in agreement with our model based on linear step-response functions<inline-formula><mml:math id="inf116"><mml:mrow><mml:mo> </mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf117"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. The ‘breakpoint’ in the PRC near 50 hr is a consequence of the fact that these periodic step-response functions cannot be linear everywhere with non-integer slope, as discussed earlier.</p><p>In other words, a circadian clock capable of tracking midday over a wide range of day lengths is expected to have a PRC that is approximately linear over many hours except for a narrow region of rapid change that is required to satisfy periodicity. Indeed, in simulations where <inline-formula><mml:math id="inf118"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf119"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> are linear everywhere except for a discontinuous jump, the PRC for a long dark pulse appears as a straight line except for a single breakpoint (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). Near the breakpoint, small changes in the timing of darkness result in large differences in phase shifts, and we would expect to find this region of the PRC at a clock time when such a perturbation is least likely to occur naturally. In the dark-pulse PRC for <italic>S. elongatus</italic>, the breakpoint near 50 hr occurs when prolonged darkness is improbable (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). The maximal phase shift in a PRC can be a useful tool to characterize clock mutants, but our analysis highlights that these regions are unlikely to be experienced in natural conditions and may exist only as consequences of periodicity constraints.</p></sec><sec id="s2-6"><title>A geometric interpretation of oscillator response to varying day length</title><p>Finally, we asked how step response functions with linearly increasing sensitivity are related to the mathematical structure of the oscillator and ultimately to the underlying molecular mechanism. Do step response functions with these properties arise generically, or do they require fine-tuned choices of parameters? To address these issues, we considered the simplest possible dynamical representation that allows for distinct day and night clock cycles. In this model, the clock cycle during the day is represented by a circular limit cycle with unit radius, and the clock time is defined by the angular coordinate of the oscillator on this limit cycle (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). The effect of darkness is to deform the limit cycle, transforming the daytime orbit to a nighttime orbit. For simplicity, we assume this night cycle lies in the same plane as the day cycle and is also circular, but may be offset relative to the day cycle and have a distinct radius (<xref ref-type="fig" rid="fig6">Figure 6A</xref>).<fig-group><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.036</object-id><label>Figure 6.</label><caption><title>Nearly linear step response functions can arise from the relative geometry of day and night limit cycles.</title><p>(<bold>A</bold>) Geometric model of oscillator phase resetting. During the day, the oscillator runs with constant angular velocity along the daytime orbit (<italic>yellow</italic>), which has unit radius and is centered at the origin. At dusk, the oscillator transits to the nighttime orbit (<italic>black</italic>), which has radius <italic>R</italic> and is displaced from the daytime orbit by <italic>X</italic> units. In the limit where the nighttime orbit is strongly radially attracting, we can approximate oscillator response to the light-dark transition (<inline-formula><mml:math id="inf120"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, <italic>red arrow</italic>) as an instantaneous jump from phase <inline-formula><mml:math id="inf121"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> on the daytime orbit toward the center of the nighttime cycle, resulting in phase <inline-formula><mml:math id="inf122"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> on the night orbit. (<bold>B</bold>) Simulation of oscillator phase shifts due to light-dark transitions at different phases on the day orbit (<italic>red arrows</italic>) for <italic>R</italic> = 2, <italic>X</italic> = 2. For geometries with <italic>X</italic> ≈ <italic>R</italic>, phase angles on the day orbit are compressed to an arc on the night limit cycle that subtends a smaller angle. See Computational methods for calculation details. (<bold>C and D</bold>) Simulations of <inline-formula><mml:math id="inf123"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf124"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> step response functions arising from the geometric arrangement of day and night cycles in (<bold>B</bold>). Linear regions of <inline-formula><mml:math id="inf125"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf126"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> are marked with black dashes. See Computational methods and Appendix 1 for calculation details. (<bold>E</bold>) Heat map of the slope <italic>m</italic> of the approximately linear relationship between entrained phase and day length, plotted as a function of <italic>X</italic> and <italic>R</italic>. In white regions, the oscillator does not entrain stably or the oscillator does not show linear scaling of phase with day length. Slope determined from simulations of oscillator entrainment to 24 hr driving cycles of day length <italic>τ</italic> = 6–18 hr. See Computational methods for details. (<bold>F</bold>) Limit cycles traversed by the KaiABC oscillator in vitro in metabolic conditions mimicking day (<italic>yellow</italic>, [ATP]/([ATP]+[ADP]) ≈ 100%) and night (<italic>black</italic>, [ATP]/([ATP]+[ADP]) ≈ 25%). Oscillations in KaiC phosphorylation on Ser431 and Thr432 are replotted from data in <xref ref-type="bibr" rid="bib32">Phong et al. (2013)</xref>.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.036">http://dx.doi.org/10.7554/eLife.23539.036</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig6-v2"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.037</object-id><label>Figure 6—figure supplement 1.</label><caption><title>Illustrations of limit cycle geometries that give rise to step-response functions <inline-formula><mml:math id="inf127"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf128"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> with different slopes, resulting in dusk-, dawn-, or midday-tracking entrainment.</title><p>In all schematics, the day orbit (<italic>yellow</italic>) is centered at the origin and has radius 1. The night orbit (<italic>black</italic>) has radius <italic>R</italic> and is displaced from the day orbit (<inline-formula><mml:math id="inf129"><mml:mrow><mml:mi>log</mml:mi><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> units). Light-dark (<inline-formula><mml:math id="inf130"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) and dark-light (<inline-formula><mml:math id="inf131"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) transitions are indicated by <italic>red</italic> and <italic>blue arrows</italic>, respectively. (<bold>A</bold>) When the night cycle is much smaller than the day cycle (<italic>R</italic> &lt;&lt; 1), both dawn and dusk are strongly resetting (<italic>l</italic>≈1, <italic>d</italic>≈1). Because all phases on the night orbit are mapped to a small range of phases on the day orbit, oscillator phase at dawn is independent of day length during entrainment (<italic>m</italic>≈0, dawn-tracking). (<bold>B</bold>) When the sizes of day and night orbits are comparable (<italic>R</italic> ≈ 1), the slopes of <inline-formula><mml:math id="inf132"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf133"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> depend on the fine-tuned arrangement of the orbits. Generally, both <inline-formula><mml:math id="inf134"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf135"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> exert entraining effects in this regime (<italic>l</italic> &gt; 0, <italic>d &gt;</italic> 0). The slope of entrained phase with day length depends on both <italic>l</italic> and <italic>d</italic>, according to <inline-formula><mml:math id="inf136"><mml:mrow><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mo>(</mml:mo><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> (see <xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref> and Appendix 1). (<bold>C</bold>) When the night cycle is much bigger than the day cycle (<italic>R</italic> &gt;&gt; 1), dusk is strongly resetting, but dawn transitions have little effect on clock phase (<italic>l</italic>≈0, <italic>d</italic>≈1). Entrainment to repeated light-dark cycles maps clock phases on the night orbit to a shrinking range of angles, leading to dusk-tracking entrainment (<italic>m</italic>≈1).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.037">http://dx.doi.org/10.7554/eLife.23539.037</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig6-figsupp1-v2"/></fig><fig id="fig6s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.038</object-id><label>Figure 6—figure supplement 2.</label><caption><title>The relative size (<italic>R</italic>) and center-to-center distance (<italic>X</italic>) of day and night limit cycles are major determinants of entrained behavior.</title><p>Heat maps of <italic>m</italic>, the slope of the approximately linear relationship between entrained phase and day length, are plotted as a function of <italic>X</italic> and <italic>R</italic> on the same color scale as in <xref ref-type="fig" rid="fig6">Figure 6E</xref>. See Computational methods for simulation details. (<bold>A</bold>) Entrainment simulations with non-instantaneous jumps between day and night limit cycles. The half-times <inline-formula><mml:math id="inf137"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> for transition between the circular orbits are indicated above the heat maps. Schematic on the left illustrates the evolution of the oscillator from a point on the night limit cycle to the day limit cycle in two scenarios with different relaxation times. Each arrow represents the displacement of the oscillator in 1 hr. (<bold>B</bold>) Entrainment simulations for day and night limit cycles of varying ellipticity. The ratios of the major axis length to the minor axis length of the day and night orbits (ρ<sub>D</sub> and ρ<sub>N</sub>) are indicated above the heatmaps. In these simulations, we considered strongly attracting orbits (<inline-formula><mml:math id="inf138"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.069</mml:mn></mml:mrow></mml:math></inline-formula> hr) oriented with their major axes perpendicular to the separation between their centers. (<bold>C</bold>) Entrainment simulations for day and night limit cycles with non-constant angular velocities. In these simulations, we considered circular orbits for both day and night limit cycles. Orbit attraction timescale was set to <inline-formula><mml:math id="inf139"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.69</mml:mn></mml:mrow></mml:math></inline-formula> hours. The variability in angular speed <inline-formula><mml:math id="inf140"><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula>throughout the cycle is given by <inline-formula><mml:math id="inf141"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mi>ε</mml:mi><mml:mi>ω</mml:mi></mml:mfrac><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>ω</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. Schematic on the left illustrates the evolution of the oscillator along day limit cycle in two scenarios with different values of <inline-formula><mml:math id="inf142"><mml:mrow><mml:mfrac><mml:mi>ε</mml:mi><mml:mi>ω</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula>. Each arrow represents the displacement of the oscillator in 1 hr; size of the arrowheads illustrates changes in angular velocity throughout the cycle (not to scale).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.038">http://dx.doi.org/10.7554/eLife.23539.038</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig6-figsupp2-v2"/></fig><fig id="fig6s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.23539.039</object-id><label>Figure 6—figure supplement 3.</label><caption><title>Interpretation of <italic>m</italic>, the slope of the approximately linear relationship between entrained phase and day length.</title><p>(<bold>A</bold>) The value of <italic>m</italic> dictates whether the circadian rhythm aligns to dawn (<italic>m</italic> = 0), dusk (<italic>m</italic> = 1), or an intermediate point of the day-night cycle (e.g. midday for <italic>m</italic> = 0.5). Orange and gray curves show sinusoidal fits to average transcriptional profiles of dawn and dusk genes in <italic>S. elongatus</italic> based on data from <xref ref-type="bibr" rid="bib46">Vijayan et al. (2009)</xref>. Gray bars indicate night in light-dark cycles for <italic>m</italic> = 0, 0.5, and 1. (<bold>B</bold>) Tracking midday as the day length varies may be a strategy to balance biosynthetic resources between dawn and dusk transcriptional programs. For each value of <italic>m</italic>, the corresponding curve shows a numerical estimate of the relative fraction of dusk and dawn gene expression that occurs during the day in <italic>S. elongatus</italic> (arbitrary units, see Computational methods).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.039">http://dx.doi.org/10.7554/eLife.23539.039</ext-link></p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-23539-fig6-figsupp3-v2"/></fig></fig-group></p><p>After a transition from one condition to the other, the system state must evolve to the new limit cycle. We suppose that each cycle is very strongly radially attracting. That is, when the system is in a state off the limit cycle, it is rapidly pulled to the closest point on the cycle. Under these conditions, the step transitions from one cycle to another are determined purely by geometry (<xref ref-type="fig" rid="fig6">Figure 6A</xref>), and we can connect this picture with the phase-only description we used to analyze the experimental data. Here, linearly increasing sensitivity of a step response has a simple geometric interpretation: when the two cycles are displaced from each other, a step transition maps an arc of one cycle onto an arc of the other cycle that subtends a smaller angle than the original (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). Thus, step transitions compress or expand angular distance when mapping one circle onto another. The slopes of the step response functions are given by the compression factor in this mapping (<xref ref-type="fig" rid="fig6">Figure 6C–D</xref>, <xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>; see Appendix 1).</p><p>To determine how the entrained clock phase depends on geometry in this model, we simulated step transitions and then calculated the slope <italic>m</italic> of clock phase versus day length (<xref ref-type="fig" rid="fig6">Figure 6E</xref>). This calculation indicates that midday tracking (<italic>m</italic> ≈ 0.5) requires that the separation between the light and dark cycles is comparable to the radius of the cycle (<italic>R</italic> ≈ <italic>X</italic>). This requirement can be understood intuitively by considering three cases where orbits have the same center-to-center separation (log <italic>X</italic> = 0.5) but different sizes (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). Dusk transitions are strongly resetting for this choice of <italic>X</italic>, but the strength of dawn resetting varies with the relative size of the orbits. Dawn-tracking entrainment results when the night orbit is much smaller than the day orbit (<italic>l</italic> ≈ 1) and dusk-tracking entrainment results when the night orbit is much larger (<italic>l</italic> ≈ 0, <italic>d</italic> ≈ 1), in accord with how <italic>m</italic> varies as a function of <italic>l</italic> and <italic>d</italic> (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>). When the size of both orbits is similar to their center separation, the oscillator can track intermediate phases, such as midday.</p><p>Although this model makes a simple connection between attractor geometry and entrainment, it also makes a number of simplifying assumptions about oscillator dynamics that may not hold true for real biological clocks, such as instant transitions between cycles, perfectly circular orbits and constant angular frequencies along each cycle. To test the consequences of relaxing these assumptions, we used a dynamical model where the evolution of the system is described explicitly (see Computational methods). Our simulations in <xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2</xref> show that in these more complicated scenarios the geometric arrangement of day and night cycles remains a key determinant of the slope of entrained clock phase as a function of day length. Indeed, in all cases we studied, midday tracking was only possible for geometries where the center-to-center distance between the day and night cycles was comparable to the radius of the larger orbit (<italic>R</italic> ≈ <italic>X</italic> &gt; 1).</p><p>This dynamical systems perspective allows us to reframe conditions on the underlying biochemical mechanisms that can produce the observed midday tracking behavior. Changes in the external environment caused by transitions between night and day should affect the oscillator in such a way that the period remains close to 24 hr, but that the limit cycle is shifted by an amount comparable to its radius. The relative geometry of the two limit cycles, which is determined by the mechanisms that couple the environment to the clock, must be fine-tuned to give a specific slope for the entrained phase. Indeed, when we plotted experimentally determined orbits of the purified KaiABC oscillator on axes showing the extent of phosphorylation of two key sites, we observed an arrangement similar to the expected geometry (<italic>R</italic> ≈ <italic>X</italic>) using nucleotide conditions that simulate either day or night (<xref ref-type="fig" rid="fig6">Figure 6F</xref>) (<xref ref-type="bibr" rid="bib41">Rust et al., 2007</xref>; <xref ref-type="bibr" rid="bib32">Phong et al., 2013</xref>).</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Although circadian clocks are defined in part by their ability to continue to cycle in constant environments, the defects associated with clock mutants are often most apparent when organisms are faced with fluctuating environments (<xref ref-type="bibr" rid="bib28">Ouyang, 1998</xref>; <xref ref-type="bibr" rid="bib49">Woelfle et al., 2004</xref>; <xref ref-type="bibr" rid="bib36">Pittendrigh, 1972</xref>; <xref ref-type="bibr" rid="bib43">Spoelstra et al., 2016</xref>; <xref ref-type="bibr" rid="bib35">Pittendrigh and Minis, 1972</xref>). Thus, an important challenge is to understand how biological clocks respond to the cycling environments found in nature, and how they function to appropriately schedule gene expression and behavior.</p><p>For most organisms, there is an asymmetry between day and night, in terms of food availability, predation risk, etc., so that the need to carry out certain activities diurnally or nocturnally presents changing demands as the length of the day varies throughout the year. The situation is especially dramatic for cyanobacteria because there is an extreme metabolic contrast between day and night. We found that <italic>S. elongatus</italic> contends with these challenges using a clock that tracks the middle of the day.</p><p>The ability of circadian clocks to keep track of the phase of the light-dark cycle has been long recognized in plants, insects, rodents and higher mammals (<xref ref-type="bibr" rid="bib6">de Montaigu et al., 2015</xref>; <xref ref-type="bibr" rid="bib3">Daan et al., 2001</xref>; <xref ref-type="bibr" rid="bib8">Edwards et al., 2010</xref>; <xref ref-type="bibr" rid="bib15">Hut et al., 1999</xref>, <xref ref-type="bibr" rid="bib14">Hut et al., 2013</xref>; <xref ref-type="bibr" rid="bib47">Wehr, 2001</xref>). Although molecular mechanisms that give rise to these entrainment behaviors are still being uncovered, analysis of circadian clock models has found that the presence of multiple feedback loops in complex clocks determines the number of points in the driving cycle that the oscillator can track simultaneously, by allowing different internal phase relationships between the clock components (<xref ref-type="bibr" rid="bib38">Rand et al., 2004</xref>). For example, the multi-feedback loop clocks in plants are able to track phases of both dawn and dusk (<xref ref-type="bibr" rid="bib8">Edwards et al., 2010</xref>).</p><p>Consistent with this picture, we find that the core circadian oscillator in cyanobacteria, which relies on a single posttranslational feedback loop, keeps track of a single phase—the midpoint of the day portion of the cycle, a property described in our mathematical framework as a linear scaling of entrained phase with day length with slope <italic>m</italic> ≈ 0.5. Why might keeping track of midday be useful for a photosynthetic organism with a simple clock? Clock-controlled gene expression in <italic>S. elongatus</italic> tends to be bimodal, with most genes falling into subjective dawn or dusk classes. Because the biosynthetic capacity of <italic>S. elongatus</italic> is severely limited in darkness, the midday tracking effect we describe here could be a mechanism to ensure that biosynthetic resources are partitioned in a balanced way between the dawn and dusk genes, even as the day length changes with the seasons (<xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3</xref>). In particular, clock-driven transcription in this organism has been shown to implement a switch between anabolic and catabolic carbon metabolism, suggesting that a role for the midday tracking we observe here is to ensure balanced growth by timing this switch appropriately in days of different length (<xref ref-type="bibr" rid="bib7">Diamond et al., 2015</xref>).</p><p>The ability to reconstitute this effect in vitro by delivering metabolic pulses to the purified Kai proteins indicates that midday tracking is not necessarily achieved through additional feedback mechanisms in the cell, but appears to be a property of the clock proteins themselves. The purified clock responds to metabolic steps with phase shifts that are linear functions of the previous phase. The slopes of these response functions are presumably tuned to give an appropriately entrained clock phase. Notably, linear responses have also been observed for the Kai oscillator following temperature steps, suggesting that this is a general reaction of the system to inputs (<xref ref-type="bibr" rid="bib50">Yoshida et al., 2009</xref>).</p><p>The mathematical framework that we describe here has deep similarities to the theory of nonparametric entrainment developed by Colin Pittendrigh (<xref ref-type="bibr" rid="bib33">Pittendrigh and Daan, 1976</xref>; <xref ref-type="bibr" rid="bib5">Daan, 2000</xref>; <xref ref-type="bibr" rid="bib34">Pittendrigh and Minis, 1964</xref>). His work motivated a theory of entrainment to diurnal cycles mediated by instantaneous phase shifts at dawn and dusk, which can be summarized by a phase response curve. Daan and Pittendrigh suggested that the ability of the clock to track specific phases of the day-night cycle in different seasons depends on the shape of the phase response curve as well as the difference between the free-running period of the clock and the period of the day-night cycle (<xref ref-type="bibr" rid="bib33">Pittendrigh and Daan, 1976</xref>; <xref ref-type="bibr" rid="bib17">Johnson et al., 2003</xref>). Our decomposition of driven behavior of the KaiABC oscillator into individual step responses is in the spirit of this classic paradigm.</p><p>We note that a mismatch between the free-running clock period and the external cycle is not required for stable entrainment in our phase oscillator model (see Appendix 1). Instead, entrainment can be achieved from the opposing effects of the step-up and step-down phase shifts, which occur at different clock times in days of different length. The step-response curves underlying entrainment in our model are nonlinear functions of clock phase, but they can be successfully approximated by linear functions over the interval of clock phases used during entrainment. Our simulations suggest that the slopes of these locally linear functions are key determinants of entrained phase, along with changes in clock period in daytime and nighttime conditions. Successful prediction of how the in vitro oscillator entrains to rhythmic environments is due in large part to the ability to map out the step-response curves with high temporal resolution. In this study, we achieve this by measuring free-running oscillations in an automated way using a fluorescence polarization probe.</p><p>Even though there are likely other effects at play in natural environments, as long as the system can be described by fast relaxation back to distinct limit cycles in day and night, instantaneous step-response descriptions of the kind used here should be applicable. The data reduction achieved in our linear model holds the promise of predicting the behavior of the circadian rhythms in many time-varying environments from a minimal data set that characterizes oscillator response, and may be applicable to clocks in many organisms.</p><p>Although the biochemistry of even the simplest circadian clock is complex, our analysis suggests that a key determinant of entrained behavior is how the clock limit cycle is deformed by coupling to the environment. Viewed in this way, the entrainment properties of circadian oscillators arise from simple features of the geometry of the limit cycle attractor that could be measured in any organism. The concept that the phase-shifting of oscillators can be studied in terms of their geometric properties was initially developed by Winfree (<xref ref-type="bibr" rid="bib48">Winfree, 1973</xref>). In this context, it would be informative to analyze the geometric arrangement of day and night limit cycles of clock gene transcripts in other species. An important goal for the future is to understand how the biochemical properties of the clock components in cyanobacteria and other organisms achieve the effect of shifting the limit cycle without changing the period, allowing us to use dynamical systems theory to bridge the gap between molecular detail and systems-level clock phenotypes.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Experimental methods</title><sec id="s4-1-1"><title>Cyanobacterial strains and culture conditions</title><p>Two strains of <italic>S. elongatus</italic> PCC 7942 were used for this study. AMC1300 is a wild-type derivative carrying a bacterial luciferase bioluminescent reporter of <italic>kaiBC</italic> expression. AMC1300 carries <italic>PkaiBC::luxAB</italic> at NS1 and <italic>PpsbAI::luxCDE</italic> at NS2, which enables the cells to produce the luciferase enzyme and the long-chain aldehyde substrate for the luminescent reaction (<xref ref-type="bibr" rid="bib2">Chen et al., 2009</xref>). AMC408 carries a <italic>purF</italic> reporter (<italic>PpurF::luxAB</italic> at NS2<italic>, PpsbAI::luxCDE</italic> at NS1) (<xref ref-type="bibr" rid="bib25">Nair et al., 2002</xref>). Prior to experimental measurements, all cultures were grown in test tubes in BG11M liquid medium at 30°C with shaking under cool white fluorescent bulbs (≈60 μmol photons m<sup>−2</sup> s<sup>−1</sup>, Philips AltoII, Amsterdam, Netherlands).</p></sec><sec id="s4-1-2"><title>Creating custom light-dark environments using LED arrays</title><p>To simulate different light-dark cycles, we used custom-built red LED arrays in a 96-well format (LEDs from superbrightleds.com, St. Louis, MO, cat. no. RL5-R12008; 96-well plates from Corning, Corning, NY, cat. no. 3916). The LEDs were mounted into a hollowed-out 96-well plate and the tails of the LEDs were soldered into a circuit board, where they were wired in parallel in groups of four to the analog inputs of an Arduino Mega 2560 microcontroller. Another hollow 96-well plate was glued to the bottom of the LED-carrying plate, beneath the LEDs, in order to create a light baffle and prevent light leakage between the wells. These devices were placed ≈2 mm above a black 96-well plate containing cells growing on BG11-agar, such that every well of the growth plate received illumination from a single LED (≈1.8 cm between LED and agar surface). The growing plate was sealed with transparent film, with holes punctured above each well to provide aeration. Custom Arduino scripts were written to administer appropriate light-dark schedules to cells in the growth plates. Every well received the same light intensity (1.8 V across each LED, ≈200 μmol photons m<sup>−2</sup> s<sup>−1</sup>) in the light portion of the day. The temperature of the agar was <inline-formula><mml:math id="inf143"><mml:mrow><mml:mn>31.6</mml:mn><mml:mo>±</mml:mo><mml:mn>0.8</mml:mn></mml:mrow></mml:math></inline-formula> °C underneath LEDs that were turned on and <inline-formula><mml:math id="inf144"><mml:mrow><mml:mn>28.9</mml:mn><mml:mo>±</mml:mo><mml:mn>0.3</mml:mn></mml:mrow></mml:math></inline-formula> °C under LEDs that were off (mean ± standard deviation of 6–10 wells).</p></sec><sec id="s4-1-3"><title>Monitoring gene expression in vivo using bioluminescent reporters</title><p>Cells were grown in test tubes until OD 0.5–0.8, as described above, and diluted to OD 0.2 immediately prior to experiment. A black 96-well plate was filled (200 μL/well) with BG11M-agar (15 g/L agar) supplemented with sodium thiosulfate (1 mM) and HEPES (20 mM, pH 8.0). When the BG11M-agar mixture cooled to room temperature, 35 μL of cells from growing culture at OD 0.2 were added to each well of the plate. The plate was sealed with transparent UniSeal (GE HealthCare Life Sciences, Pittsburgh, PA, cat no. 7704–0001), holes were punched above each well using a 26G½ needle (BD, Franklin Lakes, NJ, cat. no. 305111), and the plate was placed underneath an LED array. Bioluminescence from luciferase reporters was measured every 30 min using a TopCount scintillation counter (PerkinElmer, Boson, MA). Each well of a 96-well plate was read for 1 s per measurement.</p></sec><sec id="s4-1-4"><title>KaiABC in vitro reactions</title><p>KaiA, KaiB, and KaiC were recombinantly expressed and purified as previously described (<xref ref-type="bibr" rid="bib22">Lin et al., 2014</xref>), although the anion exchange chromatography purification step was omitted in the preparation of KaiC used for fluorescence polarization experiments. Protein concentration was measured via Bradford Assay Kit using bovine serum albumin (BSA) as a standard (BioRad, Hercules, CA). For experiments relying on SDS-PAGE analysis of KaiC phosphorylation, KaiABC proteins were mixed in master reaction buffer (20 mM Tris [pH 8], 150 mM NaCl, 5 mM MgCl<sub>2</sub>, 10% glycerol, 0.5 mM EDTA) supplemented with a mixture of ATP and ADP (day buffer: 2 mM ATP, night buffer: 2 mM ATP, 7.5 mM ADP). All reactions were incubated at 31°C. To mimic light-to-dark transitions, ADP was added to appropriate reactions to 7.5 mM final [ADP]. To mimic dark-to-light transitions, the reactions were passed through Zeba desalting columns (7 MW kDa cutoff, ThermoFisher, Waltham, MA) equilibrated in day buffer. Because every buffer exchange step dilutes the proteins by about 10%, the reactions were prepared at 3× standard protein concentration (10.5 μM KaiB and KaiC, 4.5 μM KaiA). KaiC phosphorylation was assayed by SDS-PAGE and quantified by densitometry, as previously described (<xref ref-type="bibr" rid="bib32">Phong et al., 2013</xref>).</p><p>In the cases where oscillations were read out by monitoring fluorescence polarization, KaiABC proteins were mixed at 3× standard protein concentration in the master reaction buffer supplemented with a mixture of ATP and ADP (day buffer: 2.5 mM ATP, night buffer: 2.5 mM ATP, 7.5 mM ADP). All reactions were incubated at 31°C. Day-to-night transitions were mimicked by addition of 7.5 mM ADP (final), and night-to-day transitions were mimicked by passing the reactions through Zeba desalting columns twice.</p><p>For step-up perturbations shown in blue in <xref ref-type="fig" rid="fig3">Figure 3D</xref>, buffer exchange steps were administered every 2 hr over a 24 hr interval, and phase shifts were measured relative to an unperturbed control reaction. For every other experiment in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, buffer exchange or ADP addition steps were performed every 2 hr over a 12 hr interval on two out-of-phase reactions, prepared as follows. A master mix containing proteins and appropriate nucleotides was split into two tubes, which were flash-frozen in liquid nitrogen immediately after mixing and stored at −80°C. To prepare out-of-phase reactions, one of the two tubes was thawed in a 30°C water bath 12 hr later than the other.</p><p>After all buffer exchanges were completed, the reactions were supplemented with fluorescently labeled KaiB (0.2 μM final) and transferred to the plate reader.</p></sec><sec id="s4-1-5"><title>Preparation and labeling of fluorescently tagged KaiB</title><p>We introduced a K25C mutation in KaiB using site-directed mutagenesis of the pMR0019 plasmid carrying a 6xHis-PSP-KaiB<sup>WT</sup> construct in the pET47b(+) backbone. KaiB<sup>K25C</sup> was expressed in BL-21 (DE3) <italic>E. coli</italic> by overnight induction with IPTG at 18°C and purified following the standard protocol (<xref ref-type="bibr" rid="bib22">Lin et al., 2014</xref>). Labeling with 6-iodoacetofluorescein (6-IAF) was performed as previously described (<xref ref-type="bibr" rid="bib1">Chang et al., 2012</xref>) with minor modifications. Briefly, 130 μL of KaiB<sup>K25C</sup> stock (50–100 μM) was buffer-exchanged into labeling buffer (20 mM Tris, 1 mM TCEP, pH 7.0–7.5) using a Zeba desalting column (7 MW kDa cutoff). A freshly prepared solution of 6-IAF (Life Technologies Corp., Grand Island, NY) in DMSO was added to the protein solution in 10-fold molar excess, and the mixture was incubated overnight at 4°C in the dark. The labeling reaction was quenched by addition of DTT in approximately 10-fold molar excess relative to 6-IAF. Unincorporated dye was removed through three rounds of fivefold dilution in reaction buffer and subsequent concentration using a centrifugal filter (10 kDa cutoff, Amicon, EMD Millipore, Billerica, MA). Concentration of final fluorescein-labeled KaiB<sup>K25C</sup> solution was determined by Bradford assay.</p></sec><sec id="s4-1-6"><title>Monitoring fluorescence polarization rhythms using labeled KaiB</title><p>Oscillations in KaiABC reaction mixtures supplemented with fluorescently labeled KaiB<sup>K25C</sup> (10.5 μM KaiB and KaiC, 4.5 μM KaiA, 0.2 μM KaiB-fluorescein) were monitored on an Infinite F500 plate reader equipped with a fluorescence polarization module (Tecan Trading AG, Switzerland). At least 30 min prior to measurement, the built-in heating module was turned on to warm the instrument and a black 384 well-plate (Greiner Bio-One, Monroe, NC, cat. no. 781900) was loaded into the plate reader. For the metabolic entrainment experiment shown in blue in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref> and the step-up experiment shown in blue in <xref ref-type="fig" rid="fig3">Figure 3D</xref>, the plate reader temperature was 28°C; for all other experiments, the plate reader temperature was 31°C. Reactions were quickly transferred onto the pre-warmed plate (20–35 μL/well) and one to three wells were filled with master reaction buffer. The plate was sealed with a polyethylene silicone plate sealer (Nunc, ThermoFisher cat. no. 235307) and returned to the instrument. Fluorescence polarization of wells of interest (exc. 485 nm, 20 nm bandpass; em. 535 nm, 25 nm bandpass; dichroic 510 nm.) was read out every 15 min using a script created in iControl software (v. 1.12, Tecan Trading AG). Wells containing reaction buffer only were used as blanks, and the G factor was calibrated such that a solution of free fluorescein in reaction buffer produced a reading of ≈20 mP.</p></sec><sec id="s4-1-7"><title>Data analysis</title><p>All oscillating trajectories were fit to sinusoids using optimization routines written in MATLAB (Mathworks, Inc.) (RRID: <ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_001622">SCR_001622</ext-link>). See Computational methods for detailed fitting procedures and descriptions of simulations. Computational pipelines used for analysis and simulations have been deposited to GitHub at <ext-link ext-link-type="uri" xlink:href="https://github.com/euleip/Simulations_and_analysis_pipelines_github_repo">https://github.com/euleip/Simulations_and_analysis_pipelines_github_repo</ext-link> (<xref ref-type="bibr" rid="bib21">Leypunskiy, 2017</xref>). A copy is archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/Simulations_and_analysis_pipelines_github_repo">https://github.com/elifesciences-publications/Simulations_and_analysis_pipelines_github_repo</ext-link>).</p></sec></sec><sec id="s4-2"><title>Computational methods</title><sec id="s4-2-1"><title>Optimization and curve-fitting routines</title><p>All nonlinear fitting procedures were written in MATLAB using the lsqnonlin() or nlinfit() routines. Linear regressions were performed using the polyfit() function. Uncertainties around the best-fit slopes were evaluated using standard formulas for linear regression with known errors in dependent variables (<xref ref-type="bibr" rid="bib37">Press et al., 1992</xref>). For in vivo experiments, these errors were computed as standard errors of the mean from replicate measurements; for in vitro measurements in <xref ref-type="fig" rid="fig2">Figure 2</xref>, the errors in fit phases were computed from the curvature of the cost function at the optimum using the nlpredci() function in MATLAB. Where indicated, 95% confidence intervals were also estimated by nlpredci().</p></sec><sec id="s4-2-2"><title>Normalization of bioluminescent reporter traces</title><p>Prior to fitting, bioluminescence trajectories were normalized to zero mean and unit standard deviation over the fitting interval, unless specified otherwise. In all analyses, we discarded data from the first 2.5 hr after lights-on to avoid masking effects.</p></sec><sec id="s4-2-3"><title>Estimation of clock phase in vivo in light-dark cycles</title><p>The bacterial luciferase reporter system exhibits transient masking effects following dark-to-light transitions. To overcome this issue in determining the phase of gene expression in light-dark cycles of varied day length, we employed a drive-and-release strategy. In this approach (illustrated for LD 8:16, LD 12:12, and LD 16:8 in <xref ref-type="fig" rid="fig1">Figure 1A</xref>), cells were first entrained to a given diurnal schedule and then released into constant light for several days to determine the peak times of the entrained rhythm.</p><p>We relied on two approaches to calculate the peak times of normalized bioluminescence trajectories recorded after release into constant light: (i) we fit sinusoids to 48 hr segments of the trajectories in constant light, and (ii) we locally fit parabolas near the maxima of the trajectories. The advantage of sinusoidal fitting is that it captures phase information for the entire waveform; on the other hand, local parabolic fitting allows for a precise determination of the time of an individual peak without influence from others. In practice, we found that the estimates of the scaling between entrained phase and day length derived from the two approaches were in good agreement with each other (<xref ref-type="table" rid="tbl1">Table 1</xref>, <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>). Fitting details are described in the following two subsections.</p><p>Error bars in <xref ref-type="fig" rid="fig1">Figure 1C</xref>, <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2A</xref>, and <xref ref-type="fig" rid="fig5">Figure 5</xref> represent the standard deviation of peak times calculated from technical replicates (n = 4–8). Technical replicates refer to measurements obtained from side-by-side cultures subjected to the same light-dark conditions. In rare cases, cells in individual wells died or produced noisy bioluminescent signals or trajectories that fit poorly to sinusoids or parabolas. We rejected trajectories as outliers from our analysis if they produced fits with a squared error greater than 10 (0–13 outliers per 96 wells).</p><sec id="s4-2-3-1"><title>(i) Estimation of period and peak times from sinusoidal regression</title><p>Sinusoidal fits were performed by least-squares minimization of the cost function:<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mtext> </mml:mtext><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>T</mml:mi></mml:mfrac><mml:mo>−</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>C</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <italic>y<sub>i</sub></italic> and <italic>x<sub>i</sub></italic> represent, respectively, the normalized bioluminescence signal and the time after release into constant light for the <italic>i</italic>-th timepoint. The period in the fits was constrained to 23 &lt; <italic>T</italic> &lt; 25 hr. The best-fit period was distributed within these bounds, independent of the day length of the preceding entraining cycle (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2D</xref>), a conclusion we confirmed in a peak-to-peak analysis described below.</p><p>We considered whether the quality of sinusoidal fits affected the estimated slope <italic>m</italic>. When we performed sinusoidal fits of the dataset in <xref ref-type="fig" rid="fig1">Figure 1C</xref>, the least-squares errors, normalized by degrees of freedom, were between 0 and 1. If data from all the wells were included in the analysis, linear regression to this data yielded a slope of <italic>m</italic> = 0.55 ± 0.02 (<xref ref-type="table" rid="tbl1">Table 1</xref>). As the table below shows, imposing stricter cutoffs on least-square fitting error did not significantly impact the estimate of the slope, so an estimate of <italic>m</italic> based on all of the data is reported in <xref ref-type="table" rid="tbl1">Table 1</xref>.</p><p><table-wrap id="tblu1" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top"><italic>Least-squares error threshold</italic></th><th valign="top"><italic>% wells satisfying</italic></th><th valign="top"><italic>Slope m ± SD of estimate</italic></th></tr></thead><tbody><tr><td valign="top">1</td><td valign="top">100%</td><td valign="top">0.55 ± 0.02</td></tr><tr><td valign="top">0.5</td><td valign="top">90%</td><td valign="top">0.53 ± 0.01</td></tr><tr><td valign="top">0.1</td><td valign="top">45%</td><td valign="top">0.51 ± 0.03</td></tr><tr><td valign="top">0.05</td><td valign="top">17%</td><td valign="top">0.64 ± 0.03</td></tr></tbody></table></table-wrap></p></sec><sec id="s4-2-3-2"><title>(ii) Estimation of period and peak times from local parabolic regression</title><p>We found that certain bioluminescent trajectories were fit poorly by sinusoids. As <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref> shows, <italic>purF</italic> reporter waveforms display (a) strong asymmetry, marked by faster rising and slower falling dynamics (e.g. second peak in <italic>τ</italic> = 18 hr curve), (b) wide peaks (e.g. first peak in <italic>τ</italic> = 8 hr curve), and (c) broad ‘shoulders’ after the peak that occasionally give rise to secondary peaks (e.g. first peak in <italic>τ</italic> = 18 hr curve). In some cases, <italic>kaiBC</italic> reporter trajectories also exhibited successive peaks with significantly different amplitudes. In <xref ref-type="fig" rid="fig1">Figure 1C</xref> and <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>, we fit parabolas to 6 hr intervals around the peaks of normalized bioluminescence trajectories. We then estimated phases from the first peak positions and periods from the average peak-to-peak times (n = 4–8). We verified that this peak-fitting procedure produced comparable results to sinusoidal fitting for the <italic>kaiBC</italic> datasets in <xref ref-type="fig" rid="fig1">Figure 1C</xref> (see <xref ref-type="table" rid="tbl1">Table 1</xref> and <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2B–E</xref>).</p></sec></sec><sec id="s4-2-4"><title>Comparison of waveforms during light-dark cycling and in continuous light</title><p>To compare clock reporter dynamics during entrainment and in continuous light in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>, we computed nonparametric correlations (Kendall’s <italic>τ</italic> coefficient) between the reporter signal (<italic>P<sub>kaiBC</sub>::luxAB</italic>) measured during the ‘day’ windows in light-dark cycles (days 1–5) and during the corresponding time interval after release into continuous light (day 6). For example, in the case of LD 14:10, the normalized luminescence data recorded between 2.5 and 14 hr during each of the five entraining cycles were correlated with the luminescence dynamics measured between 2.5 and 14 hr after release into constant light. The fact that we observe Kendall’s <italic>τ</italic> &gt; 0.8 after the second driving cycle suggests that cells are effectively entrained within three cycles and that rhythms observed during the lights-on portion of a light-dark cycle can be thought of as a fragment of a free-running rhythm.</p></sec><sec id="s4-2-5"><title>Estimation of clock phase in vitro in metabolic cycles</title><p>For the %P-KaiC measurements in <xref ref-type="fig" rid="fig2">Figure 2C</xref>, normalized KaiC phosphorylation time courses from day 3 of each reaction were fit independently to sinusoids. Best-fit parameters were obtained by minimizing the cost function:<disp-formula id="equ2"><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mtext> </mml:mtext><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>T</mml:mi></mml:mfrac><mml:mo>−</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>C</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>with the period <italic>T</italic> fixed at 24 hr to match the period of the imposed metabolic cycles.</p><p>For the fluorescence polarization experiments in <xref ref-type="fig" rid="fig2">Figure 2C</xref>, fluorescence polarization dynamics were recorded for 48 hr after the last buffer exchange, normalized (to zero mean, unit variance) and fit to sinusoids according to the expression above, with fits to all reactions from the same experiment sharing a globally fit period <italic>T</italic>.</p></sec><sec id="s4-2-6"><title>Fitting and error propagation analysis of step-response experiments</title><p>Step-response experiments described in this section were performed a total of three times: once using KaiC phosphorylation to read out clock phase and twice using the fluorescence polarization reporter of KaiB-KaiC interaction. The phosphorylation measurements were made using an independent preparation of proteins from the fluorescence polarization experiments.</p><p>We performed step-response experiments in <xref ref-type="fig" rid="fig3">Figure 3</xref> in order to determine whether the behavior of the clock in metabolic cycles could be decomposed into a sum of phase shifts due to individual transitions. To do so, we first needed (a) to extract <italic>L</italic> and <italic>D</italic> functions from step response measurements, and then (b) to use these <italic>L</italic> and <italic>D</italic> functions in numerical simulations of clock entrainment to light-dark cycles, as described in the main text and Appendix 1.</p><p>In our experiments, we directly observed how the dynamics of the fluorescence polarization reporter or KaiC phosphorylation changed as a function of lab time (e.g. <xref ref-type="fig" rid="fig3">Figure 3A–B</xref>), but for our downstream simulations and analysis (e.g. <xref ref-type="fig" rid="fig4">Figure 4</xref>) these values had to be converted to clock phase coordinates (e.g. <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>) consistent with how <inline-formula><mml:math id="inf145"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf146"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> are defined. Specifically, we needed to (i) convert the lab time of each step to corresponding clock phase <inline-formula><mml:math id="inf147"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> (or clock time, CT), and then (ii) determine the phase of each fluorescence polarization trace or KaiC phosphorylation trajectory after the perturbation in order to compute the phase shift (<inline-formula><mml:math id="inf148"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf149"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) relative to an unperturbed control.</p><p>Although these conversions are straightforward in principle, it is important to note that both (i) and (ii) rely on sinusoidal regression of phase from measured data, and that the best-fit phases in both cases are only estimates of the true values. The corresponding uncertainty in the best-fit parameters must be propagated through numerical simulations of entrainment.</p><p>Because the temporal resolutions of the KaiC phosphorylation and fluorescence polarization measurements are very different (3 hr vs. 15 min, respectively), we expected the sources of uncertainty in fitting these data to be different (see <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>), and we thus analyzed their errors in different ways. The sparse measurement of KaiC phosphorylation dynamics leads to relatively high uncertainty in best-fit phase and period, and we propagated the errors through our simulations using nonparametric bootstrapping of the datasets. In the case of the fluorescence polarization measurements, experiment-to-experiment variability is the major source of uncertainty. We therefore performed two replicate measurements of <italic>L</italic> and <italic>D</italic> (<xref ref-type="fig" rid="fig3">Figure 3C–D</xref>) and used the four possible combinations of <italic>L</italic> and ﻿<italic>D</italic> in entrainment simulations to assess the range of entrainment behavior constrained by our measurements of these step-response measurements. We describe each of these approaches in turn in the following two sections.</p></sec><sec id="s4-2-7"><title>(i) Error propagation analysis of step-response experiments performed using the fluorescence polarization reporter of KaiB-KaiC interaction</title><p>Periods and phases of reactions in each set were determined by global sinusoidal fitting: amplitude, offset and phase terms were fit independently for each reaction, but a single best-fit period was shared among all fits in a given step-up or step-down set. To avoid transient effects due to a metabolic pulse, only those data points which were collected at least 16 hr after a step-up or step-down perturbation were used for fitting. Mathematically, we used a non-linear least-squares optimization routine to minimize the cost functions:<disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>x</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">y</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">b</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>and<disp-formula id="equ4"><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>x</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mspace width="thinmathspace"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">b</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <italic><inline-formula><mml:math id="inf150"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic> refers to the <italic>i</italic>-th data point in the <italic>r</italic>-th normalized fluorescence polarization trajectory, <inline-formula><mml:math id="inf151"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> refers to the lab time when that data point was collected, and <inline-formula><mml:math id="inf152"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the number of data points fit in the <italic>r</italic>-th reaction. Here <inline-formula><mml:math id="inf153"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf154"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf155"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> are the best-fit parameters for the <italic>r</italic>-th reaction; <inline-formula><mml:math id="inf156"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf157"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> are best-fit periods for all reactions in the 100% ATP and 25% ATP datasets, respectively.</p><p>These best-fit parameters were used to determine the phase <inline-formula><mml:math id="inf158"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> of each step perturbation and corresponding phase shifts <inline-formula><mml:math id="inf159"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf160"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, analogously to the way described for the KaiC phosphorylation datasets below. The step-response functions were interpolated linearly to generate smooth curves while enforcing 2π-periodicity.</p><p>Linearized step-response functions <inline-formula><mml:math id="inf161"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf162"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> were prepared by linear regression of <inline-formula><mml:math id="inf163"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf164"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> centered on the regions used during metabolic entrainment: <italic>D</italic> functions were linearized between 6 and 22 CT hr; <inline-formula><mml:math id="inf165"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> functions were linearized between 18 and 34 CT hr (see <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>). To satisfy periodicity, the step-response functions were assembled as piecewise-linear functions with the same slope everywhere but with offsets every 2π radians at ‘breakpoints,’ which were selected by manual inspection. See <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2C</xref> for an illustration of <inline-formula><mml:math id="inf166"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf167"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and the corresponding <inline-formula><mml:math id="inf168"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf169"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>Finally, step phases deduced from polarization trajectories were adjusted to match the phases of the KaiC phosphorylation rhythm. This conversion made use of measurements in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>, which indicated that the phase of oscillation in KaiC phosphorylation lags behind the phase of the polarization reporter of KaiB-KaiC binding by approximately <inline-formula><mml:math id="inf170"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>By performing this analysis for the two step-up and two step-down datasets in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, we generated two sets of {<inline-formula><mml:math id="inf171"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf172"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf173"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf174"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>} and two sets of {<inline-formula><mml:math id="inf175"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf176"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf177"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf178"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>}. The phase oscillator simulations described below require using the <inline-formula><mml:math id="inf179"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf180"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> functions together in each simulation. To propagate the experiment-to-experiment variability in step-response measurements through our simulations, we combined the two measurements of <inline-formula><mml:math id="inf181"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and two measurements of <inline-formula><mml:math id="inf182"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> into the four possible combinations of {<inline-formula><mml:math id="inf183"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula><italic>, <inline-formula><mml:math id="inf184"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula></italic>} pairs. This resulted in four sets of {<inline-formula><mml:math id="inf185"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf186"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf187"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf188"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf189"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf190"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>}, which were used in the simulations below.</p><p>The ratio of oscillator frequencies in dark and light, <inline-formula><mml:math id="inf191"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mn>0.93</mml:mn><mml:mo>±</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, was determined by averaging the values of T<sub>day</sub> and T<sub>night</sub> from the two step-up and two step-down sets above. Best estimates for the slopes <italic>l</italic> and <italic>d</italic> in <xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref> were computed via the following bootstrap analysis. For each <italic>L</italic> and <italic>D</italic> function in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>, we selected points from the regions used for linearization above (6–22 CT hr on <italic>D</italic>, 18–34 CT hr on <italic>L</italic>). We sampled these data points with replacement until we generated 500 samples containing at least three unique points. For each set of resampled points, we computed the slope of the best-fit line, for a total of 1000 samples of <italic>l</italic> and <italic>d</italic>. The crosshair in <xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref> marks the average ± standard deviation of these values (<italic>l</italic> = 0.34 ± 0.03, <italic>d</italic> = 0.38 ± 0.05).</p><p>The phase oscillator model discussed in the main text and the Appendix 1 makes the prediction that the proportionality constant <italic>m</italic> between entrained phase and day length depends on <italic>l</italic> and <italic>d</italic> coefficients according to:<disp-formula id="equ5"><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>m</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>d</mml:mi><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To check whether this prediction is in line with our experimental measurement of <inline-formula><mml:math id="inf192"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, we used this formula to calculate <inline-formula><mml:math id="inf193"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> for every pair of <inline-formula><mml:math id="inf194"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf195"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> samples generated in the bootstrapping procedure above, assuming <inline-formula><mml:math id="inf196"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.93</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>. According to this calculation, <inline-formula><mml:math id="inf197"><mml:mrow><mml:mi>m</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.34</mml:mn><mml:mo>±</mml:mo><mml:mn>0.04</mml:mn></mml:mrow></mml:math></inline-formula> (mean ± standard deviation of the distribution), which is in agreement with the experimental measurement in <xref ref-type="fig" rid="fig2">Figure 2C</xref> (<inline-formula><mml:math id="inf198"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>0.38</mml:mn><mml:mo>±</mml:mo><mml:mn>0.07</mml:mn></mml:mrow></mml:math></inline-formula>).</p></sec><sec id="s4-2-8"><title>(ii) Non-parametric bootstrapping of step-response datasets collected using SDS-PAGE analysis of KaiC phosphorylation</title><p>Recall that measuring each step-response function requires (a) conversion of the lab time of each step to corresponding clock phase <inline-formula><mml:math id="inf199"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> (or clock time, CT), and then (b) determination of the phase of each KaiC phosphorylation trajectory after the perturbation in order to compute the phase shift (<inline-formula><mml:math id="inf200"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf201"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) relative to an unperturbed control. In particular, uncertainties in (a) manifest as phase errors on <inline-formula><mml:math id="inf202"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf203"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in <xref ref-type="fig" rid="fig3">Figure 3E–F</xref>; these errors are correlated across all points on the step-response function. Uncertainties in (b) manifest as phase shift errors on <inline-formula><mml:math id="inf204"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf205"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>; these errors derive from the errors in the phase estimates of both the control and step reactions. To propagate both these sources of error, we used the following non-parametric bootstrapping strategy.</p><p>First, KaiC phosphorylation dynamics from all step-response measurements were assembled into a master dataset containing nine step-up trajectories, nine step-down trajectories, as well as two control reactions. These measurements were performed once on an independent preparation of proteins from the batch used to generate data in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>. This master dataset was then trimmed to include only data collected at least 16 hr after a step transition, and every trajectory was normalized. To generate bootstrapped datasets, we sampled with replacement from the entire master dataset (as opposed to resampling reactions individually) 1000 times.</p><p>Next, we used each resampled dataset to compute phase shifts in KaiC phosphorylation due to step-up and step-down transitions; in other words, each bootstrapped dataset was used to derive a bootstrapped pair of <inline-formula><mml:math id="inf206"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf207"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>. For a given dataset, we globally fit all 100% ATP trajectories (nine step-up trajectories, plus the 100% ATP control reaction) such that all fits shared a best-fit period (<inline-formula><mml:math id="inf208"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>), but phase, amplitude and offset terms were fit independently for each reaction, as described above for polarization datasets. Likewise, we fit all 20% ATP trajectories (nine step-down reactions, plus the 20% ATP control reaction) to obtain a globally best-fit period (<inline-formula><mml:math id="inf209"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) and independently fit phases for every reaction.</p><p><italic><inline-formula><mml:math id="inf210"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula></italic> and <inline-formula><mml:math id="inf211"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> map the phase at which a metabolic step occurs to the resulting phase shift. The phase at which the metabolic step occurred for every reaction <italic>r</italic> was computed from the best-fit phase of the appropriate control reaction at step time <inline-formula><mml:math id="inf212"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ6"><mml:math id="m6"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf213"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the best-fit phase of the control reaction and <inline-formula><mml:math id="inf214"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the globally-fit oscillator period in the appropriate control condition (i.e. <inline-formula><mml:math id="inf215"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = <inline-formula><mml:math id="inf216"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for step-down reactions, <inline-formula><mml:math id="inf217"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = <inline-formula><mml:math id="inf218"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for step-up reactions).</p><p>Similarly, we computed the apparent phase of each perturbed reaction at the time of each step:<disp-formula id="equ7"><mml:math id="m7"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf219"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the best-fit phase of the <italic>r</italic>-th reaction and <inline-formula><mml:math id="inf220"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the globally-fit oscillator period in the perturbed condition (<inline-formula><mml:math id="inf221"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = <inline-formula><mml:math id="inf222"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for step-down reactions, <inline-formula><mml:math id="inf223"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = <inline-formula><mml:math id="inf224"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for step-up reactions).</p><p>Finally, we defined the phase shift in response to each step perturbation as the difference in phase of the perturbed reaction and the appropriate unperturbed control.<disp-formula id="equ8"><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ9"><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mstyle displaystyle="false" scriptlevel="0"><mml:mtext>-</mml:mtext></mml:mstyle><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To estimate phase shifts at other values of <inline-formula><mml:math id="inf225"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, we linearly interpolated <italic>L</italic> and <italic>D</italic> between the measured values while enforcing 2π-periodicity.</p><p>For each set of <italic>L</italic> and <italic>D</italic> generated in this way, we also prepared linearized versions <italic>L<sub>lin</sub></italic> and <italic>D<sub>lin</sub></italic>. Linear fits to <italic>L</italic> and <italic>D</italic> were performed over the range of step times similar to the ones we selected for fluorescence polarization-based step-response functions as discussed above (<italic>L</italic> between 18 and 33 CT hr, <italic>D</italic> between 6 and 23 CT hr). These regions of <italic>L</italic> and <italic>D</italic> were selected by visual inspection; they are centered on phases used by the KaiABC oscillator in diurnal cycles (i.e. see arrows in <xref ref-type="fig" rid="fig3">Figure 3E–F</xref>) but also contain enough points (5-7) to avoid biasing the slope estimate by a single poorly fit data point.</p><p>We extrapolated the linear approximations to <italic>L</italic> and <italic>D</italic> over the entire cycle, with a single breakpoint away from the linear region to satisfy 2π-periodicity. Breakpoints were selected by visual inspection. While interpolating between data points near the breakpoint, we assumed that <italic>L</italic> and <italic>D</italic> (or <italic>L<sub>lin</sub></italic> and <italic>D<sub>lin</sub></italic>) never generate phase shifts larger than one cycle (i.e. winding number of 0). We anticipate that this choice does not significantly affect entrained phase in most of our simulations because the regions of <italic>L</italic> and <italic>D</italic> near the breakpoint are rarely used by the oscillator during entrainment when <italic>τ</italic> &lt;14 hr.</p><p>We repeated this procedure for each of the 1000 bootstrapped datasets, thereby generating 1000 sets of {<inline-formula><mml:math id="inf226"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf227"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf228"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf229"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf230"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf231"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>} that were used for subsequent analysis. <xref ref-type="fig" rid="fig3">Figure 3E–F</xref> shows the mean ± standard deviation of the distribution of bootstrapped <italic>L</italic> and <italic>D</italic> generated this way.</p></sec><sec id="s4-2-9"><title>Simulations of a phase oscillator driven by a light-dark cycle</title><p>We simulated entrainment to a step-like driving cycle for a phase oscillator governed by the four combinations of {<inline-formula><mml:math id="inf232"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf233"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf234"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf235"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf236"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf237"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>} determined from the fluorescence polarization assays and the 1000 bootstrapped sets of {<inline-formula><mml:math id="inf238"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf239"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf240"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf241"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf242"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf243"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>} derived from KaiC phosphorylation measurements. Electing to work in units of cycles (1 cycle = 2π rad), we defined a phase variable <inline-formula><mml:math id="inf244"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, such that <inline-formula><mml:math id="inf245"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> cycles and <inline-formula><mml:math id="inf246"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> cycles correspond to the trough of the KaiC phosphorylation trajectory and <inline-formula><mml:math id="inf247"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> cycles corresponds to the peak. Where circadian time (CT) is mentioned in the text, we have adopted the convention that CT = 0 and 24 hr refer to <inline-formula><mml:math id="inf248"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf249"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> cycles, respectively; CT = 12 hr refers to <inline-formula><mml:math id="inf250"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> cycles. We also defined corresponding analogs of <inline-formula><mml:math id="inf251"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf252"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in units of cycles:<disp-formula id="equ10"><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>See <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2C</xref> for examples of <inline-formula><mml:math id="inf253"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf254"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. For each set of <inline-formula><mml:math id="inf255"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtext> </mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> generated in this way, we modeled oscillator entrainment to a driving cycle. As shown schematically in <xref ref-type="fig" rid="fig4">Figure 4A</xref> and the Appendix 1, oscillator phase increases with constant angular velocity (given by <inline-formula><mml:math id="inf256"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula> during the day and <inline-formula><mml:math id="inf257"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mtext>D</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula> during the night); at dawn and dusk, oscillator phase shifts instantaneously according to <inline-formula><mml:math id="inf258"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf259"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, respectively. Therefore, oscillator phases at dusk and dawn of the <italic>n</italic>-th entraining cycle can be computed iteratively:<disp-formula id="equ11"><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ12"><mml:math id="m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>τ</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mspace linebreak="newline"/></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We simulated oscillator behavior in 24 hr light-dark cycles (driving period <italic>T<sub>dr</sub></italic> = 24) with day length <italic>τ</italic> lasting from 4 to 18 hr. In simulations relying on <inline-formula><mml:math id="inf260"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf261"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> determined from KaiC phosphorylation measurements, we set the initial condition <inline-formula><mml:math id="inf262"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for a given value of <italic>τ</italic> based on our measurements of entrained phase of the KaiABC oscillator in corresponding metabolic cycles (i.e. based on values interpolated between black markers in <xref ref-type="fig" rid="fig2">Figure 2C</xref>). Simulations using step-response functions based on fluorescence polarization measurements were started from <inline-formula><mml:math id="inf263"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>. We simulated 10 light-dark cycles and recorded oscillator phase after each dawn (immediately after <inline-formula><mml:math id="inf264"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> phase shift).</p><p>For each set of <inline-formula><mml:math id="inf265"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf266"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> we performed simulations for <italic>τ</italic> = 4–18 hr for both the phosphorylation-based step functions and fluorescence polarization-based step functions. <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref> illustrates simulations governed by one such set of <inline-formula><mml:math id="inf267"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf268"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> (derived from the magenta and blue step-response measurements shown in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>). We also carried out entrainment simulations for the linearized step-response functions described above (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>).</p><p>We judged that the oscillator entrained stably to a given diurnal cycle if the standard deviation of clock phases at the dawns of the last five driving cycles was less than 0.01 cycles. For each value of <italic>τ</italic>, we selected those simulations where the oscillator entrained stably to the light-dark cycle, and computed the mean phase at dawn and its standard deviation (<italic>σ</italic>) for that set of simulations. These values are represented in shaded areas in <xref ref-type="fig" rid="fig4">Figure 4C </xref>, <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2A</xref> (for fluorescence polarization data) and <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2B</xref> (for KaiC phosphorylation data).</p><p>We were also interested in how quickly the oscillator approached entrainment in simulations for 6 ≤ <italic>τ</italic> ≤18, the range we profiled experimentally in <xref ref-type="fig" rid="fig2">Figure 2</xref>. To make this determination for a given value of <italic>τ</italic>, we computed how much oscillator phase at dawn varied over three successive cycles in a sliding window:<disp-formula id="equ13"><mml:math id="m13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>E</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mtext> </mml:mtext><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext> </mml:mtext><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext> </mml:mtext><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msqrt><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We used the first value of <italic>n</italic> for which <inline-formula><mml:math id="inf269"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>E</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mo>&lt;</mml:mo><mml:mtext> </mml:mtext><mml:mn>0.01</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> as a proxy for the speed of approach to entrainment.</p><p>The tables below display summary statistics for the entrainment simulations.</p></sec><sec id="s4-2-10"><title>Simulations based on step-response functions measured via fluorescence polarization reporter</title><p><table-wrap id="tblu2" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top">Step fun. type</th><th valign="top">τ’s profiled</th><th valign="top">No. sim.</th><th colspan="2" valign="top">% entrained sim.</th><th colspan="2" valign="top">% entrained within three <break/>cycles (8 &lt; τ &lt; 16)</th></tr><tr><th> </th><th/><th/><th>4 &lt; τ &lt; 18</th><th>8 &lt; τ &lt; 16</th><th>all sim.</th><th>all sim. entrained <break/>within eight cycles</th></tr></thead><tbody><tr><td valign="top"><p><inline-formula><mml:math id="inf270"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mtext> </mml:mtext><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext> </mml:mtext><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></p></td><td valign="top">4, 4.01, …, 18 hr</td><td valign="top">564</td><td valign="top">100%</td><td valign="top">100%</td><td valign="top">83%</td><td valign="top">83%</td></tr><tr><td valign="top"><p><inline-formula><mml:math id="inf271"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></p></td><td valign="top">4, 4.01, …, 18 hr</td><td valign="top">564</td><td valign="top">100%</td><td valign="top">100%</td><td valign="top">100%</td><td valign="top">100%</td></tr></tbody></table></table-wrap></p></sec><sec id="s4-2-11"><title>Simulations based on step-response functions measured via SDS-PAGE analysis of KaiC phosphorylation</title><p><table-wrap id="tblu3" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top">Step fun. type</th><th valign="top">τ’s profiled</th><th valign="top">No. sim.</th><th colspan="2" valign="top">% entrained sim.</th><th colspan="2" valign="top">% entrained within three <break/>cycles (8 &lt; τ &lt; 16)</th></tr><tr><th> </th><th/><th/><th>4 &lt; τ &lt; 18</th><th>8 &lt; τ &lt; 16</th><th>all sim.</th><th>all sim. entrained <break/>within eight cycles</th></tr></thead><tbody><tr><td valign="top"><p><inline-formula><mml:math id="inf272"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mtext> </mml:mtext><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext> </mml:mtext><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></p></td><td valign="top">4, 4.25, …, 18 hr</td><td valign="top">57 000</td><td valign="top">76%</td><td valign="top">87%</td><td valign="top">86%</td><td valign="top">97%</td></tr><tr><td valign="top"><p><inline-formula><mml:math id="inf273"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></p></td><td valign="top">4, 4.25, …, 18 hr</td><td valign="top">57 000</td><td valign="top">98%</td><td valign="top">100%</td><td valign="top">99%</td><td valign="top">100%</td></tr></tbody></table></table-wrap></p><p>In the large majority of our simulations, we found that the phase oscillator entrained stably within three light-dark cycles. For simulations derived from KaiC phosphorylation datasets, we found that the oscillator either entrained to the driving cycle quickly or not at all. Indeed, when we restricted our analysis only to those simulations that were judged as entrained within eight cycles, over 96% entrained within three light-dark cycles. Generally, the oscillator entrained readily for day lengths shorter than 14 hr, but often failed to entrain for longer day lengths. We determined that this occurs because for τ &gt;14 dawn phases often sample the <inline-formula><mml:math id="inf274"><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> function near the breakpoint of the curve (near 18 CT hr in <xref ref-type="fig" rid="fig3">Figure 3F</xref>), leading to erratic responses to driving cues (i.e. lack of entrainment) or disagreement between simulations and experiment (<xref ref-type="fig" rid="fig4">Figure 4—figure supplement 2B</xref>). Relatedly, we believe that the better agreement with experiment achieved in simulations using the step functions derived from the fluorescence polarization data than from the KaiC phosphorylation data reflects the better temporal resolution of the breakpoint (2 hr using the polarization approach vs. 4 hr for KaiC phosphorylation).</p><p>In simulations of entrainment to light-dark cycles of varying period in <xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2</xref>, we relied on a single set of {<inline-formula><mml:math id="inf275"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf276"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf277"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf278"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf279"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf280"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>} based on the step-response measurements shown in blue and magenta in <xref ref-type="fig" rid="fig3">Figure 3C–D</xref>. We simulated entrainment to driving periods from 6 to 48 hr, in increments of 0.0025 hr. For each driving period T<sub>drive</sub>, we subjected the phase oscillator to 1000 cycles with equal day and night durations (<italic>τ</italic> − T<sub>drive</sub>/2) and plotted the phases attained by the oscillator at the end of nighttime (immediately preceding the action of <italic>L</italic>) at the last 950 cycles.</p></sec><sec id="s4-2-12"><title>Simulations of phase resetting</title><p>We used <inline-formula><mml:math id="inf281"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mtext>and</mml:mtext><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> derived from the same step-response measurements as in <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref> to simulate response of a phase oscillator to 12 hr dark pulses administered throughout the circadian cycle (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). Phase evolution of the oscillator was simulated explicitly for 120 hr using a timestep of <italic>dt</italic> = 0.01 hr:<disp-formula id="equ14"><mml:math id="m14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mtd><mml:mtd><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mtd><mml:mtd><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">w</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p></sec><sec id="s4-2-13"><title>Estimation of phase shifts in response to dark pulses in vivo</title><p>For phase resetting and wedge experiments (<xref ref-type="fig" rid="fig5">Figure 5</xref>), clock phase was estimated by sinusoidal regression of normalized bioluminescence data collected 36–48 hr after the end of the applied dark pulse. Phase shifts in response to dark pulses were computed as differences in average peak times between perturbed wells (<inline-formula><mml:math id="inf282"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) and controls (<inline-formula><mml:math id="inf283"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>): <inline-formula><mml:math id="inf284"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>t</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>t</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> where overbars indicate averages over replicate wells (n = 4–8). Clock phases at which the dark pulses were applied were determined from the average fit phase and period of the unperturbed (control) wells (<inline-formula><mml:math id="inf285"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf286"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>T</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) according to <inline-formula><mml:math id="inf287"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>T</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula><inline-formula><mml:math id="inf288"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf289"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> is measured in cycles and <inline-formula><mml:math id="inf290"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> corresponds to the minimum of an oscillatory trajectory.</p></sec><sec id="s4-2-14"><title>Global fit to phase response and seasonal entrainment datasets</title><p>In the Appendix 1, we show that in the regime where the circadian clock is well-approximated by a phase oscillator governed by linear <italic>L</italic> and <italic>D</italic> step-response functions, the slopes of seasonal entrainment and phase resetting of the clock can be described by a model with two free parameters <inline-formula><mml:math id="inf291"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf292"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>: for phase resetting, <inline-formula><mml:math id="inf293"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and for entrainment <inline-formula><mml:math id="inf294"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>τ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. Here, <italic>δ</italic> is dark pulse duration (in hours), <italic>τ</italic> is day length (in hours), <inline-formula><mml:math id="inf295"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> is the clock phase at time <italic>t</italic> (in cycles), <inline-formula><mml:math id="inf296"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the clock frequency in the light (in units of cycles/hour), <italic>T</italic> is the driving period (in hours), and <inline-formula><mml:math id="inf297"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf298"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are constants that do not depend on <inline-formula><mml:math id="inf299"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf300"><mml:mi>δ</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf301"><mml:mi>τ</mml:mi></mml:math></inline-formula>, or <inline-formula><mml:math id="inf302"><mml:mi>T</mml:mi></mml:math></inline-formula>. For phase resetting experiments, <inline-formula><mml:math id="inf303"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf304"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> were estimated based on the average of the best sinusoidal fits to unperturbed wells in each experiment (<inline-formula><mml:math id="inf305"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf306"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>T</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>). In particular, we set <inline-formula><mml:math id="inf307"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mi>t</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula><inline-formula><mml:math id="inf308"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>. In the formula for <inline-formula><mml:math id="inf309"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> the term <inline-formula><mml:math id="inf310"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> thus simplifies to <inline-formula><mml:math id="inf311"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, and the term to the right of the minus sign was incorporated into the constant term <italic>C</italic><sub>1</sub>.</p><p>In the global fits of all datasets in <xref ref-type="fig" rid="fig5">Figure 5A–C</xref>, we varied <inline-formula><mml:math id="inf312"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf313"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to simultaneously fit <inline-formula><mml:math id="inf314"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> to our phase-resetting and wedge data and <inline-formula><mml:math id="inf315"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> to our seasonal entrainment data. The constant terms were allowed to vary as follows:</p><list list-type="bullet"><list-item><p>in <xref ref-type="fig" rid="fig5">Figure 5C</xref>, a single <italic>C</italic><sub>2</sub> term was fit for all curves, referred to as <italic>C<sub>entrainment</sub></italic> below;</p></list-item><list-item><p>in <xref ref-type="fig" rid="fig5">Figure 5B</xref>, a single <italic>C</italic><sub>1</sub> intercept was fit for both datasets (<italic>t<sub>DP</sub></italic> = 36 and <italic>t<sub>DP</sub></italic> = 39 hr), referred to as <italic>C<sub>wedge</sub></italic> below;</p></list-item><list-item><p>in <xref ref-type="fig" rid="fig5">Figure 5A</xref>, the points before and after the breakpoint were fit using the same slope, but varying constant (<italic>C</italic><sub>1</sub>) terms. The breakpoint was selected by visual inspection. Below, the intercepts to the left and right of the breakpoint are referred to as <italic>C<sub>PRC_left</sub></italic> and <italic>C<sub>PRC_right</sub></italic>, respectively.</p></list-item></list><p>In total, only two parameters (<inline-formula><mml:math id="inf316"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf317"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) were used to determine the slopes of all curves, and six parameters were used for the entire global fit of nine linear segments, which minimized the cost function:<disp-formula id="equ15"><mml:math id="m15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>χ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where each <inline-formula><mml:math id="inf318"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> represents the average measurement of phase shift or peak time and <inline-formula><mml:math id="inf319"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> represents the standard error of that measurement. The reduced chi-squared value of the fit was <inline-formula><mml:math id="inf320"><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mi>ν</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>5.67</mml:mn></mml:mrow></mml:math></inline-formula>. The best-fit coefficients determined in the fit are summarized in the table below.</p><p><table-wrap id="tblu4" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top"><italic>Parameter</italic></th><th valign="top"><italic>Best-fit value</italic></th><th valign="top"><italic>95% CI</italic></th></tr></thead><tbody><tr><td valign="top"><italic>β<sub>1</sub></italic></td><td valign="top">−1.31</td><td valign="top">[−1.46 –1.17]</td></tr><tr><td valign="top"><italic>β<sub>2</sub></italic></td><td valign="top">1.79</td><td valign="top">[1.64 1.95]</td></tr><tr><td valign="top"><italic>C<sub>PRC_left</sub></italic></td><td valign="top">−22.11</td><td valign="top">[−24.3 –19.9]</td></tr><tr><td valign="top"><italic>C<sub>PRC_right</sub></italic></td><td valign="top">−36.98</td><td valign="top">[−40.0 –34.0]</td></tr><tr><td valign="top"><italic>C<sub>wedge</sub></italic></td><td valign="top">−24.52</td><td valign="top">[−26.6 –22.5]</td></tr><tr><td valign="top"><italic>C<sub>entrainment</sub></italic></td><td valign="top">39.8</td><td valign="top">[36.3 43.3]</td></tr></tbody></table></table-wrap></p></sec><sec id="s4-2-15"><title>Simulations of entrainment in the limit cycle geometry model</title><p>To simulate entrainment to light-dark cycles of different day length in the geometric resetting framework in <xref ref-type="fig" rid="fig6">Figure 6</xref>, we modeled an oscillator running along the daytime limit cycle (centered at 0, radius 1) in the light and the nighttime cycle (centered at <italic>X</italic>, radius <italic>R</italic>) in the dark. We set the angular frequency to be <inline-formula><mml:math id="inf321"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mn>24</mml:mn><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula> in both light and dark. As described in the Appendix 1, dusk and dawn transitions were modeled as radial jumps from one cycle to the nearest point on the other cycle.</p><p>We considered values of <italic>R</italic> and <italic>X</italic> spanning six orders of magnitude and studied entrainment to 24 hr cycles with day length lasting from 6 to 18 hr. For each pair of <italic>R</italic> and <italic>X</italic>, we simulated oscillator dynamics in 30 light-dark cycles of a given day length. We judged that an oscillator failed to entrain to a given diurnal schedule if oscillator phases after 29 and 30 cycles were more than π/180 radians apart, or if simulations starting from different initial phases (<italic>θ</italic><sub>0</sub> = π/4 and 5π/4) reached phases over π/180 radians apart after 30 light-dark cycles.</p><p>For every simulation that passed the entrainment criteria above, we computed the best linear fit and slope <italic>m</italic> of oscillator phase dependence on day length <italic>τ</italic>. We assessed goodness of fit by computing the mean fit error, defined as the average absolute value of the deviations between the linear fit and simulation results. If the mean fit error was greater than 10% of the deviation between maximum and minimum phases to which the oscillator entrained for this range of <italic>τ</italic>, the phase dependence on day length was judged to be non-linear.</p></sec><sec id="s4-2-16"><title>Relaxing assumptions of the limit cycle geometry model</title><p>The results of the simulations described immediately above strongly suggest that the relative geometry of day and night orbits determines the scaling of entrained phase with day length. However, those simulations are based on idealized infinitely-attracting circular limit cycles with constant angular frequency, assumptions which are likely to be violated for biological clocks. For example, the KaiC phosphorylation limit cycles in <xref ref-type="fig" rid="fig6">Figure 6F</xref> are somewhat elliptical. We were therefore interested in understanding whether the relative geometry of the limit cycles would be the dominant determinant of oscillator entrainment if our assumptions were relaxed. To this end, we explored entrainment in limit cycle models where these features—(i) orbit attraction strength, (ii) orbit ellipticity, and (iii) variation in angular frequency throughout the cycle—could be treated explicitly.</p><sec id="s4-2-16-1"><title>(i) Orbit attraction strength</title><p>To consider the effect of orbit attraction strength (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2A</xref>), we studied an oscillator with constant angular frequency <italic>ω</italic> orbiting a circular limit cycle of radius <italic>R<sub>orb</sub></italic> that is exponentially attracting:<disp-formula id="equ16"><mml:math id="m16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:mfrac><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">d</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where the polar coordinates (<italic>r</italic>, <inline-formula><mml:math id="inf322"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) are defined relative to the center of the limit cycle. Here, the attraction strength <italic>a</italic> determines the half-time for relaxation to the orbit according to <inline-formula><mml:math id="inf323"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>ln</mml:mtext><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> (hr). During the day, the equations of motion were integrated with respect to the daytime orbit of radius 1 centered at the origin. At night, the oscillator coordinates were computed with respect to the night limit cycle of radius <italic>R</italic> centered at (0, <italic>X</italic>). We considered geometries with <italic>R</italic> and <italic>X</italic> ranging over six orders of magnitude and <italic>a</italic> = 10, 1, and 0.1. For each set of <italic>R</italic>, <italic>X</italic> and <italic>a</italic>, we simulated entrainment to ten 24 hr light-dark cycles of day length τ between 6 and 18 hr starting from two out-of-phase initial conditions (<italic>θ</italic><sub>0</sub> = 0 and <italic>θ</italic><sub>0</sub> = π). After the end of the tenth entraining cycle, the oscillator was allowed to relax back to the daytime orbit. We then computed the ‘peak time’ (<inline-formula><mml:math id="inf324"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) of this oscillator as the additional time required to reach phase <inline-formula><mml:math id="inf325"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = π/2 after return to the orbit. For every simulation that passed the entrainment criteria defined above, we computed the slope <italic>m</italic> of the best linear fit of oscillator peak time dependence on day length <italic>τ</italic>. We assessed goodness of fit by computing the mean fit error, defined as the average absolute value of the deviations between the linear fit and simulation results. The phase dependence on day length was judged to be non-linear if the mean fit error was greater than 0.5 hr and also greater than 10% of the deviation between maximum and minimum peak times to which the oscillator entrained for this range of <italic>τ</italic>.</p></sec><sec id="s4-2-16-2"><title>(ii) Orbit ellipticity</title><p>To consider the effect of orbit ellipticity (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2B</xref>), we studied an oscillator with constant angular frequency <italic>ω</italic> orbiting an elliptical limit cycle that is exponentially attracting. We only considered orbits with their minor axes (length <italic>R<sub>orb</sub></italic>) positioned along the <italic>x</italic> axis and major axes (length ρ×<italic>R<sub>orb</sub></italic>) lying parallel to the <italic>y</italic> axis. Mathematically, such an oscillator is defined by:<disp-formula id="equ17"><mml:math id="m17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:mfrac><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">d</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where the polar coordinates (<inline-formula><mml:math id="inf326"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf327"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) are defined relative to the center of the limit cycle. Here <inline-formula><mml:math id="inf328"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is the distance from the current point to the nearest point on the ellipse, and <inline-formula><mml:math id="inf329"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> measures how the radial coordinate changes as a function of the angle on an elliptical trajectory, assuming that <inline-formula><mml:math id="inf330"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover></mml:mrow></mml:mstyle></mml:math></inline-formula> is constant. <inline-formula><mml:math id="inf331"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> was evaluated numerically at every integration time step using the fminbnd() routine in MATLAB. <inline-formula><mml:math id="inf332"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> was computed explicitly based on the definition of the ellipse in polar coordinates:<disp-formula id="equ18"><mml:math id="m18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mi>cos</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>sin</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mi>ρ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mi>ρ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>For all simulations in <xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2B</xref>, the day orbit was centered at (0, 0) with minor axis length 1 and major axis length <italic>ρ<sub>D</sub></italic>; the night orbit was centered at (0, <italic>X</italic>) with minor axis length <italic>R</italic> and major axis length <italic>ρ<sub>N</sub>R</italic>. The attraction strength of both orbits was set to <italic>a</italic> = 1. Entrainment simulations were carried out for four light-dark cycles. Slope <italic>m</italic> was computed as in (i) above.</p></sec><sec id="s4-2-16-3"><title>(iii) Varying angular velocity along the limit cycle</title><p>We also considered the case of circular orbits with nonconstant angular velocities (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2C</xref>). To do so, we considered an oscillator defined by the following equations:<disp-formula id="equ19"><mml:math id="m19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mover><mml:mi>θ</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mi>ε</mml:mi><mml:mi>ω</mml:mi></mml:mfrac><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>ω</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover><mml:mi>r</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf333"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ω</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mn>24</mml:mn></mml:mfrac><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">d</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula> is the natural oscillator frequency. As above, the polar coordinates (<inline-formula><mml:math id="inf334"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf335"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) are defined relative to the center of the limit cycle. Such an oscillator completes one full cycle around the orbit within 24 hr, but the oscillator speed varies sinusoidally along the orbit. Here, the ratio <inline-formula><mml:math id="inf336"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ε</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> defines the maximal deviation of the angular velocity from the natural frequency. In the most perturbative case we considered, <inline-formula><mml:math id="inf337"><mml:mrow><mml:mfrac><mml:mi>ε</mml:mi><mml:mi>ω</mml:mi></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:math></inline-formula>, the oscillator runs at 1.5 times the natural frequency at the peak of the oscillation and at 0.5 times natural frequency at the trough of the cycle. Simulations were carried out for ten light-dark cycles for orbits with attraction strength <italic>a</italic> = 1. Slope <italic>m</italic> was computed as in (i) above.</p></sec></sec><sec id="s4-2-17"><title>Simulations of daytime resource allocation in days of different length</title><p>Phase of transcriptional dynamics of dawn and dusk genes in <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3</xref> were derived from a sinusoidal fit to the transcriptional profiles of dawn and dusk genes identified in microarray time courses by <xref ref-type="bibr" rid="bib46">Vijayan et al. (2009)</xref>. Briefly, normalized time course data was downloaded from the GEO depository, and time series for transcripts annotated as dawn genes were averaged to obtain the average dawn gene transcriptional profile. The average dusk gene trajectory was obtained analogously. Average dawn and dusk waveforms were fit to sinusoids with 24 hr period, and the resulting phase estimates were used to define the phase shift between the orange and gray curves in <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3</xref>.</p><p>In <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3</xref>, nightfall in LD 12:12 for all values of <italic>m</italic> coincides with the 12 hr dark pulses administered during the initial synchronization in the Vijayan et al. experiment. In simulations of other day lengths (<italic>τ</italic>), we assumed that the only effect of diurnal cycling is to adjust the phase of the circadian transcriptional program relative to dawn and dusk, without affecting the shape or relative timing of dawn and dusk gene transcriptional waveforms. The bias in allocation of daytime resources between dawn and dusk genes was then computed according to the expression:<disp-formula id="equ20"><mml:math id="m20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mspace width="thickmathspace"/><mml:mi>b</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi><mml:mtext> </mml:mtext><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext> </mml:mtext><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mtext> </mml:mtext><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>n</mml:mi><mml:mtext> </mml:mtext><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>k</mml:mi><mml:mtext> </mml:mtext><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf338"><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the integrated RNA signal for that gene over the daytime hours.</p></sec></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank Arvind Murugan and members of the Rust and Dinner labs, particularly H Gudjonson and G Pattanayak, for feedback and useful discussions. Joel Heisler and Andy LiWang assisted us with fluorescence polarization measurements. This work was supported by NIH Training Grant 5T32EB009412 (EL), NIH Training Grant T32GM07197 (UL), NIH R01 GM107369-01 (to MJR), NSF PHY-1305542 (to ARD), a Pew Biomedical Scholarship (to MJR). EL, JL, HY, and UL carried out experiments. EL analyzed data. EL, ARD and MJR designed the study, performed mathematical modeling, and wrote the paper.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="conflict" id="conf1"><p>The authors declare that no competing interests exist.</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>EL, Conceptualization, Software, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>JL, Investigation</p></fn><fn fn-type="con" id="con3"><p>HY, Methodology</p></fn><fn fn-type="con" id="con4"><p>UJL, Investigation</p></fn><fn fn-type="con" id="con5"><p>ARD, Conceptualization, Formal analysis, Funding acquisition, Writing—original draft, Project administration, Writing—review and editing</p></fn><fn fn-type="con" id="con6"><p>MJR, Conceptualization, Funding acquisition, Investigation, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following previously published dataset was used:</p><p><related-object content-type="generated-dataset" id="data-ro1" source-id="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE18902" source-id-type="uri"><collab>Vijayan V</collab><x>,</x> <collab>Zuzow R</collab><x>,</x> <collab>O'Shea EK</collab><x>,</x> <year>2009</year><x>,</x><source>S. elongatus circadian microarray</source><x>,</x> <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE18902">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE18902</ext-link><x>,</x> <comment>Publicly available at the NCBI Gene Expression Omnibus (accession no: GSE18902)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chang</surname><given-names>YG</given-names></name><name><surname>Tseng</surname><given-names>R</given-names></name><name><surname>Kuo</surname><given-names>NW</given-names></name><name><surname>LiWang</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Rhythmic ring-ring stacking drives the circadian oscillator clockwise</article-title><source>PNAS</source><volume>109</volume><fpage>16847</fpage><lpage>16851</lpage><pub-id pub-id-type="doi">10.1073/pnas.1211508109</pub-id><pub-id pub-id-type="pmid">22967510</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Kim</surname><given-names>YI</given-names></name><name><surname>Mackey</surname><given-names>SR</given-names></name><name><surname>Holtman</surname><given-names>CK</given-names></name><name><surname>LiWang</surname><given-names>A</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>A novel allele of kaiA shortens the circadian period and strengthens interaction of oscillator components in the Cyanobacterium synechococcus elongatus PCC 7942</article-title><source>Journal of Bacteriology</source><volume>191</volume><fpage>4392</fpage><lpage>4400</lpage><pub-id pub-id-type="doi">10.1128/JB.00334-09</pub-id><pub-id pub-id-type="pmid">19395479</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daan</surname><given-names>S</given-names></name><name><surname>Albrecht</surname><given-names>U</given-names></name><name><surname>van der Horst</surname><given-names>GT</given-names></name><name><surname>Illnerová</surname><given-names>H</given-names></name><name><surname>Roenneberg</surname><given-names>T</given-names></name><name><surname>Wehr</surname><given-names>TA</given-names></name><name><surname>Schwartz</surname><given-names>WJ</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Assembling a clock for all seasons: are there M and E oscillators in the genes?</article-title><source>Journal of Biological Rhythms</source><volume>16</volume><fpage>105</fpage><lpage>116</lpage><pub-id pub-id-type="doi">10.1177/074873001129001809</pub-id><pub-id pub-id-type="pmid">11302553</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Daan</surname><given-names>S</given-names></name><name><surname>Beersma</surname><given-names>DGM</given-names></name><name><surname>Spoelstra</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2003">2003</year><person-group person-group-type="editor"><name><surname>Honma</surname> <given-names>K</given-names></name><name><surname>Honma</surname> <given-names>S</given-names></name></person-group><source>Biological Rhythms (10th Sapporo Symposium)</source><fpage>110</fpage><lpage>125</lpage></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>The Colin S. Pittendrigh Lecture. Colin Pittendrigh, Jürgen Aschoff, and the natural entrainment of circadian systems</article-title><source>Journal of Biological Rhythms</source><volume>15</volume><fpage>195</fpage><lpage>207</lpage><pub-id pub-id-type="doi">10.1177/074873040001500301</pub-id><pub-id pub-id-type="pmid">10885874</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Montaigu</surname><given-names>A</given-names></name><name><surname>Giakountis</surname><given-names>A</given-names></name><name><surname>Rubin</surname><given-names>M</given-names></name><name><surname>Tóth</surname><given-names>R</given-names></name><name><surname>Cremer</surname><given-names>F</given-names></name><name><surname>Sokolova</surname><given-names>V</given-names></name><name><surname>Porri</surname><given-names>A</given-names></name><name><surname>Reymond</surname><given-names>M</given-names></name><name><surname>Weinig</surname><given-names>C</given-names></name><name><surname>Coupland</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Natural diversity in daily rhythms of gene expression contributes to phenotypic variation</article-title><source>PNAS</source><volume>112</volume><fpage>905</fpage><lpage>910</lpage><pub-id pub-id-type="doi">10.1073/pnas.1422242112</pub-id><pub-id pub-id-type="pmid">25548158</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diamond</surname><given-names>S</given-names></name><name><surname>Jun</surname><given-names>D</given-names></name><name><surname>Rubin</surname><given-names>BE</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>The circadian oscillator in Synechococcus elongatus controls metabolite partitioning during diurnal growth</article-title><source>PNAS</source><volume>112</volume><fpage>201504576</fpage><pub-id pub-id-type="doi">10.1073/pnas.1504576112</pub-id><pub-id pub-id-type="pmid">25825710</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Edwards</surname><given-names>KD</given-names></name><name><surname>Akman</surname><given-names>OE</given-names></name><name><surname>Knox</surname><given-names>K</given-names></name><name><surname>Lumsden</surname><given-names>PJ</given-names></name><name><surname>Thomson</surname><given-names>AW</given-names></name><name><surname>Brown</surname><given-names>PE</given-names></name><name><surname>Pokhilko</surname><given-names>A</given-names></name><name><surname>Kozma-Bognar</surname><given-names>L</given-names></name><name><surname>Nagy</surname><given-names>F</given-names></name><name><surname>Rand</surname><given-names>DA</given-names></name><name><surname>Millar</surname><given-names>AJ</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Quantitative analysis of regulatory flexibility under changing environmental conditions</article-title><source>Molecular Systems Biology</source><volume>6</volume><elocation-id>424</elocation-id><pub-id pub-id-type="doi">10.1038/msb.2010.81</pub-id><pub-id pub-id-type="pmid">21045818</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Flombaum</surname><given-names>P</given-names></name><name><surname>Gallegos</surname><given-names>JL</given-names></name><name><surname>Gordillo</surname><given-names>RA</given-names></name><name><surname>Rincón</surname><given-names>J</given-names></name><name><surname>Zabala</surname><given-names>LL</given-names></name><name><surname>Jiao</surname><given-names>N</given-names></name><name><surname>Karl</surname><given-names>DM</given-names></name><name><surname>Li</surname><given-names>WK</given-names></name><name><surname>Lomas</surname><given-names>MW</given-names></name><name><surname>Veneziano</surname><given-names>D</given-names></name><name><surname>Vera</surname><given-names>CS</given-names></name><name><surname>Vrugt</surname><given-names>JA</given-names></name><name><surname>Martiny</surname><given-names>AC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Present and future global distributions of the marine Cyanobacteria Prochlorococcus and Synechococcus</article-title><source>PNAS</source><volume>110</volume><fpage>9824</fpage><lpage>9829</lpage><pub-id pub-id-type="doi">10.1073/pnas.1307701110</pub-id><pub-id pub-id-type="pmid">23703908</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gutu</surname><given-names>A</given-names></name><name><surname>O'Shea</surname><given-names>EK</given-names></name><name><surname>O’Shea</surname><given-names>EK</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Two antagonistic clock-regulated histidine kinases time the activation of circadian gene expression</article-title><source>Molecular Cell</source><volume>50</volume><fpage>288</fpage><lpage>294</lpage><pub-id pub-id-type="doi">10.1016/j.molcel.2013.02.022</pub-id><pub-id pub-id-type="pmid">23541768</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Heisler</surname><given-names>J</given-names></name><name><surname>Chang</surname><given-names>Y-G</given-names></name><name><surname>Chavan</surname><given-names>A</given-names></name><name><surname>LiWang</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><person-group person-group-type="editor"><name><surname>Brown</surname> <given-names>S</given-names></name></person-group><source>Circadian Clocks Methods and Protocols</source><publisher-name>Springer</publisher-name><comment>In press</comment></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Herzog</surname><given-names>ED</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Neurons and networks in daily rhythms</article-title><source>Nature Reviews Neuroscience</source><volume>8</volume><fpage>790</fpage><lpage>802</lpage><pub-id pub-id-type="doi">10.1038/nrn2215</pub-id><pub-id pub-id-type="pmid">17882255</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hosokawa</surname><given-names>N</given-names></name><name><surname>Hatakeyama</surname><given-names>TS</given-names></name><name><surname>Kojima</surname><given-names>T</given-names></name><name><surname>Kikuchi</surname><given-names>Y</given-names></name><name><surname>Ito</surname><given-names>H</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Circadian transcriptional regulation by the posttranslational oscillator without de novo clock gene expression in Synechococcus</article-title><source>PNAS</source><volume>108</volume><fpage>15396</fpage><lpage>15401</lpage><pub-id pub-id-type="doi">10.1073/pnas.1019612108</pub-id><pub-id pub-id-type="pmid">21896749</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hut</surname><given-names>RA</given-names></name><name><surname>Paolucci</surname><given-names>S</given-names></name><name><surname>Dor</surname><given-names>R</given-names></name><name><surname>Kyriacou</surname><given-names>CP</given-names></name><name><surname>Daan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Latitudinal clines: an evolutionary view on biological rhythms</article-title><source>Proceedings of the Royal Society B: Biological Sciences</source><volume>280</volume><fpage>20130433</fpage><pub-id pub-id-type="doi">10.1098/rspb.2013.0433</pub-id><pub-id pub-id-type="pmid">23825204</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hut</surname><given-names>RA</given-names></name><name><surname>van Oort</surname><given-names>BE</given-names></name><name><surname>Daan</surname><given-names>S</given-names></name><name><surname>a</surname><given-names>HR</given-names></name><name><surname>Van</surname><given-names>OBEH</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Natural entrainment without dawn and dusk: the case of the European ground squirrel (Spermophilus citellus)</article-title><source>Journal of Biological Rhythms</source><volume>14</volume><fpage>290</fpage><lpage>299</lpage><pub-id pub-id-type="doi">10.1177/074873099129000704</pub-id><pub-id pub-id-type="pmid">10447309</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ito</surname><given-names>H</given-names></name><name><surname>Mutsuda</surname><given-names>M</given-names></name><name><surname>Murayama</surname><given-names>Y</given-names></name><name><surname>Tomita</surname><given-names>J</given-names></name><name><surname>Hosokawa</surname><given-names>N</given-names></name><name><surname>Terauchi</surname><given-names>K</given-names></name><name><surname>Sugita</surname><given-names>C</given-names></name><name><surname>Sugita</surname><given-names>M</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Cyanobacterial daily life with Kai-based circadian and diurnal genome-wide transcriptional control in Synechococcus elongatus</article-title><source>PNAS</source><volume>106</volume><fpage>14168</fpage><lpage>14173</lpage><pub-id pub-id-type="doi">10.1073/pnas.0902587106</pub-id><pub-id pub-id-type="pmid">19666549</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Johnson</surname><given-names>CH</given-names></name><name><surname>Elliott</surname><given-names>JA</given-names></name><name><surname>Foster</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Entrainment of circadian programs</article-title><source>Chronobiology International</source><volume>20</volume><fpage>741</fpage><lpage>774</lpage><pub-id pub-id-type="doi">10.1081/CBI-120024211</pub-id><pub-id pub-id-type="pmid">14535352</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Johnson</surname><given-names>CH</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Forty years of PRCs--what have we learned?</article-title><source>Chronobiology International</source><volume>16</volume><fpage>711</fpage><lpage>743</lpage><pub-id pub-id-type="doi">10.3109/07420529909016940</pub-id><pub-id pub-id-type="pmid">10584173</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kageyama</surname><given-names>H</given-names></name><name><surname>Nishiwaki</surname><given-names>T</given-names></name><name><surname>Nakajima</surname><given-names>M</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name><name><surname>Oyama</surname><given-names>T</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Cyanobacterial circadian pacemaker: Kai protein complex dynamics in the KaiC phosphorylation cycle in vitro</article-title><source>Molecular Cell</source><volume>23</volume><fpage>161</fpage><lpage>171</lpage><pub-id pub-id-type="doi">10.1016/j.molcel.2006.05.039</pub-id><pub-id pub-id-type="pmid">16857583</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>YI</given-names></name><name><surname>Vinyard</surname><given-names>DJ</given-names></name><name><surname>Ananyev</surname><given-names>GM</given-names></name><name><surname>Dismukes</surname><given-names>GC</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Oxidized quinones signal onset of darkness directly to the cyanobacterial circadian oscillator</article-title><source>PNAS</source><volume>109</volume><fpage>17765</fpage><lpage>17769</lpage><pub-id pub-id-type="doi">10.1073/pnas.1216401109</pub-id><pub-id pub-id-type="pmid">23071342</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Leypunskiy</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2017">2017</year><source>Simulations_and_analysis_pipelines_github_repo</source><version>da4be4342adee456b33be34b25985700a9cddc7b</version><uri xlink:href="https://github.com/euleip/Simulations_and_analysis_pipelines_github_repo">https://github.com/euleip/Simulations_and_analysis_pipelines_github_repo</uri></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>J</given-names></name><name><surname>Chew</surname><given-names>J</given-names></name><name><surname>Chockanathan</surname><given-names>U</given-names></name><name><surname>Rust</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Mixtures of opposing phosphorylations within hexamers precisely time feedback in the cyanobacterial circadian clock</article-title><source>PNAS</source><volume>111</volume><fpage>E3937</fpage><lpage>E3945</lpage><pub-id pub-id-type="doi">10.1073/pnas.1408692111</pub-id><pub-id pub-id-type="pmid">25197081</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Tsinoremas</surname><given-names>NF</given-names></name><name><surname>Johnson</surname><given-names>CH</given-names></name><name><surname>Lebedeva</surname><given-names>NV</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name><name><surname>Ishiura</surname><given-names>M</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Circadian orchestration of gene expression in cyanobacteria</article-title><source>Genes &amp; Development</source><volume>9</volume><fpage>1469</fpage><lpage>1478</lpage><pub-id pub-id-type="doi">10.1101/gad.9.12.1469</pub-id><pub-id pub-id-type="pmid">7601351</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Markson</surname><given-names>JS</given-names></name><name><surname>Piechura</surname><given-names>JR</given-names></name><name><surname>Puszynska</surname><given-names>AM</given-names></name><name><surname>O'Shea</surname><given-names>EK</given-names></name><name><surname>O’Shea</surname><given-names>EK</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Circadian control of global gene expression by the cyanobacterial master regulator RpaA</article-title><source>Cell</source><volume>155</volume><fpage>1396</fpage><lpage>1408</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2013.11.005</pub-id><pub-id pub-id-type="pmid">24315105</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nair</surname><given-names>U</given-names></name><name><surname>Ditty</surname><given-names>JL</given-names></name><name><surname>Min</surname><given-names>H</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Roles for sigma factors in global circadian regulation of the cyanobacterial genome</article-title><source>Journal of Bacteriology</source><volume>184</volume><fpage>3530</fpage><lpage>3538</lpage><pub-id pub-id-type="doi">10.1128/JB.184.13.3530-3538.2002</pub-id><pub-id pub-id-type="pmid">12057947</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakajima</surname><given-names>M</given-names></name><name><surname>Imai</surname><given-names>K</given-names></name><name><surname>Ito</surname><given-names>H</given-names></name><name><surname>Nishiwaki</surname><given-names>T</given-names></name><name><surname>Murayama</surname><given-names>Y</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name><name><surname>Oyama</surname><given-names>T</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Reconstitution of circadian oscillation of cyanobacterial KaiC phosphorylation in vitro</article-title><source>Science</source><volume>308</volume><fpage>414</fpage><lpage>415</lpage><pub-id pub-id-type="doi">10.1126/science.1108451</pub-id><pub-id pub-id-type="pmid">15831759</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nishiwaki</surname><given-names>T</given-names></name><name><surname>Satomi</surname><given-names>Y</given-names></name><name><surname>Nakajima</surname><given-names>M</given-names></name><name><surname>Lee</surname><given-names>C</given-names></name><name><surname>Kiyohara</surname><given-names>R</given-names></name><name><surname>Kageyama</surname><given-names>H</given-names></name><name><surname>Kitayama</surname><given-names>Y</given-names></name><name><surname>Temamoto</surname><given-names>M</given-names></name><name><surname>Yamaguchi</surname><given-names>A</given-names></name><name><surname>Hijikata</surname><given-names>A</given-names></name><name><surname>Go</surname><given-names>M</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name><name><surname>Takao</surname><given-names>T</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Role of KaiC phosphorylation in the circadian clock system of Synechococcus elongatus PCC 7942</article-title><source>PNAS</source><volume>101</volume><fpage>13927</fpage><lpage>13932</lpage><pub-id pub-id-type="doi">10.1073/pnas.0403906101</pub-id><pub-id pub-id-type="pmid">15347812</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ouyang</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>The biological significance of the circadian clock in Cyanobacteria</article-title><source>Dissertation</source></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pattanayak</surname><given-names>GK</given-names></name><name><surname>Lambert</surname><given-names>G</given-names></name><name><surname>Bernat</surname><given-names>K</given-names></name><name><surname>Rust</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Controlling the cyanobacterial clock by synthetically rewiring metabolism</article-title><source>Cell Reports</source><volume>13</volume><fpage>2362</fpage><lpage>2367</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2015.11.031</pub-id><pub-id pub-id-type="pmid">26686627</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pattanayak</surname><given-names>GK</given-names></name><name><surname>Phong</surname><given-names>C</given-names></name><name><surname>Rust</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Rhythms in energy storage control the ability of the cyanobacterial circadian clock to reset</article-title><source>Current Biology</source><volume>24</volume><fpage>1934</fpage><lpage>1938</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2014.07.022</pub-id><pub-id pub-id-type="pmid">25127221</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pfeuty</surname><given-names>B</given-names></name><name><surname>Thommen</surname><given-names>Q</given-names></name><name><surname>Lefranc</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Robust entrainment of circadian oscillators requires specific phase response curves</article-title><source>Biophysical Journal</source><volume>100</volume><fpage>2557</fpage><lpage>2565</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2011.04.043</pub-id><pub-id pub-id-type="pmid">21641300</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Phong</surname><given-names>C</given-names></name><name><surname>Markson</surname><given-names>JS</given-names></name><name><surname>Wilhoite</surname><given-names>CM</given-names></name><name><surname>Rust</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Robust and tunable circadian rhythms from differentially sensitive catalytic domains</article-title><source>PNAS</source><volume>110</volume><fpage>1124</fpage><lpage>1129</lpage><pub-id pub-id-type="doi">10.1073/pnas.1212113110</pub-id><pub-id pub-id-type="pmid">23277568</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pittendrigh</surname><given-names>CS</given-names></name><name><surname>Daan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1976">1976</year><article-title>A functional analysis of circadian pacemakers in nocturnal rodents - IV. Entrainment: pacemaker as clock</article-title><source>Journal of Comparative Physiology. A, Sensory, Neural, and Behavioral Physiology</source><volume>106</volume><fpage>291</fpage><lpage>331</lpage><pub-id pub-id-type="doi">10.1007/BF01417857</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pittendrigh</surname><given-names>CS</given-names></name><name><surname>Minis</surname><given-names>DH</given-names></name></person-group><year iso-8601-date="1964">1964</year><article-title>The entrainment of circadian oscillations by light and their role as photoperiodic clocks</article-title><source>The American Naturalist</source><volume>98</volume><elocation-id>261</elocation-id><lpage>294</lpage><pub-id pub-id-type="doi">10.1086/282327</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pittendrigh</surname><given-names>CS</given-names></name><name><surname>Minis</surname><given-names>DH</given-names></name></person-group><year iso-8601-date="1972">1972</year><article-title>Circadian systems: longevity as a function of circadian resonance in Drosophila melanogaster</article-title><source>PNAS</source><volume>69</volume><fpage>1537</fpage><lpage>1539</lpage><pub-id pub-id-type="doi">10.1073/pnas.69.6.1537</pub-id><pub-id pub-id-type="pmid">4624759</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pittendrigh</surname><given-names>CS</given-names></name></person-group><year iso-8601-date="1972">1972</year><article-title>Circadian surfaces and the diversity of possible roles of circadian organization in photoperiodic induction</article-title><source>PNAS</source><volume>69</volume><fpage>2734</fpage><lpage>2737</lpage><pub-id pub-id-type="doi">10.1073/pnas.69.9.2734</pub-id><pub-id pub-id-type="pmid">4506793</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Press</surname><given-names>WH</given-names></name><name><surname>Teukolsky</surname><given-names>SA</given-names></name><name><surname>Vettering</surname><given-names>WT</given-names></name><name><surname>Flannery</surname><given-names>BP</given-names></name></person-group><year iso-8601-date="1992">1992</year><source>Numerical Recipes in Fortran 77: The Art of Scientific Computing</source><publisher-name>Cambridge University Press</publisher-name><fpage>650</fpage><lpage>699</lpage></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rand</surname><given-names>DA</given-names></name><name><surname>Shulgin</surname><given-names>BV</given-names></name><name><surname>Salazar</surname><given-names>D</given-names></name><name><surname>Millar</surname><given-names>AJ</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Design principles underlying circadian clocks</article-title><source>Journal of the Royal Society, Interface</source><volume>1</volume><fpage>119</fpage><lpage>130</lpage><pub-id pub-id-type="doi">10.1098/rsif.2004.0014</pub-id><pub-id pub-id-type="pmid">16849158</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rémi</surname><given-names>J</given-names></name><name><surname>Merrow</surname><given-names>M</given-names></name><name><surname>Roenneberg</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>A circadian surface of entrainment: varying T, τ, and photoperiod in Neurospora crassa</article-title><source>Journal of Biological Rhythms</source><volume>25</volume><fpage>318</fpage><lpage>328</lpage><pub-id pub-id-type="doi">10.1177/0748730410379081</pub-id><pub-id pub-id-type="pmid">20876812</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rust</surname><given-names>MJ</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name><name><surname>O'Shea</surname><given-names>EK</given-names></name><name><surname>O’Shea</surname><given-names>EK</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Light-driven changes in energy metabolism directly entrain the cyanobacterial circadian oscillator</article-title><source>Science</source><volume>331</volume><fpage>220</fpage><lpage>223</lpage><pub-id pub-id-type="doi">10.1126/science.1197243</pub-id><pub-id pub-id-type="pmid">21233390</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rust</surname><given-names>MJ</given-names></name><name><surname>Markson</surname><given-names>JS</given-names></name><name><surname>Lane</surname><given-names>WS</given-names></name><name><surname>Fisher</surname><given-names>DS</given-names></name><name><surname>O'Shea</surname><given-names>EK</given-names></name><name><surname>O’Shea</surname><given-names>EK</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Ordered phosphorylation governs oscillation of a three-protein circadian clock</article-title><source>Science</source><volume>318</volume><fpage>809</fpage><lpage>812</lpage><pub-id pub-id-type="doi">10.1126/science.1148596</pub-id><pub-id pub-id-type="pmid">17916691</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmitz</surname><given-names>O</given-names></name><name><surname>Katayama</surname><given-names>M</given-names></name><name><surname>Williams</surname><given-names>SB</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name><name><surname>Golden</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>CikA, a bacteriophytochrome that resets the cyanobacterial circadian clock</article-title><source>Science</source><volume>289</volume><fpage>765</fpage><lpage>768</lpage><pub-id pub-id-type="doi">10.1126/science.289.5480.765</pub-id><pub-id pub-id-type="pmid">10926536</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spoelstra</surname><given-names>K</given-names></name><name><surname>Wikelski</surname><given-names>M</given-names></name><name><surname>Daan</surname><given-names>S</given-names></name><name><surname>Loudon</surname><given-names>AS</given-names></name><name><surname>Hau</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Natural selection against a circadian clock gene mutation in mice</article-title><source>PNAS</source><volume>113</volume><pub-id pub-id-type="doi">10.1073/pnas.1516442113</pub-id><pub-id pub-id-type="pmid">26715747</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Takai</surname><given-names>N</given-names></name><name><surname>Nakajima</surname><given-names>M</given-names></name><name><surname>Oyama</surname><given-names>T</given-names></name><name><surname>Kito</surname><given-names>R</given-names></name><name><surname>Sugita</surname><given-names>C</given-names></name><name><surname>Sugita</surname><given-names>M</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>A KaiC-associating SasA-RpaA two-component regulatory system as a Major circadian timing mediator in cyanobacteria</article-title><source>PNAS</source><volume>103</volume><fpage>12109</fpage><lpage>12114</lpage><pub-id pub-id-type="doi">10.1073/pnas.0602955103</pub-id><pub-id pub-id-type="pmid">16882723</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tomita</surname><given-names>J</given-names></name><name><surname>Nakajima</surname><given-names>M</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name><name><surname>Iwasaki</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>No transcription-translation feedback in circadian rhythm of KaiC phosphorylation</article-title><source>Science</source><volume>307</volume><fpage>251</fpage><lpage>254</lpage><pub-id pub-id-type="doi">10.1126/science.1102540</pub-id><pub-id pub-id-type="pmid">15550625</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vijayan</surname><given-names>V</given-names></name><name><surname>Zuzow</surname><given-names>R</given-names></name><name><surname>O'Shea</surname><given-names>EK</given-names></name><name><surname>O’Shea</surname><given-names>EK</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Oscillations in supercoiling drive circadian gene expression in cyanobacteria</article-title><source>PNAS</source><volume>106</volume><fpage>22564</fpage><lpage>22568</lpage><pub-id pub-id-type="doi">10.1073/pnas.0912673106</pub-id><pub-id pub-id-type="pmid">20018699</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wehr</surname><given-names>TA</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Photoperiodism in humans and other primates: evidence and implications</article-title><source>Journal of Biological Rhythms</source><volume>16</volume><fpage>348</fpage><lpage>364</lpage><pub-id pub-id-type="doi">10.1177/074873001129002060</pub-id><pub-id pub-id-type="pmid">11506380</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Winfree</surname><given-names>A</given-names></name></person-group><year iso-8601-date="1973">1973</year><person-group person-group-type="editor"><name><surname>Chance</surname> <given-names>B</given-names></name></person-group><person-group person-group-type="editor"><name><surname>Ghosh</surname> <given-names>A</given-names></name></person-group><person-group person-group-type="editor"><name><surname>Pye</surname> <given-names>E. K</given-names></name></person-group><source>Biological and Biochemical Oscillators</source><edition>1st Edn</edition><publisher-loc>New York</publisher-loc><publisher-name>Academic Press, Inc</publisher-name><fpage>461</fpage></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Woelfle</surname><given-names>MA</given-names></name><name><surname>Ouyang</surname><given-names>Y</given-names></name><name><surname>Phanvijhitsiri</surname><given-names>K</given-names></name><name><surname>Johnson</surname><given-names>CH</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>The adaptive value of circadian clocks: an experimental assessment in cyanobacteria</article-title><source>Current Biology : CB</source><volume>14</volume><fpage>1481</fpage><lpage>1486</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2004.08.023</pub-id><pub-id pub-id-type="pmid">15324665</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yoshida</surname><given-names>T</given-names></name><name><surname>Murayama</surname><given-names>Y</given-names></name><name><surname>Ito</surname><given-names>H</given-names></name><name><surname>Kageyama</surname><given-names>H</given-names></name><name><surname>Kondo</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Nonparametric entrainment of the in vitro circadian phosphorylation rhythm of cyanobacterial KaiC by temperature cycle</article-title><source>PNAS</source><volume>106</volume><fpage>1648</fpage><lpage>1653</lpage><pub-id pub-id-type="doi">10.1073/pnas.0806741106</pub-id><pub-id pub-id-type="pmid">19164549</pub-id></element-citation></ref></ref-list><app-group><app id="app1"><title>Appendix 1</title><boxed-text><sec id="s45" sec-type="appendix"><title>Mathematical</title><p>Here we outline a simple and general mathematical framework for describing the interaction between a circadian clock and its environment. The essential idea is that we model only the phase of the oscillator and decompose its dynamics into a sequence of free runs interrupted by step responses to changes in the environment (<xref ref-type="fig" rid="fig8">Appendix 1—figure 1</xref>). We present the assumptions of the model and then derive key formulas for interpreting our measurements.<fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.23539.040</object-id><label>Appendix 1—figure 1.</label><caption><title>Phase oscillator with step response framework.</title><p>(<bold>A</bold>) Schematic of the framework. In the light portion of the day, the oscillator runs along the ‘light’ limit cycle (<italic>orange</italic>) and accumulates phase <inline-formula><mml:math id="inf339"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> at constant rate <inline-formula><mml:math id="inf340"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>; in the dark, the oscillator runs along the ‘dark’ limit cycle (<italic>blue</italic>) with frequency <inline-formula><mml:math id="inf341"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. At dawn (<italic>solid blue circle</italic>) and dusk (<italic>solid orange circle</italic>), the oscillator transitions between the light and dark limit cycles (<italic>blue and orange arrows</italic>) and incurs instantaneous phase shifts given by <inline-formula><mml:math id="inf342"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> at dawn and <inline-formula><mml:math id="inf343"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> at dusk. <inline-formula><mml:math id="inf344"><mml:mrow><mml:mo> </mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf345"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>can be approximated by linear functions of phase, such that <inline-formula><mml:math id="inf346"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf347"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. Colors along the ‘light’ and ‘dark’ limit cycles indicate the magnitude of phase shifts due to light-to-dark (<inline-formula><mml:math id="inf348"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) and dark-to-light (<inline-formula><mml:math id="inf349"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>) responses throughout the cycle for a single set of linearized <inline-formula><mml:math id="inf350"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf351"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, shown in (<bold>B</bold>), generated by bootstrapping the measurements in <xref ref-type="fig" rid="fig3">Figure 3E–F</xref>. <inline-formula><mml:math id="inf352"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> refers to the minimum of the KaiC phosphorylation rhythm. (<bold>B</bold>) One set of linearized step response functions <inline-formula><mml:math id="inf353"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf354"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> for the KaiABC oscillator determined by SDS-PAGE analysis of KaiC phosphorylation rhythms (see <xref ref-type="fig" rid="fig3">Figure 3E–F</xref>). The functions plotted represent one pair of <inline-formula><mml:math id="inf355"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>L</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf356"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> generated by bootstrapping (see Computational Methods). Colors denote phase shift magnitude as in (<bold>A</bold>). Solid circular markers correspond to dawn and dusk transitions in (<bold>A</bold>). (<bold>C</bold>) (<italic>left</italic>) Schematic of phase response analysis in the phase oscillator framework. The phase shift is a linear function of the dark pulse time (<italic>t<sub>DP</sub></italic>) and duration (<italic>δ</italic>) if <inline-formula><mml:math id="inf357"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and the <inline-formula><mml:math id="inf358"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> are linear functions. Slopes of linear dependencies on <italic>t<sub>DP</sub></italic> and duration <italic>δ</italic> can be computed based on clock frequencies in light and dark (<inline-formula><mml:math id="inf359"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula><italic>, <inline-formula><mml:math id="inf360"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic>) and slopes of <inline-formula><mml:math id="inf361"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf362"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> functions. (<italic>right</italic>) Simulation of a phase response experiment for a phase oscillator with experimentally determined parameters (<inline-formula><mml:math id="inf363"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf364"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <italic>l</italic>, and <italic>d</italic> from the same bootstrapped parameter set as in (<bold>B</bold>)). A 9 hr dark pulse applied 4 hr after the beginning of the simulation to an oscillator (<italic>green</italic>) results in a ≈8 hr phase delay relative to a control (<italic>black</italic>) that remains in light throughout the simulation. (<bold>D</bold>) (<italic>top</italic>) Schematic of analysis of seasonal entrainment in the phase oscillator framework. Entrained phase is a linear function of day length (<italic>τ</italic>) and driving period (T) if <inline-formula><mml:math id="inf365"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and the <inline-formula><mml:math id="inf366"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> are linear functions. Slopes of linear dependencies on <italic>τ</italic> and <italic>T</italic> can be computed based on four parameters (<inline-formula><mml:math id="inf367"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf368"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <italic>l</italic>, and <italic>d</italic>). (<italic>bottom</italic>) Simulation of entrainment to a LD 12:12 cycle for a phase oscillator with experimentally determined parameters (<inline-formula><mml:math id="inf369"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula><italic>, <inline-formula><mml:math id="inf370"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic>, <italic>l</italic>, and <italic>d</italic> from the same bootstrapped parameter set as in (<bold>B</bold>)).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.23539.040">http://dx.doi.org/10.7554/eLife.23539.040</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-23539-app1-fig1-v2"/></fig></p><sec id="s46"><title>Modeling a circadian clock as a phase oscillator with step responses to light-dark cues</title><p>Circadian rhythms are characterized by the ability to maintain self-sustaining ≈24 hr oscillations in constant conditions and to adjust the phase of those oscillations in response to environmental signals (e.g. transitions between light and dark). To represent the first feature, we model a circadian clock as an oscillator that runs along a ‘light’ limit cycle with speed <inline-formula><mml:math id="inf371"><mml:mrow><mml:mo> </mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> when lights are on, and along a ‘dark’ limit cycle with speed <inline-formula><mml:math id="inf372"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> when lights are off (<xref ref-type="fig" rid="fig8">Appendix 1—figure 1A</xref>). Because the oscillator is always on one of the limit cycles, its state can be fully described by a single variable, the phase <inline-formula><mml:math id="inf373"><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>:<disp-formula id="equ21"><mml:math id="m21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ22"><mml:math id="m22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We define frequencies in units of cycles per hour (<inline-formula><mml:math id="inf374"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1</mml:mn><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">y</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">s</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>), so that the duration of one cycle in constant conditions is <inline-formula><mml:math id="inf375"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>ω</mml:mi></mml:mrow></mml:math></inline-formula> hours, and phase <inline-formula><mml:math id="inf376"><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is defined between 0 and 1.</p><p>We assume that the oscillator transitions between the two limit cycles immediately at dark-to-light (‘dawn’) and light-to-dark (‘dusk’) transitions, with a change in phase. We define <inline-formula><mml:math id="inf377"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf378"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as phase-shifts accompanying clock responses to lights on and lights off cues, respectively:<disp-formula id="equ23"><mml:math id="m23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">k</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ24"><mml:math id="m24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mtext> </mml:mtext><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Though in principle <inline-formula><mml:math id="inf379"><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf380"><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> could be arbitrary periodic functions, our measurements in <xref ref-type="fig" rid="fig3">Figure 3</xref> suggest that <inline-formula><mml:math id="inf381"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf382"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are approximately linear over the range of clock phases when dawn and dusk occurred in our experiments. Henceforth we consequently assume that <inline-formula><mml:math id="inf383"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf384"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> are linear functions of <inline-formula><mml:math id="inf385"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ25"><mml:math id="m25"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ26"><mml:math id="m26"><mml:mrow><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Given this framework, we can now determine the change in clock state over any interval simply by adding the changes in phase at the transitions and accumulated during the free runs. We now explicitly compute the change in clock state in response to a dark pulse and the state of stable entrainment for light-dark cycles of arbitrary period.</p></sec><sec id="s47"><title>Modeling phase resetting</title><p>To probe the response of an oscillator, one can subject it to a perturbation of duration <inline-formula><mml:math id="inf386"><mml:mi>δ</mml:mi></mml:math></inline-formula> and compare the resulting phase to that of an unperturbed oscillator. Plotting the results of such an assay as a function of the phase <inline-formula><mml:math id="inf387"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> at which the perturbation is delivered yields a phase response curve (PRC; <xref ref-type="fig" rid="fig8">Appendix 1—figure 1C</xref>, <xref ref-type="fig" rid="fig5">Figure 5A</xref>). Alternatively, varying the duration of the perturbation while delivering it at a fixed phase corresponds to a ‘wedge’ experiment (<xref ref-type="fig" rid="fig5">Figure 5B</xref>).</p><p>To determine the phase response, we need to determine the phase evolution as the system transitions to dark, free runs in the dark, and then transitions to light. Note that because this model treats the transitions between the light and dark cycles as instantaneous, we expect that it will only be valid for dark pulses that are long compared to the true relaxation time of the clock. Mathematically,<disp-formula id="equ27"><mml:math id="m27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where the prime denotes the perturbed oscillator, and the + and – in the subscripts distinguish the phase after and before the transition from dark-to-light at <inline-formula><mml:math id="inf388"><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:math></inline-formula>. That is,<disp-formula id="equ28"><mml:math id="m28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Substituting the linear forms above for <inline-formula><mml:math id="inf389"><mml:mi>D</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf390"><mml:mi>L</mml:mi></mml:math></inline-formula> and grouping like terms,<disp-formula id="equ29"><mml:math id="m29"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>l</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Subtracting the unperturbed phase <inline-formula><mml:math id="inf391"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>,<disp-formula id="equ30"><mml:math id="m30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>l</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Thus we obtain a formula for the change in phase in response to a dark pulse, with linear dependences on the phase of the perturbation, <inline-formula><mml:math id="inf392"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, and its duration, <inline-formula><mml:math id="inf393"><mml:mi>δ</mml:mi></mml:math></inline-formula>.</p></sec><sec id="s48"><title>Modeling entrainment to light-dark cycles</title><p>We can similarly describe the phase of a clock stably entrained to light-dark cycles of varying day length. To this end, consider a phase oscillator subjected to light-dark cycles of period <inline-formula><mml:math id="inf394"><mml:mi>T</mml:mi></mml:math></inline-formula> and day length <inline-formula><mml:math id="inf395"><mml:mi>τ</mml:mi></mml:math></inline-formula> (<xref ref-type="fig" rid="fig8">Appendix 1—figure 1D</xref>). In this case, rather than a phase difference, we need to determine <inline-formula><mml:math id="inf396"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> such that <inline-formula><mml:math id="inf397"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. If this condition is met, the oscillator is stably entrained to a cycle of period <italic>T</italic>. In other words, we enforce periodicity.</p><p>Proceeding analogously to above, we determine the evolution over a full driving period, starting at dusk. This comprises a transition to the dark at time <inline-formula><mml:math id="inf398"><mml:mi>τ</mml:mi></mml:math></inline-formula>, free run in the dark for duration <inline-formula><mml:math id="inf399"><mml:mrow><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula>, a transition to the light at time <inline-formula><mml:math id="inf400"><mml:mi>T</mml:mi></mml:math></inline-formula>, and free run in the light for duration <inline-formula><mml:math id="inf401"><mml:mi>τ</mml:mi></mml:math></inline-formula>. Mathematically,<disp-formula id="equ31"><mml:math id="m31"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mo> </mml:mo><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mi>τ</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Again, substituting the linear forms above for <inline-formula><mml:math id="inf402"><mml:mi>D</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf403"><mml:mi>L</mml:mi></mml:math></inline-formula> and grouping like terms,<disp-formula id="equ32"><mml:math id="m32"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>τ</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>l</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Setting <inline-formula><mml:math id="inf404"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and solving for <inline-formula><mml:math id="inf405"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>,<disp-formula id="equ33"><mml:math id="m33"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>τ</mml:mi><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mi>T</mml:mi><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mo> </mml:mo><mml:mi>l</mml:mi><mml:msub><mml:mi>θ</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Again, we obtain a formula with linear dependence, here on the day length <inline-formula><mml:math id="inf406"><mml:mi>τ</mml:mi></mml:math></inline-formula> and the driving period <inline-formula><mml:math id="inf407"><mml:mi>T</mml:mi></mml:math></inline-formula>.</p></sec><sec id="s49"><title>Comparison with experiment</title><p>The expressions above describe phases, but we do not measure phase directly. Rather, we measure the time of peak expression of a reporter. Thus it is necessary to convert from phase to the time of peak expression. To this end, we arbitrarily assign the peak expression to occur at <inline-formula><mml:math id="inf408"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula> (midway through the cycle). Because phase advance and delay correspond to earlier and later peak times respectively, the time of the peak shifts with opposite sign to the phase. In each case above, we are interested when the peak (or <inline-formula><mml:math id="inf409"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula>) occurs relative to the last dawn (i.e. immediately after the action of <italic>L</italic>). We can solve for this peak time:<disp-formula id="equ34"><mml:math id="m34"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>0.5</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf410"><mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:math></inline-formula> (end of dark pulse) in the case of phase resetting and <inline-formula><mml:math id="inf411"><mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> (last dawn) in the case of entrainment. To solve for <italic><inline-formula><mml:math id="inf412"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic> in entrained conditions, we make use of the fact that <inline-formula><mml:math id="inf413"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula>, allowing us to substitute the expression above for <inline-formula><mml:math id="inf414"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>τ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. For phase resetting, we must apply this formula to both the perturbed and unperturbed phase and then subtract:<disp-formula id="equ35"><mml:math id="m35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>θ</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Furthermore, we note that certain combinations of the frequencies <inline-formula><mml:math id="inf415"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf416"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and the linear sensitivities <inline-formula><mml:math id="inf417"><mml:mi>l</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf418"><mml:mi>d</mml:mi></mml:math></inline-formula> occur repeatedly. We thus define<disp-formula id="equ36"><mml:math id="m36"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:mo>[</mml:mo> <mml:mrow><mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:mfrac></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ37"><mml:math id="m37"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Then, for phase resetting<disp-formula id="equ38"><mml:math id="m38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext> </mml:mtext><mml:mi>δ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>and for entrainment<disp-formula id="equ39"><mml:math id="m39"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>τ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf419"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf420"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are constants that do not depend on <inline-formula><mml:math id="inf421"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf422"><mml:mi>δ</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf423"><mml:mi>τ</mml:mi></mml:math></inline-formula>, or <inline-formula><mml:math id="inf424"><mml:mi>T</mml:mi></mml:math></inline-formula>.</p><p>In the global fits for all datasets in <xref ref-type="fig" rid="fig5">Figure 5A–C</xref>, we varied <inline-formula><mml:math id="inf425"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf426"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to simultaneously fit <inline-formula><mml:math id="inf427"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> to our phase-resetting and wedge data and <inline-formula><mml:math id="inf428"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> to our seasonal entrainment data. Thus, the slopes of all the linear fits in <xref ref-type="fig" rid="fig5">Figure 5A–C</xref> were derived from the same values of <inline-formula><mml:math id="inf429"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf430"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. See Computational Methods for further details.</p></sec><sec id="s50"><title>Geometric resetting</title><p>In our experimental measurements, we observed <italic>L</italic> and <italic>D</italic> step-response functions with linear regions with slopes &lt; 1. Here we present a simple dynamical systems picture where a tunable, linear dependence of phase shift magnitude on oscillator phase arises from the geometry of how a strongly attracting limit cycle is deformed by a changing external input.</p><p>We suppose that the oscillator is described by a circular limit cycle in the plane with unit radius during the day. During the night, we assume that the limit cycle remains in the plane, but is offset a distance <italic>X</italic> from the daytime cycle and has an altered radius <italic>R</italic> (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). At the moment of the light-to-dark transition, the state of the system is on the daytime limit cycle—it is then attracted to the nighttime limit cycle. The step-response function <inline-formula><mml:math id="inf431"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> describes the shift between the new phase angle (measured relative to the center of the nighttime limit cycle) and the original phase <inline-formula><mml:math id="inf432"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> (<xref ref-type="fig" rid="fig6">Figure 6A</xref>).</p><p>If we place the origin at the center of the nighttime limit cycle, the Cartesian coordinates of the system state immediately before the light-to-dark transition, when the system is still on the daytime orbit, are:<disp-formula id="equ40"><mml:math id="m40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>If we assume that the fixed point giving rise to the nighttime orbit is very strongly attracting, then the system approaches the limit cycle much faster than any circulation occurs. In this limit, the light-to-dark transition leads to a purely radial jump from the daytime orbit towards the center of the nighttime orbit (<xref ref-type="fig" rid="fig6">Figure 6A–B</xref>). Under these conditions, the new phase <inline-formula><mml:math id="inf433"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> on the nighttime cycle is simply the angle measured relative to the center of the new limit cycle:<disp-formula id="equ41"><mml:math id="m41"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mtext>night</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>tan</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>X</mml:mi></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To develop intuition about how this mapping between phase on day and night orbits is affected by their geometric arrangement, we can perform a Taylor expansion for angles near <inline-formula><mml:math id="inf434"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0 at dusk, corresponding to conditions close to LD 12:12:<disp-formula id="equ42"><mml:math id="m42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mtext>night</mml:mtext></mml:msub><mml:mo>≈</mml:mo><mml:mfrac><mml:mi>θ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>X</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Likewise, it can be shown that for transitions from nighttime to daytime cycles, near <italic>θ</italic> = π , the phase immediately after transition to the daytime cycle at dawn can be given by:<disp-formula id="equ43"><mml:math id="m43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>day</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>π</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>X</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>These expressions show that, in the linear portion of the step response function, angles are compressed by a factor tunable by the relative geometry of the light and dark limit cycles. In this way, the geometric arrangement of the limit cycles sets the slopes of <inline-formula><mml:math id="inf435"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf436"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>. Numerical simulations in <xref ref-type="fig" rid="fig6">Figure 6</xref> and <xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref> were carried out using trigonometric formulas as above to convert phases between the daytime and nighttime limit cycles. Details of simulations in <xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2</xref> are described in Computational Methods.</p></sec></sec></boxed-text></app></app-group></back><sub-article article-type="article-commentary" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.23539.043</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Barkai</surname><given-names>Naama</given-names></name><role>Reviewing editor</role><aff><institution>Weizmann Institute of Science</institution>, <country>Israel</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;The cyanobacterial circadian clock follows midday in vivo and in vitro&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by two peer reviewers, and the evaluation has been overseen by Naama Barkai as the Senior Editor and Reviewing Editor. The reviewers have opted to remain anonymous.</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>The authors examine how the cyanobacterial clock aligns under varying environmental cycles, revealing a simple scaling law to midday across various Light/Dark cycles. In a very nice follow up they then show that it is possible to recreate these results in vitro using metabolic pulses. It is an impressive strength of the paper that they are able to go from in vivo to in vitro and obtain similar results. They go on to develop a mathematical model, based on the immediate response of the clock to environmental changes, which they then successfully test. The model is elegant and simple and produces experimentally testable predictions that the authors follow up on.</p><p>Essential revisions:</p><p>1) Please downplay the optimality argument, as requested by the reviewer below. Both reviewers agreed that this argument is not well supported.</p><p>2) Most importantly, the experiments lack biological repeats. Please either justify why biological repeats are not needed, or (largely recommended) repeat the experiments to verify reproduciblity. This is important in particular for the in vitro experiments (Figure 2 and 3), where it is stated that the experiment was done once (subsection “Estimation of clock phase in vitro in metabolic cycles”, last paragraph and subsection “Non-parametric bootstrapping of step-response datasets and <italic>L</italic> and <italic>D</italic> functions”, first paragraph), but also for the other 96-well based experiments.</p><p><italic>Reviewer #1:</italic> </p><p>The authors study the phase of the cyanobacterial circadian oscillator under entrainment with different photoperiods (day length). A main finding is that the internal clock phase tracks midday under entrainment, both in vivo and in the test tube, and this can be explained by the measured phase shifts at dawn and dusk. Linearity properties of the phase shifting curves in a physiological range are sufficient to explain midday tracking, but this also generalizes to more complex perturbations. Overall, an elegant and general picture emerges, and a simple geometrical interpretation is proposed: that of the deformation of the clock orbit in light vs. dark conditions.</p><p>Would there be a more powerful way to exploit the purF reporter? I assume the authors do not have dual reporter strains? I would recommend putting the purF figure in the main, and to analyze the KaiC data in the same way (i.e. multiple peaks etc.).</p><p>An important test for the model would be to analyze period mutants. That, is assuming that the phase shifts do not depend on the mutations, it would be straightforward to predict if mode-locking can still occur, and if so what the entrainment phase is. Looking at period mutants seems quite obvious, why did the authors not do this?</p><p>Moreover, it would have been informative to identify mutants with entrainment defects. Or perhaps some entrainment mutants are already reported, and could have been analyzed?</p><p>Also, from the dynamical systems points of view, 1-d maps like the one proposed exhibit complex behavior (period doubling, chaos, etc.). It would have been very interesting to try and probe whether other regimes besides 1:1 can occur.</p><p><italic>Reviewer #2:</italic> </p><p>The work appears to be of high quality, has very robust data, and should be interesting to the <italic>eLife</italic> audience. I do have the following concerns however.</p><p>1) Concepts developed in the paper. In the paper it is assumed that clocks in individual cells can only track one phase, and it is argued that tracking midday should be the optimal strategy, as it allows proportional expression of dawn and dusk genes. I think both these ideas require further thought and justification. It is well known in the plant clock field that the clock network can track dawn and dusk. For example (Edwards et al., 2010). There has also been theoretical studies on clocks (without assuming any multicellularity or coupling between cells) to examine what it takes to track more than one phase (Rand et al., J. Royal Society Interface, 2004). As the cyanobacterial clock is limited to one feedback loop this presumably means it is limited to tracking one phase, but this point should be discussed. If you are going to track one phase, it is not clear that tracking midday is an optimal decision. It could be that evening genes become more important under shorter days for example. It is not clear to me that equi-partitioning of the resources into two classes is necessarily clearly the optimal strategy.</p><p>2) Figure 7F: The cycle in phosphorylation state for the 'Day cycle' in the invitro system is quite elliptical in shape. It is not clear how one would estimate <italic>X</italic> and <italic>R</italic> from this ellipse, and whether or not one would gain a linear phase shift relationship in <inline-formula><mml:math id="inf437"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> from the elliptical orbits. It would be useful if the authors could comment on this, and perhaps show how the experimental orbits would map to the calculated <inline-formula><mml:math id="inf438"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf439"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> from the geometrical model.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;The cyanobacterial circadian clock follows midday in vivo and in vitro&quot; for further consideration at <italic>eLife</italic>. Your revised article has been favorably evaluated by Naama Barkai as the Senior Editor and Reviewing Editor, and two reviewers.</p><p>Please see comments below – the reviewers would like you to emphasize aspects related to the reproducibility, as was raised in the previous review. Specifically, please show all that data in the main figures (in Figure 2C, there's plenty of space to plot the two additional in vitro measurements). Also, please adapt your interpretation to take into the observed variability and discuss what the potential sources are.</p><p><italic>Reviewer #1:</italic> </p><p>I believe the revised version addresses the general editorial comments adequately.</p><p>In addition, though the authors have partially addressed my comments, I regret that they did not consider my first major point on integrating the purF data in the main text, and also not analyze their KaiC data in the same way. I liked the purF analysis with the multiple peaks, which seemed more thorough than that presented for KaiC in the main. In particular this modification seemed not to represent a lot of extra work, so it is not intuitive why it was not done.</p><p><italic>Reviewer #2:</italic> </p><p>In general I am happy with the revision, but I have the following concerns.</p><p>The new in vitro experiments slopes using a different method based on a fluorescent probe are less near to m = 0.5 than one would have expected (at 0.38). It isn't clear why the non-repeated in vitro study based on% KAICP is used in Figure 2 (with a m value of 0.51), whilst the new method that is repeated (showing an answer that is less close to the in vivo values) is in the supplement. This is especially true as Figure 3 now uses the new data from the fluorescent probe. In Figure 2C the comparison is only made between the non-repeated in vitro method based on %P KaiC, but the slopes based on the new method using an in situ fluorescent probe are not included. The authors should include the values from the new experiments in Figure 2C.</p><p>In Figure 3A it appears that phase shifts much larger than 4 hours are possible, even though phase shifts of &lt;4 hours are claimed in the text and displayed in Figure 3C. Could the authors please explain the differences?</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.23539.044</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><p><italic>Essential revisions:</italic> </p><p><italic>1) Please downplay the optimality argument, as requested by the reviewer below. Both reviewers agreed that this argument is not well supported.</italic> </p><p>We agree with the reviewers that the argument that biosynthetic resources need to be equally partitioned by the clock between morning and afternoon gene expression programs is not strongly supported by our data. Thus we have shortened the discussion of this hypothesis and moved it to the Discussion section of the paper. Likewise, we have moved the figure panels explaining the idea to Figure 7—figure supplement 3.</p><p><italic>2) Most importantly, the experiments lack biological repeats. Please either justify why biological repeats are not needed, or (largely recommended) repeat the experiments to verify reproduciblity. This is important in particular for the invitro experiments (Figure 2 and 3), where it is stated that the experiment was done once (subsection “Estimation of clock phase in vitro in metabolic cycles”, last paragraph and subsection “Non-parametric bootstrapping of step-response datasets and L and D functions”, first paragraph), but also for the other 96-well based experiments.</italic> </p><p>We have included additional, independent in vitro measurements in the paper and clarified the number of biological replicates for the in vivo results (3 independent measurements of entrainment scaling, as detailed in new <xref ref-type="table" rid="tbl1">Table 1</xref>).</p><p>The in vitro entrainment experiment in Figure 2 has been repeated two more times with a new batch of purified proteins and measured using a fluorescent reporter of oscillations which allows us to more accurately determine phase. These data, along with validation of the fluorescent reporter system, are now in Figure 2—figure supplements 1 and 2.</p><p>We measured the <inline-formula><mml:math id="inf440"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf441"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> step response functions in two more replicates, again using a new set of purified proteins and the fluorescent reporter system. These data are now shown in Figure 3. The original data from Figure 3 (KaiC phosphorylation measured by SDS-PAGE) is now in Figure 4—figure supplement 2. The modeling in Figures 4,6 has also been updated to use these more accurately determined <inline-formula><mml:math id="inf442"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf443"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> step response functions for the new protein prep. While replicate measurements on the same protein prep are in close agreement (curves in Figure 3C and 3D) there is some prep-to-prep variability in these experiments; our new protein prep is less responsive to nucleotide shifts. For both preparations of clock proteins, the model works well in the sense that phase shift functions correctly predict linear scaling of entrainment (Figure 4C).</p><p><italic>Reviewer #1:</italic> </p><p><italic>[…] Would there be a more powerful way to exploit the purF reporter? I assume the authors do not have dual reporter strains? I would recommend putting the purF figure in the main, and to analyze the KaiC data in the same way (i.e. multiple peaks etc.).</italic> </p><p>We decided to keep the purF reporter data in the supplement as in the original submission. As the reviewer suggests, the best comparison would use a dual reporter approach, which is not currently feasible using our bioluminescence detection system.</p><p><italic>An important test for the model would be to analyze period mutants. That, is assuming that the phase shifts do not depend on the mutations, it would be straightforward to predict if mode-locking can still occur, and if so what the entrainment phase is. Looking at period mutants seems quite obvious, why did the authors not do this?</italic> </p><p>We agree that varying the natural frequency of the clock vs. the driving cycle is an important test for the model. Our preliminary experiments with period mutants suggested that many known point mutants that alter the period of oscillations also alter their amplitude. In light of our geometric model, where amplitude changes correspond to altered size of the limit cycle attractor, we expect that mutants that change both period and amplitude will change the entrained behavior of the clock in a way which requires a case-by-case investigation of each mutant. For this reason, we probed this issue in the reverse way, by changing the frequency of the driving cycle for WT cells. These data are in Figure 6C along with a simultaneous fit showing self-consistency of the model (unchanged from the original submission).</p><p><italic>Moreover, it would have been informative to identify mutants with entrainment defects. Or perhaps some entrainment mutants are already reported, and could have been analyzed?</italic> </p><p>This is a good suggestion, though most known entrainment mutants (e.g. cikA, glgC, pr-1 allele of kaiC) seem to act in part by altering metabolism in light vs. dark, and will again need to be studied in a case-by-case way to understand how these effects can be translated into the dynamical systems language of attractor geometry. We think it’s a good direction for future work.</p><p><italic>Also, from the dynamical systems points of view, 1-d maps like the one proposed exhibit complex behavior (period doubling, chaos, etc.). It would have been very interesting to try and probe whether other regimes besides 1:1 can occur.</italic> </p><p>We have now generated a bifurcation diagram as a function of driving period for the model based on the <italic>L</italic> and <italic>D</italic> maps derived from our biochemical measurements. This map is in Figure 3—figure supplement 1. As expected, we find a band of frequencies around the natural frequency where entrainment occurs (an Arnold tongue). Outside of this band, apparently chaos-like dynamics emerge, though entrainment reappears at multiples of the natural frequency (e.g. near 12 hour driving period).</p><p><italic>Reviewer #2:</italic> </p><p><italic>The work appears to be of high quality, has very robust data, and should be interesting to the eLife audience. I do have the following concerns however.</italic> </p><p><italic>1) Concepts developed in the paper. In the paper it is assumed that clocks in individual cells can only track one phase, and it is argued that tracking midday should be the optimal strategy, as it allows proportional expression of dawn and dusk genes. I think both these ideas require further thought and justification. It is well known in the plant clock field that the clock network can track dawn and dusk. For example (Edwards et al., 2010). There has also been theoretical studies on clocks (without assuming any multicellularity or coupling between cells) to examine what it takes to track more than one phase (Rand et al., J. Royal Society Interface, 2004). As the cyanobacterial clock is limited to one feedback loop this presumably means it is limited to tracking one phase, but this point should be discussed. If you are going to track one phase, it is not clear that tracking midday is an optimal decision. It could be that evening genes become more important under shorter days for example. It is not clear to me that equi-partitioning of the resources into two classes is necessarily clearly the optimal strategy.</italic> </p><p>We agree with the reviewer that it is not obvious that an organism with a single feedback loop clock should track the middle of the day. We have removed our speculative hypothesis about metabolic balance from the beginning of the paper and instead raise the idea briefly in the Discussion section. We have now included citations to this previous work in the following paragraph:</p><p><italic>“</italic>The ability of circadian systems to keep track of the phase of the light-dark cycle has been long recognized in plants, insects, rodents and higher mammals (de Montaigu et al., 2015; Daan et al., 2001; Edwards et al., 2010; Hut, Oort and Daan, 1999; Hut et al., 2013; Wehr 2001). […] Consistent with this picture, we find that the core circadian oscillator in cyanobacteria, which relies on a single posttranslational feedback loop, keeps track of a single phase—the midpoint of the day portion of the cycle….”.</p><p><italic>2) Figure 7F: The cycle in phosphorylation state for the 'Day cycle' in the invitro system is quite elliptical in shape. It is not clear how one would estimate X and R from this ellipse, and whether or not one would gain a linear phase shift relationship in <inline-formula><mml:math id="inf444"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> from the elliptical orbits. It would be useful if the authors could comment on this, and perhaps show how the experimental orbits would map to the calculated <inline-formula><mml:math id="inf445"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf446"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> from the geometrical model.</italic> </p><p>We agree that the model in Figure 7 with the assumption of circular, strongly attracting limit cycles is unrealistically simple. We have added new material in Figure 7—figure supplement 2 that shows the results of relaxing these assumptions. We consider a finite relaxation time when the system is displaced from the limit cycle following a dusk or dawn transition, ellipticity, and nonuniform angular velocity. We find that the entrainment behavior is very similar until the relaxation time becomes comparable to the length of the day itself. Similarly, ellipticity or nonuniform rotational velocity have minor effects, but do not change the basic conclusion that limit cycle separation in day vs. night must be comparable to the radius of the larger orbit to obtain entrainment similar to our observations in <italic>S. elongatus</italic>.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p><italic>Please see comments below – the reviewers would like you to emphasize aspects related to the reproducibility, as was raised in the previous review. Specifically, please show all that data in the main figures (in Figure 2C, there's plenty of space to plot the two additional in vitro measurements). Also, please adapt your interpretation to take into the observed variability and discuss what the potential sources are.</italic> </p><p>We have moved all of our in vitro measurements of entrainment and step-response functions into the main panels in Figures 2 and 3. We’ve added the following text to the Discussion interpreting our results in light of the variability we observe:</p><p>“The step-response curves underlying entrainment in our model are nonlinear functions of clock phase, but they can be successfully approximated by linear functions over the interval of clock phases used during entrainment. […] In this study, we achieve this by measuring free-running oscillations in an automated way using the fluorescence polarization probe.”</p><p>Additionally, we have modified the text in the Results section to discuss variability in our in vitro measurements and its possible sources:</p><p>“As mentioned above, we also measured <inline-formula><mml:math id="inf447"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf448"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> step-response functions with a separate preparation of Kai proteins using a gel-based assay to read out the phase of the KaiC phosphorylation rhythm (Figure 3E-F). […] The discrepancy in magnitude between these measurements may point to differences in sensitivity to input cues between different preparations of Kai proteins, or to a slight perturbative effect of fluorescently labeled KaiB.”</p><p>Taking into account our observed variability, we have also modified the text to deemphasize the specific value of the scaling coefficient, <italic>m</italic>; that <italic>m</italic> takes intermediate values both in vivo and in vitro shows that the reconstitution captures the essential physics of the system, but we have no reason to expect the in vivo and in vitro phase responses to be precisely the same:</p><p>“To more accurately measure the scaling of entrained phase with day length in KaiABC oscillator reactions, we turned to a fluorescence polarization probe that enables automated measurement of oscillator state with high temporal resolution (Figure 2— figure supplement 1) (Chang et al., 2012; Heisler et al., in press). […] Despite the variability in our estimates of <italic>m</italic>, these measurements argue that the in vitro oscillator successfully captures the essential feature of seasonal entrainment we observed in vivo: linear scaling of entrained phase with an intermediate slope.”</p><p>We have added text explaining why we have higher confidence in our fluorescence polarization measurements than in the traditional SDS-PAGE analysis of KaiC phosphorylation:</p><p>“We found that simulated entrainment of the phase oscillator model was particularly sensitive to the regions surrounding subjective dusk (on <inline-formula><mml:math id="inf449"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) and subjective dawn (on <inline-formula><mml:math id="inf450"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) (Figure 3E-F, <italic>colored arrows</italic>), which were only sampled with small numbers of points. Because the fluorescence polarization approach allows us to measure many conditions in an automated way over many days, and thus to disentangle phase shifts from period differences (Figure 3C-D), these higher time resolution measurements better constrain the portions of the response functions critical for entrainment.”</p><p><italic>Reviewer #1:</italic> </p><p><italic>I believe the revised version addresses the general editorial comments adequately.</italic> </p><p><italic>In addition, though the authors have partially addressed my comments, I regret that they did not consider my first major point on integrating the purF data in the main text, and also not analyze their KaiC data in the same way. I liked the purF analysis with the multiple peaks, which seemed more thorough than that presented for KaiC in the main. In particular this modification seemed not to represent a lot of extra work, so it is not intuitive why it was not done.</italic> </p><p>We agree with the reviewer that locally fitting parabolas to mark peak positions is a good way to estimate peak times of our oscillations. We have done this analysis for the strain carrying the kaiBC reporter and have replaced data in Figure 1C with peak times obtained using this approach.</p><p>In particular, we found good agreement in the value of the scaling coefficient m calculated using the sinusoidal fitting (m=0.55 ± 0.02) and parabolic fitting approaches (m=0.53 ± 0.01). Our estimates of the slope m for the kaiBC expression reporter are listed in <xref ref-type="table" rid="tbl1">Table 1</xref>.</p><p>We feel that adding the purF data to Figure 1C would distract from Figure 1’s focus on the expression of the kaiBC gene reporter and, in turn, the main narrative. Interested readers can find these data in Figure 1—figure supplement 3.</p><p><italic>Reviewer #2:</italic> </p><p><italic>In general I am happy with the revision, but I have the following concerns.</italic> </p><p><italic>The new in vitro experiments slopes using a different method based on a fluorescent probe are less near to m = 0.5 than one would have expected (at 0.38). It isn't clear why the non-repeated in vitro study based on% KAICP is used in Figure 2 (with a m value of 0.51), whilst the new method that is repeated (showing an answer that is less close to the in vivo values) is in the supplement. This is especially true as Figure 3 now uses the new data from the fluorescent probe. In Figure 2C the comparison is only made between the non-repeated in vitro method based on% KAICP, but the slopes based on the new method using an in situ fluorescent probe are not included. The authors should include the values from the new experiments in Figure 2C.</italic> </p><p>We agree with the reviewer’s suggestion and have added all of the data into main figure panels (see above).</p><p><italic>In Figure 3A it appears that phase shifts much larger than 4 hours are possible, even though phase shifts of &lt;4 hours are claimed in the text and displayed in Figure 3C. Could the authors please explain the differences?</italic> </p><p>The reviewer raises an excellent point that there is a visual discrepancy between the phase shift magnitudes in Figure 3A and 3C. The reason for this difference is that there is a ≈2 hour difference in oscillator periods in day-mimicking versus night-mimicking conditions. Thus, differences in peak times in Figure 3A, which shows oscillations over a 72 hour time period after the step perturbation, have two contributions: (1) the instantaneous phase shift caused by the step and (2) the two rhythms drifting out of phase over time as a result of the different periods of the control and step-down reactions. Thus the peak-to-peak time differences in Figure 3A are larger than in Figure 3C, which displays our estimates of instantaneous phase shifts at the time of the step and excludes any contributions from period differences accumulated in free-running conditions after the step transition.</p><p>In addressing the reviewer’s comment, we refined our procedure for computing phase shifts, as described in the third paragraph of the subsection “Seasonal adaptation of the circadian oscillator can be decomposed into step responses to individual metabolic cues”. While this shifts certain numbers slightly, it does not have any significant impact on the results or their interpretation. To avoid confusion, we have clarified how these measurements are described in the main text and have added a new supplementary figure (Figure 3—figure supplement 1) illustrating the data analysis procedure:</p><p>“We proceeded to calculate phase shifts from these measurements, taking into consideration that a switch to nighttime buffer conditions could affect the oscillator in two ways: the phase of the oscillation can shift, and the oscillator period may change, both of which can change the relative timing of peaks. [...] We detail our procedure for analyzing these data to extract phase shifts in Figure 3—figure supplement 1.”</p></body></sub-article></article>