<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1d3 20150301//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1d3" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="hwp">eLife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">20487</article-id><article-id pub-id-type="doi">10.7554/eLife.20487</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Stem Cells and Regenerative Medicine</subject></subj-group></article-categories><title-group><article-title>Dynamics of embryonic stem cell differentiation inferred from single-cell transcriptomics show a series of transitions through discrete cell states</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-64867"><name><surname>Jang</surname><given-names>Sumin</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8918-7059</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="corresp" rid="cor1">*</xref><xref ref-type="fn" rid="equal-contrib">†</xref><xref ref-type="other" rid="par-1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-66912"><name><surname>Choubey</surname><given-names>Sandeep</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-64869"><name><surname>Furchtgott</surname><given-names>Leon</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4258-0950</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-45330"><name><surname>Zou</surname><given-names>Ling-Nan</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-66913"><name><surname>Doyle</surname><given-names>Adele</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-66717"><name><surname>Menon</surname><given-names>Vilas</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-66919"><name><surname>Loew</surname><given-names>Ethan B</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-67243"><name><surname>Krostag</surname><given-names>Anne-Rachel</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-67244"><name><surname>Martinez</surname><given-names>Refugio A</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-67245"><name><surname>Madisen</surname><given-names>Linda</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-66917"><name><surname>Levi</surname><given-names>Boaz P</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-45326"><name><surname>Ramanathan</surname><given-names>Sharad</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="corresp" rid="cor2">*</xref><xref ref-type="other" rid="par-2"/><xref ref-type="other" rid="par-3"/><xref ref-type="other" rid="par-4"/><xref ref-type="fn" rid="con12"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">FAS Center for Systems Biology</institution>, <institution>Harvard University</institution>, <addr-line><named-content content-type="city">Cambridge</named-content></addr-line>, <country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Molecular and Cellular Biology</institution>, <institution>Harvard University</institution>, <addr-line><named-content content-type="city">Cambridge</named-content></addr-line>, <country>United States</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Biophysics Program</institution>, <institution>Harvard University</institution>, <addr-line><named-content content-type="city">Cambridge</named-content></addr-line>, <country>United States</country></aff><aff id="aff4"><label>4</label><institution>Allen Institute for Brain Science</institution>, <addr-line><named-content content-type="city">Seattle</named-content></addr-line>, <country>United States</country></aff><aff id="aff5"><label>5</label><institution content-type="dept">School of Engineering and Applied Sciences</institution>, <institution>Harvard University</institution>, <addr-line><named-content content-type="city">Cambridge</named-content></addr-line>, <country>United States</country></aff><aff id="aff6"><label>6</label><institution content-type="dept">Harvard Stem Cell Institute</institution>, <institution>Harvard University</institution>, <addr-line><named-content content-type="city">Cambridge</named-content></addr-line>, <country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Yosef</surname><given-names>Nir</given-names></name><role>Reviewing editor</role><aff><institution>University of California</institution>, <country>United States</country></aff></contrib></contrib-group><author-notes><corresp id="cor1"><email>suminjang@gmail.com</email> (SJ);</corresp><corresp id="cor2"><email>sharad@cgr.harvard.edu</email> (SR)</corresp><fn fn-type="con" id="equal-contrib"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="pub" publication-format="electronic"><day>15</day><month>03</month><year>2017</year></pub-date><pub-date pub-type="collection"><year>2017</year></pub-date><volume>6</volume><elocation-id>e20487</elocation-id><history><date date-type="received"><day>09</day><month>08</month><year>2016</year></date><date date-type="accepted"><day>31</day><month>01</month><year>2017</year></date></history><permissions><copyright-statement>© 2017, Jang et al</copyright-statement><copyright-year>2017</copyright-year><copyright-holder>Jang et al</copyright-holder><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-20487-v2.pdf"/><related-article ext-link-type="doi" id="ra1" related-article-type="article-reference" xlink:href="10.7554/eLife.20488"/><related-article ext-link-type="doi" id="ra2" related-article-type="commentary" xlink:href="10.7554/eLife.25654"/><abstract><object-id pub-id-type="doi">10.7554/eLife.20487.001</object-id><p>The complexity of gene regulatory networks that lead multipotent cells to acquire different cell fates makes a quantitative understanding of differentiation challenging. Using a statistical framework to analyze single-cell transcriptomics data, we infer the gene expression dynamics of early mouse embryonic stem (mES) cell differentiation, uncovering discrete transitions across nine cell states. We validate the predicted transitions across discrete states using flow cytometry. Moreover, using live-cell microscopy, we show that individual cells undergo abrupt transitions from a naïve to primed pluripotent state. Using the inferred discrete cell states to build a probabilistic model for the underlying gene regulatory network, we further predict and experimentally verify that these states have unique response to perturbations, thus defining them functionally. Our study provides a framework to infer the dynamics of differentiation from single cell transcriptomics data and to build predictive models of the gene regulatory networks that drive the sequence of cell fate decisions during development.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.001">http://dx.doi.org/10.7554/eLife.20487.001</ext-link></p></abstract><kwd-group kwd-group-type="author-keywords"><title>Author Keywords</title><kwd>germ layer differentiation</kwd><kwd>context dependence</kwd><kwd>Single-cell RNA-seq</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research Organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="par-1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004358</institution-id><institution>Samsung</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Jang</surname><given-names>Sumin</given-names></name></principal-award-recipient></award-group><award-group id="par-2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000052</institution-id><institution>NIH Office of the Director</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Ramanathan</surname><given-names>Sharad</given-names></name></principal-award-recipient></award-group><award-group id="par-3"><funding-source><institution-wrap><institution>Office of the Director</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Ramanathan</surname><given-names>Sharad</given-names></name></principal-award-recipient></award-group><award-group id="par-4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100008796</institution-id><institution>Allen Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Ramanathan</surname><given-names>Sharad</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta><meta-name>elife-xml-version</meta-name><meta-value>2.5</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Mammalian germ layer differentiation is characterized by transitions through discrete cell states, which are transcriptionally as well as functionally distinct.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>During differentiation, cells repeatedly choose between alternative fates in order to give rise to a multitude of distinct cell types. A major challenge in developmental biology is to uncover the dynamics of gene expression and the underlying gene regulatory networks that lead cells to their different fates. Given the complexity of gene regulatory networks, with their large number of components and even larger number of potential interactions between those components, building detailed predictive mathematical models is challenging. The lack of sufficient data requires a large number of assumptions to be made in order to constrain all the parameters in such models (<xref ref-type="bibr" rid="bib24">Karr et al., 2012</xref>).</p><p>Our accompanying work on extracting cell states and the sequence of cell state transitions from gene expression data (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>) suggested that following the dynamics of a key set of genes was sufficient to trace these transitions, and in several instances the set of key genes that we discovered were also functionally important for lineage decisions. We asked whether we could similarly determine the suitable parameters to quantitatively describe cell state transitions during early mammalian germ layer development and build predictive mathematical models of the underlying regulatory network.</p><p>Early differentiation of pluripotent mouse embryonic stem (mES) cells, which are derived from the inner cell mass of the peri-implantation stage embryo (see pictorial summary in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1A</xref>), recapitulate various aspects of in vivo germ layer differentiation (<xref ref-type="bibr" rid="bib9">Evans and Kaufman, 1981</xref>; <xref ref-type="bibr" rid="bib25">Keller, 2005</xref>). During this stage, both mES cells and cells in vivo express key pluripotency factors, such as <italic>Nanog</italic>, <italic>Sox2</italic>, <italic>Oct4</italic>, <italic>Klf4</italic>, <italic>Jarid2</italic>, and <italic>Esrrb</italic>, which mutually activate one another to form a pluripotency circuit (<xref ref-type="bibr" rid="bib26">Kim et al., 2008</xref>; <xref ref-type="bibr" rid="bib68">Young, 2011</xref>; <xref ref-type="bibr" rid="bib69">Zhou et al., 2007</xref>). Following implantation, naïve pluripotent ES cells of the inner cell mass downregulate <italic>Klf4</italic> and upregulate <italic>Otx2</italic>, <italic>Dnmt3a</italic>, and <italic>Dnmt3b</italic>, as they transition into ‘primed’ pluripotent cells found in the epiblast (<xref ref-type="bibr" rid="bib5">Buecker et al., 2014</xref>; <xref ref-type="bibr" rid="bib42">Nichols and Smith, 2009</xref>). Over the next few days of differentiation, TGF-beta signaling factors, with the aid of WNT/beta-catenin signaling, promote and inhibit the differentiation of pluripotent cells into mesendodermal (characterized by genes such as <italic>Brachyury</italic> (<italic>T</italic>), <italic>FoxA2</italic>, <italic>Mixl1</italic> and <italic>Gsc</italic>) and ectodermal (characterized by <italic>Eras</italic>, <italic>Sez6</italic>, <italic>Stmn3</italic>, and <italic>Stmn4</italic>) cell fates, respectively (<xref ref-type="bibr" rid="bib12">Gadue et al., 2006</xref>; <xref ref-type="bibr" rid="bib19">Hart et al., 2002</xref>; <xref ref-type="bibr" rid="bib34">Li et al., 2015</xref>; <xref ref-type="bibr" rid="bib35">Lindsley et al., 2006</xref>; <xref ref-type="bibr" rid="bib56">Tada et al., 2005</xref>; <xref ref-type="bibr" rid="bib64">Watabe and Miyazono, 2009</xref>). Mesendodermal progenitors further differentiate into mesoderm and definitive endoderm progenitors. Mesoderm cells are usually distinguished by the expression of <italic>Gata4</italic> and <italic>Eomes</italic>, and endoderm cells by <italic>Sox17</italic> and <italic>FoxA2</italic>, although in mouse these genes are shared between both lineages, with differences only in their timing and level of expression (<xref ref-type="bibr" rid="bib2">Arnold and Robertson, 2009</xref>; <xref ref-type="bibr" rid="bib23">Kanai-Azuma et al., 2002</xref>; <xref ref-type="bibr" rid="bib28">Kim and Ong, 2012</xref>; <xref ref-type="bibr" rid="bib36">Lumelsky et al., 2001</xref>; <xref ref-type="bibr" rid="bib48">Rojas et al., 2005</xref>). Along the ectodermal lineage, BMP signaling pushes ectodermal cells toward epidermis, while in the absence of BMP signaling, ectodermal cells acquire a neural fate (<xref ref-type="bibr" rid="bib65">Wilson and Hemmati-Brivanlou, 1995</xref>). Epidermal cells are characterized by Keratins, whereas neural cells express <italic>Sox1</italic> and <italic>Pax6</italic> (<xref ref-type="bibr" rid="bib30">Koch and Roop, 2004</xref>; <xref ref-type="bibr" rid="bib44">Pevny et al., 1998</xref>; <xref ref-type="bibr" rid="bib50">Sansom et al., 2009</xref>; <xref ref-type="bibr" rid="bib54">Streit and Stern, 1999</xref>). The cells at the physical border between epidermal and neural cells give rise to neural crest cells (expressing <italic>Sox10</italic>, <italic>Msx2</italic>, <italic>Snai1</italic> and <italic>Slug</italic>) in response to WNT and BMP signaling, which are often described as a fourth germ layer because of the diverse range of tissues to which they give rise (<xref ref-type="bibr" rid="bib14">Gans and Northcutt, 1983</xref>; <xref ref-type="bibr" rid="bib29">Knecht and Bronner-Fraser, 2002</xref>; <xref ref-type="bibr" rid="bib31">Nicole and Chaya, 1991</xref>). Despite the detailed understanding of early embryonic development revealed by decades of work in genetics and developmental biology, a quantitative understanding of how the underlying gene regulatory network leads cells through a series of cell fate decisions has remained elusive.</p><p>We use single-cell RNA-seq to determine how gene expression patterns change as mouse embryonic stem cells differentiate into different germ-layer progenitors. We employ a Bayesian framework (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>) to simultaneously infer cell states, the sequence of transitions between these states, and the key sets of genes whose expression patterns provide a parameter space in which the cell states and cell state transitions are inferred. Our computational analysis, together with experimental validation using flow cytometry and live-cell imaging of a new <italic>Otx2</italic> reporter mES cell line, suggest that cells reside in discrete states and rapidly transition from one state to another.</p><p>Using the inferred gene expression dynamics and by requiring models to replicate the existence of the observed discrete cell states, we extract probability distributions of the parameters of a model gene regulatory network. Intriguingly, requiring the model to have discrete cell states leads to the prediction that each cell state has a distinct response to perturbations by signals and changing transcription factor expression levels. We experimentally verify three distinct categories of predictions, each testing whether cells exhibit such state-dependent behavior in response to a different type of perturbation. The experimental results conclude that whether (i) <italic>Sox2</italic> overexpression represses <italic>Oct4</italic>, (ii) <italic>Snai1</italic> overexpression represses <italic>Oct4</italic>, and (iii) LIF and BMP promote pluripotency or differentiation into neural crest, all depend on cell state. Finally, we discuss the biological implications of our results.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Acquiring single-cell transcriptomics data during early differentiation</title><p>We differentiated populations of mES cells by exposing them to one of four combinations of signaling factors and small molecules to perturb key paracrine signaling pathways involved in early mammalian patterning (<xref ref-type="bibr" rid="bib45">Power and Tam, 1993</xref>; <xref ref-type="bibr" rid="bib57">Tam et al., 2006</xref>): FGF, WNT, and/or TGF-beta signaling for up to five days (<xref ref-type="fig" rid="fig1">Figure 1A</xref>; see also <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1B</xref>, Materials and methods). Although cells in each population were differentiated in a monolayer culture and therefore exposed to nearly uniform conditions, we observed significant heterogeneity in the expression – as measured by immunofluorescence – of various known early germ layer marker genes (such as T, Pax6, Slug, FoxA2, and Gata4) in each population, suggesting a diversity of cell types under the same signaling conditions (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). Further, undifferentiated pluripotent cells persisted in differentiating populations (<xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>, <xref ref-type="supplementary-material" rid="SD2-data">Figure 2—source data 1</xref>). Therefore, to capture the cell-to-cell variability within differentiating populations, we collected and transcriptionally profiled single cells every 24 hr over the course of five days of differentiation (<xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>) using a modified version of CEL-seq (<xref ref-type="bibr" rid="bib20">Hashimshony et al., 2012</xref>). We obtained gene expression data from a total of 288 cells (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1C–J</xref>; Materials and methods) with a median of 508,939 mapped reads, 48,475 transcripts and 7032 genes detected per cell. We then randomly subsampled 20,000 reads from each cell to eliminate any technical biases that may have resulted from differences in read numbers across cells (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1K</xref>).<fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.002</object-id><label>Figure 1.</label><caption><title>Single-Cell Gene Expression Profiling of mESCs during early germ layer differentiation.</title><p>(<bold>A</bold>) Mouse embryonic stem cells (mESCs) were exposed to various differentiation conditions to perturb FGF, WNT, and TGF-beta signaling for up to five days of differentiation. Single cells, collected every 24 hr during differentiation, were transcriptionally profiled using CEL-Seq. (See also <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1B</xref> and <xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>). (<bold>B</bold>) Images of immunostained mESCs undergoing differentiation show cell-to-cell variability in their expression of known germ layer marker genes. (Scale bar = 100 μm).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.002">http://dx.doi.org/10.7554/eLife.20487.002</ext-link></p><p><supplementary-material id="SD1-data"><object-id pub-id-type="doi">10.7554/eLife.20487.003</object-id><label>Figure 1—source data 1.</label><caption><title>Differentiation conditions and duration of single cells sorted into seven 96-well plates.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.003">http://dx.doi.org/10.7554/eLife.20487.003</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-20487-fig1-data1-v2.docx"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig1-v2"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.004</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Quality validation of single-cell RNA-seq data.</title><p>(<bold>A</bold>) Diagram summarizing the literature on cell types (each represented by a colored circle labeled by its name) that arise during early mouse germ layer differentiation, their lineage relationships (represented by lines connecting cell types), and genes that characterize each cell type (listed in boxes that surround the cell types in which they are expressed). (<bold>B</bold>) Summary of cell culture conditions that were used to generate populations enriched with neural/non-neural ectoderm, definitive endoderm, or mesoderm-like cells over the course of up to five days. Undifferentiated ES cells were maintained in LIF/PD0/CHIR (i.e. Lif2i) conditions, and duration of differentiation was measured from the time at which these conditions were removed. (<bold>C</bold>) Histogram of the number of Unique Molecular Identifiers (UMIs) mapping to annotated genes per cell. Note that this histogram includes 84 control (empty or ERCC-only) wells. (<bold>D</bold>) Box and whisker plots of the number of UMIs mapping to annotated genes per cell, grouped by cell cluster (total cells = 288). (<bold>E</bold>) Percentage of reads mapping to the transcriptome, to the genome (i.e. regions outside the reference transcriptome annotation), and to ERCC spike-in control sequences, and percentage of reads unmapped per cell. Cells are grouped by cell cluster. (<bold>F</bold>) Box and whisker plots of the number of genes detected (UMI &gt; 0) per cell, grouped by cluster, using the full data set (clear boxes) and after subsampling cells to 20,000 transcriptome-mapping UMIs (red boxes). (<bold>G</bold>) Representative plots for two cells, showing the number of UMIs detected for each ERCC species versus the putative number of molecules spiked in. UMI counts are based on subsampling to 20,000 transcriptome-mapping UMIs. Pearson’s R values in log space, using all ERCC species and using only ERCC species present at &gt;1 molecule (in parentheses) are shown for each cell. (<bold>H</bold>) Same as <bold>E</bold>, but with mean and SEM values for all clustered cells, after subsampling to 20,000 transcriptome-mapping UMIs per cell. (<bold>I</bold>) Fraction of times a given ERCC species is detected (UMI &gt; 0) in all clustered cells, after subsampling to 20,000 transcriptome-mapping UMIs per cell, versus the putative number of ERCC molecules spiked in. The red line indicates expected detection fractions based on Poisson statistics of dilution, whereas the black line indicates the best fit through the experimental data. The fit suggests that the detection rate is 1 out of 35 molecules. (<bold>J</bold>) Clustered heatmap of Pearson’s correlation coefficients among clustered cells based on ERCC UMI expression values. Clustering was done using average linkage with a distance metric of 1 – Pearson’s R. The color bar at the top identifies the cluster membership of each cell; cells of the same type do not cluster together based on ERCC expression, suggesting a lack of process-related artifacts in the final clusters. All box and whisker plots use boxes to represent the 25th and 75th percentile, and whiskers represent 1.5 times the intra-quartile range. (<bold>K</bold>) 288 cells (each dot is a cell) – colored by the total number of UMI reads – plotted against the first two principal components (x-axis, y-axis) of gene expression data calculated after subsampling 20,000 UMIs per cell. This shows that after subsampling 20,000 UMIs for each cell, cells do not show correlations based on read depth.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.004">http://dx.doi.org/10.7554/eLife.20487.004</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig1-figsupp1-v2"/></fig></fig-group></p></sec><sec id="s2-2"><title>Bayesian statistical approach discovers appropriate coordinate systems to infer cell states and state transitions</title><p>One of the challenges in analyzing single-cell gene expression data is the high dimensionality of the data set and the concomitant sparsity of the data (the number of data points divided by the dimensionality is small) (<xref ref-type="bibr" rid="bib1">Advani and Ganguli, 2016</xref>). Conventional analysis of single-cell gene expression data relies on multi-gene or multi-cell correlation estimates, such as PCA (Seurat) (<xref ref-type="bibr" rid="bib51">Satija et al., 2015</xref>), ICA (Monocle) (<xref ref-type="bibr" rid="bib61">Trapnell et al., 2014</xref>) and WGCNA (<xref ref-type="bibr" rid="bib33">Li et al., 2016</xref>; <xref ref-type="bibr" rid="bib49">Saadatpour et al., 2014</xref>) to reduce the dimensionality of expression data. However, discovering cell types and their lineage relationships using these methods has been challenging (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>).</p><p>In the accompanying paper, Furchtgott et al. develop a Bayesian framework that simultaneously infers (i) cell cluster identities of the cells, <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mo>≡</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>,, (ii) the sets of transitions <inline-formula><mml:math id="inf2"><mml:mrow><mml:mrow><mml:mo>{</mml:mo> <mml:mtext>T</mml:mtext> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> between these clusters, (iii) the key sets of marker genes <inline-formula><mml:math id="inf3"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> that define each cell cluster and (iv) the sets of transition genes <inline-formula><mml:math id="inf4"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> that define the transitions between clusters, from single-cell gene expression data <inline-formula><mml:math id="inf5"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, by means of an iterative algorithm to determine the maximum likelihood estimates of these variables (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>).</p><p>Here, we employed this Bayesian framework to discover cell types and infer their lineage relationships for early mouse germ layer differentiation. We started by clustering the single-cell gene expression data for the 288 cells into 12 seed clusters <inline-formula><mml:math id="inf6"><mml:mrow><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow> <mml:mo>}</mml:mo></mml:mrow><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> using Seurat (<xref ref-type="bibr" rid="bib51">Satija et al., 2015</xref>) as well as k-means (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A, B and C</xref>), restricting the analysis to transcription factors (2672 total) because of their functional role in orchestrating global gene expression (<xref ref-type="bibr" rid="bib53">Spitz and Furlong, 2012</xref>). Seurat identifies cell clusters by performing density-based clustering on a two dimensional t-distributed Stochastic Neighbor Embedding (t-SNE) map of the gene expression data (<xref ref-type="bibr" rid="bib62">Van der Maaten and Hinton, 2008</xref>). These clusters <inline-formula><mml:math id="inf7"><mml:mrow><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, ranging in size from 14 to 47 single cells, served as a seed for the iterative algorithm (described below).</p><p>We next considered every possible group of 3 clusters (e.g., <inline-formula><mml:math id="inf8"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo> <mml:mo/><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf9"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>) from a total of <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi/><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>220</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> such combinations. For each triplet of clusters, we first determined the probability that each gene <inline-formula><mml:math id="inf11"><mml:mrow><mml:mi>i</mml:mi> <mml:mo/></mml:mrow></mml:math></inline-formula>was a marker gene (<inline-formula><mml:math id="inf12"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>), a transition gene (<inline-formula><mml:math id="inf13"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>) or neither (<inline-formula><mml:math id="inf14"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) based on the distribution of their expression patterns in cells of each cluster, where <inline-formula><mml:math id="inf15"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the single-cell gene expression data of the <inline-formula><mml:math id="inf16"><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo></mml:mrow></mml:math></inline-formula>th gene. Marker and transition genes are defined as follows (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>, Materials and methods,; <xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>): (i) A marker gene <inline-formula><mml:math id="inf17"><mml:mrow><mml:mi>i</mml:mi> <mml:mo/><mml:mo>(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> has a distribution of expression levels that is <italic>highest</italic> in one cluster, and well separated from the distribution of its expression levels in the other two clusters. Marker genes distinguish one of the clusters from the other two. (ii) A transition gene j <inline-formula><mml:math id="inf18"><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> has a distribution of expression levels that is <italic>lowest</italic> in one cluster, and well separated from the distribution of its expression levels in the other two clusters. Each such transition gene establishes relative relationships between the three clusters (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>). (iii) Genes that are neither marker (<inline-formula><mml:math id="inf19"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) nor transition genes (<inline-formula><mml:math id="inf20"><mml:mrow><mml:mi>β</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) do not follow constraints (i) and (ii) on expression level distributions. Computing the probability of each gene being a marker gene, a transition gene, or neither allowed us to determine the most likely set of transitions <inline-formula><mml:math id="inf21"><mml:mtext>T</mml:mtext></mml:math></inline-formula> between each triplet of clusters. Each gene’s contribution to the posterior probability <inline-formula><mml:math id="inf22"><mml:mtext>T</mml:mtext></mml:math></inline-formula> is weighted by the odds ratio that the gene is a transition gene (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>). For example, for clusters <inline-formula><mml:math id="inf23"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo> <mml:mo/><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf24"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, a gene whose expression is lower in <inline-formula><mml:math id="inf25"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> casts a vote against <inline-formula><mml:math id="inf26"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> being the intermediate state (i.e., against the transition <inline-formula><mml:math id="inf27"><mml:mrow><mml:mtext>T</mml:mtext><mml:mo>=</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf28"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is intermediate, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref> right) that is weighted by its odds of being a transition gene for those three clusters (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>, left). This Bayesian framework led to a summation of these weighted votes to determine the most likely set of transitions between each set of three clusters and concomitantly the most likely marker and transition genes corresponding to these clusters and transitions (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>, right).</p><p>For the seed cluster set<inline-formula><mml:math id="inf29"><mml:mrow><mml:mo> </mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>, we determined 179 sets of transitions between clusters and identified 1035 transcription factors that were high probability marker or transition genes for at least one of the identified transitions. For a gene to be defined as a marker or transition gene, we used a probability cutoff of 0.5. Moreover, we used a probability cutoff of 0.6 for a triplet of clusters to count as a transition event. We next re-clustered the single cells in the gene expression space defined by these 1035 marker or transition genes using Seurat, to obtain a new cluster set <inline-formula><mml:math id="inf30"><mml:mrow><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow> <mml:mo>}</mml:mo></mml:mrow><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula>consisting of 10 clusters. In this process, cells changed cluster identities, and certain clusters merged (<xref ref-type="fig" rid="fig2">Figure 2A</xref>, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1C</xref>).<fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.005</object-id><label>Figure 2.</label><caption><title>Iterative Bayesian algorithm converges upon a set of cell clusters and local transitions that together define a multi-potent lineage tree.</title><p>(<bold>A</bold>) Iterative determination of the most likely sets of transitions<inline-formula><mml:math id="inf31"><mml:mrow><mml:mo> </mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mtext>T</mml:mtext> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and re-clustering of cells in the resulting subspace of transition and marker genes, starting from a seed set of cluster identities <inline-formula><mml:math id="inf32"><mml:mrow><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>. With each iteration, the cluster identities as well as the total number of clusters change, as shown by the Seurat t-SNE maps (each dot represents a cell, colored based on its cluster identity). The inferred sets of transitions between clusters at each iteration are represented as a lineage tree (each circle represents a cell cluster). After five iterations, the algorithm converged upon a set of 9 clusters (shown in box). (See also <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). (<bold>B</bold>) Left: Top ten genes (x-axis) with highest probability of being marker genes for clusters C<sub>1</sub> (yellow), C<sub>2</sub> (light red) and C<sub>3</sub> (light green) plotted against their probability of being marker genes. Right: Cell-cell correlation matrix computed using these 30 marker genes for the 108 cells belonging to clusters C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub> shows three clear blocks of high correlation along the diagonal. (<bold>C</bold>) Left: Top ten genes (x-axis) with highest probability of being transitioned genes for clusters C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub>, plotted against their probability of being transitioned genes (y-axis). The transition genes belong to one of two classes, those that show high expression in cells belonging to C<sub>1</sub> and C<sub>2</sub> but low expression in C<sub>3</sub> (red), and those expressed at high levels in cells in clusters C<sub>1</sub> and C<sub>3</sub> but low levels in C<sub>2</sub> (green). The cell-cell correlation matrix computed using these 20 transition genes shows that the 29 cells belonging to cluster C<sub>1</sub>have intermediate levels of correlation with cells in both C<sub>2</sub> and C<sub>3</sub>, whereas the 46 cells in C<sub>2</sub> show low correlation levels with the 33 cells in C<sub>3</sub>. (<bold>D</bold>) The global cell-cell correlation matrix computed for all 288 cells using the 889 genes used for the final iteration of clustering shows a barely detectable structure. (<bold>E</bold>) The inferred clusters and their lineage relationships can be represented in a three-dimensional coordinate system where the x- and y- axes are the normalized log expression level of the two classes of transition genes (genes in <xref ref-type="fig" rid="fig2">Figure 2B</xref>, left) and the z-axis measures the normalized log expression level of the marker genes for cluster C<sub>1</sub> (<xref ref-type="fig" rid="fig2">Figure 2A</xref> left in yellow). Each dot represents a single cell, and cells are colored based on their cluster identity.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.005">http://dx.doi.org/10.7554/eLife.20487.005</ext-link></p><p><supplementary-material id="SD2-data"><object-id pub-id-type="doi">10.7554/eLife.20487.006</object-id><label>Figure 2—source data 1.</label><caption><title>Plate and well id’s of cells belonging to each cluster.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.006">http://dx.doi.org/10.7554/eLife.20487.006</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-20487-fig2-data1-v2.docx"/></supplementary-material></p><p><supplementary-material id="SD3-data"><object-id pub-id-type="doi">10.7554/eLife.20487.007</object-id><label>Figure 2—source data 2.</label><caption><title>Triplet probabilities of final tree.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.007">http://dx.doi.org/10.7554/eLife.20487.007</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-20487-fig2-data2-v2.docx"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.008</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Diagram of Bayesian framework for inferring sequence of transitions for triplets.</title><p>(<bold>A</bold>) Gene expression patterns of marker genes, transition genes, and irrelevant genes in cell clusters c<sub>1</sub>, c<sub>2</sub>, and c<sub>3</sub>. Marker genes are highly expressed in only one cluster, whereas transition genes are highly expressed in two clusters and downregulated in the third. High probability transition genes alone are used for the determination of set of transitions; both high probability transition and marker genes are used for re-clustering. (<bold>B</bold>) For the three initial clusters <inline-formula><mml:math id="inf33"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf34"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf35"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, plot of the odds of each gene (represented by a dot) being a transition gene (x-axis) and the cluster with the minimum expression of the gene (y-axis). In our framework, each gene’s odds of being a transition gene is used to compute the probabilities of the sets of transitions <inline-formula><mml:math id="inf36"><mml:mtext>T</mml:mtext></mml:math></inline-formula> between the three clusters (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>). A gene whose expression is lower in <inline-formula><mml:math id="inf37"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> casts a probabilistic vote against <inline-formula><mml:math id="inf38"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> being the intermediate state (i.e., against the relationships <inline-formula><mml:math id="inf39"><mml:mrow><mml:mtext>T</mml:mtext><mml:mo>=</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>), which is weighted by the odds that the gene is a transition gene, given the cluster identities. Two groups of genes (boxed) are the highest likelihood transition genes, casting a strong vote against <inline-formula><mml:math id="inf40"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> or <inline-formula><mml:math id="inf41"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> being the intermediate cell type. The computed probability of the topology given gene expression data indicates with. 99 probability that <inline-formula><mml:math id="inf42"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is the central node. (See also Materials and methods) (<bold>D</bold>) Left: single cells belonging to clusters <inline-formula><mml:math id="inf43"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>4</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> (dots colored based on cluster identity) in the gene expression space defined by transition and marker genes (probability &gt;0.8) associated with triplet <inline-formula><mml:math id="inf44"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf45"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf46"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>4</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>. Axes represent the normalized log expression values of, respectively, transition genes expressed in <inline-formula><mml:math id="inf47"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and downregulated in <inline-formula><mml:math id="inf48"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>4</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf49"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, and marker genes for <inline-formula><mml:math id="inf50"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>; the most likely gene of each class is represented in curly brackets. Right: after re-clustering cells in the subspace defined by high probability marker and transition genes, clusters <inline-formula><mml:math id="inf51"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf52"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>3</mml:mn><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> have merged.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.008">http://dx.doi.org/10.7554/eLife.20487.008</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig2-figsupp1-v2"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.009</object-id><label>Figure 2—figure supplement 2.</label><caption><title>Iterative clustering and lineage determination is robust to clustering method.</title><p>(<bold>A, B</bold>) Iterative clustering and lineage determination algorithm using two different clustering methods for seed clusters <inline-formula><mml:math id="inf53"><mml:mrow><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>and re-clustering: (<bold>A</bold>) Seurat, and (<bold>B</bold>) k-means clustering with the gap statistic. For each clustering method, the seed clusters were computed using the gene expression of all 2762 transcription factors. The top plot shows the number of marker and transition genes identified at each iteration and used for the subsequent re-clustering. The cluster identities for the single cells in different iterations are represented in different colors below. Despite starting with different seeds, both clustering methods converge to the same cluster identities after four iterations. (<bold>C</bold>) Two-dimensional projection of expression data from 288 single cells using Seurat. Each cell (single dot), colored by its cluster identity (there are 12 clusters in total), defined by k-means clustering, showing that t_SNE and k-means clustering lead to different seed cluster configurations. (<bold>D</bold>) Heat map showing the log-scale UMI of each of the 889 genes across all 288 cells. (<bold>E</bold>) The cell-cell correlation matrix computed using all genes with coefficient of variation greater than 10, which includes transition and marker genes, shows a barely-detectable signature of the underlying cell clusters (C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub>) and the set of transitions between them.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.009">http://dx.doi.org/10.7554/eLife.20487.009</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig2-figsupp2-v2"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.010</object-id><label>Figure 2—figure supplement 3.</label><caption><title>Iterative clustering and lineage determination is robust to changes in parameters.</title><p>(<bold>A</bold>) Iterative clustering and lineage determination is robust to changes in the threshold probability for determining whether a gene is a ‘high-probability’ transition or marker gene. Clustering configurations and lineage relationships that are inferred with a probability threshold of 0.7 (left) and 0.9 (middle-left) are identical to the original clustering configuration and lineage tree inferred with a threshold probability of 0.5 (rightmost column; lineage trees not shown). Each column corresponds to the cluster identities, represented by color, of all 288 cells (each row corresponds to one cell) for each iteration (i = 1, 2, 3 ...). The number of high-probability transition or marker genes (g#) used for clustering is shown below each iteration number. At a threshold of p=0.97 (middle-right), due to the number of genes used for re-clustering becoming ever smaller, the resulting clustering configuration shows several clusters merging or breaking into smaller clusters. (<bold>B</bold>) At a threshold of p=0.96 (left), the number of genes used for the last iteration of re-clustering (#g) is 416, which still results in a clustering configuration that is largely (&gt;95%) identical to the original configuration. In contrast, the same number of highest-variance genes leads to a distinct clustering configuration (middle) as well as lineage tree given the original clustering configuration (right). (<bold>C, D</bold>) Iterative clustering and lineage determination is robust to changes in the set of cells. In the absence of C3 cells (<bold>C</bold>), the clustering identities (left) of the remaining cells and their lineage relationships (right) are unchanged. The same is true when a random subset of half of the 288 cells are omitted (<bold>D</bold>; lineage tree not shown). (<bold>E</bold>) Left: Iterative clustering and lineage determination using k-means clustering with all 23,579 genes for the seed cluster (i = 1) and resulting high-probability (p≥0.5) transition or marker genes for subsequent clustering iterations. Right: Original (described in <xref ref-type="fig" rid="fig2">Figure 2</xref>) final clustering configuration determined using only transcription factors. The clustering configuration is the same whether the gene pool is restricted to transcription factors or includes all genes. (<bold>F</bold>) The lineage trees inferred using all genes (left) and only transcription factors (right) have different ectoderm lineage topologies: the former assigns cluster C<sub>3</sub> to be a descendent of C<sub>5</sub> and C<sub>6</sub> whereas the latter assigns C<sub>3</sub> to be a common progenitor of C<sub>5</sub> and C<sub>6</sub>. The mean differentiation duration is three days for C<sub>3</sub> cells and four days for C<sub>5</sub> and C<sub>6</sub> cells (<xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>, <xref ref-type="supplementary-material" rid="SD3-data">Figure 2—source data 2</xref>), suggesting it is unlikely that C<sub>3</sub> cells are descendants of C<sub>5</sub> and C<sub>6</sub> cells.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.010">http://dx.doi.org/10.7554/eLife.20487.010</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig2-figsupp3-v2"/></fig></fig-group></p><p>By iteratively determining the most likely sets of transitions and the most likely marker and transition genes, and by re-clustering the cells within the subspace of these genes, the algorithm converged (i.e., the number of genes of the re-clustering subspace became less than 10% of the total number of transcription factors) upon the most likely set of cell clusters (<xref ref-type="supplementary-material" rid="SD2-data">Figure 2—source data 1</xref>), the sets of transitions between these cell clusters (<xref ref-type="supplementary-material" rid="SD3-data">Figure 2—source data 2</xref>), as well as a set of 889 genes categorized as marker or transition genes for at least one set of transitions after five iterations (<xref ref-type="fig" rid="fig2">Figure 2A</xref>; <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>).</p><p>The final cluster set consists of 9 cell clusters ranging in size between 14 and 57 cells; every cell was mapped to a cluster, and we observed mixing of cells from different experimental conditions to the same cluster as well as cells from the same experimental conditions being assigned to different clusters (<xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>; <xref ref-type="supplementary-material" rid="SD2-data">Figure 2—source data 1</xref>; <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>). We combined the local sets of transitions between different triplets of clusters (<xref ref-type="supplementary-material" rid="SD3-data">Figure 2—source data 2</xref>) in order to infer the most parsimonious lineage tree between the clusters (<xref ref-type="fig" rid="fig2">Figure 2A</xref>) (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>). Importantly, we obtained identical final clusters starting with different seed cluster sets using k-means clustering with the gap statistic, as well as with different threshold probability parameter values for defining transition and marker genes, showing that our results were robust to the choice of seed clusters, threshold probability value and clustering method (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A, B and C</xref>; <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A and B</xref>; Materials and methods). The cluster identities as well as their lineage relationships were unchanged when the analysis was repeated with a subset of cells; in which either an entire cluster was removed or a random set of half (144) cells were removed (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3C and D</xref>). Further, we found that the clustering configuration does not change depending on whether the analysis is restricted to only transcription factors or includes all genes (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3E</xref>). However, using all genes resulted in greater error rates along the topology of the inferred lineage tree compared to when only transcription factors were used (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>; <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3F</xref>).</p><p>The inferred lineage relationships between the final clusters could be visualized in the subspace of inferred marker and transition genes. We illustrate this first for the three clusters C<sub>1</sub>, C<sub>2</sub>, and C<sub>3</sub>. We identified three classes of marker genes, each consisting of high-probability marker genes specific to one of the three clusters (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Each gene class is denoted by its highest probability member gene in curly brackets (e.g., {<italic>Otx2</italic>}). When the cell-cell Pearson correlation matrix between all 288 cells was determined using the 889 genes used for the final iteration of clustering and lineage determination, the matrix showed a barely detectable structure of nine blocks (with very low contrast) along the diagonal with marginally higher correlation levels, each corresponding to a cell cluster (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). As expected, the low level of contrast observed in <xref ref-type="fig" rid="fig2">Figure 2D</xref> improves dramatically when the same correlation measures are taken across cells in a triplet, using marker or transition genes for this triplet; illustrating the locally defined nature of marker and transition genes (<xref ref-type="fig" rid="fig2">Figure 2B</xref>, right; <xref ref-type="fig" rid="fig2">Figure 2C</xref>, right; <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2E</xref>). The same matrix computed using high-probability marker genes for clusters C<sub>1</sub>, C<sub>2</sub>, and C<sub>3</sub> (<xref ref-type="fig" rid="fig2">Figure 2B</xref>, left) showed three distinct blocks of high correlation along the diagonal, each corresponding to a different cluster (<xref ref-type="fig" rid="fig2">Figure 2B</xref>, right). Similarly, when the cell-cell correlations were measured using the two classes of inferred transition genes (<xref ref-type="fig" rid="fig2">Figure 2C</xref>, left), each consisting of high-probability transition genes present in C<sub>1</sub> and downregulated either in C<sub>2</sub> or in C<sub>3</sub>, the correlation matrix showed intermediate correlation levels between C<sub>1</sub> and either C<sub>2</sub> or C<sub>3</sub>, and low correlation levels between C<sub>2</sub> and C<sub>3</sub> (<xref ref-type="fig" rid="fig2">Figure 2C</xref>, right). The distribution functions of the expression levels of these transition genes in each of the three different clusters (C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub>) led to the inference that clusters C<sub>2</sub> and C<sub>3</sub> are connected via cluster C<sub>1</sub> with a probability of 0.83 (<xref ref-type="fig" rid="fig2">Figure 2E</xref>, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A and B</xref>).</p><p>We visualized the gene expression changes that characterize transitions from one cell cluster to another by plotting the cells in C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub> in a three-dimensional gene expression subspace (<xref ref-type="fig" rid="fig2">Figure 2E</xref>), using as axes the mean normalized expression levels of the two transition gene classes down-regulated in C<sub>2</sub> or C<sub>3</sub> (in red and green in <xref ref-type="fig" rid="fig2">Figure 2C</xref>) and of the marker gene class specific to C<sub>1</sub> (<xref ref-type="fig" rid="fig2">Figure 2B</xref> in orange). These axes constitute a low-dimensional coordinate system for the inferred set of transitions between C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub>.</p><p>Similarly, the inferred transitions across all sets of three clusters (<xref ref-type="supplementary-material" rid="SD3-data">Figure 2—source data 2</xref>) together form a lineage tree (<xref ref-type="fig" rid="fig3">Figure 3A</xref>) that spans all nine identified cell clusters, which can be visualized in gene expression space through a series of local transition and marker gene classes (<xref ref-type="fig" rid="fig3">Figure 3C</xref>; <xref ref-type="supplementary-material" rid="SD4-data">Figure 3—source data 1</xref>). We next investigated the gene expression variability among cells within each cluster by performing principal component analysis (PCA) on the transcription factor gene expression for cells within each cluster. Importantly, we found that for all clusters, no principal component is statistically significant (compared to randomizations of the data; <xref ref-type="fig" rid="fig3">Figure 3B</xref>, <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1B</xref>), validating that within each inferred cluster, the cells have the same identity within the resolution of our data.<fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.011</object-id><label>Figure 3.</label><caption><title>Cells transition from one discrete state to another during differentiation.</title><p>(<bold>A</bold>) Computationally inferred cell clusters and sequence of transitions are shown in the appropriate subspace of gene expression. Each dot represents a single cell, and cells are colored based on their cluster identity. For a linear transition sequence of cell states (such as from C<sub>0</sub> to C<sub>1</sub>), the transitions are represented in a two dimensional plot with the axes defined by the normalized mean log of the unique reads of genes that are most differentially regulated in the two states, while for lineage bifurcations between alternative daughter cell states, the plots are shown in three dimensions, where the x and y axes are normalized mean log unique reads of the associated set of transition genes, and the z axes are the normalized mean log unique reads of the marker genes associated with the inferred progenitor state. Labeled in parenthesis next to each cluster are the abbreviated names of the putative corresponding cell types found in vivo (Epi: epiblast; bi_Ec: bi-potent ectoderm; ME: mesendoderm; NE: neural ectoderm; NC: neural crest; M: mesoderm; DE: definitive endoderm). (<bold>B</bold>) Top: Plot of the variances of the first ten principal components of the gene expression of cells in cluster C<sub>0</sub>. The red line is the maximum principal component variance over 1000 randomizations of the data, showing that no principal component is statistically significant. Bottom: variances of the first principal component of each cluster, normalized by the maximum principal component variance of the randomized gene expression data for the corresponding cluster. (<bold>C</bold>) A list of high probability genes that belong to the various marker and transition gene classes that define the axes of the plots in <xref ref-type="fig" rid="fig3">Figure 3A</xref>, each represented by one gene in curly brackets. The curly brackets contain the gene name with the highest probability for that class, and other high probability genes (as in <xref ref-type="fig" rid="fig2">Figure 2A and B</xref>) are listed in the table. While some of the genes are used only once, others such as <italic>Otx2</italic> and <italic>Oct4</italic> are repeatedly reused in different subspaces to describe the transition. (<bold>D</bold>) Flow cytometry analysis of cell populations sampled every 24 hr during differentiation and immunostained for nine genes (two shown at a time for each density contour plot): Klf4, Otx2, Oct4, Sox2, Slug, Pax6, FoxA2, Gata4 (each taken from a different gene class shown in <xref ref-type="fig" rid="fig3">Figure 3C</xref>), and T recapitulate the predicted structure and temporal ordering of transitions through discrete cell states. Axes represent the log of gene expression, normalized by the range between the minimum and maximum across each gene. Plots in pink and green represent C<sub>2</sub> and C<sub>3</sub> lineages following the split from C<sub>1</sub>, respectively. (<bold>E</bold>) Live cell microscopy of <italic>Otx2</italic> reporter (mCitrine) cell line to infer the dynamics of cell state transition from C<sub>0</sub> to C<sub>1</sub>. Sample images (shown) at t = 0, 6, 12, 18, and 24 hr of differentiation. Cells were terminated at approximately 25 hr into differentiation and immunostained for Nanog (ES marker gene, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>), which shows an anti-correlation between Otx2 and Nanog expression levels. (Scale bar = 100 μm) (<bold>F</bold>) Top: Time series (x-axis) traces of single-cell Otx2 (y-axis) expression dynamics taken every 15 min show that the duration of transition from Otx2-low (C<sub>0</sub>) to Otx2-high (C<sub>1</sub>) is approximately 4 hr, which is well within the time frame of one cell cycle (~10 hr). The end-point (t = 25 hr) Otx2 levels show a clear separation between high and low (histogram of ~200 cells shown to the right in gray), indicating that some cells have made the transition from C<sub>0</sub> to C<sub>1</sub> while others not. Each trace is colored by its relative end-point Nanog immunofluorescence intensity level. Otx2 levels are normalized by the mean level at t = 0. Bottom: Histogram (y-axis = log (cell count)) of residence durations of ~400 cells in the Otx2-low C<sub>0</sub> state, showing that transition times vary across multiple cell cycle lengths (time lapse length = 48 hr). Inset bar shows mean as well as upper (white) and lower quartiles of the transition durations of cells.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.011">http://dx.doi.org/10.7554/eLife.20487.011</ext-link></p><p><supplementary-material id="SD4-data"><object-id pub-id-type="doi">10.7554/eLife.20487.012</object-id><label>Figure 3—source data 1.</label><caption><title>Probabilities of membership in marker and transition gene classes in final tree.</title><p>Listed are, for direct triplets along the lineage tree, the genes with the highest probabilities of belonging to transition gene and marker gene classes, and their associated probabilities. Genes belonging to the classes shown in curly brackets in <xref ref-type="fig" rid="fig3">Figure 3C</xref> (probability greater than 0.5%) are shown.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.012">http://dx.doi.org/10.7554/eLife.20487.012</ext-link></p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-20487-fig3-data1-v2.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig3-v2"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.013</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Validation of inferred cell types and lineage relationships.</title><p>(<bold>A</bold>) Comparison of clustering configuration (left column) and culture conditions (right column) shows that there is mixing of cells from different culture conditions to the same cluster as well as cells from the same culture conditions being assigned to different clusters. (<bold>B</bold>) Mean and coefficient of variation (c.v.) of percent variance explained by the largest eigenvalues of each cell cluster normalized by the percent variance explained by that of randomly shuffled gene expression data (y-axis) for each cell cluster (x-axis). The last point along the x-axis shows the mean and c.v. of percent variance explained by the largest eigenvalues of each cell cluster normalized by the percent variance explained by that of randomly shuffled data, for all merged pairs of cell clusters, which is significantly higher than that derived from single clusters (maximum <italic>p</italic> value <inline-formula><mml:math id="inf54"><mml:mrow><mml:mn>0.2675</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>12</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. (<bold>C</bold>) A scatter plot of Etv5 (x-axis) and FoxA2 (y-axis) expression from immunofluorescence data (each dot is a mesendodermal cell, as identified by T expression; data not shown) shows that from day 3 to day 4 of mesendodermal differentiation (Materials and methods), Etv5 expression decreases and some cells go on to upregulate FoxA2. (<bold>D</bold>) Histogram of Nanog expression (as measured by immunostaining and flow cytometry) before differentiation (yellow; Lif2i C<sub>0</sub> state) and after two days of differentiation (orange; D2 PD03 C<sub>1</sub> state) shows that Nanog expression is downregulated throughout most of the population during the first two days, similar to the observed changes of Klf4 during this time (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). We thus use Nanog immunostaining, which produces a better signal compared to Klf4 antibodies, to identify cells that are still remaining in the naïve pluripotent C<sub>0</sub> state.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.013">http://dx.doi.org/10.7554/eLife.20487.013</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig3-figsupp1-v2"/></fig></fig-group></p><p>The inferred dynamics of differentiation can therefore be visualized in a low-dimensional subspace of gene expression, showing that differentiation occurs through a sequence of discrete cell state transitions.</p></sec><sec id="s2-3"><title>Correspondence of cell states discovered ab initio from single-cell data to known in vivo cell types</title><p>Inspection of the genes that make up the local transition and marker gene classes (<xref ref-type="fig" rid="fig3">Figure 3C</xref>; <xref ref-type="supplementary-material" rid="SD4-data">Figure 3—source data 1</xref>) allowed us to match clusters to embryonic cell types found in vivo that show similar gene expression.</p><p>Cluster C<sub>0</sub> is characterized by the high expression of pluripotency genes <italic>Oct4</italic>, <italic>Sox2</italic>, <italic>Sall1</italic>, <italic>Etv5</italic>, <italic>Jarid2</italic>, <italic>Esrrb</italic>, <italic>Klf4</italic> and <italic>Klf5</italic>, whereas cluster C<sub>1</sub> has lower <italic>Jarid2</italic>, <italic>Esrrb</italic>, <italic>Klf4</italic> and <italic>Klf5</italic>, and higher <italic>Otx2</italic>, <italic>Bptf</italic>, <italic>Cbx1</italic> and <italic>Dnmt3a</italic>/<italic>b</italic> expression compared to cluster C<sub>0</sub>, suggesting that clusters C<sub>0</sub> and C<sub>1</sub> correspond to naïve ES and primed epiblast pluripotent cell types, respectively (<xref ref-type="bibr" rid="bib3">Borgel et al., 2010</xref>; <xref ref-type="bibr" rid="bib18">Goller et al., 2008</xref>; <xref ref-type="bibr" rid="bib27">Kim et al., 2001</xref>; <xref ref-type="bibr" rid="bib42">Nichols and Smith, 2009</xref>; <xref ref-type="bibr" rid="bib58">Tesar et al., 2007</xref>; <xref ref-type="bibr" rid="bib69">Zhou et al., 2007</xref>).</p><p>Clusters C<sub>2</sub> and C<sub>3</sub>, which branch out from C<sub>1</sub>, show differential expression of pluripotency genes relative to C<sub>1</sub>; <italic>Bptf</italic> and <italic>Cbx1</italic> are downregulated in both C<sub>2</sub> and C<sub>3</sub>, <italic>Oct4</italic>, <italic>Etv5</italic> and <italic>Dnmt3a</italic> are downregulated in cluster C<sub>3</sub> but maintained in C<sub>2</sub>, and <italic>Sox2</italic>, <italic>Otx2</italic> and <italic>Dnmt3b</italic> are downregulated in cluster C<sub>2</sub> but maintained in cluster C<sub>3</sub>. Cluster C<sub>2</sub> is further characterized by a high expression level of primitive streak markers <italic>Mixl1</italic> and <italic>T</italic> (<xref ref-type="bibr" rid="bib19">Hart et al., 2002</xref>; <xref ref-type="bibr" rid="bib56">Tada et al., 2005</xref>), whereas cluster C<sub>3</sub> is characterized by <italic>Sez6</italic>, <italic>Stmn3</italic> and <italic>Stmn4</italic>, which have recently been shown to characterize the previously elusive mammalian bi-potent ectoderm progenitor population (<xref ref-type="bibr" rid="bib34">Li et al., 2015</xref>). Together, these patterns strongly suggest that clusters C<sub>2</sub> and C<sub>3</sub> represent mesendoderm and bi-potent ectoderm progenitor cell types, respectively.</p><p>The bi-potent ectoderm progenitor-like cluster C<sub>3</sub> is then followed by a lineage split into clusters C<sub>5</sub> and C<sub>6</sub>. While <italic>Stmn4</italic> is downregulated in both C<sub>5</sub> and C<sub>6</sub> compared to C<sub>3</sub>, <italic>Sez6</italic> is downregulated in only C<sub>5</sub>, and <italic>Stmn3</italic> as well as neural progenitor marker Pax6 are downregulated in C<sub>6</sub> but maintained in C<sub>5</sub>. Cluster C<sub>5</sub> is further characterized by <italic>Smarce1</italic> and <italic>Zic2</italic>, and cluster C<sub>6</sub> by <italic>Slug</italic> and <italic>Msx2</italic>, suggesting that C<sub>5</sub> and C<sub>6</sub> may be related to neural progenitor and neural crest cells, respectively (<xref ref-type="bibr" rid="bib4">Brown and Brown, 2009</xref>; <xref ref-type="bibr" rid="bib31">Nicole and Chaya, 1991</xref>; <xref ref-type="bibr" rid="bib63">Vogel-Ciernia and Wood, 2014</xref>).</p><p>Cluster C<sub>4</sub>, although similar in its expression level of <italic>Mixl1</italic> and <italic>T</italic> to cluster C<sub>2</sub>, shows higher expression of other primitive streak genes such as <italic>FoxA2</italic> and <italic>Tcf3</italic> (<xref ref-type="bibr" rid="bib40">Merrill et al., 2004</xref>) and lower expression of <italic>Etv5</italic>. Cluster C<sub>4</sub> is then followed by a bifurcation between clusters C<sub>7</sub> and C<sub>8</sub>. Cluster C<sub>7</sub> shows high expression levels of <italic>Gata4</italic> and <italic>Snai1</italic>, indicative of its relation to mesoderm, and cluster C<sub>8</sub> is characterized by high <italic>FoxA2</italic> compared to clusters C<sub>4</sub> and C<sub>8</sub>, suggestive of its relation to definitive endoderm (<xref ref-type="bibr" rid="bib28">Kim and Ong, 2012</xref>; <xref ref-type="bibr" rid="bib48">Rojas et al., 2005</xref>). We predict that cluster C<sub>4</sub> represents a primed bi-potent mesendoderm cell type relative to cluster C<sub>2</sub> (<xref ref-type="bibr" rid="bib41">Nakanishi et al., 2009</xref>).</p><p>Together, these results suggest that the cell clusters and sets of transitions computationally inferred from single-cell transcriptomics data correspond to known in vivo cell types and their lineage relationships.</p></sec><sec id="s2-4"><title>Differentiation occurs through a series of discrete cell state transitions</title><p>The fact that gene expression in each cell cluster does not vary significantly – as measured by the relative sizes of the largest eigenvalues of the PC components of the gene expression data (or percent variance explained thereby) versus that of the same data randomly shuffled (<xref ref-type="fig" rid="fig3">Figure 3B</xref>; <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1B</xref>) – allows for genes to be sorted into a few gene classes that show highly correlated expression patterns across clusters (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). This suggests that one can validate the inferred sequence of cell state transitions and its gene expression dynamics by measuring the expression of one gene from each class in differentiating cells over time.</p><p>In order to confirm the gene expression dynamics over the inferred sequence of cell state transitions, we assessed populations of cells for their expression levels of key transition and marker genes (each taken from a different gene class) via immunostaining and flow cytometry. We sampled mES cell populations every 24 hr during differentiation and immunostained each for Klf4, Otx2, Oct4, Sox2, Pax6, Slug, FoxA2, Gata4 and T. (Although <italic>T</italic> is not assigned to a specific gene class, it is highly expressed in the mesendoderm-like states C<sub>2</sub> and C<sub>4</sub>, and it thus allows us to distinguish C<sub>2</sub> from the earlier epiblast-like state C<sub>1</sub>.) The flow cytometry density contour plots shown (<xref ref-type="fig" rid="fig3">Figure 3D</xref>) are characterized by high-density peaks which are separated from one another by regions of low density, mirroring the discreteness of the cell states inferred from single-cell transcriptomics data. The relative locations of these high-density peaks and the time at which they appear and disappear recapitulate the inferred gene expression dynamics of the cell state transitions of the lineage tree.</p><p>During the first two days of differentiation, all cell populations downregulated Klf4 and upregulated Otx2, as shown in the first row of density contour plots in <xref ref-type="fig" rid="fig3">Figure 3D</xref>. This is consistent with the first observed state transition in our inferred lineage tree from the naïve ES C<sub>0</sub> state to the primed epiblast-like state C<sub>1</sub>. On day three of differentiation (third column of plots in <xref ref-type="fig" rid="fig3">Figure 3D</xref>), Sox2 and Oct4 are asymmetrically downregulated relative to the preceding population, as is seen in mesendoderm-like state C<sub>2</sub> and bi-potent ectoderm-like state C<sub>3</sub> relative to the epiblast-like state C<sub>1</sub>. Sox2-high, Oct4-low cells on day three are either high for Pax6 or for Slug, consistent with comparisons between the neural ectoderm-like state C<sub>5</sub> and neural crest-like C<sub>6</sub>. On day four, the Pax6-high and Slug-high populations become proportionally larger as the Pax6/Slug-low population shrinks, supporting the inferred temporal ordering that C<sub>5</sub> and C<sub>6</sub> arise from the bi-potent ectoderm-like state C<sub>3</sub>. Oct4-high, Sox2-low cells on day three of differentiation are high for T, but show two discrete levels of FoxA2, mirroring the difference between the two mesendoderm-like states C<sub>2</sub> (FoxA2-low) and C<sub>4</sub> (FoxA2-high). Further, we found that Etv5, a gene whose expression dynamics had hitherto not been implicated with early mesendodermal differentiation in mammals, was significantly downregulated from C<sub>2</sub> to C<sub>4</sub>, as predicted from the single-cell gene expression data (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1C</xref>). Finally, at days four and five, we observe FoxA2-high, Gata4-low and FoxA2-low, Gata4-high cell populations, which correspond to the primed mesendoderm and definitive endoderm-like states C<sub>4</sub> and C<sub>8</sub> and the mesoderm-like state C<sub>7</sub>, respectively. We thus confirmed that differentiating cell populations recapitulate the gene expression dynamics of cell state transitions inferred from single-cell data (<xref ref-type="fig" rid="fig3">Figure 3A</xref>).</p><p>The observation that the majority of randomly sampled cells are found to belong to one of nine discrete cell states (both transcriptionally and at the protein level) suggests that cell state transitions occur within a relatively short timeframe compared to the amount of time cells spend within each state. We tested this hypothesis on the first cell state transition from the naïve ES C<sub>0</sub> state to the primed epiblast-like state C<sub>1</sub> (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). To do so, we generated an <italic>Otx2</italic>-mCitrine fusion protein reporter mES cell line (Materials and methods) and observed the single-cell-resolution dynamics of <italic>Otx2</italic> expression for up to two days (<xref ref-type="fig" rid="fig3">Figure 3E and F</xref>).</p><p>In agreement with our hypothesis, we observed that Otx2 levels, at the end of 24 hr of differentiation, show a bimodal distribution (<xref ref-type="fig" rid="fig3">Figure 3F</xref>, top), and cells tend to occupy either an Otx2-low state (corresponding to ES state C<sub>0</sub>) or an Otx2-high state (corresponding to epiblast-like state C<sub>1</sub>). We find that cells transition from an Otx2-low to an Otx2-high state well within the duration of a single cell cycle (mean transition duration of 4.52 hr compared to the cell-cycle length of approximately 10 hr). In contrast, cells tend to stay in either Otx2-low or -high states for up to multiple cell cycles, with a large amount of cell-to-cell variability in the residence duration (<xref ref-type="fig" rid="fig3">Figure 3F</xref>, bottom). Together with our results from the analysis of single-cell transcriptomics data, these observations show that cells reside in discrete states in gene expression space and correspondingly undergo abrupt state transitions.</p></sec><sec id="s2-5"><title>A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations</title><p>Our analysis of single-cell gene expression data suggested a lineage tree composed of discrete cell states, and identified genes associated with individual cell states and transitions between them. While we predict the existence of discrete cell states based on their gene expression pattern, finding unique physiological properties that can define and distinguish their existence functionally would lend even greater support to this prediction. We therefore next sought to find properties of cell states that distinguished them functionally from one another. In order to do so, we built a predictive and testable quantitative model of the underlying gene regulatory network based on the expression patterns of the marker and transition genes.</p><p>From the 889 genes that were categorized as either marker or transition genes for all the high probability triplets, we first chose genes involved only in the triplets that fall directly along the inferred lineage tree. That is, we removed genes that were categorized as transition or marker genes for triplets consisting of ‘indirect’ lineage relationships, where at least one cell state is skipped between two cell states connected through the lineage tree. For instance, we did not consider the genes categorized as marker or transition genes only in the triplet C<sub>0,</sub> C<sub>1</sub> and C<sub>5</sub>, because C<sub>3</sub> is skipped between C<sub>1</sub> and C<sub>5</sub>.</p><p>Since some transition genes inferred from our Bayesian analysis are re-used to infer multiple local state transitions (<xref ref-type="fig" rid="fig3">Figure 3C</xref> ,e.g., <italic>Oct4</italic>, <italic>Otx2</italic>), we classified transcription factors based on their distinct binarized patterns of expression across all nine cell states, with genes showing the same patterns belonging to the same gene module (Materials and methods, <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1A</xref>, <xref ref-type="supplementary-material" rid="SD5-data">Figure 4—source data 1</xref>). Hence, we categorized the 321 marker and transition genes involving ‘direct’ triplets along the tree into 26 gene modules, each of which showed distinct patterns of expression across the cell states. Further, because our goal was to test whether different cell states were functionally distinct (i.e., respond differently to the same signals and gene expression changes), we also noted the expression pattern of signaling factor genes belonging to FGF, WNT, LIF and BMP signaling pathways along the lineage tree (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). These signaling factor genes constituting each of these modules were selected based on GO categories, leading to a total of 29 gene modules (Materials and methods). We denote each gene module by a representative gene in square brackets; for example, the gene module that uniquely characterizes the ES state C<sub>0</sub> is denoted as [<italic>Klf4</italic>] (<xref ref-type="supplementary-material" rid="SD5-data">Figure 4—source data 1</xref> and <xref ref-type="supplementary-material" rid="SD6-data">2</xref>).</p><p>Owing to the large number of gene modules, and consequently even larger number of potential interactions between these modules, even the simplest mathematical model would consist of hundreds of parameters. However, for most of these parameters, direct experimental measurements are not available. In order to overcome this challenge, we exploited recent developments based on renormalization group approaches to determine which parameters are relevant for the observed data (<xref ref-type="bibr" rid="bib37">Machta et al., 2013</xref>). We adapted the seminal model of artificial neural networks, known as the Hopfield model (<xref ref-type="bibr" rid="bib10">Fard et al., 2016</xref>; <xref ref-type="bibr" rid="bib21">Hopfield, 1984</xref>; <xref ref-type="bibr" rid="bib39">Maetschke and Ragan, 2014</xref>), to construct an effective gene regulatory network between the 29 gene modules. By construction, we required that this mathematical model produces the nine cell states seen in <xref ref-type="fig" rid="fig3">Figure 3A</xref>. We considered a network that contains direct interactions, in which each module <italic>j</italic> exerts a drive on module <italic>i</italic>, which is equal to an interaction strength <inline-formula><mml:math id="inf55"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (positive or negative) multiplied by the concentration of module <italic>j</italic>. The total drive on module <italic>i</italic> is the sum of the drives from the different modules. Given our observation of discrete cell states, we further considered that the total drive on module <italic>i</italic> affects expression in a highly non-linear manner, with high gene expression for drives that exceed a critical drive <inline-formula><mml:math id="inf56"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and low gene expression otherwise (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1B</xref>). For simplicity, we assumed that the expression of every gene module exhibits a non-linear, step-function response, when subjected to the same drive; thereby reducing the number of parameters of the model. Indeed there are numerous genes that manifest sigmoidal-like response in expression, in the presence of internal and external stimuli (<xref ref-type="bibr" rid="bib32">Lebrecht et al., 2005</xref>; <xref ref-type="bibr" rid="bib52">Segal and Widom, 2009</xref>). Thus the effective dynamics of expression levels <inline-formula><mml:math id="inf57"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> of each module <inline-formula><mml:math id="inf58"><mml:mi>i</mml:mi></mml:math></inline-formula> are given by the non-linear equation:<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf59"><mml:mi>H</mml:mi></mml:math></inline-formula> is the Heaviside step function and <inline-formula><mml:math id="inf60"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the effective lifetime of module <inline-formula><mml:math id="inf61"><mml:mi>i</mml:mi></mml:math></inline-formula> (Materials and methods).</p><p>We determined the set of interactions <inline-formula><mml:math id="inf62"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> that are consistent with the observed cell states (C<sub>0</sub>-C<sub>8</sub>, <xref ref-type="fig" rid="fig3">Figure 3A</xref>) being stable fixed points of the network. If state <inline-formula><mml:math id="inf63"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mn>1</mml:mn><mml:mi>α</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mn>29</mml:mn></mml:mrow><mml:mi>α</mml:mi></mml:msubsup><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> with expression level <inline-formula><mml:math id="inf64"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> in module <inline-formula><mml:math id="inf65"><mml:mi>i</mml:mi></mml:math></inline-formula> is a stable fixed point of the network, then the interactions <inline-formula><mml:math id="inf66"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> must be such that the total drive on each module that is expressed in <inline-formula><mml:math id="inf67"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is greater than the critical drive, and the total drive on each module that is not expressed in <inline-formula><mml:math id="inf68"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is less than the critical drive:<disp-formula id="equ2"><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mtext> </mml:mtext><mml:mo stretchy="false">⇒</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msubsup><mml:mo>≥</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mo stretchy="false">⇒</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msubsup><mml:mo>&lt;</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Thus, for each stable state, we have 29 constraints on the possible values of <inline-formula><mml:math id="inf69"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, one for each module. Given that we have nine cell states, there are 29*9 = 261 inequalities that constrain the values of the 29<sup>2</sup> = 841 different parameters, <inline-formula><mml:math id="inf70"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The problem is therefore underdetermined even for our simplified model of the underlying network, and there are an infinite number of solutions that would allow for the observed cell states to be stable.</p><p>By using a linear programming method to obtain an ensemble of 10,000 sets of <inline-formula><mml:math id="inf71"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> interactions (Materials and methods), each satisfying the constraint that all nine cell states are stable fixed points, we estimated the probability distribution for the 841 parameters of the model (<xref ref-type="fig" rid="fig4">Figure 4A</xref> and <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>), giving us a probabilistic model of the underlying network. We further assumed that all the possible 10,000 sets of <inline-formula><mml:math id="inf72"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> interactions that reproduced the nine stable cell states were equally likely, since we did not have any experimental evidence to distinguish between them.<fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.014</object-id><label>Figure 4.</label><caption><title>Quantitative modeling of the network underlying germ layer differentiation.</title><p>(<bold>A</bold>) The inferred gene regulatory network from 10,000 sampled solutions that stabilize each of the nine cell states. Each circle represents a gene module. Mean positive and negative interactions between the modules are shown in red and green, respectively, and their thickness and transparency are proportional to the absolute magnitude of the mean and the coefficient of variation (c.v.), respectively. The colored circles represent the gene modules expressed uniquely in only one of the cell states (color code matched with <xref ref-type="fig" rid="fig3">Figure 3A</xref> for each state). (<bold>B</bold>, <bold>C</bold>) Subsets of the network consisting of gene modules that are expressed in (and stabilize) the naïve ES C<sub>0</sub> state (<bold>B</bold>) and epiblast-like C<sub>1</sub> (<bold>C</bold>) state. As cells transition from C<sub>0</sub> to C<sub>1</sub>, expression of [<italic>Klf4</italic>], [<italic>Apex1</italic>], [<italic>Ets2</italic>], [<italic>Atf2</italic>] modules is downregulated (shown in gray) while [<italic>Hes6</italic>] and [<italic>Otx2</italic>] modules are upregulated, leading to changes in the effective interactions between gene modules that are common to both C<sub>0</sub> and C<sub>1</sub> states, such as [<italic>Sox2</italic>] and [<italic>Oct4</italic>]. (<bold>D</bold>) [<italic>Sox2</italic>] overexpression (x-axis) plotted against the probability of [<italic>Oct4</italic>] downregulation (y-axis) computed over 10,000 models (Materials and methods). In the C<sub>1</sub> state (solid line), [<italic>Oct4</italic>] is downregulated in an increasing fraction of models following [<italic>Sox2</italic>] overexpression, while in C<sub>0</sub>, [<italic>Oct4</italic>] is stable in ~96% of the models (dotted line). In order to obtain the error bars for this and subsequent predictions, we randomly sampled three subsets of 3333 from the 10,000 models. For each set we computed the mean and standard error of the proportion of models that show downregulation of <italic>Oct4</italic> in response to <italic>Sox2</italic> overexpression. (<bold>E, F</bold>) Subsets of the model consisting of gene modules that are expressed in the epiblast-like C<sub>1</sub> (<bold>E</bold>) and mesendoderm-like C<sub>2</sub> (<bold>F</bold>) states, and their interactions with [<italic>Snai1</italic>], which is not normally expressed in C<sub>1</sub> or C<sub>2</sub>. As cells transition from the C<sub>1</sub> to C<sub>2</sub> state, [<italic>Hes6</italic>], [<italic>Sox2</italic>], [<italic>Otx2</italic>], [<italic>Churc1</italic>] are downregulated (shown in gray), while [<italic>Hmga1</italic>], [<italic>T</italic>], [<italic>Atf2</italic>], [<italic>Hes1</italic>], [<italic>Ets2</italic>], [<italic>Apex1</italic>], [<italic>Brd7</italic>], [<italic>Hmgn2</italic>] and [<italic>Smarce1</italic>] are upregulated, leading to changes in the effective interactions between [<italic>Snai1</italic>] and modules that are common to both C<sub>1</sub> and C<sub>2</sub>, such as [<italic>Oct4</italic>]. (<bold>G</bold>) The probability of [<italic>Oct4</italic>] being downregulated (y-axis) as a function of [<italic>Snai1</italic>] overexpression (x-axis). In the C<sub>1</sub> state (solid line), the over expression of [<italic>Snai1</italic>] has no effect on [<italic>Oct4</italic>] levels in ~94.5% of the 10,000 models whereas in the C<sub>2</sub> state (dotted line), the overexpression of [<italic>Snai1</italic>] leads to [<italic>Oct4</italic>] downregulation in up to 19% of the models. (<bold>H</bold>) The C<sub>3</sub> state shows a downregulation of [<italic>Oct4</italic>] and [BMP], and upregulation of [<italic>Tead1</italic>], [<italic>Apex1</italic>], [<italic>Pax6</italic>], [<italic>Smarce1</italic>], [<italic>Ets2</italic>], [<italic>Atf2</italic>], [<italic>Hes1</italic>], [<italic>Fhl1</italic>], [Hmgn2] modules relative to C<sub>1</sub>. (<bold>I</bold>) Cells in different states are predicted to respond differently to morphogens. Plot showing the percentage of models (y-axis) where states C<sub>1</sub> and C<sub>3</sub> (x-axis) transition to C<sub>6</sub> (characterized by unique marker gene module [<italic>Msx2</italic>]), in response to [LIF]+[BMP]. C<sub>1</sub> cells remain stable in response to [LIF]+[BMP] signaling in &gt;98% of the models whereas C<sub>3</sub> cells are destabilized and move to the C<sub>6</sub> state in ~11% of the models.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.014">http://dx.doi.org/10.7554/eLife.20487.014</ext-link></p><p><supplementary-material id="SD5-data"><object-id pub-id-type="doi">10.7554/eLife.20487.015</object-id><label>Figure 4—source data 1.</label><caption><title>Gene modules used for modeling the network.</title><p>* The [BMP] and [Aes] modules have the same binary pattern. ** The [FGF] and [WNT] modules have the same binary pattern.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.015">http://dx.doi.org/10.7554/eLife.20487.015</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-20487-fig4-data1-v2.docx"/></supplementary-material></p><p><supplementary-material id="SD6-data"><object-id pub-id-type="doi">10.7554/eLife.20487.016</object-id><label>Figure 4—source data 2.</label><caption><title>Binary expression profiles of the gene modules used for modeling the network in the 9 cell clusters.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.016">http://dx.doi.org/10.7554/eLife.20487.016</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-20487-fig4-data2-v2.docx"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig4-v2"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.017</object-id><label>Figure 4—figure supplement 1.</label><caption><title>Summary of gene modules and illustration of production rate determination for each gene module.</title><p>(<bold>A</bold>) River diagram of the gene expression patterns of the 29 modules in the 9 cell clusters. Straight lines indicate asymmetric regulation favoring the colored branch; dots indicate symmetric downregulation in the subsequent two branches. (<bold>B</bold>) Plot of the production rate of module <inline-formula><mml:math id="inf73"><mml:mi>i</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf74"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, as a function of the drive from the other modules <inline-formula><mml:math id="inf75"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>m</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msubsup><mml:mtext> </mml:mtext><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. The production rate is equal to 1 if the drive is greater than a critical drive <inline-formula><mml:math id="inf76"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and 0 otherwise.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.017">http://dx.doi.org/10.7554/eLife.20487.017</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig4-figsupp1-v2"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.018</object-id><label>Figure 4—figure supplement 2.</label><caption><title>Summary of parameters for model gene regulatory network.</title><p>(<bold>A</bold>, <bold>B</bold>) Heat maps showing the absolute mean (<bold>A</bold>) and coefficient of variation (c.v.) (<bold>B</bold>), of the 841 parameters of the inferred gene regulatory network from 10,000 sampled solutions that stabilize each of the nine cell states. The (i,j)- th element of the each of the matrices shows the mean (<bold>A</bold>) and c.v (<bold>B</bold>) of the interaction strength <inline-formula><mml:math id="inf77"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, in which gene module <italic>j</italic> exerts a drive on gene module <italic>i</italic>.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.018">http://dx.doi.org/10.7554/eLife.20487.018</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig4-figsupp2-v2"/></fig><fig id="fig4s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.019</object-id><label>Figure 4—figure supplement 3.</label><caption><title>The predictions of the gene regulatory network are robust to changes in the probability threshold for considering a gene to be a transition or a marker gene.</title><p>For a probability threshold of 0.7 (<bold>A</bold>, <bold>B</bold>, <bold>C</bold>) and 0.9 (<bold>D</bold>, <bold>E</bold>, <bold>F</bold>), we obtain 27 and 24 different gene modules, respectively. (<bold>A</bold>, <bold>D</bold>) [<italic>Sox2</italic>] overexpression (x-axis) plotted against the proportion of models where [<italic>Oct4</italic>] remains high (i.e., binarized value equals 1) (y-axis) computed over 10,000 models. In the C<sub>1</sub> state (solid line), [<italic>Oct4</italic>] is downregulated in an increasing fraction of models following [<italic>Sox2</italic>] overexpression relative to when [<italic>Sox2</italic>] is overexpressed in the C<sub>0</sub> state (dotted line). (<bold>B</bold>, <bold>E</bold>) [<italic>Snai1</italic>] overexpression (x-axis) plotted against the proportion of models where [<italic>Oct4</italic>] is high (y-axis) computed over 10,000 models. [<italic>Oct4</italic>] is downregulated in an increasing fraction of models following [<italic>Snai1</italic>] overexpression in the C<sub>2</sub> state (dotted line) relative to when [<italic>Snai1</italic>] is overexpressed in the C<sub>1</sub> state (solid line). (<bold>C</bold>, <bold>F</bold>) C<sub>1</sub> cells remain more stable in response to [LIF]+[BMP] signaling relative to C<sub>3</sub> cells, which move to the C<sub>6</sub> state in a significantly higher fraction of the models.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.019">http://dx.doi.org/10.7554/eLife.20487.019</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig4-figsupp3-v2"/></fig></fig-group></p><p>We used this probabilistic model to make testable predictions as to how different cell states respond to perturbations: to see if different cell states are defined not only by their distinct transcriptional profiles, but also functionally distinct in their phenotypic responses to the same perturbations. There are a vast number of testable predictions that one could extract from our gene regulatory network model. However, given the low throughput nature of perturbation experiments, we selected three distinct probabilistic predictions, each probing different aspects of the model gene regulatory network.</p><p>First, we considered changes in the effective interaction between two gene modules as a function of cell state (i.e., how the expression level changes of one gene module affect the expression of another gene module differs across cell states due to the difference sets of gene modules present in each state). To this end, we looked at two classes of gene module pairs: (i) gene modules that are co-expressed in two mother-daughter cell states and (ii) gene modules that are never co-expressed in any cell state.</p><p>Gene modules [<italic>Sox2</italic>] and [<italic>Oct4</italic>] are highly expressed in both the ES cluster C<sub>0</sub> and the epiblast-like C<sub>1</sub> cluster, after which they are asymmetrically downregulated in the mesendoderm-like C<sub>2</sub> and ectoderm-like C<sub>3.</sub> We find that for 67.5% of the 10,000 sampled solutions, [<italic>Sox2</italic>] and [<italic>Oct4</italic>] have mutually inhibitory interactions (i.e., negative coupling constants). Although both [<italic>Sox2</italic>] and [<italic>Oct4</italic>] are present together in the C<sub>0</sub> and C<sub>1</sub> states, their effective interactions are altered in different ways in each cell state by the presence of other gene modules. As cells transition from state C<sub>0</sub> to C<sub>1</sub>, they downregulate gene modules [<italic>Klf4</italic>], [<italic>Atf2</italic>], [<italic>Apex1</italic>] and [<italic>Ets2</italic>], and upregulate [<italic>Hes6</italic>] and [<italic>Otx2</italic>], among others (<xref ref-type="fig" rid="fig4">Figure 4B and C</xref>), leading to changes in the effective interaction strength between [<italic>Sox2</italic>] and [<italic>Oct4</italic>]. By incrementally increasing [<italic>Sox2</italic>] levels relative to its base value and assessing the fraction of models that show [<italic>Oct4</italic>] downregulation, we found that [<italic>Oct4</italic>] levels are predicted to be more stable to [<italic>Sox2</italic>] overexpression in state C<sub>0</sub> than in C<sub>1</sub> (<xref ref-type="fig" rid="fig4">Figure 4D</xref>), thus distinguishing C<sub>0</sub> and C<sub>1</sub> functionally (<xref ref-type="bibr" rid="bib17">Geula et al., 2015</xref>).</p><p>On the other hand, [<italic>Snai1</italic>] and [<italic>Oct4</italic>] are not expressed together in any of the nine cell states. We investigated the predicted effects of [<italic>Snai1</italic>] overexpression on [<italic>Oct4</italic>] in the epiblast-like state C<sub>1</sub> and mesendoderm-like state C<sub>2</sub>, both of which normally express [<italic>Oct4</italic>] but not [<italic>Snai1</italic>]. Although [<italic>Snai1</italic>] has a negative interaction with [<italic>Oct4</italic>] in 79.2% of the models, the modules expressed in C<sub>1</sub> exert a greater positive drive on [<italic>Oct4</italic>] (<xref ref-type="fig" rid="fig4">Figure 4E and F</xref>) than those expressed in C<sub>2</sub>. This leads to the prediction that [<italic>Oct4</italic>] is less sensitive to [<italic>Snai1</italic>] overexpression in state C<sub>1</sub> compared to C<sub>2</sub> (<xref ref-type="fig" rid="fig4">Figure 4G</xref>).</p><p>We next considered the effect of morphogen signals in different states. Specifically, we considered the LIF, BMP, WNT and FGF signaling pathways, which are known to play a significant role in patterning the early embryo, as well as are central to our in vitro differentiation process (Materials and methods). We grouped signaling genes by their respective pathways (defined by GO categories) and assigned each group to a module based on its average expression pattern across the nine cell states. Because WNT and FGF modules show no changes in expression across all cell states (most likely due to the large number of genes that fall into the relevant GO categories), we focused on investigating the effects of LIF and BMP signaling on cells in the epiblast-like C<sub>1</sub> and in the bi-potent ectoderm-like state C<sub>3</sub> (<xref ref-type="fig" rid="fig4">Figure 4H</xref>). Given an initial state C<sub>1</sub> or C<sub>3</sub>, we calculated the probabilities that cells either remain in the same state or move to a different state in response to [LIF] and [BMP] (Materials and methods). Our simulations found that for ~98% of the models, cells that are initially in state C<sub>1</sub> either remained stabilized in C<sub>1</sub> or moved to state C<sub>0</sub> in response to [LIF] and [BMP] addition. However, in response to the same perturbation, the vast majority of cells in the C<sub>3</sub> state either transitioned to the neural crest-like state C<sub>6</sub>(11.2%) or stayed in the C3 state (86.1%) (<xref ref-type="fig" rid="fig4">Figure 4I</xref>).</p><p>To summarize, we predict that [<italic>Oct4</italic>] expression is less sensitive to [<italic>Sox2</italic>] overexpression in state C<sub>0</sub> than in C<sub>1</sub>; [<italic>Oct4</italic>] expression is less sensitive to [<italic>Snai1</italic>] overexpression in state C<sub>1</sub> compared to C<sub>2</sub>; and cells in state C<sub>3</sub>, but not in C<sub>1</sub>, can transition to state C<sub>6</sub> following [LIF]+[BMP] exposure.</p><p>Importantly, we further noted that the model predictions were robust to changes in the probability cutoff for the genes we considered: although the number of gene modules changed (27 modules for a cut off of 0.7 and 24 for 0.9), we found that the models made the same qualitative predictions (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>).</p><p>Thus, by categorizing genes into different modules by their expression patterns across the observed cell states, these modules provide a starting point for modeling the gene regulatory network responsible for cell fate decisions, allowing us to make predictions for how the network gives rise to distinct phenotypic responses to the same perturbation across different cell states.</p></sec><sec id="s2-6"><title>Interpretation of <italic>Sox2</italic>, <italic>Snai1</italic>, and LIF+BMP are cell state dependent</title><p>We next experimentally tested the qualitative aspects of the model’s predictions of state-dependence in cells’ responses to perturbations. We first tested how cells’ Oct4 levels respond to <italic>Sox2</italic> overexpression in the naïve ES and epiblast-like states C<sub>0</sub> and C<sub>1</sub>. We transiently transfected cells with a plasmid containing a Tet-inducible bi-directional promoter, flanked by the open reading frames of <italic>Sox2</italic> and mCerulean, which we used as a fluorescent reporter of induction (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1A</xref>). We induced overexpression in cells either in the undifferentiated C<sub>0</sub> state or the epiblast-like C<sub>1</sub> state, which correspond to Day 0 and Day 2 of differentiation, respectively (<xref ref-type="fig" rid="fig3">Figure 3D</xref>, <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1D</xref>). As a control, we used identical populations that were transfected with a plasmid containing only mCerulean under the inducible promoter. In such experiments, we typically saw mCerulean fluorescence appear approximately three hours into induction and persist for about three to four days after transfection. We therefore induced overexpression for 24 hr to minimize the effect of plasmid loss but still allow for several cell cycles to occur during induction. Following induction, we fixed and immunostained the cells for Oct4, and analyzed the results via flow cytometry. In agreement with our predictions (<xref ref-type="fig" rid="fig4">Figure 4D</xref>), we found that <italic>Sox2</italic> overexpression correlates (<inline-formula><mml:math id="inf78"><mml:mrow><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>0.3258</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1.48</mml:mn><mml:mo> </mml:mo><mml:mo>×</mml:mo><mml:mo> </mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>13</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>) with downregulation of Oct4 in the epiblast-like state C<sub>1</sub> (significant relative to control, <inline-formula><mml:math id="inf79"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>5.72</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>31</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>; see also <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1C</xref>), whereas this effect was not observed in undifferentiated cells (state C<sub>0</sub>) (<xref ref-type="fig" rid="fig5">Figure 5A and B</xref>).<fig-group><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.020</object-id><label>Figure 5.</label><caption><title>Experimental validation shows that interpretation of <italic>Sox2</italic>, <italic>Snai1</italic>, and LIF+BMP is cell state dependent.</title><p>(<bold>A</bold>) Comparison of the effects of <italic>Sox2</italic> overexpression (x-axis) on Oct4 levels (y-axis) in the naïve ES state C<sub>0</sub> (left) and epiblast-like C<sub>1</sub> state shows negative correlation between <italic>Sox2</italic> overexpression and Oct4 levels in the C<sub>1</sub> state, but not in C<sub>0</sub>. Plots showing mCerulean (marker) -only overexpression in C<sub>0</sub> or C<sub>1</sub> are indistinguishable from <italic>Sox2</italic> overexpression in C<sub>0</sub> (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1C</xref>). (<bold>B</bold>) Fraction of Oct4-high cells (y-axis; defined as greater than 2σ below the mean log of Oct4 of non-transfected control cells) plotted against binned <italic>Sox2</italic> overexpression level confirms model prediction (<xref ref-type="fig" rid="fig4">Figure 4D</xref>) that <italic>Sox2</italic> overexpression leads to downregulation of Oct4 in C<sub>1</sub> but not C<sub>0</sub>. (<bold>C</bold>) Comparison of the effects of <italic>Snai1</italic> and mCerulean-only (left) overexpression on Oct4 levels (x-axis) in the epiblast-like C<sub>1</sub> and mesendoderm-like C<sub>2</sub> states (y-axis; T-low and –high, respectively) shows downregulation of Oct4 in response to <italic>Snai1</italic> overexpression in the C<sub>1</sub> state but not in C<sub>2</sub>. (<bold>D</bold>) Fraction of Oct4-high cells in <italic>Snai1</italic> overexpressing cells, normalized by this fraction in mCerulean overexpressing control cells (y-axis), plotted against binned <italic>Snai1</italic> overexpression level (x-axis) confirms the prediction (<xref ref-type="fig" rid="fig4">Figure 4G</xref>) that <italic>Snai1</italic> overexpression leads to greater downregulation of Oct4 in C<sub>2</sub> compared to C<sub>1</sub>. (<bold>E</bold>) Live cell images of Oct4-mCitrine cells at t = 0, 6, 12, 18, 24 hr of LIF+BMP exposure. At t = 0, cells are either in state C<sub>1</sub> (Oct4-high) or C<sub>3</sub> (Oct4-low) (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1E</xref>). (Scale bar = 100 μm) Cells were fixed at t = 24 hr and immunostained for <italic>Msx2</italic>. (<bold>F</bold>) Time series (x-axis) traces of single-cell Oct4 expression (y-axis) taken every 15 min from live cells. Each trace is colored by its relative end-point <italic>Msx2</italic> immunofluorescence intensity level. (<bold>G</bold>) The initial Oct4 reporter (mCitrine) intensity (y-axis) and final Msx2 immunofluorescence (x-axis) are negatively correlated. Each dot represents a single cell. Histogram of Oct4 reporter intensity at t = 0 levels shown in gray. Based on this histogram, we defined a range of threshold values for determining Oct4-high and –low (shown in overlapping region of orange and green along y-axis). (<bold>H</bold>) Plot showing fraction of Msx2-high (y-axis; as defined by greater than 2σ above background) confirms prediction (<xref ref-type="fig" rid="fig4">Figure 4I</xref>) that Msx2 is upregulated with a greater probability in the C<sub>3</sub> state compared to C<sub>1</sub> (x-axis) in response to LIF+BMP exposure.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.020">http://dx.doi.org/10.7554/eLife.20487.020</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig5-v2"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.20487.021</object-id><label>Figure 5—figure supplement 1.</label><caption><title>Controls for perturbation experiments.</title><p>(<bold>A</bold>) mCerulean fluorescence level correlates with increasing total Sox2 levels, validating the use of mCerulean fluorescence as a measure for Sox2 overexpression. (Left) As a control, we show that Sox2 levels do not increase when only mCerulean is overexpressed. (<bold>B</bold>) Histogram of Otx2 expression (as measured by immunostaining and flow cytometry) following 24 hr of Sox2 overexpression in either naïve ES C<sub>0</sub> cells (Lif2i; yellow) or epiblast-like C<sub>1</sub> cells (D2 PD0; orange). In determining the effects of Sox2 overexpression in the epiblast-like C<sub>1</sub> state (<xref ref-type="fig" rid="fig5">Figure 5A</xref>), we excluded cells that showed Otx2 expression less than two standard deviations above the mean of Otx2 levels in Lif2i (threshold shown in dotted line). (<bold>C</bold>) Overexpression of only mCerulean does not show any effect on Oct4 levels in both C<sub>0</sub> (left; Lif2i) and C<sub>1</sub> (right; D2 PD0) cell states. (<bold>D</bold>) At day 3 of differentiation using CHIR99021 and Activin A (Materials and methods), populations consist of cells in C<sub>1</sub> (FoxA2-low, T-low) C<sub>2</sub> (FoxA2-low, T-high) and C<sub>4</sub> (FoxA2-high, T-high) states. The fraction of cells in C<sub>4</sub> is 17%. FoxA2 and T levels in undifferentiated C<sub>0</sub> state cells (Lif2i) are shown as a reference (left). (<bold>E</bold>) At day 2.5 of differentiation using PD0325901 (Materials and methods), populations consist of cells in C<sub>1</sub> (Oct4-high) and C<sub>3</sub> (Oct4-low) states. At this point cells have not yet upregulated Pax6 (left two panels) or Slug (right two panels), showing that cells have not yet transitioned to either state C<sub>5</sub> or C<sub>6</sub>.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.021">http://dx.doi.org/10.7554/eLife.20487.021</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-20487-fig5-figsupp1-v2"/></fig></fig-group></p><p>We then tested the effects of <italic>Snai1</italic> overexpression on Oct4 in the epiblast-like state C<sub>1</sub> and mesendoderm-like state C<sub>2</sub>, using the same experimental framework as described above. On day three of differentiation, cell populations either contain a mixture of C<sub>1</sub>, C<sub>2</sub> and (minimally) C<sub>4</sub> cell states, or a combination of C<sub>1</sub>, C<sub>3</sub> and C<sub>5</sub> (or C<sub>6</sub>), depending on the signaling conditions (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). Using the signaling conditions that yield the former set of cell states (C<sub>1</sub>, C<sub>2</sub> and C<sub>4)</sub>, we transfected cells at 2.5 days into differentiation, and drove overexpression of <italic>Snai1</italic> 12 hr later in a population consisting primarily of cells in C<sub>1</sub> and C<sub>2</sub> states (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1D</xref>). After 24 hr of <italic>Snai1</italic> overexpression and further differentiation, we fixed and immunostained the cells for T to distinguish cells in C<sub>1</sub> (T-low) and C<sub>2</sub> (T-high) states. We also immunostained the cells for Oct4 to distinguish the C<sub>1</sub> state from other T-low states that arise during the last 24 hr of differentiation following the initiation of induction. We found that the fraction of C<sub>1</sub> cells within the transfected population was significantly reduced relative to control (<inline-formula><mml:math id="inf80"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1.98</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>13</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>), suggesting that cells in this state had downregulated Oct4 levels in response to <italic>Snai1</italic> overexpression. On the other hand, the fraction of C<sub>2</sub> cells within the transfected population and their Oct4 levels were maintained relative to control, in agreement with our predictions (<xref ref-type="fig" rid="fig4">Figure 4G</xref>; <xref ref-type="fig" rid="fig5">Figure 5C and D</xref>).</p><p>Finally, we tested whether cells in epiblast-like C<sub>1</sub> and bi-potent ectoderm-like C<sub>3</sub> states respond differently to LIF+BMP signaling, as predicted by our model. In order to investigate the relationship between a cell’s initial state and its final state in response to LIF+BMP exposure, we needed to assess cells’ initial states non-invasively. We found that 2.5 days into differentiation, we could obtain populations that consist primarily of cells in epiblast-like state C<sub>1</sub> and bi-potent ectoderm-like state C<sub>3</sub> (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1E</xref>), which have high and low expression of Oct4, respectively. We therefore utilized an Oct4<italic>-</italic>mCitrine mES cell line that we had previously engineered (<xref ref-type="bibr" rid="bib59">Thomson et al., 2011</xref>) to distinguish cells in C<sub>1</sub> and C<sub>3</sub> states after 2.5 days of differentiation. At this point, 1200 U/mL LIF and 25 ng/mL BMP4 were added to the media, after which we followed individual cells’ Oct4 expression dynamics for approximately 24 hr via live-cell microscopy, followed by fixing and immunostaining for Msx2, a unique marker gene for the neural crest-like cell state C<sub>6</sub> (<xref ref-type="fig" rid="fig5">Figure 5E and F</xref>). As predicted by the model (<xref ref-type="fig" rid="fig4">Figure 4I</xref>), only cells that had low Oct4 levels (and were therefore in the bi-potent ectoderm-like state C<sub>3</sub>) prior to LIF+BMP exposure showed upregulation of Msx2 in response to LIF+BMP (<inline-formula><mml:math id="inf81"><mml:mrow><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>0.5056</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>0.0044</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula><xref ref-type="fig" rid="fig5">Figure 5G and H</xref>). Together, these results show that the inferred cell states reflect phenotypic discreteness in cells’ responses to perturbations, and that the gene expression changes that define these responses mirror those predicted by our model gene regulatory network.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>By using learned sparse patterns of gene expression from established experimental systems (<xref ref-type="bibr" rid="bib11">Furchtgott et al., 2016</xref>), we can analyze single-cell transcriptomics data to uncover the gene expression dynamics of differentiation. This method naturally identifies a small set of transcription factors whose expression profiles are multimodal across neighboring cell states. Given that transcription factors are key orchestrators of gene expression and therefore cell fate decisions (<xref ref-type="bibr" rid="bib53">Spitz and Furlong, 2012</xref>), multimodal distributions of the expression levels of even a small set of transcription factors can define cell states in a population of cells.</p><p>While cell states can be characterized by the gene expression patterns of key sets of genes, these states can only be fully validated by demonstrating distinct physiological properties. To discover distinct properties of the cell states in early mES cell differentiation, we built probabilistic models of the underlying network. Requiring these models to have discrete cell states leads to the prediction that each cell state has a distinct response to perturbations by signals and changing levels of gene expression. Thus, the cell states we discovered can be functionally defined by their responses to perturbation. Our experimental tests show, as predicted by the model network, that <italic>Oct4</italic> is either downregulated or unaffected by overexpression of <italic>Sox2</italic> or <italic>Snai1</italic>, depending on the cell state. Previous studies have already shown that <italic>Sox2</italic> and <italic>Oct4</italic>, along with <italic>Klf4</italic>, constitute part of a positive feedback loop that stabilizes the pluripotent ground state (<xref ref-type="bibr" rid="bib26">Kim et al., 2008</xref>; <xref ref-type="bibr" rid="bib68">Young, 2011</xref>). It is also known that in undifferentiated cells, <italic>Snai1</italic> overexpression leads to downregulation of <italic>Oct4</italic> expression and, subsequently, to exit of pluripotency (<xref ref-type="bibr" rid="bib13">Galvagni et al., 2015</xref>). However, our results demonstrate that these interactions are state-dependent by showing that the effective positive interactions between <italic>Sox2</italic> and <italic>Oct4</italic> become destabilized as <italic>Klf4</italic> levels drop and cells transition to a primed, epiblast-like pluripotent state. Similarly, the negative interaction exerted by <italic>Snai1</italic> on <italic>Oct4</italic> becomes attenuated in the presence of early primitive streak genes such as <italic>T</italic>. We also predict and show that LIF+BMP exposure pushes bi-potent ectoderm-like cells toward an <italic>Msx2</italic>-positive neural crest-like state, but this effect is not seen in epiblast-like cells. These results are further supported by the fact that both LIF and BMP signaling pathways can be used to keep cells in the pluripotent cell state (<xref ref-type="bibr" rid="bib7">Chambers, 2004</xref>; <xref ref-type="bibr" rid="bib57">Tam et al., 2006</xref>; <xref ref-type="bibr" rid="bib66">Ying and Smith, 2003</xref>), and that BMP signaling plays a significant role in the differentiation of neural crest cells (<xref ref-type="bibr" rid="bib29">Knecht and Bronner-Fraser, 2002</xref>). Together, these findings signify that the inferred cell states directly reflect differences in cells’ responses to perturbations and show that these cell states can also be defined by their unique responses to perturbations.</p><p>Comprehensive interrogation of gene expression through RNA sequencing is impossible without the termination of cells, providing only static snapshots of gene expression during differentiation. Despite this and the complexity of the underlying network, we discover that both cell states and the sequence of cell state transitions can be accurately determined by monitoring the levels of just a few transition or marker genes. Monitoring the expression dynamics of these key genes in live cells using microscopy will allow us in the future to continuously track the cell-fate decisions of individual cells. The inferred gene modules therefore represent the ‘order parameters’ by which cell-state transition dynamics can be directly measured. Live cell microscopy experiments will also allow us to measure, in conjunction with cell state transition dynamics, changes in individual cells’ spatial environment, movement, lineage history, and cell cycle dynamics in order to address fundamental biological questions as to how these factors affect cell fate decisions. Finally, our results suggest that cell-to-cell heterogeneity within differentiating populations arises largely as a consequence of cells’ variability in their timing of cell state transitions. Our inferred cell clusters show mixing of cells from different time points (<xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>, <xref ref-type="supplementary-material" rid="SD2-data">Figure 2—source data 1</xref>), suggesting that the observed states themselves do not change over time and that at the population level, differentiation occurs as a change in the proportions of cells in various cell states rather than through changes in the cell states themselves (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). Since cells interpret perturbations differently even in consecutive states (<xref ref-type="fig" rid="fig5">Figure 5</xref>), this suggests that heterogeneity arising from timing variability is further amplified in response to signal addition or fluctuations in gene expression level. These findings emphasize the importance of understanding how the timing of cell state transitions is controlled during development.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Clustering and re-clustering using seurat</title><p>Clustering was performed using Seurat (<xref ref-type="bibr" rid="bib51">Satija et al., 2015</xref>). For the initial seed clustering, we applied Seurat to the gene expression of all 2672 transcription factors for the 288 single cells. For subsequent re-clustering steps, clustering was performed on a reduced set of genes for which <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mtext>|</mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mi>g</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>}</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> for at least one triplet at the previous iteration (assuming a prior odds of <inline-formula><mml:math id="inf83"><mml:mrow><mml:msub><mml:mi mathvariant="script">𝒪</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mo>|</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula>). This reduced set contained between 800 and 1050 genes at each of the reclustering steps (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>).</p><p>Seurat performs spectral t-SNE on the statistically significant principal components (PCs) of the gene expression dataset, and it determines the significance of each PC score using a randomization approach developed by Chung and Storey (<xref ref-type="bibr" rid="bib8">Chung and Storey, 2015</xref>). Our initial seed clustering was performed using the first 10 PCs; subsequent re-clusterings used the first 8 PCs.</p><p>Finally, Seurat performs density-based clustering on the t-SNE map; we used a density parameter of G = 8 (<xref ref-type="bibr" rid="bib38">Macosko et al., 2015</xref>).</p></sec><sec id="s4-2"><title>Convergence of clustering configurations from different seed configurations</title><p>In order to test that our results were robust to the choice of seed clusters, we further used k-means clustering, a standard clustering method, which has previously been applied to identify different cell types using single-cell transcriptomics data (<xref ref-type="bibr" rid="bib6">Buettner et al., 2015</xref>).</p><p>We start with a seed clustering configuration of 12 clusters <inline-formula><mml:math id="inf84"><mml:mrow><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> obtained using k-means clustering, which is distinct from the seed clustering configuration obtained via Seurat (<xref ref-type="bibr" rid="bib51">Satija et al., 2015</xref>). The number of clusters was determined using the gap statistic (<xref ref-type="bibr" rid="bib60">Tibshirani et al., 2001</xref>). We obtained 164 sets of transitions between clusters and identified 981 transcription factors that were high probability (probability &gt;0.5) marker or transition genes for at least one of the identified transitions. We next re-clustered the single cells in the gene expression space defined by these 981 marker or transition genes, using k-means clustering, to obtain a new cluster set <inline-formula><mml:math id="inf85"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>}</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>2</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, consisting of 10 clusters. In the next iteration, the number of clusters went down to 9, and so on. By iteratively determining the most likely sets of transitions, the corresponding most likely marker and transition genes and re-clustering the cells within the subspace of these genes, our algorithm converged upon the most likely set of cell clusters (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). We found that the eventual clustering configurations obtained using k-means clustering and Seurat are the same, confirming that the seed clusters do not affect the final outcome (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A, B and C</xref>).</p></sec><sec id="s4-3"><title>Framework for quantitative modeling of germ layer differentiation</title><p>Classifying genes based on their patterns of expression along the inferred lineage tree rather than by gene-gene correlations allowed us to identify gene modules (which included the transition and marker genes we inferred as well as signaling genes: BMP, WNT, LIF, see Tables S4 and S5) with similar expression patterns in successive cell-fate decisions.</p><sec id="s4-3-1"><title>Determination of gene modules</title><p>We obtained 321 transcription factors from the triplets along the tree and classify them based on their pattern across the triplets. In order to explain the discretization procedure let consider the example of Otx2, which is a transition gene for the triplet involving C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub> clusters, where C<sub>1</sub> is the intermediate cluster. Since Otx2 is expressed at high levels in cluster C<sub>1</sub> and C<sub>3</sub> and is downregulated in cluster C<sub>2</sub>, we assigned it a value of 1 in clusters C<sub>1</sub> and C<sub>3</sub> respectively and 0 in cluster C<sub>2</sub>. We then repeated this local binarization process across all triplets along the lineage tree. We grouped all the genes that showed the same locally binarized expression pattern as Otx2 and obtained their average expression level across all the other clusters. Subsequently, we assigned these genes a value of 1 in a cluster if the average expression of these genes in that cluster was comparable (within ~10% of the mean) or higher than the lower value of their average expression level in the C<sub>1</sub> and C<sub>3</sub> clusters. Some genes, such as Oct4 and Etv5 are re-used at multiple branching points i.e. they belong to multiple triplets, either as marker genes or transition genes, and hence belong to different groups (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). Certain genes that are re-used exhibit three distinct levels of expression. For instance, Sox2 comes up as a marker gene for C<sub>0</sub> cluster, when we consider the triplets involving clusters C<sub>0</sub>, C<sub>1</sub> and C<sub>2</sub> and C<sub>0</sub>, C<sub>1</sub> and C<sub>3</sub> clusters respectively. However, it also acts as a transition gene for the triplet involving C<sub>1</sub>, C<sub>2</sub> and C<sub>3</sub> clusters, where Sox2 is downregulated in C<sub>2</sub>. Such a gene expression pattern would require three distinct levels (high in C<sub>0</sub>, medium in C<sub>1</sub>, C<sub>3</sub>, and low in C<sub>2</sub>). We classified the medium and higher expression level as one and low expression level as 0. It must be noted that we determined binary gene expression profiles by calculating the mean log2 fold-change in expression level for each group of genes. This way we acquired a total of 29 modules with unique binary gene expression profiles. We denote each module by a representative gene; the genes that belong to each module are shown in <xref ref-type="supplementary-material" rid="SD5-data">Figure 4—source data 1</xref>.</p></sec><sec id="s4-3-2"><title>Local-field gene regulatory network model for gene modules</title><p>In order to build a quantitative model relating the gene modules, we write a N-component gene regulatory network governed by a set of differential equations:<disp-formula id="equ4"><label>(1)</label><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>m</mml:mi><mml:mo>.</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mo>−</mml:mo><mml:mfrac><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>+</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>m</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>N</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf86"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf87"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> are respectively the life-time and basal production rate of module <inline-formula><mml:math id="inf88"><mml:mi>i</mml:mi></mml:math></inline-formula>; we will rescale <inline-formula><mml:math id="inf89"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> = 1 and <inline-formula><mml:math id="inf90"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula>= 0 without any loss of generality. We denote the level of module <inline-formula><mml:math id="inf91"><mml:mi>i</mml:mi></mml:math></inline-formula> as <inline-formula><mml:math id="inf92"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. We assume here that modules interact only by modulating each-other’s rate of production, described here by rate functions <inline-formula><mml:math id="inf93"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> which depend on the state <inline-formula><mml:math id="inf94"><mml:mrow><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> of the gene regulatory network.</p><p>As above, we consider that the production rate <inline-formula><mml:math id="inf95"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is the result of only direct interactions, in which each gene <italic>j</italic> exerts a drive on gene <italic>i</italic> which is equal to an interaction strength <inline-formula><mml:math id="inf96"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (positive or negative) multiplied by the level of module <italic>j</italic>. The total drive <inline-formula><mml:math id="inf97"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula>on gene <italic>i</italic> is the sum of the drives from the different modules:<disp-formula id="equ5"><label>(2)</label><mml:math id="m5"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:munderover><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo movablelimits="false">∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>We now assume <inline-formula><mml:math id="inf98"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> has a universal scaling form that is the same for all factors,<disp-formula id="equ6"><label>(3)</label><mml:math id="m6"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>r</mml:mi><mml:mrow><mml:mo>[</mml:mo> <mml:mrow><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf99"><mml:mrow><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>;</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a monotonic sigmoidal function centered at <inline-formula><mml:math id="inf100"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and bounded by the limits<disp-formula id="equ7"><label>(4)</label><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mi>ϕ</mml:mi><mml:mo>≪</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mtext> </mml:mtext><mml:mi>ϕ</mml:mi><mml:mo>≫</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>the sharpness of crossover is determined by the nonlinearity parameter <inline-formula><mml:math id="inf101"><mml:mi>μ</mml:mi></mml:math></inline-formula>. The upper bound of <inline-formula><mml:math id="inf102"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> sets the maximum sustainable expression at <inline-formula><mml:math id="inf103"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. In the limit <inline-formula><mml:math id="inf104"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>→</mml:mo><mml:mi>∞</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf105"><mml:mrow><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> becomes the Heaviside step function, and <inline-formula><mml:math id="inf106"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is binary.</p><p>Suppose state <inline-formula><mml:math id="inf107"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mn>1</mml:mn><mml:mi>α</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mrow><mml:mn>29</mml:mn></mml:mrow><mml:mi>α</mml:mi></mml:msubsup><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> with expression level <inline-formula><mml:math id="inf108"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> in module <inline-formula><mml:math id="inf109"><mml:mi>i</mml:mi></mml:math></inline-formula> is a stable state of the network. In the limit <inline-formula><mml:math id="inf110"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>→</mml:mo><mml:mi>∞</mml:mi></mml:mrow></mml:math></inline-formula>, the condition for <inline-formula><mml:math id="inf111"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> to be a fixed point is:<disp-formula id="equ8"><label>(5)</label><mml:math id="m8"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>m</mml:mi><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>m</mml:mi><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf112"><mml:mi>H</mml:mi></mml:math></inline-formula> is the Heaviside step function. (Note that if <inline-formula><mml:math id="inf113"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>&gt;0 then <inline-formula><mml:math id="inf114"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mi>m</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover><mml:mtext>0</mml:mtext><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow></mml:mstyle></mml:math></inline-formula> is always a stable fixed point of the network.)</p><p>In this limit, each state <inline-formula><mml:math id="inf115"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> of the network is associated with N constraints given by inequalities of the form<disp-formula id="equ9"><label>(6)</label><mml:math id="m9"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo>⇒</mml:mo><mml:mo> </mml:mo><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>m</mml:mi><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>&lt;</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ10"><label>(7)</label><mml:math id="m10"><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo>⇒</mml:mo><mml:mo> </mml:mo><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>m</mml:mi><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>If <inline-formula><mml:math id="inf116"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is a fixed point, all N of its constraints must hold. If we know the fixed points of the network, then we can write down a system of inequalities that constrain possible values for <inline-formula><mml:math id="inf117"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. Since gene-gene interactions cannot be infinitely strong, <inline-formula><mml:math id="inf118"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> must be bounded. We take <inline-formula><mml:math id="inf119"><mml:mrow><mml:mrow><mml:mo>|</mml:mo> <mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mo>|</mml:mo></mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf120"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula>. We further vary the value of the critical drive <inline-formula><mml:math id="inf121"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> from −2 to 2 to check the robustness of the predictions. We find that all the results qualitatively hold although the individual probabilities change.</p></sec><sec id="s4-3-3"><title>Linear programming</title><p>The constraints (7) and (8) placed on <inline-formula><mml:math id="inf122"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> by the fixed point condition are linear in <inline-formula><mml:math id="inf123"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. We can take advantage of this fact and use linear programming methods (<xref ref-type="bibr" rid="bib16">Gass, 2013</xref>) to obtain solutions for <inline-formula><mml:math id="inf124"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> by extremizing a linear objective function of the form<disp-formula id="equ11"><label>(8)</label><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>U</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf125"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are constant coefficients. The system of constraints defines a <inline-formula><mml:math id="inf126"><mml:mrow><mml:msup><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>-dimensional polytope in <inline-formula><mml:math id="inf127"><mml:mi>J</mml:mi></mml:math></inline-formula>-space that encloses all solutions of <inline-formula><mml:math id="inf128"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> consistent with the fixed-point constraints, and <inline-formula><mml:math id="inf129"><mml:mi>U</mml:mi></mml:math></inline-formula> defines a <inline-formula><mml:math id="inf130"><mml:mrow><mml:msup><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> dimensional hyperplane. Linear programming returns a solution for <inline-formula><mml:math id="inf131"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (a point in <inline-formula><mml:math id="inf132"><mml:mi>J</mml:mi></mml:math></inline-formula>-space) where the polytope contacts a <inline-formula><mml:math id="inf133"><mml:mi>U</mml:mi></mml:math></inline-formula>-plane of extremal value. The solution will lie on the boundary of the polytope and is in general non-unique. There is no general principle with which to select any specific <inline-formula><mml:math id="inf134"><mml:mi>U</mml:mi></mml:math></inline-formula>-plane as the ‘best’ objective function. Furthermore, one would like to sample points in the interior of the polytope, and not just on its surface. Here, guided by the fact that we seek pertubative solutions for <inline-formula><mml:math id="inf135"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> that ideally lie close to the origin, we impose a fictitious additional constraint on the polytope in the form of a hyperplane that contains the origin<disp-formula id="equ12"><label>(9)</label><mml:math id="m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where the coefficients <inline-formula><mml:math id="inf136"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mo/></mml:mrow></mml:math></inline-formula>are randomly chosen; this in effect slices the polytope in two and exposes an interior plane. Then, using the same choices of <inline-formula><mml:math id="inf137"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> to define a <inline-formula><mml:math id="inf138"><mml:mi>U</mml:mi></mml:math></inline-formula>-plane, we seek a linear programming solution that maximizes <inline-formula><mml:math id="inf139"><mml:mi>U</mml:mi></mml:math></inline-formula>, that is, a solution that lies on the now-exposed interior plane (if possible). Because these fictitious constraints radiate from the origin, points in the polytope that lie closest to the origin are sampled more densely.</p></sec><sec id="s4-3-4"><title>Common features of the sampled networks</title><p>By using many different randomly generated fictitious constraints to sample the polytope, we can study the ensemble of model networks that all satisfy the fixed point constraints (<xref ref-type="supplementary-material" rid="SD6-data">Figure 4—source data 2</xref>), and attempt to determine whether they share any common regulatory motifs. As discussed in the main text, we sampled 10,000 solutions <inline-formula><mml:math id="inf140"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> that satisfied the fixed-point constraints defined by the binarized expression patterns of the known cell states. We then calculated the mean and coefficient of variation (c.v.) for each coupling. We were thus able to discover a core network between the different modules that is shared by the majority of solutions (<xref ref-type="fig" rid="fig4">Figure 4A</xref>).</p></sec><sec id="s4-3-5"><title>Predictions for Sox2 and Snai1 overexpression</title><p>Our model makes predictions for what happens to the level of Oct4 when Sox2 and Snai1 are overexpressed in different cell states. Sox2 and Oct4 are both present in the C<sub>0</sub> and C<sub>1</sub> clusters. On the other hand, Snai1 is not present in C<sub>1</sub> and C<sub>2</sub> but Oct4 is present in both clusters. We perturb the Sox2 and Snai1 levels by amounts ∆s in the above mentioned states, which lead to a change in the field <inline-formula><mml:math id="inf141"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> total drive on Oct4 level. Numerically we vary ∆s in steps of 0.1 and for each step compute the number of models out of the 10000 total models, for which the Oct4 level decreases to zero. From this number we obtain the fraction of models for which the level of Oct4 goes down.</p></sec><sec id="s4-3-6"><title>Predictions for BMP and LIF addition</title><p>In order to predict the effect of morphogen signals in different cell states, we considered the LIF, BMP, WNT, and FGF signaling pathways, which are known to play a significant role in patterning the early embryo. We assumed that no single gene in each given pathway is sufficient to evoke a signaling response, but a response rather requires the combined presence of the various constituent genes of the pathway. We therefore grouped genes by their respective signaling pathways and assigned each group to a module based on its average expression pattern across the nine cell states. The discretization process of this mean expression pattern was the same as that used for TF genes. The signaling genes we used are shown in <xref ref-type="supplementary-material" rid="SD5-data">Figure 4—source data 1</xref>.</p><p>We next modeled the dynamics of BMP and LIF addition. By construction, the nine observed cell states (and the null state <inline-formula><mml:math id="inf142"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mi>m</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover><mml:mtext>0</mml:mtext><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow></mml:mstyle></mml:math></inline-formula>) are fixed points for all 10,000 sampled solutions for <inline-formula><mml:math id="inf143"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. However, each solution <inline-formula><mml:math id="inf144"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> may have additional spurious fixed points. However, given that we only see 9 cell states, we would expect the spurious states to be unstable. In order to overcome this problem, we used the following method.</p><p>Given a particular solution <inline-formula><mml:math id="inf145"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, any arbitrary state of the network <inline-formula><mml:math id="inf146"><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:math></inline-formula> (not necessarily a fixed point) will have dynamics obeying<disp-formula id="equ13"><label>(10)</label><mml:math id="m13"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf147"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf148"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> are the levels of module <inline-formula><mml:math id="inf149"><mml:mi>i</mml:mi></mml:math></inline-formula> at successive discretized time points.</p><p>For each particular solution <inline-formula><mml:math id="inf150"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, cells will get stuck in spurious fixed points; yet these spurious fixed points are highly unlikely to exist since they are stable in only a small number of the sampled <inline-formula><mml:math id="inf151"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. We can capture the average dynamics of different states of the network given the set of sampled solutions <inline-formula><mml:math id="inf152"><mml:mrow><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> by calculating the probability over all sampled solutions of moving from one arbitrary state <inline-formula><mml:math id="inf153"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>a</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> to another arbitrary state <inline-formula><mml:math id="inf154"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>b</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. This allows us to define a 2<sup>29</sup> × 2<sup>29</sup> state-to-state transition matrix <inline-formula><mml:math id="inf155"><mml:mi mathvariant="script">𝒯</mml:mi></mml:math></inline-formula>:<disp-formula id="equ14"><label>(11)</label><mml:math id="m14"><mml:mrow><mml:msub><mml:mi mathvariant="script">𝒯</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>←</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>a</mml:mi></mml:msup><mml:mo>→</mml:mo><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>b</mml:mi></mml:msup><mml:mtext>|</mml:mtext><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>If we denote as <inline-formula><mml:math id="inf156"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> the vector of probabilities of being in the 2<sup>29</sup> different states at time <inline-formula><mml:math id="inf157"><mml:mi>t</mml:mi></mml:math></inline-formula>, then<disp-formula id="equ15"><label>(12)</label><mml:math id="m15"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="script">𝒯</mml:mi><mml:mo> </mml:mo><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo></mml:mrow></mml:math></disp-formula></p><p>In order to figure out what happens to cells in different states to BMP and LIF addition, we calculated the probability of moving between fixed points <inline-formula><mml:math id="inf158"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf159"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>β</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> when overexpressing some set of modules <inline-formula><mml:math id="inf160"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. We calculated the dynamics using the transition matrix <inline-formula><mml:math id="inf161"><mml:mi mathvariant="script">𝒯</mml:mi></mml:math></inline-formula> and enforced the overexpression of the set of modules (BMP and LIF module respectively) at each time point, updating the probabilities <inline-formula><mml:math id="inf162"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> accordingly. The probabilities shown in <xref ref-type="fig" rid="fig4">Figure 4</xref> are after 1000 time steps.</p></sec></sec><sec id="s4-4"><title>ES-cell culture</title><p>v6.5 (RRID: <ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/CVCL_C865">CVCL_C865</ext-link>; passage number 18 ~ 30; mycoplasma tested negative) mouse embryonic cells were maintained and passaged in monolayer (non-embryoid body formation) in N2B27 basal media with signaling molecules and/or small molecules added to the basal media. ES cells were maintained in a pluripotent cell state using 1200 U/mL mLIF (murine leukemia inhibitory factor), 1 μM PD0325901 (MEK inhibitor), and 3 μM CHIR99021 (GSK inhibitor) conditions (a.k.a. 'LIF + 2i’; <xref ref-type="bibr" rid="bib67">Ying et al., 2008</xref>), and passaged every two days. To passage cells, we added 0.01% trypsin to cells after aspirating media and incubated the plate in 37’C for 1 ~ 2 min to detach cells. The trypsin was then quenched with 0.5 mL of fetal bovine serum, and the resulting cell suspension was collected, counted, and pelleted at 200 x g for 5 min at room temperature. The supernatant was aspirated and the cells were resuspended and re-seeded onto a gelatinized tissue culture dish at a density of 1e6 cells per 10 cm diameter plate. All cell lines were depleted of feeders and transitioned to serum free medium over several passages prior to experiments (<xref ref-type="bibr" rid="bib66">Ying and Smith, 2003</xref>). N2B27 is prepared as described in <xref ref-type="bibr" rid="bib15">Gaspard et al. (2008)</xref>, <xref ref-type="bibr" rid="bib66">Ying and Smith (2003</xref>).</p></sec><sec id="s4-5"><title>ES cell differentiation</title><p>Cells were seeded at a density of 10<sup>6</sup> per 10 cm diameter plate, and were not trypsinized again until they were harvested for analysis. We either exposed cells to 0.4 μM PD0325901 or 3 μM CHIR99021 and 10 ng/mL Activin A (human, rat, mouse) for 2 days or 3 days, respectively, followed by either 25 ng/mL <italic>hBmp4</italic> or 1 μM LDN193189 (BMP antagonist) for up to two days. Media was replenished every 48 hr. Cells exposed to 0.4 μM PD0325901 gave rise to ectodermal lineages, as characterized by expression of <italic>Sox1</italic>, <italic>Pax6</italic> (treated with LDN193189), <italic>Slug</italic>, and <italic>Msx2</italic> (treated with <italic>hBmp4</italic>) after three days of differentiation. Cells exposed to CHIR99021 and Activin A gave rise to mesendodermal lineages (<xref ref-type="bibr" rid="bib55">Sumi et al., 2008</xref>), as characterized by expression of <italic>T</italic> after three days of differentiation, and <italic>FoxA2</italic> (treated with LDN193189) and <italic>Gata4</italic> (treated with <italic>hBmp4</italic>) after four days of differentiation.</p></sec><sec id="s4-6"><title>Single-cell RNA-Seq</title><p>CEL-seq libraries as previously reported (<xref ref-type="bibr" rid="bib20">Hashimshony et al., 2012</xref>) with a few modifications. Single cells were sorted with a FACSAria into 96 well plates containing 1.2 µL 2 × CellsDirect Buffer (Life Technologies) with 0.1 µL of ERCCs diluted to 1 × 10<sup>−6</sup> molecules (Life Technologies). Plates were frozen and stored at −80°C. For library preparation, mRNA was reverse transcribed using 0.15625 pmol of oligoT primer carrying a cell-specific 8 NT barcode and a 5 NT unique molecular identifier (UMI) (<xref ref-type="bibr" rid="bib22">Islam et al., 2014</xref>). Barcode design ensured at least two nucleotide differences from any other barcode. Samples were lysed at 70°C for 5 min, then reverse transcribed using Superscript III for two hours at 50°C, then primers digested with 1 µL of ExoSAP-IT (Affymetrix). Second strand synthesis was carried out with Second Strand Synthesis Buffer, dNTPs, DNA Polymerase, and RNAse H (NEB) at 16°C for 2 hr. Single-cell cDNAs were pooled by 24 wells per library, with each library containing a water-only well and one ERCC-only well. Pools were purified with an equal volume of RNA Clean Beads (Beckman Coulter) and amplified at 37°C for 15 hr using the HiScribe T7 High Yield RNA Synthesis kit (NEB), and treated with DNAse I (Life Technologies). Amplified RNA was fragmented using the NEBNext RNA Fragmentation Module (NEB), purified with an equal volume of RNA Clean Beads, and visualized using the RNA Pico Kit on the Bioanalyzer 2100 (Agilent). The RNA fragments were repaired with Antarctic Phosphatase and Polynucleotide Kinase (NEB), and purified using an equal volume of RNA Clean Beads. cDNA libraries were made using the NEBNext Small Library Prep Kit according to the manufacturer’s instructions, except Superscript III was used for the RT step. Index primers were used in PCR amplification. Approximately 160–200 nmol of a pool of libraries were size selected to exclude species smaller than 180 bp on a 2% Dye Free cassette on the Pippin Prep (<xref ref-type="bibr" rid="bib47">Roccio et al., 2013</xref>) and concentrated to approximately 14 µL. Pools were then quantified by qRT-PCR using p5 (5’-AATGATACGGCGACCACCGAGA-3’) and p7 (5’-CAAGCAGAAGACGGCATACGAGAT-3’) primers and by Bioanalyzer (DNA High Sensitivity Kit, Agilent), and sequenced on an Illumina HiSeq. The custom sequencing primer: 5’-TCTACACGTTCAGAGTTCTACAGTCCGACGATC-3’ was included with Illumina primer HP10 for sequencing. Standard Illumina primers HP12 and HP11 were used for the index read and the transcript read, respectively. PE50 kits (Illumina) were used for sequencing with read lengths of 25 nt, six nt, and 47 nt for read1 (cell barcode, UMI), index (library), and read2 (transcript), respectively. Following quantification, we discarded the data from wells that yielded below a total of 20,000 UMI (threshold based on empty well controls), which left us with 358 cells. Further, as others have recognized (<xref ref-type="bibr" rid="bib43">Paul et al., 2015</xref>), we found that some well-to-well mixing was present with CEL-Seq multiplexed single-cell RNA-Seq. We used the data only from 288 cells because of this mixing artifact. The raw and processed RNA-seq data for the 288 cells can be found on the GEO database (accession number: <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105054">GSE105054</ext-link>).</p></sec><sec id="s4-7"><title>Immunofluorescence</title><p>Cells were grown on ibidi µ-bottom plates and fixed with 4% paraformaldehyde. Cells were permeabilized with ice-cold 100% methanol, blocked with 5% donkey serum, incubated with primary antibody, washed, and incubated with DAPI and secondary antibody coupled to Alexa488 Alexa568, or Alexa647. Images were acquired with a Zeiss 40× plan apo objective (NA 1.3) with the appropriate filter sets. Data was analyzed using custom written code in MATLAB. Antibodies and dilutions used in this study: <italic>Klf4</italic> (Abcam ab129473, 1:400); <italic>Nanog</italic> (eBiosciences 14–5761, 1:800); <italic>Oct4</italic> (Santa Cruz sc-8628, 1:800; Cell Signaling 2840, 1:400); <italic>Sox2</italic> (eBiosciences 14–9811, 1:800); <italic>Otx2</italic> (Neuromics GT15095, 1:400); <italic>T</italic> (<italic>Brachyury</italic>) (Santa Cruz sc-17745, 1:200); <italic>FoxA2</italic> (Cell Signaling 8186, 1:400); <italic>Gata4</italic> (eBiosciences 14–9980, 1:400); <italic>Sox1</italic> (Cell Signaling 4194, 1:200); <italic>Pax6</italic> (DSHB Pax6, 1:200); <italic>Msx1 +2</italic> (DSHB 4G1, 1:200); <italic>Slug</italic> (Cell Signaling 9585, 1:200), <italic>Snai1</italic> (Cell Signaling 2879, 1:200).</p></sec><sec id="s4-8"><title>Live-cell microscopy</title><p>For live-cell time-lapse microscopy, cells were plated into N2B27 without phenol-red (plus signaling molecules and small molecules) on ibidi µ-bottom plates. Cells were imaged on a Zeiss Axiovision inverted microscope with a Zeiss 40× plan apo objective (NA 1.3) with the appropriate filter sets with an Orca-Flash 4.0 camera (Hamamatsu). The microscope was enclosed with an environmental chamber in which CO<sub>2</sub> and temperature were regulated at 5% and 37°C, respectively. Images were acquired every 15 min for 12–48 hr. Image acquisition was controlled by Zen (Zeiss); image analysis was done with ImageJ (NIH) and Matlab (MathWorks). 38 HE GFP/43 HE DsRed/46 HE YFP/47 HE CFP/49 DAPI/50 Cy5 filter sets from Zeiss. Transition duration of Otx2-mCitrine cells was defined as the time between the last image at which a cell’s reporter intensity was equal to or below its intensity at t = 1 and the first image at which its intensity was equal to or above 2.2 (mean – <inline-formula><mml:math id="inf163"><mml:mi>σ</mml:mi></mml:math></inline-formula> of upper mode of Otx2 reporter intensity) on the normalized scale.</p></sec><sec id="s4-9"><title>Plasmid transfection</title><p>We cloned <italic>Sox2</italic> or <italic>Snai1</italic> cDNA to one side of a bi-directional Tet-on promoter (pTRE3G-BI; Clontech), to the other side of which we had cloned in mCerulean cDNA. Mini-prepped plasmid was ethanol-precipitated to further concentrate and remove any possible endotoxins. For <italic>Sox2</italic> overexpression, cells were seeded at 100,000 cells per 35 mm diameter plate in 2 mL of either LIF+2i conditions or differentiation media (0.4 μM PD0325901 or 3 μM CHIR99021) for 1 day. 200 μL of FBS was then added to each plate and 1.8 ug of plasmid was transfected using 5.4 μL of JetPrime (Polyplus). Cells were incubated for 12 hr, then washed with PBS and replenished with fresh LIF+2i or differentiation media. We then added 3 μL of Tet-Express mixed with 2.5 μL of Intensifier reagent (Clontech). Cells were incubated in induction media for 24 hr, after which they were harvested and fixed with 4% paraformaldehyde. Following fixation, they were permeabilized with ice-cold 100% methanol and rehydrated with 1% BSA. Cells were then stained for Oct4, Otx2 and Sox2 and analyzed using flow cytometry. For <italic>Snai1</italic> overexpression, cells were seeded at 100,000 cells per 35 mm diameter plate in 2 mL of 3 μM CHIR99021 for 2.5 days. 200 μL of FBS was then added to each plate and 1.8 μg of plasmid was transfected using 5.4 uL of JetPrime (Polyplus). Cells were incubated in transfection media for 12 hr, then washed with PBS and replenished with fresh N2B27 basal media. We then added 3 μL of Tet-Express mixed with 2.5 μL of Intensifier reagent (Clontech). Cells were incubated in induction media for 24 hr, after which they were harvested and fixed with 4% paraformaldehyde. Following fixation, they were permeabilized with ice-cold 100% methanol and rehydrated with 1% BSA. Cells were then stained for Oct4 and T and analyzed using flow cytometry.</p></sec><sec id="s4-10"><title>Fluorescence-activated cell sorting</title><p>Cells were trypsinized and fixed in suspension with formaldehyde (4% final concentration, diluted in PBS), permeabilized with ice cold 100% methanol and blocked with 5% donkey serum for 1 hr. Finally, cells are stained with primary antibodies diluted in PBS containing 1% BSA, and detected using fluorescent-tagged secondary antibodies. Flow cytometry was performed on a BD FACSAria flow cytometer equipped with 355 nm, 405 nm, 488 nm, 561 nm, and 637 nm lasers. The data acquired were analyzed using custom programs written in MatLab.</p></sec><sec id="s4-11"><title>Generation of mOTX2-Citrine reporter cell line</title><p>G4 mESCs, a 129S6 x B6 F1 hybrid line (Andras Nagy, University of Toronto) were maintained on DR4 mouse embryonic fibroblasts (MEFs). These cells (1 × 10<sup>7</sup>) were electroporated (Transfection Buffer, Millipore; Bio-Rad set at 250 V and 500 mF) with 5 µg each TALEN plasmid (AI-CN301 and AI-CN302 targeting TTCCAGGTTTTGTGAAGA and TTTAAAAATCACCCACAA, respectively) and 20 µg donor plasmid (AI-CN563). Following transfection, cells were placed on ice for 5 min, then plated onto 3 × 10 cm dishes with MEFs. Beginning 30 hr after transfection, cells were selected with hygromycin at 150 µg/mL for 3 days, then 100 µg/mL for an additional 4 days. Approximately 48 hygromycin-resistant colonies were picked and expanded for freezing and DNA preparation and analysis. Five clones were identified with targeted integration by junction PCR (5' junction primers: aagagctaagtgccgccaacagc, catcagcccgtagccgaaggtag; 3' junction primers: cacgctgaacttgtggccgttta, cagctcacctccagcccaaggta). Following expansion and fluorescence-activated cell sorting (FACS), Cerulean<sup>+</sup> cells from two clones (2.1 and 2.4) were treated with Cre mRNA. After recovery and expansion, the Cerulean<sup>-</sup> cells were enriched by FACS and single-cell cloned. The resulting subclones were tested for removal of the selection cassette (primers: ggtgcctattctggtcgaactggatg, atcacctctgctttgaaggccatgac). The TALENs were kindly provided by the Joung lab synthesized using the FLASH method (<xref ref-type="bibr" rid="bib46">Reyon et al., 2012</xref>). Computation and Modeling were performed using a cluster at Harvard University.</p></sec><sec id="s4-12"><title>Software</title><p>Calculations were performed using custom written MATLAB code (The Mathworks) on the Harvard Research Computing Odyssey cluster. Code is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/furchtgott/sibilant">https://github.com/furchtgott/sibilant</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://github.com/sandeepc123/Gene_Regulatory_Network_Modeling">https://github.com/sandeepc123/Gene_Regulatory_Network_Modeling</ext-link> respectively. Seurat was done using the package provided in <ext-link ext-link-type="uri" xlink:href="https://github.com/satijalab/seurat">https://github.com/satijalab/seurat</ext-link> (<xref ref-type="bibr" rid="bib38">Macosko et al., 2015</xref>).</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank Alex Schier, Christof Koch, Ajamete Kayakas, Joshua Levi, Carol Thomson, John Phillips, Paola Arlotta, John Calarco, Leonid Mirny and Andrew Murray for their critical feedback. SJ was funded by the Samsung Scholarship Program. We thank the Allen Institute founders, PG Allen and J Allen and the NIH Directors Pioneer Award 5DP1MH099906-03 and National Science Foundation grant PHY-0952766 for support.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="conflict" id="conf1"><p>The authors declare that no competing interests exist.</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>SJ, Conceptualization, Data curation, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>SC, Conceptualization, Data curation, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con3"><p>LF, Data curation, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con4"><p>L-NZ, Data curation, Methodology</p></fn><fn fn-type="con" id="con5"><p>AD, Validation, Methodology</p></fn><fn fn-type="con" id="con6"><p>VM, Data curation, Formal analysis</p></fn><fn fn-type="con" id="con7"><p>EBL, Data curation, Validation</p></fn><fn fn-type="con" id="con8"><p>A-RK, Resources, Data curation</p></fn><fn fn-type="con" id="con9"><p>RAM, Resources, Data curation</p></fn><fn fn-type="con" id="con10"><p>LM, Resources, Data curation</p></fn><fn fn-type="con" id="con11"><p>BPL, Resources, Data curation, Writing—original draft</p></fn><fn fn-type="con" id="con12"><p>SR, Conceptualization, Supervision, Funding acquisition, Investigation, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following dataset was generated:</p><p><related-object content-type="generated-dataset" id="dataro1" source-id="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105054" source-id-type="uri"><collab>Sumin Jang</collab><x>,</x> <collab>Vilas Menon</collab><x>,</x> <collab>Anne-Rachel Krostag</collab><x>,</x> <collab>Boaz P Levi</collab><x>,</x> <collab>Sharad Ramanathan</collab><x>,</x> <year>2017</year><x>,</x><source>Dynamics of embryonic stem cell differentiation inferred from single-cell transcriptomics show a series of transitions through discrete cell states</source><x>,</x> <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105054">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE105054</ext-link> <x>,</x> <comment>Publicly available at the NCBI Gene Expression Omnibus (accession no. GSE105054)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Advani</surname><given-names>M</given-names></name><name><surname>Ganguli</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Statistical mechanics of high-dimensional inference</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1601.04650">1601.04650</ext-link></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arnold</surname><given-names>SJ</given-names></name><name><surname>Robertson</surname><given-names>EJ</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Making a commitment: cell lineage allocation and Axis patterning in the early mouse embryo</article-title><source>Nature Reviews Molecular Cell Biology</source><volume>10</volume><fpage>91</fpage><lpage>103</lpage><pub-id pub-id-type="doi">10.1038/nrm2618</pub-id><pub-id pub-id-type="pmid">19129791</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Borgel</surname><given-names>J</given-names></name><name><surname>Guibert</surname><given-names>S</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Chiba</surname><given-names>H</given-names></name><name><surname>Schübeler</surname><given-names>D</given-names></name><name><surname>Sasaki</surname><given-names>H</given-names></name><name><surname>Forné</surname><given-names>T</given-names></name><name><surname>Weber</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Targets and dynamics of promoter DNA methylation during early mouse development</article-title><source>Nature Genetics</source><volume>42</volume><fpage>1093</fpage><lpage>1100</lpage><pub-id pub-id-type="doi">10.1038/ng.708</pub-id><pub-id pub-id-type="pmid">21057502</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname><given-names>L</given-names></name><name><surname>Brown</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Zic2 is expressed in pluripotent cells in the blastocyst and adult brain expression overlaps with makers of neurogenesis</article-title><source>Gene Expression Patterns</source><volume>9</volume><fpage>43</fpage><lpage>49</lpage><pub-id pub-id-type="doi">10.1016/j.gep.2008.08.002</pub-id><pub-id pub-id-type="pmid">18755297</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buecker</surname><given-names>C</given-names></name><name><surname>Srinivasan</surname><given-names>R</given-names></name><name><surname>Wu</surname><given-names>Z</given-names></name><name><surname>Calo</surname><given-names>E</given-names></name><name><surname>Acampora</surname><given-names>D</given-names></name><name><surname>Faial</surname><given-names>T</given-names></name><name><surname>Simeone</surname><given-names>A</given-names></name><name><surname>Tan</surname><given-names>M</given-names></name><name><surname>Swigut</surname><given-names>T</given-names></name><name><surname>Wysocka</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Reorganization of enhancer patterns in transition from naive to primed pluripotency</article-title><source>Cell Stem Cell</source><volume>14</volume><fpage>838</fpage><lpage>853</lpage><pub-id pub-id-type="doi">10.1016/j.stem.2014.04.003</pub-id><pub-id pub-id-type="pmid">24905168</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buettner</surname><given-names>F</given-names></name><name><surname>Natarajan</surname><given-names>KN</given-names></name><name><surname>Casale</surname><given-names>FP</given-names></name><name><surname>Proserpio</surname><given-names>V</given-names></name><name><surname>Scialdone</surname><given-names>A</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name><name><surname>Stegle</surname><given-names>O</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Computational analysis of cell-to-cell heterogeneity in single-cell RNA-sequencing data reveals hidden subpopulations of cells</article-title><source>Nature Biotechnology</source><volume>33</volume><fpage>155</fpage><lpage>160</lpage><pub-id pub-id-type="doi">10.1038/nbt.3102</pub-id><pub-id pub-id-type="pmid">25599176</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chambers</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>The molecular basis of pluripotency in mouse embryonic stem cells</article-title><source>Cloning and Stem Cells</source><volume>6</volume><fpage>386</fpage><lpage>391</lpage><pub-id pub-id-type="doi">10.1089/clo.2004.6.386</pub-id><pub-id pub-id-type="pmid">15671667</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chung</surname><given-names>NC</given-names></name><name><surname>Storey</surname><given-names>JD</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Statistical significance of variables driving systematic variation in high-dimensional data</article-title><source>Bioinformatics</source><volume>31</volume><fpage>545</fpage><lpage>554</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu674</pub-id><pub-id pub-id-type="pmid">25336500</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Evans</surname><given-names>MJ</given-names></name><name><surname>Kaufman</surname><given-names>MH</given-names></name></person-group><year iso-8601-date="1981">1981</year><article-title>Establishment in culture of pluripotential cells from mouse embryos</article-title><source>Nature</source><volume>292</volume><fpage>154</fpage><lpage>156</lpage><pub-id pub-id-type="doi">10.1038/292154a0</pub-id><pub-id pub-id-type="pmid">7242681</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fard</surname><given-names>AT</given-names></name><name><surname>Srihari</surname><given-names>S</given-names></name><name><surname>Mar</surname><given-names>JC</given-names></name><name><surname>Ragan</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Not just a colourful metaphor: modelling the landscape of cellular development using hopfield networks</article-title><source>Npj Systems Biology and Applications</source><volume>2</volume><elocation-id>16001</elocation-id><pub-id pub-id-type="doi">10.1038/npjsba.2016.1</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Furchtgott</surname><given-names>L</given-names></name><name><surname>Melton</surname><given-names>S</given-names></name><name><surname>Menon</surname><given-names>V</given-names></name><name><surname>Lodato</surname><given-names>S</given-names></name><name><surname>Ramanathan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Discovering sparse transcription factor codes for cell states and state transitions during development</article-title><source>eLife</source><elocation-id>e20488</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.20488</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gadue</surname><given-names>P</given-names></name><name><surname>Huber</surname><given-names>TL</given-names></name><name><surname>Paddison</surname><given-names>PJ</given-names></name><name><surname>Keller</surname><given-names>GM</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Wnt and TGF-beta signaling are required for the induction of an in vitro model of primitive streak formation using embryonic stem cells</article-title><source>PNAS</source><volume>103</volume><fpage>16806</fpage><lpage>16811</lpage><pub-id pub-id-type="doi">10.1073/pnas.0603916103</pub-id><pub-id pub-id-type="pmid">17077151</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Galvagni</surname><given-names>F</given-names></name><name><surname>Lentucci</surname><given-names>C</given-names></name><name><surname>Neri</surname><given-names>F</given-names></name><name><surname>Dettori</surname><given-names>D</given-names></name><name><surname>De Clemente</surname><given-names>C</given-names></name><name><surname>Orlandini</surname><given-names>M</given-names></name><name><surname>Anselmi</surname><given-names>F</given-names></name><name><surname>Rapelli</surname><given-names>S</given-names></name><name><surname>Grillo</surname><given-names>M</given-names></name><name><surname>Borghi</surname><given-names>S</given-names></name><name><surname>Oliviero</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Snai1 promotes ESC exit from the pluripotency by direct repression of self-renewal genes</article-title><source>Stem Cells</source><volume>33</volume><fpage>742</fpage><lpage>750</lpage><pub-id pub-id-type="doi">10.1002/stem.1898</pub-id><pub-id pub-id-type="pmid">25504116</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gans</surname><given-names>C</given-names></name><name><surname>Northcutt</surname><given-names>RG</given-names></name></person-group><year iso-8601-date="1983">1983</year><article-title>Neural crest and the origin of vertebrates: a new head</article-title><source>Science</source><volume>220</volume><fpage>268</fpage><lpage>273</lpage><pub-id pub-id-type="doi">10.1126/science.220.4594.268</pub-id><pub-id pub-id-type="pmid">17732898</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gaspard</surname><given-names>N</given-names></name><name><surname>Bouschet</surname><given-names>T</given-names></name><name><surname>Hourez</surname><given-names>R</given-names></name><name><surname>Dimidschstein</surname><given-names>J</given-names></name><name><surname>Naeije</surname><given-names>G</given-names></name><name><surname>van den Ameele</surname><given-names>J</given-names></name><name><surname>Espuny-Camacho</surname><given-names>I</given-names></name><name><surname>Herpoel</surname><given-names>A</given-names></name><name><surname>Passante</surname><given-names>L</given-names></name><name><surname>Schiffmann</surname><given-names>SN</given-names></name><name><surname>Gaillard</surname><given-names>A</given-names></name><name><surname>Vanderhaeghen</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>An intrinsic mechanism of corticogenesis from embryonic stem cells</article-title><source>Nature</source><volume>455</volume><fpage>351</fpage><lpage>357</lpage><pub-id pub-id-type="doi">10.1038/nature07287</pub-id><pub-id pub-id-type="pmid">18716623</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gass</surname><given-names>SI</given-names></name></person-group><year iso-8601-date="2013">2013</year><source>Linear Programming</source><edition>5th edn</edition><publisher-name>Boyd &amp; Fraser Publishing Company</publisher-name></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Geula</surname><given-names>S</given-names></name><name><surname>Moshitch-Moshkovitz</surname><given-names>S</given-names></name><name><surname>Dominissini</surname><given-names>D</given-names></name><name><surname>Mansour</surname><given-names>AA</given-names></name><name><surname>Kol</surname><given-names>N</given-names></name><name><surname>Salmon-Divon</surname><given-names>M</given-names></name><name><surname>Hershkovitz</surname><given-names>V</given-names></name><name><surname>Peer</surname><given-names>E</given-names></name><name><surname>Mor</surname><given-names>N</given-names></name><name><surname>Manor</surname><given-names>YS</given-names></name><name><surname>Ben-Haim</surname><given-names>MS</given-names></name><name><surname>Eyal</surname><given-names>E</given-names></name><name><surname>Yunger</surname><given-names>S</given-names></name><name><surname>Pinto</surname><given-names>Y</given-names></name><name><surname>Jaitin</surname><given-names>DA</given-names></name><name><surname>Viukov</surname><given-names>S</given-names></name><name><surname>Rais</surname><given-names>Y</given-names></name><name><surname>Krupalnik</surname><given-names>V</given-names></name><name><surname>Chomsky</surname><given-names>E</given-names></name><name><surname>Zerbib</surname><given-names>M</given-names></name><name><surname>Maza</surname><given-names>I</given-names></name><name><surname>Rechavi</surname><given-names>Y</given-names></name><name><surname>Massarwa</surname><given-names>R</given-names></name><name><surname>Hanna</surname><given-names>S</given-names></name><name><surname>Amit</surname><given-names>I</given-names></name><name><surname>Levanon</surname><given-names>EY</given-names></name><name><surname>Amariglio</surname><given-names>N</given-names></name><name><surname>Stern-Ginossar</surname><given-names>N</given-names></name><name><surname>Novershtern</surname><given-names>N</given-names></name><name><surname>Rechavi</surname><given-names>G</given-names></name><name><surname>Hanna</surname><given-names>JH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Stem cells. m6A mRNA methylation facilitates resolution of naïve pluripotency toward differentiation</article-title><source>Science</source><volume>347</volume><fpage>1002</fpage><lpage>1006</lpage><pub-id pub-id-type="doi">10.1126/science.1261417</pub-id><pub-id pub-id-type="pmid">25569111</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goller</surname><given-names>T</given-names></name><name><surname>Vauti</surname><given-names>F</given-names></name><name><surname>Ramasamy</surname><given-names>S</given-names></name><name><surname>Arnold</surname><given-names>HH</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Transcriptional regulator BPTF/FAC1 is essential for trophoblast differentiation during early mouse development</article-title><source>Molecular and Cellular Biology</source><volume>28</volume><fpage>6819</fpage><lpage>6827</lpage><pub-id pub-id-type="doi">10.1128/MCB.01058-08</pub-id><pub-id pub-id-type="pmid">18794365</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hart</surname><given-names>AH</given-names></name><name><surname>Hartley</surname><given-names>L</given-names></name><name><surname>Sourris</surname><given-names>K</given-names></name><name><surname>Stadler</surname><given-names>ES</given-names></name><name><surname>Li</surname><given-names>R</given-names></name><name><surname>Stanley</surname><given-names>EG</given-names></name><name><surname>Tam</surname><given-names>PP</given-names></name><name><surname>Elefanty</surname><given-names>AG</given-names></name><name><surname>Robb</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Mixl1 is required for axial mesendoderm morphogenesis and patterning in the murine embryo</article-title><source>Development</source><volume>129</volume><fpage>3597</fpage><lpage>3608</lpage><pub-id pub-id-type="pmid">12117810</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hashimshony</surname><given-names>T</given-names></name><name><surname>Wagner</surname><given-names>F</given-names></name><name><surname>Sher</surname><given-names>N</given-names></name><name><surname>Yanai</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>CEL-Seq: single-cell RNA-Seq by multiplexed linear amplification</article-title><source>Cell Reports</source><volume>2</volume><fpage>666</fpage><lpage>673</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2012.08.003</pub-id><pub-id pub-id-type="pmid">22939981</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hopfield</surname><given-names>JJ</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>Neurons with graded response have collective computational properties like those of two-state neurons</article-title><source>PNAS</source><volume>81</volume><fpage>3088</fpage><lpage>3092</lpage><pub-id pub-id-type="doi">10.1073/pnas.81.10.3088</pub-id><pub-id pub-id-type="pmid">6587342</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Islam</surname><given-names>S</given-names></name><name><surname>Zeisel</surname><given-names>A</given-names></name><name><surname>Joost</surname><given-names>S</given-names></name><name><surname>La Manno</surname><given-names>G</given-names></name><name><surname>Zajac</surname><given-names>P</given-names></name><name><surname>Kasper</surname><given-names>M</given-names></name><name><surname>Lönnerberg</surname><given-names>P</given-names></name><name><surname>Linnarsson</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Quantitative single-cell RNA-seq with unique molecular identifiers</article-title><source>Nature Methods</source><volume>11</volume><fpage>163</fpage><lpage>166</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2772</pub-id><pub-id pub-id-type="pmid">24363023</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kanai-Azuma</surname><given-names>M</given-names></name><name><surname>Kanai</surname><given-names>Y</given-names></name><name><surname>Gad</surname><given-names>JM</given-names></name><name><surname>Tajima</surname><given-names>Y</given-names></name><name><surname>Taya</surname><given-names>C</given-names></name><name><surname>Kurohmaru</surname><given-names>M</given-names></name><name><surname>Sanai</surname><given-names>Y</given-names></name><name><surname>Yonekawa</surname><given-names>H</given-names></name><name><surname>Yazaki</surname><given-names>K</given-names></name><name><surname>Tam</surname><given-names>PP</given-names></name><name><surname>Hayashi</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Depletion of definitive gut endoderm in Sox17-null mutant mice</article-title><source>Development</source><volume>129</volume><fpage>2367</fpage><lpage>2379</lpage><pub-id pub-id-type="pmid">11973269</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karr</surname><given-names>JR</given-names></name><name><surname>Sanghvi</surname><given-names>JC</given-names></name><name><surname>Macklin</surname><given-names>DN</given-names></name><name><surname>Gutschow</surname><given-names>MV</given-names></name><name><surname>Jacobs</surname><given-names>JM</given-names></name><name><surname>Bolival</surname><given-names>B</given-names></name><name><surname>Assad-Garcia</surname><given-names>N</given-names></name><name><surname>Glass</surname><given-names>JI</given-names></name><name><surname>Covert</surname><given-names>MW</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A whole-cell computational model predicts phenotype from genotype</article-title><source>Cell</source><volume>150</volume><fpage>389</fpage><lpage>401</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2012.05.044</pub-id><pub-id pub-id-type="pmid">22817898</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keller</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Embryonic stem cell differentiation: emergence of a new era in biology and medicine</article-title><source>Genes &amp; Development</source><volume>19</volume><fpage>1129</fpage><lpage>1155</lpage><pub-id pub-id-type="doi">10.1101/gad.1303605</pub-id><pub-id pub-id-type="pmid">15905405</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>J</given-names></name><name><surname>Chu</surname><given-names>J</given-names></name><name><surname>Shen</surname><given-names>X</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><name><surname>Orkin</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>An extended transcriptional network for pluripotency of embryonic stem cells</article-title><source>Cell</source><volume>132</volume><fpage>1049</fpage><lpage>1061</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2008.02.039</pub-id><pub-id pub-id-type="pmid">18358816</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>JK</given-names></name><name><surname>Huh</surname><given-names>SO</given-names></name><name><surname>Choi</surname><given-names>H</given-names></name><name><surname>Lee</surname><given-names>KS</given-names></name><name><surname>Shin</surname><given-names>D</given-names></name><name><surname>Lee</surname><given-names>C</given-names></name><name><surname>Nam</surname><given-names>JS</given-names></name><name><surname>Kim</surname><given-names>H</given-names></name><name><surname>Chung</surname><given-names>H</given-names></name><name><surname>Lee</surname><given-names>HW</given-names></name><name><surname>Park</surname><given-names>SD</given-names></name><name><surname>Seong</surname><given-names>RH</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Srg3, a mouse homolog of yeast SWI3, is essential for early embryogenesis and involved in brain development</article-title><source>Molecular and Cellular Biology</source><volume>21</volume><fpage>7787</fpage><lpage>7795</lpage><pub-id pub-id-type="doi">10.1128/MCB.21.22.7787-7795.2001</pub-id><pub-id pub-id-type="pmid">11604513</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>PT</given-names></name><name><surname>Ong</surname><given-names>CJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Differentiation of definitive endoderm from mouse embryonic stem cells</article-title><source>Results and Problems in Cell Differentiation</source><volume>55</volume><fpage>303</fpage><lpage>319</lpage><pub-id pub-id-type="doi">10.1007/978-3-642-30406-4_17</pub-id><pub-id pub-id-type="pmid">22918814</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Knecht</surname><given-names>AK</given-names></name><name><surname>Bronner-Fraser</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Induction of the neural crest: a multigene process</article-title><source>Nature Reviews. Genetics</source><volume>3</volume><fpage>453</fpage><lpage>461</lpage><pub-id pub-id-type="doi">10.1038/nrg819</pub-id><pub-id pub-id-type="pmid">12042772</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Koch</surname><given-names>PJ</given-names></name><name><surname>Roop</surname><given-names>DR</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>The role of keratins in epidermal development and homeostasis--going beyond the obvious</article-title><source>Journal of Investigative Dermatology</source><volume>123</volume><fpage>x</fpage><lpage>0</lpage><pub-id pub-id-type="doi">10.1111/j.0022-202X.2004.23495.x</pub-id><pub-id pub-id-type="pmid">15482464</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Nicole</surname><given-names>LD</given-names></name></person-group><person-group person-group-type="author"><name><surname>Chaya</surname><given-names>K</given-names></name></person-group><year iso-8601-date="1991">1991</year><source>The Neural Crest</source><edition>2nd edn</edition><publisher-name>Cambridge University Press</publisher-name><pub-id pub-id-type="isbn">9780521620109</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lebrecht</surname><given-names>D</given-names></name><name><surname>Foehr</surname><given-names>M</given-names></name><name><surname>Smith</surname><given-names>E</given-names></name><name><surname>Lopes</surname><given-names>FJ</given-names></name><name><surname>Vanario-Alonso</surname><given-names>CE</given-names></name><name><surname>Reinitz</surname><given-names>J</given-names></name><name><surname>Burz</surname><given-names>DS</given-names></name><name><surname>Hanes</surname><given-names>SD</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Bicoid cooperative DNA binding is critical for embryonic patterning in Drosophila</article-title><source>PNAS</source><volume>102</volume><fpage>13176</fpage><lpage>13181</lpage><pub-id pub-id-type="doi">10.1073/pnas.0506462102</pub-id><pub-id pub-id-type="pmid">16150708</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>CL</given-names></name><name><surname>Li</surname><given-names>KC</given-names></name><name><surname>Wu</surname><given-names>D</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Luo</surname><given-names>H</given-names></name><name><surname>Zhao</surname><given-names>JR</given-names></name><name><surname>Wang</surname><given-names>SS</given-names></name><name><surname>Sun</surname><given-names>MM</given-names></name><name><surname>Lu</surname><given-names>YJ</given-names></name><name><surname>Zhong</surname><given-names>YQ</given-names></name><name><surname>Hu</surname><given-names>XY</given-names></name><name><surname>Hou</surname><given-names>R</given-names></name><name><surname>Zhou</surname><given-names>BB</given-names></name><name><surname>Bao</surname><given-names>L</given-names></name><name><surname>Xiao</surname><given-names>HS</given-names></name><name><surname>Zhang</surname><given-names>X</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Somatosensory neuron types identified by high-coverage single-cell RNA-sequencing and functional heterogeneity</article-title><source>Cell Research</source><volume>26</volume><fpage>83</fpage><lpage>102</lpage><pub-id pub-id-type="doi">10.1038/cr.2015.149</pub-id><pub-id pub-id-type="pmid">26691752</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>L</given-names></name><name><surname>Song</surname><given-names>L</given-names></name><name><surname>Liu</surname><given-names>C</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Peng</surname><given-names>G</given-names></name><name><surname>Wang</surname><given-names>R</given-names></name><name><surname>Liu</surname><given-names>P</given-names></name><name><surname>Tang</surname><given-names>K</given-names></name><name><surname>Rossant</surname><given-names>J</given-names></name><name><surname>Jing</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Ectodermal progenitors derived from epiblast stem cells by inhibition of nodal signaling</article-title><source>Journal of Molecular Cell Biology</source><volume>7</volume><fpage>455</fpage><lpage>465</lpage><pub-id pub-id-type="doi">10.1093/jmcb/mjv030</pub-id><pub-id pub-id-type="pmid">25990320</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lindsley</surname><given-names>RC</given-names></name><name><surname>Gill</surname><given-names>JG</given-names></name><name><surname>Kyba</surname><given-names>M</given-names></name><name><surname>Murphy</surname><given-names>TL</given-names></name><name><surname>Murphy</surname><given-names>KM</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Canonical Wnt signaling is required for development of embryonic stem cell-derived mesoderm</article-title><source>Development</source><volume>133</volume><fpage>3787</fpage><lpage>3796</lpage><pub-id pub-id-type="doi">10.1242/dev.02551</pub-id><pub-id pub-id-type="pmid">16943279</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lumelsky</surname><given-names>N</given-names></name><name><surname>Blondel</surname><given-names>O</given-names></name><name><surname>Laeng</surname><given-names>P</given-names></name><name><surname>Velasco</surname><given-names>I</given-names></name><name><surname>Ravin</surname><given-names>R</given-names></name><name><surname>McKay</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Differentiation of embryonic stem cells to insulin-secreting structures similar to pancreatic islets</article-title><source>Science</source><volume>292</volume><fpage>1389</fpage><lpage>1394</lpage><pub-id pub-id-type="doi">10.1126/science.1058866</pub-id><pub-id pub-id-type="pmid">11326082</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Machta</surname><given-names>BB</given-names></name><name><surname>Chachra</surname><given-names>R</given-names></name><name><surname>Transtrum</surname><given-names>MK</given-names></name><name><surname>Sethna</surname><given-names>JP</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Parameter space compression underlies emergent theories and predictive models</article-title><source>Science</source><volume>342</volume><fpage>604</fpage><lpage>607</lpage><pub-id pub-id-type="doi">10.1126/science.1238723</pub-id><pub-id pub-id-type="pmid">24179222</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Macosko</surname><given-names>EZ</given-names></name><name><surname>Basu</surname><given-names>A</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name><name><surname>Nemesh</surname><given-names>J</given-names></name><name><surname>Shekhar</surname><given-names>K</given-names></name><name><surname>Goldman</surname><given-names>M</given-names></name><name><surname>Tirosh</surname><given-names>I</given-names></name><name><surname>Bialas</surname><given-names>AR</given-names></name><name><surname>Kamitaki</surname><given-names>N</given-names></name><name><surname>Martersteck</surname><given-names>EM</given-names></name><name><surname>Trombetta</surname><given-names>JJ</given-names></name><name><surname>Weitz</surname><given-names>DA</given-names></name><name><surname>Sanes</surname><given-names>JR</given-names></name><name><surname>Shalek</surname><given-names>AK</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name><name><surname>McCarroll</surname><given-names>SA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Highly parallel Genome-wide expression profiling of individual cells using nanoliter droplets</article-title><source>Cell</source><volume>161</volume><fpage>1202</fpage><lpage>1214</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id><pub-id pub-id-type="pmid">26000488</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maetschke</surname><given-names>SR</given-names></name><name><surname>Ragan</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Characterizing Cancer subtypes as attractors of hopfield networks</article-title><source>Bioinformatics</source><volume>30</volume><fpage>1273</fpage><lpage>1279</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btt773</pub-id><pub-id pub-id-type="pmid">24407221</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Merrill</surname><given-names>BJ</given-names></name><name><surname>Pasolli</surname><given-names>HA</given-names></name><name><surname>Polak</surname><given-names>L</given-names></name><name><surname>Rendl</surname><given-names>M</given-names></name><name><surname>García-García</surname><given-names>MJ</given-names></name><name><surname>Anderson</surname><given-names>KV</given-names></name><name><surname>Fuchs</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Tcf3: a transcriptional regulator of Axis induction in the early embryo</article-title><source>Development</source><volume>131</volume><fpage>263</fpage><lpage>274</lpage><pub-id pub-id-type="doi">10.1242/dev.00935</pub-id><pub-id pub-id-type="pmid">14668413</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakanishi</surname><given-names>M</given-names></name><name><surname>Kurisaki</surname><given-names>A</given-names></name><name><surname>Hayashi</surname><given-names>Y</given-names></name><name><surname>Warashina</surname><given-names>M</given-names></name><name><surname>Ishiura</surname><given-names>S</given-names></name><name><surname>Kusuda-Furue</surname><given-names>M</given-names></name><name><surname>Asashima</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Directed induction of anterior and posterior primitive streak by wnt from embryonic stem cells cultured in a chemically defined serum-free medium</article-title><source>The FASEB Journal</source><volume>23</volume><fpage>114</fpage><lpage>122</lpage><pub-id pub-id-type="doi">10.1096/fj.08-111203</pub-id><pub-id pub-id-type="pmid">18809738</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nichols</surname><given-names>J</given-names></name><name><surname>Smith</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Naive and primed pluripotent states</article-title><source>Cell Stem Cell</source><volume>4</volume><fpage>487</fpage><lpage>492</lpage><pub-id pub-id-type="doi">10.1016/j.stem.2009.05.015</pub-id><pub-id pub-id-type="pmid">19497275</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paul</surname><given-names>F</given-names></name><name><surname>Arkin</surname><given-names>Y</given-names></name><name><surname>Giladi</surname><given-names>A</given-names></name><name><surname>Jaitin</surname><given-names>DA</given-names></name><name><surname>Kenigsberg</surname><given-names>E</given-names></name><name><surname>Keren-Shaul</surname><given-names>H</given-names></name><name><surname>Winter</surname><given-names>D</given-names></name><name><surname>Lara-Astiaso</surname><given-names>D</given-names></name><name><surname>Gury</surname><given-names>M</given-names></name><name><surname>Weiner</surname><given-names>A</given-names></name><name><surname>David</surname><given-names>E</given-names></name><name><surname>Cohen</surname><given-names>N</given-names></name><name><surname>Lauridsen</surname><given-names>FK</given-names></name><name><surname>Haas</surname><given-names>S</given-names></name><name><surname>Schlitzer</surname><given-names>A</given-names></name><name><surname>Mildner</surname><given-names>A</given-names></name><name><surname>Ginhoux</surname><given-names>F</given-names></name><name><surname>Jung</surname><given-names>S</given-names></name><name><surname>Trumpp</surname><given-names>A</given-names></name><name><surname>Porse</surname><given-names>BT</given-names></name><name><surname>Tanay</surname><given-names>A</given-names></name><name><surname>Amit</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Transcriptional heterogeneity and lineage commitment in myeloid progenitors</article-title><source>Cell</source><volume>163</volume><fpage>1663</fpage><lpage>1677</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.11.013</pub-id><pub-id pub-id-type="pmid">26627738</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pevny</surname><given-names>LH</given-names></name><name><surname>Sockanathan</surname><given-names>S</given-names></name><name><surname>Placzek</surname><given-names>M</given-names></name><name><surname>Lovell-Badge</surname><given-names>R</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>A role for SOX1 in neural determination</article-title><source>Development</source><volume>125</volume><fpage>1967</fpage><lpage>1978</lpage><pub-id pub-id-type="pmid">9550729</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Power</surname><given-names>MA</given-names></name><name><surname>Tam</surname><given-names>PP</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Onset of Gastrulation, morphogenesis and somitogenesis in mouse embryos displaying compensatory growth</article-title><source>Anatomy and Embryology</source><volume>187</volume><fpage>493</fpage><lpage>504</lpage><pub-id pub-id-type="doi">10.1007/BF00174425</pub-id><pub-id pub-id-type="pmid">8342794</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Reyon</surname><given-names>D</given-names></name><name><surname>Tsai</surname><given-names>SQ</given-names></name><name><surname>Khayter</surname><given-names>C</given-names></name><name><surname>Foden</surname><given-names>JA</given-names></name><name><surname>Sander</surname><given-names>JD</given-names></name><name><surname>Joung</surname><given-names>JK</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>FLASH assembly of TALENs for high-throughput genome editing</article-title><source>Nature Biotechnology</source><volume>30</volume><fpage>460</fpage><lpage>465</lpage><pub-id pub-id-type="doi">10.1038/nbt.2170</pub-id><pub-id pub-id-type="pmid">22484455</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roccio</surname> <given-names>M</given-names></name><name><surname>Schmitter</surname><given-names>D</given-names></name><name><surname>Knobloch</surname><given-names>M</given-names></name><name><surname>Okawa</surname><given-names>Y</given-names></name><name><surname>Sage</surname><given-names>D</given-names></name><name><surname>Lutolf</surname><given-names>MP</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Predicting stem cell fate changes by differential cell cycle progression patterns</article-title><source>Development</source><volume>140</volume><fpage>459</fpage><lpage>470</lpage><pub-id pub-id-type="doi">10.1242/dev.086215</pub-id><pub-id pub-id-type="pmid">23193167</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rojas</surname><given-names>A</given-names></name><name><surname>De Val</surname><given-names>S</given-names></name><name><surname>Heidt</surname><given-names>AB</given-names></name><name><surname>Xu</surname><given-names>SM</given-names></name><name><surname>Bristow</surname><given-names>J</given-names></name><name><surname>Black</surname><given-names>BL</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Gata4 expression in lateral mesoderm is downstream of BMP4 and is activated directly by forkhead and GATA transcription factors through a distal enhancer element</article-title><source>Development</source><volume>132</volume><fpage>3405</fpage><lpage>3417</lpage><pub-id pub-id-type="doi">10.1242/dev.01913</pub-id><pub-id pub-id-type="pmid">15987774</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saadatpour</surname><given-names>A</given-names></name><name><surname>Guo</surname><given-names>G</given-names></name><name><surname>Orkin</surname><given-names>SH</given-names></name><name><surname>Yuan</surname><given-names>G-C</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Characterizing heterogeneity in leukemic cells using single-cell gene expression analysis</article-title><source>Genome Biology</source><volume>15</volume><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="doi">10.1186/s13059-014-0525-9</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sansom</surname><given-names>SN</given-names></name><name><surname>Griffiths</surname><given-names>DS</given-names></name><name><surname>Faedo</surname><given-names>A</given-names></name><name><surname>Kleinjan</surname><given-names>DJ</given-names></name><name><surname>Ruan</surname><given-names>Y</given-names></name><name><surname>Smith</surname><given-names>J</given-names></name><name><surname>van Heyningen</surname><given-names>V</given-names></name><name><surname>Rubenstein</surname><given-names>JL</given-names></name><name><surname>Livesey</surname><given-names>FJ</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The level of the transcription factor Pax6 is essential for controlling the balance between neural stem cell self-renewal and neurogenesis</article-title><source>PLoS Genetics</source><volume>5</volume><elocation-id>e1000511</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1000511</pub-id><pub-id pub-id-type="pmid">19521500</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Satija</surname><given-names>R</given-names></name><name><surname>Farrell</surname><given-names>JA</given-names></name><name><surname>Gennert</surname><given-names>D</given-names></name><name><surname>Schier</surname><given-names>AF</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Spatial reconstruction of single-cell gene expression data</article-title><source>Nature Biotechnology</source><volume>33</volume><fpage>495</fpage><lpage>502</lpage><pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Segal</surname><given-names>E</given-names></name><name><surname>Widom</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>From DNA sequence to transcriptional behaviour: a quantitative approach</article-title><source>Nature Reviews Genetics</source><volume>10</volume><fpage>443</fpage><lpage>456</lpage><pub-id pub-id-type="doi">10.1038/nrg2591</pub-id><pub-id pub-id-type="pmid">19506578</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spitz</surname><given-names>F</given-names></name><name><surname>Furlong</surname><given-names>EE</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Transcription factors: from enhancer binding to developmental control</article-title><source>Nature Reviews Genetics</source><volume>13</volume><fpage>613</fpage><lpage>626</lpage><pub-id pub-id-type="doi">10.1038/nrg3207</pub-id><pub-id pub-id-type="pmid">22868264</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Streit</surname><given-names>A</given-names></name><name><surname>Stern</surname><given-names>CD</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Neural induction. A bird's eye view</article-title><source>Trends in Genetics</source><volume>15</volume><fpage>20</fpage><lpage>24</lpage><pub-id pub-id-type="doi">10.1016/S0168-9525(98)01620-5</pub-id><pub-id pub-id-type="pmid">10087929</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sumi</surname><given-names>T</given-names></name><name><surname>Tsuneyoshi</surname><given-names>N</given-names></name><name><surname>Nakatsuji</surname><given-names>N</given-names></name><name><surname>Suemori</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Defining early lineage specification of human embryonic stem cells by the orchestrated balance of canonical wnt/beta-catenin, activin/Nodal and BMP signaling</article-title><source>Development</source><volume>135</volume><fpage>2969</fpage><lpage>2979</lpage><pub-id pub-id-type="doi">10.1242/dev.021121</pub-id><pub-id pub-id-type="pmid">18667462</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tada</surname><given-names>S</given-names></name><name><surname>Era</surname><given-names>T</given-names></name><name><surname>Furusawa</surname><given-names>C</given-names></name><name><surname>Sakurai</surname><given-names>H</given-names></name><name><surname>Nishikawa</surname><given-names>S</given-names></name><name><surname>Kinoshita</surname><given-names>M</given-names></name><name><surname>Nakao</surname><given-names>K</given-names></name><name><surname>Chiba</surname><given-names>T</given-names></name><name><surname>Nishikawa</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Characterization of mesendoderm: a diverging point of the definitive endoderm and mesoderm in embryonic stem cell differentiation culture</article-title><source>Development</source><volume>132</volume><fpage>4363</fpage><lpage>4374</lpage><pub-id pub-id-type="doi">10.1242/dev.02005</pub-id><pub-id pub-id-type="pmid">16141227</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tam</surname><given-names>PP</given-names></name><name><surname>Loebel</surname><given-names>DA</given-names></name><name><surname>Tanaka</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Building the mouse gastrula: signals, asymmetry and lineages</article-title><source>Current Opinion in Genetics &amp; Development</source><volume>16</volume><fpage>419</fpage><lpage>425</lpage><pub-id pub-id-type="doi">10.1016/j.gde.2006.06.008</pub-id><pub-id pub-id-type="pmid">16793258</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tesar</surname><given-names>PJ</given-names></name><name><surname>Chenoweth</surname><given-names>JG</given-names></name><name><surname>Brook</surname><given-names>FA</given-names></name><name><surname>Davies</surname><given-names>TJ</given-names></name><name><surname>Evans</surname><given-names>EP</given-names></name><name><surname>Mack</surname><given-names>DL</given-names></name><name><surname>Gardner</surname><given-names>RL</given-names></name><name><surname>McKay</surname><given-names>RD</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>New cell lines from mouse epiblast share defining features with human embryonic stem cells</article-title><source>Nature</source><volume>448</volume><fpage>196</fpage><lpage>199</lpage><pub-id pub-id-type="doi">10.1038/nature05972</pub-id><pub-id pub-id-type="pmid">17597760</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thomson</surname><given-names>M</given-names></name><name><surname>Liu</surname><given-names>SJ</given-names></name><name><surname>Zou</surname><given-names>LN</given-names></name><name><surname>Smith</surname><given-names>Z</given-names></name><name><surname>Meissner</surname><given-names>A</given-names></name><name><surname>Ramanathan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Pluripotency factors in embryonic stem cells regulate differentiation into germ layers</article-title><source>Cell</source><volume>145</volume><fpage>875</fpage><lpage>889</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2011.05.017</pub-id><pub-id pub-id-type="pmid">21663792</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tibshirani</surname><given-names>R</given-names></name><name><surname>Walther</surname><given-names>G</given-names></name><name><surname>Hastie</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Estimating the number of clusters in a data set via the gap statistic</article-title><source>Journal of the Royal Statistical Society: Series B</source><volume>63</volume><fpage>411</fpage><lpage>423</lpage><pub-id pub-id-type="doi">10.1111/1467-9868.00293</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trapnell</surname><given-names>C</given-names></name><name><surname>Cacchiarelli</surname><given-names>D</given-names></name><name><surname>Grimsby</surname><given-names>J</given-names></name><name><surname>Pokharel</surname><given-names>P</given-names></name><name><surname>Li</surname><given-names>S</given-names></name><name><surname>Morse</surname><given-names>M</given-names></name><name><surname>Lennon</surname><given-names>NJ</given-names></name><name><surname>Livak</surname><given-names>KJ</given-names></name><name><surname>Mikkelsen</surname><given-names>TS</given-names></name><name><surname>Rinn</surname><given-names>JL</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title><source>Nature Biotechnology</source><volume>32</volume><fpage>381</fpage><lpage>386</lpage><pub-id pub-id-type="doi">10.1038/nbt.2859</pub-id><pub-id pub-id-type="pmid">24658644</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van der Maaten</surname><given-names>L</given-names></name><name><surname>Hinton</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Visualizing data using t-SNE</article-title><source>Journal of Machine Learning Research</source><volume>9</volume><fpage>2579</fpage><lpage>2605</lpage></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogel-Ciernia</surname><given-names>A</given-names></name><name><surname>Wood</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Neuron-specific chromatin remodeling: a missing link in epigenetic mechanisms underlying synaptic plasticity, memory, and intellectual disability disorders</article-title><source>Neuropharmacology</source><volume>80</volume><fpage>18</fpage><lpage>27</lpage><pub-id pub-id-type="doi">10.1016/j.neuropharm.2013.10.002</pub-id><pub-id pub-id-type="pmid">24140580</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Watabe</surname><given-names>T</given-names></name><name><surname>Miyazono</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Roles of TGF-beta family signaling in stem cell renewal and differentiation</article-title><source>Cell Research</source><volume>19</volume><fpage>103</fpage><lpage>115</lpage><pub-id pub-id-type="doi">10.1038/cr.2008.323</pub-id><pub-id pub-id-type="pmid">19114993</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname><given-names>PA</given-names></name><name><surname>Hemmati-Brivanlou</surname><given-names>A</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Induction of epidermis and inhibition of neural fate by Bmp-4</article-title><source>Nature</source><volume>376</volume><fpage>331</fpage><lpage>333</lpage><pub-id pub-id-type="doi">10.1038/376331a0</pub-id><pub-id pub-id-type="pmid">7630398</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ying</surname><given-names>QL</given-names></name><name><surname>Smith</surname><given-names>AG</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Defined conditions for neural commitment and differentiation</article-title><source>Methods in Enzymology</source><volume>365</volume><fpage>327</fpage><lpage>341</lpage><pub-id pub-id-type="doi">10.1016/s0076-6879(03)65023-8</pub-id><pub-id pub-id-type="pmid">14696356</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ying</surname><given-names>QL</given-names></name><name><surname>Wray</surname><given-names>J</given-names></name><name><surname>Nichols</surname><given-names>J</given-names></name><name><surname>Batlle-Morera</surname><given-names>L</given-names></name><name><surname>Doble</surname><given-names>B</given-names></name><name><surname>Woodgett</surname><given-names>J</given-names></name><name><surname>Cohen</surname><given-names>P</given-names></name><name><surname>Smith</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>The ground state of embryonic stem cell self-renewal</article-title><source>Nature</source><volume>453</volume><fpage>519</fpage><lpage>523</lpage><pub-id pub-id-type="doi">10.1038/nature06968</pub-id><pub-id pub-id-type="pmid">18497825</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Young</surname><given-names>RA</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Control of the embryonic stem cell state</article-title><source>Cell</source><volume>144</volume><fpage>940</fpage><lpage>954</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2011.01.032</pub-id><pub-id pub-id-type="pmid">21414485</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Q</given-names></name><name><surname>Chipperfield</surname><given-names>H</given-names></name><name><surname>Melton</surname><given-names>DA</given-names></name><name><surname>Wong</surname><given-names>WH</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>A gene regulatory network in mouse embryonic stem cells</article-title><source>PNAS</source><volume>104</volume><fpage>16438</fpage><lpage>16443</lpage><pub-id pub-id-type="doi">10.1073/pnas.0701014104</pub-id><pub-id pub-id-type="pmid">17940043</pub-id></element-citation></ref></ref-list></back><sub-article article-type="article-commentary" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.20487.025</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Yosef</surname><given-names>Nir</given-names></name><role>Reviewing editor</role><aff><institution>University of California</institution>, <country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Dynamics of differentiation inferred from single-cell RNA-seq show a series of transitions through discrete cell states&quot; for consideration by <italic>eLife</italic>. Your article has been favorably evaluated by Arup Chakraborty (Senior Editor) and three reviewers, one of whom, Nir Yosef (Reviewer #1) served as Guest editor. Jacob H. Hanna (Reviewer #3) agreed to share his identity.</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>In their manuscript, Jang et al. propose, test, and validate a statistical framework for analyzing single-cell transcriptomics data from mouse embryonic stem (mES) cell differentiation. The first part of the analysis relies on a companion manuscript, which presented a combined method for clustering and lineage inference of single cells. By applying this method on data from multiple mouse ES subject to short inductive differentiation protocols, the authors identify several cell states, the genes that mark these states, and the genes that capture state transitions. Within these clusters of cells, the authors assert there is little variation, thus defining discrete cell states along mES cell differentiation. They then cluster the genes into modules and use the Hopfield model to identify patterns of dependencies between modules that give rise to the observed clusters as steady states. With this analysis they provide and validate three hypotheses about possible &quot;rewiring&quot; at different stages (i.e. when the effect of perturbing gene X on gene Y varies between cell states).</p><p>Essential revisions:</p><p>Overall, the reviewers find the methodology developed in this paper interesting, and of potential impact. However, there are several key points that need to be addressed in order to fully support the validity of this methodology and to understand its intricacies.</p><p>1) Single cell data quality:</p><p>1.1) Based on the data in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1E</xref>, there seems to be a fairly large variation in the percentage of reads aligning to the transcriptome on a cluster to cluster basis. Do any of the lineages correlate with the percentage of transcriptome or genome reads? What is the significance of the differences between the clusters, like C0 and C3 for example?</p><p>1.2) More generally, we are missing a description of how was the RNA-seq data normalized. In many cases when scRNA-seq data is not normalized, we see technical factors that confound the data, and library quality can dominate clustering and dimensionality reduction. Please provide evidence that this is not the case or correct accordingly.</p><p>2) Clustering and lineage detection algorithm:</p><p>2.1) For their clustering analysis, the authors limit their focus to transcription factors. While they provide off-hand reasoning for this, it is insufficient. Transcription factors (TFs), just like any other transcript, undergo stochastic, burst-like kinetics, and are subject to high amount of variation (esp. given their typically moderate expression). Additionally, it is not a given that measuring TF mRNA, rather than a TF's downstream targets, accurately depicts the circuitry involved in cellular response or differentiation. The authors should demonstrate the effects of including genes other than transcription factors on the clustering results. Relatedly, they later include signaling molecules without a rationale for the shift.</p><p>2.2) The nature of the clustering method in which only three clusters of cells are considered at a time inherently limits the hierarchy produced by the author's Bayesian framework (see <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>, right). In this way, the final lineage tree is limited only to branching into two arms at any given differentiation step. Thus, any differentiation program that produces more than two offspring would not be properly modeled. The authors should address this limitation in their framework.</p><p>3) Application to ESC:</p><p>3.1) The parameters used for the Bayesian framework from the co-submission are missing. What is the cutoff for a triplet to count as a &quot;transition&quot; event? what is a cutoff for a gene to be defined as a &quot;marker&quot; or &quot;transition&quot; gene? What is the termination/ convergence condition?</p><p>3.2) Since the algorithm is iterative, it might be very sensitive to slight variations in initial conditions or the parameters. In standard EM applications, a common practice is to start from many starting conditions. The authors should provide an estimate of how sensitive are the results for the algorithm's parameters (e.g., probability cutoffs) and how sensitive they are for sub-sampling of cells or genes (i.e., going beyond changing the seed set of clusters, which the authors have already done).</p><p>3.3) The results in <xref ref-type="fig" rid="fig2">Figure 2B-E</xref>, and especially the comparison of 2B vs. 2D are somewhat tautological. It is not clear to me what these figure panels are supposed to show that we don't already know form the definition of the process applied for choosing those genes.</p><p>3.4) What is the relationship between the experimental conditions (time/ stimulation; <xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>) and the inferred clusters? This point is potentially crucial for interpreting the meaning of the clusters and should be discussed.</p><p>3.5) We are missing a direct and less engineered view that will help evaluate and digest the clustering results. Specifically – please provide a global heat map figure with all gene used for the final clustering (possibly stratified according to their role as transitions or markers in different parts of the tree) vs. all cells (organized by clusters). This will also help support the statement in the first paragraph of the subsection “Differentiation occurs through a series of discrete cell state transitions”.</p><p>3.6) The authors claim that gene expression within each cell cluster does not significantly vary. They validate this by comparing the magnitude of the variance explained by the first PC to the that of the first PC from 1000 sets of randomized data (FYI – unclear how 3B shows lack of significance). Why don't the authors compare the percent variance described by the first PC of each cluster to the percent variance described by first PC of randomized data?</p><p>3.7) Can the authors identify early primordial germ cell sub-population (e.g. BLIMP1+, T+, TFAP2C+ cells)? Is it discrete or is it perhaps &quot;hiding&quot; in one of their progenitor populations (e.g. mesendodermal cells)?</p><p>4) Validation of results:</p><p>4.1) The selection of genes in <xref ref-type="fig" rid="fig3">Figure 3D</xref> (immunostaining) seem somewhat biased to well-studied markers (shown in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>). Therefore, these results provide a somewhat weak support for the cell states inferred form the single cell data.</p><p>4.2) In the subsection “A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations” the authors mention that they &quot;categorized the 184 marker and transition genes and signaling gene groups into 23 gene modules&quot;. However, in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref> it seems that the number of transition/ marker genes should be around 800. Also, it is not clear how were the signaling genes selected (since the analysis up to this point focused on transcription factors). Please clarify these points.</p><p>5) Network analysis:</p><p>5.1) The use of Hopfield model is a nice idea, however the presentation in <xref ref-type="fig" rid="fig4">Figure 4A</xref> is somewhat illegible, and it is hard to evaluate the stability of the model (or parts thereof) across the 10k solutions. Please provide a more convenient way to estimate the inferred magnitude and noise for the models parameters. For instance, a scatter plot of parameters showing mean vs. fano factor across the 10,000 solutions; and for a few selected of parameters, the complete empirical distribution.</p><p>5.2) How were the gene modules discretized? The explanation in the subsection “1. Determination of gene modules” is insufficient. Specifically – which cutoffs were used? How was gene drop-out taken into account?</p><p>5.3) The derivation of the hypotheses (subsection “A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations”, seventh paragraph) is not defined rigorously. Please describe clearly – what is &quot;effective interaction strength&quot;? How do we decide when &quot;[X] levels are more stable to [Y] overexpression&quot;? Specifically – which statistical cutoffs were used? What is the false discovery rate? How many other, additional hypotheses with a similar FDR can be derived using the same procedure?</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.20487.026</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><p><italic>Essential revisions:</italic> </p><p><italic>Overall, the reviewers find the methodology developed in this paper interesting, and of potential impact. However, there are several key points that need to be addressed in order to fully support the validity of this methodology and to understand its intricacies.</italic> </p><p>We would like to thank the Senior and Reviewing Editors and the peer reviewers for their thoughtful comments and suggestions. The feedback and suggestions have greatly improved our manuscript as well as strengthened our conclusions. We have considered each comment and have amended the manuscript to add 3 new figure supplements (20 new subfigures), as well as edited the text as noted in the detailed responses below.</p><p><italic>1) Single cell data quality:</italic> </p><p><italic>1.1) Based on the data in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1E</xref>, there seems to be a fairly large variation in the percentage of reads aligning to the transcriptome on a cluster to cluster basis. Do any of the lineages correlate with the percentage of transcriptome or genome reads? What is the significance of the differences between the clusters, like C0 and C3 for example?</italic> </p><p>As the reviewers pointed out, there is a large amount of variation in the total UMI number across cells. Because of this variation and the potential biases it can create, we subsampled an equal number of 20,000 UMI for all 288 cells, and running all subsequent analyses on this subsampled data set. We added a sub-figure (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1K</xref>) to show that following subsampling of UMI’s, cells do not show correlations with one another based on the total number of UMI they had prior to subsampling.</p><p><italic>1.2) More generally, we are missing a description of how was the RNA-seq data normalized. In many cases when scRNA-seq data is not normalized, we see technical factors that confound the data, and library quality can dominate clustering and dimensionality reduction. Please provide evidence that this is not the case or correct accordingly.</italic> </p><p>We have added in a sentence (end of subsection “Acquiring single-cell transcriptomics data during early differentiation”) explicitly stating that we normalize our RNA-seq data by subsampling 20,000 UMI’s per cell, for all 288 cells.</p><p><italic>2) Clustering and lineage detection algorithm:</italic> </p><p><italic>2.1) For their clustering analysis, the authors limit their focus to transcription factors. While they provide off-hand reasoning for this, it is insufficient. Transcription factors (TFs), just like any other transcript, undergo stochastic, burst-like kinetics, and are subject to high amount of variation (esp. given their typically moderate expression). Additionally, it is not a given that measuring TF mRNA, rather than a TF's downstream targets, accurately depicts the circuitry involved in cellular response or differentiation. The authors should demonstrate the effects of including genes other than transcription factors on the clustering results. Relatedly, they later include signaling molecules without a rationale for the shift.</italic> </p><p>We have added one supplementary figure in the companion manuscript by Furchtgott et al. to address this comment. We analyzed the robustness of using all genes for lineage determination in comparison to using just transcription factors (TFs) and included the results in the accompanying manuscript (Figure 1—figure supplement 2A of accompanying paper Furchtgott et al., 2016).</p><p>These figures show a histogram of the number of genes displaying a “clear minimum pattern” (i.e., one cell type within a triplet has a clear minimum expression distribution relative to those of the other two cell types) – evaluated over all TFs and all genes, respectively – from 150 known developmental topologies in B- and T-cell development (Heng et al., 2008). Triplets in which the root has the most genes showing the pattern are labeled red, and triplets in which one of the leaves has the most genes showing the pattern are in blue.</p><p>When the gene expression pattern was learned using just TFs (shown on the left side), none of the triplets with more than 10 genes displaying a “clear minimum pattern” exhibit this pattern where the minimum is in the root (no red in any histogram bar except for the leftmost). When the gene expression pattern was learned using just TFs (shown above on the left side), none of the triplets with more than 10 genes displaying a clear minimum pattern have most genes showing a clear minimum in the root (no red in any histogram bar except for the leftmost). However, when all the genes are used for the same analysis (shown above on the right side), even for triplets with a high number (up to 600) of genes showing a clear minimum pattern, a fraction of them have most of these genes showing a clear minimum in the root. This demonstrates that the clear minimum pattern is not robust when using all genes as opposed to just transcription factors.</p><p>Further, we added a new figure to this manuscript: <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3E, F</xref>, showing that including all genes for clustering/ lineage determination leads to errors in the inferred lineage tree (although the clustering configuration remains unchanged relative to when the analysis is restricted to only transcription factors). Although the tree remains the same on the mesendodermal branch, towards the bi-potent ectodermal branch the triplet relationships we obtain are different (as well as less parsimonious given the differentiation durations) from the ones we obtain when we use just the TFs.</p><p>Lastly, we now explicitly state our rationale (subsection “A probabilistic model that replicates the observed discrete cell states predicts state- 378 dependent interpretation of perturbations”, third paragraph) for adding signaling genes when modeling the gene regulatory network: that it is because our goal of modeling the gene regulatory network is to make specific predictions as to whether and how cells in different states respond differently to perturbations (i.e., <italic>signals</italic> as well as gene expression changes).</p><p><italic>2.2) The nature of the clustering method in which only three clusters of cells are considered at a time inherently limits the hierarchy produced by the author's Bayesian framework (see <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>, right). In this way, the final lineage tree is limited only to branching into two arms at any given differentiation step. Thus, any differentiation program that produces more than two offspring would not be properly modeled. The authors should address this limitation in their framework.</italic> </p><p>We thank the reviewers for bringing up this point. Our framework does <italic>not</italic> in fact inherently limit the resulting lineage tree to bifurcation fate decisions. We illustrate this point using the example in <xref ref-type="fig" rid="fig6">Author response image 1</xref>.<fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.20487.022</object-id><label>Author response image 1.</label><caption><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.20487.022">http://dx.doi.org/10.7554/eLife.20487.022</ext-link></p></caption><graphic mime-subtype="png" mimetype="image" xlink:href="elife-20487-resp-fig1-v2"/></fig></p><p>Given the set of triplets shown in <xref ref-type="fig" rid="fig6">Author response image 1</xref> (left), the only possible lineage topology is one where the yellow cell type is intermediate to all four other (purple, green, blue, pink) cell types (right). Also, in <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3C</xref>, we show an example of a lineage tree that, based on the set of most likely triplets inferred, contains a trifurcation point. Further, in the accompanying manuscript by Furchtgott et. al, the inferred lineage tree from intestinal single- cell data (Figure 3—figure supplement 2) and single-cell human brain development data (<xref ref-type="fig" rid="fig4">Figure 4</xref>) contain differentiation steps where three distinct cell types are produced from the same progenitor cell type.</p><p><italic>3) Application to ESC:</italic> </p><p><italic>3.1) The parameters used for the Bayesian framework from the co-submission are missing. What is the cutoff for a triplet to count as a &quot;transition&quot; event? what is a cutoff for a gene to be defined as a &quot;marker&quot; or &quot;transition&quot; gene? What is the termination/ convergence condition?</italic> </p><p>The probability cutoff for a triplet to count as a transition event is 0.6. For a gene to be defined as a marker or transition gene, we use a probability cutoff of 0.5. We have added these cutoffs to the manuscript (subsection “Bayesian statistical approach discovers appropriate coordinate systems to infer cell states and state transitions”, fifth paragraph). Further, since the probability cutoffs are arbitrary, in response to this and the following comment we tested our results over a range of cutoffs (see reviewer comment 3.2).</p><p>We iterated the clustering-inference procedure until the dimension of the re-clustering subspace i.e., the number of genes changed by less than 10% of the total transcription factor space. We have modified the text (in the sixth paragraph of the aforementioned subsection) to make these points clear.</p><p><italic>3.2) Since the algorithm is iterative, it might be very sensitive to slight variations in initial conditions or the parameters. In standard EM applications, a common practice is to start from many starting conditions. The authors should provide an estimate of how sensitive are the results for the algorithm's parameters (e.g., probability cutoffs) and how sensitive they are for sub-sampling of cells or genes (i.e., going beyond changing the seed set of clusters, which the authors have already done).</italic> </p><p>Following the reviewers’ suggestions, we tested the effects of using different probability cutoff values as well as subsampling cells and genes (subsection “Bayesian statistical approach discovers appropriate coordinate systems to infer cell states and state transitions”, seventh paragraph) (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>). We show that:</p><p>1) The clustering configuration and lineage tree are unchanged within a probability cutoff value range of 0.5 to 0.96 for defining “high-probability” marker and transition genes, but at a cutoff value of 0.97, both the clustering as well as lineage determination given the original clusters fails (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A and 3B</xref>), which we expect to be an effect of the number of genes used for subsequent clustering iterations becoming smaller as the probability cutoff value increases.</p><p>2) Further to demonstrating this last point, we show that while using 416 high-probability 𝑝 ≥ 0.96 transition and marker genes still results in the same clustering configuration (with the exception of a few cells, due to the stochastic nature of k- means clustering which becomes more prominent as the number of genes used for clustering becomes smaller) as well as lineage tree. However, using the 416 genes with the highest coefficient of variation across all cells fails to produce the same results but instead gives rise to a much less parsimonious lineage tree, given what we know about the differentiation conditions and duration of the individual cells (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3B</xref>).</p><p>3) Finally, we show that our results are robust to using a subset of the 288 genes: the clustering configuration as well as the lineage relationships of the individual clusters to one another remained unchanged when a) a particular cluster (C<sub>3</sub>) was removed, or b) a random subset of 144 cells were removed (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3C and 3D</xref>). Interestingly, when C<sub>3</sub> is removed, the algorithm connects the grandchildren cell types (C<sub>5</sub> and C<sub>6</sub>) to the grandmother (C<sub>1</sub>) directly.</p><p><italic>3.3) The results in <xref ref-type="fig" rid="fig2">Figure 2B-E</xref>, and especially the comparison of 2B vs. 2D are somewhat tautological. It is not clear to me what these figure panels are supposed to show that we don't already know form the definition of the process applied for choosing those genes.</italic> </p><p><xref ref-type="fig" rid="fig2">Figure 2B and 2C</xref> were intended to be mere illustrations – rather than proofs of principles – of what marker and transition genes are, respectively, although we now see how the comparison between 2B and 2D could appear tautological. Following this comment as well as the next (3.4), we decided to change <xref ref-type="fig" rid="fig2">Figure 2D</xref> to a cell-cell correlation plot of all cells using all 889 genes that were used for the final clustering and lineage determination step.</p><p><italic>3.4) What is the relationship between the experimental conditions (time/ stimulation; <xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref>) and the inferred clusters? This point is potentially crucial for interpreting the meaning of the clusters and should be discussed.</italic> </p><p><xref ref-type="supplementary-material" rid="SD3-data">Figure 2—source data 2</xref> explains how the individual cells from each of these wells described in <xref ref-type="supplementary-material" rid="SD1-data">Figure 1—source data 1</xref> cluster. We also added a subfigure (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>) to better illustrate the relationship between clusters and culture conditions, showing that cells from different culture conditions sometimes cluster together, as well as that cells exposed to the same conditions are sometimes assigned to different clusters.</p><p><italic>3.5) We are missing a direct and less engineered view that will help evaluate and digest the clustering results. Specifically – please provide a global heat map figure with all gene used for the final clustering (possibly stratified according to their role as transitions or markers in different parts of the tree) vs. all cells (organized by clusters). This will also help support the statement in the first paragraph of the subsection “Differentiation occurs through a series of discrete cell state transitions”.</italic> </p><p>We have added a heat map subfigure (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>) showing the expression levels of the 899 genes used for the final iteration of clustering and lineage determination for all 288 cells.</p><p><italic>3.6) The authors claim that gene expression within each cell cluster does not significantly vary. They validate this by comparing the magnitude of the variance explained by the first PC to the that of the first PC from 1000 sets of randomized data (FYI – unclear how 3B shows lack of significance). Why don't the authors compare the percent variance described by the first PC of each cluster to the percent variance described by first PC of randomized data?</italic> </p><p>We have added a plot showing the mean and c.v. (coefficient of variation) of percent variance explained by the first principal component (PC) of each cell cluster normalized by that of randomized data (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3B</xref>). We find that this value ranges between 1.0400 (C<sub>5</sub>) and 2.2527 (C<sub>0</sub>), with c.v.’s of ~0.01. In contrast, for all possible merged pairs of clusters, the mean and c.v. of the percent variance explained by the first PC normalized by that of randomized data were 3.2220 and 0.2967, respectively. We have referred to this new supplementary figure (subsection “Bayesian statistical approach discovers appropriate coordinate systems to infer cell states and state transitions”, tenth paragraph) in the manuscript.</p><p><italic>3.7) Can the authors identify early primordial germ cell sub-population (e.g. BLIMP1+, T+, TFAP2C+ cells)? Is it discrete or is it perhaps &quot;hiding&quot; in one of their progenitor populations (e.g. mesendodermal cells)?</italic> </p><p>We were able to identify one cell in cluster C<sub>7</sub> that has an above-background expression level of BLIMP1, T, TFAP2C, and STELLA, and although intriguing, given that it is just one cell unfortunately, it is difficult to conclude anything from this observation.</p><p><italic>4) Validation of results:</italic> </p><p><italic>4.1) The selection of genes in <xref ref-type="fig" rid="fig3">Figure 3D</xref> (immunostaining) seem somewhat biased to well-studied markers (shown in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>). Therefore, these results provide a somewhat weak support for the cell states inferred form the single cell data.</italic> </p><p>We have followed up on this comment by immunostaining day 3 and day 4 mesendodermal cells (as identified by T expression) for Etv5 and FoxA2 (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1C</xref>). Etv5 is known to be present in pluripotent cells (Akagi et al., 2015) as well as play a role in spermatogenesis (Tyagi et al., 2009), but to our knowledge it has so far not been implicated with early mesendodermal differentiation.</p><p><italic>4.2) In the subsection “A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations” the authors mention that they &quot;categorized the 184 marker and transition genes and signaling gene groups into 23 gene modules&quot;. However, in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref> it seems that the number of transition/ marker genes should be around 800. Also, it is not clear how were the signaling genes selected (since the analysis up to this point focused on transcription factors). Please clarify these points.</italic> </p><p>We have added a few sentences in the main text to address these results:</p><p>“From the 889 genes that were categorized as either marker or transition genes for all the high probability triplets, we chose genes involving only the triplets along the lineage tree. […] For instance, we did not consider the genes involving the triplet of C<sub>0</sub>, C<sub>1</sub> and C<sub>5</sub> since between C<sub>1</sub> and C<sub>5</sub> the C<sub>3</sub> cluster is skipped between C<sub>1</sub> and C<sub>5</sub>.”</p><p>“Further, because our goal was to test whether different cell states were functionally distinct (i.e., respond differently to the same signals and gene expression changes), we also noted the expression pattern of signaling factor genes belonging to FGF, WNT, LIF and BMP signaling pathways along the discovered lineage tree (shown in <xref ref-type="fig" rid="fig3">Figure 3A</xref>).”</p><p><italic>5) Network analysis:</italic> </p><p><italic>5.1) The use of Hopfield model is a nice idea, however the presentation in <xref ref-type="fig" rid="fig4">Figure 4A</xref> is somewhat illegible, and it is hard to evaluate the stability of the model (or parts thereof) across the 10k solutions. Please provide a more convenient way to estimate the inferred magnitude and noise for the models parameters. For instance, a scatter plot of parameters showing mean vs. fano factor across the 10,000 solutions; and for a few selected of parameters, the complete empirical distribution.</italic> </p><p>Following the reviewers’ suggestions, we now provide a heatmap showing the mean and c.v. of the different parameters (Jij s) across the 10,000 solutions (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>) to provide a convenient way to estimate the inferred magnitude and noise for the model parameters.</p><p><italic>5.2) How were the gene modules discretized? The explanation in the subsection “1. Determination of gene modules” is insufficient. Specifically – which cutoffs were used? How was gene drop-out taken into account?</italic> </p><p>We have added the following paragraph to clarify the discretization procedure:</p><p>“We obtained 321 transcription factors from the triplets along the tree and classify them based on their pattern across the triplets. […] This way we acquired a total of 29 modules with unique binary gene expression profiles.”</p><p>One key assumption of the model is that we can infer the underlying gene regulatory network from the genes that could be detected from the single-cell transcriptomics data. Gene dropout would result in a reduction in the number of genes within a module or a reduction in the number of gene modules. In order to explore how gene dropout would affect our model predictions, we sub-sampled the number of genes to build the Gene regulatory network by changing the probability cutoff for the transition and marker genes we considered. Although the number of gene modules changed (27 modules for a cut off of 0.7 and 24 for 0.9) we found that the models made the same qualitative predictions (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>).</p><p><italic>5.3) The derivation of the hypotheses (subsection “A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations”, seventh paragraph) is not defined rigorously. Please describe clearly – what is &quot;effective interaction strength&quot;? How do we decide when &quot;[X] levels are more stable to [Y] overexpression&quot;? Specifically – which statistical cutoffs were used? What is the false discovery rate? How many other, additional hypotheses with a similar FDR can be derived using the same procedure?</italic> </p><p>We would like to thank the reviewers for pointing this out. We have made several changes to this section in order to make it more comprehensible. We have explained the term “effective interaction strength” in the manuscript (subsection “A probabilistic model that replicates the observed discrete cell states predicts state-dependent interpretation of perturbations”, eighth paragraph).</p><p>In order to obtain the statistical cutoffs to determine &quot;[X] levels are more stable to [Y] overexpression&quot;, we randomly sampled three sets of 3333 of the 10000 models. For each set we computed the relevant quantities, such as the number of models that show downregulation of <italic>Oct4</italic> in response to <italic>Sox2</italic> overexpression, and correspondingly, for each of these quantities computed the mean and the standard error. We have added a few sentences to clarify this point (<xref ref-type="fig" rid="fig4">Figure 4</xref> captions). We have also added these error bars in <xref ref-type="fig" rid="fig4">Figure 4D, 4G and 4I</xref>.</p><p>Lastly, although our model can make large number of predictions, the eventual confirmation of these predictions can only be done through experimental validation. It is therefore beyond the scope of this manuscript to compute the false discovery rate since that would require experimentally testing hundreds of predictions.</p></body></sub-article></article>