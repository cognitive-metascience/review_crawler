<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">47676</article-id><article-id pub-id-type="doi">10.7554/eLife.47676</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Evolutionary Biology</subject></subj-group></article-categories><title-group><article-title>ASPEN, a methodology for reconstructing protein evolution with improved accuracy using ensemble models</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-138892"><name><surname>Sloutsky</surname><given-names>Roman</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0794-1255</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-138240"><name><surname>Naegle</surname><given-names>Kristen M</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-7146-9592</contrib-id><email>kmn4mj@virginia.edu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Program in Computational and Systems Biology</institution><institution>Washington University</institution><addr-line><named-content content-type="city">St. Louis</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department for Biomedical Engineering</institution><institution>Washington University</institution><addr-line><named-content content-type="city">St. Louis</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Department of Biochemistry and Molecular Biology</institution><institution>University of Massachusetts</institution><addr-line><named-content content-type="city">Amherst</named-content></addr-line><country>United States</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Center for Biological Systems Engineering</institution><institution>Washington University</institution><addr-line><named-content content-type="city">St. Louis</named-content></addr-line><country>United States</country></aff><aff id="aff5"><label>5</label><institution content-type="dept">Department of Biomedical Engineering</institution><institution>University of Virginia</institution><addr-line><named-content content-type="city">Charlottesville</named-content></addr-line><country>United States</country></aff><aff id="aff6"><label>6</label><institution content-type="dept">Center for Public Health Genomics</institution><institution>University of Virginia</institution><addr-line><named-content content-type="city">Charlottesville</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Rokas</surname><given-names>Antonis</given-names></name><role>Reviewing Editor</role><aff><institution>Vanderbilt University</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Wittkopp</surname><given-names>Patricia J</given-names></name><role>Senior Editor</role><aff><institution>University of Michigan</institution><country>United States</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>17</day><month>10</month><year>2019</year></pub-date><pub-date pub-type="collection"><year>2019</year></pub-date><volume>8</volume><elocation-id>e47676</elocation-id><history><date date-type="received" iso-8601-date="2019-04-13"><day>13</day><month>04</month><year>2019</year></date><date date-type="accepted" iso-8601-date="2019-09-19"><day>19</day><month>09</month><year>2019</year></date></history><permissions><copyright-statement>© 2019, Sloutsky and Naegle</copyright-statement><copyright-year>2019</copyright-year><copyright-holder>Sloutsky and Naegle</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-47676-v1.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.47676.001</object-id><p>Evolutionary reconstruction algorithms produce models of the evolutionary history of proteins or species. Such algorithms are highly sensitive to their inputs: the sequences used and their alignments. Here, we asked whether the variance introduced by selecting different input sequences could be used to better identify accurate evolutionary models. We subsampled from available ortholog sequences and measured the distribution of observed relationships between paralogs produced across hundreds of models inferred from the subsamples. We observed two important phenomena. First, the reproducibility of an all-sequence, single-alignment reconstruction, measured by comparing topologies inferred from 90% subsamples, directly correlates with the accuracy of that single-alignment reconstruction, producing a measurable value for something that has been traditionally unknowable. Second, topologies that are most consistent with the observations made in the ensemble are more accurate and we present a meta algorithm that exploits this property to improve model accuracy.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>protein</kwd><kwd>domains</kwd><kwd>homology</kwd><kwd>trees</kwd><kwd>ensembles</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd></kwd-group><funding-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Using different sets of input sequences to evolutionary reconstruction algorithms results in the exploration of many possible models, the intergration over which produces significantly more accurate models.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Orthology and paralogy are two forms of evolutionary homology between genetic sequences introduced by Walter Fitch (<xref ref-type="bibr" rid="bib15">Fitch, 2000</xref>; <xref ref-type="bibr" rid="bib25">Koonin, 2005</xref>) to distinguish between two modes of descent from a common ancestor. Homologs diverged through speciation are called orthologs, while those diverged through the duplication of a genomic region are called paralogs. For protein coding sequences, paralogs tend to perform related, but distinct functions (<xref ref-type="bibr" rid="bib46">Prince and Pickett, 2002</xref>; <xref ref-type="bibr" rid="bib47">Raes and Van de Peer, 2003</xref>; <xref ref-type="bibr" rid="bib13">Espinosa-Cantú et al., 2015</xref>). As a result, families of paralogous proteins provide an excellent opportunity for biochemists and molecular biologists to dissect how functionality is encoded in sequence and structure. Reconstructing histories of paralog divergence can aid tremendously in this endeavor (<xref ref-type="bibr" rid="bib65">Thomson et al., 2005</xref>; <xref ref-type="bibr" rid="bib11">Eick et al., 2012</xref>; <xref ref-type="bibr" rid="bib48">Rahman et al., 2014</xref>; <xref ref-type="bibr" rid="bib67">Wilson et al., 2015</xref>; <xref ref-type="bibr" rid="bib8">Daugherty et al., 2016</xref>; <xref ref-type="bibr" rid="bib18">Harms and Thornton, 2013</xref>). However, such reconstructions can be difficult due to a variety of factors, including, among others: the computational complexity of the problem, which scales combinatorially with the number of nodes to be reconstructed; the failure of likelihood-based approaches to adequately discriminate between topology models, especially when the amount of phylogenetic data (number of alignment columns) is small (&lt;1000 columns) (<xref ref-type="bibr" rid="bib69">Yang and Zhu, 2018</xref>); and the sensitivity of phylogenetic reconstruction to the input alignment (<xref ref-type="bibr" rid="bib41">Ogden and Rosenberg, 2006</xref>; <xref ref-type="bibr" rid="bib28">Landan and Graur, 2007</xref>; <xref ref-type="bibr" rid="bib68">Wong et al., 2008</xref>; <xref ref-type="bibr" rid="bib31">Liu et al., 2010</xref>; <xref ref-type="bibr" rid="bib66">Wang et al., 2011</xref>; <xref ref-type="bibr" rid="bib4">Blackburne et al., 2013</xref>; <xref ref-type="bibr" rid="bib58">Sievers et al., 2013</xref>). The current state-of-the-art in addressing the effect of alignment uncertainty on phylogenetic reconstruction, joint Bayesian inference of alignment and phylogeny with BAli-Phy (<xref ref-type="bibr" rid="bib50">Redelings and Suchard, 2005</xref>; <xref ref-type="bibr" rid="bib64">Suchard and Redelings, 2006</xref>), is far too computationally expensive to tackle large-scale reconstruction of paralog divergence. In this work, we propose a new framework for addressing the challenges in reconstruction of protein family divergence. Our approach takes advantage of model sensitivity to inputs to improve the accuracy of reconstruction.</p><p>We propose to reduce the complexity of reconstruction, motivated by the fact that not all ancestral nodes in protein evolution are of equal interest. Since a typical collection of input sequences contains both orthologs and paralogs, the divergence topology for these sequences contains both duplication and speciation ancestral nodes. Depending on the protein family and the number of species represented in the collection, the fraction of speciation nodes may be quite high. Reconstructing speciation history from a single protein family is of little interest aside from identifying extremely rare evolutionary events, such as horizontal gene transfer and reciprocal paralog loss, through reconciliation of the protein phylogeny with the accepted species phylogeny (<xref ref-type="bibr" rid="bib38">Nakhleh, 2013</xref>; <xref ref-type="bibr" rid="bib22">Kamneva and Ward, 2014</xref>). And yet, all speciation nodes must be inferred in order to reconstruct any duplication nodes that predate them. We propose sacrificing reconstruction of ancestral nodes of little interest to make reconstruction of ancestral nodes of greatest interest more robust.</p><p>Given any high confidence ancestral node, we can imagine &quot;factoring'' the search of topology space into two components: (a) topologies below the node in question, (b) everything else. This is not particularly helpful for phylogenetic reconstruction in general, since (a) and (b) still must be optimized jointly in order to determine the overall optimal phylogeny. However, if we were not concerned with inferring (a), we would be satisfied to integrate over the uncertainty of (a) to produce, in a sense, a marginal reconstruction of (b). Moreover, treating the root of (a) – the high confidence ancestral node – as a leaf in our reconstruction of (b), would allow us to simultaneously consider multiple sources of uncertainty in the &quot;integrated out'' reconstruction (a): the selection of specific sequences descended from that ancestor to be included in the reconstruction, the alignment of those sequences, and the uncertainty in the inference of (a), given that alignment. Here, we describe an approach for such marginal reconstruction and demonstrate it by reconstructing histories of gene duplications, using common ancestors of ortholog sets as the roots of the integrated-out clades.</p><p>We hypothesize that topology features that are robust across many phylogenetic models of divergence are more likely to be accurate and that we can use the variability of topology inference induced by sampling leaves under a set of ancestral nodes of interest to identify the topological features most consistent with robust phylogenetic signal. Testing this hypothesis requires a mechanism for capturing the uncertainty and incorporating it into phylogenetic reconstruction. Inspired by the findings of Salichos and Rokas, who showed that topologies of yeast divergence reconstructed from single genes, while rarely identical, shared much greater similarity than randomly generated topologies (<xref ref-type="bibr" rid="bib55">Salichos and Rokas, 2013</xref>), we propose a new approach based on the possibility that frequently recurring topological features are more likely to represent phylogenetic signal.</p><p>In this work, we present a framework for: 1) assessing the amount of uncertainty in the phylogenetic reconstruction of a protein family, 2) identifying topological features and determining the frequency with which they occur across reconstructions, and 3) quantifying the consistency of individual topologies with the identified features. Based on our findings, we propose an observable metric of reconstruction uncertainty, precision, which directly correlates with reconstruction accuracy. We then describe a meta-algorithm that identifies the topologies which are most consistent with topological features extracted from an ensemble of individual reconstructions. Finally, we demonstrate that for some reconstruction tasks, multiple models should be considered as equally likely, given the evidence. Our methodology, ASPEN (Accuracy through Subsampling of Protein EvolutioN), produces significantly more accurate topology models than those produced by a single-alignment reconstruction from all available sequences.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Quantifying reconstruction uncertainty with sequence subsampling</title><sec id="s2-1-1"><title>Defining protein families for testing</title><p>We tested the effectiveness of our analysis and inference framework on simulated protein families and the LacI family of bacterial transcription factors. We turned to simulated sequence data, in addition to a real protein family, for two previously noted reasons (<xref ref-type="bibr" rid="bib66">Wang et al., 2011</xref>). First, simulating evolution over known phylogenies allowed us make a quantitative assessment of reconstruction accuracy compared to the true divergence topology. Second, it allowed us to explore a range of divergence conditions by systematically varying branch lengths of input phylogenies, while controlling for other factors such as overall sequence length and the distribution of secondary structure elements and disordered loops. We simulated 600 protein families, each containing 15 paralogs represented by 66 orthologs – a total of 990 sequences. The scale of this simulation experiment allows for a broad exploration of the effects of topology and divergence time on the accuracy of phylogenetic reconstruction. For simplicity, we used the same tree with 66 species to represent each paralog, resulting in topologies reflecting a series of duplications, producing 15 paralogs in an ancestral genome, followed by speciations leading to 66 divergent genomes, each containing the same 15 paralogs.</p><p>Evolution of real protein families is rarely that neat. Speciations can predate duplications. Loss of some paralogs in some lineages can result in different collections of paralogs appearing in different genomes, dramatically complicating orthology assignments. As a result, it can be difficult to determine with a high degree of confidence, whether the leaf sequences in a clade are strictly one-to-one orthologs, or contain some paralogs. In addition, duplication events intermingled with speciation events can produce co-orthologs: many-to-one orthology relationships between genes in post-duplication and pre-duplication species (<xref ref-type="bibr" rid="bib25">Koonin, 2005</xref>). Fortunately, while we demonstrate our methodology using a simplified special case of protein family divergence, the methodology in no way relies on, or benefits from this simplification. As long as high confidence ancestral nodes can be identified, and reconstruction of the clades below those nodes can be sacrificed, the provenance of the integrated-out clades is immaterial. Therefore, the analysis based on this simulation experiment is applicable without loss of generality.</p></sec><sec id="s2-1-2"><title>Framework for generating an ensemble of topologies and quantifying uncertainty</title><p>The framework for generating reduced topologies and quantifying reconstruction uncertainty is outlined in <xref ref-type="fig" rid="fig1">Figure 1</xref>. Full topologies are reconstructed from sequence data by a combination of alignment and phylogenetic inference methods. We then extract ancestor divergence topologies, with the proposal that branch lengths can be optimized later for any combination of selected topology or collection of topologies and alignment of input sequences. Given the framework of our simulated evolution experiment, we focus on the divergence through duplication of common ancestors of orthologs, dispensing with the divergence of the individual orthologs through speciation. In principle, any ancestor of a subset of input sequences can be used, so long as that ancestor is robustly inferred under reconstruction uncertainty, including uncertainty due to input sequence selection and alignment. In our subsampling framework we define robustness as consistency of ancestor reconstruction across subsamples. In other words, most samples from a set of descendants must be monophyletic in their respective reconstructions in order to consider their common ancestor robustly inferred. We found that subsamples from all our simulated orthosets were overwhelmingly monophyletic, so our selection of ortholog common ancestors as leaves for our reconstruction was justified.</p><fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.002</object-id><label>Figure 1.</label><caption><title>Top: Framework for assessing accuracy and precision of reconstruction for simulated protein families using an ensemble of subsampled topologies.</title><p>(<bold>A</bold>) Sequence evolution was simulated over synthetic phylogenies to produce ortholog sequences (colored boxes), presenting sets of ortholog sequences (&quot;orthosets''). (<bold>B</bold>) Sequences were sampled from orthosets without replacement, aligned, and used to infer &quot;subsampled'' phylogenies. (<bold>C</bold>) An all-sequence phylogeny was inferred from an alignment of all sequences in a simulated family. The true, all-sequence, and subsampled phylogenies were pruned to orthoset common ancestors. Their branch lengths were discarded to obtain paralog divergence topologies. Modified Robinson-Foulds (<inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>) symmetric distance metric was calculated between the true and all-sequence topologies and between the all-sequence and each subsampled topology. Accuracy and precision of reconstruction for a family are defined in terms of these <inline-formula><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> distances. Bottom: (<bold>D</bold>) The 600 simulated families are ranked by their all-sequence topology accuracy and plotted according to the alignment and phylogeny inference algorithms used to infer the all-sequence phylogeny. (<bold>E</bold>) Reconstruction precision vs. accuracy of the all sequence topology for simulated families Pearson correlation coefficient between precision and accuracy is 0.91 (p-value &lt; 1e-100). Families are binned by accuracy. Tick marks on x-axis indicate bin boundaries. Dashed line indicates precision of LacI family reconstruction.</p><p><supplementary-material id="fig1sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.005</object-id><label>Figure 1—source data 1.</label><caption><title>Precision and Accuracy for synthetic protein families.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig1-data1-v1.xlsx"/></supplementary-material></p><p><supplementary-material id="fig1sdata2"><object-id pub-id-type="doi">10.7554/eLife.47676.006</object-id><label>Figure 1—source data 2.</label><caption><title>Accuracy of synthetic families for all alignment and inference procedures.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig1-data2-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig1-v1.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.47676.004</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Distributions of pairwise <inline-formula><mml:math id="inf3"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> differences between LacI topologies in the 90% (green) and 50% (blue) subsampling ensembles.</title><p><supplementary-material id="fig1s1sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.003</object-id><label>Figure 1—figure supplement 1—source data 1.</label><caption><title>Pairwise RF* distributions of LacI topologies.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig1-figsupp1-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig1-figsupp1-v1.tif"/></fig></fig-group><p>We quantified topology differences using the Robinson-Foulds symmetric distance metric (<xref ref-type="bibr" rid="bib52">Robinson and Foulds, 1981</xref>), modified to handle the occasional non-monophyletic reconstruction of an orthoset ancestor (<inline-formula><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>, Materials and methods). When an inferred topology for a synthetic family is compared to the topology over which the family was simulated, that comparison is a measure of the distance between reconstruction and truth. Therefore, we define the accuracy of a reconstruction as:<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:mtext>accuracy </mml:mtext><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo>(</mml:mo><mml:mtext>true</mml:mtext><mml:mo>,</mml:mo><mml:mtext> reconstructed</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>We refer to a topology inferred from an alignment of all available sequences as the &quot;all-sequence'' topology. This is the topology most often used when considering a single reconstruction. Using multiple representative sequence sets obtained through subsampling allows us to characterize the uncertainty of ancestor divergence reconstruction arising from selection and, critically, alignment of descendant sequences. In this work, we used two different subsampling sizes to characterize uncertainty. First, we subsampled most, but not all, of the available sequences. The comparisons of these topologies to the all-sequence topology are effectively a measure of the reproducibility of the all-sequence reconstruction given highly similar representations of descendant divergence, but under uncertainty due to input sequence alignment. We refer to this quantity as precision, defined as:<disp-formula id="equ2"><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtext>precision </mml:mtext><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>⟨</mml:mo><mml:mrow><mml:mrow/><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>all-sequence</mml:mtext><mml:mo>,</mml:mo><mml:mtext> subsampled</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mtext>Ensemble</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula>where angle brackets denote average over the ensemble of subsampled topologies. Second, we subsampled roughly half of the sequences from each orthoset to generate larger ensembles, which we used to identify topological features and quantify their consistency with the phylogenetic signal present in the sequence data. Smaller subsamples allow for faster reconstruction of each topology, in turn allowing us to generate larger ensembles, which provide greater resolution of consistency with phylogenetic signal. The distributions of pairwise <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> distances between topologies inferred with 90% and 50% subsampling tend to be centered in the same intermediate range as that observed by Salichos and Rokas for species divergence reconstructions from single yeast genes (<xref ref-type="bibr" rid="bib55">Salichos and Rokas, 2013</xref>), with the 50% ensemble allowing for a moderately broader exploration of the topology space (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). We settled on this sample size as a compromise between strength of phylogenetic signal, breadth of topology space exploration, and inference speed.</p></sec><sec id="s2-1-3"><title>Selection of alignment and phylogeny inference algorithms</title><p>Since the specific alignment and phylogenetic inference algorithms used affect reconstruction (<xref ref-type="bibr" rid="bib36">Morrison and Ellis, 1997</xref>; <xref ref-type="bibr" rid="bib37">Mugridge et al., 2000</xref>; <xref ref-type="bibr" rid="bib68">Wong et al., 2008</xref>; <xref ref-type="bibr" rid="bib66">Wang et al., 2011</xref>; <xref ref-type="bibr" rid="bib31">Liu et al., 2010</xref>; <xref ref-type="bibr" rid="bib32">Liu et al., 2011</xref>; <xref ref-type="bibr" rid="bib4">Blackburne et al., 2013</xref>), we tested all combinations of three alignment algorithms and two phylogenetic inference algorithms on the 600 simulated families, each containing 990 sequences. We used MAFFT’s L-INS-i protocol (<xref ref-type="bibr" rid="bib23">Katoh and Standley, 2013</xref>), ClustalOmega (<xref ref-type="bibr" rid="bib57">Sievers et al., 2011</xref>), and Muscle (<xref ref-type="bibr" rid="bib9">Edgar, 2004</xref>) for sequence alignment, and FastTree2 (<xref ref-type="bibr" rid="bib45">Price et al., 2010</xref>) and RAxML (<xref ref-type="bibr" rid="bib61">Stamatakis, 2014</xref>) to infer phylogenies. We compared each all-sequence topology to the true topology and found a wide diversity of accuracies across the 600 synthetic families: accuracy varied between 1, when the all-sequence topology is identical to the true topology, and 0, when <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> between the two topologies is maximal. Therefore, our test set of simulated families spans a range of difficulty, as observed by a range of inaccuracies across the families, which allows us to observe the performance of phylogenetic reconstruction as a function of that difficulty. The largest effect on accuracy came from the choice of alignment algorithm, consistent with previous studies (<xref ref-type="bibr" rid="bib36">Morrison and Ellis, 1997</xref>; <xref ref-type="bibr" rid="bib37">Mugridge et al., 2000</xref>; <xref ref-type="bibr" rid="bib68">Wong et al., 2008</xref>; <xref ref-type="bibr" rid="bib66">Wang et al., 2011</xref>; <xref ref-type="bibr" rid="bib31">Liu et al., 2010</xref>; <xref ref-type="bibr" rid="bib32">Liu et al., 2011</xref>; <xref ref-type="bibr" rid="bib4">Blackburne et al., 2013</xref>). L-INS-i alignments produced the most accurate reconstructions (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). FastTree2 and RAxML performed very similarly across all alignment algorithms, also consistent with earlier observations (<xref ref-type="bibr" rid="bib32">Liu et al., 2011</xref>). Because FastTree2 is significantly faster than RAxML, we selected the fast and accurate combination of L-INS-i and FastTree2 for all subsequent phylogeny inferences.</p></sec><sec id="s2-1-4"><title>Subsampling produces an observable measure of accuracy</title><p>We made a striking observation when we compared the reproducibility of an all-sequence tree with its accuracy. Reproducibility, expressed as precision, was measured by comparing 50 trees created from ≈90% subsamples of available sequences (<xref ref-type="fig" rid="fig1">Figure 1B,C</xref>). As shown in <xref ref-type="fig" rid="fig1">Figure 1E</xref>, precision directly correlates with accuracy (Pearson correlation coefficient of 0.91 and p-value &lt; 1e-100) – the most accurate all-sequence trees are also the most reproducible. Precision of reconstruction for the LacI family is 0.698, indicated by a dashed line in <xref ref-type="fig" rid="fig1">Figure 1E</xref>, suggesting that the reconstruction is of moderate difficulty and that the all-sequence LacI topology is not entirely accurate, in accordance with its rather low reproducibility. Due to their strong correlation, it is possible that precision – an observable quantity regardless of whether the true topology is known – can be used as a measure of the difficulty of reconstruction for a protein family and as a proxy for the accuracy of the all-sequence tree.</p><p>We wished to understand why subsampling produces a metric that is correlated with accuracy, a hidden value, and to understand the potential generalizability of this observation. To explore this further, we compared the values of the topology search objective function of topologies (log-likelihoods), given an alignment:<disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>topology</mml:mtext><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">ℒ</mml:mi><mml:mrow/></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>phylogeny </mml:mtext><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mtext> alignment</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula>by calculating the fractional log-likelihood difference between a reference topology and an alternate topology according to:<disp-formula id="equ4"><mml:math id="m4"><mml:mrow><mml:mtext>Difference </mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mtext>alternative</mml:mtext><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mtext>reference</mml:mtext><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mtext>reference</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where the reference is the topology selected by FastTree2 for the alignment in question. We used RAxML to evaluate exact likelihood, rather than the approximate likelihood used by FastTree2, because FastTree2 does not provide the functionality to evaluate its objective function without performing a topology search. We systematically compared topologies on alignments using this fractional difference in log-likelihood to effectively measure the distance between models along the likelihood landscape defined by a specific alignment.</p><p>The most immediate question we considered was whether the topology search algorithm simply failed to identify optimal topology models under its own objective function. In particular, we wondered whether this is the reason why the all-sequence alignment failed to recover the true topology for the vast majority of our synthetic families (84.2%). We compared the topologies selected by FastTree2 for all-sequence alignments (the reference topology in our formulation) to true topologies using the log-likelihood difference metric over the all-sequence alignments. A negative value would indicate that the alternate (true) topology obtained a better log-likelihood score than the reference, but the search algorithm failed to identify it. We found no such cases among our synthetic families (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). While it is reassuring that topology search reliably identified the better scoring topologies, this finding demonstrates that imperfect accuracy results from the fact that, under the substitution model, the observed differences between input sequences are more likely to have arisen by a sequence of substitutions different from the one that actually occurred when evolution was simulated. Even more surprising, the all-sequence topology scored better both under the substitution model used in phylogenetic inference <italic>and</italic> under the different model used for simulating sequence evolution (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>, and see Materials and methods for choice of substitution models). In fact, for high-precision families, the all-sequence topology scores better than the true topology, given the combination of the substitution model used in simulation and the true alignment. These findings underscore the difficulty of recovering the true topology by phylogenetic inference from short sequences, even using the substitution model under which those sequences were simulated.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.007</object-id><label>Figure 2.</label><caption><title>Histograms of log-likelihood differences (calculated using RAxML) between true and all-sequence (reference) topologies, calculated over all-sequence alignments</title><p>(<bold>A</bold>), and between all-sequence and subsampled (reference) topologies, calculated over subsampled alignments (<bold>B</bold>). Rows present subsampled and all-sequence results for different accuracy bins. Gray bars represent negative difference values in cases where the alternative topology has a higher RAxML log-likelihood than the topology inferred with FastTree2. These small differences are more likely due to differences between the RAxML and FastTree2 likelihood functions, rather than to topology search failures by FastTree2. (<bold>C</bold>) Relationship between alignment robustness, quantified by the Guidance2 sum-of-pairs score, and topology accuracy. Alignment accuracy and alignment robustness are 97% correlated, so the relationships of both quantities with topology accuracy are nearly identical. Topology precision is also plotted vs topology accuracy for comparison. Alignment robustness and topology accuracy have a Pearson correlation coefficient of 0.78, while topology precision and topology accuracy have a Pearson correlation coefficient of 0.91.</p><p><supplementary-material id="fig2sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.010</object-id><label>Figure 2—source data 1.</label><caption><title>Precision and Alignment Robustness data for all protein families.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig2-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig2-v1.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.47676.009</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Histograms of log-likelihood differences between true and all-sequence (reference) topologies, calculated over all-sequence alignments under the JTT (top panel) and WAG (bottom panel) substitution models.</title><p><supplementary-material id="fig2s1sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.008</object-id><label>Figure 2—figure supplement 1—source data 1.</label><caption><title>Log-likelihood differences between true and all-sequence topologies.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig2-figsupp1-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig2-figsupp1-v1.tif"/></fig></fig-group><p>Next, we sought to understand how reconstruction of subsampled topologies is related to the accuracy of all-sequence topologies. For a given alignment, the likelihood landscape is a hypothetical multidimensional surface produced by evaluating the likelihood function on topologies, over which the search algorithm seeks the optimal topology for that alignment. We hypothesized that altering the alignment by subsampling sequences and realigning modulates the landscape, relocating the likelihood minima to new topologies, and that the susceptibility of the landscape to such perturbations is related to the accuracy of individual reconstructions. For each subsampled alignment, we compared the subsampled (reference) topology to the all-sequence (alternate) topology using the log-likelihood difference metric. In order to calculate the likelihood of the all-sequence topology given a subsampled alignment, the all-sequence topology was pruned down to the set of leaves contained in the subsampled alignment. Unlike the all-sequence vs. true topology comparisons (<xref ref-type="fig" rid="fig2">Figure 2A</xref>), the extent of likelihood differences between subsampled and all-sequence topologies differed considerably with accuracy (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). For families with high accuracy, when precision is also high, the difference varied from 0 to 10<sup>-4</sup>, suggesting that the all-sequence topology is within the optimum well. As accuracy and precision decrease, and <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> distances between subsampled and all-sequence topologies increase, the likelihood differences also increase. The subsampling perturbation produces a greater displacement of the optimum, pushing the all-sequence topology out of the optimum well and onto a plateau, where log-likelihood scores are 10<sup>-4</sup> to 10<sup>-3</sup> worse than the optimum. Greater displacement of the optimum pushes the all-sequence topology out of the optimum well for more synthetic families, but does not increase their log-likelihood differences from the reference beyond the 10<sup>-4</sup> – 10<sup>-3</sup> range. We were surprised to discover that true topologies were always located on this plateau, outside of the optimum well on the all-sequence alignment likelihood surface (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). We suggest that the degree of optimum displacement due to resampling and realignment, captured by our precision metric, reflects the overall dispersion of plausible topology models around the true topology. This dispersion of plausible models is the result of each family’s unique divergence history, and both accuracy and precision depend on its extent, explaining why the two are strongly correlated. In other words, less accurate all-sequence topologies are inferred over surfaces more susceptible to the perturbation of input sequence selection and alignment.</p><p>Given that subsampling produces new likelihood surfaces determined by the alignments of subsampled sequences, we wished to ask whether topology reconstruction accuracy is determined by the accuracy of the input sequences alignment (compared to the true alignment produced through simulated evolution), and whether precision of topology reconstruction is determined by the robustness with which the input sequences can be aligned. If this were the case, then alignment accuracy and robustness would explain the observed precision-accuracy relationship for topology reconstruction. To test this, we measured the similarity between all-sequence and true alignments using the Guidance sum-of-pairs alignment metric (<xref ref-type="bibr" rid="bib44">Penn et al., 2010</xref>), as implemented in Guidance2 software (<xref ref-type="bibr" rid="bib56">Sela et al., 2015</xref>), and compared this to the accuracy of the topology inferred from that all-sequence alignment. Alignment accuracy is correlated with topology accuracy (Pearson correlation coefficient of 0.80), but this correlation is weaker than that between topology precision and accuracy (Pearson correlation coefficient of 0.91).</p><p>Next, we asked whether the reproducibility (robustness) of the all-sequence alignment could explain reproducibility of the inferred topology (precision). We used Guidance2 (<xref ref-type="bibr" rid="bib56">Sela et al., 2015</xref>) to determine alignment robustness and found that this is almost perfectly correlated with alignment accuracy (Pearson correlation coefficient of 0.97), but captures slightly less variance in topology accuracy (Pearson correlation coefficient between alignment robustness and topology accuracy of 0.78, <xref ref-type="fig" rid="fig2">Figure 2C</xref>). This correlation is substantially weaker than the correlation between topology precision and accuracy, driven by the extreme variability in alignment robustness when topology accuracy is high, as well as compression in the scale, compared to precision: no alignment is fully robust, yet some yield completely accurate topologies. Moreover, most of the intermediate accuracy/intermediate precision topologies are inferred from minimally robust alignments (Guidance2 sum-of-pairs score &lt; 0.4). Hence, one could rely on alignment robustness to predict the accuracy of the all-sequence alignment (also a hidden quantity) to a great extent, but that value does not reflect the accuracy of the inferred topology as well as precision of topology inference reflects topology accuracy. We believe this discrepancy is due to the fact that topology selection does not depend equally on all aligned sites (alignment columns), although identifying which sites contribute substantially is far from trivial. On the other hand, the precision of topology inference naturally incorporates alignment robustness to perturbations arising from sequence subsampling, but also incorporates the effect of alignment robustness (or lack thereof) on topology inference, resulting in a metric that is more highly correlated with topology accuracy.</p></sec></sec><sec id="s2-2"><title>Exploiting reconstruction variance to identify best trees</title><p>Next, we sought to apply our sequence subsampling framework to characterize the region of topology space throughout which subsampled topologies are dispersed, and then to use this information to reconstruct topologies that are most consistent with observations across the subsampled ensemble. We arrived at a reconstruction approach that has three parts: (1) a framework to characterize features observed across an ensemble and quantify their occurrence, (2) a scoring function that reflects the consistency of a given topology with observations across the ensemble, and (3) an algorithm that exhaustively enumerates the highest-scoring topologies according to this metric. We call this approach ASPEN, for Accuracy through Subsampling of Protein EvolutioN.</p><sec id="s2-2-1"><title>Characterizing topological features across an ensemble</title><p>First, we required a way of representing topological features observed across multiple topologies and of quantifying the occurrence of those features. Since there is no obvious way to do this using the standard acyclic graph topology representation, we turned to an alternative representation (<xref ref-type="fig" rid="fig3">Figure 3A</xref>) in terms of the number of internal nodes along the paths between every pair of leaf nodes. The two representations are equivalent (<xref ref-type="fig" rid="fig3">Figure 3C</xref>), but the pairwise path lengths representation lends itself to aggregating information across topologies in the form of a path length distribution for each leaf pair (<xref ref-type="fig" rid="fig3">Figure 3B</xref>), representing empirical probabilities of topological features. Although subsampled reconstructions of simulated orthosets were overwhelmingly monophyletic, occasional reconstructions did contain non-monophyletic ortholog arrangements. This violates an underlying assumption of search space decomposition, as well as the true topology of each simulated family. In such cases, we exclude from the distributions the lengths of any paths from the topology in question that are compromised by passing through spurious nodes resulted from non-monophyletic orthoset reconstruction. Paths from the topology which are not compromised in this way are still included. This highlights a mechanism by which poorly selected ancestors may be identified: when one or more of its putative descendants are consistently placed non-monophyletically with respect to other members of its assigned descendant set, that set’s ancestor cannot be considered high-confidence.</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.011</object-id><label>Figure 3.</label><caption><title>Method for accumulating distributions of observations by interconverting between topologies and leaf-leaf distance matrices.</title><p>(<bold>A</bold>) Conversion of a topology into a matrix of leaf-to-leaf path lengths. Sample paths <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, blue, <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, green, <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>F</mml:mi><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, violet, and <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mn>4</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, orange, are highlighted. Dots indicate internal nodes along path. (<bold>B</bold>) Each topology in an ensemble is decomposed into a matrix of leaf-to-leaf path lengths. Observed path lengths for each leaf pair are aggregated into distributions, which are used as weights by ASPEN’s log-frequency scoring function. (<bold>C</bold>) Construction of a topology from its matrix of path lengths representation. First, the matrix is transformed into a sorted list of path lengths. Construction of internal nodes is triggered by path lengths encountered traversing the list. Cursor indicates path <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> being recapitulated by construction of node <inline-formula><mml:math id="inf13"><mml:mrow><mml:mo>{</mml:mo><mml:mo>{</mml:mo><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mo>{</mml:mo><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mi>E</mml:mi><mml:mo>}</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mi>F</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. (<bold>D</bold>) The path lengths distribution for each leaf pair produces as many list entries as there were path lengths observed between those leaves. Each path length for each leaf pair has a corresponding observation frequency. These frequencies are used in the scoring function to rank reconstructed topologies.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig3-v1.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.47676.012</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Diagram of branching during ASPEN topology reconstruction.</title><p>Construction begins with the empty topology assembly on the left. Every possible extension is constructed in a copy of the initial assembly: Node <inline-formula><mml:math id="inf14"><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> completes path <inline-formula><mml:math id="inf15"><mml:mrow><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, node <inline-formula><mml:math id="inf16"><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> completes path <inline-formula><mml:math id="inf17"><mml:mrow><mml:mo>(</mml:mo><mml:mi>C</mml:mi><mml:mo>↔</mml:mo><mml:mi>D</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, and node <inline-formula><mml:math id="inf18"><mml:mrow><mml:mo>{</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> completes path <inline-formula><mml:math id="inf19"><mml:mrow><mml:mo>(</mml:mo><mml:mi>B</mml:mi><mml:mo>↔</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, branching the initial assembly into three new assemblies. Path lengths completed by the introduced node and path lengths incompatible with it are marked and not revisited. Nodes <inline-formula><mml:math id="inf20"><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf21"><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> preclude path <inline-formula><mml:math id="inf22"><mml:mrow><mml:mo>(</mml:mo><mml:mi>B</mml:mi><mml:mo>↔</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, while node <inline-formula><mml:math id="inf23"><mml:mrow><mml:mo>{</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> precludes paths <inline-formula><mml:math id="inf24"><mml:mrow><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf25"><mml:mrow><mml:mo>(</mml:mo><mml:mi>C</mml:mi><mml:mo>↔</mml:mo><mml:mi>D</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. Completed paths are shown in blue, precluded paths are greyed out in the corresponding assemblies. Intermediate topology scores are calculated according to the scoring function. On the next iteration construction paths for assemblies <inline-formula><mml:math id="inf26"><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf27"><mml:mrow><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> collide, indicated in red. A single copy of the resulting assembly, <inline-formula><mml:math id="inf28"><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mo>{</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, is retained. Assembly <inline-formula><mml:math id="inf29"><mml:mrow><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is separately extended with node <inline-formula><mml:math id="inf30"><mml:mrow><mml:mo>{</mml:mo><mml:mo>{</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. Additional construction sequences, indicated by ellipses, are not shown.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig3-figsupp1-v1.tif"/></fig></fig-group></sec><sec id="s2-2-2"><title>Scoring topologies by consistency with identified features</title><p>We can use the frequencies with which specific lengths of leaf-to-leaf paths present in a topology occur in an ensemble to reflect the consistency of that topology with observations across the ensemble, and to make comparisons between proposed topologies. ASPEN formalizes this into a scoring function expressed in terms of log-frequencies of leaf-to-leaf path lengths, <inline-formula><mml:math id="inf31"><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:msubsup><mml:mi>f</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, by summing over all pairs of leaves in the topology, according to:<disp-formula id="equ5"><label>(1)</label><mml:math id="m5"><mml:mrow><mml:mtext>score </mml:mtext><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:munder></mml:mstyle><mml:mtext> </mml:mtext><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:msubsup><mml:mi>f</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>This scoring function rewards incorporation of frequently observed path lengths and penalizes rarely observed ones.</p></sec><sec id="s2-2-3"><title>Algorithm for constructing <italic>N</italic>-best trees</title><p>Given that topologies inferred from all-sequence alignments tend to be inaccurate, increasingly so for more difficult phylogenetic inference problems (<xref ref-type="fig" rid="fig1">Figure 1D and E</xref>), ASPEN attempts to identify all likely models of divergence. Specifically, ASPEN’s objective is to identify a set of <italic>N</italic>-best topologies that are the most consistent topologies with observations across the ensemble. Given that objective, we created a branch-and-bound procedure to identify the top <italic>N</italic> topologies discussed here. A detailed description of the algorithm is available in Materials and methods. Briefly, branching occurs when a partially constructed topology can be extended by multiple internal nodes. An internal node is permitted as an extension only if every pairwise path completed by the proposed node (<xref ref-type="fig" rid="fig3">Figure 3C</xref>) appears among the observed path lengths on the list derived from the matrix representation of the subsampled topology ensemble (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). Every possible extension is realized in a separate extended topology. Construction of internal nodes is triggered to recapitulate path lengths encountered in traversing the list. Since the number of topologies that might be constructed by this branching can be very large, even given the constraints of ensemble observations, we use bounding to limit construction to the <italic>N</italic> best-scoring topologies. Bounding occurs by checking whether a partially constructed topology might be completed with a better score than the current <italic>N</italic>th-best completed topology. If this is not possible, the partially constructed topology is discarded, bounding all branched construction paths by which it could have been extended. Upon completion of the branch-and-bound procedure, ASPEN will have identified and ranked the <italic>N</italic>-best topologies, according to their consistency with observations from the ensemble of topologies created by subsampling available sequences.</p></sec></sec><sec id="s2-3"><title>Evaluation of ASPEN reconstructions</title><p>To test the accuracy of ASPEN reconstructions, we used the outlined framework (<xref ref-type="fig" rid="fig1">Figure 1</xref>) to generate an ensemble of 1000 subsampled topologies. For this ensemble, we subsampled 30 of 66 orthologs of each paralog in the synthetic families (≈45%) and reconstructed the best 10,000 topologies for 400 families. Here, we consider the top 50 topologies constructed by ASPEN for each family, ranked according to their log-likelihood score, reflecting their consistency with the ensemble.</p><sec id="s2-3-1"><title>ASPEN's top topology is more accurate</title><p>First, we explored how the top-ranked ASPEN topology compares to the the all-sequence topology inferred using the most accurate combination of algorithms (MAFFT L-INS-i alignment and FastTree2 phylogeny inference). <xref ref-type="fig" rid="fig4">Figure 4A</xref> demonstrates that in the vast majority of cases (90.7% of all families) the top-ranked ASPEN topology is equal to or more accurate than the all-sequence topology. The ASPEN topology is more accurate for 53.8% of families. At the highest precision values, where all-sequence topologies are the most accurate, the top-ranked ASPEN topology is the true topology. ASPEN provides greatest improvement over single-alignment inference when precision is below 0.9, where it is very likely that ASPEN’s top topology will be more accurate than the all-sequence topology. In general, top-ranked ASPEN topologies for low precision families are also not completely accurate. However, there are some cases where medium/low accuracy of the all-sequence topology corresponds to a completely accurate top ASPEN topology. Therefore, ASPEN’s top topology provides the greatest accuracy improvement over single-topology reconstructions when reconstruction is most complex.</p><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.013</object-id><label>Figure 4.</label><caption><title>The accuracy of ASPEN models.</title><p>(<bold>A</bold>) Comparison of the accuracies of the all-sequence and top-ranked ASPEN topologies, arranged according to families’ precision values. The two accuracy values for each family are connected by a blue line if the ASPEN topology is more accurate than the all-sequence topology, by a black line if the all-sequence topology is more accurate, and no line if their accuracies are equal. (<bold>B</bold>) A histogram reflecting where the most accurate ASPEN topology falls among the top 50 ASPEN topologies for that family. (<bold>C</bold>) Comparison of the accuracies of the all-sequence and the <italic>most accurate</italic> topology among the top 50 of ASPEN topologies. Connections between the points have the same meaning as panel A. (<bold>D</bold>) The number of top-50 ASPEN topologies that are more accurate than the all-sequence topology for that family. Each circle represents a synthetic family.</p><p><supplementary-material id="fig4sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.014</object-id><label>Figure 4—source data 1.</label><caption><title>Accuracy, Precision, and Rankings of ASPEN topologies.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig4-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig4-v1.tif"/></fig></sec><sec id="s2-3-2"><title>Log-frequency score is related to accuracy</title><p>Next, we wished to explore whether ASPEN’s ranking system, based on likelihood according to the ensemble, identifies more accurate trees in general. <xref ref-type="fig" rid="fig4">Figure 4B</xref> captures where the most accurate ASPEN topology among the top 50 ASPEN topologies is ranked according to the ASPEN likelihood scoring function. The fast drop-off in rank demonstrates that the most accurate topologies are ranked highest by ASPEN. The top-ranked topology is also the most accurate for 36.9% of families, while for the remaining 63.1% of families the most accurate tree is not the top-ranked tree. However, the most-accurate tree recovered is still related to the topologies likelihood score and 75% of the time the most accurate tree is in the top ten trees returned by ASPEN. Together, these results demonstrate that ASPEN’s approach and likelihood scoring function, which reflect consistency with ensemble-observed features (<xref ref-type="disp-formula" rid="equ5">Equation 1</xref>) are related to topology accuracy.</p></sec><sec id="s2-3-3"><title>ASPEN produces many topologies with better accuracy</title><p><xref ref-type="fig" rid="fig4">Figure 4C</xref> demonstrates how much better the most accurate topology found among ASPEN’s top 50 is than the all-sequence topology. For 99% of families, the most accurate among the top 50 topologies returned by ASPEN is better or equal in accuracy to the all-sequence topology (76% of the time it is better). Hence, the top-ranked topology is generally better than the all-sequence topology (<xref ref-type="fig" rid="fig4">Figure 4A</xref>), but there are bigger gains for topology improvement when considering other topologies within the ASPEN top-50. In order to understand how many topologies are better, we calculated the fraction of the 50-best ASPEN trees that are better than the all-sequence topology (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). Not surprisingly, for families with highly accurate all-sequence topologies, which also have high precision, one or few topologies are equally or more accurate, which corresponds with the top-ranked ASPEN tree also recovering the true topology. Strikingly, as precision drops, even a small amount, the number of topologies that are more accurate than all-sequence increases. At the extreme-end, where precision is at its lowest observed, all 50 ASPEN topologies are more accurate than the all-sequence topology.</p></sec><sec id="s2-3-4"><title>How ASPEN produces more accurate topologies</title><p>We wanted to understand how log-frequency scoring facilitates identification of more accurate topologies than phylogenetic reconstructions from single alignments. Using the length of path between two leaves, we explored the connection between path length frequencies observed across an ensemble and differences between true, all-sequence, and ASPEN topologies.</p><p>First, we compared the observation frequencies of path lengths between true and all-sequence topologies. Among paths on which the two topologies disagree, the length consistent with the true topology was observed more frequently than the length consistent with the all-sequence topology for half or more paths across all but the highest-precision bin (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). In the highest-precision bin, reconstruction is extremely accurate and the true and all-sequence topologies disagree on a very small fraction of path lengths (4.8%). Although the fraction of <italic>all</italic> paths with incorrect length in the all-sequence topology (overall bar height in <xref ref-type="fig" rid="fig5">Figure 5A</xref>) increases dramatically as precision falls, the fraction of <italic>disagreeing</italic> paths for which the ensemble correctly identifies the true length (fraction of bar filled with blue) remains surprisingly constant. The larger fraction of all paths for which the ensemble supports the true path length (height of blue bar segment) accounts for the much slower drop off in accuracy of all ASPEN topologies at lower precision, compared to the precipitous fall in the accuracy of all-sequence topologies. Unfortunately, the fraction of all paths for which the ensemble supports the incorrect all-sequence path length (height of white bar segment) also increases at lower precision, which explains why any drop off in ASPEN topology accuracy occurs at all. Nevertheless, the frequency of the most frequent path length and the breadth of the path length distribution provides a measure of confidence in the ensemble’s support of a particular path length. The aggregate of this confidence across all pairwise paths is reflected in the log-frequency score differences between ASPEN topologies.</p><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.015</object-id><label>Figure 5.</label><caption><title>Accuracy of path lengths in the subsampled ensemble and the top ASPEN topology.</title><p>Synthetic families were binned by precision and path length data was aggregated from all families in a precision bin. (<bold>A</bold>) Total height of bar represents fraction of all paths across all families in precision bin with a length error (path length is incorrect in all-sequence topology). Blue fraction of bar represents paths for which the true length was observed more frequently across the ensemble. White fraction of bar represents paths for which the incorrect all-sequence length was observed more frequently across the ensemble. (<bold>B</bold>) Total height of bar represents fraction of all paths in bin with a length discrepancy (on which the true, all-sequence, and top ASPEN topology fail to agree). Blue fraction of bar represents paths with the correct length in the top ASPEN topology. White fraction of bar represents paths on the incorrect length of which the top ASPEN topology agrees with the all-sequence topology. Fraction of bar shaded gray represents paths of unique length in the top ASPEN topologies: incorrect length different from the length in the all-sequence topology.</p><p><supplementary-material id="fig5sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.016</object-id><label>Figure 5—source data 1.</label><caption><title>Path length differences.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig5-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig5-v1.tif"/></fig><p>Next we examined the agreement, in terms of path lengths, between the top ASPEN topology, the true topology, and the all-sequence topology (<xref ref-type="fig" rid="fig5">Figure 5B</xref>). As expected, the fraction of all paths with an incorrect length in one or both of the all-sequence and top ASPEN topologies (overall bar height in <xref ref-type="fig" rid="fig5">Figure 5B</xref>) is larger at lower precision. Surprisingly, the fractions of all paths with the correct path length in the top ASPEN topology (height of blue bar segment) and the all-sequence path length in the top ASPEN topology (height of empty bar segment) change little as precision falls, while the fraction of all paths with lengths in the top ASPEN topology matching neither the true length nor the all-sequence length (unique paths, height of gray bar segment) increases. This discrepancy may explain why the accuracy difference between the top ASPEN topology and the other ASPEN topologies decreases at lower precision. Although the fraction of paths with an incorrect length in the all sequence topology, but with the correct length identified through subsampling (height of blue bar segment in <xref ref-type="fig" rid="fig5">Figure 5A</xref>) increases, not all such path lengths are incorporated into the top ASPEN topology – likely due to the constraints imposed by other path lengths on the reconstruction of internal nodes. Instead the correct path lengths are incorporated into other topologies proposed by ASPEN. Accordingly, log-frequency score differences between ASPEN topologies also decrease at lower precision (<xref ref-type="fig" rid="fig6">Figure 6</xref>, <xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>), reflecting more uniform confidence in any individual topology.</p><fig-group><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.017</object-id><label>Figure 6.</label><caption><title>Comparison of log-frequency scores of the top 500 ASPEN topologies for LacI.</title><p>The difference between a topology’s score and the score of the best ASPEN topology is plotted as a function of topology rank. Bin-average score differences for simulated families from the two precision bins between which LacI falls are plotted for reference. Also plotted is the difference in score between the all-sequence topology of LacI and the top ASPEN topology.</p><p><supplementary-material id="fig6sdata1"><object-id pub-id-type="doi">10.7554/eLife.47676.019</object-id><label>Figure 6—source data 1.</label><caption><title>Differences in log-frequency score by rank.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-47676-fig6-data1-v1.xlsx"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig6-v1.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.47676.018</object-id><label>Figure 6—figure supplement 1.</label><caption><title>Dropoff in ASPEN log-frequency scores across precision bins.</title><p>Comparison of log-frequency scores of the top 500 ASPEN topologies for simulated families across six precision bins. The difference between a topology’s score and the score of the best ASPEN topology, averaged over all families in the bin, is plotted as a function of topology rank.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig6-figsupp1-v1.tif"/></fig></fig-group></sec></sec><sec id="s2-4"><title>ASPEN reconstruction of LacI paralog divergence</title><p>As mentioned previously, LacI falls into an intermediate range of reconstruction difficulty. In this range, the 10 to 30 highest ranked ASPEN topologies are likely to be more accurate than any all-sequence reconstruction, based on our observations from synthetic protein families (<xref ref-type="fig" rid="fig4">Figure 4D,E</xref>). Given this, we reconstructed LacI paralog divergence using ASPEN. We derived path length frequencies from an ensemble of 1000 subsampled topologies (<xref ref-type="fig" rid="fig1">Figure 1B</xref>), using ∼50% of the available ortholog sequences (the same procedure that was used for synthetic families). We then used ASPEN to construct the best 500 topologies (Supplementary Material). <xref ref-type="fig" rid="fig6">Figure 6</xref> plots the drop-off in the log-frequency score of each ASPEN topology, compared to the top-ranked topology, for LacI and for the two precision bins at the boundary of which LacI falls (<xref ref-type="fig" rid="fig4">Figure 4D,E</xref>). Log-frequency scores decay faster at higher precision (<xref ref-type="fig" rid="fig6">Figure 6</xref>), reflecting a greater difference in confidence for each lower ranked topology, as previously discussed. The all-sequence LacI topology does not appear among the top 500 ASPEN topologies, having scored significantly worse then the ASPEN trees according to the log-frequency scoring function. This indicates that all 500 ASPEN topologies are more consistent with observations across the ensemble of subsampled LacI topologies than the all-sequence reconstruction.</p><p>A comparison of all-sequence and top ASPEN topologies (<xref ref-type="fig" rid="fig7">Figure 7</xref>) illustrates why the all-sequence topology scores so poorly against the 50% subsampling ensemble. Since the log-frequency scoring function penalizes topologies for incorporating rarely observed leaf-to-leaf path lengths, infrequent incorporation of an ancestral node into ASPEN topologies indicates that most clade arrangements below the node produce unfavorable path lengths. While the top ASPEN topology incorporates the [Mal-B, AscG, GalRS] common ancestor, which appears in and additional 46% of ASPEN topologies, alternative placement of the Mal-B terminal branch in the all-sequence topology produces a different ancestral node, which appears in only 24% of ASPEN topologies. Worse, the all-sequence topology is missing the [CscR, IdnR, GntR] common ancestor, which appears in 76% of ASPEN topologies, incorporating instead the [IdnR, GntR, ExuR, KdgR, FruR, ScrR-BD, TreR] common ancestor, which appears in only 6% of ASPEN topologies. Taken together with our findings for synthetic families, these results suggest that the best ASPEN topology is more accurate than the all-sequence topology, but that none of the reconstructed topologies are likely to match exactly the true divergence of LacI paralogs. In lieu of using a single topology, downstream analyses would do well to reflect this uncertainty by considering multiple likely topologies produced by ASPEN.</p><fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.47676.020</object-id><label>Figure 7.</label><caption><title>Reconstructed topologies for the LacI family.</title><p>Reconstructed nodes are annotated with the frequencies at which they were recapitulated among the 500 top-scoring topologies reconstructed by ASPEN as a way of summarizing ancestral nodes observed across the most likely trees. Subtrees on right represent reconstructed nodes observed with frequency ≥0.1 among the 500 ASPEN topologies, but not appearing in either the all-sequence or the best ASPEN topology. Branches placed differently in the all-sequence and best ASPEN topologies are shown as dashed lines, as are branches placed differently from either topology in the subtrees on the right. Observation frequencies for disagreeing splits are bolded and italicized.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-47676-fig7-v1.tif"/></fig></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>We described a novel approach to analyzing and reconstructing divergence histories of protein families. Our approach is conceptually rooted in the decomposition of the topology search space at high confidence ancestral nodes, which are extremely likely to exist in the true topology, and takes advantage of the fact that complete divergence histories include ``nuisance'' segments, which provide little biological insight. Instead of reconstructing such segments, we propose integrating over the uncertainty of their reconstruction to produce more accurate &quot;marginal'' reconstructions of the most interesting segments. Critically, our approach considers the uncertainty arising from input sequence selection and alignment, a historically thorny issue in phylogenetic analysis (<xref ref-type="bibr" rid="bib68">Wong et al., 2008</xref>). The traditional method of assessing the reliability of phylogenetic reconstruction, the phylogenetic bootstrap (<xref ref-type="bibr" rid="bib14">Felsenstein, 1985</xref>), cannot address the reliability of the individual sites (alignment positions) it resamples. On the other hand, the sequence resampling approach we presented occurs farther upstream in the inference process, treating sequence alignment and phylogeny reconstruction as a single inference procedure subject to multiple sources of uncertainty. We can use the resulting ensemble of subsampled topologies: 1) to compute an observable metric, precision, which is directly proportional to the accuracy of any individual reconstruction – a hidden quantity for reconstructions from real sequences – and 2) to assemble leaf-to-leaf path length frequency distributions, which we use to define the log-frequency scoring function that is also directly related to reconstruction accuracy. Our topology reconstruction algorithm then uses the scoring function to identify and rank topologies according to their consistency with the phylogenetic signal characterized by these empirical distributions. The highest scoring topologies are more accurate than topologies reconstructed from alignments of all available sequences, confirming that the topological features more frequently represented across subsampled topologies are also more consistent with the true phylogenetic signal. Crucially, ASPEN identifies these topologies in the face of misleading likelihood landscapes resulting from each individual input alignment, on which the true topology is not the maximum likelihood topology, or even located within the optimum well. Finally, we showed that, although ASPEN tree accuracy declines as the reconstruction task gets harder (as evidenced by decreased precision and accuracy of the all-sequence tree), its decline is significantly slower than that of single all-sequence reconstructions. Importantly, ASPEN is able to identify when an all-sequence tree is likely to be inaccurate (via precision) and then construct and rank a set of trees which, while unlikely to be exactly correct, are all likely to be more accurate than any all-sequence tree. We propose that downstream analysis relying on a divergence topology should aim to integrate over this topological uncertainty.</p><sec id="s3-1"><title>Generality of the accuracy-precision relationship</title><p>Given the potential usefulness of the correlation between accuracy and precision, it remains vitally important to ascertain the robustness of this relationship to varying degrees of mismatch between actual evolutionary processes which gave rise to extant sequences and the evolutionary model used in phylogenetic inference. In our sequence evolution simulations, we rescaled the grafted species tree, both as a whole and its individual segments, to model evolutionary rate differences between paralogs (heterotachy) and used the JTT amino acid substitution model with variable branch length scaling spanning a five-fold range (<italic>Supplementary Material</italic>) to model among-site differences in substitution rate across the protein fold. To incorporate model violation into our phylogenetic reconstructions, we used the WAG substitution model with substitution rate heterogeneity modeled by a discrete gamma distribution and no mechanism to model heterotachy. However, the evolutionary histories of real protein families may be subject to a number of additional forms of model violation, such as among-site variation in amino acid frequencies, varying selection pressures leading to convergent evolution, a known cause of the long branch attraction artifact in phylogenetic reconstruction, and, crucially, non-independent evolution of sites.</p><p>Although, in general, positions in protein sequences clearly do not evolve independently of one another, characterizing the sources and effects of positional interdependence in protein evolution has proven difficult (<xref ref-type="bibr" rid="bib2">Arenas et al., 2013</xref>; <xref ref-type="bibr" rid="bib16">Grahnen et al., 2011</xref>; <xref ref-type="bibr" rid="bib7">Choi et al., 2007</xref>; <xref ref-type="bibr" rid="bib53">Rodrigue et al., 2005</xref>; <xref ref-type="bibr" rid="bib51">Robinson et al., 2003</xref>; <xref ref-type="bibr" rid="bib42">Parisi and Echave, 2001</xref>). Unlike structural RNA molecules, where base pairing leads to strong pairwise dependence between sites, protein sites tend to be more weakly dependent on larger numbers of other sites (<xref ref-type="bibr" rid="bib39">Nasrallah et al., 2011</xref>). Accuracy of phylogenetic inference in general appears to be affected in a sequence length-dependent manner, with site non-independence resulting in less phylogenetic signal than site-independent sequences of the same length (<xref ref-type="bibr" rid="bib39">Nasrallah et al., 2011</xref>; <xref ref-type="bibr" rid="bib21">Huelsenbeck and Nielsen, 1999</xref>). The concept of effective sequence length was introduced by <xref ref-type="bibr" rid="bib39">Nasrallah et al. (2011)</xref>, where effective sequence length equals actual sequence length for site-independent sequences, but is shorter than actual length for non-independent sequences, reflecting reduced phylogenetic signal. If reduction in phylogenetic signal is indeed the principal effect of non-independent evolution of sites, then precision should diminish accordingly, and the strength of the accuracy-precision relationship should not be affected.</p><p>Given a particular set of evolutionary circumstances, the correlation between accuracy and precision may be diminished under those circumstances in one of two ways: 1) systematically higher accuracy than would typically be indicated by the corresponding degree of precision, or 2) systematically higher precision than the degree of accuracy. The former – <italic>systematically</italic> higher accuracy than that indicated by precision for all protein families evolved under the circumstances in question – implies a critical threshold in the number of input sequences between all-sequence and high-density subsampled reconstructions. Given thorough ortholog representation of each paralog, this seems exceedingly unlikely. The latter – misleadingly high precision – would reflect a systematic bias toward specific incorrect topologies under those particular evolutionary circumstances. This is exactly the case with long branch attraction, and can plausibly occur in other ways as well. Identifying evolutionary circumstances which result in such systematic breakdown of the accuracy-precision relationship is vitally important for future work.</p></sec><sec id="s3-2"><title>Selection of ancestral nodes for topology search space decomposition</title><p>In this study, we limited evolutionary simulations to a simplified scenario: divergence of 15 paralogs through duplication events, followed by divergence of orthologs through speciation without any further duplications or gene loss. This produced topologies with the divergence history of 66 species fully recapitulated under the common ancestor of each ortholog set. With only duplication nodes above ortholog common ancestors, and only speciation nodes below them, these 15 ancestors were the natural choice for roots of integrated-out clades in our analysis. Inference of ortholog common ancestors was nearly universally recapitulated across all subsamples for all 600 simulated families, so these nodes satisfied our high confidence criterion for decomposition of the topology search space.</p><p>In real protein families, including the LacI family, duplications are typically intermingled with speciations. For distantly related species, where multiple duplications have occurred along both lineages since the species diverged, this can produce collections of paralogs without orthology relationships to each other. For more closely related species, where one or more duplications occurred along one of the two lineages, it can result in co-orthology, mapping multiple genes in a post-duplication genome to a single gene in a genome from the other lineage. In addition, loss of paralogs along some lineages can result in different numbers of paralogs in different species, with unclear orthology vs paralogy relationships. ASPEN analysis of any real protein family starts with selecting the ancestral nodes for search space decomposition. Any collection of internal nodes, regardless of the relationships among leaves within each clade or their relationships to leaves outside the clade, can be selected for this purpose. In our analysis of the LacI family, the leaf sets in integrated-out clades did not come from a uniform collection of species, suggesting that post-speciation duplications and/or gene loss occurred in the evolution of LacI paralogs. The only requirement is sufficient confidence in each ancestor’s existence, as evidenced by robust inference over any set of reasonable input alignments or alignment perturbations. In our opinion, ancestors with predominantly speciation nodes below them and predominantly duplication nodes above, as evidenced by leaf sequence species of origin, result in analysis with the most biological insight, but this is not a requirement. Although this step must be carried out individually for any protein family, based on the information researchers wish to obtain from the analysis, we provide some suggestions for how to apply our methodology to one’s protein family of interest.</p><p>We recommend relying on existing genomic and/or functional annotations and average within-group vs. average out-of-group sequence similarity (separability) to identify candidate leaf subsets to integrate out. When dealing with large families, such as some protein domains, which can number in the dozens or hundreds of paralogs in vertebrate genomes, common ancestors of multiple closely related paralogs may be logical choices. ASPEN methodology can be used recursively to separately reconstruct the divergence of these paralogs – another advantage of decomposing the search space at high confidence nodes. Next, we recommend reconstructing an all-sequence topology and a small ensemble of densely subsampled topologies to assess confidence in the existence of selected ancestors, as well as to determine reconstruction precision and form an expectation of the ultimate accuracy of reconstruction. If selected leaf subsets are not reliably monophyletic across the ensemble, the selections need to be revisited until the common ancestor of each integrated out clade can be inferred with high confidence.</p><p>Clearly, applicability of ASPEN analysis to any particular family hinges on the existence of such high confidence ancestors and the willingness to sacrifice reconstruction of clades below those ancestors. In part, this requirement can be satisfied by careful assembly of the input sequence collection: including as many ortholog or co-ortholog sequences as possible will maximize the chances of high confidence reconstruction of the common ancestors of those orthologs, provide large leaf subsets for subsampling, and mitigate the conditions under which the long branch attraction artifact occurs. Nevertheless, it is possible that individual leaf sequences or common ancestors of a few sequences (e.g. five or fewer) will not be robustly monophyletic with any other leaves. We recommend including these leaf sequences in every subsample and treating them (or their common ancestors, for small monophyletic clades) as leaves in ASPEN topology reconstruction. ASPEN analysis remains applicable given at least one integrated out clade, although we expect the usefulness of that analysis to diminish as more leaf sequences fall outside of such clades.</p></sec><sec id="s3-3"><title>Practical considerations for ASPEN topology reconstruction</title><p>ASPEN’s branch-and-bound algorithm provides a powerful guarantee of completeness – that the <italic>N</italic>-best trees were produced – at the end of its run, but execution times and resource requirements can be substantial for large families. ASPEN’s reconstruction is parallelizable across multiple CPUs and we generally observed that the least difficult (most accurate) synthetic families were complete within an hour of total CPU time, whereas the most difficult problems could take up to 400 CPU hr. However, the vast majority of <italic>N</italic>-best trees were always identified early in the the run (within a few hours), with the remainder of the run spent almost exclusively rejecting worse topologies. Dispensing with the branch-and-bound guarantee, topology assembly can be truncated after a fraction, sometimes a very small fraction, of the full run time, retaining a nearly-complete collection of <italic>N</italic>-best trees. Additionally, there are possibilities for other heuristic approaches that could scale better with the inference complexity and the number of nodes than the current implementation of ASPEN that uses the log-likelihood with the ensemble as an objective function, now that it has been shown to be capable of identifying more accurate topologies.</p><p>Once ASPEN has produced a collection of likely topologies of ancestor divergence, researchers may want to obtain complete phylogenies for their input sequences by grafting topologies of integrated out clades at the corresponding leaves of ASPEN-reconstructed topologies and optimizing branch lengths for the resulting full topologies. For common ancestors of orthologs, we strongly recommend using the species divergence topology for the divergence of orthologs, unless truly compelling evidence to the contrary exists. In our analysis of simulated families, where ortholog evolution was simulated over the same species tree in each case, the correct speciation topology was never recovered for all 15 paralogs, underscoring the futility of reconstructing species divergence from single protein families. For common ancestors of multiple paralogs, ASPEN can be applied recursively to infer the divergence of those paralogs. After complete topologies have been assembled, branch lengths and other parameters can be optimized for any given sequence alignment, for example using RAxML (<xref ref-type="bibr" rid="bib61">Stamatakis, 2014</xref>).</p></sec><sec id="s3-4"><title>Scalability of ASPEN and extensions to the methodology</title><p>Traditionally, the effect of alignment uncertainty on phylogenetic reconstruction has been addressed through simultaneous inference of the alignment and the phylogeny, either through extensions of the approach used by progressive multiple sequence alignment algorithms: alternating iterative refinement of alignment and phylogeny (<xref ref-type="bibr" rid="bib35">Mirarab et al., 2015</xref>; <xref ref-type="bibr" rid="bib33">Liu et al., 2012</xref>; <xref ref-type="bibr" rid="bib30">Liu et al., 2009</xref>; <xref ref-type="bibr" rid="bib43">Parmentier et al., 2006</xref>; <xref ref-type="bibr" rid="bib10">Edgar and Sjölander, 2003</xref>), or through full joint co-estimation of alignment and phylogeny by Bayesian Markov Chain Monte Carlo (<xref ref-type="bibr" rid="bib64">Suchard and Redelings, 2006</xref>; <xref ref-type="bibr" rid="bib50">Redelings and Suchard, 2005</xref>). While iterative refinement can handle much larger reconstructions than Bayesian co-estimation (<xref ref-type="bibr" rid="bib35">Mirarab et al., 2015</xref>; <xref ref-type="bibr" rid="bib33">Liu et al., 2012</xref>), both approaches incur the full cost of repeated inference of every ancestral node, including all speciation nodes. Algorithmic advances and improved parallelization (<xref ref-type="bibr" rid="bib35">Mirarab et al., 2015</xref>; <xref ref-type="bibr" rid="bib61">Stamatakis, 2014</xref>; <xref ref-type="bibr" rid="bib24">Katoh and Standley, 2014</xref>) permit larger reconstructions through heuristic approximations, but the computational cost of repeated large phylogenetic reconstructions constitutes a fundamental challenge. Abandoning reconstruction of every ancestral node allows ASPEN topology reconstruction to scale much better. Unlike in simultaneous alignment and phylogeny inference, all of the large phylogenetic reconstructions required to build a topology ensemble can be carried out concurrently, allowing ASPEN to take maximal advantage of high-performance computing resources. ASPEN’s topology reconstruction algorithm itself is not affected by the number of leaf sequences within integrated-out clades, only by the number of such clades, making it scale much better with the total number of input sequences than simultaneous co-estimation approaches.</p><p>We anticipate that, as a meta analysis approach to tree evaluation and reconstruction, ASPEN is likely to continue to boost the accuracy of individual alignment and tree reconstruction approaches, regardless of the specific underlying alignment and reconstruction algorithms or the application (e.g. whether it is subsampling from orthologs to infer paralog relationships or subsampling from genomes to reconstruct species relationships). Alternate statistical approaches are increasingly important with the advent of affordable genome sequencing and the resulting explosion in the number of sequenced and annotated species’ genomes (<xref ref-type="bibr" rid="bib1">Aken et al., 2017</xref>; <xref ref-type="bibr" rid="bib3">Benson et al., 2017</xref>). The current implementation of ASPEN as a subsampling and scoring approach is immediately tractable for nearly all protein families. ASPEN’s branch-and-bound reconstruction algorithm is also immediately tractable for reasonably sized families, such as the LacI family. However, the sequence subsampling approach, the path-length frequency distributions it provides, and the log-frequency scoring function are powerful tools in their own right, which scale with the number of integrated out clades much better than the branch-and-bound algorithm. A more efficient search of topology space under this objective function, with a guarantee and/or estimation of completeness, is possible. It may be possible to structure subsampling so that the resulting frequency distributions are even more reflective of the true topology. Finally, a mechanism for robust inference of branch lengths for ASPEN-constructed topologies that, similar to ASPEN topology reconstruction, integrates over the uncertainty of alignment and reconstruction below selected ancestors, is clearly desirable.</p></sec><sec id="s3-5"><title>Conclusions</title><p>Phylogenetic inference is an extremely difficult problem, particularly for individual protein families, where short amino acid sequences contain limited phylogenetic signal. Here, we demonstrated that the sensitivity of inference and alignment algorithms to their inputs is a result of the failure of objective functions to accurately model the mutational events that underlie the divergence nodes in an evolutionary tree, which manifest in both alignment and inference procedures. At their core, phylogenetic trees are hypothetical models of a currently unknowable evolutionary history. George E.P. Box’s much quoted philosophy about models is relevant here: &quot;Essentially, all models are wrong, but some are useful''. Extending this, we propose that integrating across a lot of models that are wrong in different ways, but right in the same way, yields more useful models of evolutionary divergence. This is based on the observation that topologies capturing more of the shared information across many incorrect models are significantly more accurate. However, we also find that, for especially difficult inference problems (where all-sequence topologies are imprecise, that is have low reproducibility under subsampling) it is important to consider multiple models as equally viable explanations of evolutionary history. In other words, for most real evolutionary inference problems, scientists should integrate their analyses over multiple plausible phylogenetic models. The methodology we presented facilitates both an overall assessment of accuracy of topology reconstruction for any particular problem, and, in light of that assessment, reconstruction of an appropriate number of maximally plausible topological models. Crucially, ASPEN is geared toward analysis of precisely the most difficult class ancestors: ancient ancestors of multiple paralogs.</p><p>It should be noted that individual ancestral nodes can vary dramatically in their difficulty of inference, and many ancestors of great biological interest can be inferred with very high accuracy, despite low overall accuracy of topology inference for that family. Moreover, given high confidence in the existence of such an ancestor, reconstruction of that ancestor’s sequence is robust with respect to topological uncertainty for the clade below it (<xref ref-type="bibr" rid="bib12">Eick et al., 2017</xref>). A critical step in evolutionary analysis, then, is to determine <italic>which</italic> inferred ancestors are reliable – both with respect to systematic biases and with respect to uncertainty due to various sources of random noise – and which are not. ASPEN topologies can be used for this purpose in a fashion similar to the traditional phylogenetic bootstrap, with the additional benefit of evaluating consistency of an ancestor’s inference across the most likely topologies.</p><p>Divergence reconstructions for well-studied protein domain families are relied upon extensively by the scientific community. For example, evolutionary trees of catalytic and recognition protein domains involved in signaling, including protein kinases (<xref ref-type="bibr" rid="bib34">Manning et al., 2002</xref>) and phosphatases (<xref ref-type="bibr" rid="bib6">Chen et al., 2017</xref>), SH2 domains (<xref ref-type="bibr" rid="bib29">Liu et al., 2006</xref>), de-ubiquitinating enzymes (deubiquitinases or DUBs) (<xref ref-type="bibr" rid="bib40">Nijman et al., 2005</xref>), histone deacetylases (HDACs) (<xref ref-type="bibr" rid="bib17">Gregoretti et al., 2004</xref>), and Ras GTPases (<xref ref-type="bibr" rid="bib54">Rojas et al., 2012</xref>) are ubiquitously used. Because such reconstructions are created from single sequence alignments, they ignore the great deal of uncertainty in topology reconstruction under equally valid representations of available sequence data. Furthermore, such reconstructions are often built from limited data. For example the human kinome, which has been cited over 6000 times to date, was constructed just from human sequences – an example of extreme subsampling, with each ancestor represented by a single sequence. Topology reconstructions from single alignments with sparse subsampling are likely to be extremely inaccurate. We found individual reconstructions are extremely unreliable, even for relatively high-precision families, with very few descendants representing each ancestor. These observations suggest that revisiting these important protein domains using ASPEN’s approach, including quantifying the likely accuracy of published trees and constructing and ranking trees most consistent with the available homolog sequences, is worthwhile. Specifically, we propose that for most protein families, it will be necessary to consider multiple equally likely models of evolutionary divergence.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Sequences</title><sec id="s4-1-1"><title>Simulated paralog families</title><p>We simulated 600 families, each containing 15 paralogs, with each paralog represented by 66 orthologs. First, we generated random 15-leaf phylogenies representing paralog divergence. Random phylogenies were generated with average branch lengths of 0.5, 0.6, 0.7, 0.8, 0.9, and 1.0 –100 phylogenies each. Next, the Ensembl Compara species tree topology (<xref ref-type="bibr" rid="bib20">Herrero et al., 2016</xref>) containing 66 metazoan species was grafted to each leaf of each random topology to represent ortholog divergence. Finally, each species tree topology was parametrized with branch lengths corresponding to species divergence times obtained from <ext-link ext-link-type="uri" xlink:href="http://timetree.org">timetree.org</ext-link> (<xref ref-type="bibr" rid="bib19">Hedges et al., 2015</xref>; <xref ref-type="bibr" rid="bib27">Kumar et al., 2017</xref>), randomly rescaled in total height to represent faster or slower evolution of individual paralogs, and then had each individual segment randomly perturbed around its previous length. Sequence evolution was simulated over each resulting phylogeny, seeded with an alignment of human tyrosine kinase domains with median length of 269 a.a. All sequence simulation materials and simulated sequence alignments are available via Figshare (<ext-link ext-link-type="uri" xlink:href="http://doi.org/10.6084/m9.figshare.5263885">10.6084/m9.figshare.5263885</ext-link>).</p></sec><sec id="s4-1-2"><title>LacI transcription factor family</title><p>We started with a collection of 19 LacI paralogs represented by 28 to 192 orthologs (<xref ref-type="bibr" rid="bib59">Sloutsky and Naegle, 2016</xref>). After initial phylogenetic reconstruction we split paralogs PurR and RbsR-A into three separate paralogs each, according to monophyletic grouping of orthologs. This resulted in new paralogs PurR1 (37 orthologs), PurR2 (61 orthologs), PurR3 (28 orthologs), RbsR-A1 (79 orthologs), RbsR-A2 (22 orthologs), and RbsR-A3 (45 orthologs). The final collection contains 23 LacI paralogs represented by 22 to 192 orthologs, for a total of 1777 sequences (Supplementary Material).</p></sec></sec><sec id="s4-2"><title>ASPEN topology reconstruction algorithm</title><sec id="s4-2-1"><title>Equivalence of topology representations</title><p>We demonstrate equivalence of acyclic graph and path length matrix representations of individual topologies by presenting a procedure for interconverting between the two. Transformation of a topology into its path lengths matrix representation is trivially accomplished by counting internal nodes along each path between pairs of leaves (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). The reverse transformation can be accomplished using a simple bottom-up construction procedure. <xref ref-type="fig" rid="fig3">Figure 3C</xref> provides an illustration by reconstructing the topology from <xref ref-type="fig" rid="fig3">Figure 3A</xref> starting with its matrix representation. Because all path lengths are derived from a single topology, they are guaranteed to be consistent, making the construction unambiguous.</p></sec><sec id="s4-2-2"><title>A branch-and-bound topology construction algorithm</title><p>Using the bottom-up procedure for reconstructing a single topology graph as a template, we developed an algorithm that uses a branch-and-bound strategy to construct the requested number of highest-scoring topologies according to the log-frequency scoring function (<xref ref-type="disp-formula" rid="equ5">Equation 1</xref>). By analogy with the single-topology procedure, path lengths, together with their observation frequencies, are sorted into a list (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). This list guides topology reconstruction (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). However, unlike the single-topology case, list entries are not necessarily consistent with each other. The simplest illustration of this are paths of different lengths between the same two leaves, <xref ref-type="fig" rid="fig3">Figure 3D</xref>: for example <inline-formula><mml:math id="inf32"><mml:mrow><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> observed in the ensemble 80% of the time and <inline-formula><mml:math id="inf33"><mml:mrow><mml:mo>(</mml:mo><mml:mi>A</mml:mi><mml:mo>↔</mml:mo><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> observed 20% of the time. Such paths are clearly mutually exclusive. The branching component of branch-and-bound accommodates the divergent topologies which recapitulate each path.</p><sec id="s4-2-2-1"><title>Branching</title><p>As in the single-topology procedure, construction of internal nodes is triggered by path length entries encountered during list traversal, with one key difference. In single topology reconstruction, if a path length could be recapitulated by the introduction of an internal node, that node could be safely constructed because it was guaranteed to satisfy every other list entry. Since that guarantee no longer holds, multiple topologies are constructed simultaneously by allowing the construction sequence to branch (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). &quot;Assemblies'' are used to track simultaneous reconstruction of multiple topologies. Each assembly holds a copy of the path length frequencies list, a partially constructed topology, and the current topology score according to the scoring function. Reconstruction proceeds in iterations, starting with a single empty assembly on the first iteration. The entire list is traversed and every possible extension is created simultaneously in a copy of the original assembly. In each resulting assembly, all path lengths completed by the new node and all path lengths incompatible with it are marked and not re-examined on subsequent iterations. Remaining path lengths are not completed by the new node, but remain compatible with it. On subsequent iterations the same procedure is repeated for all tracked assemblies.</p><p>In principle, branching and iteration alone yield every topology consistent with path lengths observed in the ensemble. In practice, this results in a combinatorial explosion of tracked assemblies, which must be carefully managed to allow construction to proceed to completion.</p><p>First, branching to satisfy non-conflicting path lengths can lead to collisions between diverged construction sequences on later iterations (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). This occurs because most topologies can be constructed by introducing internal nodes in multiple orders. Each branched construction sequence represents a particular order of internal node introduction. In a practical implementation, these collisions must be managed in order to prevent construction of the same topology by multiple construction sequences – an enormous replication of effort.</p><p>Second, even if each distinct topology is constructed once, in most cases reconstructing every topology consistent with observations from the ensemble, no matter how infrequent, is neither practical nor useful. Bounding, described in the next section, guarantees reconstruction of only the requested number of top-scoring topologies.</p></sec><sec id="s4-2-2-2"><title>Bounding</title><p>Completed topologies are ranked according to their log-frequency score, with the ranking updated every time a new topology is finalized. The number of top scoring topologies to reconstruct, <inline-formula><mml:math id="inf34"><mml:mi>N</mml:mi></mml:math></inline-formula>, is specified at the beginning of a reconstruction run. Once the initial <inline-formula><mml:math id="inf35"><mml:mi>N</mml:mi></mml:math></inline-formula> topologies have been constructed, the <inline-formula><mml:math id="inf36"><mml:mi>N</mml:mi></mml:math></inline-formula>th topology score constitutes the bound. Partially constructed topologies (assemblies) are abandoned if no complete topology can be derived from their construction state with a score above the current bound. We determine this by calculating the score for already-incorporated path lengths and projecting the best possible score for a complete topology by assuming the most frequent remaining path length will be incorporated for every unconnected leaf pair:<disp-formula id="equ6"><label>(2)</label><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mtext>projected</mml:mtext><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mo>=</mml:mo></mml:mtd><mml:mtd><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:msup><mml:mi>h</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:mrow><mml:mi>L</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:msup><mml:mi>h</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>As more high-scoring topologies are constructed, the bounding criterion becomes more strict, allowing both more and earlier abandoning of unproductive construction sequences. The branch-and-bound strategy guarantees that the <inline-formula><mml:math id="inf37"><mml:mi>N</mml:mi></mml:math></inline-formula> topologies remaining on the list after all active assemblies have been completed or abandoned are the <inline-formula><mml:math id="inf38"><mml:mi>N</mml:mi></mml:math></inline-formula> highest scoring topologies according to the scoring function.</p></sec></sec></sec><sec id="s4-3"><title>Simulation of sequence evolution</title><p>Random 15-leaf phylogenies were generated at <ext-link ext-link-type="uri" xlink:href="http://www.trex.uqam.ca">www.trex.uqam.ca</ext-link> (<xref ref-type="bibr" rid="bib5">Boc et al., 2012</xref>) using the procedure of <xref ref-type="bibr" rid="bib26">Kuhner and Felsenstein (1994)</xref>. Human tyrosine kinase domains were aligned using MAFFT L-INS-i with default parameters. This alignment was used as the template for sequence simulations as follows. The alignment was divided into 24 segments on the basis of local sequence similarity and analysis of solved tyrosine kinase structures. Each segment was assigned a substitution rate scaling factor and an insertion/deletion model to match degree of conservation and solvent exposure in solved structures. Simulation was carried out over synthetic phylogenies using indel-seq-gen (<xref ref-type="bibr" rid="bib62">Strope et al., 2007</xref>; <xref ref-type="bibr" rid="bib63">Strope et al., 2009</xref>; <xref ref-type="bibr" rid="bib49">Rambaut and Grass, 1997</xref>) under the JTT substitution model.</p><p>All sequence simulation materials, including synthetic phylogenies, the template alignment, and indel-seq-gen control files, as well as simulated sequence alignments are available via Figshare (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.5263885.v1">https://doi.org/10.6084/m9.figshare.5263885.v1</ext-link>).</p></sec><sec id="s4-4"><title>Phylogeny inference</title><p>All-sequence phylogenies were inferred using all combinations of MAFFT L-INS-i, ClustalOmega, and Muscle for sequence alignment with FastTree2 and RAxML for phylogeny inference. Subsampled phylogenies for precision calculations were inferred with FastTree2 only, due to run time considerations. Subsampled phylogenies for ensembles used by ASPEN were reconstructed using L-INS-i and FastTree2 only.</p><p>Alignment algorithms were used with their default settings. FastTree2 was used with default settings and the WAG substitution model. RAxML was used with default settings and the PROTGAMMAWAGF variant of the WAG substitution model. The WAG substitution model was deliberately used for topology inference, instead of the JTT substitution model used for simulating protein families, in order to emulate the more realistic scenario where models used for reconstruction of phylogenies for natural families do not precisely match the substitution patterns in those families.</p><p>Accuracy and precision of reconstruction for a protein family are defined in terms of the L-INS-i/FastTree2 all-sequence and subsampled topologies.</p></sec><sec id="s4-5"><title>Assessment of alignment robustness</title><p>Robustness of sequence alignment to perturbations of alignment algorithm parameters (guide tree, sequence direction, and gap insertion penalty) was assessed with Guidance2 software (<xref ref-type="bibr" rid="bib28">Landan and Graur, 2007</xref>; <xref ref-type="bibr" rid="bib56">Sela et al., 2015</xref>). Because MAFFT L-INS-i was used for phylogeny inference, we assessed the robustness of alignment with this accuracy-oriented protocol, rather than the Guidance2 default, the speed-oriented MAFFT FFT-NS protocol. Because L-INS-i is substantially slower than FFT-NS, for each all-sequence alignment 15 alternative guide trees were used (resulting in 60 total alternative alignments) instead of the Guidance2 default of 100 alternative guide trees (400 total alternative alignments).</p></sec><sec id="s4-6"><title>Modified Robinson-Foulds topology distance metric</title><p>The Robinson-Foulds (<xref ref-type="bibr" rid="bib52">Robinson and Foulds, 1981</xref>) (<inline-formula><mml:math id="inf39"><mml:mrow><mml:mi>R</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:math></inline-formula>) metric is defined in terms of leaf partitions at internal topology nodes for two topologies with identical sets of leaves. For a tree with <inline-formula><mml:math id="inf40"><mml:mi>N</mml:mi></mml:math></inline-formula> leaves there are <inline-formula><mml:math id="inf41"><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> informative splits. The normalized form of the Robinson-Foulds comparison metric for two topologies, <inline-formula><mml:math id="inf42"><mml:mi>A</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf43"><mml:mi>B</mml:mi></mml:math></inline-formula>, is:<disp-formula id="equ7"><label>(3)</label><mml:math id="m7"><mml:mrow><mml:mi>R</mml:mi><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf44"><mml:mi>x</mml:mi></mml:math></inline-formula> is the number of leaf partitions in <inline-formula><mml:math id="inf45"><mml:mi>A</mml:mi></mml:math></inline-formula> but not in <inline-formula><mml:math id="inf46"><mml:mi>B</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf47"><mml:mi>y</mml:mi></mml:math></inline-formula> is the number of leaf partitions in <inline-formula><mml:math id="inf48"><mml:mi>B</mml:mi></mml:math></inline-formula> but not in <inline-formula><mml:math id="inf49"><mml:mi>A</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf50"><mml:mi>N</mml:mi></mml:math></inline-formula> is the number of leaves in each topology, and <inline-formula><mml:math id="inf51"><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>6</mml:mn><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is the total number of informative splits in the two topologies.</p><p>In order to compare reconstructed ancestor divergence topologies, we had to modify the <inline-formula><mml:math id="inf52"><mml:mrow><mml:mi>R</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:math></inline-formula> metric to accommodate cases when the ancestor of a descendant sequence set has as descendants one or more other ancestors (non-monophyletic reconstruction). Such topologies are poorly formed because they require inference of additional unobservable events – loss of paralogs in some lineages – in order to be reconciled with a duplication/speciation divergence history. Because the offending subsample cannot be pruned to a common ancestor leaf, the resulting topology cannot be compared to properly formed topologies (e.g. the true topology) using the standard <inline-formula><mml:math id="inf53"><mml:mrow><mml:mi>R</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:math></inline-formula> metric. In effect, when sequence leaves and speciation internal nodes of the offending descendant set are pruned, the resulting topology is missing a leaf, because the corresponding ancestor maps to an internal node. That node is ambiguous in its duplication vs speciation status. Nevertheless, internal nodes representing pre-duplication ancestors of the offending ancestor (and the descendant set representing it) and other ancestors of designated descendant sets can match equivalent nodes in other topologies in terms of induced partition of designated ancestors. Our modified version, <inline-formula><mml:math id="inf54"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, can account for this.</p><p>In <inline-formula><mml:math id="inf55"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf56"><mml:mi>N</mml:mi></mml:math></inline-formula> represents the number of designated ancestors (descendant sets) in each compared topology, not the number of leaves. In addition to <inline-formula><mml:math id="inf57"><mml:mi>x</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf58"><mml:mi>y</mml:mi></mml:math></inline-formula> we define <inline-formula><mml:math id="inf59"><mml:mi>z</mml:mi></mml:math></inline-formula> as the number of common ancestor leaves missing from <inline-formula><mml:math id="inf60"><mml:mi>A</mml:mi></mml:math></inline-formula> but not from <inline-formula><mml:math id="inf61"><mml:mi>B</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf62"><mml:msup><mml:mi>z</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math></inline-formula> as the number of common ancestor leaves missing from <inline-formula><mml:math id="inf63"><mml:mi>B</mml:mi></mml:math></inline-formula> but not from <inline-formula><mml:math id="inf64"><mml:mi>A</mml:mi></mml:math></inline-formula>. The modified metric is calculated as:<disp-formula id="equ8"><label>(4)</label><mml:math id="m8"><mml:mrow><mml:mi>R</mml:mi><mml:msup><mml:mi>F</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>z</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mi>z</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p></sec><sec id="s4-7"><title>ASPEN</title><p>ASPEN is implemented in python 2.7. The ASPEN development repository is publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/NaegleLab/ASPEN">https://github.com/NaegleLab/ASPEN</ext-link> (<xref ref-type="bibr" rid="bib60">Sloutsky and Naegle, 2019</xref>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/ASPEN">https://github.com/elifesciences-publications/ASPEN</ext-link>). </p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>This work was partially enabled by Center for Biological Systems Engineering. Computations were performed using the facilities of the Washington University Center for High Performance Computing, which were partially funded by NIH grants 1S10RR022984-01A1 and 1S10OD018091-01. Additionally, we would like to acknowledge Research Computing at The University of Virginia for providing computational resources and technical support that have contributed to the results reported within this publication. We wish to thank Dr. Tom Ronan, Dr. Barak Cohen, Dr. Gary Stormo, Dr. Justin Fay, and Dr. Jim Havranek for the helpful discussions that shaped this work, as well as editor Antonis Rokas and reviewers, Dr. Rama Ranganathan, Dr. Itamar Sela, Dr. Luke Wheeler, for their helpful suggestions.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Resources, Formal analysis, Supervision, Funding acquisition, Visualization, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="supp1"><object-id pub-id-type="doi">10.7554/eLife.47676.021</object-id><label>Supplementary file 1.</label><caption><title>1777 sequences from the LacI family, split among 23 orthosets, and the top 500 topologies reconstructed by ASPEN for the LacI family.</title></caption><media mime-subtype="zip" mimetype="application" xlink:href="elife-47676-supp1-v1.zip"/></supplementary-material><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.47676.022</object-id><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-47676-transrepform-v1.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>All input sequences are provided for simulated (<ext-link ext-link-type="uri" xlink:href="http://doi.org/10.6084/m9.figshare.5263885">http://doi.org/10.6084/m9.figshare.5263885</ext-link>) and LacI (supplementary material) protein families. Code used to perform ASPEN topology reconstruction is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/NaegleLab/ASPEN">https://github.com/NaegleLab/ASPEN</ext-link> (copy archived at<ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/ASPEN">https://github.com/elifesciences-publications/ASPEN</ext-link>).</p><p>The following dataset was generated:</p><p><element-citation id="dataset1" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Roman</surname><given-names>Sloutsky</given-names></name><name><surname>Kristen</surname><given-names>Naegle</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>Simulation Materials for ASPEN</data-title><source>figshare</source><pub-id assigning-authority="figshare" pub-id-type="doi">10.6084/m9.figshare.5263885</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aken</surname> <given-names>BL</given-names></name><name><surname>Achuthan</surname> <given-names>P</given-names></name><name><surname>Akanni</surname> <given-names>W</given-names></name><name><surname>Amode</surname> <given-names>MR</given-names></name><name><surname>Bernsdorff</surname> <given-names>F</given-names></name><name><surname>Bhai</surname> <given-names>J</given-names></name><name><surname>Billis</surname> <given-names>K</given-names></name><name><surname>Carvalho-Silva</surname> <given-names>D</given-names></name><name><surname>Cummins</surname> <given-names>C</given-names></name><name><surname>Clapham</surname> <given-names>P</given-names></name><name><surname>Gil</surname> <given-names>L</given-names></name><name><surname>Girón</surname> <given-names>CG</given-names></name><name><surname>Gordon</surname> <given-names>L</given-names></name><name><surname>Hourlier</surname> <given-names>T</given-names></name><name><surname>Hunt</surname> <given-names>SE</given-names></name><name><surname>Janacek</surname> <given-names>SH</given-names></name><name><surname>Juettemann</surname> <given-names>T</given-names></name><name><surname>Keenan</surname> <given-names>S</given-names></name><name><surname>Laird</surname> <given-names>MR</given-names></name><name><surname>Lavidas</surname> <given-names>I</given-names></name><name><surname>Maurel</surname> <given-names>T</given-names></name><name><surname>McLaren</surname> <given-names>W</given-names></name><name><surname>Moore</surname> <given-names>B</given-names></name><name><surname>Murphy</surname> <given-names>DN</given-names></name><name><surname>Nag</surname> <given-names>R</given-names></name><name><surname>Newman</surname> <given-names>V</given-names></name><name><surname>Nuhn</surname> <given-names>M</given-names></name><name><surname>Ong</surname> <given-names>CK</given-names></name><name><surname>Parker</surname> <given-names>A</given-names></name><name><surname>Patricio</surname> <given-names>M</given-names></name><name><surname>Riat</surname> <given-names>HS</given-names></name><name><surname>Sheppard</surname> <given-names>D</given-names></name><name><surname>Sparrow</surname> <given-names>H</given-names></name><name><surname>Taylor</surname> <given-names>K</given-names></name><name><surname>Thormann</surname> <given-names>A</given-names></name><name><surname>Vullo</surname> <given-names>A</given-names></name><name><surname>Walts</surname> <given-names>B</given-names></name><name><surname>Wilder</surname> <given-names>SP</given-names></name><name><surname>Zadissa</surname> <given-names>A</given-names></name><name><surname>Kostadima</surname> <given-names>M</given-names></name><name><surname>Martin</surname> <given-names>FJ</given-names></name><name><surname>Muffato</surname> <given-names>M</given-names></name><name><surname>Perry</surname> <given-names>E</given-names></name><name><surname>Ruffier</surname> <given-names>M</given-names></name><name><surname>Staines</surname> <given-names>DM</given-names></name><name><surname>Trevanion</surname> <given-names>SJ</given-names></name><name><surname>Cunningham</surname> <given-names>F</given-names></name><name><surname>Yates</surname> <given-names>A</given-names></name><name><surname>Zerbino</surname> <given-names>DR</given-names></name><name><surname>Flicek</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Ensembl 2017</article-title><source>Nucleic Acids Research</source><volume>45</volume><fpage>D635</fpage><lpage>D642</lpage><pub-id pub-id-type="doi">10.1093/nar/gkw1104</pub-id><pub-id pub-id-type="pmid">27899575</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arenas</surname> <given-names>M</given-names></name><name><surname>Dos Santos</surname> <given-names>HG</given-names></name><name><surname>Posada</surname> <given-names>D</given-names></name><name><surname>Bastolla</surname> <given-names>U</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Protein evolution along phylogenetic histories under structurally constrained substitution models</article-title><source>Bioinformatics</source><volume>29</volume><fpage>3020</fpage><lpage>3028</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btt530</pub-id><pub-id pub-id-type="pmid">24037213</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benson</surname> <given-names>DA</given-names></name><name><surname>Cavanaugh</surname> <given-names>M</given-names></name><name><surname>Clark</surname> <given-names>K</given-names></name><name><surname>Karsch-Mizrachi</surname> <given-names>I</given-names></name><name><surname>Lipman</surname> <given-names>DJ</given-names></name><name><surname>Ostell</surname> <given-names>J</given-names></name><name><surname>Sayers</surname> <given-names>EW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>GenBank</article-title><source>Nucleic Acids Research</source><volume>45</volume><fpage>D37</fpage><lpage>D42</lpage><pub-id pub-id-type="doi">10.1093/nar/gkw1070</pub-id><pub-id pub-id-type="pmid">27899564</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blackburne</surname> <given-names>BP</given-names></name><name><surname>Whelan</surname> <given-names>S</given-names></name><name><surname>Kingdom</surname> <given-names>MU</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Faculty of life sciences. Class of multiple sequence alignment algorithm affects genomic analysis</article-title><source>Molecular Biology and Evolution</source><volume>30</volume><fpage>642</fpage><lpage>653</lpage><pub-id pub-id-type="doi">10.1093/molbev/mss256</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boc</surname> <given-names>A</given-names></name><name><surname>Diallo</surname> <given-names>AB</given-names></name><name><surname>Makarenkov</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>T-REX: a web server for inferring, validating and visualizing phylogenetic trees and networks</article-title><source>Nucleic Acids Research</source><volume>40</volume><fpage>W573</fpage><lpage>W579</lpage><pub-id pub-id-type="doi">10.1093/nar/gks485</pub-id><pub-id pub-id-type="pmid">22675075</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>MJ</given-names></name><name><surname>Dixon</surname> <given-names>JE</given-names></name><name><surname>Manning</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Genomics and evolution of protein phosphatases</article-title><source>Science Signaling</source><volume>10</volume><elocation-id>eaag1796</elocation-id><pub-id pub-id-type="doi">10.1126/scisignal.aag1796</pub-id><pub-id pub-id-type="pmid">28400531</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Choi</surname> <given-names>SC</given-names></name><name><surname>Hobolth</surname> <given-names>A</given-names></name><name><surname>Robinson</surname> <given-names>DM</given-names></name><name><surname>Kishino</surname> <given-names>H</given-names></name><name><surname>Thorne</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Quantifying the impact of protein tertiary structure on molecular evolution</article-title><source>Molecular Biology and Evolution</source><volume>24</volume><fpage>1769</fpage><lpage>1782</lpage><pub-id pub-id-type="doi">10.1093/molbev/msm097</pub-id><pub-id pub-id-type="pmid">17522088</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daugherty</surname> <given-names>MD</given-names></name><name><surname>Schaller</surname> <given-names>AM</given-names></name><name><surname>Geballe</surname> <given-names>AP</given-names></name><name><surname>Malik</surname> <given-names>HS</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Evolution-guided functional analyses reveal diverse antiviral specificities encoded by IFIT1 genes in mammals</article-title><source>eLife</source><volume>5</volume><elocation-id>e14228</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.14228</pub-id><pub-id pub-id-type="pmid">27240734</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Edgar</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>MUSCLE: multiple sequence alignment with high accuracy and high throughput</article-title><source>Nucleic Acids Research</source><volume>32</volume><fpage>1792</fpage><lpage>1797</lpage><pub-id pub-id-type="doi">10.1093/nar/gkh340</pub-id><pub-id pub-id-type="pmid">15034147</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Edgar</surname> <given-names>RC</given-names></name><name><surname>Sjölander</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>SATCHMO: sequence alignment and tree construction using hidden markov models</article-title><source>Bioinformatics</source><volume>19</volume><fpage>1404</fpage><lpage>1411</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btg158</pub-id><pub-id pub-id-type="pmid">12874053</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eick</surname> <given-names>GN</given-names></name><name><surname>Colucci</surname> <given-names>JK</given-names></name><name><surname>Harms</surname> <given-names>MJ</given-names></name><name><surname>Ortlund</surname> <given-names>EA</given-names></name><name><surname>Thornton</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Evolution of minimal specificity and promiscuity in steroid hormone receptors</article-title><source>PLOS Genetics</source><volume>8</volume><elocation-id>e1003072</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1003072</pub-id><pub-id pub-id-type="pmid">23166518</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eick</surname> <given-names>GN</given-names></name><name><surname>Bridgham</surname> <given-names>JT</given-names></name><name><surname>Anderson</surname> <given-names>DP</given-names></name><name><surname>Harms</surname> <given-names>MJ</given-names></name><name><surname>Thornton</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Robustness of reconstructed ancestral protein functions to statistical uncertainty</article-title><source>Molecular Biology and Evolution</source><volume>34</volume><fpage>247</fpage><lpage>261</lpage><pub-id pub-id-type="doi">10.1093/molbev/msw223</pub-id><pub-id pub-id-type="pmid">27795231</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Espinosa-Cantú</surname> <given-names>A</given-names></name><name><surname>Ascencio</surname> <given-names>D</given-names></name><name><surname>Barona-Gómez</surname> <given-names>F</given-names></name><name><surname>DeLuna</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Gene duplication and the evolution of moonlighting proteins</article-title><source>Frontiers in Genetics</source><volume>6</volume><elocation-id>227</elocation-id><pub-id pub-id-type="doi">10.3389/fgene.2015.00227</pub-id><pub-id pub-id-type="pmid">26217376</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Felsenstein</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title>Confidence limits on phylogenies: an approach using the bootstrap</article-title><source>Evolution</source><volume>39</volume><fpage>783</fpage><lpage>791</lpage><pub-id pub-id-type="doi">10.1111/j.1558-5646.1985.tb00420.x.</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fitch</surname> <given-names>WM</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Homology a personal view on some of the problems</article-title><source>Trends in Genetics : TIG</source><volume>16</volume><fpage>227</fpage><lpage>231</lpage><pub-id pub-id-type="doi">10.1016/s0168-9525(00)02005-9</pub-id><pub-id pub-id-type="pmid">10782117</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grahnen</surname> <given-names>JA</given-names></name><name><surname>Nandakumar</surname> <given-names>P</given-names></name><name><surname>Kubelka</surname> <given-names>J</given-names></name><name><surname>Liberles</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Biophysical and structural considerations for protein sequence evolution</article-title><source>BMC Evolutionary Biology</source><volume>11</volume><elocation-id>361</elocation-id><pub-id pub-id-type="doi">10.1186/1471-2148-11-361</pub-id><pub-id pub-id-type="pmid">22171550</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gregoretti</surname> <given-names>IV</given-names></name><name><surname>Lee</surname> <given-names>YM</given-names></name><name><surname>Goodson</surname> <given-names>HV</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Molecular evolution of the histone deacetylase family: functional implications of phylogenetic analysis</article-title><source>Journal of Molecular Biology</source><volume>338</volume><fpage>17</fpage><lpage>31</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2004.02.006</pub-id><pub-id pub-id-type="pmid">15050820</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harms</surname> <given-names>MJ</given-names></name><name><surname>Thornton</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Evolutionary biochemistry: revealing the historical and physical causes of protein properties</article-title><source>Nature Reviews Genetics</source><volume>14</volume><fpage>559</fpage><lpage>571</lpage><pub-id pub-id-type="doi">10.1038/nrg3540</pub-id><pub-id pub-id-type="pmid">23864121</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hedges</surname> <given-names>SB</given-names></name><name><surname>Marin</surname> <given-names>J</given-names></name><name><surname>Suleski</surname> <given-names>M</given-names></name><name><surname>Paymer</surname> <given-names>M</given-names></name><name><surname>Kumar</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Tree of life reveals clock-like speciation and diversification</article-title><source>Molecular Biology and Evolution</source><volume>32</volume><fpage>835</fpage><lpage>845</lpage><pub-id pub-id-type="doi">10.1093/molbev/msv037</pub-id><pub-id pub-id-type="pmid">25739733</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Herrero</surname> <given-names>J</given-names></name><name><surname>Muffato</surname> <given-names>M</given-names></name><name><surname>Beal</surname> <given-names>K</given-names></name><name><surname>Fitzgerald</surname> <given-names>S</given-names></name><name><surname>Gordon</surname> <given-names>L</given-names></name><name><surname>Pignatelli</surname> <given-names>M</given-names></name><name><surname>Vilella</surname> <given-names>AJ</given-names></name><name><surname>Searle</surname> <given-names>SM</given-names></name><name><surname>Amode</surname> <given-names>R</given-names></name><name><surname>Brent</surname> <given-names>S</given-names></name><name><surname>Spooner</surname> <given-names>W</given-names></name><name><surname>Kulesha</surname> <given-names>E</given-names></name><name><surname>Yates</surname> <given-names>A</given-names></name><name><surname>Flicek</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Ensembl comparative genomics resources</article-title><source>Database</source><volume>2016</volume><elocation-id>baw053</elocation-id><pub-id pub-id-type="doi">10.1093/database/baw053</pub-id><pub-id pub-id-type="pmid">27141089</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huelsenbeck</surname> <given-names>JP</given-names></name><name><surname>Nielsen</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Effect of nonindependent substitution on phylogenetic accuracy</article-title><source>Systematic Biology</source><volume>48</volume><fpage>317</fpage><lpage>328</lpage><pub-id pub-id-type="doi">10.1080/106351599260319</pub-id><pub-id pub-id-type="pmid">12066710</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kamneva</surname> <given-names>OK</given-names></name><name><surname>Ward</surname> <given-names>NL</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Reconciliation approaches to determining HGT, duplications, and losses in gene trees</article-title><source>Methods in Microbiology</source><volume>41</volume><fpage>183</fpage><lpage>200</lpage><pub-id pub-id-type="doi">10.1016/bs.mim.2014.08.004</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Katoh</surname> <given-names>K</given-names></name><name><surname>Standley</surname> <given-names>DM</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>MAFFT multiple sequence alignment software version 7: improvements in performance and usability</article-title><source>Molecular Biology and Evolution</source><volume>30</volume><fpage>772</fpage><lpage>780</lpage><pub-id pub-id-type="doi">10.1093/molbev/mst010</pub-id><pub-id pub-id-type="pmid">23329690</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Katoh</surname> <given-names>K</given-names></name><name><surname>Standley</surname> <given-names>DM</given-names></name></person-group><year iso-8601-date="2014">2014</year><chapter-title>MAFFT: iterative refinement and additional methods</chapter-title><source>Methods in Molecular Biology</source><volume>1079</volume><publisher-loc>United States</publisher-loc><publisher-name>Humana Press</publisher-name><fpage>131</fpage><lpage>146</lpage></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Koonin</surname> <given-names>EV</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Orthologs, paralogs, and evolutionary genomics</article-title><source>Annual Review of Genetics</source><volume>39</volume><fpage>309</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1146/annurev.genet.39.073003.114725</pub-id><pub-id pub-id-type="pmid">16285863</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuhner</surname> <given-names>MK</given-names></name><name><surname>Felsenstein</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>A simulation comparison of phylogeny algorithms under equal and unequal evolutionary rates</article-title><source>Molecular Biology and Evolution</source><volume>11</volume><fpage>459</fpage><lpage>468</lpage><pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a040126</pub-id><pub-id pub-id-type="pmid">8015439</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kumar</surname> <given-names>S</given-names></name><name><surname>Stecher</surname> <given-names>G</given-names></name><name><surname>Suleski</surname> <given-names>M</given-names></name><name><surname>Hedges</surname> <given-names>SB</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>TimeTree: a resource for timelines, timetrees, and divergence times</article-title><source>Molecular Biology and Evolution</source><volume>34</volume><fpage>1812</fpage><lpage>1819</lpage><pub-id pub-id-type="doi">10.1093/molbev/msx116</pub-id><pub-id pub-id-type="pmid">28387841</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Landan</surname> <given-names>G</given-names></name><name><surname>Graur</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Heads or tails: a simple reliability check for multiple sequence alignments</article-title><source>Molecular Biology and Evolution</source><volume>24</volume><fpage>1380</fpage><lpage>1383</lpage><pub-id pub-id-type="doi">10.1093/molbev/msm060</pub-id><pub-id pub-id-type="pmid">17387100</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname> <given-names>BA</given-names></name><name><surname>Jablonowski</surname> <given-names>K</given-names></name><name><surname>Raina</surname> <given-names>M</given-names></name><name><surname>Arcé</surname> <given-names>M</given-names></name><name><surname>Pawson</surname> <given-names>T</given-names></name><name><surname>Nash</surname> <given-names>PD</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>The human and mouse complement of SH2 domain proteins-establishing the boundaries of phosphotyrosine signaling</article-title><source>Molecular Cell</source><volume>22</volume><fpage>851</fpage><lpage>868</lpage><pub-id pub-id-type="doi">10.1016/j.molcel.2006.06.001</pub-id><pub-id pub-id-type="pmid">16793553</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname> <given-names>K</given-names></name><name><surname>Raghavan</surname> <given-names>S</given-names></name><name><surname>Nelesen</surname> <given-names>S</given-names></name><name><surname>Linder</surname> <given-names>CR</given-names></name><name><surname>Warnow</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Rapid and accurate large-scale coestimation of sequence alignments and phylogenetic trees</article-title><source>Science</source><volume>324</volume><fpage>1561</fpage><lpage>1564</lpage><pub-id pub-id-type="doi">10.1126/science.1171243</pub-id><pub-id pub-id-type="pmid">19541996</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname> <given-names>K</given-names></name><name><surname>Linder</surname> <given-names>CR</given-names></name><name><surname>Warnow</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Multiple sequence alignment: a major challenge to large-scale phylogenetics</article-title><source>PLOS Currents</source><volume>2</volume><elocation-id>RRN1198</elocation-id><pub-id pub-id-type="doi">10.1371/currents.RRN1198</pub-id><pub-id pub-id-type="pmid">21113338</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname> <given-names>K</given-names></name><name><surname>Linder</surname> <given-names>CR</given-names></name><name><surname>Warnow</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>RAxML and FastTree: comparing two methods for large-scale maximum likelihood phylogeny estimation</article-title><source>PLOS ONE</source><volume>6</volume><elocation-id>e27731</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0027731</pub-id><pub-id pub-id-type="pmid">22132132</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname> <given-names>K</given-names></name><name><surname>Warnow</surname> <given-names>TJ</given-names></name><name><surname>Holder</surname> <given-names>MT</given-names></name><name><surname>Nelesen</surname> <given-names>SM</given-names></name><name><surname>Yu</surname> <given-names>J</given-names></name><name><surname>Stamatakis</surname> <given-names>AP</given-names></name><name><surname>Linder</surname> <given-names>CR</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>SATe-II: very fast and accurate simultaneous estimation of multiple sequence alignments and phylogenetic trees</article-title><source>Systematic Biology</source><volume>61</volume><fpage>90</fpage><lpage>106</lpage><pub-id pub-id-type="doi">10.1093/sysbio/syr095</pub-id><pub-id pub-id-type="pmid">22139466</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Manning</surname> <given-names>G</given-names></name><name><surname>Whyte</surname> <given-names>DB</given-names></name><name><surname>Martinez</surname> <given-names>R</given-names></name><name><surname>Hunter</surname> <given-names>T</given-names></name><name><surname>Sudarsanam</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>The protein kinase complement of the human genome</article-title><source>Science</source><volume>298</volume><fpage>1912</fpage><lpage>1934</lpage><pub-id pub-id-type="doi">10.1126/science.1075762</pub-id><pub-id pub-id-type="pmid">12471243</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mirarab</surname> <given-names>S</given-names></name><name><surname>Nguyen</surname> <given-names>N</given-names></name><name><surname>Guo</surname> <given-names>S</given-names></name><name><surname>Wang</surname> <given-names>LS</given-names></name><name><surname>Kim</surname> <given-names>J</given-names></name><name><surname>Warnow</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>PASTA: ultra-large multiple sequence alignment for nucleotide and Amino-Acid sequences</article-title><source>Journal of Computational Biology</source><volume>22</volume><fpage>377</fpage><lpage>386</lpage><pub-id pub-id-type="doi">10.1089/cmb.2014.0156</pub-id><pub-id pub-id-type="pmid">25549288</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morrison</surname> <given-names>DA</given-names></name><name><surname>Ellis</surname> <given-names>JT</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Effects of nucleotide sequence alignment on phylogeny estimation: a case study of 18S rDNAs of apicomplexa</article-title><source>Molecular Biology and Evolution</source><volume>14</volume><fpage>428</fpage><lpage>441</lpage><pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a025779</pub-id><pub-id pub-id-type="pmid">9100373</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mugridge</surname> <given-names>NB</given-names></name><name><surname>Morrison</surname> <given-names>DA</given-names></name><name><surname>Jäkel</surname> <given-names>T</given-names></name><name><surname>Heckeroth</surname> <given-names>AR</given-names></name><name><surname>Tenter</surname> <given-names>AM</given-names></name><name><surname>Johnson</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Effects of Sequence Alignment and Structural Domains of Ribosomal DNA on Phylogeny Reconstruction for the Protozoan Family Sarcocystidae</article-title><source>Molecular Biology and Evolution</source><volume>17</volume><fpage>1842</fpage><lpage>1853</lpage><pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a026285</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakhleh</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Computational approaches to species phylogeny inference and gene tree reconciliation</article-title><source>Trends in Ecology &amp; Evolution</source><volume>28</volume><fpage>719</fpage><lpage>728</lpage><pub-id pub-id-type="doi">10.1016/j.tree.2013.09.004</pub-id><pub-id pub-id-type="pmid">24094331</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nasrallah</surname> <given-names>CA</given-names></name><name><surname>Mathews</surname> <given-names>DH</given-names></name><name><surname>Huelsenbeck</surname> <given-names>JP</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Quantifying the impact of dependent evolution among sites in phylogenetic inference</article-title><source>Systematic Biology</source><volume>60</volume><fpage>60</fpage><lpage>73</lpage><pub-id pub-id-type="doi">10.1093/sysbio/syq074</pub-id><pub-id pub-id-type="pmid">21081481</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nijman</surname> <given-names>SM</given-names></name><name><surname>Luna-Vargas</surname> <given-names>MP</given-names></name><name><surname>Velds</surname> <given-names>A</given-names></name><name><surname>Brummelkamp</surname> <given-names>TR</given-names></name><name><surname>Dirac</surname> <given-names>AM</given-names></name><name><surname>Sixma</surname> <given-names>TK</given-names></name><name><surname>Bernards</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>A genomic and functional inventory of deubiquitinating enzymes</article-title><source>Cell</source><volume>123</volume><fpage>773</fpage><lpage>786</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2005.11.007</pub-id><pub-id pub-id-type="pmid">16325574</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ogden</surname> <given-names>TH</given-names></name><name><surname>Rosenberg</surname> <given-names>MS</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Multiple sequence alignment accuracy and phylogenetic inference</article-title><source>Systematic Biology</source><volume>55</volume><fpage>314</fpage><lpage>328</lpage><pub-id pub-id-type="doi">10.1080/10635150500541730</pub-id><pub-id pub-id-type="pmid">16611602</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parisi</surname> <given-names>G</given-names></name><name><surname>Echave</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Structural constraints and emergence of sequence patterns in protein evolution</article-title><source>Molecular Biology and Evolution</source><volume>18</volume><fpage>750</fpage><lpage>756</lpage><pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a003857</pub-id><pub-id pub-id-type="pmid">11319259</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parmentier</surname> <given-names>G</given-names></name><name><surname>Trystram</surname> <given-names>D</given-names></name><name><surname>Zola</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Large scale multiple sequence alignment with simultaneous phylogeny inference</article-title><source>Journal of Parallel and Distributed Computing</source><volume>66</volume><fpage>1534</fpage><lpage>1545</lpage><pub-id pub-id-type="doi">10.1016/j.jpdc.2006.03.003</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Penn</surname> <given-names>O</given-names></name><name><surname>Privman</surname> <given-names>E</given-names></name><name><surname>Landan</surname> <given-names>G</given-names></name><name><surname>Graur</surname> <given-names>D</given-names></name><name><surname>Pupko</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>An alignment confidence score capturing robustness to guide tree uncertainty</article-title><source>Molecular Biology and Evolution</source><volume>27</volume><fpage>1759</fpage><lpage>1767</lpage><pub-id pub-id-type="doi">10.1093/molbev/msq066</pub-id><pub-id pub-id-type="pmid">20207713</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Price</surname> <given-names>MN</given-names></name><name><surname>Dehal</surname> <given-names>PS</given-names></name><name><surname>Arkin</surname> <given-names>AP</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>FastTree 2--approximately maximum-likelihood trees for large alignments</article-title><source>PLOS ONE</source><volume>5</volume><elocation-id>e9490</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0009490</pub-id><pub-id pub-id-type="pmid">20224823</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Prince</surname> <given-names>VE</given-names></name><name><surname>Pickett</surname> <given-names>FB</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Splitting pairs: the diverging fates of duplicated genes</article-title><source>Nature Reviews Genetics</source><volume>3</volume><fpage>827</fpage><lpage>837</lpage><pub-id pub-id-type="doi">10.1038/nrg928</pub-id><pub-id pub-id-type="pmid">12415313</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Raes</surname> <given-names>J</given-names></name><name><surname>Van de Peer</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Gene duplication, the evolution of novel gene functions, and detecting functional divergence of duplicates in silico</article-title><source>Applied Bioinformatics</source><volume>2</volume><fpage>91</fpage><lpage>101</lpage><pub-id pub-id-type="pmid">15130825</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rahman</surname> <given-names>T</given-names></name><name><surname>Cai</surname> <given-names>X</given-names></name><name><surname>Brailoiu</surname> <given-names>GC</given-names></name><name><surname>Abood</surname> <given-names>ME</given-names></name><name><surname>Brailoiu</surname> <given-names>E</given-names></name><name><surname>Patel</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Two-pore channels provide insight into the evolution of voltage-gated Ca2+ and na+ channels</article-title><source>Science Signaling</source><volume>7</volume><elocation-id>ra109</elocation-id><pub-id pub-id-type="doi">10.1126/scisignal.2005450</pub-id><pub-id pub-id-type="pmid">25406377</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rambaut</surname> <given-names>A</given-names></name><name><surname>Grass</surname> <given-names>NC</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Seq-Gen: an application for the monte carlo simulation of DNA sequence evolution along phylogenetic trees</article-title><source>Bioinformatics</source><volume>13</volume><fpage>235</fpage><lpage>238</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/13.3.235</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Redelings</surname> <given-names>BD</given-names></name><name><surname>Suchard</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Joint bayesian estimation of alignment and phylogeny</article-title><source>Systematic Biology</source><volume>54</volume><fpage>401</fpage><lpage>418</lpage><pub-id pub-id-type="doi">10.1080/10635150590947041</pub-id><pub-id pub-id-type="pmid">16012107</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname> <given-names>DM</given-names></name><name><surname>Jones</surname> <given-names>DT</given-names></name><name><surname>Kishino</surname> <given-names>H</given-names></name><name><surname>Goldman</surname> <given-names>N</given-names></name><name><surname>Thorne</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Protein evolution with dependence among codons due to tertiary structure</article-title><source>Molecular Biology and Evolution</source><volume>20</volume><fpage>1692</fpage><lpage>1704</lpage><pub-id pub-id-type="doi">10.1093/molbev/msg184</pub-id><pub-id pub-id-type="pmid">12885968</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname> <given-names>DF</given-names></name><name><surname>Foulds</surname> <given-names>LR</given-names></name></person-group><year iso-8601-date="1981">1981</year><article-title>Comparison of phylogenetic trees</article-title><source>Mathematical Biosciences</source><volume>53</volume><fpage>131</fpage><lpage>147</lpage><pub-id pub-id-type="doi">10.1016/0025-5564(81)90043-2</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rodrigue</surname> <given-names>N</given-names></name><name><surname>Lartillot</surname> <given-names>N</given-names></name><name><surname>Bryant</surname> <given-names>D</given-names></name><name><surname>Philippe</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Site interdependence attributed to tertiary structure in amino acid sequence evolution</article-title><source>Gene</source><volume>347</volume><fpage>207</fpage><lpage>217</lpage><pub-id pub-id-type="doi">10.1016/j.gene.2004.12.011</pub-id><pub-id pub-id-type="pmid">15733531</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rojas</surname> <given-names>AM</given-names></name><name><surname>Fuentes</surname> <given-names>G</given-names></name><name><surname>Rausell</surname> <given-names>A</given-names></name><name><surname>Valencia</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The ras protein superfamily: evolutionary tree and role of conserved amino acids</article-title><source>The Journal of Cell Biology</source><volume>196</volume><fpage>189</fpage><lpage>201</lpage><pub-id pub-id-type="doi">10.1083/jcb.201103008</pub-id><pub-id pub-id-type="pmid">22270915</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salichos</surname> <given-names>L</given-names></name><name><surname>Rokas</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Inferring ancient divergences requires genes with strong phylogenetic signals</article-title><source>Nature</source><volume>497</volume><fpage>327</fpage><lpage>331</lpage><pub-id pub-id-type="doi">10.1038/nature12130</pub-id><pub-id pub-id-type="pmid">23657258</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sela</surname> <given-names>I</given-names></name><name><surname>Ashkenazy</surname> <given-names>H</given-names></name><name><surname>Katoh</surname> <given-names>K</given-names></name><name><surname>Pupko</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>GUIDANCE2: accurate detection of unreliable alignment regions accounting for the uncertainty of multiple parameters</article-title><source>Nucleic Acids Research</source><volume>43</volume><fpage>W7</fpage><lpage>W14</lpage><pub-id pub-id-type="doi">10.1093/nar/gkv318</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sievers</surname> <given-names>F</given-names></name><name><surname>Wilm</surname> <given-names>A</given-names></name><name><surname>Dineen</surname> <given-names>D</given-names></name><name><surname>Gibson</surname> <given-names>TJ</given-names></name><name><surname>Karplus</surname> <given-names>K</given-names></name><name><surname>Li</surname> <given-names>W</given-names></name><name><surname>Lopez</surname> <given-names>R</given-names></name><name><surname>McWilliam</surname> <given-names>H</given-names></name><name><surname>Remmert</surname> <given-names>M</given-names></name><name><surname>Söding</surname> <given-names>J</given-names></name><name><surname>Thompson</surname> <given-names>JD</given-names></name><name><surname>Higgins</surname> <given-names>DG</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Fast, scalable generation of high-quality protein multiple sequence alignments using clustal omega</article-title><source>Molecular Systems Biology</source><volume>7</volume><elocation-id>539</elocation-id><pub-id pub-id-type="doi">10.1038/msb.2011.75</pub-id><pub-id pub-id-type="pmid">21988835</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sievers</surname> <given-names>F</given-names></name><name><surname>Dineen</surname> <given-names>D</given-names></name><name><surname>Wilm</surname> <given-names>A</given-names></name><name><surname>Higgins</surname> <given-names>DG</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Making automated multiple alignments of very large numbers of protein sequences</article-title><source>Bioinformatics</source><volume>29</volume><fpage>989</fpage><lpage>995</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btt093</pub-id><pub-id pub-id-type="pmid">23428640</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sloutsky</surname> <given-names>R</given-names></name><name><surname>Naegle</surname> <given-names>KM</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>High-Resolution Identification of Specificity Determining Positions in the LacI Protein Family Using Ensembles of Sub-Sampled Alignments</article-title><source>PLOS ONE</source><volume>11</volume><elocation-id>e0162579</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0162579</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Sloutsky</surname> <given-names>R</given-names></name><name><surname>Naegle</surname> <given-names>KM</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>ASPEN</data-title><version designator="bfd54b2">bfd54b2</version><publisher-name>Github</publisher-name><ext-link ext-link-type="uri" xlink:href="https://github.com/NaegleLab/ASPEN">https://github.com/NaegleLab/ASPEN</ext-link></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stamatakis</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>RAxML version 8: a tool for phylogenetic analysis and post-analysis of large phylogenies</article-title><source>Bioinformatics</source><volume>30</volume><fpage>1312</fpage><lpage>1313</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu033</pub-id><pub-id pub-id-type="pmid">24451623</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Strope</surname> <given-names>CL</given-names></name><name><surname>Scott</surname> <given-names>SD</given-names></name><name><surname>Moriyama</surname> <given-names>EN</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>indel-Seq-Gen: a new protein family simulator incorporating domains, motifs, and indels</article-title><source>Molecular Biology and Evolution</source><volume>24</volume><fpage>640</fpage><lpage>649</lpage><pub-id pub-id-type="doi">10.1093/molbev/msl195</pub-id><pub-id pub-id-type="pmid">17158778</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Strope</surname> <given-names>CL</given-names></name><name><surname>Abel</surname> <given-names>K</given-names></name><name><surname>Scott</surname> <given-names>SD</given-names></name><name><surname>Moriyama</surname> <given-names>EN</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Biological sequence simulation for testing complex evolutionary hypotheses: indel-seq-gen version 2.0</article-title><source>Molecular Biology and Evolution</source><volume>26</volume><fpage>2581</fpage><lpage>2593</lpage><pub-id pub-id-type="doi">10.1093/molbev/msp174</pub-id><pub-id pub-id-type="pmid">19651852</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Suchard</surname> <given-names>MA</given-names></name><name><surname>Redelings</surname> <given-names>BD</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>BAli-Phy: simultaneous bayesian inference of alignment and phylogeny</article-title><source>Bioinformatics</source><volume>22</volume><fpage>2047</fpage><lpage>2048</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btl175</pub-id><pub-id pub-id-type="pmid">16679334</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thomson</surname> <given-names>JM</given-names></name><name><surname>Gaucher</surname> <given-names>EA</given-names></name><name><surname>Burgan</surname> <given-names>MF</given-names></name><name><surname>De Kee</surname> <given-names>DW</given-names></name><name><surname>Li</surname> <given-names>T</given-names></name><name><surname>Aris</surname> <given-names>JP</given-names></name><name><surname>Benner</surname> <given-names>SA</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Resurrecting ancestral alcohol dehydrogenases from yeast</article-title><source>Nature Genetics</source><volume>37</volume><fpage>630</fpage><lpage>635</lpage><pub-id pub-id-type="doi">10.1038/ng1553</pub-id><pub-id pub-id-type="pmid">15864308</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>LS</given-names></name><name><surname>Leebens-Mack</surname> <given-names>J</given-names></name><name><surname>Kerr Wall</surname> <given-names>P</given-names></name><name><surname>Beckmann</surname> <given-names>K</given-names></name><name><surname>dePamphilis</surname> <given-names>CW</given-names></name><name><surname>Warnow</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>The impact of multiple protein sequence alignment on phylogenetic estimation</article-title><source>IEEE/ACM Transactions on Computational Biology and Bioinformatics</source><volume>8</volume><fpage>1108</fpage><lpage>1119</lpage><pub-id pub-id-type="doi">10.1109/TCBB.2009.68</pub-id><pub-id pub-id-type="pmid">21566256</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname> <given-names>C</given-names></name><name><surname>Agafonov</surname> <given-names>RV</given-names></name><name><surname>Hoemberger</surname> <given-names>M</given-names></name><name><surname>Kutter</surname> <given-names>S</given-names></name><name><surname>Zorba</surname> <given-names>A</given-names></name><name><surname>Halpin</surname> <given-names>J</given-names></name><name><surname>Buosi</surname> <given-names>V</given-names></name><name><surname>Otten</surname> <given-names>R</given-names></name><name><surname>Waterman</surname> <given-names>D</given-names></name><name><surname>Theobald</surname> <given-names>DL</given-names></name><name><surname>Kern</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Kinase dynamics. Using ancient protein kinases to unravel a modern cancer drug's mechanism</article-title><source>Science</source><volume>347</volume><fpage>882</fpage><lpage>886</lpage><pub-id pub-id-type="doi">10.1126/science.aaa1823</pub-id><pub-id pub-id-type="pmid">25700521</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname> <given-names>KM</given-names></name><name><surname>Suchard</surname> <given-names>MA</given-names></name><name><surname>Huelsenbeck</surname> <given-names>JP</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Alignment uncertainty and genomic analysis</article-title><source>Science</source><volume>319</volume><fpage>473</fpage><lpage>476</lpage><pub-id pub-id-type="doi">10.1126/science.1151532</pub-id><pub-id pub-id-type="pmid">18218900</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname> <given-names>Z</given-names></name><name><surname>Zhu</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Bayesian selection of misspecified models is overconfident and may cause spurious posterior probabilities for phylogenetic trees</article-title><source>PNAS</source><volume>115</volume><fpage>1854</fpage><lpage>1859</lpage><pub-id pub-id-type="doi">10.1073/pnas.1712673115</pub-id><pub-id pub-id-type="pmid">29432193</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.47676.026</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Rokas</surname><given-names>Antonis</given-names></name><role>Reviewing Editor</role><aff><institution>Vanderbilt University</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Ranganathan</surname><given-names>Rama</given-names> </name><role>Reviewer</role><aff><institution>University of Chicago</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Sela</surname><given-names>Itamar</given-names> </name><role>Reviewer</role><aff><institution>National Institute of Health</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Wheeler</surname><given-names>Luke</given-names> </name><role>Reviewer</role><aff><institution>University of Colorado Boulder</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;ASPEN: A methodology for reconstructing protein evolution with improved accuracy using ensemble models&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by peer reviewers, and the evaluation has been overseen by a Reviewing Editor and Patricia Wittkopp as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Rama Ranganathan (Reviewer #1); Itamar Sela (Reviewer #2); Luke Wheeler (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>The study by Sloutsky and Neagle addresses the important problem of how to make good models of the evolutionary history of a protein family given extant sequences. This is a topical, important, and interesting problem, especially given the growing use of sequence databases for understanding the function and evolution of proteins. Protein sequences diverge through two processes that must be distinguished in making an accurate model of their history: speciation events which lead to orthologous sequences and duplication/divergence events that lead to paralogous sequences. The manuscript presents a meta-algorithm, ASPEN, that improves phylogenetic inference of protein families by subsampling sequences and constructing a topology which is supported by subsampled trees. Sampling alignment columns is a common practice which is used to assign bootstrap support values to phylogenetic trees splits, however, in this work the sampling is performed over rows (i.e. sequences). Notably, there is a correlation between &quot;accuracy&quot; (inferred topology quality) and &quot;precision&quot; (statistical support of inferred topology), as defined in the manuscript. Subsampled topologies are incorporated into a subtle branch-to-bound procedure, to construct topology that is statistically supported by many subsamples, rather than a single all-sequence alignment. The resulting constructed topology is shown to be more accurate than all-sequence based topology using a simulated dataset. The developed meta-algorithm will be of considerable interest for scientists that study evolution of protein/gene families and represents an advance in the effort to improve phylogenetic reconstruction by accounting for uncertainties in inference algorithms.</p><p>Essential revisions:</p><p>1) A key general point here is the real difficulty of actually inferring the true specific sequence of mutational events that underlie branches in an evolutionary tree. A very important and insightful concept that is partially expressed in this paper is to question the relevance of wanting to know that information from a point of view of deducing any principles of molecular evolution. The idea that the most invariant aspects of the tree reconstruction are simultaneously the most accurate is interesting and sensible, but isn't what is being proposed here that they are also the most relevant? If so, then this should be discussed and defended in more detail in the conclusions. In this same theme, what do these results mean for the whole community using ancestral reconstruction to infer epistasis along branches of the inferred trees and using such studies to extract principles of protein evolution? And for the interesting claims to having &quot;resurrected&quot; true ancestral states from all-sequence tree reconstructions? More generally, some discussion of what can be claimed and what cannot in reconstruction-based studies given the advances presented here about accuracy and precision in the process of these reconstructions would be valuable to guide the scientific community.</p><p>2) Analyses summarized in Figure 2 (and is also related to Figure 5). Figure 2A suggests that low accuracy topologies result from poor alignments, and are not due to failure of the tree reconstruction algorithm to retrieve the optimal topology for the given alignment. This can be tested directly by analysis of alignments quality. Moreover, since the quality of the inferred tree depends to a large extent on the quality of the alignment, such an analysis can provide a simple explanation for the observed correlation between accuracy and precision. We suggest that you compare the agreement of all-sequence and true alignments in several accuracy bins, as well as perform comparisons of subsampled alignments between themselves and to all-sequence and true alignments.</p><p>A plausible explanation for the accuracy-precision correlation is that different accuracy bins represent different levels of alignment problems complexities. Low complexity alignments are robust with respect to subsampling and are therefore associated with high precision. Complex alignment problems might produce very different subsampled alignments that result in different inferred topologies and low precision. Analysis of the alignments quality can directly support or disprove this hypothesis and better isolate the source of low accuracy (poor alignment or poor topology inference given the alignment).</p><p>Questions about how different scenarios might affect the efficacy of the ASPEN approach.</p><p>3) As noted in the paper, the simulated trees have a fixed number of paralogs. There are no new gene duplications that occur from the oldest ancestral state to the end-state used for reconstruction. How will variability in this feature in real biological trees effect the ASPEN reconstructions? What is the minimum number of &quot;high confidence nodes&quot; that one needs to make this work?</p><p>4) We wonder about using JTT model (or another similar amino acid substitution matrix) to conduct the simulated evolution, because it assumes independent evolution of each site/column. Real proteins will have epistatic interactions due to physical and functional constraints. Does this added complexity change the relationship between precision and accuracy or have some other effect on the efficacy of ASPEN? For example, will there be a deviation in the precision vs. accuracy curve for real proteins (like LacI in this study) relative to simulated proteins, that wouldn't be detectable without knowing the true model?</p><p>Question about software.</p><p>5) We were pleased with the availability of data and materials used in the paper via online repositories. One thing that would be very beneficial, though not necessary for publication of this article, is a thorough documentation of the ASPEN software that the authors have implemented. It will be difficult for any would-be users to dissect how the software functions without documentation. What are the authors' plans regarding providing documentation for the software?</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.47676.027</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) A key general point here is the real difficulty of actually inferring the true specific sequence of mutational events that underlie branches in an evolutionary tree. A very important and insightful concept that is partially expressed in this paper is to question the relevance of wanting to know that information from a point of view of deducing any principles of molecular evolution. The idea that the most invariant aspects of the tree reconstruction are simultaneously the most accurate is interesting and sensible, but isn't what is being proposed here that they are also the most relevant? If so, then this should be discussed and defended in more detail in the conclusions. In this same theme, what do these results mean for the whole community using ancestral reconstruction to infer epistasis along branches of the inferred trees and using such studies to extract principles of protein evolution? And for the interesting claims to having &quot;resurrected&quot; true ancestral states from all-sequence tree reconstructions? More generally, some discussion of what can be claimed and what cannot in reconstruction-based studies given the advances presented here about accuracy and precision in the process of these reconstructions would be valuable to guide the scientific community.</p></disp-quote><p>This is a wonderful summary of the problems phylogenetic inference presents. In fact, we appreciate this summary so much, we almost directly quoted the first line. We have added a new Conclusions section that summarizes this work in context of the field at large.</p><p>We have moved one of the original Discussion paragraphs to the new Conclusions section (covering example real protein family inferences that are ubiquitously used in the field and are likely inaccurate). Additionally, we have added the following two paragraphs to address the essence of the request here.</p><p>“Phylogenetic inference is an extremely difficult problem, particularly for individual protein families, where short amino acid sequences contain limited phylogenetic signal. Here we demonstrated that the sensitivity of inference and alignment algorithms to their inputs is a result of the failure of objective functions to accurately model the mutational events that underlie the divergence nodes in an evolutionary tree, which manifest in both alignment and inference procedures. At their core, phylogenetic trees are hypothetical models of a currently unknowable evolutionary history. George E.P. Box's much quoted philosophy about models is relevant here:</p><p>“Essentially, all models are wrong, but some are useful''. Extending this, we propose that integrating across a lot of models that are wrong in different ways, but right in the same way, yields more useful models of evolutionary divergence. This is based on the observation that topologies capturing more of the shared information across many incorrect models are significantly more accurate. However, we also find that, for especially difficult inference problems (where all-sequence topologies are imprecise, i.e. have low reproducibility under subsampling) it is important to consider multiple models as equally viable explanations of evolutionary history. In other words, for most real evolutionary inference problems, scientists should integrate their analyses over multiple plausible phylogenetic models. The methodology we presented facilitates both an overall assessment of accuracy of topology reconstruction for any particular problem, and, in light of that assessment, reconstruction of an appropriate number of maximally plausible topological models. Crucially, ASPEN is geared toward analysis of precisely the most difficult class ancestors: ancient ancestors of multiple paralogs.</p><p>It should be noted that individual ancestral nodes can vary dramatically in their difficulty of inference, and many ancestors of great biological interest can be inferred with very high accuracy, despite low overall accuracy of topology inference for that family. Moreover, given high confidence in the existence of such an ancestor, reconstruction of that ancestor's sequence is robust with respect to topological uncertainty for the clade below it [Eick et al., 2017]. A critical step in evolutionary analysis, then, is to determine <italic>which</italic> inferred ancestors are reliable – both with respect to systematic biases and with respect to uncertainty due to various sources of random noise – and which are not. ASPEN topologies can be used for this purpose in a fashion similar to the traditional phylogenetic bootstrap, with the additional benefit of evaluating consistency of an ancestor's inference across the most likely topologies.”</p><disp-quote content-type="editor-comment"><p>2) Analyses summarized in Figure 2 (and is also related to Figure 5). Figure 2A suggests that low accuracy topologies result from poor alignments, and are not due to failure of the tree reconstruction algorithm to retrieve the optimal topology for the given alignment. This can be tested directly by analysis of alignments quality. Moreover, since the quality of the inferred tree depends to a large extent on the quality of the alignment, such an analysis can provide a simple explanation for the observed correlation between accuracy and precision. We suggest that you compare the agreement of all-sequence and true alignments in several accuracy bins, as well as perform comparisons of subsampled alignments between themselves and to all-sequence and true alignments.</p><p>A plausible explanation for the accuracy-precision correlation is that different accuracy bins represent different levels of alignment problems complexities. Low complexity alignments are robust with respect to subsampling and are therefore associated with high precision. Complex alignment problems might produce very different subsampled alignments that result in different inferred topologies and low precision. Analysis of the alignments quality can directly support or disprove this hypothesis and better isolate the source of low accuracy (poor alignment or poor topology inference given the alignment).</p></disp-quote><p>Thanks for the great suggestions. At the level of perturbation we are performing, both alignment and topology search are affected and interconnected in their ability to identify models that best describe the data (be it alignment or a tree based on that alignment). In the first draft of the manuscript we knew that alignment error alone cannot explain the phenomenon identified here, since, for families with higher precision, topology inference cannot identify the true topology, given the true alignment: the all-sequence topology (inferred from the all-sequence L-INS-i alignment under the WAG model) has higher likelihood under the JTT model and the true alignment than does the true topology. Under these conditions the scoring procedure in the topology inference algorithm scores inaccurate topologies as better than true topologies, even when given the true alignment and substitution model. We did not sufficiently describe those results in the original manuscript and have expanded on that point.</p><p>We prefer the term “alignment robustness” to “alignment quality”, because the latter seems too subjective. After all, different alignments can serve better or worse for different purposes. In order to address the root question here – can alignment robustness explain the observed relationship between topology precision and topology accuracy? – we performed the suggested experiment and compared the all-seq alignments to the true alignments (we call this alignment accuracy) using the Guidance/Guidance2 sum-of-pairs similarity metric. Indeed, there is a correlation between alignment accuracy and topology accuracy (Pearson Correlation of 0.80), but this correlation is weaker than that of topology precision and topology accuracy (Pearson Correlation of 0.91). The lower correlation is driven by the large deviations in alignment accuracy and a compression in this scale – no all-sequence alignment is completely accurate, yet these can ultimately yield completely accurate trees, and most of the mid-accuracy/mid-precision trees come from all-sequence alignments that are almost wholly different than the true alignment.</p><p>Comparing alignments of subsampled sequences to each other or to the all-sequence or true alignment is problematic, as each subsample has a different collection of sequences. We were concerned that resulting similarity might conflate the intended understanding with the additional variability of randomness of the characteristics in that particular subsample. Instead, we asked whether the reproducibility of the all-sequence alignment (we call this alignment robustness) could explain reproducibility of inferred topologies (precision). We used Guidance2 to measure the all-sequence alignment robustness and found that this is almost perfectly correlated with the all-sequence alignment accuracy (Pearson’s Correlation of 0.97), but does not capture any additional variance of topology accuracy (Pearson’s correlation between alignment precision and tree accuracy is 0.78). Hence, one could use the reproducibility of the all-sequence alignment to predict the accuracy of the all-sequence alignment (a hidden variable) to a great extent, but that value does not translate as precisely to the resulting topology accuracy as does topology precision. We believe this is likely due to the nuances of how and where alignment errors are located and how they ultimately influence the resulting topology.</p><p>In short, the answer to the question asked by the reviewers is yes – alignment accuracy correlates with tree accuracy and, since alignment reproducibility correlates almost perfectly with alignment accuracy, alignment reproducibility also correlates with topology accuracy. However, an emergent relationship exists between topology precision and topology accuracy that gives additional predictive power to topology precision that is not fully explained by either alignment accuracy or alignment reproducibility.</p><p>We have added a new figure and edited the section “Subsampling produces an observable measure of accuracy” to clarify the roles and contributions of alignment vs. topology scoring in the precision/accuracy.</p><disp-quote content-type="editor-comment"><p>Questions about how different scenarios might affect the efficacy of the ASPEN approach.</p><p>3) As noted in the paper, the simulated trees have a fixed number of paralogs. There are no new gene duplications that occur from the oldest ancestral state to the end-state used for reconstruction. How will variability in this feature in real biological trees effect the ASPEN reconstructions? What is the minimum number of &quot;high confidence nodes&quot; that one needs to make this work?</p></disp-quote><p>It is certainly true that real protein families may have additional complexity of speciations, duplications, and gene loss that are not reflected in the specific set of evolutionary circumstances under which we simulated evolution. However, these nuances of duplication/speciation/loss will not affect ASPEN reconstructions, unless one has consistently mis-assigned or cannot confidently assign such a paralog to a node – i.e. it only matters whether subsampling under that node produces consistently monophyletic topology reconstructions. The nature of the node does affect the analysis or the reconstruction.</p><p>The Results subsection “Defining protein families for testing” is expanded, and now states:</p><p>“Evolution of real protein families is rarely that neat. Speciations can predate duplications. Loss of some paralogs in some lineages can result in different collections of paralogs appearing in different genomes, dramatically complicating orthology assignments. […] Therefore, the analysis based on this simulation experiment is applicable without loss of generality.”</p><p>Additionally, we have expanded theDiscussion subsection called “Selection of ancestral nodes for topology search space decomposition”,detailing of the impacts and implications of selection of nodes. We also provide some practical recommendations for identifying high-confidence nodes and handling poorly-behaved leaf sequences.</p><disp-quote content-type="editor-comment"><p>4) We wonder about using JTT model (or another similar amino acid substitution matrix) to conduct the simulated evolution, because it assumes independent evolution of each site/column. Real proteins will have epistatic interactions due to physical and functional constraints. Does this added complexity change the relationship between precision and accuracy or have some other effect on the efficacy of ASPEN? For example, will there be a deviation in the precision vs. accuracy curve for real proteins (like LacI in this study) relative to simulated proteins, that wouldn't be detectable without knowing the true model?</p></disp-quote><p>This is a really interesting and complex question. We believe that a detailed answer to this question requires a careful and extensive study beyond the scope of this manuscript. Answering this question requires using a generative model that incorporates constraints amongst sequence sites reflective of constraints experienced by real protein families. To date, all attempts at this have relied on physical models of protein structure with rather simplistic assumptions (e.g. that the only constraints arise from protein folding requirements) [Arenas et al., 2013; Nasrallah et al., 2011; Grahnen et al., 2011; Choi et al., 2007; Rodrigue et al., 2005; Robinson et al., 2003; Parisi et al., 2001]. Despite their reductionism, are far too computationally intensive for the kind of large-scale sequence evolution simulation we carried out and for phylogenetic reconstruction of the simulated families. In addition, at the moment these models are not available as implementations that can be incorporated into the ASPEN analysis workflow.</p><p>The study of protein evolution as a whole would tremendously benefit from a more realistic treatment of evolutionary constraints experienced by proteins than what is offered by the commonly used substitution models. Algorithmic improvements to make physics based-models more tractable and incorporation of such models into popular sequence simulation and phylogenetic inference software will be necessary to make them more penetrant in the field.</p><p>At this point, we have included our thoughts on this process as part of the new Discussion subsection “Generality of the accuracy-precision relationship”, where we propose that non-independence would ultimately manifest as less overall information on which to build the model, leading to a more complex/difficult inference problem, but not substantively affecting the accuracy-precision relationship.</p><p>New Discussion subsection titled “Generality of the accuracy-precision relationship” covers this topic and others.</p><disp-quote content-type="editor-comment"><p>Question about software.</p><p>5) We were pleased with the availability of data and materials used in the paper via online repositories. One thing that would be very beneficial, though not necessary for publication of this article, is a thorough documentation of the ASPEN software that the authors have implemented. It will be difficult for any would-be users to dissect how the software functions without documentation. What are the authors' plans regarding providing documentation for the software?</p></disp-quote><p>Thank you for the suggestion. We have created a clean repository to accompany this publication (moving the development code to another repository in GitHub) and are in the process of documenting these tools. We did not wish to delay the evaluation of this revision and so this new repository is not yet fully populated. However, it will be complete by the end of September. In this clean repository, we will focus on the most complex aspect of this project: converting many inferred trees into a pairwise distance distribution and performing ASPEN reconstruction of best topologies according that distribution. We will also provide some scripts as examples of how to subsample for the creation of the family of trees. However, we highly recommend users to select their own methods for alignment and inference, and subset size as they see fit. In addition, we hope that upon publication of this manuscript, our ability to secure future funding for development of ASPEN will be improved, allowing us to improve usability and flexibility of ASPEN as a software tool.</p></body></sub-article></article>