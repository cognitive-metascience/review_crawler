<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">41235</article-id><article-id pub-id-type="doi">10.7554/eLife.41235</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Statistical structure of locomotion and its modulation by odors</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-120409"><name><surname>Tao</surname><given-names>Liangyu</given-names></name><email>liangyu.tao1001@gmail.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-120408"><name><surname>Ozarkar</surname><given-names>Siddhi</given-names></name><email>siddhi1294@gmail.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-118162"><name><surname>Beck</surname><given-names>Jeffrey M</given-names></name><email>jeff.beck@duke.edu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-16097"><name><surname>Bhandawat</surname><given-names>Vikas</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-2608-0403</contrib-id><email>vb37@duke.edu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Department of Biology</institution><institution>Duke University</institution><addr-line><named-content content-type="city">Durham</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Neurobiology</institution><institution>Duke University</institution><addr-line><named-content content-type="city">Durham</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Duke Institute for Brain Sciences</institution><institution>Duke University</institution><addr-line><named-content content-type="city">Durham</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Calabrese</surname><given-names>Ronald L</given-names></name><role>Reviewing Editor</role><aff><institution>Emory University</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>VijayRaghavan</surname><given-names>K</given-names></name><role>Senior Editor</role><aff><institution>National Centre for Biological Sciences, Tata Institute of Fundamental Research</institution><country>India</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>08</day><month>01</month><year>2019</year></pub-date><pub-date pub-type="collection"><year>2019</year></pub-date><volume>8</volume><elocation-id>e41235</elocation-id><history><date date-type="received" iso-8601-date="2018-08-21"><day>21</day><month>08</month><year>2018</year></date><date date-type="accepted" iso-8601-date="2019-01-05"><day>05</day><month>01</month><year>2019</year></date></history><permissions><copyright-statement>© 2019, Tao et al</copyright-statement><copyright-year>2019</copyright-year><copyright-holder>Tao et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-41235-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.41235.001</object-id><p>Most behaviors such as making tea are not stereotypical but have an obvious structure. However, analytical methods to objectively extract structure from non-stereotyped behaviors are immature. In this study, we analyze the locomotion of fruit flies and show that this non-stereotyped behavior is well-described by a Hierarchical Hidden Markov Model (HHMM). HHMM shows that a fly's locomotion can be decomposed into a few locomotor features, and odors modulate locomotion by altering the time a fly spends performing different locomotor features. Importantly, although all flies in our dataset use the same set of locomotor features, individual flies vary considerably in how often they employ a given locomotor feature, and how this usage is modulated by odor. This variation is so large that the behavior of individual flies is best understood as being grouped into at least three to five distinct clusters, rather than variations around an average fly.</p></abstract><abstract abstract-type="executive-summary"><object-id pub-id-type="doi">10.7554/eLife.41235.002</object-id><title>eLife digest</title><p>Many behaviors that we perform everyday, including something as familiar as making a peanut-butter sandwich, consist of a sequence of recognizable acts. These acts may include, for example, holding a knife and opening a jar. Yet often neither the sequence nor the individual acts are always performed in the exact same way. For example, there are many ways to hold a knife and there are many ways to open a jar, meaning neither of these actions could be called “stereotyped”.</p><p>A lack of stereotypy makes it difficult for a computer to automatically recognize the individual acts in a sequence. This same problem would apply to other common behaviors, such as walking around somewhere you have not visited before. While we easily recognize it when we see it, walking is not a stereotyped behavior. It consists of a series of movements that differ between individuals, and even in the same individual at different times. So how can someone automatically recognize the individual acts in a non-stereotyped behavior like walking?</p><p>To begin to find out, Tao et al. developed a mathematical model that can recognize the walking behavior of a fruit fly. Existing recordings of fruit flies walking were analyzed using a type of mathematical model called a Hierarchical Hidden Markov Model (often shortened to HHMM). Such models assume that there are hidden states that influence the behaviors we can see. For example, someone’s chances of going skiing (an observable behavior) depend on whether or not it is winter (a hidden state).</p><p>The HHMM revealed that the seemingly random wanderings of a fly consist of ten types of movement. These include the “meander”, the “stop-and-walk”, as well as right turns and left turns. Exposing the flies to a pleasant odor – in this case, apple cider vinegar – altered how the flies walked by changing the time they spent performing each of the different types of movement. All flies in the dataset used the same ten movements, but in different proportions. This means that each fly showed an individual pattern of movement. In fact, the differences between flies are so great that Tao et al. argue that there is no such thing as an average walk for a fruit fly.</p><p>The model represents a complete description of how fruit flies walk. It thus provides clues to the processes that transform an animal’s sensory experiences into behavior. But it also has potential clinical applications. Similar models for human behaviors could help reveal behaviors that are abnormal because of disease. Normal behaviors also show variability, and some diseases increase or decrease this variability. By making it easier to detect these changes, mathematical models could support earlier diagnosis of medical conditions.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>Markov model</kwd><kwd>olfaction</kwd><kwd>locomotion</kwd><kwd>behavior</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd><italic>D. melanogaster</italic></kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000065</institution-id><institution>National Institute of Neurological Disorders and Stroke</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Bhandawat</surname><given-names>Vikas</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000055</institution-id><institution>National Institute on Deafness and Other Communication Disorders</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Bhandawat</surname><given-names>Vikas</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000001</institution-id><institution>National Science Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Bhandawat</surname><given-names>Vikas</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A fly's locomotion can be decomposed into a small number of locomotor features which can be modulated by odors and other sensory information.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>There are many approaches to the study of neural underpinnings of behavior: One large body of work is rooted in the psychophysical literature where an animal is forced to choose between a few discrete behaviors (<xref ref-type="bibr" rid="bib26">Green and Swets, 1974</xref>). This approach allows stimulus control and rigorous analysis of behavior based on an established framework (<xref ref-type="bibr" rid="bib22">Gold and Shadlen, 2000</xref>), but sacrifices a full analysis of behavioral dynamics, leaving critical issues unexplored. Other studies have focused on behaviors that are reflexive (albeit with some flexibility) such as saccades (<xref ref-type="bibr" rid="bib37">Laurutis and Robinson, 1986</xref>) and collision avoidance in insects (<xref ref-type="bibr" rid="bib53">Tammero and Dickinson, 2002</xref>). Another large body of work has focused on the control processes involved in goal-directed behaviors such as reaching movements and has revealed many fundamental principles of motor control. Yet, another popular behavioral motif that has received much attention is behaviors that require meticulous sequencing (<xref ref-type="bibr" rid="bib24">Graybiel, 2008</xref>). Finally, much work has been done to elucidate the workings of central pattern generators that underlie the rhythmic motor activity during walking and running (<xref ref-type="bibr" rid="bib27">Grillner, 1979</xref>). Although many of these relatively stereotypical behavioral motifs are at play during most behaviors, they are not helpful in describing the structure underlying most everyday activities such as making a cup of coffee or a peanut-butter sandwich or walking to a car which consist of a sequence of actions, but neither the sequence nor each sub-action is stereotyped. These activities and their underlying sub-actions cannot be described either as sensorimotor reflexes or as behaviors that arise out of meticulous sequencing. An important example of such a behavior is an animal’s locomotion. While tracks of a mouse or a fly exploring a chamber are not stereotypical there is an obvious structure to it.</p><p>Uncovering the structure within non-stereotyped behaviors such as locomotion requires sophisticated analytical tools. These tools can be applied to two complementary representations of an animal’s behavior which can be described in the shape/posture space or in the world coordinate system. Recently much progress has been made in employing analytical tools that describe behaviors as a sequence of transformations in the shape/posture space using both supervised (<xref ref-type="bibr" rid="bib12">Branson et al., 2009</xref>; <xref ref-type="bibr" rid="bib33">Kabra et al., 2013</xref>), and unsupervised (<xref ref-type="bibr" rid="bib9">Berman et al., 2016</xref>; <xref ref-type="bibr" rid="bib8">Berman et al., 2014</xref>; <xref ref-type="bibr" rid="bib62">Wiltschko et al., 2015</xref>; <xref ref-type="bibr" rid="bib60">Vogelstein et al., 2014</xref>) algorithms. These studies provided remarkable insights by showing that much of an animal’s behavioral repertoire can be described as transitions between few postures. While behavioral descriptions as transformations in posture space accurately classify the type of behavior (such as locomotion vs. grooming), because an animal’s position in the world coordinate system is ignored, the structure within an animal’s trajectory in world coordinates remains relatively unexplored.</p><p>Much of the work in extracting structure from an organism’s trajectory is derived from the ‘run and tumble model’ which was originally employed in the context of bacterial chemotaxis (<xref ref-type="bibr" rid="bib7">Berg and Brown, 1972</xref>). In this model, the organism is assumed to travel in relatively straight lines (runs) of exponentially distributed run lengths until they make sharp turns (tumble) to choose another direction at random. It is tempting to consider the motion of larger animals as roughly approximated by a run-and-tumble model, and many studies (explicitly and implicitly) employ a run-and-tumble framework with increasing sophistication as an analytical framework for locomotion (<xref ref-type="bibr" rid="bib36">Kim and Dickinson, 2017</xref>; <xref ref-type="bibr" rid="bib45">Pierce-Shimomura et al., 1999</xref>; <xref ref-type="bibr" rid="bib49">Schulze et al., 2015</xref>). One obvious well-documented limitation of this framework is that animals do not turn at discrete times (<xref ref-type="bibr" rid="bib51">Stephens et al., 2010</xref>; <xref ref-type="bibr" rid="bib43">Ohashi et al., 2014</xref>; <xref ref-type="bibr" rid="bib29">Iino and Yoshida, 2009</xref>; <xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>; <xref ref-type="bibr" rid="bib23">Gomez-Marin and Louis, 2014</xref>; <xref ref-type="bibr" rid="bib52">Straub and Heisenberg, 1990</xref>), and therefore, their locomotion cannot be described using a run-and-tumble framework. More generally, larger animals are likely to exert greater control over speed and direction of their locomotion and a better model is necessary to understand the resulting structure in their trajectory.</p><p>The lack of a model for locomotion makes it difficult to quantify the effect of stimuli on locomotion and is a critical missing piece in understanding the underlying sensorimotor transformations. For example, in many studies of odor modulation of locomotion, odors are primarily described as attractive or repulsive; this description is based on the end result, and does not consider the navigational maneuvers that underlie these end-results. Ignoring the underlying navigational maneuvers has led to a fundamental misunderstanding of odor modulation of locomotion. In a recent detailed analysis of a fly’s locomotion, we demonstrated that it's navigational maneuvers in response to similarly attractive odors are quite distinct (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>); the analysis used was based on an ad-hoc parametrization of locomotion, and not on a generative model of locomotion, making it difficult to determine whether our chosen parameter set was appropriate. A model of locomotion also makes it possible to compare how locomotion is affected by a given stimuli, and also how different individuals differ in their locomotion and in their response to stimuli.</p><p>In this study, we employ a hierarchical statistical model, Hierarchical Hidden Markov Model (HHMM) to describe the structure in the fly’s locomotion (<xref ref-type="bibr" rid="bib20">Fine et al., 1998</xref>). We show that fly locomotion is well-structured and an HHMM is an elegant representation of this structure. HHMM provides a simple and intuitive description of both a fly's locomotion and the effect of odors on the same. Surprisingly, different flies employ different strategies in their locomotion both before odor onset and in response to odors. Our data are, thus, inconsistent with the idea that the behavior of different flies represent variations around an ‘average’ fly. Rather, our data are most consistent with the idea that flies employ three to five different strategies, at a minimum, to explore a small circular arena and a similar number in their response to odors.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Rationale for the choice of HHMM as the model and the model architecture</title><p>We model the locomotion of wild-type flies exploring a circular arena (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>) whose center (odor-zone) consists of a fixed concentration of odor (<xref ref-type="fig" rid="fig1">Figure 1A</xref>). The arena and the experimental procedure was previously described (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>). Briefly, locomotion of each of the 34 flies in our dataset was measured 3 min before an odor (apple cider vinegar or ACV) was turned on, and 3 min during the presence of ACV. Sample trajectories are shown in <xref ref-type="fig" rid="fig1">Figure 1B</xref>.</p><fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.003</object-id><label>Figure 1.</label><caption><title>Experimental setup and HMM architecture.</title><p>(<bold>A</bold>) Top view of the chamber. (<bold>B</bold>) Tracks of an example fly in a circular arena (3.2 cm in radius). The central region (1.2 cm radius) has no odor during the first 3 min (before period) and is odorized in the last 3 min (during odor). The odor zone is shaded. (<bold>C</bold>) The observables - <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> at time point t = 0 are schematized. <inline-formula><mml:math id="inf3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the component of the fly’s velocity along the velocity vector at the previous time point; <inline-formula><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the component perpendicular to the velocity vector at the previous time point. (<bold>D</bold>). HMM Model Architecture: A single layered model with <italic>n</italic> states each defined by a joint probablity distribution of the observables. The probability of transitioning from the i<sup>th</sup> state to the j<sup>th</sup> state is given by T<sub>ij</sub>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig1-v2.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.004</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Block clustering of HMM states suggests a small number of locomotor features.</title><p>(<bold>A</bold>) Transition probability matrix of the 31 used HMM states. The states are block clustered based on the probability of transitioning to the other states. White boxes are drawn around states that were clustered together. Clustered states were sorted in the ascending order of mean speed/standard deviation of curvature, with state 1 being low-speed-high-curvature and state 10 being high speed and low curvature. (<bold>B</bold>) Forward trajectories of the resultant clusters. States 1 through 10 correspond to the white boxes in A as shown in order from top left to bottom right.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig1-figsupp1-v2.tif"/></fig></fig-group><p>We first attempted to model the fly’s locomotion using Hidden Markov Model (HMM) (<xref ref-type="bibr" rid="bib21">Gallagher et al., 2013</xref>; <xref ref-type="bibr" rid="bib30">Isakov, 2016</xref>). HMMs create discrete states based on a time series of observables such as position, speed or acceleration. The advantage of using HMMs in modeling locomotion is well described in earlier studies (<xref ref-type="bibr" rid="bib21">Gallagher et al., 2013</xref>) (see Materials and methods).</p><p>In this study, we use observables that describe the change of position as a function of time, and hence our analysis will focus on behavioral states in the velocity space. Speed and angular speed are commonly used measures of velocity. But, because it is difficult to measure angular speed accurately at low speeds (<xref ref-type="bibr" rid="bib21">Gallagher et al., 2013</xref>) (see Materials and methods section 2 for details), we fit the model to the component of speed parallel (<inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) and perpendicular (<inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) to its movement during the previous time point (<xref ref-type="fig" rid="fig1">Figure 1C</xref>, Materials and methods section 2). If the fly walks straight ahead, <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> would be zero, therefore, <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>are closely related to speed and angular speed. We fit a time series of <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> to an HMM. The HMM architecture is shown in <xref ref-type="fig" rid="fig1">Figure 1D</xref>. We employed models with 24 to 50 states. HMM was only modestly successful because it was never able to classify &gt;70% of the tracks into one of the states with &gt;85% confidence.</p><p>The transition probability matrix for the HMM was sparse (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>) suggesting that from each state there are transitions to only a handful of other states. One method to improve upon HMM performance is to cluster the states obtained by HMM according to the transition probability matrix. A common approach to clustering is to block-diagonalize the transition probability matrix (<xref ref-type="bibr" rid="bib9">Berman et al., 2016</xref>). Tracks corresponding to the 10 states obtained by clustering are shown in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>. Some of these states appear to describe recognizable features in the data such as left (state 10) or right turn (state 9). But efforts to block-diagonalize the transition probability matrix were only partially successful. The most obvious failure corresponds to the states with little movement. These states – describing the absence of movement – can occur in many different contexts, such as the fully stopped state or intermittent runs. When the same state is used in different contexts, an approximate block diagonalization of the transition probability matrix fails because the same state belongs to two blocks. In these cases, the different states that correspond to the absence of movement did not cluster, and appeared alone even after block-diagonalization (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Thus, the existence of the same state in different contexts is one important reason for the modest success of HMM (<xref ref-type="bibr" rid="bib38">Marco et al., 2017</xref>; <xref ref-type="bibr" rid="bib63">Wonjoon et al., 2010</xref>; <xref ref-type="bibr" rid="bib40">Michele Weiland and Nelson, 2005</xref>; <xref ref-type="bibr" rid="bib42">Nguyen et al., 2005</xref>; <xref ref-type="bibr" rid="bib41">Murphy and Paskin, 2001</xref>; <xref ref-type="bibr" rid="bib16">Chou, 2006</xref>).</p><p>We employed a two-layered Hierarchical Hidden Markov model (HHMM) to model the data (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). We reasoned that the low-level states (LL states) would be represented by Gaussian distributions on the observables, and the high-level states (HL states) would therefore be a mixture of Gaussians and would be able to model the experimental data better. Moreover, these HL states would have longer duration than the states discovered by HMM allowing it to more naturally model composite states.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.005</object-id><label>Figure 2.</label><caption><title>HHMM architecture.</title><p>(<bold>A</bold>) Model architecture: The model consists of two layers; there are 10 high level states (HL states) each of which have five low level (LL) states. The probability of transitioning from the i<sup>th</sup> HL state to the j<sup>th</sup> HL state is given by T<sub>ij</sub>. At the lower level, each HL state has its own transition probability matrix that describes transitions between its LL states. The shaded boxes represent the terminal states. (<bold>B</bold>) As a measure of the model’s ability to fit the data for individual flies in our dataset - the percentage of timepoints for which the model had &gt;85% confidence is plotted. Black line is the median. (<bold>C</bold>) HL state assignment for a single fly. The 10 high level states, each coded using a different color are overlayed on the tracks of a fly.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.006</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Longer duration of HHMM states allows it to discover structure in the data over longer times.</title><p>(<bold>A</bold>) Complementary cumulative distribution (cCDF) of tracks for HHMM vs. HMM states showing that HHMM states have many more tracks with longer durations. (<bold>B1</bold>) An example track that represents a single HHMM state. HMM detects this track as a left turn but its assignment of the track as a left turn (green lines) is intermittent. (<bold>B2</bold>) Another example - in this case for a stop state. In both examples, changes in the value of the observables result in the intermittency of the HMM state. The observable resulting in the intermittency is colored red. In the case of B1, small straight segments within the left turn result in the intermittency. In the case of B2, small movements cause an exit from the stop state.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig2-figsupp1-v2.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.007</object-id><label>Figure 2—figure supplement 2.</label><caption><title>HL states have a longer duration than LL states because of multiple transitions among low-level states/transition between HL states.</title><p>(<bold>A</bold>) Complementary cumulative distribution (cCDF) of durations for HHMM HL states (black) and the corresponding LL states (green). Mean number of LL state transitions per HL state transition increases with the duration of the HL state (orange). Inset black line shows the mean duration of LL states for each HL state track. (<bold>B</bold>) cCDF of the total time spent in a state of a given duration.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig2-figsupp2-v2.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.008</object-id><label>Figure 2—figure supplement 3.</label><caption><title>Transition probability matrices.</title><p>(<bold>A</bold>) Transition probability matrix for HL states. States were sorted in the ascending order of average speed/standard deviation of curvature, with state 1 being low-speed-high-curvature and state 10 being high speed and low curvature. (<bold>B</bold>) Transition matrices of LL states for every HL state. Each HL state has five LL states.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig2-figsupp3-v2.tif"/></fig></fig-group><p>Indeed, in a Bayesian model comparison (see Materials and methods section 4), HHMMs outperformed HMMs with the same number of states. Since HMMs rarely used more than 35 states (even when models with higher number of states were fit), to perform model comparisons, we used models with less number of states than the particular HHMM we eventually employed. We compared a two-level HHMM with 6 HL states and 4 LL states to a single-level HMM with the same number of states (4 × 6 = 24 states). We labeled the non-hierarchical model as the null model, and were able to reject the null model using Bayesian model comparison at p &lt; 0.0001, implying that a hierarchical model is necessary. Another model comparison – a two-level model with 8 HL and 4 LL states compared to a single-level model with 32 states – also yielded similar results. The objectively better performance of an HHMM compared to an HMM suggests that a model that includes a hierarchical structure is more consistent with a fly’s locomotion. It is important to note that, HHMMs are actually simpler than HMMs with the same number of states. This simplicity comes from the fact that any HHMM – which puts very specific constraints on the transition probability matrix – can be represented by an HMM but not vice-versa. HHMMs with the same number of states has far fewer parameters. Thus, for the two comparisons above, the HHMM has 6<sup>2</sup> + 6*4<sup>2</sup> + 6*4*5 = 252, and 8<sup>2</sup> + 8*4<sup>2</sup> + 8*4*5 = 352 parameters, and the HMM has 24<sup>2</sup> + 24*5 = 696 and 32<sup>2</sup> + 32*5 = 1184 parameters respectively; therefore, HHMM has fewer parameters. When a simpler model better characterizes the data, we can conclude that the additional structure contained in that model provides a more accurate characterization of the structure within the data.</p><p>The model we chose has 10 HL states (<xref ref-type="fig" rid="fig2">Figure 2A</xref>) and 5 LL states for each HL state. The model was fit to the entire dataset – both before and during the presence of the odors. The fitting process initializes by fitting each fly’s tracks to its own HHMM and then clusters these 34 HHMMs – one for each fly – using a Gaussian mixture model, resulting in a smaller number of models. Remarkably, a single HHMM is an excellent fit for all the data suggesting that the behavior of wild-type flies is composed of similar components. The model was able to successfully assign an HL state (defined as &gt;85% confidence) for &gt;80% of the data points (<xref ref-type="fig" rid="fig2">Figure 2B</xref>, median 81%). This percentage was consistently high for all flies in our dataset (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). In comparison, an HMM with 50 states can only classify 68% of the data with the same level of confidence. Tracks of a fly with each HL state labeled with a different color are shown in <xref ref-type="fig" rid="fig2">Figure 2C</xref>.</p><p>To make the difference between HHMM and HMM clearer, we compare the HHMM above to a HMM. As expected the time a fly spends in a HMM state is shorter than that in a HHMM state (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>). The longer time a fly spends in a HHMM state results from its hierarchical structure, and allows a HHMM to more accurately assign states, and is illustrated with two examples. First, consider a track that is assigned as a left turn by the HHMM, the HMM only classifies parts of the track as a left turn because of the inability of HMMs to consider longer duration trends in the observables (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B1</xref>). Short-term inhomogeneity in the data throws the HMM off; as soon as the <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> decreases, the HMM exits its left turn state. Another example (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B2</xref>) shows that the HMM exits the stopped state as soon as there is a small movement. The net result is that the HHMM can classify all long stops into a single state while HMM needs four different stop states. HHMM also assigns more of the left turn as such (6% compared to only 2% by HMM).</p><p>The duration of the LL states of a HHMM is shorter than the duration of the HL state state (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>). Moreover, as the duration of HL states becomes longer, the mean number of transitions increase. The shorter duration of LL states compared to the HL states, and increased number of transitions between LL states within each HL state transition support the idea that there is structure at multiple timescales, and some of this structure is captured by the HHMM.</p><p>The limitations of HMM in describing phenomenon which have hierarchical and shared structure because of the short duration of its states is well documented (<xref ref-type="bibr" rid="bib38">Marco et al., 2017</xref>; <xref ref-type="bibr" rid="bib63">Wonjoon et al., 2010</xref>; <xref ref-type="bibr" rid="bib40">Michele Weiland and Nelson, 2005</xref>; <xref ref-type="bibr" rid="bib42">Nguyen et al., 2005</xref>; <xref ref-type="bibr" rid="bib41">Murphy and Paskin, 2001</xref>; <xref ref-type="bibr" rid="bib16">Chou, 2006</xref>). Therefore, an HHMM is an objectively a better model of fly walking data than an HMM.</p></sec><sec id="s2-2"><title>HL states of the HHMM model describe locomotor features</title><p>Both the organized transitions between HL states, and the narrow range of observables associated with each state shows that the fly’s locomotion is structured: The transition probability matrix is sparse – a vast majority of transitions from each HL state were to 2-3 other HL states. When we reordered the states (see Materials and methods section 5) from low-speed-high-turn-states to high-speed-low-turn states, we found that from any state the flies transitioned to the neighboring states with a high probability (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>) suggesting a gradual transition from low-speed-high-turn states to high-speed-low-turn states. This gradual transition is not because flies cannot make large transitions due to biomechanical limitations because 47/81 1 possible transitions between HL states have a non-zero probability. Rather, transitions to states with similar kinematics show that under our experimental conditions – locomotion in a dark, small circular arena - flies locomote at similar <inline-formula><mml:math id="inf13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for extended periods of time, and represent one way in which locomotion is organized.</p><p>More important to the organization is the narrow distribution of observables - <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>- associated with each HL-state. The distribution of observables for a HL state is a composite of the distributions of its LL states (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). Both the model (solid line in <xref ref-type="fig" rid="fig3">Figure 3A1</xref>) and a random sample of observables drawn from the time points assigned to a given LL state (gray markers) show that during each LL state within HL state 10, the observables are limited to a narrow range of values. In each LL state, <inline-formula><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is large and <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is negative implying that in HL state 10, flies turn counter-clockwise at high speeds as observed in sample tracks corresponding to a single transition to HL state 10 (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). The sample tracks also show that within each transition to a HL state there are multiple transitions between LL states, a signature of the hierarchical organization in our data. Fast, counter-clockwise turns represent a <italic>locomotor feature</italic> which describes a fly’s locomotion in HL state 10. To better visualize this feature, we translated each track such that it began at the origin and rotated the tracks so that the initial velocity vector pointed along the y-axis (<xref ref-type="fig" rid="fig3">Figure 3C<sub>1</sub></xref>, see Materials and methods). These transformations make it apparent that the locomotor feature for state 10 is turning left at high speeds (<xref ref-type="fig" rid="fig3">Figure 3C<sub>2</sub></xref>).</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.009</object-id><label>Figure 3.</label><caption><title>Structure of a HL state.</title><p>(<bold>A1</bold>) 85% confidence bounds of the model (black ellipse) and a random sample of observables (gray dots) corresponding to data points assigned to the LL states underlying HL state 10. Percentage of time spent in a given LL state is also shown. (<bold>A2</bold>) Distribution of observables for the HL state. (<bold>B</bold>) Example tracks denoting a single transition to HL state 10 show that the fly is turning counterclockwise. LL states were color coded. (<bold>C1</bold>) Each track is rotated and translated for visualization. (<bold>C2</bold>) All 20 tracks in B were transformed as shown in C1. Transformation reveals that all HL state 10 trajectories represent left turns.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.010</object-id><label>Figure 3—figure supplement 1.</label><caption><title>LL states corresponding to each HL statest: The same plot as <xref ref-type="fig" rid="fig3">Figure 3A</xref> for all the states. </title><p>State 10's distribution has been replicated for completeness.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig3-figsupp1-v2.tif"/></fig></fig-group><p>Rotated and translated (as in <xref ref-type="fig" rid="fig3">Figure 3C</xref>) tracks for each of the 10 HL states are shown in <xref ref-type="fig" rid="fig4">Figure 4</xref>. The distribution of the observables for each HL state is also plotted. HL state 1 represents very slow walking with frequent changes in direction. In state 2, flies are either completely stopped or they walk at a speed about twice the speed of the fly in state 1; state 2 represents stop and start locomotion. The subtle, but important differences between state 1 and state 2 show an instance in which the HHMM is successful at extracting an unexpected feature in the velocity profile in a fly’s locomotion. During state 3, the fly is exhibiting a sharp turn that is reflected in the increase in <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> with a concomitant decrease in <inline-formula><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. These three states together represent slow locomotion.</p><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.011</object-id><label>Figure 4.</label><caption><title>Each HL state describes a locomotor feature during which the fly uses a narrow region of the velocity space.</title><p>Trajectories (left) and distribution of observables (right) corresponding to each of the 10 HL states are shown. Trajectories were transformed via translation and rotation to start at the origin, and the initial velocity vector pointed along the y-axis. Both model distribution (solid lines) and randomly selected 1000 empirical datapoints (gray dots) belonging to a given state are shown. The percentage of time a fly spends in a given HL state is shown.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig4-v2.tif"/></fig><p>In states 4-7, flies are walking at a medium-speed. In contrast to the clear drop in <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> with increases in <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> in state 3, <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> remains strikingly constant irrespective of <inline-formula><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. These states are different from each other because <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is slightly different.</p><p>States 8–10 are high-speed states; each of these states is also characterized by their turn direction. During states 8 and 9, the fly turns right; the fly’s speed is higher during state 9 than during state 8. During state 10, the fly turns left. States 9 and 10 are mirror-symmetric versions of each other.</p><p>Flies spend 60% of time performing a locomotor feature for &gt;300 ms, and &gt;10% of their time performing a single locomotor feature for &gt;3 s (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). Thus, flies spend extended time in the same state.</p></sec><sec id="s2-3"><title>Odors affect locomotion by altering the occupancy of HL states</title><p>In the absence of ACV, the state occupancy inside and outside the odor-zone are quite similar: The fly spends 30% of its time in state 2 and roughly equal time in all other HL states. Introducing ACV changes the fly’s locomotor behavior both inside and outside the odor-zone, but with opposite effects on the HL state occupancy in the two zones. Inside the odor-zone, in the presence of ACV, the fly spends more time in HL states 1 and 3 at the expense of time spent in HL states 7–10 (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). These changes from high-speed states to low-speed states suggest that in the presence of ACV the fly is performing a local search, presumably to find food. Outside the odor-zone (<xref ref-type="fig" rid="fig5">Figure 5B</xref>), the fly spends more time in the high-speed states (HL states 8–10), with a decrease in the occupancy of HL state 2 (which includes stopping). Decreased stopping and increased high-speed walking with turning is likely to represent a different search strategy, wherein the fly might be attempting to re-find the odor it has recently lost. We also investigated whether there were changes in the LL state composition of the HL states and found no changes (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). Overall, these results showed that odors affect locomotion not by creating new locomotor features, but by altering the frequency with which existing locomotor features are used.</p><fig-group><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.012</object-id><label>Figure 5.</label><caption><title>Odors modulate locomotion by altering the time spent in different HL states.</title><p>(<bold>A</bold>) Odor-induced changes in the occupancy of HL states inside the odor-zone. Bar graphs showing the probability distribution of the 10 HL states during odor, before odor, the difference between the two and the fractional change in the distributions when the fly is inside. Red lines show ±bootstrapped 95% confidence intervals. Asterisks indicate significance at 0.05 with Bonferroni-Holm correction (**) and 0.01 (*) without correction based on bootstrapped hypothesis testing for equality of means. (<bold>B</bold>) Same as in A, but for outside the odor-zone.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.013</object-id><label>Figure 5—figure supplement 1.</label><caption><title>For each HL state, the composition of LL states remain the same .</title><p>Percent change before and during the presence of odor were calculated for inside and outside separately. No state occupancy changes by more than 20%.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig5-figsupp1-v2.tif"/></fig></fig-group><p>The divergent effect of ACV on the probability of HL states inside and outside the odor-zone is consistent with our previous analysis (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>) and shows that the effect of ACV can be described by the change in the probability of the fly occupying HL states. To assess whether there is a more fine-grained spatial structure to the effect of ACV on a fly’s behavior, we divided the arena into a 60-by-60 grid and measured the ACV-induced changes in the probability of occupying a given HL state at each of the 3600 locations (<xref ref-type="fig" rid="fig6">Figure 6</xref>). The probability that a fly is in HL state 1 increases dramatically only at the edge of the odor-zone (<xref ref-type="fig" rid="fig6">Figure 6A</xref>), and not throughout the odor-zone where the odor concentration is uniform throughout, showing that the effect of odor on locomotion has a fine-grained spatial structure. Location-specific change in the probability of each HL state are shown in <xref ref-type="fig" rid="fig6">Figure 6B</xref>. The fine-grained modulation of locomotion is observed in other states as well - increases in state 2 are largest in an annular region just inside the odor-zone and increases in state 3 are largest at the very center of the arena. A similar specificity is observed in the increase in the probability of HL states outside the odor-zone. Increases in the occupancy of state 8 are uniform across the entire chamber outside the odor-zone; in contrast, the occupancy of states 9 and 10 increases in the region close to the odor-zone.</p><fig-group><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.014</object-id><label>Figure 6.</label><caption><title>Fine spatial structure underlying odor-evoked changes in HL state occupancy.</title><p>(<bold>A</bold>) The probability distribution of HL states before and during odor was calculated for each of the 60 × 60 bins. Taking HL state 1 as an example, each specific bin represents the probability of HL state 1 given the spatial location. White circles show the extent of the odor-zone and the arena. Bottom row: Probability of HL state 1 as a function of radial distance. The shaded region indicates the odor zone. (<bold>B</bold>) Change in HL state occupancy for each of the 10 HL states.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig6-v2.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.015</object-id><label>Figure 6—figure supplement 1.</label><caption><title>Temporal structure underlying HL state occupancy in response to odor.</title><p>(<bold>A1</bold>) Probability of HL state occupancy following first entry inside the peripheral odor zone (radius = 1.9 cm). (<bold>A2</bold>) Medium speed walking states (4-7) were grouped and high-speed turning states (8-10) were grouped together, and the mean HL state occupancy were calculated for the respective groups. (<bold>B</bold>) The radial occupancy of the flies at different time groups following first entry. The black vertical dotted line indicates the nominal odor boundary (radius = 1.5 cm).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig6-figsupp1-v2.tif"/></fig></fig-group><p>The structure that we observe represents the time-average over the entire duration of the odor period, and ignores the time evolution of the behavior (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref> and discussion). We were unable to explore the spatio-temporal evolution of behavior because of substantial fly-to-fly differences in locomotion and how it is modulated by odor.</p></sec><sec id="s2-4"><title>Both locomotion and an odor’s effect on locomotion is fly dependent</title><p>Given that ACV affects the occupancy of HL states, it should be possible to do the reverse, that is decode the presence of ACV based on the distribution of HL states. Surprisingly, a variety of different decoding techniques failed to decode the presence of ACV based on the distribution of HL states. One such method (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>) in which we employed logistic regression to classify each one second of every fly’s track into ‘ACV present’ or ‘ACV absent’ failed. Even more surprisingly, population decoding based on HL states did not perform any better than decoding based on the observables (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>). One possibility that the logistic regression approach failed is because the average behavior represented in <xref ref-type="fig" rid="fig5">Figure 5</xref> does not accurately encapsulate individual fly behavior. Large fly-to-fly differences, where different individuals have fundamentally different basal locomotion or response to odor, might doom decoding methods aimed at discovering a single set of regressors that captures individual fly behavior.</p><p>Consistent with large fly-to-fly differences in behavior, we found that the distances between empirical flies are much larger than the distances between the synthetic flies (<xref ref-type="fig" rid="fig7">Figure 7A</xref>). Synthetic flies were generated as described in <xref ref-type="fig" rid="fig7s2">Figure 7—figure supplement 7–2</xref>. It is statistically impossible (p &lt; 10<sup>−131</sup>) that the observed Euclidean distance represents variations around the same average fly. The same conclusion applied to the fly’s behavior in the other three conditions (before-inside, during-outside and during-inside: <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>).</p><fig-group><fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.016</object-id><label>Figure 7.</label><caption><title>A fly’s locomotion cannot be explained as variations around an average fly and is well-described on the basis of three to four locomotor types.</title><p>(<bold>A</bold>) Histogram of distances between flies in the 10-dimensional space formed by the HL states. The distance between 100 iterations of 34 synthetic flies based on the average distribution of states is much smaller (gray line, Wilcoxon rank sum test, p &lt; 10<sup>−131</sup>). The distance between synthetic flies drawn from four clusters of flies (red line) has a distribution more similar to the empirical distribution. (<bold>B</bold>) X-means clustering (a variant of K-means) in the 10-dimensional HL state space. Only the first two PCs are shown. Each cluster is represented by a different color. (<bold>C</bold>) Left: KL divergence from the average fly to the individual fly (n = 34). Right: KL divergence from the average fly in each cluster to each individual fly in the corresponding cluster. Shaded area reflects the expected KL divergence (99% of KL divergences) from the HL state distribution of the average fly to the HL distribution of synthetic flies generated from this average (n = 3400). (<bold>D</bold>) Average HL state distribution for each cluster is shown in the top row. Bottom row shows an example fly for each cluster with HL states overlayed.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-v2.tif"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.017</object-id><label>Figure 7—figure supplement 1.</label><caption><title>HL state distributions of the population are poor predictors for the presence of odor.</title><p>We used logistic regression to evaluate whether the distribution of HL states is predictive of the presence of odor. We know from <xref ref-type="fig" rid="fig6">Figure 6</xref> that ACV causes a change in the distribution of HL states, and that these changes are different inside and outside the odor-zone. Therefore, we asked whether given that fly is either inside or outside the odor-zone, can we predict based on the distribution of HL states whether the fly is experiencing an odor. (<bold>A</bold>) An example of HL state as a function of time for a single fly. The HL states were segmented into 1 second chunks and further subdivided into each of the four scenario - before inside, during inside, before outside and during outside. Only the before inside and during inside cases are shown. The HL state distributions were calculated for each segment. Thus, each 1 second bin is represented as a point in 10-dimensional state. The process was repeated for each fly, PCA was performed on the entire dataset and only the principal components that explain &gt;90% variance in the data were used to fit to a logistic regression (logit) model. (<bold>B</bold>) (Left) Results of a logarithmic regression (logit) model fit to the HL state distributions in 1 second segments for all flies do not show better probability of correct predictions over chance (gray line). (Right) Distributions of HL states of the population do not improve decoding over observables. (Wilcoxon signed rank test, p &lt; 0.0084 for inside and p &lt; 0.0984 for outside).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-figsupp1-v2.tif"/></fig><fig id="fig7s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.018</object-id><label>Figure 7—figure supplement 2.</label><caption><title>The process for generation of synthetic HL state sequences.</title><p>(<bold>A</bold>) A HL-state is sampled from the empirical average HL state distribution for a given scenario. Progression of HL states are calculated at each timepoint using the global transition probability matrices associated with the HHMM and the given scenario. Because of high probability of self-transitions, the HL state change only occurs after a few frames. A fragment is shown where a synthetic fly stays in HL state 2 for 400 frames. (<bold>B</bold>) A sample synthetic track. A synthetic track lasts for the median empirical duration of the given scenario (1000 frames are shown). (<bold>C</bold>) The mean empirical HL state distributions are similar to the mean synthetic HL state distributions.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-figsupp2-v2.tif"/></fig><fig id="fig7s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.019</object-id><label>Figure 7—figure supplement 3.</label><caption><title>Flies can be clustered into three to four types based on their locomotion.</title><p>This figure shows the same analysis as in <xref ref-type="fig" rid="fig7">Figure 7</xref>, but for the other three conditions - before inside, during inside and during outside (<bold>A</bold>) Same as <xref ref-type="fig" rid="fig7">Figure 7A and B</xref>, but for &quot;before inside&quot;. Average fly (gray line, Wilcoxon rank sum, p &lt; 9.57e-58). Cluster fly (Wilcoxon rank sum, p &lt; 4.13e-3). (<bold>B</bold>) X-means clustering (a variant of K-means) based on the 10-dimensional space formed by the HL states show that there are three clusters of flies in the ‘before inside’ section. The first two PCs are shown for visualization. Each cluster is represented by a different color. Average HL state distribution for each cluster is shown on the right. (<bold>C and D</bold>) Same as A and B but for ‘during inside’. Average fly (Wilcoxon rank sum, p &lt; 3.25e-86). Cluster fly (Wilcoxon rank sum, p &lt; 0.019). (<bold>E and F</bold>) Same as A and B but for ‘during outside’. Average fly (Wilcoxon rank sum, p &lt; 2.42e-130). Cluster fly (Wilcoxon rank sum, p &lt; 2.40e-10).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-figsupp3-v2.tif"/></fig><fig id="fig7s4" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.020</object-id><label>Figure 7—figure supplement 4.</label><caption><title>Cluster assignments are stable over time.</title><p>The Euclidean distance between the HL state distribution for each time bin and each of the four centroids were calculated. ‘Correct label’ means that the orginial cluster was the closest. The three panels differed in how the bins were assembled. (<bold>A</bold>) Probability of assignment to the original cluster based on randomly selected sample. This analysis measures the extent to which subsampling is likely to result in flies in the same cluster. (<bold>B</bold>) Contigous tracks of given size anywhere in the track show similar assignment stability. (<bold>C</bold>) Same as C but for the bins at the start and end. Dashed lines represent random chance for before outside (black) and during inside (red).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-figsupp4-v2.tif"/></fig><fig id="fig7s5" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.021</object-id><label>Figure 7—figure supplement 5.</label><caption><title>Locomotion before odor onset is only weakly predictive of locomotion during the presence of odor.</title><p>(<bold>A</bold>) Left: X-means clustering algorithm based on the average HL state distribution for each fly before the odor period and inside the odor ring grouped the 34 flies into three different clusters. Flies belonging to the same cluster, like 11,7 and 17,27 showed similar HL state distributions. The same algorithm grouped the flies in three different clusters during the odor period and inside the odor ring. The flies which belong to the same cluster before the odor period belong to different clusters following odor and show very different HL state distributions from each other. Right: Linear regression analysis between the Euclidean distances before and during the odor period outside the odor ring shows that they are weakly correlated with a r-squared value of 0.161 (p &lt; 0.001). (<bold>B</bold>) Left: The same analysis was applied to the inside odor case. Again, flies belonging to the same cluster 6,16 and 17,27 before first entry showed different distribution of HLS usage following odor. Right: Linear regression analysis between the Euclidean distances before and during the odor period inside the odor ring shows that they are weakly correlated with a r-squared value of 0.166 (p &lt; 0.001).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig7-figsupp5-v2.tif"/></fig></fig-group><p>Because the data in <xref ref-type="fig" rid="fig7">Figure 7A</xref> is inconsistent with individual flies being variations around a single average fly. We assessed whether the observed variability can be approximated based on a small number of discrete locomotor-types. X-means clustering (see Materials and methods section 6) showed that there are 4 clusters of flies based on their locomotion outside the odor-zone, before odor onset (<xref ref-type="fig" rid="fig7">Figure 7B</xref>). Although the identity of flies that cluster together changed, a similar number of clusters was found in each of the four conditions (Before odor/inside odor-zone, during odor/inside odor-zone, before-outside and during-outside, <xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>). Importantly, X-means clustering on a set of 34 randomly sampled points from a uniform distribution in the probability simplex space that the data reside in found no clusters. The Euclidean distances between synthetic flies drawn from the four different clusters were similar to the distances between empirical flies (<xref ref-type="fig" rid="fig7">Figure 7B</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>). Since X-means clustering tends to underestimate the actual number of clusters in data (<xref ref-type="bibr" rid="bib44">Pelleg and Moore, 2000</xref>), the analyses in <xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref> suggest that there are at least three to four fly-types based on the frequency with which they use the HL states.</p><p>Consistent with the analysis with Euclidean distances above, the KL divergences (<xref ref-type="fig" rid="fig7">Figure 7C</xref>, left set of data points) show a large range indicating that some, but not all, flies are well-represented by the population average while others are not. Employing three to four fly-types defined as average distribution of their respective cluster decreased the information loss (<xref ref-type="fig" rid="fig7">Figure 7C</xref>, right).</p><p>How was the behavior of the flies in the four clusters different from each other? The average occupancy of the HL states for flies in each cluster and one example from each cluster is shown in <xref ref-type="fig" rid="fig7">Figure 7D</xref>. Cluster two was distinct from the others because flies move at markedly slower speed and spent &gt;60% of their time in State 2 (<xref ref-type="fig" rid="fig7">Figure 7D</xref>) during which the fly was often stopped. Locomotion of flies in the largest cluster (cluster 1) was characterized by an alternation between medium- and slow-speed states. Flies in this cluster employed states 5 and 7 with a high frequency while making radially inward forays into the center of the arena. Similar behavior was observed in cluster 3, except that the flies employed the slower medium-speed states (states 4 and 5). Finally, the fourth cluster of flies demonstrated a different locomotor strategy. Flies in cluster four traversed the arena in concentric circles using the high-speed states (states 8–10). Thus, X-means performed on the HL state distributions appear to identify different locomotor strategies employed by the fly.</p><p>How similar is the locomotion of a fly at different times during a trial? To investigate this issue we first examined whether the mean behavior of flies from different clusters are different enough that they can be accurately clustered based on a small sample of the HL states (<xref ref-type="fig" rid="fig7s4">Figure 7—figure supplement 4A</xref>). We limited the analysis to before-outside and during-inside scenarios because the fly spent much of its time in these two scenarios. Only a one-second chunk of data is sufficient for better than chance clustering, and just 30 s of sampling is enough to accurately classify &gt;85% of the flies into their respective clusters. We performed two analyses to test whether a fly’s behavior is persistent: First, we divided the tracks into bins of different length, and asked whether cluster assignments based on small bin sizes is stable (<xref ref-type="fig" rid="fig7s4">Figure 7—figure supplement 4B</xref>). We found that state distribution within each bin was highly predictive of the cluster they belonged to. Second, we repeated the same analysis, but with bins of varying size starting from the first data point or ending at the last data point (<xref ref-type="fig" rid="fig7s4">Figure 7—figure supplement 4C</xref>). These analyses show that within the admittedly short timeframe of our experiments, the cluster assignments are stable.</p><p>Apart from the fly-to-fly variability, another reason why decoding based on the average fly fails is that the behavior of the fly before odor onset is only weakly predictive of its behavior during the presence of odor. Some flies exhibited similar behavior in the before odor/outside odor-zone, but were divided into separate clusters in the presence of odor because their locomotion differed (e.g. flies 11 and 33, and 17 and 27;<xref ref-type="fig" rid="fig7s5">Figure 7—figure supplement 5A</xref>, see the distributions of HL states).A similar trend is observed inside the odor-zone (<xref ref-type="fig" rid="fig7s5">Figure 7—figure supplement 5B</xref>). These examples imply that behavior before odor onset is unlikely to be strongly predictive of behavior during the presence of odor. This conclusion is supported by the weak correlation between Euclidean distances between pair of flies in the before and during periods (<xref ref-type="fig" rid="fig7s5">Figure 7—figure supplement 5A</xref> and <xref ref-type="fig" rid="fig7s5">Figure 7—figure supplement 5B</xref>).</p></sec><sec id="s2-5"><title>A small number of strategies can explain the variability in flies’ response to odor</title><p>The analysis presented above suggests that individual differences explain why the logistic regression approach based on the average HL state distribution across flies failed to decode the presence of ACV from its absence based on the HL states usage by individual flies. If so, individualized logistic regression should be more successful. Logistic regression based on individual flies to decode the presence or absence of odor based on HL state occupancy during a 1s-interval was able to classify odor-no odor at better than chance level for every single fly (<xref ref-type="fig" rid="fig8">Figure 8A</xref>, see Materials and methods section seven and <xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref> for details). Moreover, as expected, logistic regression using the HL states performed significantly better than did the observables (<xref ref-type="fig" rid="fig8">Figure 8B</xref>) which indicate that HL states are more predictive of the presence of ACV than the observables.</p><fig-group><fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.022</object-id><label>Figure 8.</label><caption><title>Presence of odor can be decoded based on both HL state distribution of individual flies and clusters of flies.</title><p>(<bold>A</bold>) HL states are a good predictor of whether a fly is experiencing odors. Results of a logarithmic regression (logit) model fit to individual flies consistently shows better probability of correct predictions over chance (grey line). (<bold>B</bold>) HL states have higher predictive power than speed/curvature for individuals. Logit fits based on HL states were compared to that fit to the speed and curvature for inside (left) and outside (right) of the odor ring. A two-sided Wilcoxon signed rank test showed improved decoding using the HL states (p &lt; 0.0028 for inside and p &lt; 0.0089 for outside).(<bold>C</bold>) X-means clustering (a variant of K-means) based on the 10 dimensional space formed by the HL states show that there are five clusters of flies for difference in the HL state distributions inside and four clusters of flies for difference in the HL state distributions outside. Results of the logistic regression model fit to these clusters for the inside and outside cases are shown. Each cluster is represented by a different color.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig8-v2.tif"/></fig><fig id="fig8s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.41235.023</object-id><label>Figure 8—figure supplement 1.</label><caption><title>Schematic showing how logistic regression for a single fly was performed.</title><p>(<bold>A</bold>) An example of a high level state track for a fly used in this study. The high level states were separated based on inside and outside the odor ring. For each scenario, the time series was further subdivided into before odor and following first entry. These tracks were divided into segments of 30 frames (1 s) each. The high-level state distributions were calculated for each segment. PCA was applied and the principal components that explains most of the variance were used to fit to a logistic regression (logit) model.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig8-figsupp1-v2.tif"/></fig></fig-group><p>The analysis in <xref ref-type="fig" rid="fig8">Figure 8A</xref> shows that the occupancy of HL states is predictive of the presence or absence of odor when the analysis is performed at the level of individual flies. Does this mean that each fly follows an individualistic strategy? To evaluate whether a fly’s response to ACV cluster into a small number of response types, we once again started with X-means clustering based on the change in state occupancy before and during odor. X-means clustering found five clusters inside the odor-zone and four clusters outside the odor-zone (<xref ref-type="fig" rid="fig8">Figure 8C</xref>). Using these clusters as a starting point, we could reconfigure the clusters such that the logistic regression on flies in each cluster performed at a better than chance level for each fly in the cluster (<xref ref-type="fig" rid="fig8">Figure 8C</xref>, see Materials and methods section seven for details), thus implying that a fly’s response to odors can be approximated as a choice between few response-types.</p><p>Based on their behavior inside the odor-zone, the flies were divided into five clusters, four of these clusters have more than three flies (<xref ref-type="fig" rid="fig9">Figure 9A</xref>). Flies in cluster 5, just like the average fly (in <xref ref-type="fig" rid="fig5">Figure 5</xref>), slow down inside the odor-zone. Flies in cluster 3 also demonstrate a strategy similar to flies in cluster five except that ACV causes a large decrease in the time a fly spends in the medium-speed states rather than the high-speed states. In contrast to clusters 3 and 5 during which the fly slows down inside the odor-zone, flies in cluster two demonstrate a fundamentally different strategy in which there is a large decrease in state 2 in favor of states 1, 3 and 4. The flies in this cluster go from stop-start locomotion to locomotion in which they either meander at slow speeds or walk slowly with many sharp turns. Finally, for the flies in cluster 1, there is no dramatic change in state. These different strategies represent diametrically different effects of ACV on some HL states – the most striking example is the opposing effects of the odor on HL state 2 occupancies in different clusters – a large decrease in cluster 2, and an increase in clusters 3 and 5. These differences explain the odor-induced increase in usage of all the slow states in the average fly inside the odor-zone, except state 2 (<xref ref-type="fig" rid="fig6">Figure 6A</xref>).</p><fig id="fig9" position="float"><object-id pub-id-type="doi">10.7554/eLife.41235.024</object-id><label>Figure 9.</label><caption><title>Flies’ response to odors cluster into a small number of distinct, sometimes opposing response-types.</title><p>(<bold>A</bold>) The difference between HL state distributions (during-before) and tracks from an exemplar fly from each cluster is shown. Dotted grey circle indicates the odor-zone. (<bold>B</bold>) Same as A, but for odor-evoked changes outside the odor-zone.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-41235-fig9-v2.tif"/></fig><p>Based on how odors modulate their behavior outside the odor-zone, there were four clusters. Behaviors that represent three of these clusters are shown in <xref ref-type="fig" rid="fig9">Figure 9B</xref>. Flies in cluster 1 decrease the time they spend in slow-states (state 1–2) and instead spend time in the fast states (states 8–10) resembling the behavior of the average fly. Cluster 2) shows a large decrease in HL state 2 occupancy similar to the behavior of flies in inside odor-zone cluster 2 while exhibiting a large increase in medium-speed states (state 4–6). Cluster 3 showed no dramatic change in state.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>A cornerstone of neuroethology is that behavior unfolds in discrete packets, that is, behavior can be temporally segmented into natural units (<xref ref-type="bibr" rid="bib3">Barlow, 1977</xref>; <xref ref-type="bibr" rid="bib55">Tinbergen, 1996</xref>; <xref ref-type="bibr" rid="bib2">Baerends, 1976</xref>). In some behaviors, these discrete packets are readily recognizable. But, in most daily behaviors, there is enough variability in these discrete packets to make the underlying natural units unrecognizable without the help of sophisticated analytical tools. Recently, there has been significant progress in discovering structure in sequences of posture in <italic>C. elegans</italic> (<xref ref-type="bibr" rid="bib51">Stephens et al., 2010</xref>), <italic>Drosophila</italic> (<xref ref-type="bibr" rid="bib9">Berman et al., 2016</xref>; <xref ref-type="bibr" rid="bib60">Vogelstein et al., 2014</xref>) and mice (<xref ref-type="bibr" rid="bib62">Wiltschko et al., 2015</xref>). Here we describe structure in a fly’s locomotion in the velocity space.</p><p>Our salient results are:</p><list list-type="bullet"><list-item><p>A fly moves at a relatively constant <inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for an extended time that can last tens of steps. Therefore, a fly’s locomotion can be decomposed into a few locomotor features – 10 features in the case of the model we present. The same 10 locomotor features could describe the behavior of all flies in our dataset. The effect of odors on locomotion, and the differences in behavior across flies can be described in terms of these 10-locomotor features.</p></list-item><list-item><p>Using this analytical framework, we show that odors affect locomotion by altering the time that a fly spends performing a given locomotor feature (instead of creating new features). The odor-induced change in locomotion has a fine spatial scale – the fly’s response to odor changes as it moves from the border of the odor-zone to its center, and as it moves away from the odor border.</p></list-item><list-item><p>The HHMM framework also allowed us to show that flies used the same 10 locomotor features, but in different proportions. The variation is so large that the fly’s behavior cannot be understood as variations around the same average fly. Instead, the flies employ a minimum of at least 3–4 different strategies.</p></list-item></list><p>Below we discuss the limitation and implication of these findings.</p><sec id="s3-1"><title>Model limitations</title><p>The model presented here is <italic>a</italic> model of locomotion and not <italic>the</italic> model of locomotion. The choice of observables and model strongly influences the features of the structure that is discovered. Our particular model reveals the structure of locomotion in the velocity space.</p><p>In choosing the observables, we employ a common method for describing locomotion, that is we treat the fly as a point object and measure the instantaneous change in the position of this point object; therefore, much of the insights from the model relate to how the fly changes its position in time. Apart from <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf29"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, another similar and more commonly used representation of the change in fly’s position: instantaneous speed and angular speed yielded similar locomotor features (data not shown). Ultimately, we used <inline-formula><mml:math id="inf30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> because this representation is more closely related to movement representation within the insect brain (<xref ref-type="bibr" rid="bib25">Green et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Heinze, 2017</xref>; <xref ref-type="bibr" rid="bib57">Turner-Evans and Jayaraman, 2016</xref>), and because the measurement errors associated with angular speed are particularly large when flies moves slowly (<xref ref-type="bibr" rid="bib21">Gallagher et al., 2013</xref>).</p><p>A fly’s position can also be described using the actual position of the animal as observables rather than the change in the position, as employed in a recent study in rats (<xref ref-type="bibr" rid="bib50">Shan and Mason, 2017</xref>) Using the instantaneous position as an observable would reveal different aspects of the structure underlying an animal’s locomotion. Consider the trajectories of flies in Clusters 1 and 3 (<xref ref-type="fig" rid="fig7">Figure 7</xref>). They cross similar spatial positions, but are classified into different states because the flies travel at different speeds. In terms of the sequence of position in space, flies in both clusters have a similar behavior – they explore the outer arena border and make occasional radial forays inside the odor-zone. An analysis based on position would likely place these two clusters of flies together whereas our analysis, in the velocity space, placed them in different clusters.</p><p>Model architecture is also important. A hierarchical model performed better than a non-hierarchical model. The current model has state durations of &lt;3 s. It is clear to human observers that there is structure in the data that is &gt;3 s long. Flies sometime explore the outer border of the arena using characteristic paths that can last up to a minute. The short duration of states in our model cannot capture structure on these long-time scales. One possibility is choosing a deeper-layered architecture. Given the structured transitions between the HL states in our model, it is likely that if we used a deeper-layered architecture, we would likely uncover structure on a longer timescale.</p></sec><sec id="s3-2"><title>Locomotor features and implications for neural control of behavior</title><p>During both HL states 1 and 2, the fly’s locomotion is quite slow, but in state 2 the fly stops and runs intermittently while in state 1, the fly is continuously in motion, albeit slowly. Similarly, in each of the HL states 4, 5 and 7, <inline-formula><mml:math id="inf32"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> lies within a narrow range, which is distinct for each of these three states, implying a tight control over forward speed. These locomotor characteristics can persist over 3 seconds (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>) – a time period during which a fly takes 30 steps on average (given a step frequency of 10 Hz; <xref ref-type="bibr" rid="bib39">Mendes et al., 2013</xref>). This tight control over <inline-formula><mml:math id="inf33"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> over many steps strongly suggests that locomotion unfolds in blocks. The HHMM presented here or the states revealed by it may not reflect the actual states employed by neurons in the brain. In fact, there is an ongoing debate whether behavior and its control is better represented as a continuum than by discrete states. The presence of long-lasting states that are employed repeatedly by all flies in our dataset implies that either locomotion does consists of transition between discrete states, or that these states represent fixed points or peaks of a dynamical system around which the animal spends most of its time (<xref ref-type="bibr" rid="bib10">Berman, 2018</xref>).</p><p>Another surprising result is that the same set of locomotor features describes the behavior of all the flies in the dataset. This result is particularly surprising given that our model explicitly allows each fly its own set of locomotor features. The fact that all flies can be reasonably modeled by the same model implies that within a given environment all flies construct their locomotion from the same building blocks, and differences in locomotion amongst flies or the effect of sensory stimulation can be quantified as changes in the frequency with which these building blocks are employed. An important avenue for future research is to assess whether these locomotor features are fixed or flexible.</p></sec><sec id="s3-3"><title>Odors affect behavior on a fine spatial scale</title><p>In nature, animals encounter odors in a cluttered and dynamic sensory environment (<xref ref-type="bibr" rid="bib47">Riffell et al., 2014</xref>). Discriminating between odors, navigating towards the chosen odor source and pinpointing the odor source requires a flexible deployment of multiple different motor programs. It is difficult to replicate the complex natural environment in the laboratory. Therefore, laboratory studies are typically aimed at different subsets of the complex environment experienced by animals. In insects, much research has focused on an environment in which it experiences odors in a highly structured odor plume often within a high-contrast visual environment (<xref ref-type="bibr" rid="bib15">Budick and Dickinson, 2006</xref>; <xref ref-type="bibr" rid="bib35">Kennedy, 1983</xref>; <xref ref-type="bibr" rid="bib59">Vickers, 2000</xref>; <xref ref-type="bibr" rid="bib58">van Breugel and Dickinson, 2014</xref>; <xref ref-type="bibr" rid="bib1">Álvarez-Salvado et al., 2018</xref>). Recently, similar experiments have been repeated for flies walking towards an odor source (<xref ref-type="bibr" rid="bib6">Bell and Wilson, 2016</xref>). These experiments model an insect’s behavior under one specific condition wherein the fly tries to locate an odor source at a distance using strong directional information from wind and vision. The experiments described here explore a fly’s behavior in a small, dark circular arena. At most locations in the arena, the air speed was 0.07 m/s; the highest wind-speed was 0.11 m/s (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>), a value lower than has been employed in most studies. Therefore, non-olfactory directional cues from vision or wind are minimized (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>). Consistent with this idea, there was no change in the distribution of the flies when wind was completely eliminated.</p><p>We find that this behavior near the odor source can be described by changes in the HL states. The clearest evidence that changes in HL states are a good description of the fly’s behavior is the analysis in which we measured the spatial distribution of odor-evoked changes in HL states (<xref ref-type="fig" rid="fig6">Figure 6</xref>), and observed a pattern that strongly resembles the odor-zone. This analysis shows that the HL state description is accurate enough to facilitate discovery of arena structure. However, because we averaged HL state distribution over the entire 3 min of odor exposure, the analysis misses some details. The flies first detect odor slightly outside the odor-zone as defined in this study (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>), and their behavior during the first 10 s after odor encounter differs from their behavior during the rest of the odor period (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1A</xref>). Moreover, at least some of the spatial structure results from the change in the radial density of the fly as a function of time (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1B</xref>). A fly’s interaction with odor is dynamic and that HL states are a good analytical framework to extract the spatiotemporal patterning of fly’s behavior by odor. This spatiotemporal pattern likely differs among flies; a full description of this pattern requires a larger dataset and represents an important avenue for future research.</p></sec><sec id="s3-4"><title>Flies show considerable variability in locomotion despite employing the same locomotor features</title><p>Even single-cell organisms and animals with simple nervous systems display substantial individuality (<xref ref-type="bibr" rid="bib31">Jordan et al., 2013</xref>; <xref ref-type="bibr" rid="bib21">Gallagher et al., 2013</xref>). Animals with larger nervous systems are likely to display even greater individuality, in the case of adult flies this individuality was demonstrated in the context of locomotor handedness (<xref ref-type="bibr" rid="bib13">Buchanan et al., 2015</xref>) in a choice assay. The nature and extent of individuality is harder to assess in more complex behaviors because of the difficulty in assessing individuality in a large behavioral space; differences in behavior can simply be different instantiation of the same behavior, or reflect fundamental differences in behavior. In this study, we find that different flies employ the same locomotor features but use them in vastly different proportions. The observed variability between the flies is inconsistent with a single type of locomotor behavior but can be approximated by invoking 3–4 clusters of flies. Because the clustering framework we employed (X-means) underestimates the number of clusters, and because there were only 34 flies in our dataset, it remains to be seen whether there are a few locomotor-types or a whole continuum of locomotor-types. Another limitation of this study is that we have not yet ascertained whether a fly’s behavior persists over a longer time frame. Despite these limitations, this study makes two important contribution to the study of individuality. First, we develop a statistical framework to study complex behaviors. This method can be extended to examine whether the differences we observe truely represent individuality. Second, in many behavioral studies, researchers focus on the effect of some stimuli on behavior and make conclusions based on the average fly. In this study, we provide a framework for testing whether the description based on an average fly is appropriate, and ways to proceed if such an approach is inadequate.</p><p>The diversity of odor responses observed here is consistent with work done on moths where (<xref ref-type="bibr" rid="bib61">Willis and Arbas, 1998</xref>) but in sharp contrast to recent work on walking Drosophila (<xref ref-type="bibr" rid="bib6">Bell and Wilson, 2016</xref>) in which the authors reported that attraction to odors results from a stereotypical motor pattern. The authors of that study claimed that the relatively simple response to odors in their study is likely a result of their simple behavioral arena. Another possibility is that in their study there is a strong, directional wind cue. In the presence of a steady wind cue in a narrow arena, it is likely that the flies’ locomotor behavior is dominated by upwind walking and suppresses other elements of their behavior. It is well-established that a fly’s response to odor is strongly influenced by context, as was demonstrated recently by comparing the response to odors in different visual and air flow conditions (<xref ref-type="bibr" rid="bib48">Saxena et al., 2018</xref>).</p><p>When considered from the viewpoint of an individual animal, this variability is hard to understand: A hungry fly in search of food should respond with a singular, hardwired behavior which represents an optimal strategy for locating food. However, species evolve as large populations of individuals, and a successful species should be able to adapt to fluctuating environmental condition. Recent work has shown that - bet hedging - a process by which the same genotype shows considerable phenotypic variation is important for adaptation to fluctuating environments (<xref ref-type="bibr" rid="bib34">Kain et al., 2015</xref>). Having a diversity of phenotypes ensures that some individuals would thrive in any condition and behavioral variability is a feature not a bug and its careful consideration is critical.</p><p>Studying individual behavioral responses is also important to understand the mechanism underlying both the control of locomotion and how odors control locomotion. Analyzing behavior at the population level can provide important insights into an animal’s response but does not provide the resolution necessary for understanding the neural mechanism underlying the moment-by-moment control of behavior at the level of individual flies. In this context, it is instructive to take a closer look at the average response to odors in the light of clusters of response to odors. The average response (<xref ref-type="fig" rid="fig5">Figure 5A</xref>) was surprising: the occupancy of all the slow states except state 2 is increased. The lack of increase in occupancy of state 2 results from a cluster of flies in which the occupancy of state 2 is strongly decreased (<xref ref-type="fig" rid="fig9">Figure 9A</xref>). A similar effect is observed in the response of the average fly to the medium-speed states – states 4–7. The occupancy of these states decreases in some flies and increases in others. Thus, the average fly is an aggregate of these different clusters of flies, each of which has a distinct response to odor. Disaggregation is an essential first step to understanding neural control of behavior.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><p>All the code required to fit the HHMM model, and perform all the analysis in this manuscript can be found on Github (<xref ref-type="bibr" rid="bib54">Tao et al., 2018</xref>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/HHMM">https://github.com/elifesciences-publications/HHMM</ext-link>). The dataset can be found on Dryad (doi:<ext-link ext-link-type="uri" xlink:href="https://datadryad.org/resource/doi:10.5061/dryad.m930f2m">10.5061/dryad.m930f2m</ext-link>).</p><sec id="s4-1"><title>Collection of behavioral data</title><p>The methods used to collect the behavioral data were reported in a previous study (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>). Briefly, flies were raised in a sparse culture. Flies that were 3–5 days post-eclosion were starved for 14–18 hr. Locomotion of a single fly was recorded for a 3 min period before odor was introduced (before period) and a 3-min period during odor (during period), using a video camera at a rate of 30 frames per second. The coordinates of the fly were extracted using a custom MATLAB program (<ext-link ext-link-type="uri" xlink:href="https://github.com/bhandawat/fly-walking-behavior/tree/master/tracking">https://github.com/bhandawat/fly-walking-behavior/tree/master/tracking</ext-link>; <xref ref-type="bibr" rid="bib11">Bhandawat, 2017</xref>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/fly-walking-behavior">https://github.com/elifesciences-publications/fly-walking-behavior</ext-link>).</p></sec><sec id="s4-2"><title>Extracting observables from the trajectory</title><p>The behavioral arena was normalized to a unit circle centered at the origin. The raw coordinates of the centroid of the fly were smoothed using wavelet denoising followed by a locally weighted (lowess) filter. Speed and curvature were defined exactly as in the previous study.</p><p>To quantify the behavior of the 34 flies, we computed the speed of the fly along the original direction of movement (<inline-formula><mml:math id="inf34"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) and the speed of the fly perpendicular to the original direction of movement (<inline-formula><mml:math id="inf35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>). <inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> at time <italic>t</italic> was defined as the component of the velocity at time <inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in the direction of velocity of the fly at time <inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>. <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> was defined as the component of the velocity at time <inline-formula><mml:math id="inf40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> perpendicular to velocity of the fly at time <inline-formula><mml:math id="inf41"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). These values were calculated as follows:<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:msqrt><mml:mi>d</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:msqrt></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ2"><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:msqrt><mml:mi>d</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:msqrt></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Values of <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> found to be further than 4 standard deviations away from the average were set to values drawn from a normally distributed distribution (<inline-formula><mml:math id="inf44"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>) centered at the 4 standard deviation mark. The resulting <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> were then set as the observables used in fitting a 2-level Hierarchical Hidden Markov model (HHMM).</p><p>We employed <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> instead of speed and curvature because curvature is very noisy at low speeds because the calculation of curvature requires division by the third-power of speed. <inline-formula><mml:math id="inf49"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf50"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> are directly related to speed and curvature as follows<disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>S</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:msubsup><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:msqrt></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ4"><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>C</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mi>d</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p></sec><sec id="s4-3"><title>HHMM modeling</title><p>HMMs are widely used in a variety of fields for modeling time series data. An HMM is a Markov model which assumes that a given sequence of observations may be explained by a set of states that are not observed (or hidden states), and the time independent probability of transitioning between these states. The model processes which produce the observations in an HMM are hidden to the researcher and thus, the goal of fitting an HMM is to uncover the highest likelihood probability model parameters that can generate the data. Baum and others developed the core theory of HMMs (<xref ref-type="bibr" rid="bib4">Baum and Petrie, 1966</xref>). Since then there has been much exploration of model architecture, and fitting procedure.</p><p>HMMs have been shown to be effective in modeling behavior because instantaneous measures of an observable are variable; therefore, behavioral states inferred by the application of simple thresholding to instantaneous measures of the observables are likely to be erroneous. HMM remedies this problem by inferring states based not only on the value of the observable at the current time point but also on the previous and following time points, and allows a more accurate determination of state (this idea is well-explained in <xref ref-type="fig" rid="fig2">Figure 2</xref> in ref 17). Specifically, the assumption of Markov dynamics with a sparse prior on state transitions penalizes the consideration of unlikely state transitions based upon recent history (forward filtering) and future destinations (backward smoothing).</p><p>The HHMM is an extension to the HMM which applies hierarchical structure in the form that higher level state is itself an HMM composed of its lower level states (<xref ref-type="bibr" rid="bib20">Fine et al., 1998</xref>). The approach we take in exploring and fitting the HHMM closely follows the approach developed by Matt Beal in which he applied variational algorithms to fit HHMM to a time series of observables (<xref ref-type="bibr" rid="bib5">Beal, 2003</xref>).</p><p>This section is divided into three parts. First is the description of the model, second is the details of the process by which the model is fit, and third is the thought process behind our model selection.</p><sec id="s4-3-1"><title>Model description</title><p>The model we describe here has 10 hidden states at the higher level (HL) and 5 hidden states at the lower level (LL) (Figure 2A). The empirical data to which the model is fit is a time series of the two observables - <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf52"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. In building the model, the aim is to assign each instant in this time series to a LL and HL state. Each LL state is associated with a joint probability distribution on the observables. Each HL state is described by the transition probability matrix of its LL states. Therefore, while fitting a HHMM, we are determining three sets of quantities: First, the distribution of <inline-formula><mml:math id="inf53"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf54"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> which describes each LL states (Figure 3-S1A/B). Second, the transition probabilities (TP) between the LL states which describe each HL state (Figure 2-S3B). Finally, the transition probabilities between the HL states (Figure 2-S2A). Based on the values of <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf56"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, the model assigns a sequence of HL and LL states which best describes the data.</p><p>TP matrix for the HL states and the LL states associated with each HL states is shown in <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>. In each case, the TP matrix describes the probability (P<sub>ij</sub>) that a fly in a given state detailed in the <italic>j</italic><sup>th</sup> column will transition to a different high-level state detailed in the <italic>i</italic><sup>th</sup> row. The high-level states are arranged in ascending order of mean speed/variance in curvature ratio. Because of this arrangement, the TP for the HL states appears well-structured. From any state, there is a strong tendency to transition to one of the neighboring state. This tendency implies that flies transition to states which have a similar speed/curvature ratio. LL states that belong to the same HL state often have more similar speed/curvature ratios. Thus, there is less of a tendency for LL states to transition to the LL state with the closest speed/curvature ratio. Nevertheless, the LL state transition probability matrices, too, are sparse; signifying a distinct pattern of transition between LL states (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3B</xref>).</p><p><xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A and B</xref> shows the joint distribution for <inline-formula><mml:math id="inf57"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> - <inline-formula><mml:math id="inf58"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for each state. Each row represents one HL state and its low-level children. In each panel, the solid line represents the model predictions and dots represent empirical values. Each LL state is modeled as a multi-variate normal distribution of observables. The solid line represents the bound within which the model predicts 85% of the data points corresponding to a given LL state lie. The empirical data points represent randomly selected subset of data corresponding to instants which the model assigns to a given LL state. The close agreement between the two for most LL states implies that the model is an excellent descriptor of the observables. The few exceptions where either the model distribution is too broad or where the model is not a good descriptor of the data reflect cases in which there are not too many data points in the concerned state (See for example, LL state 1 for HL state 6, <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref> ). Each HL state is a composite of the 5 LL state because for every time instance the fly is in a given HL state, the model assigns a LL state. Therefore, we can consider the probability density function of a HL state as the sum of the probability density functions of its LL states. From this, we can calculate the 85<sup>th</sup> percentile contour for the corresponding probability density function for the HL states (<xref ref-type="fig" rid="fig3">Figure 3A2</xref> , <xref ref-type="fig" rid="fig4">Figure 4</xref>). Again there is a strong agreement between model and empirical data.</p></sec><sec id="s4-3-2"><title>Fitting process</title><p>We will first formally define a HMM as follows:</p><table-wrap id="inlinetable1" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top">Variable</th><th valign="top">Description</th></tr></thead><tbody><tr><td valign="top">s<sub>t</sub> ∈ [1,2,…N]</td><td valign="top">Indicates which of the N states is occupied at time t ∈ [1,2,…T]</td></tr><tr><td valign="top">A = (a<sub>ij</sub>)</td><td valign="top">A NxN transition matrix where a<sub>ij</sub> represents the probability of transitioning from state i to state j.</td></tr><tr><td valign="top">O = o<sub>1</sub>,o<sub>2</sub>,…o<sub>T</sub></td><td valign="top">A sequence of observables composing of the two-dimensional data set: <inline-formula><mml:math id="inf59"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf60"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></td></tr><tr><td valign="top">B<sub>ti</sub> = P(o<sub>t</sub>|s<sub>t</sub> = i)</td><td valign="top">Emission probability describing the probability of an observation o<sub>t</sub> t ∈ [1,2,…T] being generated from a state s<sub>t</sub> = <italic>i</italic>; Assumed to be Gaussian.</td></tr><tr><td valign="top">π= π<sub>1</sub>, π <sub>2</sub>,… π <sub>N</sub></td><td valign="top">The initial probability distribution of states.</td></tr></tbody></table></table-wrap><p>For our two layered HHMM, we chose a structure composing of 10 high-level states (HL state) on the top level with each HL state being associated with five low-level states (LL states) on the bottom level (<xref ref-type="fig" rid="fig2">Figure 2</xref>). Each LL state is modeled as a multivariate normal (MVN) distribution on the observables, and the HL states as being fully described by the mixture of LL state distributions associated with the HL state.</p><p>Now we will define our two layered HHMM as follows:</p><table-wrap id="inlinetable2" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th valign="top">Variable</th><th valign="top">Description</th></tr></thead><tbody><tr><td valign="top"><inline-formula><mml:math id="inf61"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> [1,2,…N<sub>HL</sub>]</td><td valign="top">Indicates which high level state is occupied at time t ∈ [1,2,…T]</td></tr><tr><td valign="top"><inline-formula><mml:math id="inf62"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>∈ [1,2,…N<sub>LL</sub>]</td><td valign="top">Indicates which low level state is occupied</td></tr><tr><td valign="top"><inline-formula><mml:math id="inf63"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></td><td valign="top">High level state transition probability matrix, <italic>q<sub>kl</sub></italic> represents the probability of transitioning from high level state k to high level state <italic>l</italic>.</td></tr><tr><td valign="top"><inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>A</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>= (<inline-formula><mml:math id="inf65"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>)</td><td valign="top">The low level state transition probability matrix. Here <inline-formula><mml:math id="inf66"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> represents the probability of transitioning from low level state <italic>i</italic> to low level state <italic>j</italic> given that the high level state is <italic>k</italic></td></tr><tr><td valign="top">O = o<sub>1</sub>,o<sub>2</sub>,…o<sub>T</sub></td><td valign="top">A sequence of observables composing of the two-dimensional data set: <inline-formula><mml:math id="inf67"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf68"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></td></tr><tr><td valign="top">B<sub>tki</sub> = P(o<sub>t</sub>|<inline-formula><mml:math id="inf69"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>)</td><td valign="top">Emission probability describing the probability of an observation o<sub>t</sub> t∈[1,2,…T] being generated from a HLS <inline-formula><mml:math id="inf70"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>=k and associated low level state <inline-formula><mml:math id="inf71"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. Assumed to be Gaussian.</td></tr><tr><td valign="top">π<sup>0</sup> <break/>π<sup>k</sup></td><td valign="top">The initial probability distribution of HLS. <break/>The initial probability distribution of LLS for HLS <italic>k</italic>.</td></tr></tbody></table></table-wrap><p>We can henceforth refer to the set of model parameters as <inline-formula><mml:math id="inf72"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>π</mml:mi><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and the latent state variables as <inline-formula><mml:math id="inf73"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mtext> </mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>…</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. For a given set of observations, the goal is to obtain a posterior probability distribution over the parameters and latent state variables. We approximate this posterior distribution as a factorized distribution over latent variables and parameters, that is <inline-formula><mml:math id="inf74"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, and use the Variational Bayesian Expectation Maximization (VBEM) algorithm to find the best approximation. <italic>q</italic>(<italic>Z</italic>) is obtained using the forward-backward algorithm which provides sufficient statistics needed to update the approximate posterior distributions over the parameters. In this setting, posterior probability distributions over rows of transition probability matrices are assumed to be Dirichlet, and the prior is chosen to favor self-transition parameters, <inline-formula><mml:math id="inf75"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>&gt;</mml:mo><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, while discouraging the use of unneeded states that is, <inline-formula><mml:math id="inf76"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>&lt;</mml:mo><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> for, <inline-formula><mml:math id="inf77"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. Initial state distributions were also assumed to be Dirichlet with <inline-formula><mml:math id="inf78"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>&lt;</mml:mo><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>The emissions probability distributions associated with each state were assumed to be Normal inverse Wishart with a prior favoring zero mean and unit variance. For each computational run, the initial parameters of these posterior distributions were randomized.</p><p>The priors used for fitting were such that within state transitions (<italic>i-</italic>th HL state to <italic>i-</italic>th HL state) was six times higher than transitions across HL states ((<italic>i-</italic>th HL state to <italic>j-</italic>th HL state). The prior for all <italic>i</italic>-to-<italic>j</italic> transitions were same. The Dirichlet prior over state transitions which we used was very weak. Specifically, in strength, the prior we used corresponds to the equivalent of two observations relative to the &gt;10,000 observations that we used to fit the model for each fly.</p><sec id="s4-3-2-1"><title>VBEM algorithm</title><p>The Variational Bayesian Expectation Maximization algorithm functions by iteratively updating the two components of our factorized approximation to the true posterior over parameters and latent variables and exploits conditional conjugacy to identify explicit update rules for all distributions over parameters. The goal of the VBEM algorithm is described alternatively as minimizing model error as given by the Kullback-Leibler divergence between the approximate and true posterior distributions; or maximizing a lower bound on the marginal probability of the data given the model. It is perhaps easiest to see how the algorithm works by considering the KL(q,p) instantiation. Under our factorized approximation, this objective function takes the form<disp-formula id="equ5"><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mo>∫</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>θ</mml:mi><mml:mi>d</mml:mi><mml:mi>Z</mml:mi><mml:mo>+</mml:mo><mml:mo>∫</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>θ</mml:mi><mml:mi>d</mml:mi><mml:mi>Z</mml:mi></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>The VBEM algorithm minimizes this objective function using coordinate ascent in the q(θ) q(z) function space. That is we obtain iterative update rules by simply taking the functional derivative if the KL with respect to q(Z) for fixed q(θ) and then solving for q(Z). This results in the so-called E step where we update the posterior distribution over latent variables by averaging the true joint distribution of observations, parameters, and latent variables over our current estimate of the posterior on parameters:<disp-formula id="equ6"><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In the so called M step, the roles are reversed:<disp-formula id="equ7"><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Here, the tilde indicates equality up to an additive constant. This two-step procedure is repeated until convergence. The simplicity of these equations belies the complexity of the actual calculation of the posterior distribution over latent state variables. This is accomplished using the well-known forward-backward algorithm. The particular implementation of the forward-backward algorithm used in VB differs from the traditional EM implementation in that the parameters of the transition probability matrix are obtained by exponentiation of the geometric mean of the transition probability matrices:<disp-formula id="equ8"><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Based on the current posterior over parameters instead of simply using a maximum likelihood or MAP estimate. Because we assumed the rows of the transition probability matrix to be sparse, this further encourages the model to leave un-needed states unused.</p><p>Regardless, based on the assignments of observable tracks to HHMM models, we can iteratively update model parameters for each cluster to maximize the probability of observing the observables given the model parameters and the initial LL state probability density using the forward-backward algorithm. This operation can be thought of as the maximization step where we are calculating the best set of model parameters (<inline-formula><mml:math id="inf79"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) that maximizes the Q function.</p><p>Although the EM algorithm is guaranteed to get a better fit on every iteration, it often does not converge to a global optimum of the likelihood function. As such, we implemented a system of cluster pruning, splitting, and reassignment to perturb the system in the case of reaching a local minimal fit. In the pruning step, unused clusters are removed until we are left with at most two unused clusters. In the splitting step, one cluster was selected based on a pseudorandom selection weighted by the size of the clusters (number of flies best fit to the cluster). The flies are then clustered into two clusters using k-means clustering based on the expected distribution of lower level state usage. Individual HHMMs were fit to each of these new clusters. In the cluster reassignment step, we filled each unused cluster(s) with the fly(s) that had the worst fit to the current cluster assignment. After each step, we conducted 10 iterations of the EM algorithm. The sequence of perturbations was conducted for 10 iterations before a final fit using the EM algorithm was conducted until convergence.</p></sec><sec id="s4-3-2-2"><title>Mixture Model</title><p>To account for differing search strategies that may be utilized by different flies we also fit a mixture of HHMMs to our multi-fly data set. The goal of this model is to identify a small set of different HHMMs that can describe our entire data set by clustering flies according to the similarity in their locomotion. In this context, two flies are said to behave similarly if the same HHMM provides a good description of their behavior. To model this scenario, we added another layer to our Bayesian model of the fly movement dataset. In this topmost layer, we instantiate a Dirichlet process which probabilistically assigns a label, <italic>z<sub>n</sub></italic>, to the <italic>n</italic><sup>th</sup> fly. When <italic>z<sub>n</sub> = k</italic>, it indicates that the <italic>k</italic><sup>th</sup> HHMM under consideration governs the fly’s movement. Therefore, in addition to identifying the posterior distribution over high and low-level states, we also infer a probability distribution over cluster assignments. These probability distributions are then used to determine how much we should weight each fly’s movement data when updating the parameters of the different HHMM’s.</p></sec></sec><sec id="s4-3-3"><title>Model selection</title><p>In this study, we experimented with models with a varying number of HL states (6-16), and low-level states (4-6). One limitation of our fitting procedure is that it is not possible to compare models with a different number of states objectively, and thus the choice of model depends on the investigator. We chose a model with 10 HL states for two reasons: The most compelling reason is that different model runs with 10 HL states produced results that were more similar to each other than did model runs with either lower or higher number of states. Another reason is that as the number of HL states in the model is increased, many HL states are sparsely used.</p><p>We think that the range 6–12 is a fairly narrow range. One important point is that within this narrow range of states, the state duration in all the models we tried were very similar.</p><p>One important limitation of our modeling approach (which we realized in hindsight) is that it is difficult to compare across models because everything changes slightly– LL states change, HL states change. We are currently revising the model to keep the LL states fixed so that the modeling approach would mostly focus on how the HL select the LL states. This process will make it much easier to compare across models.</p></sec></sec><sec id="s4-4"><title>Comparison of HMM with HHMM</title><sec id="s4-4-1"><title>Block clustering of HMM</title><p>For a given HMM fit, we may obtain the transition probability matrix (A). To obtain higher level structure from the states fit to a HMM, we may cluster the states based on their likelihood to transition to each other. One method of sorting and clustering the transition matrix into a block diagonal structure involves the use of information bottleneck formalism (<xref ref-type="bibr" rid="bib9">Berman et al., 2016</xref>; <xref ref-type="bibr" rid="bib56">Tishby et al., 1999</xref>). We used this method to search for a given K=10 clusters with an inverse temperature <inline-formula><mml:math id="inf80"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> from 1 to 300 and time lag values of between 1 to 45 (33 ms to 1500 ms). We found that <inline-formula><mml:math id="inf81"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> from 100-200 with time lags of 10-40 showed some of the same structure as the HHMM. We showed one solution using a time lag of 10 and a <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> of 100 on an HMM fit of 50 states with 31 used states (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref> ).</p></sec><sec id="s4-4-2"><title>Bayesian model comparison</title><p>Given an HMM and an HHMM model with equal number of total states and observables O, we wish to calculate the probability of the HHMM model given the observations (P(HHMM|O)). Using Bayes theorem, we can calculate this with:<disp-formula id="equ9"><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>H</mml:mi><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>O</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Utilizing a flat prior and Bayes factor:<disp-formula id="equ10"><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>H</mml:mi><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We now obtain:<disp-formula id="equ11"><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>K</mml:mi></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="normal">l</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">o</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>K</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We utilized the evidence lower bound to approximate <inline-formula><mml:math id="inf83"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>H</mml:mi><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf84"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. From this we can interpret the <inline-formula><mml:math id="inf85"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> as 1 – p-values where <inline-formula><mml:math id="inf86"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = the HMM model is a better model fit. We obtain a <inline-formula><mml:math id="inf87"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 0.9999 indicating that we can reject the HMM model at p &lt; 0.0001.</p></sec><sec id="s4-4-3"><title>Parameter comparison</title><p>To define an HMM, we need the transition probability(<inline-formula><mml:math id="inf88"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> for and the description for the probability distributions defining each state. This means that there will be <inline-formula><mml:math id="inf89"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>K</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>K</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> parameters where <inline-formula><mml:math id="inf90"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> designates the total number of states and <inline-formula><mml:math id="inf91"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> designates the number of parameters defining the distributions. To define a HHMM, we need the transition probabilities at each level <inline-formula><mml:math id="inf92"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for <inline-formula><mml:math id="inf93"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>≤</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>l</mml:mi><mml:mo>≤</mml:mo><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and the probability distributions defining each state. This means that in a model architecture in which each state at a level (<inline-formula><mml:math id="inf94"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) is composed of equal numbers of states one level lower (<inline-formula><mml:math id="inf95"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>l</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>), there will be <inline-formula><mml:math id="inf96"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mo movablelimits="false">∏</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> parameters. The distributions used in this report consisted of two-dimensional multivariate Gaussians, which are described by five parameters (<inline-formula><mml:math id="inf97"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>). The model that we employ in the manuscript has 10<sup>2</sup>+10*5<sup>2</sup>+50*5 = 600 parameters.</p></sec></sec><sec id="s4-5"><title>Post-hoc analyses based on the HHMM model</title><sec id="s4-5-1"><title>Pre-processing of the model output</title><p>For each time point, the model assigns the probability that the fly is in each of the 10 HL states. We only included time instances where the model assigned a probability of &gt;0.85 for one of the 10 states; this condition was satisfied for 81% of all data points (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Instances during which the flies transitioned from one HL state to another HL state and back to the same initial state in less than five frames (~170 ms) were reassigned to the initial HL state. Furthermore, instances during which the fly only spends one frame (~30 ms) in a certain HL state before changing states were removed. These corrections were done because such short transitions are likely to arise from noise in the observables rather than rapid transitions. Tracks of HL and LL states were extracted to compute the empirical distribution of the observables (gray dots in <xref ref-type="fig" rid="fig3">Figures 3A</xref> and <xref ref-type="fig" rid="fig4">4</xref> and <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A/B</xref>).</p><p>Each HL state track was translated to begin at the origin by subtracting the position of the first point in the track. Then we rotated each track such that the fly is moving in the forward direction (positive y axis) at the start of the track. We considered the overall vector of the 10 frames (330 ms) before each track as the vector defining the fly’s directional intent prior to starting a track. We defined the angle of rotation as the angle between this vector and the forward direction. These translated and rotated tracks allow us to visualize the distinct types of locomotion defined by the HL states (trajectories in <xref ref-type="fig" rid="fig3">Figures 3C</xref> and <xref ref-type="fig" rid="fig4">4</xref>).</p></sec><sec id="s4-5-2"><title>Sorting of the HL states</title><p>The model output numbers the HL state in a random order with respect to the underlying distribution of observables. To better understand the structure underlying transitions between HL states, we rearranged the states from low-speed-high-turn states to high-speed-low-turn-states by sorting the HL states of the model based on the ratio of their mean speed over the variance in curvature.</p></sec><sec id="s4-5-3"><title>Analysis of the effect of odors on the HL states</title><p>The nominal radius of the odor-zone defined by the radius of the odor tube was 1.25 cm (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>). However, because there was some spread of the odor outside the odor-zone, the actual radius of the odor-zone was 1.5cm (<xref ref-type="bibr" rid="bib32">Jung et al., 2015</xref>). A fly was considered to be inside the odor-zone when it was within the 1.5 cm radius. Although the odor was turned on 3 min following the start of the recording period, because the odor was only present inside the odor-zone, we considered the first time the fly entered the odor-zone after 3 min (first entry) as the start of the odor period. Based on a combination of the presence of odor and the location of the fly, we parsed the data into four categories: These were defined as inside odor-zone before first entry (B<sub>I</sub>), inside odor-zone following first entry (D<sub>I</sub>), outside odor-zone before first entry (B<sub>O</sub>), and outside odor-zone following first entry (D<sub>O</sub>). The standard deviation (SD) of the probability of HL states (P) in each scenario were calculated as follows:<disp-formula id="equ12"><mml:math id="m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:msqrt></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ13"><mml:math id="m13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">∀</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mn>10</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mrow><mml:mi mathvariant="normal">H</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi></mml:mrow><mml:mrow><mml:mtext> </mml:mtext></mml:mrow><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula>where N is the total number of data points in the scenario.</p><p>For each fly, we measured the probability distribution of HL states occupancy for each of our four scenarios. <xref ref-type="fig" rid="fig5">Figure 5</xref> shows the average probability distribution of these HL state occupancy with error bars denoting 95% confidence intervals calculated by bootstrap resampling using the BCa method (<xref ref-type="bibr" rid="bib19">Efron and Tibshirani, 1993</xref>). We then conducted a bootstrap test for testing equal means in order to determine significance in the change in HL state distribution after odor onset for inside and outside the odor region separately (<xref ref-type="bibr" rid="bib19">Efron and Tibshirani, 1993</xref>). Briefly, we first consider a given HL state probability of occurrence inside the odor zone for before (B) and after first entry (A). Our null hypothesis was that there was no change in the mean probability of observing the HL state. To test the null hypothesis, we first constructed populations F and G by translating populations A and B respectively such that F and G share a common mean. We then drew bootstrap samples of flies F’ from population F and G’ from population G and calculate the test statistic as follows:<disp-formula id="equ14"><mml:math id="m14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>T</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mover><mml:msup><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:msup><mml:mi>G</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:msqrt><mml:mfrac><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msup><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mi>n</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msup><mml:mi>G</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mi>n</mml:mi></mml:mfrac></mml:msqrt></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ15"><mml:math id="m15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mover><mml:msup><mml:mi>F</mml:mi><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ16"><mml:math id="m16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msup><mml:mi>G</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>G</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mo>−</mml:mo><mml:mover><mml:msup><mml:mi>G</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We repeated this process 10,000 times to generate a distribution of the test statistic that we would expect from the null hypothesis. We then calculated the empirical statistic using the same formulation as the test statistic: TS(A,B). Using the distribution of test statistic and our empirical statistic, we conducted a two-tailed test with alpha = 0.05 and 0.01. As our data included multiple statistical tests (one for each HL state), we corrected for multiple comparisons by applying the Holm-Bonferroni procedure. This process was repeated for outside the odor zone.</p></sec><sec id="s4-5-4"><title>X-Means clustering</title><p>X-means clustering is an extension of K-means clustering. K-means clustering is an iterative algorithm that assigns data points to one of K groups based on the distance between points and the cluster centers; in most versions of K-means clustering, the number of clusters is specified by the user. X-means extends the K-means algorithm by computing the Bayesian information criterion (BIC) scores associated with a given K-means model fit, and, therefore allows a better assessment of the appropriate number of clusters in the data (<xref ref-type="bibr" rid="bib44">Pelleg and Moore, 2000</xref>). Following Raftery et al. (<xref ref-type="bibr" rid="bib46">Raftery, 1995</xref>), we computed the t-score based on the change in BIC given an increase in the number of clusters for N = 34 flies as follows:<disp-formula id="equ17"><mml:math id="m17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">B</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">I</mml:mi></mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">C</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">K</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="normal">B</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">I</mml:mi></mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">C</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">K</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>≈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">t</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="normal">l</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">o</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">N</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In this case, the t statistic and the corresponding p values represent the likelihood that k-means with a given cluster size will do significantly better than one with smaller cluster size. We chose the maximum cluster K that fulfilled t &gt; 3.86 (p &lt; 0.05) and within 5% of the minimum BIC.</p><p>In the analyses in <xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>, we clustered flies based on a 10-dimensional representation of the fractional time a fly spends in each of the 10 HL states. We also employ X-means clustering in <xref ref-type="fig" rid="fig8">Figure 8</xref> to cluster a fly’s response to odors. In this analysis, the clustering was performed on odor-evoked change in HL state occupancy: For inside the odor-zone, D<sub>I</sub>-B<sub>I</sub> was computed for each fly and was the input to the X-means. For outside the odor-zone, D<sub>o</sub>-B<sub>o</sub> was computed for each fly and was the input to the X-means (<xref ref-type="fig" rid="fig8">Figure 8</xref>).</p><p>The clustering was performed on the 10-dimensional representation; but, for visual representation, we conducted PCA on the HL state distributions in each of the four scenarios to obtain a 2-dimensional representation of the clusters of flies (<xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>). The first two principal components explain less than 90% of the variance.</p><p>The 10-dimensional HL state probability distributions used in <xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref> reside on a 9-dimensional probability simplex:<disp-formula id="equ18"><mml:math id="m18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mtext> </mml:mtext></mml:mrow><mml:mo>:</mml:mo><mml:mrow><mml:mtext> </mml:mtext></mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To assess whether the x-means clusters found in our data set are valid, we conducted x-means on a set of 34 points sampled randomly from the uniformly distributed 9-simplex space our data resides in. To sample from this simplex, we used a flat Dirichlet distribution marked by the following density function.<disp-formula id="equ19"><mml:math id="m19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>α</mml:mi><mml:mi>K</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>;</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mi mathvariant="normal">h</mml:mi></mml:mrow><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mrow><mml:mtext> </mml:mtext></mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></disp-formula>where K = the number of dimensions. We found that x-means did not cluster these sampled data points into clusters.</p></sec><sec id="s4-5-5"><title>Logistic regression model</title><p>We employed logistic regression (logit) models (<xref ref-type="bibr" rid="bib17">Cox, 1958</xref>; <xref ref-type="bibr" rid="bib18">Dobson and Barnett, 2008</xref>) – a generalized linear model which can be used to describe the relationship between independent observations and a binary dependent variable. In this study, we analyzed whether the distribution of HL states in a one-second window is predictive of whether the fly is inside the odor-zone or outside it. Because of the difference in a fly’s behavior inside and outside the odor zone, we separately performed this analysis inside and outside the odor-zone. We performed three different logistic regressions in this study: The analysis process is the same; the only difference is how flies were grouped. In the first analysis (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>), a single regression was performed for all the flies. In the second analysis (<xref ref-type="fig" rid="fig8">Figure 8A/B</xref>, <xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref>), we calculated regressions individually for each fly so that there are 34 regressions –one for each fly. Finally, in <xref ref-type="fig" rid="fig8">Figure 8C</xref>, we calculated logistic regression individually for each cluster of flies – five clusters inside the odor-zone and four outside the odor-zone. The process for performing logistic regression is described below and illustrated in <xref ref-type="fig" rid="fig7s1">Figure 7—figure supplements 1</xref> and <xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref>.</p><p>First, we divide the data into 1 s time-bins. We also performed logistic regression on data subdivided into 0.33, 0.66, and 3 s bins (corresponding to 10, 20 and 90 data points) with varying amounts of time overlap and found no notable differences in model predictions. Because we want the chance prediction to be 50% in each analysis, bins were randomly removed from either the before or during case such that the total number of bins were the same for the before period and during period. Next, we performed principal component analysis (PCA) on the distribution to obtain a smaller number of uncorrelated variables. We considered the smallest number of principal components that cumulatively explained over 90% of the variance in our analysis.</p><p>The resulting principal components were used as predictors in fitting to a logarithmic regression model. We used the MATLAB built-in function ‘glmfit.m’ to implement fitting to a generalized linear model. For fitting to logit model, we used a binomial distribution (having experienced the odor or not) and the ‘logit’ criterion. The resulting logistic function based on the population data was used to predict if a fly was experiencing odor in any given 1 s bin.</p><p>To evaluate the predictive power of the raw observables (speed and curvature) on the behavior of the flies, the GLM was fit using the speed and curvature as predictors instead of the distributions of HL states. To compare the relative probability of correct predictions on for each fly between two different types of GLM fits (M<sub>1</sub>, M<sub>2</sub>), we considered the perpendicular distance (<inline-formula><mml:math id="inf98"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="normal">j</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>) of these fits from the line of unity (indicating perfect correlation).<disp-formula id="equ20"><mml:math id="m20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula><disp-formula id="equ21"><mml:math id="m21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">∀</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mn>34</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To determine whether HL states performed better than the observables, a Wilcoxon matched rank test was conducted on the 34 distances calculated for each of the model comparisons (<xref ref-type="fig" rid="fig8">Figure 8B</xref>, <xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>).</p><p>As X-means was conducted on the average distribution of HL states for each fly in each scenario, the partitioning obtained will not necessarily reflect the optimal clustering of flies based on ability to distinguish if the fly has encountered odor or not given a smaller (1 s) time bin observation of HLS distribution. To better partition flies into clusters based on both the average difference across time and smaller snapshots of difference across the 1 s time frame, we took X-means as the first partitioning of flies. Then we took a total of 6 flies from the largest clusters (n &gt; 10) that had the worst predictive power given GLM fits based on clusters. We then redistributed these flies into clusters in order to maximize the sum of the predictive power of individual flies across all clusters.</p></sec><sec id="s4-5-6"><title>Generation of synthetic flies</title><p>HHMM synthetic flies were generated based on the transition probabilities for each of the four scenarios (B<sub>I</sub>, B<sub>O</sub>, D<sub>I</sub> and D<sub>O</sub>) separately. To generate a synthetic track, an HL state was first chosen based on the occurrence probability distribution of HL states. At this point, a new HL state was assigned for the next time instance (<inline-formula><mml:math id="inf99"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) based on the HL transition probability matrix. Since the empirical flies spent variable time in the four scenarios, in the creation of the tracks we chose the median time spent. Therefore, each synthetic fly lasted until the total duration was reached for each scenario (<xref ref-type="fig" rid="fig7s2">Figure 7—figure supplement 2</xref>). 100 sets of 34 synthetic flies were generated for each of the four scenarios (<xref ref-type="fig" rid="fig7">Figure 7A</xref>, <xref ref-type="fig" rid="fig7s3">Figure 7—figure supplement 3</xref>). The resulting synthetic average distribution of HL states for each of the four scenarios was compared across the 100 iterations and showed high consistency between iterations.</p></sec></sec><sec id="s4-6"><title>Prediction of clusters-based subsampling</title><p>Time points were sampled using four methods based on bin duration for each fly for the two scenarios with the most data (B<sub>o</sub> and D<sub>i</sub>) separately (<xref ref-type="fig" rid="fig7s4">Figure 7—figure supplement 4</xref>). In method one, for a given scenario, segments of continuous repeated HL states were randomly sampled and stitched together until the duration of the time bin was fulfilled. In the second method, a window lasting the time bin was sampled from the HL states for the scenario. In method three, the segments were sampled starting with the first time point of the scenarios. In method four, the segments were sampled starting with the last time point of the scenarios and moving backwards in time. After sampling, the average HL state distributions were calculated for each time bin and the Euclidean distance from the distribution to the centroid of each X-means cluster for the given scenario were calculated. The closest cluster was compared to the X-means cluster assignment based on all time points. This process was repeated 100 times to generate a mean percentage of correctly labeled flies based on the subsampling duration. Chance was calculated as the probability of choosing a fly for a given cluster and being in the Voronoi cell of the cluster. This translates to:<disp-formula id="equ22"><mml:math id="m22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf100"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the probability of observing cluster i based on the number of flies in each cluster, <inline-formula><mml:math id="inf101"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is a weighting based on the size of Voronoi cell in the simplex space, and K is the total number of clusters.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We acknowledge the members of Bhandawat lab and Gaby Maimon for critical comments on earlier versions of the manuscript. This research was supported by NIDCD (VB), NINDS (VB) and an NSF CAREER award (VB).</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Data curation, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Software, Formal analysis</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Resources, Data curation, Formal analysis, Supervision, Funding acquisition, Validation, Visualization, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.41235.027</object-id><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-41235-transrepform-v2.docx"/></supplementary-material><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>Data has been deposited in Dryad Data Repository and is available at doi:10.5061/dryad.m930f2m. All the code required to fit the HHMM model, and perform all the analysis in this manuscript can be found on Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/bhandawat/HHMM">https://github.com/bhandawat/HHMM</ext-link>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/HHMM">https://github.com/elifesciences-publications/HHMM</ext-link>).</p><p>The following dataset was generated:</p><p><element-citation id="dataset1" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Tao</surname><given-names>L</given-names></name><name><surname>Ozarkar</surname><given-names>S</given-names></name><name><surname>Beck</surname><given-names>J</given-names></name><name><surname>Bhandawat</surname><given-names>V</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Data from: Statistical structure of locomotion and its modulation by odors</data-title><source>Dryad Digital Repository</source><pub-id assigning-authority="Dryad" pub-id-type="doi">10.5061/dryad.m930f2m</pub-id></element-citation></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Álvarez-Salvado</surname> <given-names>E</given-names></name><name><surname>Licata</surname> <given-names>AM</given-names></name><name><surname>Connor</surname> <given-names>EG</given-names></name><name><surname>McHugh</surname> <given-names>MK</given-names></name><name><surname>King</surname> <given-names>BM</given-names></name><name><surname>Stavropoulos</surname> <given-names>N</given-names></name><name><surname>Victor</surname> <given-names>JD</given-names></name><name><surname>Crimaldi</surname> <given-names>JP</given-names></name><name><surname>Nagel</surname> <given-names>KI</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Elementary sensory-motor transformations underlying olfactory navigation in walking fruit-flies</article-title><source>eLife</source><volume>7</volume><elocation-id>e37815</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.37815</pub-id><pub-id pub-id-type="pmid">30129438</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baerends</surname> <given-names>GP</given-names></name></person-group><year iso-8601-date="1976">1976</year><article-title>On drive, conflict and instinct, and the functional organization of behavior</article-title><source>Progress in Brain Research</source><volume>45</volume><fpage>425</fpage><lpage>447</lpage><pub-id pub-id-type="doi">10.1016/S0079-6123(08)61002-X</pub-id><pub-id pub-id-type="pmid">1013347</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Barlow</surname> <given-names>GW</given-names></name></person-group><year iso-8601-date="1977">1977</year><chapter-title>Modal action patterns</chapter-title><source>How Animals Communicate</source><publisher-loc>Indianapolis</publisher-loc><publisher-name>University of Indiana Press</publisher-name><fpage>98</fpage><lpage>134</lpage></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baum</surname> <given-names>LE</given-names></name><name><surname>Petrie</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="1966">1966</year><article-title>Statistical inference for probabilistic functions of finite state markov chains</article-title><source>The Annals of Mathematical Statistics</source><volume>37</volume><fpage>1554</fpage><lpage>1563</lpage><pub-id pub-id-type="doi">10.1214/aoms/1177699147</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="thesis"><person-group person-group-type="author"><name><surname>Beal</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Variational Algorithms for Approximate Bayesian Inference</article-title><publisher-loc>London</publisher-loc><publisher-name>University of London</publisher-name></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bell</surname> <given-names>JS</given-names></name><name><surname>Wilson</surname> <given-names>RI</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Behavior reveals selective summation and max pooling among olfactory processing channels</article-title><source>Neuron</source><volume>91</volume><fpage>425</fpage><lpage>438</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2016.06.011</pub-id><pub-id pub-id-type="pmid">27373835</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berg</surname> <given-names>HC</given-names></name><name><surname>Brown</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="1972">1972</year><article-title>Chemotaxis in <italic>Escherichia coli</italic> analysed by three-dimensional tracking</article-title><source>Nature</source><volume>239</volume><fpage>500</fpage><lpage>504</lpage><pub-id pub-id-type="doi">10.1038/239500a0</pub-id><pub-id pub-id-type="pmid">4563019</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berman</surname> <given-names>GJ</given-names></name><name><surname>Choi</surname> <given-names>DM</given-names></name><name><surname>Bialek</surname> <given-names>W</given-names></name><name><surname>Shaevitz</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Mapping the stereotyped behaviour of freely moving fruit flies</article-title><source>Journal of the Royal Society Interface</source><volume>11</volume><elocation-id>20140672</elocation-id><pub-id pub-id-type="doi">10.1098/rsif.2014.0672</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berman</surname> <given-names>GJ</given-names></name><name><surname>Bialek</surname> <given-names>W</given-names></name><name><surname>Shaevitz</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Predictability and hierarchy in Drosophila behavior</article-title><source>PNAS</source><volume>113</volume><fpage>11943</fpage><lpage>11948</lpage><pub-id pub-id-type="doi">10.1073/pnas.1607601113</pub-id><pub-id pub-id-type="pmid">27702892</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berman</surname> <given-names>GJ</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Measuring behavior across scales</article-title><source>BMC Biology</source><volume>16</volume><elocation-id>23</elocation-id><pub-id pub-id-type="doi">10.1186/s12915-018-0494-7</pub-id><pub-id pub-id-type="pmid">29475451</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Bhandawat</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>fly-walking-behavior</data-title><version designator="0a8056e">0a8056e</version><publisher-name>GitHub</publisher-name><ext-link ext-link-type="uri" xlink:href="https://github.com/bhandawat/fly-walking-behavior">https://github.com/bhandawat/fly-walking-behavior</ext-link></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Branson</surname> <given-names>K</given-names></name><name><surname>Robie</surname> <given-names>AA</given-names></name><name><surname>Bender</surname> <given-names>J</given-names></name><name><surname>Perona</surname> <given-names>P</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>High-throughput ethomics in large groups of Drosophila</article-title><source>Nature Methods</source><volume>6</volume><fpage>451</fpage><lpage>457</lpage><pub-id pub-id-type="doi">10.1038/nmeth.1328</pub-id><pub-id pub-id-type="pmid">19412169</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buchanan</surname> <given-names>SM</given-names></name><name><surname>Kain</surname> <given-names>JS</given-names></name><name><surname>de Bivort</surname> <given-names>BL</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Neuronal control of locomotor handedness in Drosophila</article-title><source>PNAS</source><volume>112</volume><fpage>6700</fpage><lpage>6705</lpage><pub-id pub-id-type="doi">10.1073/pnas.1500804112</pub-id><pub-id pub-id-type="pmid">25953337</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Budick</surname> <given-names>SA</given-names></name><name><surname>Reiser</surname> <given-names>MB</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>The role of visual and mechanosensory cues in structuring forward flight in Drosophila melanogaster</article-title><source>Journal of Experimental Biology</source><volume>210</volume><fpage>4092</fpage><lpage>4103</lpage><pub-id pub-id-type="doi">10.1242/jeb.006502</pub-id><pub-id pub-id-type="pmid">18025010</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Budick</surname> <given-names>SA</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Free-flight responses of Drosophila melanogaster to attractive odors</article-title><source>Journal of Experimental Biology</source><volume>209</volume><fpage>3001</fpage><lpage>3017</lpage><pub-id pub-id-type="doi">10.1242/jeb.02305</pub-id><pub-id pub-id-type="pmid">16857884</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Chou</surname> <given-names>L-Y</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Techniques to incorporate the benefits of a hierarchy in a modified hidden markov model</article-title><source>Proceedings of the COLING/ACL on Main Conference Poster Sessions</source><conf-name>21st International Conference on Computational Linguistics and 44th Annual Meeting of the Association for Computational Linguistics</conf-name><conf-loc>Sydney, Australia</conf-loc><fpage>120</fpage><lpage>127</lpage></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cox</surname> <given-names>DR</given-names></name></person-group><year iso-8601-date="1958">1958</year><article-title>The regression analysis of binary sequences</article-title><source>Journal of the Royal Statistical Society: Series B</source><volume>20</volume><fpage>215</fpage><lpage>232</lpage><pub-id pub-id-type="doi">10.1111/j.2517-6161.1958.tb00292.x</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Dobson</surname> <given-names>AJ</given-names></name><name><surname>Barnett</surname> <given-names>AG</given-names></name></person-group><year iso-8601-date="2008">2008</year><source>An Introduction to Generalized Linear Models</source><edition>Third Edition</edition><publisher-name>Chapman &amp; Hall/CRC Press</publisher-name></element-citation></ref><ref id="bib19"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Efron</surname> <given-names>B</given-names></name><name><surname>Tibshirani</surname> <given-names>RJ</given-names></name></person-group><year iso-8601-date="1993">1993</year><source>An Introduction to the Bootstrap</source><publisher-name>Chapman &amp; Hall/CRC Press</publisher-name></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fine</surname> <given-names>S</given-names></name><name><surname>Singer</surname> <given-names>Y</given-names></name><name><surname>Tishby</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>The hierarchical hidden markov model: analysis and applications</article-title><source>Machine Learning</source><volume>32</volume><fpage>41</fpage><lpage>62</lpage><pub-id pub-id-type="doi">10.1023/A:1007469218079</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gallagher</surname> <given-names>T</given-names></name><name><surname>Bjorness</surname> <given-names>T</given-names></name><name><surname>Greene</surname> <given-names>R</given-names></name><name><surname>You</surname> <given-names>YJ</given-names></name><name><surname>Avery</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The geometry of locomotive behavioral states in <italic>C. elegans</italic></article-title><source>PLOS ONE</source><volume>8</volume><elocation-id>e59865</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0059865</pub-id><pub-id pub-id-type="pmid">23555813</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gold</surname> <given-names>JI</given-names></name><name><surname>Shadlen</surname> <given-names>MN</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Representation of a perceptual decision in developing oculomotor commands</article-title><source>Nature</source><volume>404</volume><fpage>390</fpage><lpage>394</lpage><pub-id pub-id-type="doi">10.1038/35006062</pub-id><pub-id pub-id-type="pmid">10746726</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gomez-Marin</surname> <given-names>A</given-names></name><name><surname>Louis</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Multilevel control of run orientation in Drosophila larval chemotaxis</article-title><source>Frontiers in Behavioral Neuroscience</source><volume>8</volume><pub-id pub-id-type="doi">10.3389/fnbeh.2014.00038</pub-id><pub-id pub-id-type="pmid">24592220</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Graybiel</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Habits, rituals, and the evaluative brain</article-title><source>Annual Review of Neuroscience</source><volume>31</volume><fpage>359</fpage><lpage>387</lpage><pub-id pub-id-type="doi">10.1146/annurev.neuro.29.051605.112851</pub-id><pub-id pub-id-type="pmid">18558860</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Green</surname> <given-names>J</given-names></name><name><surname>Adachi</surname> <given-names>A</given-names></name><name><surname>Shah</surname> <given-names>KK</given-names></name><name><surname>Hirokawa</surname> <given-names>JD</given-names></name><name><surname>Magani</surname> <given-names>PS</given-names></name><name><surname>Maimon</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A neural circuit architecture for angular integration in Drosophila</article-title><source>Nature</source><volume>546</volume><fpage>101</fpage><lpage>106</lpage><pub-id pub-id-type="doi">10.1038/nature22343</pub-id><pub-id pub-id-type="pmid">28538731</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Green</surname> <given-names>DM</given-names></name><name><surname>Swets</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="1974">1974</year><source>Signal Detection Theory and Psychophysics</source><publisher-name>R. E. Krieger Pub. Co</publisher-name></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grillner</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="1979">1979</year><article-title>Interaction between central and peripheral mechanisms in the control of locomotion</article-title><source>Progress in Brain Research</source><volume>50</volume><fpage>227</fpage><lpage>235</lpage><pub-id pub-id-type="doi">10.1016/S0079-6123(08)60823-7</pub-id><pub-id pub-id-type="pmid">551429</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heinze</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Unraveling the neural basis of insect navigation</article-title><source>Current Opinion in Insect Science</source><volume>24</volume><fpage>58</fpage><lpage>67</lpage><pub-id pub-id-type="doi">10.1016/j.cois.2017.09.001</pub-id><pub-id pub-id-type="pmid">29208224</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Iino</surname> <given-names>Y</given-names></name><name><surname>Yoshida</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Parallel use of two behavioral mechanisms for chemotaxis in Caenorhabditis Elegans</article-title><source>Journal of Neuroscience</source><volume>29</volume><fpage>5370</fpage><lpage>5380</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.3633-08.2009</pub-id><pub-id pub-id-type="pmid">19403805</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="thesis"><person-group person-group-type="author"><name><surname>Isakov</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Collective dynamics in physical and social networks</article-title><publisher-name>Harvard University</publisher-name></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jordan</surname> <given-names>D</given-names></name><name><surname>Kuehn</surname> <given-names>S</given-names></name><name><surname>Katifori</surname> <given-names>E</given-names></name><name><surname>Leibler</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Behavioral diversity in microbes and low-dimensional phenotypic spaces</article-title><source>PNAS</source><volume>110</volume><fpage>14018</fpage><lpage>14023</lpage><pub-id pub-id-type="doi">10.1073/pnas.1308282110</pub-id><pub-id pub-id-type="pmid">23898201</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jung</surname> <given-names>SH</given-names></name><name><surname>Hueston</surname> <given-names>C</given-names></name><name><surname>Bhandawat</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Odor-identity dependent motor programs underlie behavioral responses to odors</article-title><source>eLife</source><volume>4</volume><elocation-id>e11092</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.11092</pub-id><pub-id pub-id-type="pmid">26439011</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kabra</surname> <given-names>M</given-names></name><name><surname>Robie</surname> <given-names>AA</given-names></name><name><surname>Rivera-Alba</surname> <given-names>M</given-names></name><name><surname>Branson</surname> <given-names>S</given-names></name><name><surname>Branson</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>JAABA: interactive machine learning for automatic annotation of animal behavior</article-title><source>Nature Methods</source><volume>10</volume><fpage>64</fpage><lpage>67</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2281</pub-id><pub-id pub-id-type="pmid">23202433</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kain</surname> <given-names>JS</given-names></name><name><surname>Zhang</surname> <given-names>S</given-names></name><name><surname>Akhund-Zade</surname> <given-names>J</given-names></name><name><surname>Samuel</surname> <given-names>AD</given-names></name><name><surname>Klein</surname> <given-names>M</given-names></name><name><surname>de Bivort</surname> <given-names>BL</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Variability in thermal and phototactic preferences in Drosophila may reflect an adaptive bet-hedging strategy</article-title><source>Evolution</source><volume>69</volume><fpage>3171</fpage><lpage>3185</lpage><pub-id pub-id-type="doi">10.1111/evo.12813</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kennedy</surname> <given-names>JS</given-names></name></person-group><year iso-8601-date="1983">1983</year><article-title>Zigzagging and casting as a programmed response to wind-borne odour: a review</article-title><source>Physiological Entomology</source><volume>8</volume><fpage>109</fpage><lpage>120</lpage><pub-id pub-id-type="doi">10.1111/j.1365-3032.1983.tb00340.x</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname> <given-names>IS</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Idiothetic path integration in the fruit fly Drosophila melanogaster</article-title><source>Current Biology</source><volume>27</volume><fpage>2227</fpage><lpage>2238</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2017.06.026</pub-id><pub-id pub-id-type="pmid">28736164</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laurutis</surname> <given-names>VP</given-names></name><name><surname>Robinson</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>The vestibulo-ocular reflex during human saccadic eye movements</article-title><source>The Journal of Physiology</source><volume>373</volume><fpage>209</fpage><lpage>233</lpage><pub-id pub-id-type="doi">10.1113/jphysiol.1986.sp016043</pub-id><pub-id pub-id-type="pmid">3489091</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marco</surname> <given-names>E</given-names></name><name><surname>Meuleman</surname> <given-names>W</given-names></name><name><surname>Huang</surname> <given-names>J</given-names></name><name><surname>Glass</surname> <given-names>K</given-names></name><name><surname>Pinello</surname> <given-names>L</given-names></name><name><surname>Wang</surname> <given-names>J</given-names></name><name><surname>Kellis</surname> <given-names>M</given-names></name><name><surname>Yuan</surname> <given-names>GC</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Multi-scale chromatin state annotation using a hierarchical hidden markov model</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>15011</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms15011</pub-id><pub-id pub-id-type="pmid">28387224</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mendes</surname> <given-names>CS</given-names></name><name><surname>Bartos</surname> <given-names>I</given-names></name><name><surname>Akay</surname> <given-names>T</given-names></name><name><surname>Márka</surname> <given-names>S</given-names></name><name><surname>Mann</surname> <given-names>RS</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Quantification of gait parameters in freely walking wild type and sensory deprived Drosophila melanogaster</article-title><source>eLife</source><volume>2</volume><elocation-id>e00231</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.00231</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="report"><person-group person-group-type="author"><name><surname>Michele Weiland</surname> <given-names>AS</given-names></name><name><surname>Nelson</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2005">2005</year><source>Learning Musical Pitch Structures with Hierarchical Hidden Markov Models Technical Report</source><publisher-name>University of Edinburgh</publisher-name></element-citation></ref><ref id="bib41"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Murphy</surname> <given-names>KP</given-names></name><name><surname>Paskin</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Linear time inference in hierarchical HMMs</article-title><conf-name>Proceedings of the 14th International Conference on Neural Information Processing Systems: Natural and Synthetic</conf-name><fpage>833</fpage><lpage>840</lpage></element-citation></ref><ref id="bib42"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Nguyen</surname> <given-names>NT</given-names></name><name><surname>Phung</surname> <given-names>DQ</given-names></name><name><surname>Venkatesh</surname> <given-names>S</given-names></name><name><surname>Bui</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Learning and detecting activities from movement trajectories using the hierarchical hidden Markov model</article-title><conf-name>2005 IEEE Computer Society Conference on Computer Vision and Pattern Recognition (CVPR'05)</conf-name><fpage>955</fpage><lpage>960</lpage><pub-id pub-id-type="doi">10.1109/CVPR.2005.203</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohashi</surname> <given-names>S</given-names></name><name><surname>Morimoto</surname> <given-names>T</given-names></name><name><surname>Suzuki</surname> <given-names>Y</given-names></name><name><surname>Miyakawa</surname> <given-names>H</given-names></name><name><surname>Aonishi</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A novel behavioral strategy, continuous biased running, during chemotaxis in Drosophila larvae</article-title><source>Neuroscience Letters</source><volume>570</volume><fpage>10</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1016/j.neulet.2014.04.011</pub-id><pub-id pub-id-type="pmid">24747684</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Pelleg</surname> <given-names>D</given-names></name><name><surname>Moore</surname> <given-names>AW</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>X-means: Extending K-means with efficient estimation of the number of clusters</article-title><conf-name>Proceedings of the Seventeenth International Conference on Machine Learning</conf-name><fpage>727</fpage><lpage>734</lpage></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pierce-Shimomura</surname> <given-names>JT</given-names></name><name><surname>Morse</surname> <given-names>TM</given-names></name><name><surname>Lockery</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>The fundamental role of pirouettes in Caenorhabditis Elegans chemotaxis</article-title><source>The Journal of Neuroscience</source><volume>19</volume><fpage>9557</fpage><lpage>9569</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.19-21-09557.1999</pub-id><pub-id pub-id-type="pmid">10531458</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Raftery</surname> <given-names>AE</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Bayesian model selection in social research</article-title><source>Sociological Methodology</source><volume>25</volume><fpage>111</fpage><lpage>163</lpage><pub-id pub-id-type="doi">10.2307/271063</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Riffell</surname> <given-names>JA</given-names></name><name><surname>Shlizerman</surname> <given-names>E</given-names></name><name><surname>Sanders</surname> <given-names>E</given-names></name><name><surname>Abrell</surname> <given-names>L</given-names></name><name><surname>Medina</surname> <given-names>B</given-names></name><name><surname>Hinterwirth</surname> <given-names>AJ</given-names></name><name><surname>Kutz</surname> <given-names>JN</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Flower discrimination by pollinators in a dynamic chemical environment</article-title><source>Science</source><volume>344</volume><fpage>1515</fpage><lpage>1518</lpage><pub-id pub-id-type="doi">10.1126/science.1251041</pub-id><pub-id pub-id-type="pmid">24970087</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saxena</surname> <given-names>N</given-names></name><name><surname>Natesan</surname> <given-names>D</given-names></name><name><surname>Sane</surname> <given-names>SP</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Odor source localization in complex visual environments by fruit flies</article-title><source>The Journal of Experimental Biology</source><volume>221</volume><elocation-id>jeb172023</elocation-id><pub-id pub-id-type="doi">10.1242/jeb.172023</pub-id><pub-id pub-id-type="pmid">29146771</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schulze</surname> <given-names>A</given-names></name><name><surname>Gomez-Marin</surname> <given-names>A</given-names></name><name><surname>Rajendran</surname> <given-names>VG</given-names></name><name><surname>Lott</surname> <given-names>G</given-names></name><name><surname>Musy</surname> <given-names>M</given-names></name><name><surname>Ahammad</surname> <given-names>P</given-names></name><name><surname>Deogade</surname> <given-names>A</given-names></name><name><surname>Sharpe</surname> <given-names>J</given-names></name><name><surname>Riedl</surname> <given-names>J</given-names></name><name><surname>Jarriault</surname> <given-names>D</given-names></name><name><surname>Trautman</surname> <given-names>ET</given-names></name><name><surname>Werner</surname> <given-names>C</given-names></name><name><surname>Venkadesan</surname> <given-names>M</given-names></name><name><surname>Druckmann</surname> <given-names>S</given-names></name><name><surname>Jayaraman</surname> <given-names>V</given-names></name><name><surname>Louis</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Dynamical feature extraction at the sensory periphery guides chemotaxis</article-title><source>eLife</source><volume>4</volume><elocation-id>e06694</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.06694</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Shan</surname> <given-names>H</given-names></name><name><surname>Mason</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Multiscale dictionary of rat locomotion</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1707.03360">https://arxiv.org/abs/1707.03360</ext-link></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephens</surname> <given-names>GJ</given-names></name><name><surname>Johnson-Kerner</surname> <given-names>B</given-names></name><name><surname>Bialek</surname> <given-names>W</given-names></name><name><surname>Ryu</surname> <given-names>WS</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>From modes to movement in the behavior of caenorhabditis elegans</article-title><source>PLOS ONE</source><volume>5</volume><elocation-id>e13914</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0013914</pub-id><pub-id pub-id-type="pmid">21103370</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Straub</surname> <given-names>R</given-names></name><name><surname>Heisenberg</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1990">1990</year><article-title>Coordination of legs during straight walking and turning in Drosophila melanogaster</article-title><source>Journal of Comparative Physiology A</source><volume>167</volume><fpage>403</fpage><lpage>412</lpage><pub-id pub-id-type="doi">10.1007/BF00192575</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tammero</surname> <given-names>LF</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Collision-avoidance and landing responses are mediated by separate pathways in the fruit fly, Drosophila melanogaster</article-title><source>The Journal of Experimental Biology</source><volume>205</volume><fpage>2785</fpage><lpage>2798</lpage><pub-id pub-id-type="pmid">12177144</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Tao</surname> <given-names>L</given-names></name><name><surname>Ozarkar</surname> <given-names>S</given-names></name><name><surname>Beck</surname> <given-names>J</given-names></name><name><surname>Bhandawat</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Code base for Statistical structure of locomotion and its modulation by odor</data-title><source>Github</source><version designator="7f5fea6">7f5fea6</version><ext-link ext-link-type="uri" xlink:href="https://github.com/bhandawat/HHMM">https://github.com/bhandawat/HHMM</ext-link></element-citation></ref><ref id="bib55"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Tinbergen</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="1996">1996</year><chapter-title>The hierarchical organization of nervous mechanisms underlying instinctive behaviour</chapter-title><source>Foundations of Animal Behavior: Classic Papers with Commentaries</source><publisher-loc>Chicago</publisher-loc><publisher-name>University of Chicago Press</publisher-name><fpage>406</fpage><lpage>413</lpage></element-citation></ref><ref id="bib56"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Tishby</surname> <given-names>N</given-names></name><name><surname>Pereria</surname> <given-names>FC</given-names></name><name><surname>Bialek</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>The information bottleneck method</article-title><conf-name>37th Annual Allerton Conference on Communication, Control and Computing</conf-name><fpage>368</fpage><lpage>377</lpage></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Turner-Evans</surname> <given-names>DB</given-names></name><name><surname>Jayaraman</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>The insect central complex</article-title><source>Current Biology</source><volume>26</volume><fpage>R453</fpage><lpage>R457</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2016.04.006</pub-id><pub-id pub-id-type="pmid">27269718</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Breugel</surname> <given-names>F</given-names></name><name><surname>Dickinson</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Plume-tracking behavior of flying Drosophila emerges from a set of distinct sensory-motor reflexes</article-title><source>Current Biology</source><volume>24</volume><fpage>274</fpage><lpage>286</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2013.12.023</pub-id><pub-id pub-id-type="pmid">24440395</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vickers</surname> <given-names>NJ</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Mechanisms of animal navigation in odor plumes</article-title><source>The Biological Bulletin</source><volume>198</volume><fpage>203</fpage><lpage>212</lpage><pub-id pub-id-type="doi">10.2307/1542524</pub-id><pub-id pub-id-type="pmid">10786941</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Park</surname> <given-names>Y</given-names></name><name><surname>Ohyama</surname> <given-names>T</given-names></name><name><surname>Kerr</surname> <given-names>RA</given-names></name><name><surname>Truman</surname> <given-names>JW</given-names></name><name><surname>Priebe</surname> <given-names>CE</given-names></name><name><surname>Zlatic</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Discovery of brainwide neural-behavioral maps via multiscale unsupervised structure learning</article-title><source>Science</source><volume>344</volume><fpage>386</fpage><lpage>392</lpage><pub-id pub-id-type="doi">10.1126/science.1250298</pub-id><pub-id pub-id-type="pmid">24674869</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Willis</surname> <given-names>MA</given-names></name><name><surname>Arbas</surname> <given-names>EA</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Variability in odor-modulated flight by moths</article-title><source>Journal of Comparative Physiology A: Sensory, Neural, and Behavioral Physiology</source><volume>182</volume><fpage>191</fpage><lpage>202</lpage><pub-id pub-id-type="doi">10.1007/s003590050170</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wiltschko</surname> <given-names>AB</given-names></name><name><surname>Johnson</surname> <given-names>MJ</given-names></name><name><surname>Iurilli</surname> <given-names>G</given-names></name><name><surname>Peterson</surname> <given-names>RE</given-names></name><name><surname>Katon</surname> <given-names>JM</given-names></name><name><surname>Pashkovski</surname> <given-names>SL</given-names></name><name><surname>Abraira</surname> <given-names>VE</given-names></name><name><surname>Adams</surname> <given-names>RP</given-names></name><name><surname>Datta</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Mapping Sub-Second structure in mouse behavior</article-title><source>Neuron</source><volume>88</volume><fpage>1121</fpage><lpage>1135</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.11.031</pub-id><pub-id pub-id-type="pmid">26687221</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Wonjoon</surname> <given-names>K</given-names></name><name><surname>Dongkyoo</surname> <given-names>S</given-names></name><name><surname>Dongil</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Detecting and predicting of abnormal behavior using hierarchical Markov model in smart home network</article-title><conf-name>IEEE 17th International Conference on Industrial Engineering and Engineering Management</conf-name><fpage>410</fpage><lpage>414</lpage></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yorozu</surname> <given-names>S</given-names></name><name><surname>Wong</surname> <given-names>A</given-names></name><name><surname>Fischer</surname> <given-names>BJ</given-names></name><name><surname>Dankert</surname> <given-names>H</given-names></name><name><surname>Kernan</surname> <given-names>MJ</given-names></name><name><surname>Kamikouchi</surname> <given-names>A</given-names></name><name><surname>Ito</surname> <given-names>K</given-names></name><name><surname>Anderson</surname> <given-names>DJ</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Distinct sensory representations of wind and near-field sound in the Drosophila brain</article-title><source>Nature</source><volume>458</volume><fpage>201</fpage><lpage>205</lpage><pub-id pub-id-type="doi">10.1038/nature07843</pub-id><pub-id pub-id-type="pmid">19279637</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.41235.030</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Calabrese</surname><given-names>Ronald L</given-names></name><role>Reviewing Editor</role><aff><institution>Emory University</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Statistical structure of locomotion and its modulation by odors&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by three peer reviewers, including Ronald L Calabrese as the Reviewing Editor and Reviewer #1, and the evaluation has been overseen by K VijayRaghavan as the Senior Editor.</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>In this manuscript, the authors present a creative analysis of fly walking in response to an attractive odor (apple cider vinegar, ACV) in circular arena in the dark and where odor can be strictly limited to a central zone. They monitor fly movement as velocity (parallel and perpendicular to prior movement) prior to and after odor is introduced to the arena center. They then analyze the data with a Hidden Markov Model (HMM) and a Hidden Hierarchal Markov Model (HHMM) and show decisively that the HHMM fits the data better and that the high level sates (HL) describe stereotypical locomotor components and that transitions between them vary in probability such that states with similar velocities have higher transition probability. They then show that introduction of odor affects the probability that a given HL state is occupied and varies inside and outside the odor zone with final spatial structure. A surprising finding is that the average probability distributions of the HL states cannot be used to determine the presence of the odor. Subdividing the flies according to their individual pre and during odor probability distributions and clustering reveal 3-4 categories of responses and there are different cluster of the 34 flies tested for each of the four conditions (pre inside odor zone, pre outside odor zone, during inside odor zone, during outside odor zone). The most interesting conclusions of the paper are: 1) the observation that the HHMM model fits better than the HMM model, implies that there is structure at multiple time scales in the data 2) under the specific conditions imposed that although all flies in dataset use the same set of locomotor features, individual flies vary considerably in how often they employ a given locomotor feature (HL state), and how this usage is modulated by odor. The paper should arouse general interest in the behavioral neuroscience community.</p><p>Essential revisions:</p><p>1) There are concerns about how well the data constrains particular HHMM put forward that can be allayed by putting confidence intervals on the probability distributions of Figure 5 and Figure 6.</p><p>2) Several of the reviewer concerns focus on dwell times in each HL state. These dwell time should be analyzed and distributions presented and interpreted.</p><p>3) The observation that the HHMM model fits better than the HMM model, implies that there is structure at multiple time scales in the data. For example, HL states may be prolonged because the systems transitions among nearby LL states within the HL state; is this supported by the dwell time of LL states within a prolonged HL state? The authors also note in the Discussion that there is structure on longer time scales. Can they think of some analysis that would pull this out?</p><p>4) The findings about individuality and the fact that the presence of odor can be predicted from a model that takes individuality into account but not from a model that does not are interesting. Here however, some additional analyses or data would help support the claim. For example, can the authors compare the distribution of states early versus late in the trial and show that each individual still occupies a characteristic set of states? How do HL state dwell times vary among individual or early vs. late in a trial? Would more flies analyzed and/or for longer period of time help resolve the individuality issues?</p><p>5) The detailed reviewer comments are appended and that should be addressed in light of the consensus concerns above.</p><p><italic>Reviewer #1:</italic> </p><p>Concerns</p><p>1) Subsection “A small number of strategies can explain the variability in flies’ response to odor” third paragraph: be explicitly clear as to how many clusters were found for each case illustrated in Figure 9. In Figure 9A, I assume there were at least 5 clusters but that cluster 4 had less than 4 flies; were there other clusters? Be very clear as to the number of clusters for Figure 9A and 9B.</p><p>2) Results section: you state in results that flies &quot;…spend 60% of time performing a locomotor feature for &gt;300 milliseconds, and &gt;10% of their time performing a single locomotor feature for &gt;3s (Figure 2—figure supplement 1)”. The first statement appears compatible with the cumulative distribution in the figure, but I don't see the second at all. Am I missing something or is the maximum duration illustrated 1.5 s and less that 5% of states are of this duration or longer? Please plot in a supplemental figure the real distribution of time duration of states in the data. These data are essential if you are to make claims like &quot;These locomotor characteristics can persist over 3 seconds – a time period during which a fly takes 30 steps on average (given a step frequency of 10 Hz). This tight control over 𝑣̂|| over tens of steps strongly suggests that locomotion unfolds, not on a step-by-step basis, but in blocks of tens of steps.&quot; Or like &quot;A fly moves at a relatively constant 𝑣̂|| and 𝑣̂⫠ for tens of step.&quot; It seems for example, that for states that last 300 ms that only 3 steps are possible and there are many states that last shorter periods. Are moving states distributed in duration longer/shorter that stopping states?</p><p>3) Subsection “Odors affect behavior on a fine spatial scale.”, paragraph two: Here you are creating a sequence of behavior based on averages and YET you claim that average data does not describe a fly's behavior but there are distinct strategies. Please clarify.</p><p><italic>Reviewer #2:</italic> </p><p>1) The model assumes that behavior is best modeled as set of discrete states (with the implication, I think, that this is how they are controlled neurally). The alternative possibility, alluded to briefly in subsection “Flies show considerable variability in locomotion despite employing the same locomotor features.”, is that some parts of the behavior could be better represented (or controlled) as continua. Since velocity is a continuous 1D variable, and since the fly must pass through intermediate velocities to transition from low to high velocity and vice-versa, I think this alternative should be considered. I am not suggesting the authors entirely revamp their model but I think this point could be discussed or considered a bit more prominently.</p><p>2) In the analysis of spatial structure (Figure 6), the role of time history should be considered/discussed. For example, behavior near the odor border might be different because the fly is more likely to have experienced no odor shortly before odor (or vice versa) than in the center of the arena. The responses of olfactory neurons are well known to show responses that depend on history over multiple time scales, so this point should be considered/discussed. Whether behavior could also be influenced by airflow at different parts of the chamber should be noted (without assuming the reader knows the details of the earlier paper). For example, could the airflow from the vacuum be causing the flies to slow down inside the odorized area, as in Yorozu et al., 2009?</p><p>3) The findings about individuality are quite interesting. As mentioned above, the analysis in which the presence of odor can be predicted based on individual flies or clusters of flies, but not the whole dataset is quite interesting. However, as the authors note in the response to Reviewer 3, individuality in responses has also been investigated elsewhere. A typical analysis in these studies (de Bivort, Branson) is to compare behavior of the same individual at different time points and to show that they are more similar to themselves than to each other. The authors might consider splitting their data in time and repeating the analysis, although the time interval of the data here is relatively short (6 min). In addition, it would be nice to know if they could correlate their clusters with anything else about the flies. In the response to reviewers the authors allude to different behaviors produced by different genotypes. I think it would add to the interest of the study if these data were included.</p><p>4) The comparison of HMM and HHMM models is nicely rigorous but seems highly technical for this journal. The authors should consider focusing the text on the conceptual conclusions that can be drawn from this comparison.</p><p><italic>Reviewer #3:</italic> </p><p>Before publication some work is needed to address questions about: 1) how to interpret HL behaviors (survival time statistics of HL states and relationship to the structure of a 10HL-5LL model); 2) error bars.</p><p>Main comments:</p><p>Error bars.</p><p>I could not get a clear sense of how well the data is constraining the HHMM model. For example in Figure 5, what is the uncertainty of these distributions? Can the authors bootstrap the data? Likewise in Figure 6 how many data points go in each colored dot? What is the uncertainty of the probability plots as a function of radial distance? There are no error bars on these plots.</p><p>Time spent in HLs.</p><p>One of the reasons HHMM seems to work better than HMM is that behaviors have extended durations and since the trajectory can jump around the LL states within a single HL state, that HL state can last long. Even though this is a key aspect of the model, there is no analysis or plot of the waiting time distribution in each HL state that would give an idea of the &quot;duration&quot; of such states during behavior and how that duration depends on the number of HL and LL states used in the HHMM model. The only thing I could find was Figure 2—figure supplement 1 (but this includes all states) and the statement made: &quot;A fly moves at a relatively constant 𝑣̂|| and 𝑣̂⫠ for tens of step. This tendency means that a fly's locomotion can be decomposed into a small number of locomotor features – 10 features in the case of the model we present.&quot;. However, this main conclusion is provided without plots about it. Supporting this point with quantitative data analysis is important because the authors use it to interpret various aspect of the results. It is also important to know if some HLs state last much longer than other in order to interpret the data. This may also clarify why 10HLs each with 5LLs are used in the HHMM. See below.</p><p>Subsection &quot; HHMM reveals that a fly’s locomotion is surprisingly structured in the velocity space…&quot;.</p><p>An interesting outcome underlined by the authors (last paragraph) is that the resulting HHMM accounts for 80% of all the data (within 85% confidence interval) using 10 locomotor features (10 HLs). Some of the HL states correspond to clearly distinct behavior, such as 1=meander, 2=stop-to-walk or 9=fast right turn, 10=fast left turn. However, other HLs seem to be part of a continuum, such as 4,5,7= medium speed walking, and it is not entirely clear why 3 distinct HLs are needed to describe medium speed walking. Some HLs seem to fit less well the data, e.g. HL 6. I could not find a clear explanation of why 10HLs each with 5LLs were chosen and whether fewer HLs would have worked as well. What would happen if the HHMM had less HL nodes but more LL nodes in each HL? A discussion of survival times in each HLs might help sort this out and provide a way to interpret states 4,5,7. Are these different behaviors or one behavior distributed over 3 HL?</p><p>Subsection “Locomotor features and implications for neural control of behavior”.</p><p>In the discussion the authors say that v_parallel lies within a narrow range that is distinct for each three state and that 3 states reflect a tight control on locomotion by the brain. They mention these locomotor state can persist up to 3 second/30 steps and suggest that this indicates that the brain controls locomotion in blocks of 10 steps. I find this conclusion drawn from the finding of these 3 clusters too speculative given the data: In Figure 3—figure supplement 1 and Figure 4 the distributions of v_par overlap significantly between HL 4,5 and 7. This is again related to the two points above. Finally, if HL 4 5 7 are really distinct behaviors then another possibility could be that they are needed to account for fly-to-fly variability in the data, and that for a single fly only one state is sufficient to describe medium speed walk.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Statistical structure of locomotion and its modulation by odors&quot; for further consideration at <italic>eLife</italic>. Your revised article has been favorably evaluated by K VijayRaghavan (Senior Editor), a Reviewing Editor, and two reviewers.</p><p>The manuscript has been improved but there are some remaining issues that need to be addressed before acceptance, as outlined below:</p><p>Significant additional revisions are still required. The comments of the expert reviewers, below, are detailed and require full responses.</p><p><italic>Reviewer #2:</italic> </p><p>This manuscript compares HMM and HHMM approaches to clustering behavioral data from flies in an olfactory paradigm. Based on a rigorous comparison of models, the authors conclude that the HHMM model performs better than the HMM model, implying the presence of hierarchical long-time scale structure in the data. They further analyze the behavior of individual flies and show that responses to odor cannot be understood in terms of variation around an &quot;average fly&quot; but rather are better understood as belonging to 3-4 response types. Response types of individuals are stable over the duration of the experiment. Overall the methods introduced for analyzing complex behavioral data appear to be sound and are likely to be of broad interest to scientists studying natural behavior and its neural correlates.</p><p>Two points need to be addressed before acceptance:</p><p>1) How do the priors used in fitting constrain the structure of the transition matrices found for the models? In the Results section, the authors state that &quot;the assumption of Markov dynamics with a sparse prior on state transitions penalizes the consideration of unlikely state transitions base upon recent history and future destinations.&quot; This suggests that a sparse prior was applied in fitting. However, later in the paper the authors state: &quot;The transition probability matrix for the HMM was sparse, suggesting that from each state there are transitions to only a handful of other states.&quot; If a sparse prior was applied during fitting than the fact that the resulting transition matrix is sparse is not really a finding about the data.</p><p>Similarly, the authors need to clarify what fitting priors or constraints were placed in the HHMM model. The Results state &quot;This is because any HHMM- which puts very specific constraints on the transitions probability matrix- can be represented by an HMM but not vice-versa.&quot; What are the constraints on the transition probability matrix for the HHMM? The text says &quot;The transition probability matrix is sparse- a vast majority of transitions from each HL state were to 2-3 other HL states.&quot; Was this imposed by fitting priors?</p><p>2) Parts of the manuscript are somewhat long and repetitive. I think the manuscript could be productively shortened to have greater impact on its readers.</p><p>For example, in the section titled &quot;HHMM reveals that a fly's locomotion is surprisingly structured in the velocity space&quot; the last paragraph is devoted to restating the major conclusion of the first section: HHMM performs better than HMM. I think this could be reduced or folded into section one, which focusses on this comparison, and the section focused more exclusively on describing the HL states uncovered by the model.</p><p>In the Discussion subsection “Flies show considerable variability in locomotion despite employing the same locomotor features” paragraphs two and three are highly descriptive of the individual fly data and somewhat repetitive with parts of the Results subsection “Both locomotion and an odor’s effect on locomotion is fly dependent” (already rather long). I think these sections could be condensed to make the major points about individual variability in the Results, and use the Discussion mostly to compare these findings with the results of other studies.</p><p><italic>Reviewer #3:</italic> </p><p>The authors have addressed most of my concerns expect the important one regarding the confidence interval on the distributions in Figure 5. What I am asking is for the authors to use bootstrapping to extract many sample distributions from subsets of the data in order to get a confidence interval on how these bins are populated by the data and how significant the changes are between before and during odor exposure.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.41235.031</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) There are concerns about how well the data constrains particular HHMM put forward that can be allayed by putting confidence intervals on the probability distributions of Figure 5 and Figure 6.</p></disp-quote><p>There are two sources of variability. The first corresponds to how well the data constrains the model. This source of variability can be quantified as follows: The standard deviation (SD) of the probability of HL states (P) in each scenario can be calculated as follows:</p><p>SDj=Pj1-PjN-1</p><p>∀j∈1,2,3,…10HLstate</p><p>Where N is the total number of data points in each scenario. This standard deviation is extremely small and is shown in Figure 5.</p><p>The second source of variability is how different is the behavior of different flies in a given scenario. Getting to the bottom of this variability is the main question that drives the manuscript from Figure 7-9.</p><disp-quote content-type="editor-comment"><p>2) Several of the reviewer concerns focus on dwell times in each HL state. These dwell time should be analyzed and distributions presented and interpreted.</p></disp-quote><p>We have analyzed the dwell times of each HL state (Figure 2—figure supplement 2). Specifically, we plot the cumulative distributions of the HL states. We also plot the percentage of time a fly spends in a state of a given duration. These plots show the differences in dwell time in different HL state.</p><disp-quote content-type="editor-comment"><p>3) The observation that the HHMM model fits better than the HMM model, implies that there is structure at multiple time scales in the data. For example, HL states may be prolonged because the systems transitions among nearby LL states within the HL state; is this supported by the dwell time of LL states within a prolonged HL state? The authors also note in the Discussion that there is structure on longer time scales. Can they think of some analysis that would pull this out?</p></disp-quote><p>The plot on dwell time – Figure 2—figure supplement 2 – also plots the average dwell time of the low-level states and the number of LL state transitions/transition into HL state as a function of the duration of the HL state. These data support the idea stated above: The number of transitions increase when the duration of HL states become longer. Thus, this analysis works exactly as the reviewers envision above, and as one would expect if the data has structure on multiple time scales.</p><p>With regards to pulling out structure on an even longer time scale: we don’t think that there is any simple analysis that would work. We think that pulling out longer timescale likely requires a different model with more hierarchical layers, and likely a different set of observables.</p><disp-quote content-type="editor-comment"><p>4) The findings about individuality and the fact that the presence of odor can be predicted from a model that takes individuality into account but not from a model that does not are interesting. Here however, some additional analyses or data would help support the claim. For example, can the authors compare the distribution of states early versus late in the trial and show that each individual still occupies a characteristic set of states? How do HL state dwell times vary among individual or early vs. late in a trial? Would more flies analyzed and/or for longer period of time help resolve the individuality issues?</p></disp-quote><p>We performed the analysis suggested here (Figure 7—figure supplement 4). We find that even if you take a 1-second chunk of data, it assigns flies to the correct cluster at a level greater than chance. A 30-second chunk of data classifies &gt;80% of the flies accurately. The correctly assigned fraction is about the same whether we use the first 30 seconds of data or the last 30 seconds of data.</p><p>It is important to note that what we are claiming is that these 34 six-minute trajectories do not belong to the same cluster. To establish individuality, one needs trajectories from the same fly over multiple days. It is also important to control the environmental conditions within a very tight bound. We were anal about the environment conditions. But, because the experiments were not specifically designed to get at the question of individuality, therefore the bounds on many conditions – age of the fly (3-5 days old), culture conditions (50-200 eggs) should be controlled even more tightly. Moreover, we did not control humidity at the time of the experiment. In essence, collecting longitudinal data under even more controlled conditions from a large population of flies is necessary to settle questions regarding individuality, and is well beyond the scope of this study.</p><disp-quote content-type="editor-comment"><p>5) The detailed reviewer comments are appended and that should be addressed in light of the consensus concerns above.</p></disp-quote><p>We agree with most of the reviewer critiques and have addressed them in the manuscript.</p><p>Reviewer #1:</p><disp-quote content-type="editor-comment"><p>Concerns</p><p>1) Subsection “A small number of strategies can explain the variability in flies’ response to odor” third paragraph: be explicitly clear as to how many clusters were found for each case illustrated in Figure 9. In Figure 9A, I assume there were at least 5 clusters but that cluster 4 had less than 4 flies; were there other clusters? Be very clear as to the number of clusters for Figure 9A and 9B.</p></disp-quote><p>Thank you. We have specified the number of clusters in the figure in subsection “A small number of strategies can explain the variability in flies’ response to odor”.</p><disp-quote content-type="editor-comment"><p>2) Results section: you state in results that flies &quot;…spend 60% of time performing a locomotor feature for &gt;300 milliseconds, and &gt;10% of their time performing a single locomotor feature for &gt;3s (Figure 2—figure supplement 1)”. The first statement appears compatible with the cumulative distribution in the figure, but I don't see the second at all. Am I missing something or is the maximum duration illustrated 1.5 s and less that 5% of states are of this duration or longer? Please plot in a supplemental figure the real distribution of time duration of states in the data. These data are essential if you are to make claims like &quot;These locomotor characteristics can persist over 3 seconds – a time period during which a fly takes 30 steps on average (given a step frequency of 10 Hz). This tight control over 𝑣̂|| over tens of steps strongly suggests that locomotion unfolds, not on a step-by-step basis, but in blocks of tens of steps.&quot; Or like &quot;A fly moves at a relatively constant 𝑣̂|| and 𝑣̂⫠ for tens of step.&quot; It seems for example, that for states that last 300 ms that only 3 steps are possible and there are many states that last shorter periods. Are moving states distributed in duration longer/shorter that stopping states?</p></disp-quote><p>The referee raises three important points here: 1) one concerning statements that we made regarding state duration, 2) general issues related to state duration, 3) conclusions we draw based on the state durations.</p><p>With regards to the specific statements that &gt;10% of the time is spent performing locomotor features &gt;3 s: Figure 2—figure supplement 1 plots the fraction of transitions above a certain duration. To estimate how much time a fly spends in a state that is &gt;a certain duration (t), we have to multiply N(t)*t, where N is the number of transitions of exactly duration t, and calculate P(&gt;t) from the resulting quantity. We have now shown this calculation in Figure 2—figure supplement 2B. The number 10% comes from the mean curve (black line). When we examined the same distribution by state, we found (as implied by the reviewer above) that the stop state (State 2) dominates the long duration states. Interestingly, the fast states – states 9 and 10 and state 1 (meander) also has many long duration transitions. The medium speed states – states 4-7 rarely have long duration transitions. Therefore, the conclusion that “A fly moves at a relatively constant 𝑣̂|| and 𝑣̂⫠ for tens of step” is weaker than we originally thought. The general idea that flies can reside within the same state for many steps is true, and we have clarified the discussion in subsection “Odors affect behavior on a fine spatial scale” to reflect the same.</p><p>With regards to the general issue related to state durations – we present a new analysis which quantifies – 1) duration of HL states, 2) duration of low-level states, 3) No. of low-level state transition/transition into HL states. These analyses are detailed in Figure 2—figure supplement 2.</p><p>Finally we have clarified the conclusions we draw from state durations. We state clearly that the states of the HHMM are not necessarily the states employed by the system. In fact, as pointed out by another reviewer, there is no guarantee that there are discrete states at all. We completely agree with that sentiment and described explicitly in the discussion subsection “Limitations of the model”.</p><disp-quote content-type="editor-comment"><p>3) Subsection “Odors affect behavior on a fine spatial scale.”, paragraph two: Here you are creating a sequence of behavior based on averages and YET you claim that average data does not describe a fly's behavior but there are distinct strategies. Please clarify.</p></disp-quote><p>This is an excellent point. We have deleted the entire discussion.</p><p>Reviewer #2:</p><disp-quote content-type="editor-comment"><p>1) The model assumes that behavior is best modeled as set of discrete states (with the implication, I think, that this is how they are controlled neurally). The alternative possibility, alluded to briefly in subsection “Flies show considerable variability in locomotion despite employing the same locomotor features.”, is that some parts of the behavior could be better represented (or controlled) as continua. Since velocity is a continuous 1D variable, and since the fly must pass through intermediate velocities to transition from low to high velocity and vice-versa, I think this alternative should be considered. I am not suggesting the authors entirely revamp their model but I think this point could be discussed or considered a bit more prominently.</p></disp-quote><p>The most parsimonious way to think about the discrete vs. continuous is to think about the time-series of velocity and curvature as outputs of a dynamical system. In this framework, the HL states would represent the system being in a vicinity of a fixed point for the vast majority of time. We have included this idea in the discussion in subsection “Extracting observables from the trajectory”.</p><disp-quote content-type="editor-comment"><p>2) In the analysis of spatial structure (Figure 6), the role of time history should be considered/discussed. For example, behavior near the odor border might be different because the fly is more likely to have experienced no odor shortly before odor (or vice versa) than in the center of the arena. The responses of olfactory neurons are well known to show responses that depend on history over multiple time scales, so this point should be considered/discussed. Whether behavior could also be influenced by airflow at different parts of the chamber should be noted (without assuming the reader knows the details of the earlier paper). For example, could the airflow from the vacuum be causing the flies to slow down inside the odorized area, as in Yorozu et al., 2009?</p></disp-quote><p>The reviewer raises two issues here:</p><p>The first issue is that the behavior is not just spatially structured, but spatio-temporally structured. We agree with the reviewer. The spatial structure we present in Figure 6 is actually spatio-temporal structure. We have discussed this issue and added a figure (Figure 6—figure supplement 1) which shows that the behavior evolves as a function of time. However, this evolution is complete within the first 10 seconds or so. Unfortunately, because of 1) individuality among flies, 2) because we did not quantify the concentration of odor as a function of time (after the first minute), we cannot make a definitive analysis of the nature of the spatio-temporal structure in the data. The main point we are making in Figure 6 is that the HL states provide an important analytical tool for analyzing this structure.</p><p>The second issue relates to the airflow. We are quite confident that behavior in the arena is minimally impacted by airflow because the airflow we use is much smaller than almost any other study on fly olfaction, and is well-below the reported thresholds for anemotactic responses. More importantly, in the original study (Jung et al., 2015), we had performed controls in which we compared the effect of turning on the air, then the air and vacuum on the fly’s locomotion. We found that there was no observed effect of either the air or the air/vacuum. This issue is discussed in subsection “HHMM modeling”.</p><disp-quote content-type="editor-comment"><p>3) The findings about individuality are quite interesting. As mentioned above, the analysis in which the presence of odor can be predicted based on individual flies or clusters of flies, but not the whole dataset is quite interesting. However, as the authors note in the response to Reviewer 3, individuality in responses has also been investigated elsewhere. A typical analysis in these studies (de Bivort, Branson) is to compare behavior of the same individual at different time points and to show that they are more similar to themselves than to each other. The authors might consider splitting their data in time and repeating the analysis, although the time interval of the data here is relatively short (6 min). In addition, it would be nice to know if they could correlate their clusters with anything else about the flies. In the response to reviewers the authors allude to different behaviors produced by different genotypes. I think it would add to the interest of the study if these data were included.</p></disp-quote><p>There are two important points here. First, given our limited dataset, can we still assess whether the clusters are stable? This analysis is presented in Figure 7—figure supplement 4. The stability of the cluster depends on – 1) How different are the clusters from each other? If the clusters are very different, then only a small temporal sample is enough to assign flies to clusters. To assess how different the clusters are from each other, we assembled tracks of a given length from each fly by sampling data points at random. We found that there is a high probability that tracks &gt;10 second in length were assigned to the original cluster. This analysis implies that the cluster means are sufficiently different that small chunks are representative.</p><p>2) How long of a time-sample does one need to describe the average behavior? We analyzed whether chunks of contiguous data points of a given length are representative of the original cluster. We performed two analyses: a) we asked whether chunks of a given length belong to the original cluster. We found that we could assign the flies to their original cluster at greater than chance level. b) We chose chunks either at the beginning or at the end of the track. Once again, we find that small chunks are predicted to be in their respective cluster at levels much greater than chance.</p><p>Second, we examined whether the clusters correlated with 1) time of recording, 2) starvation time, 3) age of the fly. We found no trends.</p><disp-quote content-type="editor-comment"><p>4) The comparison of HMM and HHMM models is nicely rigorous but seems highly technical for this journal. The authors should consider focusing the text on the conceptual conclusions that can be drawn from this comparison.</p></disp-quote><p>We agree with the reviewer. But, based on the previous set of reviews, we would like to keep that description. A large section of the audience has grave misunderstandings about HHMM vs. HMM. It is best to clarify these misconceptions at the outset.</p><p>Reviewer #3:</p><disp-quote content-type="editor-comment"><p>Before publication some work is needed to address questions about: 1) how to interpret HL behaviors (survival time statistics of HL states and relationship to the structure of a 10HL-5LL model); 2) error bars.</p><p>Main comments:</p><p>Error bars.</p><p>I could not get a clear sense of how well the data is constraining the HHMM model. For example in Figure 5, what is the uncertainty of these distributions? Can the authors bootstrap the data? Likewise in Figure 6 how many data points go in each colored dot? What is the uncertainty of the probability plots as a function of radial distance? There are no error bars on these plots.</p></disp-quote><p>There are two sources of variability. The first corresponds to how well a model constrains the data. This source of variability can be quantified as follows: The standard deviation (SD) of the probability of HL states (P) in each scenario were calculated as follows:</p><p>SDj=Pj1-PjN-1</p><p>∀∀j∈1,2,3,…10HLstate</p><p>Where N is the total number of data points in each scenario. This standard deviation is extremely small and is shown in Figure 5.</p><p>The second source of variability is how different is the behavior of different flies in a given scenario. Getting to the bottom of this variability is one of the questions which drives the manuscript after Figure 6.</p><disp-quote content-type="editor-comment"><p>Time spent in HLs.</p><p>One of the reasons HHMM seems to work better than HMM is that behaviors have extended durations and since the trajectory can jump around the LL states within a single HL state, that HL state can last long. Even though this is a key aspect of the model, there is no analysis or plot of the waiting time distribution in each HL state that would give an idea of the &quot;duration&quot; of such states during behavior and how that duration depends on the number of HL and LL states used in the HHMM model. The only thing I could find was Figure 2—figure supplement 1 (but this includes all states) and the statement made: &quot;A fly moves at a relatively constant 𝑣̂|| and 𝑣̂⫠ for tens of step. This tendency means that a fly's locomotion can be decomposed into a small number of locomotor features – 10 features in the case of the model we present.&quot;. However, this main conclusion is provided without plots about it. Supporting this point with quantitative data analysis is important because the authors use it to interpret various aspect of the results. It is also important to know if some HLs state last much longer than other in order to interpret the data. This may also clarify why 10HLs each with 5LLs are used in the HHMM. See below.</p></disp-quote><p>This is an important point. We have now analyzed the duration distributions for both the HL and LL states (Figure 2—figure supplement 2). A short description of our findings is presented in the essential revisions and repeated below. We have analyzed the dwell times of each HL state (Figure 2—figure supplement 2). Specifically, we plot the cumulative distributions of the HL states. We also plot the percentage of time a fly spends in a state of a given duration. These plots show the differences in dwell time in different HL state.</p><p>The plot on dwell time – Figure 2—figure supplement 2 – also plots the average dwell time of the low-level states and the number of LL state transitions/transition into HL state as a function of the duration of the HL state. These data support the idea stated above: The number of transitions increase when the duration of HL states become longer. Thus, this analysis works exactly as the reviewers envision above, and as one would expect if the data has structure on multiple time scales.</p><disp-quote content-type="editor-comment"><p>Subsection &quot; HHMM reveals that a fly’s locomotion is surprisingly structured in the velocity space&quot;.</p><p>An interesting outcome underlined by the authors (last paragraph) is that the resulting HHMM accounts for 80% of all the data (within 85% confidence interval) using 10 locomotor features (10 HLs). Some of the HL states correspond to clearly distinct behavior, such as 1=meander, 2=stop-to-walk or 9=fast right turn, 10=fast left turn. However, other HLs seem to be part of a continuum, such as 4,5,7= medium speed walking, and it is not entirely clear why 3 distinct HLs are needed to describe medium speed walking. Some HLs seem to fit less well the data, e.g. HL 6. I could not find a clear explanation of why 10HLs each with 5LLs were chosen and whether fewer HLs would have worked as well. What would happen if the HHMM had less HL nodes but more LL nodes in each HL? A discussion of survival times in each HLs might help sort this out and provide a way to interpret states 4,5,7. Are these different behaviors or one behavior distributed over 3 HL?</p></disp-quote><p>The explanation of why we chose the model was in subsection “Model selection” of the Materials and methods. We have expanded this section to address the reviewer’s comments. To address the reviewer’s specific questions: The main reason for the choice of 10 HL and 5 LL states was <italic>repeatability</italic>.</p><p>We tried different combination of HL and LL states from 6-16 for HL states and 4-6 for LL states. There were some models with as few as 6 HL states that worked well. Models with 16 HL states rarely used more than 12 HL states. So, models with 6-12 HL states could work. However, multiple runs with 6 or 8 states gave widely different results, therefore we decided to use 10 states. With respect to the LL states, 4-6 states yielded similar results. If more than 6 LL states were chosen, many LL states remained unused.</p><p>We think that the range 6-12 is a fairly narrow range. One important point is that within this narrow range of states, the state duration in all the models we tried were very similar. The insensitivity of state duration made us confident that the structure we discovered is real.</p><p>A detailed analysis of the duration of the HL state seems consistent with the reviewer’s intuition that it would make more sense to combine those states 4-7 into a single state because these states have a shorter duration. Does reducing the number of HL state combine the three medium speed HL states into one state? The answer is largely a no (see <xref ref-type="fig" rid="respfig1">Author response image 1</xref>). Although, the number of middle speed state (labeled in bold) decreases, even models with 8 HL state devote three separate states to medium speed locomotion. More importantly, the number of middle speed states stabilize to 4 states as the number of HL states is increased to 12.</p><p>One important limitation of our modelling approach (which we only realized in hindsight) is that it is difficult to compare across models because everything changes slightly– LL states change, HL states change. We are currently revising the model to keep the LL states fixed so that the modeling approach would mostly focus on how the HL select the LL states. This process will make it much easier to compare across models. Unfortunately, this change is non-trivial and beyond the scope of this manuscript.</p><fig id="respfig1"><object-id pub-id-type="doi">10.7554/eLife.41235.028</object-id><label>Author response image 1.</label><caption><title>The probability distribution of HL states from 3 models with different number of states – 10 state (top), model described in the manuscript), 12 states (middle), and 8 states (bottom).</title><p>The number of middle speed states is the same between the 10-state model and the 12-state model, and decreases by 1 in the 8-state model.</p></caption><graphic mime-subtype="jpeg" mimetype="image" xlink:href="elife-41235-resp-fig1-v2"/></fig><disp-quote content-type="editor-comment"><p>Subsection “Locomotor features and implications for neural control of behavior”.</p></disp-quote><p><italic>In the discussion the authors say that v_parallel lies within a narrow range that is distinct for each three state and that 3 states reflect a tight control on locomotion by the brain. They mention these locomotor state can persist up to 3 second/30 steps and suggest that this indicates that the brain controls locomotion in blocks of 10 steps. I find this conclusion drawn from the finding of these 3 clusters too speculative given the data: In Figure 3—figure supplement 1 and Figure 4 the distributions of v_par overlap significantly between HL 4,5 and 7. This is again related to the two points above. Finally, if HL 4 5 7 are really distinct behaviors then another possibility could be that they are needed to account for fly-to-fly variability in the data, and that for a single fly only one state is sufficient to describe medium speed walk.</italic></p><p>Yes, we have changed the discussion around this claim.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><disp-quote content-type="editor-comment"><p>Significant additional revisions are still required. The comments of the expert reviewers, below, are detailed and require full responses.</p><p>Reviewer #2:</p><p>[…] Two points need to be addressed before acceptance:</p><p>1) How do the priors used in fitting constrain the structure of the transition matrices found for the models? In the Results section, the authors state that &quot;the assumption of Markov dynamics with a sparse prior on state transitions penalizes the consideration of unlikely state transitions base upon recent history and future destinations.&quot; This suggests that a sparse prior was applied in fitting. However, later in the paper the authors state: &quot;The transition probability matrix for the HMM was sparse, suggesting that from each state there are transitions to only a handful of other states.&quot; If a sparse prior was applied during fitting than the fact that the resulting transition matrix is sparse is not really a finding about the data.</p><p>Similarly, the authors need to clarify what fitting priors or constraints were placed in the HHMM model. The Results state &quot;This is because any HHMM- which puts very specific constraints on the transitions probability matrix- can be represented by an HMM but not vice-versa.&quot; What are the constraints on the transition probability matrix for the HHMM? The text says &quot;The transition probability matrix is sparse- a vast majority of transitions from each HL state were to 2-3 other HL states.&quot; Was this imposed by fitting priors?</p></disp-quote><p>We have made the priors that we use more explicit (see subsection “Post-hoc analyses based on the HHMM model”). The description in subsection “Rationale for the choice of HHMM as the model and the model architecture” only refers to the fact that self-transitions are favored over transition to another state. The priors for all transitions from i<sup>th</sup> – j<sup>th</sup> state were the same.</p><p>With respect to HHMM versus HMM, this is already well-described in the manuscript. (“Rationale for the choice of HHMM as the model and the model architecture” and “Generation of synthetic flies”). Essentially, an HMM with 50 states allows transitions between each of the 50 states. HHMM with 10 HL states and 5 LL states only allows a fraction of these transitions because only LL states within each HL state can transition amongst each other. This property also means that HHMM can always be represented by HMM and not vice-versa.</p><disp-quote content-type="editor-comment"><p>2) Parts of the manuscript are somewhat long and repetitive. I think the manuscript could be productively shortened to have greater impact on its readers.</p><p>For example, in the section titled &quot;HHMM reveals that a fly's locomotion is surprisingly structured in the velocity space&quot; the last paragraph is devoted to restating the major conclusion of the first section: HHMM performs better than HMM. I think this could be reduced or folded into section one, which focusses on this comparison, and the section focused more exclusively on describing the HL states uncovered by the model.</p><p>In the Discussion subsection “Flies show considerable variability in locomotion despite employing the same locomotor features” paragraphs two and three are highly descriptive of the individual fly data and somewhat repetitive with parts of the Results subsection “Both locomotion and an odor’s effect on locomotion is fly dependent” (already rather long). I think these sections could be condensed to make the major points about individual variability in the Results, and use the Discussion mostly to compare these findings with the results of other studies.</p></disp-quote><p>We agree with the reviewer. We have not only made the two specific changes suggested above. We have also taken a careful look at the manuscript, and by cutting repeated segments and tightening the writing, we have reduced the word count (except for the Materials and methods) by ~2000 words.</p><p>Reviewer #3:</p><disp-quote content-type="editor-comment"><p>The authors have addressed most of my concerns expect the important one regarding the confidence interval on the distributions in Figure 5. What I am asking is for the authors to use bootstrapping to extract many sample distributions from subsets of the data in order to get a confidence interval on how these bins are populated by the data and how significant the changes are between before and during odor exposure.</p></disp-quote><p>Apologies for not fully understanding your query. We have performed the bootstrapping. Confidence intervals and significance are noted in Figure 5.</p></body></sub-article></article>