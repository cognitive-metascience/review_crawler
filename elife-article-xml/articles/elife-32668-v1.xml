<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">32668</article-id><article-id pub-id-type="doi">10.7554/eLife.32668</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Structural Biology and Molecular Biophysics</subject></subj-group></article-categories><title-group><article-title>Linking <italic>time-series</italic> of single-molecule experiments with molecular dynamics simulations by machine learning</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-95588"><name><surname>Matsunaga</surname><given-names>Yasuhiro</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2872-3908</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-44073"><name><surname>Sugita</surname><given-names>Yuji</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9738-9216</contrib-id><email>sugita@riken.jp</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="other" rid="fund6"/><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Computational Biophysics Research Team</institution><institution>RIKEN Center for Computational Science</institution><addr-line><named-content content-type="city">Kobe</named-content></addr-line><country>Japan</country></aff><aff id="aff2"><label>2</label><institution>JST PRESTO</institution><addr-line><named-content content-type="city">Kawaguchi</named-content></addr-line><country>Japan</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Theoretical Molecular Science Laboratory</institution><institution>RIKEN Cluster for Pioneering Research</institution><addr-line><named-content content-type="city">Wako</named-content></addr-line><country>Japan</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Laboratory for Biomolecular Function Simulation</institution><institution>RIKEN Center for Biosystems Dynamics Research</institution><addr-line><named-content content-type="city">Kobe</named-content></addr-line><country>Japan</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-15000"><name><surname>Ben-Tal</surname><given-names>Nir</given-names></name><role>Reviewing Editor</role><aff id="aff5"><institution>Tel Aviv University</institution><country>Israel</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>03</day><month>05</month><year>2018</year></pub-date><pub-date pub-type="collection"><year>2018</year></pub-date><volume>7</volume><elocation-id>e32668</elocation-id><history><date date-type="received" iso-8601-date="2017-10-10"><day>10</day><month>10</month><year>2017</year></date><date date-type="accepted" iso-8601-date="2018-04-23"><day>23</day><month>04</month><year>2018</year></date></history><permissions><copyright-statement>© 2018, Matsunaga et al</copyright-statement><copyright-year>2018</copyright-year><copyright-holder>Matsunaga et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-32668-v1.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.32668.001</object-id><p>Single-molecule experiments and molecular dynamics (MD) simulations are indispensable tools for investigating protein conformational dynamics. The former provide <italic>time-series</italic> data, such as donor-acceptor distances, whereas the latter give atomistic information, although this information is often biased by model parameters. Here, we devise a machine-learning method to combine the complementary information from the two approaches and construct a consistent model of conformational dynamics. It is applied to the folding dynamics of the formin-binding protein WW domain. MD simulations over 400 μs led to an initial Markov state model (MSM), which was then &quot;refined&quot; using single-molecule Förster resonance energy transfer (FRET) data through hidden Markov modeling. The refined or <italic>data-assimilated</italic> MSM reproduces the FRET data and features hairpin one in the transition-state ensemble, consistent with mutation experiments. The folding pathway in the data-assimilated MSM suggests interplay between hydrophobic contacts and turn formation. Our method provides a general framework for investigating conformational transitions in other proteins.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>single-molecule experiment</kwd><kwd>molecular dynamics simulation</kwd><kwd>semi-supervised learning</kwd><kwd>Markov state model</kwd><kwd>transfer learning</kwd><kwd><italic>time-series</italic> analysis</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>None</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100002241</institution-id><institution>Japan Science and Technology Agency</institution></institution-wrap></funding-source><award-id>JPMJPR1679</award-id><principal-award-recipient><name><surname>Matsunaga</surname><given-names>Yasuhiro</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001700</institution-id><institution>Ministry of Education, Culture, Sports, Science, and Technology</institution></institution-wrap></funding-source><award-id>26120533</award-id><principal-award-recipient><name><surname>Matsunaga</surname><given-names>Yasuhiro</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100006264</institution-id><institution>RIKEN</institution></institution-wrap></funding-source><award-id>Dynamic Structural Biology</award-id><principal-award-recipient><name><surname>Sugita</surname><given-names>Yuji</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution>Research Organization for Information Science and Technology</institution></institution-wrap></funding-source><award-id>hp160022</award-id><principal-award-recipient><name><surname>Matsunaga</surname><given-names>Yasuhiro</given-names></name><name><surname>Sugita</surname><given-names>Yuji</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100002241</institution-id><institution>Japan Science and Technology Agency</institution></institution-wrap></funding-source><award-id>JPMJCR13M3</award-id><principal-award-recipient><name><surname>Sugita</surname><given-names>Yuji</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001700</institution-id><institution>Ministry of Education, Culture, Sports, Science, and Technology</institution></institution-wrap></funding-source><award-id>26119006</award-id><principal-award-recipient><name><surname>Sugita</surname><given-names>Yuji</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution>Research Organization for Information Science and Technology</institution></institution-wrap></funding-source><award-id>ra000009</award-id><principal-award-recipient><name><surname>Matsunaga</surname><given-names>Yasuhiro</given-names></name><name><surname>Sugita</surname><given-names>Yuji</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A general machine learning scheme for integrating <italic>time-series</italic> data from single-molecule experiments and molecular dynamics simulations is proposed and successfully demonstrated for the folding dynamics of the WW domain.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Protein folding is an important subject not only for basic research in molecular biology but also for understanding folding diseases and designing new polymeric materials (<xref ref-type="bibr" rid="bib16">Dill and MacCallum, 2012</xref>). Transient, partially folded states are often encountered on folding pathways, and have been characterized experimentally in solution by methods such as laser temperature jumps, fluorescence labeling, and solution X-ray scattering. Mutagenesis evaluated by Φ-value analysis (<xref ref-type="bibr" rid="bib23">Fersht and Daggett, 2002</xref>), for instance, has also provided residue-level information on transition states. Recently, state-of-the-art single-molecule (sm) measurements, single-molecule Förster resonance energy transfer (smFRET) (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>; <xref ref-type="bibr" rid="bib59">Oikawa et al., 2013</xref>) and force spectroscopy (smFS) (<xref ref-type="bibr" rid="bib55">Neupane et al., 2016</xref>) have become powerful tools in protein-folding research, providing reliable information on transition-path (barrier-crossing process) times (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>) and heterogeneity in the unfolded state (<xref ref-type="bibr" rid="bib59">Oikawa et al., 2013</xref>). A major limitation of smFRET is that the observables are restricted to ‘low-dimensional’ structural data, such as the donor–acceptor distance. Computational modeling should help us to interpret single-molecule <italic>time-series</italic> measurements and should contribute to solving some remaining puzzles, such as the reduced solvent viscosity dependence of the transition-path times (<xref ref-type="bibr" rid="bib12">Chung and Eaton, 2013</xref>), the internal viscosity (<xref ref-type="bibr" rid="bib12">Chung and Eaton, 2013</xref>) and the impact of non-Markovian property (<xref ref-type="bibr" rid="bib14">Chung et al., 2015</xref>). Theories and computational methods have been developed to extract structural information and dynamics from smFRET data (<xref ref-type="bibr" rid="bib28">Haas et al., 2013</xref>; <xref ref-type="bibr" rid="bib30">Hoefling et al., 2011</xref>; <xref ref-type="bibr" rid="bib45">Matsunaga et al., 2015</xref>; <xref ref-type="bibr" rid="bib83">Sun et al., 2016</xref>).</p><p>Molecular dynamics (MD) simulation is another powerful approach for investigating protein dynamics and folding over relatively long time periods — hundreds of microseconds or longer (<xref ref-type="bibr" rid="bib42">Lindorff-Larsen et al., 2011</xref>). In theory, ‘low-dimensional’ smFRET measurements are interpreted in terms of the atomic structural models obtained with MD simulations. However, it is still a challenge to achieve quantitative agreement between simulation and experimental data during the entire folding process, owing not only to simulation time limitations but also to inherent force-field biases. In particular, while local interactions are well described by the current force fields, it is still difficult to reproduce energetic balances between unfolded and folded states. Indeed, Piana and coworkers showed, in their protein folding simulation study, that the folding mechanism of the villin headpiece depends substantially on the choice of force field (<xref ref-type="bibr" rid="bib68">Piana et al., 2011</xref>). It is also known that most force fields produce unfolded states that are more compact and structured than those suggested experimentally (<xref ref-type="bibr" rid="bib67">Piana et al., 2014</xref>). Methods based on maximum entropy (<xref ref-type="bibr" rid="bib1">Beauchamp et al., 2014</xref>; <xref ref-type="bibr" rid="bib8">Boomsma et al., 2014</xref>; <xref ref-type="bibr" rid="bib11">Cavalli et al., 2013</xref>; <xref ref-type="bibr" rid="bib61">Olsson et al., 2013</xref><xref ref-type="bibr" rid="bib62">, 2014</xref><xref ref-type="bibr" rid="bib63">, 2017</xref>; <xref ref-type="bibr" rid="bib70">Pitera and Chodera, 2012</xref>; <xref ref-type="bibr" rid="bib73">Roux and Weare, 2013</xref>) or Bayesian statistics (<xref ref-type="bibr" rid="bib7">Bonomi et al., 2016</xref>) were recently developed for guiding simulations or models to generate ensembles that match experimental <italic>ensemble-averaged observations</italic>.</p><p>Exploiting <italic>time-series</italic> data from single-molecule experiments is another way to link simulation with experiment and has several advantages over the ensemble-average based approaches: (i) more latent states can be uncovered by inferring states from their historical evolution than from their static ensembles (<xref ref-type="bibr" rid="bib41">Li et al., 2008</xref>; <xref ref-type="bibr" rid="bib45">Matsunaga et al., 2015</xref>; <xref ref-type="bibr" rid="bib78">Schuetz et al., 2010</xref>); (ii) the transition state can be uniquely identified as a dynamic bottleneck by following the actual dynamics. However, the time-scale gap between experiment and simulation previously hampered the direct use of <italic>time-series</italic> analysis methods in other disciplines, such as data assimilations that are based on the sequential Monte Carlo method (<xref ref-type="bibr" rid="bib45">Matsunaga et al., 2015</xref>).</p><p>Here, we develop a new approach for single-molecule <italic>time-series</italic> data based on the Markov state model (MSM) (<xref ref-type="bibr" rid="bib64">Pande et al., 2010</xref>), a statistical model that approximates dynamics by memory-less probabilistic transitions between discrete conformational states. In MSM, the probability of transition from the discrete state <italic>i</italic> to state <italic>j</italic> in a lag time of τ is described by a transition-probability matrix <inline-formula><mml:math id="inf1"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="inf2"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can be estimated from a set of short simulations instead of a single long simulation. Therefore, MSM is often used to generate long-time dynamics (<xref ref-type="bibr" rid="bib81">Silva et al., 2014</xref>) whose time-scale is comparable to those of experimental measurements (<xref ref-type="bibr" rid="bib22">Feng et al., 2016</xref>; <xref ref-type="bibr" rid="bib56">Noé et al., 2011</xref>; <xref ref-type="bibr" rid="bib82">Snow et al., 2002</xref>). However, estimation of <inline-formula><mml:math id="inf3"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is largely dependent on the simulation force-fields, which may have uncertainties or biases for certain conformations (<xref ref-type="bibr" rid="bib63">Olsson et al., 2017</xref>). To overcome this problem, we propose to &quot;refine&quot; <inline-formula><mml:math id="inf4"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> using high-resolution measurement of single-molecules as <italic>time-series</italic> data. Specifically, we use a machine-learning approach to estimate <inline-formula><mml:math id="inf5"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> between hidden Markov states from low-dimensional <italic>time-series</italic> data (<xref ref-type="bibr" rid="bib6">Bishop, 2006</xref>). To distinguish the original <inline-formula><mml:math id="inf6"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we refer to the refined <inline-formula><mml:math id="inf7"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as <inline-formula><mml:math id="inf8"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in this paper.</p><p>We propose a two-step procedure in our machine-learning approach, which links simulations and single-molecule experiments (<xref ref-type="fig" rid="fig1">Figure 1</xref>). (i) <italic>Supervised learning step</italic>. We first construct an initial MSM from a raw set of simulation data. After defining discrete conformational states by clustering the trajectory snapshots, <inline-formula><mml:math id="inf9"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is estimated directly by counting transitions between the discrete states in the simulation trajectories. This step is the same as conventional MSM (<xref ref-type="bibr" rid="bib64">Pande et al., 2010</xref>). (ii) <italic>Unsupervised learning step</italic>. Using <inline-formula><mml:math id="inf10"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as an initial estimate, we perform hidden Markov modeling (<xref ref-type="bibr" rid="bib9">Bronson et al., 2009</xref>; <xref ref-type="bibr" rid="bib50">McKinney et al., 2006</xref>; <xref ref-type="bibr" rid="bib60">Okamoto and Sako, 2012</xref>; <xref ref-type="bibr" rid="bib69">Pirchi et al., 2016</xref>; <xref ref-type="bibr" rid="bib72">Rabiner and Juang, 1986</xref>; <xref ref-type="bibr" rid="bib77">Schröder and Grubmüller, 2003</xref>) to refine the initial MSM using single-molecule measurement <italic>time-series</italic> data. <inline-formula><mml:math id="inf11"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is optimized so that the &quot;refined&quot; or <italic>data-assimilated</italic> MSM with <inline-formula><mml:math id="inf12"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can reproduce the <italic>time-series data</italic> most accurately.</p><fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.32668.002</object-id><label>Figure 1.</label><caption><title>Schematic of proposed semi-supervised learning approach.</title><p>(<bold>A</bold>) Our proposed approach comprises two steps. As the first step, an initial Markov State Model is constructed only from simulation data by simply counting transitions between conformational states. (<bold>B</bold>) In the second step, transition probabilities (depicted by arrows) are updated through unsupervised learning from experimental time-series data.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig1-v1"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.003</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Dye-labeled WW domain and simulation box.</title><p>(<bold>A</bold>) NMR structure of FBP WW domain. (<bold>B</bold>) The same substitution mutation W30A as in experiments. (<bold>C</bold>) Donor (Alexa 488) and acceptor (Alexa 647) dyes attached to the WW domain. The protein is solvated with TIP3P water molecules under the periodic boundary condition.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig1-figsupp1-v1"/></fig></fig-group><p>We applied this procedure to the folding dynamics of the formin-binding protein (FBP) WW domain, a 37-residue three-stranded β-sheet protein. In the construction of the initial MSM, extensive MD simulations of a dye-labeled WW domain were performed for an aggregated time of ~400 μs. Although there are a number of folding simulation studies for the FBP WW domain and its homologs (<xref ref-type="bibr" rid="bib21">Ensign and Pande, 2009</xref>; <xref ref-type="bibr" rid="bib24">Freddolino et al., 2008</xref>; <xref ref-type="bibr" rid="bib37">Karanicolas and Brooks, 2003</xref>; <xref ref-type="bibr" rid="bib88">Zanetti-Polzi et al., 2017</xref>; <xref ref-type="bibr" rid="bib91">Zhou et al., 2014</xref>), this may be the first folding simulation to use FRET dyes. High time-resolution smFRET measurements of WW domain folding and unfolding dynamics were used for the unsupervised learning (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). The data were previously measured to resolve the durations of the folding and unfolding transitions with microsecond resolution by Chung and coworkers (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). The initial and data-assimilated MSM showed different folding pathways and transition-state ensembles of WW domains. An independent mutation experiment with Φ-value analysis (<xref ref-type="bibr" rid="bib23">Fersht and Daggett, 2002</xref>) validated the data-assimilated MSM. We discuss our time-series analysis method in the context of machine-learning theory and its applicability to conformational transitions in other biomolecules.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Single-molecule FRET measurements</title><p>SmFRET experiments were carried out by Chung and coworkers, and details for the experiments are given in <xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>. Here we summarize the essential experimental setups necessary for our machine-learning procedure. Photon trajectories were measured for the FBP WW domain with donor (Alexa 488) and acceptor (Alexa 594) fluorophores attached to the terminal residues in the protein. In order to improve the time resolution of the smFRET data, Chung and coworkers illuminated the protein with a very high intensity laser (10 kW/cm<sup>2</sup>), increasing the number of photons observed per time (~650 photons/ms) (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). Photon color, either donor green or acceptor red, and the absolute time of arrivals were recorded within ~0.5 ns. Each photon trajectory was split into folded and unfolded segments by finding the photon interval with the maximum transition probability (<xref ref-type="bibr" rid="bib26">Gopich and Szabo, 2009</xref>). The final set of smFRET photon sequences comprises 527 trajectories, each of which contains a single folding or unfolding event.</p></sec><sec id="s2-2"><title>Molecular dynamics simulations</title><p>A dye-labeled WW domain was built in silico for MD simulations (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Starting from the NMR structure of the WW domain (PDB code: 1E0L [<xref ref-type="bibr" rid="bib43">Macias et al., 2000</xref>]), we made the same substitution mutation W30A as in the experiments (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>), and the terminal residues were labeled with donor (Alexa Fluor 488) or acceptor (Alexa Fluor 594) dyes by using the AMBER-DYES package (<xref ref-type="bibr" rid="bib27">Graen et al., 2014</xref>).</p><p>We conducted eleven simulations of length 25.6 μs in the NVT ensemble (370 K) from the unfolded structures. By monitoring the fraction of native contacts, <italic>Q</italic>, we observed folding events in four trajectories out of the eleven (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>). Also, six simulations of length 10 μs and four simulations of 14 μs were performed from the folded structure. In these ten trajectories, we observed seven unfolding events. Our simulations, thus, sampled intermediate regions between the unfolded and folded states sufficiently for construction of an initial MSM. The simulation length is ~400 μs in total.</p></sec><sec id="s2-3"><title>Clustering of sampled structures in MD simulations</title><p>For the MSM construction, we chose a two-dimensional (2-D) space spanned by the native contact <italic>Q</italic> and the expected FRET efficiency ε. The value of ε is calculated from the distance <italic>r</italic> between donor and acceptor dyes using the Förster theory, <inline-formula><mml:math id="inf13"><mml:mrow><mml:mi>ε</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>[</mml:mo> <mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>6</mml:mn></mml:msup></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <italic>R</italic><sub>0</sub> is the Förster radius (see 'Methods' for details). Here, <italic>Q</italic> is chosen because it is historically known to be the best reaction coordinate to describe a folding process. Also, ε is employed for comparison with smFRET data as well as for differentiating compact and elongated structures. <xref ref-type="fig" rid="fig2">Figure 2A</xref> shows a scatter plot of the sampled conformations in the MD simulations. Expected FRET efficiency ε successfully resolves the elongated unfolded states and compact states, whereas ε fails to discriminate the folded state (corresponding to <italic>Q</italic> ~ 0.7–1.0 and ε ~ 0.7–1.0) from the compact unfolded state (<italic>Q</italic> ~ 0.0–0.3 and ε ~ 0.7–1.0) without the help of <italic>Q</italic>. This suggests that approaches that are based on ensemble average may have a difficulty when the histogram of ε is used to add biases to the protein in MD simulations.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.32668.004</object-id><label>Figure 2.</label><caption><title>Sampled conformations from simulations and Markov state models constructed in <italic>Q</italic> and expected FRET efficiency space.</title><p>(<bold>A</bold>) Scatter plot of sampled conformations from the aggregated trajectories. Representative structures from folded, compact unfolded, and elongated states are shown. Donor and acceptor dyes are colored green and red, respectively. (<bold>B</bold>) Cluster centers used for constructing the Markov state model are plotted with circles. (<bold>C</bold>) Initial Markov state model constructed from simulation data only. Node areas are proportional to the equilibrium populations, and edge line widths are proportional to the transition probabilities. (<bold>D</bold>) Data-assimilated Markov state model after unsupervised learning from smFRET photon-count sequences. Edges with transition probabilities of less than 0.01 are not shown for visual clarity.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-v1"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.005</object-id><label>Figure 2—figure supplement 1.</label><caption><title><italic>Q</italic> of molecular dynamics simulation trajectories.</title><p>(<bold>A</bold>) Time-course behavior of the fraction of native contacts, <italic>Q</italic>, is shown for eleven 25.6 μs simulations (starting from unfolded states) and for six 10 μs and four 14 μs simulations (starting from the folded state). All simulations used the force-field of Amber ff99SB. (<bold>B</bold>) Time-course behavior with a modified Amber ff99SB force-field where the strength between water molecules and protein was scaled. Ten 7 μs simulations (starting from the unfolded states) are shown.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp1-v1"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.006</object-id><label>Figure 2—figure supplement 2.</label><caption><title>Donor-acceptor distances of the Markov states.</title><p>The Markov states are plotted in the space spanned by the donor-acceptor distance and <italic>Q</italic>. Circles represent mean values of two coordinates in the Markov states. The error bar represents the standard deviations of the donor-acceptor distances in the states.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp2-v1"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.007</object-id><label>Figure 2—figure supplement 3.</label><caption><title>Implied timescales for various numbers of states.</title><p>(<bold>A</bold>) Implied timescales for Markov state models built with different numbers of states (4, 99, and 230 states). (<bold>B</bold>) Converged implied timescales as a function of the number of states. The timescales of the five slowest related to folding dynamics modes are shown.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp3-v1"/></fig><fig id="fig2s4" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.008</object-id><label>Figure 2—figure supplement 4.</label><caption><title>Comparison of the transition probabilities of the initial and the data-assimilated Markov state models.</title><p>(<bold>A</bold>) Implied time scales of the initial and the data-assimilated Markov state models. (<bold>B</bold>) Scatter plot of transition probabilities of the two models. The dots are colored by the FRET efficiencies of the states before transitions (i.e, state <italic>i</italic> of <italic>T<sub>ij</sub></italic>).</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp4-v1"/></fig><fig id="fig2s5" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.009</object-id><label>Figure 2—figure supplement 5.</label><caption><title>Data-assimilated Markov state models using halves of the training data.</title><p>(<bold>A</bold>) Data-assimilated Markov state model obtained using one half set of the single-molecule FRET data. (<bold>B</bold>) Data-assimilated Markov state model using the other half set. Both models capture similar unfolded, folded, and intermediate states as populated states. Edges with transition probabilities of less than 0.01 are not shown for visual clarity.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp5-v1"/></fig><fig id="fig2s6" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.010</object-id><label>Figure 2—figure supplement 6.</label><caption><title>Dependency of data-assimilated Markov state models on the choice of Förster radius <italic>R</italic><sub>0</sub>.</title><p>(<bold>A</bold>) Data-assimilated Markov state model after the convergence of the likelihood function by 10,000 iterations of unsupervised learning using a Förster radius of <italic>R</italic><sub>0</sub> = 54 Å. Edges with transition probabilities of less than 0.01 are not shown for visual clarity. (<bold>B</bold>) <italic>R</italic><sub>0</sub> = 55 Å. (<bold>C</bold>) <italic>R</italic><sub>0</sub> = 57 Å. (<bold>D</bold>) <italic>R</italic><sub>0</sub> = 58 Å.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp6-v1"/></fig><fig id="fig2s7" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.011</object-id><label>Figure 2—figure supplement 7.</label><caption><title>Data-assimilated Markov state obtained by considering the FRET efficiency outside the weak-excitation limit.</title><p>Data-assimilated Markov state model after the convergence of the likelihood function by 10,000 iterations. Here, a corrected definition of FRET efficiency, which is valid outside the weak-excitation limit (with a parameter <inline-formula><mml:math id="inf14"><mml:mrow><mml:mi>Λ</mml:mi><mml:mo>=</mml:mo><mml:mn>1.065</mml:mn></mml:mrow></mml:math></inline-formula>), was used for the calculation of the likelihood function.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp7-v1"/></fig><fig id="fig2s8" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.012</object-id><label>Figure 2—figure supplement 8.</label><caption><title>Optimization process for the initial Markov state model.</title><p>(<bold>A</bold>) Initial Markov state model constructed only from MD simulation data, used as an initial condition for the unsupervised learning. (<bold>B</bold>) Markov state model after 100 iterations of unsupervised learning. (<bold>C</bold>) Data-assimilated Markov state model after the convergence of the likelihood function by 10,000 iterations of unsupervised learning.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp8-v1"/></fig><fig id="fig2s9" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.013</object-id><label>Figure 2—figure supplement 9.</label><caption><title>Optimization of a random matrix as the initial condition.</title><p>(<bold>A</bold>) Initial Markov state model constructed by assigning random values to the transition probabilities, used as an initial condition for the unsupervised learning. (<bold>B</bold>) Data-assimilated Markov state model after 21,331 iterations of unsupervised learning. (<bold>C</bold>) Convergence behavior of the likelihood functions. The blue line corresponds to the initial condition constructed from MD data. The red line indicates the initial condition given from a random matrix.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig2-figsupp9-v1"/></fig></fig-group><p>Sampled conformations were clustered into discrete states in the 2-D space (cluster centers are shown in <xref ref-type="fig" rid="fig2">Figure 2B</xref>). Regular spatial clustering was applied to partition the space in an equidistant manner regardless of the population size (<xref ref-type="bibr" rid="bib80">Senne et al., 2012</xref>). This spatial clustering is essential in this study because relatively minor populations can have high probabilities after the refinement of the initial MSM with the help of experimental <italic>time-series</italic> data.</p><p>In order to obtain structural insights, we calculated both the mean and the variance of the donor-acceptor distance <italic>r</italic> for each state. <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref> shows samples plotted in the 2D space spanned by <italic>Q</italic> and <italic>r</italic>. There are distance gaps between states, which are supportive of the Markovian assumption. Large standard deviations are observed in the case of small donor-acceptor distances. This results from the lower spatial resolution in FRET efficiency ε when ε is not close to 0.5 (e.g., states with ε ~ 1 cover <italic>r </italic>= 0-30 Å) as discussed in the information-binning study by <xref ref-type="bibr" rid="bib87">Watkins and Yang (2004</xref>).</p></sec><sec id="s2-4"><title>Construction of an initial MSM as the supervised learning step</title><p>MSM has two tunable parameters: the number of discrete states and the lag time τ for <inline-formula><mml:math id="inf15"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Theoretically, increasing the number of discrete states and/or the lag time will produce a MSM with the least discretization error (<xref ref-type="bibr" rid="bib71">Prinz et al., 2011</xref>), while a large number of discrete states or a longer lag time will decrease the number of samples for estimation, resulting in large statistical errors (the so-called bias-variance tradeoff) (<xref ref-type="bibr" rid="bib49">McGibbon et al., 2014</xref>). Thus, it is common to make the number of discrete states and the lag time as small as possible, even though it compromises the accuracy of the model. Here, we examined various numbers of discrete states for MSM by calculating implied time scales (<xref ref-type="bibr" rid="bib79">Schwantes and Pande, 2013</xref>). The <italic>i</italic>th implied time scale <italic>t<sub>i</sub></italic> of a MSM with <inline-formula><mml:math id="inf16"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is given by<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mi>τ</mml:mi><mml:mrow><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula>where λ<italic><sub>i</sub></italic> is the <italic>i</italic>th eigenvalue of <inline-formula><mml:math id="inf17"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. As the implied time scales are always underestimated relative to their true values, the slower time scales are indicative of smaller discretization errors. The implied time scales were calculated for various numbers of clustered states as a function of the lag time τ (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A</xref>). We found that the converged values of the slowest implied time scale (related to folding dynamics) successfully reproduce the time scale of folding (~5 μs) in the MD data when the number of states is larger than 80 (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3B</xref>). From these observations, we chose 87 states by adjusting the cluster radius (0.08) in the regular spatial clustering.</p><p>A lag time of τ = 200 ns was chosen as a minimum time scale to achieve converged implied time scales. Note that the number of states chosen here is an order of magnitude fewer than those in other MSM studies. It is well known that the RMSD metric requires a larger number of discrete states in MSM, whereas well-defined metrics that are based on slow motions or smooth coordinates (such as contact-maps [<xref ref-type="bibr" rid="bib38">Kellogg et al., 2012</xref>], or coordinates extracted by time-structure-based independent component analysis [<xref ref-type="bibr" rid="bib79">Schwantes and Pande, 2013</xref>]) require a smaller number of states. A long lag time of τ = 200 ns also helps the MSM to satisfy the Markov assumption as well as improving FRET photon-count statistics in the next unsupervised learning step.</p><p><xref ref-type="fig" rid="fig2">Figure 2C</xref> shows a graphical representation of the initial MSM constructed only from MD simulation data. The node areas are proportional to the equilibrium populations, and the edge line widths are proportional to the transition probabilities, <inline-formula><mml:math id="inf18"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The MSM seems to overemphasize compact unfolded states (<italic>Q</italic> ~ 0.0–0.3 and ε ~ 0.7–1.0), which results from biases of the force-field parameters not only for proteins (<xref ref-type="bibr" rid="bib5">Best et al., 2014</xref>; <xref ref-type="bibr" rid="bib67">Piana et al., 2014</xref>) but also for FRET dyes (<xref ref-type="bibr" rid="bib3">Best et al., 2015</xref>).</p></sec><sec id="s2-5"><title>Refinement of transition probabilities as the unsupervised learning step</title><p>In the unsupervised learning, the total log likelihood function of all smFRET photon-counting sequences <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> is maximized by optimizing <inline-formula><mml:math id="inf20"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. First, we treated smFRET data as <italic>N</italic> independent photon-counting sequences in discretized time windows. Each sequence <italic>O<sub>k</sub></italic> = <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mi>o</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>…</mml:mo><mml:msubsup><mml:mi>o</mml:mi><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> consists of a set of donor and acceptor photon counts <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> detected in <italic>i</italic>th time window. <italic>I</italic> is the number of time windows and 200 ns was chosen for the photon-counting time-window width as well as for the lag time τ of MSM. The likelihood function <inline-formula><mml:math id="inf23"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is then defined as a probability to observe the <italic>k</italic>th smFRET photon-counting sequence <italic>O<sub>k</sub></italic> with a given <inline-formula><mml:math id="inf24"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib25">Gopich and Szabo, 2012</xref>):<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>O</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mo>⋯</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:munderover><mml:mo movablelimits="false">∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:munderover><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p><italic>M</italic> is the number of discrete states in MSM, and <italic>s<sub>i</sub></italic> denotes MSM’s state at the <italic>i</italic>th time window. <inline-formula><mml:math id="inf25"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the transition probability from state <italic>s<sub>i-</sub></italic><sub>1</sub> to state <italic>s<sub>i</sub></italic>. <inline-formula><mml:math id="inf26"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the equilibrium probability of being in state <italic>s</italic><sub>1</sub>. <inline-formula><mml:math id="inf27"><mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the probability of observing donor and acceptor photon-counts <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> given state <italic>s<sub>i</sub></italic>.</p><p>By maximizing the above likelihood function, we obtained the data-assimilated MSM with the optimized <inline-formula><mml:math id="inf29"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which matches with the smFRET <italic>time-series</italic> data. <xref ref-type="fig" rid="fig2">Figure 2D</xref> shows that the data-assimilated MSM differs from the initial MSM. In the data-assimilated MSM, the compact unfolded state (<italic>Q</italic> ~ 0.0–0.3 and ε ~ 0.7–1.0) disappears due to a minor population with high ε in the smFRET data (see <xref ref-type="fig" rid="fig3">Figure 3B</xref>), while an elongated unfolded region (<italic>Q</italic> ~ 0.0–0.2 and ε ~ 0.5–0.6) is stabilized. As noted, this may reflect the biases of the force-field. Also, the different solvent conditions between the simulation (TIP3P water molecules) and the smFRET experiment (denaturant concentration) may affect the unfolded state distribution (<xref ref-type="bibr" rid="bib89">Zheng et al., 2016</xref>). Interestingly, as another stable region, the folded state (<italic>Q</italic> ~ 0.8 and ε ~ 0.6–0.8) appears instead of other states with the same ε.</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.32668.014</object-id><label>Figure 3.</label><caption><title>Measured FRET efficiency histograms.</title><p>(<bold>A</bold>) Measured FRET efficiency histograms calculated from donor and acceptor photons in the single-molecule FRET data with a time-window of 200 ns width, and those generated from initial and data-assimilated Markov state models. The measured FRET efficiency is defined as the ratio of the acceptor photon counts to the total number of photons (<italic>E</italic> = <italic>N<sub>A</sub></italic>/(<italic>N<sub>A</sub> +N<sub>D</sub></italic>)). Error bars indicate standard deviations in ten realizations of photon sequences for both models. (<bold>B</bold>) Measured FRET efficiency histograms calculated with a time-window of 50 μs.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig3-v1"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.015</object-id><label>Figure 3—figure supplement 1.</label><caption><title><italic>k</italic>-fold cross validation test.</title><p>The results of a <italic>k</italic>-fold cross validation test (with <italic>k</italic> = 4). Comparison of the histograms of measured FRET efficiency calculated from the test data (not used for unsupervised learning) and the prediction by stochastic simulation with the trained model (i.e., the data-assimilated Markov state model).</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig3-figsupp1-v1"/></fig></fig-group><p>We compared the transition probabilities <inline-formula><mml:math id="inf30"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of the two MSMs (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4</xref>). <xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4A</xref> shows the implied time scales of the MSMs. We can see that the slowest time scale increases from 2.6 μs to 100 μs after the hidden Markov modeling. These time scales are related to folding/unfolding transitions of WW domain in both cases. Simulation time scale is faster than that in experiments because of the lower viscosity of the TIP3P water model (<xref ref-type="bibr" rid="bib44">Mahoney and Jorgensen, 2001</xref>) compared to those of pure water and the viscogen added in the smFRET experiment (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). This gap was improved by the information from the smFRET data. In <xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4B</xref>, <inline-formula><mml:math id="inf31"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are directly compared in a scatter plot where each <inline-formula><mml:math id="inf32"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is colored using the FRET efficiency ε of state <italic>i</italic> before transition. <inline-formula><mml:math id="inf33"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from states with high FRET efficiencies are correlated with each other. This means that <inline-formula><mml:math id="inf34"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> related to compact states derived from MD simulations are consistent with the smFRET data. By contrast, <inline-formula><mml:math id="inf35"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from states with middle or low FRET efficiencies are less correlated. This means that the hidden Markov modeling mainly updated <inline-formula><mml:math id="inf36"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of elongated states.</p></sec><sec id="s2-6"><title>Reproducibility of experimental data</title><p><xref ref-type="fig" rid="fig3">Figure 3</xref> shows histograms of the ‘measured’ FRET efficiency <italic>E</italic> of the original smFRET data and those generated by the initial and data-assimilated MSMs (see 'Methods' for emulation or stochastic simulation of smFRET data). The measured FRET efficiency <italic>E</italic> is calculated from the numbers of photons emitted from donor and acceptor dyes in a certain time window, <italic>N<sub>D</sub></italic> and <italic>N<sub>A</sub></italic>, respectively. It is defined by the ratio of donor photon counts to total photon counts, <italic>E</italic> = <italic>N<sub>A</sub></italic>/(<italic>N<sub>A</sub> + N<sub>D</sub></italic>). <italic>E</italic> is calculated from measured photons in a time window whereas ε is calculated from the donor-acceptor distance of each instantaneous structure. In <xref ref-type="fig" rid="fig3">Figures 3A</xref>, 200 ns time-windows were used for photon counts. The data-assimilated MSM produced a histogram close to that found with original smFRET data (the mean squared error between the normalized histograms is <inline-formula><mml:math id="inf37"><mml:mrow><mml:mn>3.7</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>), confirming the reliability of the optimized parameters obtained by machine learning.</p><p>We also calculated the observed FRET efficiency <italic>E</italic> with 50 μs time windows (<xref ref-type="fig" rid="fig3">Figure 3B</xref>), which corresponds to the folding time-scale observed in the smFRET data (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). The histogram of the original smFRET data has double peaks, corresponding to unfolded and folded states, respectively. The initial MSM, however, only shows a single sharp peak at high FRET efficiency because of overemphasis of compact conformations (<xref ref-type="bibr" rid="bib5">Best et al., 2014</xref>). The data-assimilated MSM successfully reproduces the double peaks of the histogram of the original data. The histogram of the data-assimilated MSM seems smoothed compared to that obtained experimentally, presumably because of the accumulation of photon-counting noise using 200 ns time-windows.</p></sec><sec id="s2-7"><title>Folding mechanisms of the FBP WW domain</title><p>To quantify the difference between the initial and data-assimilated MSMs, we calculated <italic>p</italic><sub>fold</sub> by applying transition-path theory (<xref ref-type="bibr" rid="bib51">Metzner et al., 2009</xref>; <xref ref-type="bibr" rid="bib57">Noé et al., 2009</xref>) (<xref ref-type="fig" rid="fig4">Figure 4A and B</xref>). <italic>p</italic><sub>fold</sub> is the probability of undergoing a folding transition defined for each state. States with <italic>p</italic><sub>fold</sub> &gt;0.5 are kinetically closer to the folded state, whereas those with <italic>p</italic><sub>fold</sub> &lt;0.5 approximate the unfolded state. Those with <italic>p</italic><sub>fold</sub> = 0.5 define the transition-state ensemble. The calculated <italic>p</italic><sub>fold</sub> tends to depend only on <italic>Q</italic> for the initial MSM (<xref ref-type="fig" rid="fig4">Figure 4A</xref>), as corroborated by a previous analysis of folding simulation data for various proteins (<xref ref-type="bibr" rid="bib4">Best et al., 2013</xref>). On the other hand, <italic>p</italic><sub>fold</sub> of the data-assimilated MSM depends on ε as well as <italic>Q</italic>, suggesting that not only <italic>Q</italic> but also compactness needs to be factored into the folding mechanism (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). <italic>p</italic><sub>fold</sub> was mapped onto the RMSDs of hairpins 1 and 2 of the native structure (<xref ref-type="fig" rid="fig4">Figure 4C and d</xref>). In the initial MSM, the transition-state region (<italic>p</italic><sub>fold</sub> = 0.4–0.6) is located in a rather compact region where the formation of both hairpins 1 and 2 can be just discerned (<xref ref-type="fig" rid="fig4">Figure 4E</xref>). In the data-assimilated MSM, the transition-state ensemble presents only hairpin 1 (<xref ref-type="fig" rid="fig4">Figure 4F</xref>). This is consistent with a mutagenesis experiment, where mutations in hairpin 1 produce large Φ-values (<xref ref-type="bibr" rid="bib65">Petrovich et al., 2006</xref>), implying that formation of hairpin 1 contributes energetically to the transition-state ensemble.</p><fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.32668.016</object-id><label>Figure 4.</label><caption><title>Probability of folding, <italic>p</italic><sub>fold</sub>, and transition state ensemble.</title><p>(<bold>A</bold>) Probabilities of folding, <italic>p</italic><sub>fold</sub>, mapped onto the states of initial Markov state model. (<bold>B</bold>) <italic>p</italic><sub>fold</sub> for data-assimilated Markov state model. The unfolded and folded states used for the calculation (source and sink in the context of the transition path theory, respectively) are indicated by circles. (<bold>C</bold>) Trajectory snapshots in the the RMSDs of hairpins 1 and 2 from their native structures are colored by <italic>p</italic><sub>fold</sub> for the initial Markov state model. (<bold>D</bold>) Trajectory snapshots of the data-assimilated Markov state model. (<bold>E</bold>) Structures of the transition state ensemble in the initial Markov state model which correspond to <italic>p</italic><sub>fold</sub> = 0.4–0.6. (<bold>F</bold>) The transition state ensemble in the data-assimilated Markov state model. Two hydrophobic cores that project below and above the plane of the sheet, core 1 (Trp8, Tyr20, Asn22, Thr29, Pro33, shown in red) and core 2 (Thr9, Tyr11, Tyr 19, Tyr21, shown in blue) are represented by sticks.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig4-v1"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.32668.017</object-id><label>Figure 4—figure supplement 1.</label><caption><title>Dynamics of initial and data-assimilated Markov state models.</title><p>(<bold>A</bold>) Time-course plot of the fraction of native contacts, <italic>Q</italic>, for the initial Markov state model. (<bold>B</bold>) <italic>Q</italic> of data-assimilated Markov state model. (<bold>C</bold>) Time-course plot of gyration radius for initial Markov state model. (<bold>D</bold>) Gyration radius of the data-assimilated Markov state model.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig4-figsupp1-v1"/></fig></fig-group><p>The flux of folding trajectories can be decomposed into individual pathways for both models (<xref ref-type="fig" rid="fig5">Figure 5A and B</xref>). The decomposition extracts a set of pathways along with their fluxes. The dominant pathways with large fluxes provide the statistically probable order of events during folding. The figures show that folding pathways with largest fluxes contribute 50% of the total flux. In the data-assimilated MSM (<xref ref-type="fig" rid="fig5">Figure 5B</xref>), the formation of hydrophobic side-chain cores (core 1 consists of Trp8, Tyr20, Asn22, Thr29 and Pro33, and core 2 consists of Thr9, Tyr11, Tyr 19 and Tyr21) stabilizes the β-sheet structure in hairpin 1. The increased stability of hairpin 1 seems to guide the formation of the second hairpin (hairpin 2) by the inter-strand hydrophobic interactions. Again, this scenario is consistent with site-directed mutagenesis experiments for FBP (<xref ref-type="bibr" rid="bib65">Petrovich et al., 2006</xref>) and the homologous Pin WW domains (<xref ref-type="bibr" rid="bib35">Jäger et al., 2001</xref>). These experiments implied that interactions between conserved hydrophobic residues contribute to the stability of only the native state and not to the transition state ensemble. Previous simulation studies have suggested the existence of register-shifted structures as trapped (<xref ref-type="bibr" rid="bib57">NoeNoé et al., 2009</xref>) or intermediate (<xref ref-type="bibr" rid="bib53">Mu et al., 2006</xref>) states, whereas in the data-assimilated MSM, such states were rarely observed. Hairpin 1 formation as a rate-limiting step together with the paucity of register-shifted states in the data-assimilated MSM are consistent with the scenario of the Wako-Saitô-Muñoz-Eaton (WSME) model (<xref ref-type="bibr" rid="bib54">Muñoz et al., 1997</xref>; <xref ref-type="bibr" rid="bib85">Wako and Saitô, 1978</xref>), which postulates that the formation of a local turn is a bottleneck for β-sheet formation. Interestingly, hairpin 2 formation is driven by a hydrophobic collapse (<xref ref-type="bibr" rid="bib17">Dinner et al., 1999</xref>) in the data-assimilated MSM. This implies that the interplay between turns and hydrophobic clusters has an important role in the formation of multiple hairpins in β-sheet proteins.</p><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.32668.018</object-id><label>Figure 5.</label><caption><title>Folding pathways for initial and data-assimilated Markov state models.</title><p>(<bold>A</bold>) Folding flux of the initial Markov state model was decomposed into individual folding pathways. Folding pathways with largest fluxes contributing 50% of the total flux are superimposed in different colors. In this case, all of the pathways are located at expected FRET efficiency ε ~ 1 with different step size in the <italic>Q</italic> axis. Line widths are proportional to fluxes. Structures of representative states are shown. Two hydrophobic cores that project below and above the plane of the sheet, core 1 (Trp8, Tyr20, Asn22, Thr29 and Pro33, shown in red) and core 2 (Thr9, Tyr11, Tyr 19 and Tyr21, shown in blue) are represented by sticks. (<bold>B</bold>) Folding pathways with largest fluxes contributing 50% of the total flux are shown for the data-assimilated Markov state model.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-32668-fig5-v1"/></fig><p>In terms of the theory of the coil-globule transition (collapse transition) (<xref ref-type="bibr" rid="bib93">Ziv et al., 2009</xref>), the formation of hairpin 1 would be the collapse step. This collapse transition is specific in the sense that the collapsed structure does not contain a large number of non-native contacts, whereas the collapse of homopolymers are often treated as a non-specific transition. As predicted by the theory (<xref ref-type="bibr" rid="bib93">Ziv et al., 2009</xref>), this indicates that the folding and collapse transition temperatures are close for this WW domain.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>We have proposed a two-step procedure for the construction of a data-assimilated MSM with <inline-formula><mml:math id="inf38"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> matching single-molecule <italic>time-series data</italic>. Using smFRET data for the FBP WW domain, we show that the data-assimilated MSM successfully reproduces the original smFRET data, and yields a transition-state ensemble consistent with an independent mutational experiment (<xref ref-type="bibr" rid="bib65">Petrovich et al., 2006</xref>). The folding mechanism based on the data-assimilated MSM suggests an interplay between hairpin and hydrophobic formations.</p><p>In the context of machine-learning theory, the proposed two-step procedure can be regarded as a semi-supervised learning algorithm, which tries to learn from both <italic>labeled</italic> and <italic>unlabeled</italic> data (<xref ref-type="bibr" rid="bib74">Rudzinski et al., 2016</xref>; <xref ref-type="bibr" rid="bib92">Zhu and Goldberg, 2009</xref>). In the context of MSM, simulation data correspond to labeled data while experimental data are unlabeled data. In a typical case of semi-supervised learning (e.g., image recognition), the labeled data are correct and usually expensive (e.g., images that are manually labeled by investigator). Therefore, unlabeled data are often ‘de-emphasized’ by scaling their contribution in the likelihood function (<xref ref-type="bibr" rid="bib92">Zhu and Goldberg, 2009</xref>). By contrast, in our case, labeled data (simulation) may have incorrect transition counts caused by force-field biases whereas unlabeled data (experimental) possess more reliable information on dynamics. Thus, in our two-step procedure, the estimates <inline-formula><mml:math id="inf39"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from labeled data (simulation) are replaced with <inline-formula><mml:math id="inf40"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> &quot;refined&quot; with unlabeled data (experiment). This is regarded as the limit of ‘de-emphasis’ on labeled data (simulation).</p><p>When fitting a rather complex model to any experimental data, the model can overreact to noise in the data (the overfitting problem). In particular, our MSM for the FBP WW domain has a rather large number of parameters (<inline-formula><mml:math id="inf41"><mml:mrow><mml:mn>87</mml:mn><mml:mo>×</mml:mo><mml:mn>87</mml:mn></mml:mrow></mml:math></inline-formula> transition probabilities), which could be easily overfitted to the smFRET data. To assess the overfitting in the unsupervised learning, we divided the smFRET data in half, and unsupervised learning was independently applied to the two subsets. Qualitatively similar network structures appeared in both, and were similar to that obtained with the full data set (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4</xref>). This is because the effective number of parameters is considerably reduced from <inline-formula><mml:math id="inf42"><mml:mrow><mml:mn>87</mml:mn><mml:mo>×</mml:mo><mml:mn>87</mml:mn></mml:mrow></mml:math></inline-formula> down to only those involving populated states (ε ~ 0.5–0.8). In order to counteract overfitting, a maximum caliber approach for minimally perturbing the initial MSM could be a promising direction for a future study (<xref ref-type="bibr" rid="bib18">Dixit and Dill, 2014</xref><xref ref-type="bibr" rid="bib20">, 2015</xref><xref ref-type="bibr" rid="bib19">, 2018</xref>; <xref ref-type="bibr" rid="bib86">Wan et al., 2016</xref>; <xref ref-type="bibr" rid="bib90">Zhou et al., 2017</xref>). Furthermore, to see the dependence on the choice of the Förster radius <italic>R</italic><sub>0</sub>, we carried out the unsupervised learning using a set of different <italic>R</italic><sub>0</sub> values (<italic>R</italic><sub>0</sub> = 54, 55, 57, and 58 Å). The overall structure of the MSM network was robust against the choice of <italic>R</italic><sub>0</sub> except for <italic>R</italic><sub>0</sub> = 58 Å (<xref ref-type="fig" rid="fig2s5">Figure 2—figure supplement 5</xref>).</p><p>The initial condition in the unsupervised learning is another issue. Since MSM has a larger number of parameters than in typical hidden Markov modeling, unsupervised learning requires a good initial condition for optimization to avoid being trapped in a local minimum. By using <inline-formula><mml:math id="inf43"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as the initial condition, we achieved a likelihood convergence with <inline-formula><mml:math id="inf44"><mml:mrow><mml:mi>ln</mml:mi><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> = −584,947 with 10,000-step optimization (taking one week using the parallel implementation of the Baum-Welch algorithm [<xref ref-type="bibr" rid="bib72">Rabiner and Juang, 1986</xref>]). For comparison, we also performed the optimization using a random matrix as the initial condition (<xref ref-type="fig" rid="fig2s8">Figure 2—figure supplement 8C</xref>). In the figure, the optimization of the likelihood looks stacked after 10,000 iterations and its value is lower than that of <inline-formula><mml:math id="inf45"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as the initial condition. This result suggests that the model from a random matrix could be ruled out because of trapping in a local minimum, or at least that global optimization of a random matrix is practically very inefficient. This also emphasizes the importance of transferring knowledge <inline-formula><mml:math id="inf46"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> learned from simulations for improving the unsupervised learning <inline-formula><mml:math id="inf47"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>experiment</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from experimental data (<xref ref-type="bibr" rid="bib84">Torrey and Jude, 2009</xref>). Although just <inline-formula><mml:math id="inf48"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was used as the initial condition here, advanced algorithms in transfer learning (<xref ref-type="bibr" rid="bib84">Torrey and Jude, 2009</xref>) can be incorporated in a future study.</p><p>We here used the conventional constant-time binning for photon counting because the standard MSM is based on constant-time binning. A promising possibility for future studies is to apply continuous-time Markov modeling (<xref ref-type="bibr" rid="bib47">McGibbon and Pande, 2015</xref>), which may allow us to use information-based binning (<xref ref-type="bibr" rid="bib87">Watkins and Yang, 2004</xref>) or photon-by-photon analysis (<xref ref-type="bibr" rid="bib26">Gopich and Szabo, 2009</xref>; <xref ref-type="bibr" rid="bib60">Okamoto and Sako, 2012</xref>; <xref ref-type="bibr" rid="bib69">Pirchi et al., 2016</xref>), avoiding photon counting noise.</p><p>In conclusion, exploiting the temporal information embedded in experimental <italic>time-series</italic> data to improve the simulation-based model has provided a rich, dynamic and experimentally consistent picture of the folding mechanism for the FBP WW domain. The data-assimilated MSM pathway could be used to improve the force-field parameters of proteins, nucleic acids, and other biomolecules. The semi-supervised learning combined with MSM method developed here is a quite general framework that can be used to understand conformational transitions in proteins and other biomolecules. It can be extended to interpret other experimental data possibly using more advanced techniques.</p></sec><sec id="s4" sec-type="methods"><title>Methods</title><sec id="s4-1"><title>Molecular dynamics simulation</title><p>Monte Carlo searches were performed for labeling the dyes without any steric crashes with the protein. The constructed dye-labeled WW domain was solvated by TIP3P water molecules in a cubic box of 64.3 Å side length. Sodium ions were added to make the net charge of the system neutral.</p><p>In order to obtain unfolded structures as the initial structures for production runs, we first performed eleven 80 ns simulations at high temperature (600 K) in the NVT ensemble. Then, each system was equilibrated by 40 ns simulation in the NPT ensemble (1 atm and 370 K, slightly lower than the estimated melting temperature in the previous simulation with a different force field [<xref ref-type="bibr" rid="bib53">Mu et al., 2006</xref>]). After determining the average volume size in these eleven trajectories, the volume size of each simulation was reset to the average value. Then, we conducted production simulation of eleven systems for 25.6 μs in the NVT ensemble (370 K). Furthermore, we performed six additional production runs of lengths 10 μs and another four simulations of 14 μs. All of these additional ten simulations started from the native structure.</p><p>All production simulations were conducted with the Amber 14 GPU version of the PMEMD module (<xref ref-type="bibr" rid="bib76">Salomon-Ferrer et al., 2013</xref>) (using the SPFP precision model [<xref ref-type="bibr" rid="bib40">Le Grand et al., 2013</xref>]) on GPU computers. Amber ff99SB (<xref ref-type="bibr" rid="bib32">Hornak et al., 2006</xref>) was used for the force field. For the FRET dyes (Alexa 488, Alexa 594, and linkers), we used the AMBER-DYE force field (<xref ref-type="bibr" rid="bib27">Graen et al., 2014</xref>), which is optimized for use with the Amber ff99SB and TIP3P water model. A cutoff of 8 Å was applied for the Lennard-Jones and short-range electrostatic interactions. For the long-range electrostatic interactions, we used the Particle Mesh Ewald method (<xref ref-type="bibr" rid="bib15">Darden et al., 1993</xref>). All bonds involving hydrogen atoms were constrained with the SHAKE/SETTLE algorithm (<xref ref-type="bibr" rid="bib52">Miyamoto and Kollman, 1992</xref>; <xref ref-type="bibr" rid="bib75">Ryckaert et al., 1977</xref>). Using hydrogen mass repartitioning (<xref ref-type="bibr" rid="bib31">Hopkins et al., 2015</xref>), a time step of 4 fs was used. Temperature and pressure were controlled by a Berendsen thermostat (<xref ref-type="bibr" rid="bib2">Berendsen et al., 1984</xref>) with a coupling constant of 1 ps and the Monte Carlo barostat, respectively. Trajectories were saved every 200 ps. <italic>Q</italic> was calculated following the definition of <xref ref-type="bibr" rid="bib4">Best et al. (2013</xref>).</p><p>It is known that conventional force fields including Amber99SB used in this study overstabilize compact states in the unfolded or disordered states <xref ref-type="bibr" rid="bib67">(Piana et al., 2014</xref><xref ref-type="bibr" rid="bib66">, 2015</xref>). Recently, Best and coworkers modified short-range proteinrwater pair interactions to correct this bias for a derivative of the Amber ff03 force field with the TIP4P/2005 water model (<xref ref-type="bibr" rid="bib5">Best et al., 2014</xref>). Specifically, they scaled the Lennard-Jones ε<sub>Oi</sub> between the oxygen of water molecules and all protein atoms by using a factor of 1.1. In order to sample non-compact conformations, we scaled ε<sub>Oi</sub> of Amber ff99SB and TIP3P in the same manner, and conducted folding simulations. Starting from the unfolded structures, which were generated in the NVT ensemble (600 K), we performed ten 7 μs simulations in the NPT ensemble (1 atm, and 360 K, slightly lower than the previous case for more conservative simulations). We confirmed that the unfolded states in these trajectories prefer more elongated conformations compared with the original Amber ff99SB. However, we did not observe any folding events, suggesting that the scaling may destabilize the native state at least in the case of Amber ff99SB and TIP3P (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>). Thus, we decided to use only the simulation data of the original Amber ff99SB in this work. For these additional simulations, we used GENESIS (<xref ref-type="bibr" rid="bib34">Jung et al., 2015</xref>; <xref ref-type="bibr" rid="bib39">Kobayashi et al., 2017</xref>) and K computer as well as the Amber 14 PMEMD module and GPU computers. All structural figures were prepared with VMD (<xref ref-type="bibr" rid="bib33">Humphrey et al., 1996</xref>).</p></sec><sec id="s4-2"><title>Markov state model and semi-supervised learning</title><p>The regular spatial clustering was applied with RegularSpatial function in MSMBuilder (<xref ref-type="bibr" rid="bib29">Harrigan et al., 2017</xref>) in the 2-D space spanned by <italic>Q</italic> and ε.</p><p><inline-formula><mml:math id="inf49"><mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in the likelihood function (<xref ref-type="disp-formula" rid="equ2">Equation 2</xref>) is the probability of observing donor and acceptor photon-counts <inline-formula><mml:math id="inf50"><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> given MSM’s state <italic>s<sub>i</sub></italic>. Denoting the donor and acceptor photon count rates in the state <italic>s<sub>i</sub></italic> by <italic>n<sub>D</sub></italic>(<italic>s<sub>i</sub></italic>) and <italic>n<sub>A</sub></italic>(<italic>s<sub>i</sub></italic>), this probability is given by the product of Poisson distributions (<xref ref-type="bibr" rid="bib25">Gopich and Szabo, 2012</xref>),<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Following the previous analysis by Chung and coworkers (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>), we applied the condition that the sum of the donor and acceptor count rates is independent of the conformational states, that is, <inline-formula><mml:math id="inf51"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≡</mml:mo><mml:mtext>const</mml:mtext></mml:mrow></mml:math></inline-formula>. This condition is met when the gamma factor, which is the ratio of the quantum yields and detection efficiencies of the acceptor and donor photons, is equal to one in all conformational states. Under this condition, <xref ref-type="disp-formula" rid="equ3">Equation 3</xref> is rewritten as<disp-formula id="equ4"><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>!</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>!</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mi>ε</mml:mi><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Here, the expected FRET efficiency <inline-formula><mml:math id="inf52"><mml:mrow><mml:mi>ε</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is related to the distance between donor and acceptor <italic>r</italic>(<italic>s<sub>i</sub></italic>) through the Förster theory,<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ε</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula>where <italic>R</italic><sub>0</sub> and κ<sup>2</sup> are the Förster radius and the orientation factor between the transition dipoles of dyes, respectively. By analyzing the structures in MD simulations, we evaluated the contribution of the orientation factor κ<sup>2</sup> to <italic>R</italic><sub>0</sub>. We calculated the directions of the dipoles by assuming that the transition dipole moments are aligned with the long axis of each chromophore (<xref ref-type="bibr" rid="bib3">Best et al., 2015</xref>). Rather than evaluating the orientation factor of each MSM state, we evaluated the averages and standard deviations of the orientation factor in four local regions defined along the <italic>Q</italic> and ε axes respectively because fluctuations in the instantaneous orientation factor required a large number of samples. The average (standard deviation) of each region along the <italic>Q</italic> axis was κ<sup>2</sup> = 0.63 (0.64) for <italic>Q</italic> = 0.00–0.25, 0.63 (0.64), for <italic>Q</italic> = 0.25–0.50, 0.64 (0.63), for <italic>Q</italic> = 0.50–0.75, and 0.60 (0.62) for <italic>Q</italic> = 0.75–1.00. Also, the average (standard deviation) of each region along the ε axis was κ<sup>2</sup> = 0.66 (0.69) for ε = 0.00–0.25, 0.64 (0.68) for ε = 0.25–0.50, 0.61 (0.66) for ε = 0.50–0.75, and 0.63 (0.64) for ε = 0.75–1.00. The results suggest that κ<sup>2</sup> hardly depends on states within standard deviations. Thus, we here employed the isotropic average approximation κ<sup>2</sup> = 2/3, and <italic>R</italic><sub>0</sub> = 56 Å (<xref ref-type="bibr" rid="bib36">Jäger et al., 2006</xref>) was used. In the same way, the donor-acceptor distance <italic>r</italic> was calculated from the geometric centers of the donor and acceptor chromophores. The averaged value of <italic>r</italic> within each state <italic>s<sub>i</sub></italic> was used for <italic>r</italic>(<italic>s<sub>i</sub></italic>).</p><p>The total log likelihood function <inline-formula><mml:math id="inf53"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> of observing smFRET time-series data was optimized using the Baum-Welch algorithm (<xref ref-type="bibr" rid="bib72">Rabiner and Juang, 1986</xref>), imposing the detailed-balance condition as a constraint (<xref ref-type="bibr" rid="bib48">McGibbon et al., 2014a</xref>; <xref ref-type="bibr" rid="bib58">Noé et al., 2013</xref>). A numerical benefit of imposing the condition is that the maximum eigenvalue of the transition probability matrix always becomes one and its corresponding eigenvector represents the equilibrium probabilities of states. For this intensive calculation, in-house MATLAB codes (<ext-link ext-link-type="uri" xlink:href="https://github.com/ymatsunaga/mdtoolbox">https://github.com/ymatsunaga/mdtoolbox</ext-link>) were developed and parallelized over photon-sequences. The codes are publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/ymatsunaga/mdtoolbox">https://github.com/ymatsunaga/mdtoolbox</ext-link> under the BSD 3-Clause License (<xref ref-type="bibr" rid="bib46">Matsunaga, 2018</xref>); copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/mdtoolbox">https://github.com/elifesciences-publications/mdtoolbox</ext-link>). In the Baum-Welch algorithm, the parameters whose initial values are zero are always kept as zero. In order to relax this topological constraint, very weak random noise was added to <inline-formula><mml:math id="inf54"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mtext>simulation</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> before the optimization. In the early phase of the optimization (100 steps), unfolded states are stabilized irrespective of their compactness (with the likelihood value of <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> = −588,314, <xref ref-type="fig" rid="fig2s7">Figure 2—figure supplement 7B</xref>). Then, during the convergence of the likelihood in an optimization of 10,000 steps, the compact unfolded state disappeared while the folded state becomes stabilized (with a larger likelihood value of <inline-formula><mml:math id="inf56"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">I</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mtext> </mml:mtext><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> = −584,947, <xref ref-type="fig" rid="fig2s7">Figure 2—figure supplement 7C</xref>).</p><p>In order to examine the overfitting of the model to the smFRET data, we divided smFRET data into halves, and the likelihood optimization was independently applied to the two subsets. Both results generated qualitatively similar network structures as with the full data set (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4</xref>).</p><p>To see the dependence on the choice of the Förster radius <italic>R</italic><sub>0</sub>, we carried out the unsupervised learning using a set of different <italic>R</italic><sub>0</sub> values (<italic>R</italic><sub>0</sub> = 54 Å, 55 Å, 57 Å, and 58 Å) with the same 87 states. The overall structure of the MSM network was robust against the choice of <italic>R</italic><sub>0</sub> except for <italic>R</italic><sub>0</sub> = 58 Å (<xref ref-type="fig" rid="fig2s5">Figure 2—figure supplement 5</xref>).</p><p>It is known that <xref ref-type="disp-formula" rid="equ5">Equation (5)</xref> only approximately holds at the weak excitation-limit of the donor dye. Here, its validity of the assumption is questionable because a very high intensity laser (10 kW/cm<sup>2</sup>) was used in the current smFRET measurement to increase the number of photons (<xref ref-type="bibr" rid="bib13">Chung et al., 2012</xref>). Thus, we examined the FRET efficiency outside the weak-excitation limit by using the following relation given by <xref ref-type="bibr" rid="bib10">Camley et al. (2009</xref>):<disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>ε</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Here, Λ depends on all rates of dye photophysics other than the energy transfer. Λ = 1 corresponds to the weak-field limit (<xref ref-type="disp-formula" rid="equ5">Equation 5</xref>). Λ &gt;1 reflects the inability of doubly excited dye pairs to undergo FRET within commonly accepted physical models. Here, using the same 87 states, we optimized the likelihood function by using ε’ with Λ = 1.065, a value used in <xref ref-type="bibr" rid="bib10">Camley et al., 2009</xref>. The optimized model is plotted in <xref ref-type="fig" rid="fig2s6">Figure 2—figure supplement 6</xref>. In the figure, although the intermediate states look more stabilized, the locations of stabilized states are qualitatively the same as the weak-field limit (Λ = 1, <xref ref-type="disp-formula" rid="equ5">Equation 5</xref>). This suggests that the folding mechanism is robust against the definition of ε.</p><p>In order to evaluate the dependence on the initial condition, we also performed the optimization using a random matrix as the initial condition. The convergence of the likelihood function is shown in <xref ref-type="fig" rid="fig2s8">Figure 2—figure supplement 8</xref>.</p></sec><sec id="s4-3"><title>Analysis of Markov state models</title><p>We analyzed the dynamic properties of the constructed MSMs by generating long MSM simulation trajectories with stochastic simulations. We first generated trajectories of states by using <inline-formula><mml:math id="inf57"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (τ = 200 ns). Specifically, a random number between 0 and 1 was drawn at every step to determine which state the system will jump to in the next step according to <inline-formula><mml:math id="inf58"><mml:mrow><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>T</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. For the reproducibility test against the original smFRET data, we generated a total of 10 independent trajectories of states each having the same time-length as the smFRET data, and then virtually emitted photons according to the likelihood function (<xref ref-type="disp-formula" rid="equ2">Equation 2</xref>) from the states. We compared the histogram of observed FRET efficiencies <italic>E</italic> = <italic>N<sub>A</sub></italic>/(<italic>N<sub>A</sub> + N<sub>D</sub></italic>) using 200 ns and 50 μs time-windows.</p><p>In order to examine the overfitting again, we performed a <italic>k</italic>-fold cross validation test (with <italic>k</italic>=4) and calculated errors by using histograms of measured FRET efficiencies <italic>E</italic>. We partitioned the smFRET data set into <italic>k</italic> subsets (<italic>k</italic>-1 subsets as the training data, a single subset as the test data). We evaluated the mean squared error between the normalized FRET efficiency histograms calculated from the model and the subsets of the smFRET data (shown in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). The prediction error (the so-called cross validation error) for the test data was found to be <inline-formula><mml:math id="inf59"><mml:mn>11.8</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, which is quite small. This suggests that overfitting is not a critical issue in our modeling.</p><p>Trajectories of conformations were generated from the trajectories of states by choosing a random conformation from a state at each step. These conformational trajectories were used to characterize the time-course behavior of <italic>Q </italic>and the gyration radius (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>), as well as the transition state ensemble (<xref ref-type="fig" rid="fig4">Figure 4E and F</xref>).</p><p>The folding behavior was further characterized by calculating <italic>p</italic><sub>fold</sub>, the probability of a given state to fold before it unfolds. The <italic>p</italic><sub>fold</sub> was solved by applying the transition-path theory (<xref ref-type="bibr" rid="bib51">Metzner et al., 2009</xref>; <xref ref-type="bibr" rid="bib57">Noé et al., 2009</xref>) (with committors function in MSMBuilder [<xref ref-type="bibr" rid="bib29">Harrigan et al., 2017</xref>]). The <italic>p</italic><sub>fold</sub> was mapped onto geometric space (Cα-RMSDs of the hairpins 1 and 2) using the trajectories generated as described above.</p><p>We conducted pathway analysis from the unfolded to the folded state by decomposing the flux of folding trajectories into individual pathways (<xref ref-type="bibr" rid="bib51">Metzner et al., 2009</xref>; <xref ref-type="bibr" rid="bib57">Noé et al., 2009</xref>). In the algorithm, after calculating the net flux matrix between states, the largest flux pathway from the unfolded to the folded state was searched by using Dijkstra’s algorithm. Then, the largest flux was subtracted from the net flux matrix. Subsequently, the second largest flux pathway was determined by using Dijkstra’s algorithm. Representative pathways were obtained by repeating this procedure using the paths function of MSMbuilder (<xref ref-type="bibr" rid="bib29">Harrigan et al., 2017</xref>).</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We extend our sincere thanks to William A Eaton and Hoi Sung Chung for providing the single-molecule FRET data and helpful comments on the draft. Thanks also to Satoshi Takahashi, Hiroyuki Oikawa, Simon Olsson and Suyong Re for their comments. We acknowledge help from Timo Graen in using the AMBER-DYES force field. Computational resources were provided by HOKUSAI GreatWave in the RIKEN Advanced Center for Computing and Communication and by K computer in the RIKEN Advanced Institute for Computational Science through the HPCI System Research project (Project IDs. hp160022, hp170137 and ra000009). This research has been funded as a RIKEN pioneering project ‘Dynamic Structural Biology’ (funding awarded to YS), as part of the strategic programs for innovation research (‘Computational life science and application in drug discovery and medical development’ and ‘Novel measurement techniques for visualizing live protein molecules at work’ [Grant No. 26119006] [to YS]), by JST CREST under the ‘Structural Life Science and Advanced Core Technologies for Innovative Life Science Research’ program (Grant No. JPMJCR13M3) (to YS), by MEXT Japan under their ‘Initiative for High-Dimensional Data-Driven Science through Deepening of Sparse Modeling’ (Grant No. 26120533) (to YM), and by JST PRESTO (Grant No. JPMJPR1679) (to YM).</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Funding acquisition, Validation, Investigation, Visualization, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Data curation, Supervision, Funding acquisition, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.32668.019</object-id><label>Transparent reporting form</label><media mime-subtype="pdf" mimetype="application" xlink:href="elife-32668-transrepform-v1.pdf"/></supplementary-material><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>All of the in-house program codes for the method proposed in this study, including test datasets, are available at GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/ymatsunaga/mdtoolbox">https://github.com/ymatsunaga/mdtoolbox</ext-link>.</p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Beauchamp</surname> <given-names>KA</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name><name><surname>Das</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Bayesian energy landscape tilting: towards concordant models of molecular ensembles</article-title><source>Biophysical Journal</source><volume>106</volume><fpage>1381</fpage><lpage>1390</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2014.02.009</pub-id><pub-id pub-id-type="pmid">24655513</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berendsen</surname> <given-names>HJC</given-names></name><name><surname>Postma</surname> <given-names>JPM</given-names></name><name><surname>van Gunsteren</surname> <given-names>WF</given-names></name><name><surname>DiNola</surname> <given-names>A</given-names></name><name><surname>Haak</surname> <given-names>JR</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>Molecular dynamics with coupling to an external bath</article-title><source>The Journal of Chemical Physics</source><volume>81</volume><fpage>3684</fpage><lpage>3690</lpage><pub-id pub-id-type="doi">10.1063/1.448118</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Best</surname> <given-names>RB</given-names></name><name><surname>Hofmann</surname> <given-names>H</given-names></name><name><surname>Nettels</surname> <given-names>D</given-names></name><name><surname>Schuler</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Quantitative interpretation of FRET experiments via molecular simulation: force field and validation</article-title><source>Biophysical Journal</source><volume>108</volume><fpage>2721</fpage><lpage>2731</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2015.04.038</pub-id><pub-id pub-id-type="pmid">26039173</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Best</surname> <given-names>RB</given-names></name><name><surname>Hummer</surname> <given-names>G</given-names></name><name><surname>Eaton</surname> <given-names>WA</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Native contacts determine protein folding mechanisms in atomistic simulations</article-title><source>PNAS</source><volume>110</volume><fpage>17874</fpage><lpage>17879</lpage><pub-id pub-id-type="doi">10.1073/pnas.1311599110</pub-id><pub-id pub-id-type="pmid">24128758</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Best</surname> <given-names>RB</given-names></name><name><surname>Zheng</surname> <given-names>W</given-names></name><name><surname>Mittal</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Balanced protein-water interactions improve properties of disordered proteins and non-specific protein association</article-title><source>Journal of Chemical Theory and Computation</source><volume>10</volume><fpage>5113</fpage><lpage>5124</lpage><pub-id pub-id-type="doi">10.1021/ct500569b</pub-id><pub-id pub-id-type="pmid">25400522</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bishop</surname> <given-names>CM</given-names></name></person-group><year iso-8601-date="2006">2006</year><source>Pattern Recognition and Machine Learning</source><publisher-name>Springer</publisher-name></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bonomi</surname> <given-names>M</given-names></name><name><surname>Camilloni</surname> <given-names>C</given-names></name><name><surname>Cavalli</surname> <given-names>A</given-names></name><name><surname>Vendruscolo</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Metainference: A Bayesian inference method for heterogeneous systems</article-title><source>Science Advances</source><volume>2</volume><elocation-id>e1501177</elocation-id><pub-id pub-id-type="doi">10.1126/sciadv.1501177</pub-id><pub-id pub-id-type="pmid">26844300</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boomsma</surname> <given-names>W</given-names></name><name><surname>Ferkinghoff-Borg</surname> <given-names>J</given-names></name><name><surname>Lindorff-Larsen</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Combining experiments and simulations using the maximum entropy principle</article-title><source>PLoS Computational Biology</source><volume>10</volume><elocation-id>e1003406</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1003406</pub-id><pub-id pub-id-type="pmid">24586124</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bronson</surname> <given-names>JE</given-names></name><name><surname>Fei</surname> <given-names>J</given-names></name><name><surname>Hofman</surname> <given-names>JM</given-names></name><name><surname>Gonzalez</surname> <given-names>RL</given-names></name><name><surname>Wiggins</surname> <given-names>CH</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Learning rates and states from biophysical time series: a Bayesian approach to model selection and single-molecule FRET data</article-title><source>Biophysical Journal</source><volume>97</volume><fpage>3196</fpage><lpage>3205</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2009.09.031</pub-id><pub-id pub-id-type="pmid">20006957</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Camley</surname> <given-names>BA</given-names></name><name><surname>Brown</surname> <given-names>FLH</given-names></name><name><surname>Lipman</surname> <given-names>EA</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Förster transfer outside the weak-excitation limit</article-title><source>The Journal of Chemical Physics</source><volume>131</volume><fpage>104509</fpage><pub-id pub-id-type="doi">10.1063/1.3230974</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cavalli</surname> <given-names>A</given-names></name><name><surname>Camilloni</surname> <given-names>C</given-names></name><name><surname>Vendruscolo</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Molecular dynamics simulations with replica-averaged structural restraints generate structural ensembles according to the maximum entropy principle</article-title><source>The Journal of Chemical Physics</source><volume>138</volume><elocation-id>094112</elocation-id><pub-id pub-id-type="doi">10.1063/1.4793625</pub-id><pub-id pub-id-type="pmid">23485282</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chung</surname> <given-names>HS</given-names></name><name><surname>Eaton</surname> <given-names>WA</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Single-molecule fluorescence probes dynamics of barrier crossing</article-title><source>Nature</source><volume>502</volume><fpage>685</fpage><lpage>688</lpage><pub-id pub-id-type="doi">10.1038/nature12649</pub-id><pub-id pub-id-type="pmid">24153185</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chung</surname> <given-names>HS</given-names></name><name><surname>McHale</surname> <given-names>K</given-names></name><name><surname>Louis</surname> <given-names>JM</given-names></name><name><surname>Eaton</surname> <given-names>WA</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Single-molecule fluorescence experiments determine protein folding transition path times</article-title><source>Science</source><volume>335</volume><fpage>981</fpage><lpage>984</lpage><pub-id pub-id-type="doi">10.1126/science.1215768</pub-id><pub-id pub-id-type="pmid">22363011</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chung</surname> <given-names>HS</given-names></name><name><surname>Piana-Agostinetti</surname> <given-names>S</given-names></name><name><surname>Shaw</surname> <given-names>DE</given-names></name><name><surname>Eaton</surname> <given-names>WA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Structural origin of slow diffusion in protein folding</article-title><source>Science</source><volume>349</volume><fpage>1504</fpage><lpage>1510</lpage><pub-id pub-id-type="doi">10.1126/science.aab1369</pub-id><pub-id pub-id-type="pmid">26404828</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Darden</surname> <given-names>T</given-names></name><name><surname>York</surname> <given-names>D</given-names></name><name><surname>Pedersen</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Particle mesh Ewald: A<italic>n N</italic> ⋅log( <italic>N</italic> ) method for Ewald sums i<italic>n</italic> large systems</article-title><source>The Journal of Chemical Physics</source><volume>98</volume><fpage>10089</fpage><lpage>10092</lpage><pub-id pub-id-type="doi">10.1063/1.464397</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dill</surname> <given-names>KA</given-names></name><name><surname>MacCallum</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The protein-folding problem, 50 years on</article-title><source>Science</source><volume>338</volume><fpage>1042</fpage><lpage>1046</lpage><pub-id pub-id-type="doi">10.1126/science.1219021</pub-id><pub-id pub-id-type="pmid">23180855</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dinner</surname> <given-names>AR</given-names></name><name><surname>Lazaridis</surname> <given-names>T</given-names></name><name><surname>Karplus</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Understanding beta-hairpin formation</article-title><source>PNAS</source><volume>96</volume><fpage>9068</fpage><lpage>9073</lpage><pub-id pub-id-type="doi">10.1073/pnas.96.16.9068</pub-id><pub-id pub-id-type="pmid">10430896</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dixit</surname> <given-names>PD</given-names></name><name><surname>Dill</surname> <given-names>KA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Inferring microscopic kinetic rates from stationary state distributions</article-title><source>Journal of Chemical Theory and Computation</source><volume>10</volume><fpage>3002</fpage><lpage>3005</lpage><pub-id pub-id-type="doi">10.1021/ct5001389</pub-id><pub-id pub-id-type="pmid">25136269</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dixit</surname> <given-names>PD</given-names></name><name><surname>Dill</surname> <given-names>KA</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Caliber corrected markov modeling (c<sub>2</sub>m<sub>2</sub>): Correcting equilibrium markov models</article-title><source>Journal of Chemical Theory and Computation</source><volume>14</volume><fpage>1111</fpage><lpage>1119</lpage><pub-id pub-id-type="doi">10.1021/acs.jctc.7b01126</pub-id><pub-id pub-id-type="pmid">29323898</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dixit</surname> <given-names>PD</given-names></name><name><surname>Jain</surname> <given-names>A</given-names></name><name><surname>Stock</surname> <given-names>G</given-names></name><name><surname>Dill</surname> <given-names>KA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Inferring transition rates of networks from populations in continuous-time markov processes</article-title><source>Journal of Chemical Theory and Computation</source><volume>11</volume><fpage>5464</fpage><lpage>5472</lpage><pub-id pub-id-type="doi">10.1021/acs.jctc.5b00537</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ensign</surname> <given-names>DL</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The Fip35 WW domain folds with structural and mechanistic heterogeneity in molecular dynamics simulations</article-title><source>Biophysical Journal</source><volume>96</volume><fpage>L53</fpage><lpage>L55</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2009.01.024</pub-id><pub-id pub-id-type="pmid">19383445</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Feng</surname> <given-names>Y</given-names></name><name><surname>Zhang</surname> <given-names>L</given-names></name><name><surname>Wu</surname> <given-names>S</given-names></name><name><surname>Liu</surname> <given-names>Z</given-names></name><name><surname>Gao</surname> <given-names>X</given-names></name><name><surname>Zhang</surname> <given-names>X</given-names></name><name><surname>Liu</surname> <given-names>M</given-names></name><name><surname>Liu</surname> <given-names>J</given-names></name><name><surname>Huang</surname> <given-names>X</given-names></name><name><surname>Wang</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Conformational dynamics of apo-glnbp revealed by experimental and computational analysis</article-title><source>Angewandte Chemie International Edition</source><volume>55</volume><fpage>13990</fpage><lpage>13994</lpage><pub-id pub-id-type="doi">10.1002/anie.201606613</pub-id><pub-id pub-id-type="pmid">27730716</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fersht</surname> <given-names>AR</given-names></name><name><surname>Daggett</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Protein folding and unfolding at atomic resolution</article-title><source>Cell</source><volume>108</volume><fpage>573</fpage><lpage>582</lpage><pub-id pub-id-type="doi">10.1016/S0092-8674(02)00620-7</pub-id><pub-id pub-id-type="pmid">11909527</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Freddolino</surname> <given-names>PL</given-names></name><name><surname>Liu</surname> <given-names>F</given-names></name><name><surname>Gruebele</surname> <given-names>M</given-names></name><name><surname>Schulten</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Ten-microsecond molecular dynamics simulation of a fast-folding WW domain</article-title><source>Biophysical Journal</source><volume>94</volume><fpage>L75</fpage><lpage>L77</lpage><pub-id pub-id-type="doi">10.1529/biophysj.108.131565</pub-id><pub-id pub-id-type="pmid">18339748</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gopich</surname> <given-names>I</given-names></name><name><surname>Szabo</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Theory of single-molecule FRET efficiency histograms</article-title><source>Advances in Chemical Physics</source><volume>146</volume><fpage>245</fpage><lpage>297</lpage><pub-id pub-id-type="doi">10.1002/9781118131374.ch10</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gopich</surname> <given-names>IV</given-names></name><name><surname>Szabo</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Decoding the pattern of photon colors in single-molecule FRET</article-title><source>The Journal of Physical Chemistry B</source><volume>113</volume><fpage>10965</fpage><lpage>10973</lpage><pub-id pub-id-type="doi">10.1021/jp903671p</pub-id><pub-id pub-id-type="pmid">19588948</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Graen</surname> <given-names>T</given-names></name><name><surname>Hoefling</surname> <given-names>M</given-names></name><name><surname>Grubmüller</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>AMBER-DYES: Characterization of charge fluctuations and force field parameterization of fluorescent dyes for molecular dynamics simulations</article-title><source>Journal of Chemical Theory and Computation</source><volume>10</volume><fpage>5505</fpage><lpage>5512</lpage><pub-id pub-id-type="doi">10.1021/ct500869p</pub-id><pub-id pub-id-type="pmid">26583233</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haas</surname> <given-names>KR</given-names></name><name><surname>Yang</surname> <given-names>H</given-names></name><name><surname>Chu</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Expectation-maximization of the potential of mean force and diffusion coefficient in Langevin dynamics from single molecule FRET data photon by photon</article-title><source>The Journal of Physical Chemistry B</source><volume>117</volume><fpage>15591</fpage><lpage>15605</lpage><pub-id pub-id-type="doi">10.1021/jp405983d</pub-id><pub-id pub-id-type="pmid">23937300</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harrigan</surname> <given-names>MP</given-names></name><name><surname>Sultan</surname> <given-names>MM</given-names></name><name><surname>Hernández</surname> <given-names>CX</given-names></name><name><surname>Husic</surname> <given-names>BE</given-names></name><name><surname>Eastman</surname> <given-names>P</given-names></name><name><surname>Schwantes</surname> <given-names>CR</given-names></name><name><surname>Beauchamp</surname> <given-names>KA</given-names></name><name><surname>McGibbon</surname> <given-names>RT</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>MSMBuilder: Statistical models for biomolecular dynamics</article-title><source>Biophysical Journal</source><volume>112</volume><fpage>10</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2016.10.042</pub-id><pub-id pub-id-type="pmid">28076801</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoefling</surname> <given-names>M</given-names></name><name><surname>Lima</surname> <given-names>N</given-names></name><name><surname>Haenni</surname> <given-names>D</given-names></name><name><surname>Seidel</surname> <given-names>CA</given-names></name><name><surname>Schuler</surname> <given-names>B</given-names></name><name><surname>Grubmüller</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Structural heterogeneity and quantitative FRET efficiency distributions of polyprolines through a hybrid atomistic simulation and Monte Carlo approach</article-title><source>PLoS ONE</source><volume>6</volume><elocation-id>e19791</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0019791</pub-id><pub-id pub-id-type="pmid">21629703</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hopkins</surname> <given-names>CW</given-names></name><name><surname>Le Grand</surname> <given-names>S</given-names></name><name><surname>Walker</surname> <given-names>RC</given-names></name><name><surname>Roitberg</surname> <given-names>AE</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Long-Time-Step Molecular Dynamics through Hydrogen Mass Repartitioning</article-title><source>Journal of Chemical Theory and Computation</source><volume>11</volume><fpage>1864</fpage><lpage>1874</lpage><pub-id pub-id-type="doi">10.1021/ct5010406</pub-id><pub-id pub-id-type="pmid">26574392</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hornak</surname> <given-names>V</given-names></name><name><surname>Abel</surname> <given-names>R</given-names></name><name><surname>Okur</surname> <given-names>A</given-names></name><name><surname>Strockbine</surname> <given-names>B</given-names></name><name><surname>Roitberg</surname> <given-names>A</given-names></name><name><surname>Simmerling</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Comparison of multiple Amber force fields and development of improved protein backbone parameters</article-title><source>Proteins: Structure, Function, and Bioinformatics</source><volume>65</volume><fpage>712</fpage><lpage>725</lpage><pub-id pub-id-type="doi">10.1002/prot.21123</pub-id><pub-id pub-id-type="pmid">16981200</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Humphrey</surname> <given-names>W</given-names></name><name><surname>Dalke</surname> <given-names>A</given-names></name><name><surname>Schulten</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>VMD: visual molecular dynamics</article-title><source>Journal of Molecular Graphics</source><volume>14</volume><fpage>33</fpage><lpage>38</lpage><pub-id pub-id-type="doi">10.1016/0263-7855(96)00018-5</pub-id><pub-id pub-id-type="pmid">8744570</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jung</surname> <given-names>J</given-names></name><name><surname>Mori</surname> <given-names>T</given-names></name><name><surname>Kobayashi</surname> <given-names>C</given-names></name><name><surname>Matsunaga</surname> <given-names>Y</given-names></name><name><surname>Yoda</surname> <given-names>T</given-names></name><name><surname>Feig</surname> <given-names>M</given-names></name><name><surname>Sugita</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>GENESIS: a hybrid-parallel and multi-scale molecular dynamics simulator with enhanced sampling algorithms for biomolecular and cellular simulations</article-title><source>Wiley Interdisciplinary Reviews: Computational Molecular Science</source><volume>5</volume><fpage>310</fpage><lpage>323</lpage><pub-id pub-id-type="doi">10.1002/wcms.1220</pub-id><pub-id pub-id-type="pmid">26753008</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jäger</surname> <given-names>M</given-names></name><name><surname>Nguyen</surname> <given-names>H</given-names></name><name><surname>Crane</surname> <given-names>JC</given-names></name><name><surname>Kelly</surname> <given-names>JW</given-names></name><name><surname>Gruebele</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>The folding mechanism of a beta-sheet: the WW domain</article-title><source>Journal of Molecular Biology</source><volume>311</volume><fpage>373</fpage><lpage>393</lpage><pub-id pub-id-type="doi">10.1006/jmbi.2001.4873</pub-id><pub-id pub-id-type="pmid">11478867</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jäger</surname> <given-names>M</given-names></name><name><surname>Nir</surname> <given-names>E</given-names></name><name><surname>Weiss</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Site-specific labeling of proteins for single-molecule FRET by combining chemical and enzymatic modification</article-title><source>Protein Science</source><volume>15</volume><fpage>640</fpage><lpage>646</lpage><pub-id pub-id-type="doi">10.1110/ps.051851506</pub-id><pub-id pub-id-type="pmid">16452617</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karanicolas</surname> <given-names>J</given-names></name><name><surname>Brooks</surname> <given-names>CL</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>The structural basis for biphasic kinetics in the folding of the WW domain from a formin-binding protein: lessons for protein design?</article-title><source>PNAS</source><volume>100</volume><fpage>3954</fpage><lpage>3959</lpage><pub-id pub-id-type="doi">10.1073/pnas.0731771100</pub-id><pub-id pub-id-type="pmid">12655041</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kellogg</surname> <given-names>EH</given-names></name><name><surname>Lange</surname> <given-names>OF</given-names></name><name><surname>Baker</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Evaluation and optimization of discrete state models of protein folding</article-title><source>The Journal of Physical Chemistry B</source><volume>116</volume><fpage>11405</fpage><lpage>11413</lpage><pub-id pub-id-type="doi">10.1021/jp3044303</pub-id><pub-id pub-id-type="pmid">22958200</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kobayashi</surname> <given-names>C</given-names></name><name><surname>Jung</surname> <given-names>J</given-names></name><name><surname>Matsunaga</surname> <given-names>Y</given-names></name><name><surname>Mori</surname> <given-names>T</given-names></name><name><surname>Ando</surname> <given-names>T</given-names></name><name><surname>Tamura</surname> <given-names>K</given-names></name><name><surname>Kamiya</surname> <given-names>M</given-names></name><name><surname>Sugita</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>GENESIS 1.1: A hybrid-parallel molecular dynamics simulator with enhanced sampling algorithms on multiple computational platforms</article-title><source>Journal of Computational Chemistry</source><volume>38</volume><fpage>2193</fpage><lpage>2206</lpage><pub-id pub-id-type="doi">10.1002/jcc.24874</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Le Grand</surname> <given-names>S</given-names></name><name><surname>Götz</surname> <given-names>AW</given-names></name><name><surname>Walker</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>SPFP: Speed without compromise—A mixed precision model for GPU accelerated molecular dynamics simulations</article-title><source>Computer Physics Communications</source><volume>184</volume><fpage>374</fpage><lpage>380</lpage><pub-id pub-id-type="doi">10.1016/j.cpc.2012.09.022</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname> <given-names>CB</given-names></name><name><surname>Yang</surname> <given-names>H</given-names></name><name><surname>Komatsuzaki</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Multiscale complex network of protein conformational fluctuations in single-molecule time series</article-title><source>PNAS</source><volume>105</volume><fpage>536</fpage><lpage>541</lpage><pub-id pub-id-type="doi">10.1073/pnas.0707378105</pub-id><pub-id pub-id-type="pmid">18178627</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lindorff-Larsen</surname> <given-names>K</given-names></name><name><surname>Piana</surname> <given-names>S</given-names></name><name><surname>Dror</surname> <given-names>RO</given-names></name><name><surname>Shaw</surname> <given-names>DE</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>How fast-folding proteins fold</article-title><source>Science</source><volume>334</volume><fpage>517</fpage><lpage>520</lpage><pub-id pub-id-type="doi">10.1126/science.1208351</pub-id><pub-id pub-id-type="pmid">22034434</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Macias</surname> <given-names>MJ</given-names></name><name><surname>Gervais</surname> <given-names>V</given-names></name><name><surname>Civera</surname> <given-names>C</given-names></name><name><surname>Oschkinat</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Structural analysis of WW domains and design of a WW prototype</article-title><source>Nature Structural Biology</source><volume>7</volume><fpage>375</fpage><lpage>379</lpage><pub-id pub-id-type="doi">10.1038/75144</pub-id><pub-id pub-id-type="pmid">10802733</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mahoney</surname> <given-names>MW</given-names></name><name><surname>Jorgensen</surname> <given-names>WL</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Diffusion constant of the TIP5P model of liquid water</article-title><source>The Journal of Chemical Physics</source><volume>114</volume><fpage>363</fpage><lpage>366</lpage><pub-id pub-id-type="doi">10.1063/1.1329346</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Matsunaga</surname> <given-names>Y</given-names></name><name><surname>Kidera</surname> <given-names>A</given-names></name><name><surname>Sugita</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Sequential data assimilation for single-molecule FRET photon-counting data</article-title><source>The Journal of Chemical Physics</source><volume>142</volume><elocation-id>214115</elocation-id><pub-id pub-id-type="doi">10.1063/1.4921983</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Matsunaga</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>mdtoolbox</data-title><source>GitHub</source><version designator="f8eed18">f8eed18</version><ext-link ext-link-type="uri" xlink:href="https://github.com/ymatsunaga/mdtoolbox">https://github.com/ymatsunaga/mdtoolbox</ext-link></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McGibbon</surname> <given-names>RT</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Efficient maximum likelihood parameterization of continuous-time Markov processes</article-title><source>The Journal of Chemical Physics</source><volume>143</volume><elocation-id>034109</elocation-id><pub-id pub-id-type="doi">10.1063/1.4926516</pub-id><pub-id pub-id-type="pmid">26203016</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>McGibbon</surname> <given-names>RT</given-names></name><name><surname>Ramsundar</surname> <given-names>B</given-names></name><name><surname>Sultan</surname> <given-names>MM</given-names></name><name><surname>Kiss</surname> <given-names>G</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2014">2014a</year><article-title>Understanding Protein Dynamics with L1-Regularized Reversible Hidden Markov Models</article-title><conf-name>Paper Presented at the Proc. 31st Intl. Conf. on Machine Learning (ICML)</conf-name><conf-loc>China</conf-loc></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McGibbon</surname> <given-names>RT</given-names></name><name><surname>Schwantes</surname> <given-names>CR</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Statistical model selection for Markov models of biomolecular dynamics</article-title><source>The Journal of Physical Chemistry B</source><volume>118</volume><fpage>6475</fpage><lpage>6481</lpage><pub-id pub-id-type="doi">10.1021/jp411822r</pub-id><pub-id pub-id-type="pmid">24738580</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McKinney</surname> <given-names>SA</given-names></name><name><surname>Joo</surname> <given-names>C</given-names></name><name><surname>Ha</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Analysis of single-molecule FRET trajectories using hidden Markov modeling</article-title><source>Biophysical Journal</source><volume>91</volume><fpage>1941</fpage><lpage>1951</lpage><pub-id pub-id-type="doi">10.1529/biophysj.106.082487</pub-id><pub-id pub-id-type="pmid">16766620</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Metzner</surname> <given-names>P</given-names></name><name><surname>Schütte</surname> <given-names>C</given-names></name><name><surname>Vanden-Eijnden</surname> <given-names>E</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Transition path theory for markov jump processes</article-title><source>Multiscale Modeling &amp; Simulation</source><volume>7</volume><fpage>1192</fpage><lpage>1219</lpage><pub-id pub-id-type="doi">10.1137/070699500</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Miyamoto</surname> <given-names>S</given-names></name><name><surname>Kollman</surname> <given-names>PA</given-names></name></person-group><year iso-8601-date="1992">1992</year><article-title>Settle: An analytical version of the SHAKE and RATTLE algorithm for rigid water models</article-title><source>Journal of Computational Chemistry</source><volume>13</volume><fpage>952</fpage><lpage>962</lpage><pub-id pub-id-type="doi">10.1002/jcc.540130805</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mu</surname> <given-names>Y</given-names></name><name><surname>Nordenskiöld</surname> <given-names>L</given-names></name><name><surname>Tam</surname> <given-names>JP</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Folding, misfolding, and amyloid protofibril formation of WW domain FBP28</article-title><source>Biophysical Journal</source><volume>90</volume><fpage>3983</fpage><lpage>3992</lpage><pub-id pub-id-type="doi">10.1529/biophysj.105.076406</pub-id><pub-id pub-id-type="pmid">16533840</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muñoz</surname> <given-names>V</given-names></name><name><surname>Thompson</surname> <given-names>PA</given-names></name><name><surname>Hofrichter</surname> <given-names>J</given-names></name><name><surname>Eaton</surname> <given-names>WA</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Folding dynamics and mechanism of beta-hairpin formation</article-title><source>Nature</source><volume>390</volume><fpage>196</fpage><lpage>199</lpage><pub-id pub-id-type="doi">10.1038/36626</pub-id><pub-id pub-id-type="pmid">9367160</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Neupane</surname> <given-names>K</given-names></name><name><surname>Manuel</surname> <given-names>AP</given-names></name><name><surname>Woodside</surname> <given-names>MT</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Protein folding trajectories can be described quantitatively by one-dimensional diffusion over measured energy landscapes</article-title><source>Nature Physics</source><volume>12</volume><fpage>700</fpage><lpage>703</lpage><pub-id pub-id-type="doi">10.1038/nphys3677</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Noé</surname> <given-names>F</given-names></name><name><surname>Doose</surname> <given-names>S</given-names></name><name><surname>Daidone</surname> <given-names>I</given-names></name><name><surname>Löllmann</surname> <given-names>M</given-names></name><name><surname>Sauer</surname> <given-names>M</given-names></name><name><surname>Chodera</surname> <given-names>JD</given-names></name><name><surname>Smith</surname> <given-names>JC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Dynamical fingerprints for probing individual relaxation processes in biomolecular dynamics with simulations and kinetic experiments</article-title><source>PNAS</source><volume>108</volume><fpage>4822</fpage><lpage>4827</lpage><pub-id pub-id-type="doi">10.1073/pnas.1004646108</pub-id><pub-id pub-id-type="pmid">21368203</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Noé</surname> <given-names>F</given-names></name><name><surname>Schütte</surname> <given-names>C</given-names></name><name><surname>Vanden-Eijnden</surname> <given-names>E</given-names></name><name><surname>Reich</surname> <given-names>L</given-names></name><name><surname>Weikl</surname> <given-names>TR</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Constructing the equilibrium ensemble of folding pathways from short off-equilibrium simulations</article-title><source>PNAS</source><volume>106</volume><fpage>19011</fpage><lpage>19016</lpage><pub-id pub-id-type="doi">10.1073/pnas.0905466106</pub-id><pub-id pub-id-type="pmid">19887634</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Noé</surname> <given-names>F</given-names></name><name><surname>Wu</surname> <given-names>H</given-names></name><name><surname>Prinz</surname> <given-names>JH</given-names></name><name><surname>Plattner</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Projected and hidden Markov models for calculating kinetics and metastable states of complex molecules</article-title><source>The Journal of Chemical Physics</source><volume>139</volume><elocation-id>184114</elocation-id><pub-id pub-id-type="doi">10.1063/1.4828816</pub-id><pub-id pub-id-type="pmid">24320261</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oikawa</surname> <given-names>H</given-names></name><name><surname>Suzuki</surname> <given-names>Y</given-names></name><name><surname>Saito</surname> <given-names>M</given-names></name><name><surname>Kamagata</surname> <given-names>K</given-names></name><name><surname>Arai</surname> <given-names>M</given-names></name><name><surname>Takahashi</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Microsecond dynamics of an unfolded protein by a line confocal tracking of single molecule fluorescence</article-title><source>Scientific Reports</source><volume>3</volume><elocation-id>2151</elocation-id><pub-id pub-id-type="doi">10.1038/srep02151</pub-id><pub-id pub-id-type="pmid">23827883</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okamoto</surname> <given-names>K</given-names></name><name><surname>Sako</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Variational Bayes analysis of a photon-based hidden Markov model for single-molecule FRET trajectories</article-title><source>Biophysical Journal</source><volume>103</volume><fpage>1315</fpage><lpage>1324</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2012.07.047</pub-id><pub-id pub-id-type="pmid">22995504</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olsson</surname> <given-names>S</given-names></name><name><surname>Frellsen</surname> <given-names>J</given-names></name><name><surname>Boomsma</surname> <given-names>W</given-names></name><name><surname>Mardia</surname> <given-names>KV</given-names></name><name><surname>Hamelryck</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Inference of structure ensembles of flexible biomolecules from sparse, averaged data</article-title><source>PLoS ONE</source><volume>8</volume><elocation-id>e79439</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0079439</pub-id><pub-id pub-id-type="pmid">24244505</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olsson</surname> <given-names>S</given-names></name><name><surname>Vögeli</surname> <given-names>BR</given-names></name><name><surname>Cavalli</surname> <given-names>A</given-names></name><name><surname>Boomsma</surname> <given-names>W</given-names></name><name><surname>Ferkinghoff-Borg</surname> <given-names>J</given-names></name><name><surname>Lindorff-Larsen</surname> <given-names>K</given-names></name><name><surname>Hamelryck</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Probabilistic determination of native state ensembles of proteins</article-title><source>Journal of Chemical Theory and Computation</source><volume>10</volume><fpage>3484</fpage><lpage>3491</lpage><pub-id pub-id-type="doi">10.1021/ct5001236</pub-id><pub-id pub-id-type="pmid">26588313</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olsson</surname> <given-names>S</given-names></name><name><surname>Wu</surname> <given-names>H</given-names></name><name><surname>Paul</surname> <given-names>F</given-names></name><name><surname>Clementi</surname> <given-names>C</given-names></name><name><surname>Noé</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Combining experimental and simulation data of molecular processes via augmented Markov models</article-title><source>PNAS</source><volume>114</volume><fpage>8265</fpage><lpage>8270</lpage><pub-id pub-id-type="doi">10.1073/pnas.1704803114</pub-id><pub-id pub-id-type="pmid">28716931</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pande</surname> <given-names>VS</given-names></name><name><surname>Beauchamp</surname> <given-names>K</given-names></name><name><surname>Bowman</surname> <given-names>GR</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Everything you wanted to know about Markov State Models but were afraid to ask</article-title><source>Methods</source><volume>52</volume><fpage>99</fpage><lpage>105</lpage><pub-id pub-id-type="doi">10.1016/j.ymeth.2010.06.002</pub-id><pub-id pub-id-type="pmid">20570730</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Petrovich</surname> <given-names>M</given-names></name><name><surname>Jonsson</surname> <given-names>AL</given-names></name><name><surname>Ferguson</surname> <given-names>N</given-names></name><name><surname>Daggett</surname> <given-names>V</given-names></name><name><surname>Fersht</surname> <given-names>AR</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Phi-analysis at the experimental limits: mechanism of beta-hairpin formation</article-title><source>Journal of Molecular Biology</source><volume>360</volume><fpage>865</fpage><lpage>881</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2006.05.050</pub-id><pub-id pub-id-type="pmid">16784750</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Piana</surname> <given-names>S</given-names></name><name><surname>Donchev</surname> <given-names>AG</given-names></name><name><surname>Robustelli</surname> <given-names>P</given-names></name><name><surname>Shaw</surname> <given-names>DE</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Water dispersion interactions strongly influence simulated structural properties of disordered protein states</article-title><source>The Journal of Physical Chemistry B</source><volume>119</volume><fpage>5113</fpage><lpage>5123</lpage><pub-id pub-id-type="doi">10.1021/jp508971m</pub-id><pub-id pub-id-type="pmid">25764013</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Piana</surname> <given-names>S</given-names></name><name><surname>Klepeis</surname> <given-names>JL</given-names></name><name><surname>Shaw</surname> <given-names>DE</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Assessing the accuracy of physical models used in protein-folding simulations: quantitative evidence from long molecular dynamics simulations</article-title><source>Current Opinion in Structural Biology</source><volume>24</volume><fpage>98</fpage><lpage>105</lpage><pub-id pub-id-type="doi">10.1016/j.sbi.2013.12.006</pub-id><pub-id pub-id-type="pmid">24463371</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Piana</surname> <given-names>S</given-names></name><name><surname>Lindorff-Larsen</surname> <given-names>K</given-names></name><name><surname>Shaw</surname> <given-names>DE</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>How robust are protein folding simulations with respect to force field parameterization?</article-title><source>Biophysical Journal</source><volume>100</volume><fpage>L47</fpage><lpage>L49</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2011.03.051</pub-id><pub-id pub-id-type="pmid">21539772</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pirchi</surname> <given-names>M</given-names></name><name><surname>Tsukanov</surname> <given-names>R</given-names></name><name><surname>Khamis</surname> <given-names>R</given-names></name><name><surname>Tomov</surname> <given-names>TE</given-names></name><name><surname>Berger</surname> <given-names>Y</given-names></name><name><surname>Khara</surname> <given-names>DC</given-names></name><name><surname>Volkov</surname> <given-names>H</given-names></name><name><surname>Haran</surname> <given-names>G</given-names></name><name><surname>Nir</surname> <given-names>E</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Photon-by-photon hidden markov model analysis for microsecond single-molecule fret kinetics</article-title><source>The Journal of Physical Chemistry B</source><volume>120</volume><fpage>13065</fpage><lpage>13075</lpage><pub-id pub-id-type="doi">10.1021/acs.jpcb.6b10726</pub-id><pub-id pub-id-type="pmid">27977207</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pitera</surname> <given-names>JW</given-names></name><name><surname>Chodera</surname> <given-names>JD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>On the use of experimental observations to bias simulated ensembles</article-title><source>Journal of Chemical Theory and Computation</source><volume>8</volume><fpage>3445</fpage><lpage>3451</lpage><pub-id pub-id-type="doi">10.1021/ct300112v</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Prinz</surname> <given-names>JH</given-names></name><name><surname>Wu</surname> <given-names>H</given-names></name><name><surname>Sarich</surname> <given-names>M</given-names></name><name><surname>Keller</surname> <given-names>B</given-names></name><name><surname>Senne</surname> <given-names>M</given-names></name><name><surname>Held</surname> <given-names>M</given-names></name><name><surname>Chodera</surname> <given-names>JD</given-names></name><name><surname>Schütte</surname> <given-names>C</given-names></name><name><surname>Noé</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Markov models of molecular kinetics: generation and validation</article-title><source>The Journal of Chemical Physics</source><volume>134</volume><elocation-id>174105</elocation-id><pub-id pub-id-type="doi">10.1063/1.3565032</pub-id><pub-id pub-id-type="pmid">21548671</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rabiner</surname> <given-names>L</given-names></name><name><surname>Juang</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>An introduction to hidden Markov models</article-title><source>IEEE ASSP Magazine</source><volume>3</volume><fpage>4</fpage><lpage>16</lpage><pub-id pub-id-type="doi">10.1109/MASSP.1986.1165342</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roux</surname> <given-names>B</given-names></name><name><surname>Weare</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>On the statistical equivalence of restrained-ensemble simulations with the maximum entropy method</article-title><source>The Journal of Chemical Physics</source><volume>138</volume><elocation-id>084107</elocation-id><pub-id pub-id-type="doi">10.1063/1.4792208</pub-id><pub-id pub-id-type="pmid">23464140</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rudzinski</surname> <given-names>JF</given-names></name><name><surname>Kremer</surname> <given-names>K</given-names></name><name><surname>Bereau</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Communication: Consistent interpretation of molecular simulation kinetics using Markov state models biased with external information</article-title><source>The Journal of Chemical Physics</source><volume>144</volume><elocation-id>051102</elocation-id><pub-id pub-id-type="doi">10.1063/1.4941455</pub-id><pub-id pub-id-type="pmid">26851901</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ryckaert</surname> <given-names>J-P</given-names></name><name><surname>Ciccotti</surname> <given-names>G</given-names></name><name><surname>Berendsen</surname> <given-names>HJC</given-names></name></person-group><year iso-8601-date="1977">1977</year><article-title>Numerical integration of the cartesian equations of motion of a system with constraints: molecular dynamics of n-alkanes</article-title><source>Journal of Computational Physics</source><volume>23</volume><fpage>327</fpage><lpage>341</lpage><pub-id pub-id-type="doi">10.1016/0021-9991(77)90098-5</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salomon-Ferrer</surname> <given-names>R</given-names></name><name><surname>Götz</surname> <given-names>AW</given-names></name><name><surname>Poole</surname> <given-names>D</given-names></name><name><surname>Le Grand</surname> <given-names>S</given-names></name><name><surname>Walker</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Routine microsecond molecular dynamics simulations with AMBER on GPUs. 2. Explicit Solvent Particle Mesh Ewald</article-title><source>Journal of Chemical Theory and Computation</source><volume>9</volume><fpage>3878</fpage><lpage>3888</lpage><pub-id pub-id-type="doi">10.1021/ct400314y</pub-id><pub-id pub-id-type="pmid">26592383</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schröder</surname> <given-names>GF</given-names></name><name><surname>Grubmüller</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Maximum likelihood trajectories from single molecule fluorescence resonance energy transfer experiments</article-title><source>The Journal of Chemical Physics</source><volume>119</volume><fpage>9920</fpage><lpage>9924</lpage><pub-id pub-id-type="doi">10.1063/1.1616511</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schuetz</surname> <given-names>P</given-names></name><name><surname>Wuttke</surname> <given-names>R</given-names></name><name><surname>Schuler</surname> <given-names>B</given-names></name><name><surname>Caflisch</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Free energy surfaces from single-distance information</article-title><source>The Journal of Physical Chemistry B</source><volume>114</volume><fpage>15227</fpage><lpage>15235</lpage><pub-id pub-id-type="doi">10.1021/jp1053698</pub-id><pub-id pub-id-type="pmid">20964427</pub-id></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwantes</surname> <given-names>CR</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Improvements in markov state model construction reveal many non-native interactions in the folding of NTL9</article-title><source>Journal of Chemical Theory and Computation</source><volume>9</volume><fpage>2000</fpage><lpage>2009</lpage><pub-id pub-id-type="doi">10.1021/ct300878a</pub-id><pub-id pub-id-type="pmid">23750122</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Senne</surname> <given-names>M</given-names></name><name><surname>Trendelkamp-Schroer</surname> <given-names>B</given-names></name><name><surname>Mey</surname> <given-names>AS</given-names></name><name><surname>Schütte</surname> <given-names>C</given-names></name><name><surname>Noé</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>EMMA: A Software Package for Markov Model Building and Analysis</article-title><source>Journal of Chemical Theory and Computation</source><volume>8</volume><fpage>2223</fpage><lpage>2238</lpage><pub-id pub-id-type="doi">10.1021/ct300274u</pub-id><pub-id pub-id-type="pmid">26588955</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Silva</surname> <given-names>DA</given-names></name><name><surname>Weiss</surname> <given-names>DR</given-names></name><name><surname>Pardo Avila</surname> <given-names>F</given-names></name><name><surname>Da</surname> <given-names>LT</given-names></name><name><surname>Levitt</surname> <given-names>M</given-names></name><name><surname>Wang</surname> <given-names>D</given-names></name><name><surname>Huang</surname> <given-names>X</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Millisecond dynamics of RNA polymerase II translocation at atomic resolution</article-title><source>PNAS</source><volume>111</volume><fpage>7665</fpage><lpage>7670</lpage><pub-id pub-id-type="doi">10.1073/pnas.1315751111</pub-id><pub-id pub-id-type="pmid">24753580</pub-id></element-citation></ref><ref id="bib82"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Snow</surname> <given-names>CD</given-names></name><name><surname>Nguyen</surname> <given-names>H</given-names></name><name><surname>Pande</surname> <given-names>VS</given-names></name><name><surname>Gruebele</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Absolute comparison of simulated and experimental protein-folding dynamics</article-title><source>Nature</source><volume>420</volume><fpage>102</fpage><lpage>106</lpage><pub-id pub-id-type="doi">10.1038/nature01160</pub-id><pub-id pub-id-type="pmid">12422224</pub-id></element-citation></ref><ref id="bib83"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname> <given-names>X</given-names></name><name><surname>Morrell</surname> <given-names>TE</given-names></name><name><surname>Yang</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Extraction of protein conformational modes from distance distributions using structurally imputed bayesian data augmentation</article-title><source>The Journal of Physical Chemistry B</source><volume>120</volume><fpage>10469</fpage><lpage>10482</lpage><pub-id pub-id-type="doi">10.1021/acs.jpcb.6b07767</pub-id><pub-id pub-id-type="pmid">27642672</pub-id></element-citation></ref><ref id="bib84"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Torrey</surname> <given-names>L</given-names></name><name><surname>Jude</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2009">2009</year><chapter-title>Transfer Learning</chapter-title><person-group person-group-type="editor"><name><surname>Soria</surname> <given-names>E</given-names></name><name><surname>Martin</surname> <given-names>J</given-names></name><name><surname>Magdalena</surname> <given-names>R</given-names></name><name><surname>Martinez</surname> <given-names>M</given-names></name><name><surname>Serrano</surname> <given-names>A</given-names></name></person-group><source>Handbook of Research on Machine Learning Applications and Trends: Algorithms, Methods, and Techniques 1</source><publisher-name>IGI Global</publisher-name><fpage>242</fpage><lpage>264</lpage></element-citation></ref><ref id="bib85"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wako</surname> <given-names>H</given-names></name><name><surname>Saitô</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="1978">1978</year><article-title>Statistical mechanical theory of the protein conformation. Ii. Folding pathway for protein</article-title><source>Journal of the Physical Society of Japan</source><volume>44</volume><fpage>1939</fpage><lpage>1945</lpage><pub-id pub-id-type="doi">10.1143/JPSJ.44.1939</pub-id></element-citation></ref><ref id="bib86"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wan</surname> <given-names>H</given-names></name><name><surname>Zhou</surname> <given-names>G</given-names></name><name><surname>Voelz</surname> <given-names>VA</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A maximum-caliber approach to predicting perturbed folding kinetics due to mutations</article-title><source>Journal of Chemical Theory and Computation</source><volume>12</volume><fpage>5768</fpage><lpage>5776</lpage><pub-id pub-id-type="doi">10.1021/acs.jctc.6b00938</pub-id><pub-id pub-id-type="pmid">27951664</pub-id></element-citation></ref><ref id="bib87"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Watkins</surname> <given-names>LP</given-names></name><name><surname>Yang</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Information bounds and optimal analysis of dynamic single molecule measurements</article-title><source>Biophysical Journal</source><volume>86</volume><fpage>4015</fpage><lpage>4029</lpage><pub-id pub-id-type="doi">10.1529/biophysj.103.037739</pub-id><pub-id pub-id-type="pmid">15189897</pub-id></element-citation></ref><ref id="bib88"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zanetti-Polzi</surname> <given-names>L</given-names></name><name><surname>Davis</surname> <given-names>CM</given-names></name><name><surname>Gruebele</surname> <given-names>M</given-names></name><name><surname>Dyer</surname> <given-names>RB</given-names></name><name><surname>Amadei</surname> <given-names>A</given-names></name><name><surname>Daidone</surname> <given-names>I</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Parallel folding pathways of Fip35 WW domain explained by infrared spectra and their computer simulation</article-title><source>FEBS Letters</source><volume>591</volume><fpage>3265</fpage><lpage>3275</lpage><pub-id pub-id-type="doi">10.1002/1873-3468.12836</pub-id><pub-id pub-id-type="pmid">28881468</pub-id></element-citation></ref><ref id="bib89"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname> <given-names>W</given-names></name><name><surname>Borgia</surname> <given-names>A</given-names></name><name><surname>Buholzer</surname> <given-names>K</given-names></name><name><surname>Grishaev</surname> <given-names>A</given-names></name><name><surname>Schuler</surname> <given-names>B</given-names></name><name><surname>Best</surname> <given-names>RB</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Probing the Action of Chemical Denaturant on an Intrinsically Disordered Protein by Simulation and Experiment</article-title><source>Journal of the American Chemical Society</source><volume>138</volume><fpage>11702</fpage><lpage>11713</lpage><pub-id pub-id-type="doi">10.1021/jacs.6b05443</pub-id><pub-id pub-id-type="pmid">27583687</pub-id></element-citation></ref><ref id="bib90"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname> <given-names>G</given-names></name><name><surname>Pantelopulos</surname> <given-names>GA</given-names></name><name><surname>Mukherjee</surname> <given-names>S</given-names></name><name><surname>Voelz</surname> <given-names>VA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Bridging microscopic and macroscopic mechanisms of p53-MDM2 binding with kinetic network models</article-title><source>Biophysical Journal</source><volume>113</volume><fpage>785</fpage><lpage>793</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2017.07.009</pub-id><pub-id pub-id-type="pmid">28834715</pub-id></element-citation></ref><ref id="bib91"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname> <given-names>R</given-names></name><name><surname>Maisuradze</surname> <given-names>GG</given-names></name><name><surname>Suñol</surname> <given-names>D</given-names></name><name><surname>Todorovski</surname> <given-names>T</given-names></name><name><surname>Macias</surname> <given-names>MJ</given-names></name><name><surname>Xiao</surname> <given-names>Y</given-names></name><name><surname>Scheraga</surname> <given-names>HA</given-names></name><name><surname>Czaplewski</surname> <given-names>C</given-names></name><name><surname>Liwo</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Folding kinetics of WW domains with the united residue force field for bridging microscopic motions and experimental measurements</article-title><source>PNAS</source><volume>111</volume><fpage>18243</fpage><lpage>18248</lpage><pub-id pub-id-type="doi">10.1073/pnas.1420914111</pub-id><pub-id pub-id-type="pmid">25489078</pub-id></element-citation></ref><ref id="bib92"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhu</surname> <given-names>X</given-names></name><name><surname>Goldberg</surname> <given-names>AB</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Introduction to semi-supervised learning</article-title><source>Synthesis Lectures on Artificial Intelligence and Machine Learning</source><volume>3</volume><fpage>1</fpage><lpage>130</lpage><pub-id pub-id-type="doi">10.2200/S00196ED1V01Y200906AIM006</pub-id></element-citation></ref><ref id="bib93"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ziv</surname> <given-names>G</given-names></name><name><surname>Thirumalai</surname> <given-names>D</given-names></name><name><surname>Haran</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Collapse transition in proteins</article-title><source>Physical Chemistry Chemical Physics</source><volume>11</volume><fpage>83</fpage><lpage>93</lpage><pub-id pub-id-type="doi">10.1039/B813961J</pub-id><pub-id pub-id-type="pmid">19081910</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.32668.021</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Ben-Tal</surname><given-names>Nir</given-names></name><role>Reviewing Editor</role><aff id="aff6"><institution>Tel Aviv University</institution><country>Israel</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Linking time series of single-molecule experiments with molecular dynamics simulations by machine learning&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by three peer reviewers, and the evaluation has been overseen by a Reviewing Editor and Arup Chakraborty as the Senior Editor. The following individual involved in review of your submission has agreed to reveal his identity: John Straub (Reviewer #2).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>The manuscript describes a novel approach based on hidden Markov models to connect single-molecular FRET measurements with MD simulations, and application to the folding of formin-binding protein WW domain. The manuscript address two key issues in improving the validity of Markov state models used in protein folding studies, namely, 1) the construction of the discrete states, and 2) the construction of the continuous time Markov transition matrix T(\tau). Initially, discrete conformational states were obtained by clustering trajectory snapshots, and transition rates were then estimated from trajectories. To correct potential bias due to problems in the force field, the authors then used a hidden Markov model to model smFRET time series measurement and a) modified the discrete states and b) estimated the T(\tau) values between the discrete states so the smFRET is better explained. Indeed, the refined Markov state model can better account for the single-molecule time-series data: The improvement in reproducing the smFRET histogram of 50 uS as shown in Figure 3 is dramatic. It further revealed a different folding pathway of the WW-domain, as well as a different transition state ensemble.</p><p>The approach of using MD-derived MSM as basis and initial input for likelihood optimization with respect to smFRET data is very interesting and novel, and the calculations and uncertainty analysis were conducted carefully. The insight into the folding mechanism is very interesting. However, quite a few outstanding issues, including some serious concerns, remain to be addressed to assess whether publication is warranted.</p><p>Essential revisions:</p><p>1) An overall question about the current practice of Markov state models in MD-based protein folding studies. Assuming both simulation and experimental studies are under the same conditions (salt, dye, temperature, etc.), they are probing the same underlying physical process. Therefore, they should reflect the same ground-truth reality. As MD can provide atomistic details within the time scale of simulation, MD studies should provide far more details than smFRET. However, this is not the case. Rather, MD simulation cannot stand on its own, and needs to be corrected by smFRET. As described by the authors, the MSM is shifted before and after incorporating smFRET data. The authors showed that the discrete states are very different when smFRET data are brought into consideration. While it is not explicitly stated (please clarify), it seems that the refined Markov states are derived from the original Markov states by clustering of MD trajectories, but updated with new equilibrium probability (hence different bubble areas in Figure 2) and new transition rates. How can the ground truth, for example, equilibrium probabilities of the Markov states, change if it is examined one way (by MD) or another way (MD+smFRET)? This would suggest there is no objective ground truth that is accessible by current MD simulations.</p><p>Lending support to this conclusion, is the discussion you provided, that in other studies prior to this manuscript, the number of discrete states and the nature of these states are all malleable, depending on which metric one examines (RMSD or contact map). This would again suggest that there is no objective truth in determining what constitutes a set of discrete states that are Markovian and what their transition rates are. Rather, all depends on which metric and/or which additional experimental data one chooses to examine.</p><p>One cannot help but speculate: would one expect some other alternative discrete Markovian states different from the currently reported ones to emerge, when other types of experimental time series data other than \epsilon is incorporated. Is it likely that yet more different Markovian states, different dynamics of transition rates, different folding dynamics, and different transition state ensembles will be identified, all for the same WW-domain under the same condition (dye, pH, salt, temperature, if well controlled)?</p><p>This aspect of shifting ground truth in MD simulation and Markov state modeling is rather unsettling. A pessimistic, but not unreasonable, view is that without a principled approach in defining true reaction coordinates for protein folding one has to make do with rather ad hoc and heuristic approaches in defining the discrete states with unexamined consequences, and hence this unsettling aspect may be with us for a long while and the truth may be elusive.</p><p>Here is a suggestion in this respect: The authors employ Equation 5 for a model of FRET efficiency, however, more detailed models exist such as <ext-link ext-link-type="uri" xlink:href="http://aip.scitation.org/doi/pdf/10.1063/1.3230974">http://aip.scitation.org/doi/pdf/10.1063/1.3230974</ext-link></p><p>The authors could evaluate their approach and determine if a more detailed model might be justified or needed in making contact with experimental measurements.</p><p>2) While concern 1 is more general, there is another question more specific to connecting MD and the smFRET measurements. It will be necessary for the authors to show how well the HMM learned T(\tau) conform with MD simulation generated T(\tau) after the refined discrete states are obtained, in a statistically significant way. For example, the authors should compare the HMM rates and the MD rates for the subsets of state-state transitions with the highest and relevant lowest rates among the 87x87 parameters. In addition, the flux and pathway analysis should also be carried out using MD-derived rates after the refined states are obtained by the HMM model, for key paths carrying most of the flux, and compared with the analysis using HMM rates. The authors may have already done some of these in the transition state ensemble analysis, and may already have all necessary data.</p><p>This is important for validating the connection between the sm-FRET (HMM modeling) time series and the MD trajectories the authors are proposing. It would be fantastic if all works out, as this would naturally suggest that in the future one no longer needs to do MD simulation. Rather, one could use smFRET to fit dynamic rates, as long as the discrete states can be obtained, for example, by some other means. However, one should be cautious about being overly optimistic here, as there are significant problems in the enormous search space of very high dimension. It will be very interesting if the authors can show that the HMM rates and MD rates after refinement are the same.</p><p>3) Potential over-fitting remains a concern, as there is a large number (87x87 = 7,569) parameters that need to be fitted. While the authors qualitatively compared results using each half of the data through plotting, it would be necessary to do some cross-validation tests, which are standard in machine learning. Specifically, the authors could use (n-1)/n balanced smFRET and MD data (e.g. similar number of folding trajectories) to identify refined states, and estimating \tau values, then test whether the remaining 1/n data falls within these defined states, and whether the unseen epsilon histograms can be reproduced accurately.</p><p>4) In Equation 5, the average values are used in calculating \epsilon. It seems that kappa has little difference at different regions of Q. Is the difference along the dimension of \epsilon that is used for clustering due to difference in distances <italic>r(s<sub>i</sub></italic>)? It will be helpful to also show both mean and variance of <italic>r(s<sub>i</sub></italic>) for each of the major discrete states, and justify whether the degree of in-cluster and between-cluster heterogeneity/homogeneity conforms to the Markovian assumption of each discrete state. This relates to the issue of validating the defined discrete states.</p><p>5) The calculations of FRET efficiencies from MD trajectories need to be stated explicitly. Furthermore, the estimation of FRET efficiencies from experimentally measured photon sequences also needs to be presently clearly. The latter in fact is a long-standing issue in the single-molecule community, for example, the time binning convention and the information-base binning by Haw Yang.</p><p>6) It is not obvious how the folding pathways were decomposed into individual pathways for both MSM models. How this procedure was conducted would critically impact the interpretation of results. This part thus needs careful and clear explanation.</p><p>7) Certain key references of interring dynamics from smFRET trajectories were missed in the context of this work, such as Haas et al., 2013.</p><p>8) Obtaining a solution of similar likelihood value starting from a random matrix is a bit worrisome. Can the authors elaborate more on how this model was ruled out? Furthermore, the convergence of likelihood optimization should also be discussed to reveal the robustness of this approach.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Linking time series of single-molecule experiments with molecular dynamics simulations by machine learning&quot; for further consideration at <italic>eLife</italic>. Your revised article has been favorably evaluated by Arup Chakraborty (Senior Editor), a Reviewing Editor, and three reviewers.</p><p>The manuscript has been improved but there are some remaining issues that need to be addressed before acceptance, as outlined below:</p><p>Overview:</p><p>The unsettling aspects of shifting ground truth, or rather, the lack of ground truth remains. This is, however, an issue the community of protein folding simulations has to deal with.</p><p>Using <italic>Q</italic> as an adequate reaction coordinate is similarly problematic and inadequate, as <italic>Q</italic> is no substitute to reaction coordinates in the strict sense of earlier classic studies of Chandler and Dinner. But this again is a community problem, and we do not wish to specifically penalize the authors of the current work. Therefore, we accept the authors' arguments, although at least one of the reviewers had some fundamental concerns about the entire set of approaches in this area.</p><p>Specific points to address:</p><p>1) There is one issue that the authors did not provide answers to but they can easily do, namely, regarding the question of providing details of the 87x87 rates from the Hidden Markov model and the corresponding rates from MD simulation. It will be necessary to make first a general statement on how similar/different these two sets of matched/paired rates are, and second, provide details, e.g., in the Appendix, with side-by-side or overlaid histograms. If these two distributions are similar, it would be a comforting result. However, even if these two distributions do not agree, it will be important for readers to know this fact so they can directly draw their own inferences. This can be easily done with existing data.</p><p>2) A grammar and expression overhaul is highly recommended to enhance the readability of the work.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.32668.022</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) An overall question about the current practice of Markov state models in MD-based protein folding studies. Assuming both simulation and experimental studies are under the same conditions (salt, dye, temperature, etc.), they are probing the same underlying physical process. Therefore, they should reflect the same ground-truth reality. As MD can provide atomistic details within the time scale of simulation, MD studies should provide far more details than smFRET. However, this is not the case. Rather, MD simulation cannot stand on its own, and needs to be corrected by smFRET. As described by the authors, the MSM is shifted before and after incorporating smFRET data. The authors showed that the discrete states are very different when smFRET data are brought into consideration. While it is not explicitly stated (please clarify), it seems that the refined Markov states are derived from the original Markov states by clustering of MD trajectories, but updated with new equilibrium probability (hence different bubble areas in Figure 2) and new transition rates. How can the ground truth, for example, equilibrium probabilities of the Markov states, change if it is examined one way (by MD) or another way (MD+smFRET)? This would suggest there is no objective ground truth that is accessible by current MD simulations.</p></disp-quote><p>We agree with the reviewers that both simulation and experimental data should reflect the same ground-truth reality. However, despite improvements over the decades, force field parameters used in MD simulation are not perfectly correct as reaching the ground-truth reality. In particular, while the local interactions are well described by the current force fields it is still difficult to reproduce the energetic balance between global states (such as unfolded and folded states). Indeed, Piana and coworkers (Piana et al., 2011) showed, in their protein folding simulation study, the folding mechanism of the villin headpiece depends substantially on the choice of force field. It is also known that most force fields produce unfolded states that are more compact and structured than those suggested experimentally (Piana et al., 2014). As suggested by these studies, a subtle free energy balance between the unfolded and folded states is crucial for determining the folding mechanism. Considering this background, the motivation of this work is to make MD data toward the ground-truth reality in a data-driven way. We reweighted the transition probabilities by using smFRET data to achieve the subtle balance in free energy. In the future study, using the free energy landscape and folding pathways obtained by our scheme, it is possible to improve force field parameters closer to the ground truth reality. According to this discussion, we have revised the Introduction section (second paragraph).</p><disp-quote content-type="editor-comment"><p>Lending support to this conclusion, is the discussion you provided, that in other studies prior to this manuscript, the number of discrete states and the nature of these states are all malleable, depending on which metric one examines (RMSD or contact map). This would again suggest that there is no objective truth in determining what constitutes a set of discrete states that are Markovian and what their transition rates are. Rather, all depends on which metric and/or which additional experimental data one chooses to examine.</p><p>One cannot help but speculate: would one expect some other alternative discrete Markovian states different from the currently reported ones to emerge, when other types of experimental time series data other than \epsilon is incorporated. Is it likely that yet more different Markovian states, different dynamics of transition rates, different folding dynamics, and different transition state ensembles will be identified, all for the same WW-domain under the same condition (dye, pH, salt, temperature, if well controlled)?</p><p>This aspect of shifting ground truth in MD simulation and Markov state modeling is rather unsettling. A pessimistic, but not unreasonable, view is that without a principled approach in defining true reaction coordinates for protein folding one has to make do with rather ad hoc and heuristic approaches in defining the discrete states with unexamined consequences, and hence this unsettling aspect may be with us for a long while and the truth may be elusive.</p></disp-quote><p>We agree with the reviewers that Markov state modeling depends on the choice of coordinate or metric one examines. It generally quite difficult to find the true reaction coordinate for defining states in complex systems. On the other hand, in the case of protein folding problem, theoretical and simulation studies over the decades have shown that the fraction of native contacts, <italic>Q</italic>, is the best reaction coordinate for describing folding process. For example, Best and coworkers, by analyzing folding MD simulation data of various proteins, showed that <italic>Q</italic> successfully captures the transition states for all the proteins (Best, Hummer and Eaton, 2013). The FRET efficiency \epsilon was chosen for matching with smFRET data and for differentiating the compact and extended states. These two coordinates (<italic>Q</italic> and \epsilon) are necessary and sufficient for describing the progress of folding as well as refining the bias of the current force field parameters toward compact structures. Also, since the structure of WW domain is rather simple (three-strands, betasheet-only), these coordinates are enough for uniquely identifying tertiary structures. Considering these reasons and the validation through the comparison with the Phi-value analysis, we think that the picture obtained by the current MSM may be the robust against the choice of coordinates. We have added this discussion in the Results section (subsection “Molecular dynamics simulations”, second paragraph).</p><disp-quote content-type="editor-comment"><p>Here is a suggestion in this respect: The authors employ Equation 5 for a model of FRET efficiency, however, more detailed models exist such as <ext-link ext-link-type="uri" xlink:href="http://aip.scitation.org/doi/pdf/10.1063/1.3230974">http://aip.scitation.org/doi/pdf/10.1063/1.3230974</ext-link></p><p>The authors could evaluate their approach and determine if a more detailed model might be justified or needed in making contact with experimental measurements.</p></disp-quote><p>We thank the reviewers for letting us know the important paper. Following the reviewers’ suggestion, we applied our scheme with the new definition for FRE efficiency 𝜀 = 1⁄[Λ + (𝑟⁄𝑅<sub>*</sub>)<sup>-</sup>] where Λ &gt; 1. Here, we optimized the likelihood function with Λ = 1.065, a value used in the paper. The result has been added as Figure 2—figure supplement 6. In the figure, although the transition states look more stabilized, the locations of stabilized states are qualitatively same as the original one (Λ = 1.0). This suggests that the story of the manuscript would be robust against the definition of ε (subsection “Markov state model and semi-supervised learning”, seventh paragraph).</p><disp-quote content-type="editor-comment"><p>2) While concern 1 is more general, there is another question more specific to connecting MD and the smFRET measurements. It will be necessary for the authors to show how well the HMM learned T(\tau) conform with MD simulation generated T(\tau) after the refined discrete states are obtained, in a statistically significant way. For example, the authors should compare the HMM rates and the MD rates for the subsets of state-state transitions with the highest and relevant lowest rates among the 87x87 parameters. In addition, the flux and pathway analysis should also be carried out using MD-derived rates after the refined states are obtained by the HMM model, for key paths carrying most of the flux, and compared with the analysis using HMM rates. The authors may have already done some of these in the transition state ensemble analysis, and may already have all necessary data.</p><p>This is important for validating the connection between the sm-FRET (HMM modeling) time series and the MD trajectories the authors are proposing. It would be fantastic if all works out, as this would naturally suggest that in the future one no longer needs to do MD simulation. Rather, one could use smFRET to fit dynamic rates, as long as the discrete states can be obtained, for example, by some other means. However, one should be cautious about being overly optimistic here, as there are significant problems in the enormous search space of very high dimension. It will be very interesting if the authors can show that the HMM rates and MD rates after refinement are the same.</p></disp-quote><p>In this study, the states were defined through the structural clustering of 400 microseconds MD simulation data. As 400 microseconds should be long enough for sampling all possible structures of WW domain, we think that the defined states are transferable during the HMM refinement. We would like to point that we already characterized the difference in T(\tau) from the MD and HMM refinement: Figure 4 shows the result of flux analysis of folding trajectories, which reveals the bottleneck of folding (the transition state ensemble). Figure 5 shows the results of the pathway analysis, which reveals folding pathways with largest fluxes.</p><p>As the reviewers pointed out, it would be nice if all transition probabilities are accurately estimated by the HMM from smFRET data. However, as shown by the HMM refinement starting from a random matrix (in response to comment 8), it is still difficult to estimate accurate kinetics along the <italic>Q</italic> axis from the limited number of smFRET observations. This suggests an importance of complementary use of both data (MD and smFRET), as proposed by our scheme (the MD information as the initial condition for HMM).</p><disp-quote content-type="editor-comment"><p>3) Potential over-fitting remains a concern, as there is a large number (87x87 = 7,569) parameters that need to be fitted. While the authors qualitatively compared results using each half of the data through plotting, it would be necessary to do some cross-validation tests, which are standard in machine learning. Specifically, the authors could use (n-1)/n balanced smFRET and MD data (e.g. similar number of folding trajectories) to identify refined states, and estimating \tau values, then test whether the remaining 1/n data falls within these defined states, and whether the unseen epsilon histograms can be reproduced accurately.</p></disp-quote><p>We thank the reviewers for the important suggestion. Following the reviewers’ comment, we have performed a <italic>k</italic>-fold cross validation test (with <italic>k</italic>=4) by partitioning the smFRET data set into <italic>k</italic> subsets (k-1 subsets as the training data, a single subset as the test data). We have evaluated the mean squared errors between two normalized FRET efficiency histograms calculated from the model and the subsets of smFRET data. The prediction error (the so-called cross validation error) for the test data was found to be 11.8 × 10<sup>78</sup>, which is quite small. This suggests that the overfitting may not be a major issue in our modeling. We have added this result (Figure 3—figure supplement 1) in the Materials and methods section (subsection “Analysis of Markov state models”, second paragraph).</p><disp-quote content-type="editor-comment"><p>4) In Equation 5, the average values are used in calculating \epsilon. It seems that kappa has little difference at different regions of Q. Is the difference along the dimension of \epsilon that is used for clustering due to difference in distances r(s<sub>i</sub>)? It will be helpful to also show both mean and variance of r(s<sub>i</sub>) for each of the major discrete states, and justify whether the degree of in-cluster and between-cluster heterogeneity/homogeneity conforms to the Markovian assumption of each discrete state. This relates to the issue of validating the defined discrete states.</p></disp-quote><p>Following the reviewers’ comment, we have calculated the orientation factor k<sup>2</sup> along the e (FRET efficiency) axis. The average (standard deviation) in each region was k<sup>2</sup> = 0.66 (0.69) for e = 0.00-0.25, 0.64 (0.68) for e = 0.25-0.50, 0.61 (0.66) for e = 0.50-0.75, and 0.63 (0.64) for e = 0.75-1.00. Since the orientation factor k<sup>2</sup> show little dependence on both <italic>Q</italic> and e axes, it would be reasonable to use the isotropic average approximation as employed in the manuscript. We have added this result in the Materials and methods section (subsection “Markov state model and semi-supervised learning”, third paragraph).</p><p>Also, we have calculated both mean and variance of donor-acceptor distance <italic>r(s<sub>i</sub></italic>) for each state. It has been plotted in the 2D space spanned by <italic>Q</italic> and <italic>r</italic> (added as Figure 2—figure supplement 2). The figure shows that there are distance gaps between states, which is supportive for the Markovian assumption for the states. Large standard deviations are observed within states of small donor-acceptor distances. This is due to the worsening of spatial resolution in FRET efficiency when <italic>r(s<sub>i</sub></italic>) is small compared to <italic>R</italic><sub>0</sub> as discussed in the information-binning study by Haw-Yang and coworkers (Watkins and Yang, 2004). We have added this result (Figure 2—figure supplement 2) in the Materials and methods section (subsection “Molecular dynamics simulations”, last paragraph).</p><disp-quote content-type="editor-comment"><p>5) The calculations of FRET efficiencies from MD trajectories need to be stated explicitly. Furthermore, the estimation of FRET efficiencies from experimentally measured photon sequences also needs to be presently clearly. The latter in fact is a long-standing issue in the single-molecule community, for example, the time binning convention and the information-base binning by Haw Yang.</p></disp-quote><p>We have explicitly described the calculations of FRET efficiencies from MD trajectories and photon sequences in the Results and Materials and methods sections. In particular, we have now used different terms for two FRET efficiencies (‘FRET efficiency \epsilon’ estimated from MD, ‘Measured FRET efficiency <italic>E</italic>’ from photon counts). We here used the conventional constant-time binning because the Markov state modeling is based on the constant-time binning. As a future direction, it is promising to apply a continuous-time Markov modeling (McGibbon and Pande, 2015), which may allow us to use the information-based binning (Watkins and Yang, 2004) or photon-by-photon analysis (Gopich and A. Szabo, 2009). We have described this direction in the Discussion section, adding citations for these works (fifth paragraph).</p><disp-quote content-type="editor-comment"><p>6) It is not obvious how the folding pathways were decomposed into individual pathways for both MSM models. How this procedure was conducted would critically impact the interpretation of results. This part thus needs careful and clear explanation.</p></disp-quote><p>We have described how the folding pathways were decomposed and its impact in the Results and Materials and methods sections. In the Results section we have added the following:</p><p>“The flux of folding trajectories was decomposed into individual pathways for both models (Figures 5A and 5B). […] The figures show dominant folding pathways with each of largest fluxes contributing to 50% of the total flux.”</p><disp-quote content-type="editor-comment"><p>7) Certain key references of interring dynamics from smFRET trajectories were missed in the context of this work, such as Haas et al., 2013.</p></disp-quote><p>We thank the reviewers for letting us know the important paper. We have added following references for recent advances in extracting more dynamical and structural information from smFRET trajectory (Introduction, first paragraph):</p><p>Haas, Yang and Chu, 2013; Matsunaga, Kidera, and Sugita, 2015; Sun, Morrell and Yang, 2016; Hoefling et al., 2011.</p><disp-quote content-type="editor-comment"><p>8) Obtaining a solution of similar likelihood value starting from a random matrix is a bit worrisome. Can the authors elaborate more on how this model was ruled out? Furthermore, the convergence of likelihood optimization should also be discussed to reveal the robustness of this approach.</p></disp-quote><p>We have extended the optimization calculation of a random matrix and examined the convergence of the log likelihood function. The result has been added as Figure 2—figure supplement 8. In the figure, the optimization of the log likelihood from random matrix looks stacked after 10000 iterations and its value is lower than that of MD data. This suggests that the optimization gets trapped in a local minimum in the parameter space. From these observations, we conclude that the model from a random matrix could be ruled out, or at least, global optimization of a random matrix is practically very inefficient. We have added this result (Figure 2—figure supplement 8) in the Materials and methods section (subsection “Markov state model and semi-supervised learning”, last paragraph).</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><disp-quote content-type="editor-comment"><p>The manuscript has been improved but there are some remaining issues that need to be addressed before acceptance, as outlined below:</p><p>Overview:</p><p>The unsettling aspects of shifting ground truth, or rather, the lack of ground truth remains. This is, however, an issue the community of protein folding simulations has to deal with.</p><p>Using Q as an adequate reaction coordinate is similarly problematic and inadequate, as Q is no substitute to reaction coordinates in the strict sense of earlier classic studies of Chandler and Dinner. But this again is a community problem, and we do not wish to specifically penalize the authors of the current work. Therefore, we accept the authors' arguments, although at least one of the reviewers had some fundamental concerns about the entire set of approaches in this area.</p><p>Specific points to address:</p><p>1) There is one issue that the authors did not provide answers to but they can easily do, namely, regarding the question of providing details of the 87x87 rates from the Hidden Markov model and the corresponding rates from MD simulation. It will be necessary to make first a general statement on how similar/different these two sets of matched/paired rates are, and second, provide details, e.g., in the Appendix, with side-by-side or overlaid histograms. If these two distributions are similar, it would be a comforting result. However, even if these two distributions do not agree, it will be important for readers to know this fact so they can directly draw their own inferences. This can be easily done with existing data.</p></disp-quote><p>Following the reviewers’ comment, we have added new plots comparing the rates of the two MSMs as Figure 2—figure supplement 4.</p><p>First (in panel A), we decomposed each transition probability matrix to obtain characteristic time scales before and after the hidden Markov modeling. We can see that the slowest time scale increases from 2.6 microseconds to 100 microseconds after the hidden Markov modeling. These time scales are related to folding/unfolding transitions of WW domain. Generally, simulation time scale is faster than experiments because of lower viscosity of TIP3P water model. This gap was improved by the information of the single-molecule experimental data.</p><p>In panel B, 87x87 <italic>T<sub>ij</sub></italic> rates before and after the hidden Markov modeling are directly compared in a scatter plot where each rate is colored using the FRET efficiency e<sub>i</sub>. <italic>T<sub>ij</sub></italic> rates from states with high FRET efficiencies are well correlated with each other. This means that <italic>T<sub>ij</sub></italic> rates between compact states derived from MD simulations are consistent with the experimental data. In contrast, <italic>T<sub>ij</sub></italic> rates from states with middle or low FRET efficiencies are less correlated. This means that hidden Markov modeling mainly “refined” the rates between elongated states.</p><p>In this revision, we have added these explanations in the main text.</p><disp-quote content-type="editor-comment"><p>2) A grammar and expression overhaul is highly recommended to enhance the readability of the work.</p></disp-quote><p>In this revision, a native speaker has carefully edited the language. We have also checked a number of expressions.</p></body></sub-article></article>