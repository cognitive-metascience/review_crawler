<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">27702</article-id><article-id pub-id-type="doi">10.7554/eLife.27702</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Automated long-term recording and analysis of neural activity in behaving animals</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-86554"><name><surname>Dhawale</surname><given-names>Ashesh K</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-7438-1115</contrib-id><email>ashesh.dhawale@gmail.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-86555"><name><surname>Poddar</surname><given-names>Rajesh</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-86556"><name><surname>Wolff</surname><given-names>Steffen BE</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-86557"><name><surname>Normand</surname><given-names>Valentin A</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-86558"><name><surname>Kopelowitz</surname><given-names>Evi</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-15316"><name><surname>Ölveczky</surname><given-names>Bence P</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2499-2705</contrib-id><email>olveczky@fas.harvard.edu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Department of Organismic and Evolutionary Biology</institution><institution>Harvard University</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Center for Brain Science</institution><institution>Harvard University</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-14601"><name><surname>King</surname><given-names>Andrew J</given-names></name><role>Reviewing Editor</role><aff><institution>University of Oxford</institution><country>United Kingdom</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>08</day><month>09</month><year>2017</year></pub-date><pub-date pub-type="collection"><year>2017</year></pub-date><volume>6</volume><elocation-id>e27702</elocation-id><history><date date-type="received" iso-8601-date="2017-04-11"><day>11</day><month>04</month><year>2017</year></date><date date-type="accepted" iso-8601-date="2017-08-24"><day>24</day><month>08</month><year>2017</year></date></history><permissions><copyright-statement>© 2017, Dhawale et al</copyright-statement><copyright-year>2017</copyright-year><copyright-holder>Dhawale et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-27702-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.27702.001</object-id><p>Addressing how neural circuits underlie behavior is routinely done by measuring electrical activity from single neurons in experimental sessions. While such recordings yield snapshots of neural dynamics during specified tasks, they are ill-suited for tracking single-unit activity over longer timescales relevant for most developmental and learning processes, or for capturing neural dynamics across different behavioral states. Here we describe an automated platform for continuous long-term recordings of neural activity and behavior in freely moving rodents. An unsupervised algorithm identifies and tracks the activity of single units over weeks of recording, dramatically simplifying the analysis of large datasets. Months-long recordings from motor cortex and striatum made and analyzed with our system revealed remarkable stability in basic neuronal properties, such as firing rates and inter-spike interval distributions. Interneuronal correlations and the representation of different movements and behaviors were similarly stable. This establishes the feasibility of high-throughput long-term extracellular recordings in behaving animals.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>neural recordings</kwd><kwd>systems neuroscience</kwd><kwd>behavior</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Rat</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution>Star Family Challenge Award</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Ölveczky</surname><given-names>Bence P</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000854</institution-id><institution>Human Frontier Science Program</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Wolff</surname><given-names>Steffen BE</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100009559</institution-id><institution>Life Sciences Research Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Dhawale</surname><given-names>Ashesh K</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100008601</institution-id><institution>Charles A. King Trust</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Dhawale</surname><given-names>Ashesh K</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000065</institution-id><institution>National Institute of Neurological Disorders and Stroke</institution></institution-wrap></funding-source><award-id>R01 NS099323-02</award-id><principal-award-recipient><name><surname>Ölveczky</surname><given-names>Bence P</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A new automated system for recording and analyzing neural activity in behaving animals over months-long time-scales offers new perspectives on how neural circuits underlie processes such as learning, development, and recovery from brain injury.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>The goal of systems neuroscience is to understand how neural activity generates behavior. A common approach is to record from neuronal populations in targeted brain areas during experimental sessions while subjects perform designated tasks. Such intermittent recordings provide brief ‘snapshots’ of task-related neural dynamics (<xref ref-type="bibr" rid="bib46">Georgopoulos et al., 1986</xref>; <xref ref-type="bibr" rid="bib54">Hanks et al., 2015</xref>; <xref ref-type="bibr" rid="bib89">Murakami et al., 2014</xref>), but fail to address how neural activity is modulated outside of task context and across a wide range of active and inactive behavioral states, (for exceptions see [<xref ref-type="bibr" rid="bib4">Ambrose et al., 2016</xref>; <xref ref-type="bibr" rid="bib39">Evarts, 1964</xref>; <xref ref-type="bibr" rid="bib53">Gulati et al., 2014</xref>; <xref ref-type="bibr" rid="bib56">Hengen et al., 2016</xref>; <xref ref-type="bibr" rid="bib59">Hirase et al., 2001</xref>; <xref ref-type="bibr" rid="bib74">Lin et al., 2006</xref>; <xref ref-type="bibr" rid="bib87">Mizuseki and Buzsáki, 2013</xref>; <xref ref-type="bibr" rid="bib110">Santhanam et al., 2007</xref>; <xref ref-type="bibr" rid="bib131">Wilson and McNaughton, 1994</xref>]). Furthermore, intermittent recordings are ill-suited for reliably tracking the same neurons over time (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib83">McMahon et al., 2014a</xref>; <xref ref-type="bibr" rid="bib110">Santhanam et al., 2007</xref>; <xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>), making it difficult to discern how neural activity and task representations are shaped by developmental and learning processes that evolve over longer timescales (<xref ref-type="bibr" rid="bib45">Ganguly et al., 2011</xref>; <xref ref-type="bibr" rid="bib65">Jog et al., 1999</xref>; <xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>; <xref ref-type="bibr" rid="bib80">Marder and Goaillard, 2006</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib116">Singer et al., 2013</xref>).</p><p>Addressing such fundamental questions would be greatly helped by recording neural activity and behavior continuously over days and weeks in freely moving animals. Such longitudinal recordings would allow the activity of single neurons to be followed over more trials, experimental conditions, and behavioral states, thus increasing the power with which inferences about neural function can be made (<xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>; <xref ref-type="bibr" rid="bib83">McMahon et al., 2014a</xref>). Recording continuously outside of task context would also reveal how task-related neural dynamics and behavior are affected by long-term performance history (<xref ref-type="bibr" rid="bib8">Bair et al., 2001</xref>; <xref ref-type="bibr" rid="bib19">Chaisanguanthum et al., 2014</xref>; <xref ref-type="bibr" rid="bib88">Morcos and Harvey, 2016</xref>), changes in internal state (<xref ref-type="bibr" rid="bib6">Arieli et al., 1996</xref>), spontaneous expression of innate behaviors (<xref ref-type="bibr" rid="bib2">Aldridge and Berridge, 1998</xref>), and replay of task-related activity in different behavioral contexts (<xref ref-type="bibr" rid="bib18">Carr et al., 2011</xref>; <xref ref-type="bibr" rid="bib41">Foster and Wilson, 2006</xref>; <xref ref-type="bibr" rid="bib53">Gulati et al., 2014</xref>; <xref ref-type="bibr" rid="bib131">Wilson and McNaughton, 1994</xref>).</p><p>While in vivo calcium imaging allows the same neuronal population to be recorded intermittently over long durations (<xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib73">Liberti et al., 2016</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>; <xref ref-type="bibr" rid="bib135">Ziv et al., 2013</xref>), photobleaching, phototoxicity, and cytotoxicity (<xref ref-type="bibr" rid="bib50">Grienberger and Konnerth, 2012</xref>; <xref ref-type="bibr" rid="bib76">Looger and Griesbeck, 2012</xref>), as well as the requirements for head-restraint in many versions of such experiments (<xref ref-type="bibr" rid="bib32">Dombeck et al., 2007</xref>; <xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>), make the method unsuitable for continuous long-term recordings. Calcium imaging also has relatively poor temporal resolution (<xref ref-type="bibr" rid="bib50">Grienberger and Konnerth, 2012</xref>; <xref ref-type="bibr" rid="bib127">Vogelstein et al., 2009</xref>), limiting its ability to resolve precise spike patterns (<xref ref-type="bibr" rid="bib128">Vogelstein et al., 2010</xref>; <xref ref-type="bibr" rid="bib133">Yaksi and Friedrich, 2006</xref>) (but see <xref ref-type="bibr" rid="bib48">Gong et al., 2015</xref> for an alternative high-speed voltage sensor). In contrast, extracellular recordings using electrode arrays can measure the activity of many single neurons simultaneously with sub-millisecond resolution (<xref ref-type="bibr" rid="bib15">Buzsáki, 2004</xref>). Despite the unique benefits of continuous (24/7) long-term electrical recordings, they are not routinely performed. A major reason is the inherently laborious and difficult process of reliably and efficiently tracking the activity of single units from such longitudinal datasets (<xref ref-type="bibr" rid="bib36">Einevoll et al., 2012</xref>), wherein firing rates of individual neurons can vary over many orders of magnitude (<xref ref-type="bibr" rid="bib62">Hromádka et al., 2008</xref>; <xref ref-type="bibr" rid="bib87">Mizuseki and Buzsáki, 2013</xref>) and spike waveforms change over time (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib94">Okun et al., 2016</xref>; <xref ref-type="bibr" rid="bib110">Santhanam et al., 2007</xref>; <xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>).</p><p>To address this, we designed and deployed a modular and low-cost recording system that enables fully automated long-term continuous extracellular recordings from large numbers of neurons in freely behaving rodents engaged in natural behaviors and prescribed tasks. To efficiently parse the large streams of neural data, we developed an unsupervised spike-sorting algorithm that automatically processes the raw data from electrode array recordings, and clusters spiking events into putative single units, tracking their activity over long timescales. We validated our algorithm on ground-truth datasets and found that it surpassed the performance of spike-sorting methods that assume stationarity of spike waveforms. We used this integrated system to record from motor cortex and striatum continuously over several months, and address an ongoing debate (<xref ref-type="bibr" rid="bib23">Clopath et al., 2017</xref>; <xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>) about whether the brain is stable (<xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib49">Greenberg and Wilson, 2004</xref>; <xref ref-type="bibr" rid="bib84">McMahon et al., 2014b</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>) or not (<xref ref-type="bibr" rid="bib17">Carmena et al., 2005</xref>; <xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib73">Liberti et al., 2016</xref>; <xref ref-type="bibr" rid="bib79">Mankin et al., 2012</xref>; <xref ref-type="bibr" rid="bib88">Morcos and Harvey, 2016</xref>; <xref ref-type="bibr" rid="bib105">Rokni et al., 2007</xref>; <xref ref-type="bibr" rid="bib135">Ziv et al., 2013</xref>) over long timescales, an issue that has been previously addressed using intermittent calcium imaging (<xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib73">Liberti et al., 2016</xref>; <xref ref-type="bibr" rid="bib88">Morcos and Harvey, 2016</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>; <xref ref-type="bibr" rid="bib135">Ziv et al., 2013</xref>) and extracellular recordings (<xref ref-type="bibr" rid="bib17">Carmena et al., 2005</xref>; <xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib49">Greenberg and Wilson, 2004</xref>; <xref ref-type="bibr" rid="bib79">Mankin et al., 2012</xref>; <xref ref-type="bibr" rid="bib84">McMahon et al., 2014b</xref>; <xref ref-type="bibr" rid="bib105">Rokni et al., 2007</xref>). Our continuous, long-term recordings revealed a remarkable stability in basic neuronal properties of isolated single units, such as firing rates and inter-spike interval distributions. Interneuronal correlations and movement tuning across a range of behaviors were similarly stable over several weeks.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Infrastructure for automated long-term neural recordings in behaving animals</title><p>We developed experimental infrastructure for continuous long-term extracellular recordings in behaving rodents (<xref ref-type="fig" rid="fig1">Figure 1A</xref>, <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Our starting point was ARTS, a fully Automated Rodent Training System we previously developed (<xref ref-type="bibr" rid="bib98">Poddar et al., 2013</xref>). In ARTS, the animal’s home-cage doubles as the experimental chamber, making it a suitable platform for continuous long-term recordings.</p><fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.002</object-id><label>Figure 1.</label><caption><title>Long-term continuous neural and behavioral recordings in behaving rodents pose challenges for traditional methods of spike-sorting.</title><p>(<bold>A</bold>) Adapting our automated rodent training system (ARTS) for long-term electrophysiology. Rats engage in natural behaviors and prescribed motor tasks in their home-cages, while neural data is continuously acquired from implanted electrodes. The tethering cable connects the head-stage to a commutator mounted on a carriage that moves along a low-friction linear slide. The commutator-carriage is counterweighted to eliminate slack in the tethering cable. Behavior is continuously monitored and recorded using a camera and a 3-axis accelerometer. (<bold>B</bold>) Example of a recording segment showing high-resolution behavioral and neural data simultaneously acquired from a head-mounted 3-axis accelerometer (left) and a tetrode (right) implanted in the motor cortex, respectively. (Inset) A 2 ms zoom-in of the tetrode recording segment. (<bold>C</bold>) Drift in spike waveforms over time make it difficult to identify the same units across discontinuous recording sessions. Peak-to-peak spike amplitudes (top) and spike waveforms (bottom) for four distinct units on the same tetrode for hour-long excerpts, at 24 hr intervals, from a representative long-term continuous recording in the rat motor cortex 4 months after electrode implantation. Different units are indicated by distinct colors. We tracked units over days using a novel spike-sorting algorithm we developed to cluster continuously recorded neural data (see <xref ref-type="fig" rid="fig2">Figure 2</xref>). (<bold>D</bold>) Continuous extracellular recordings pose challenges for spike-sorting methods assuming stationarity in spike shapes. (Top) Peak-to-peak spike amplitudes of two continuously recorded units (same as in C) accumulated over 1 hr (left), 25 hr (middle) and 49 hr (right). (Bottom) Drift in spike waveforms can lead to inappropriate splitting (middle, right panels) of single-units and/or merging (right panel) of distinct units, even though these two units are separable in the hour-long ‘sessions’ shown in C.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig1-v2"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.003</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Overview of custom-built hardware for extracellular recordings in behaving rodents.</title><p>Scalable low-cost signal processing and recording hardware. Neural activity is recorded using an array of 16 tetrodes. A headstage continuously filters, amplifies, and digitizes the measured signals and sends them over to a digital interface board via a commutator. The digital interface board packages the data into USB packets and streams it to a custom-built 60 TB storage server.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig1-figsupp1-v2"/></fig></fig-group><p>To ensure that animals remain reliably and comfortably connected to the recording apparatus over months-long experiments, we designed a variation on the standard tethering system that allows experimental subjects to move around freely while preventing them from reaching for (and chewing) the signal cable (<xref ref-type="fig" rid="fig1">Figure 1A</xref>; see Materials and methods for details). Our solution connects the implanted recording device via a cable to a passive commutator (<xref ref-type="bibr" rid="bib120">Sutton and Miller, 1963</xref>) attached to a carriage that rides on a low-friction linear slide. The carriage is counterweighted by a pulley, resulting in a small constant upwards force (&lt;10 g) on the cable that keeps it taut and out of the animal’s reach without unduly affecting its movements. The recording extension can easily be added to our custom home-cages, allowing animals that have been trained, prescreened, and deemed suitable for recordings to be implanted with electrode drives, and placed back into their familiar training environment (i.e. home-cage) for recordings.</p><p>Extracellular signals recorded in behaving animals from 16 implanted tetrodes at 30 kHz sampling rate are amplified and digitized on a custom-designed head-stage (<xref ref-type="fig" rid="fig1">Figure 1B</xref> and <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>, Materials and methods). To characterize the behavior of animals throughout the recordings, the head-stage features a 3-axis accelerometer that measures head movements at high temporal resolution (<xref ref-type="bibr" rid="bib125">Venkatraman et al., 2010</xref>) (<xref ref-type="fig" rid="fig1">Figure 1A–B</xref>). We also record continuous video of the rats’ behavior with a wide-angle camera (30 fps) above the cage (Materials and methods). The large volumes of behavioral and neural data (~0.5 TB/day/rat) are streamed to custom-built high-capacity servers (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>).</p></sec><sec id="s2-2"><title>A fast automated spike tracker (FAST) for long-term neural recordings</title><p>Extracting single-unit spiking activity from raw data collected over weeks and months of continuous extracellular recordings presents a significant challenge for which there is currently no adequate solution. Parsing such large datasets must necessarily rely on automated spike-sorting methods. These face three major challenges (<xref ref-type="bibr" rid="bib102">Rey et al., 2015a</xref>). First, they must reliably capture the activity of simultaneously recorded neurons whose firing rates can vary over many orders of magnitude (<xref ref-type="bibr" rid="bib62">Hromádka et al., 2008</xref>; <xref ref-type="bibr" rid="bib87">Mizuseki and Buzsáki, 2013</xref>). Second, they have to contend with spike shapes from recorded units changing significantly over time (<xref ref-type="fig" rid="fig1">Figure 1C</xref>) (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>). This can lead to sorting errors such as incorrect splitting of a single unit’s spikes into multiple clusters, or incorrect merging of spikes from multiple units in the same cluster (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Third, automated methods must be capable of processing very large numbers of spikes in a reliable and efficient manner (in our experience, &gt;10<sup>10</sup> spikes per rat over a time span of 3 months for 64 channel recordings).</p><p>Here we present an unsupervised spike-sorting algorithm that meets these challenges and tracks single units over months-long timescales. Our Fast Automated Spike Tracker (FAST) (<xref ref-type="bibr" rid="bib99">Poddar et al., 2017</xref>) comprises two main steps (<xref ref-type="fig" rid="fig2">Figure 2</xref>). First, to compress the datasets and normalize for large variations in firing rates between units, it applies ‘local clustering’ to create de-noised representations of spiking events in the data (<xref ref-type="fig" rid="fig2">Figure 2A–C</xref>). In a second step, FAST chains together de-noised spikes belonging to the same putative single unit over time using an integer linear programming algorithm (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) (<xref ref-type="bibr" rid="bib124">Vazquez-Reina et al., 2011</xref>). FAST is an efficient and modular data processing pipeline that, depending on overall spike rates, runs two to three times faster on our custom built storage servers (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>) than the rate at which the data (64 electrodes) is acquired. This implies that FAST could, in principle, also be used for online sorting, although we are currently running it offline.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.004</object-id><label>Figure 2.</label><caption><title>Overview of fast automated spike tracker (FAST), an unsupervised algorithm for spike-sorting continuous, long-term recordings.</title><p>(<bold>A–C</bold>) Step 1 of FAST. (<bold>A</bold>) Cartoon plot of spike waveform feature (such as amplitude) over time. Spikes are grouped into consecutive blocks of 1000 (indicated by gray dashed lines). (<bold>B</bold>) Superparamagnetic clustering is performed on each 1000 spike-block to compress and de-noise the raw spike dataset. Centroids (indicated by purple circles) of high-density clusters comprising more than 15 spikes are calculated. These correspond to units with higher firing rates. (<bold>C</bold>) Leftover spikes in low-density clusters (indicated by brown dots), corresponding to units with lower firing rates, are pooled into 1000 spike blocks and subject to the local clustering step. This process is repeated for a total of 4 iterations in order to account for spikes from units across a wide range of firing rates. Cluster centroids representing averaged spike waveforms from each round of local clustering are carried forward to Step 2 of FAST. (<bold>D–E</bold>) Step 2 of FAST. (<bold>D</bold>) Centroids from all rounds of local clustering in Step 1 are pooled into blocks of size 1000 (dashed grey lines) and local superparamagnetic clustering is performed on each block. (<bold>E</bold>) The resulting clusters are linked across time using a segmentation fusion algorithm to yield cluster-chains corresponding to single units. (<bold>F</bold>) Step 3 of FAST. In the final step, the output of the automated sorting (top) is visually inspected and similar chains merged across time to yield the final single-unit clusters (bottom).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.005</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Algorithm for identifying spikes from tetrode recordings.</title><p>(<bold>A</bold>) Each input channel <inline-formula><mml:math id="inf1"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is split into two streams, one containing the low frequency component <inline-formula><mml:math id="inf2"><mml:msub><mml:mrow><mml:mi>l</mml:mi><mml:mi>f</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and one containing the high frequency one,<inline-formula><mml:math id="inf3"> <mml:mi/><mml:msub><mml:mrow><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The median of <inline-formula><mml:math id="inf4"><mml:msub><mml:mrow><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> across all channels is subtracted from each channel resulting in<inline-formula><mml:math id="inf5"><mml:msub><mml:mrow> <mml:mi/><mml:mover accent="false"><mml:mrow><mml:mi>s</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula>. Spike times <inline-formula><mml:math id="inf6"><mml:msubsup><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> and spike waveforms <inline-formula><mml:math id="inf7"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> from each tetrode are then extracted. The LFPs and spikes extracted from the raw data are saved to disk resulting in a 5-10x ‘compression’ of the raw data. (<bold>B</bold>) Algorithm for detecting spikes. If the absolute value of the filtered signal exceeds 50 µV in any channel of a tetrode then a spike is ‘detected’. The spike is considered to have ‘ended’ if all channels remain within 20 µV for 8 consecutive samples. (<bold>C</bold>) Example of a 1 s long raw recording from a tetrode. The red lines mark the ±50 µV spike detection threshold. (<bold>D</bold>) Examples of 2.13 ms wide spike snippets (64 samples) extracted from the data in C. Snippets from all 4 electrodes detected using the state machine in B are aligned to the peak of the spike waveform and concatenated to produce the 256 sample spike waveforms<inline-formula><mml:math id="inf8"><mml:msubsup><mml:mrow> <mml:mi mathvariant="bold-italic"/><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig2-figsupp1-v2"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.006</object-id><label>Figure 2—figure supplement 2.</label><caption><title>Algorithms for local clustering of spike waveforms and linking cluster trees to track units over time (Steps 1 and 2 of FAST).</title><p>(<bold>A–C</bold>) Step 1 of FAST. (<bold>A</bold>) Raw spike waveforms <inline-formula><mml:math id="inf9"><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> are locally clustered and split into low- and high-density clusters (details in panels B and C). The spikes from low-density clusters are further split into two streams in the same manner 3 more times. The centroids of high density clusters from all 4 stages are pooled together to form the output <inline-formula><mml:math id="inf10"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula>. (<bold>B</bold>) Local clustering of each 1000 spike block. Super-paramagnetic clustering generates a cluster tree (ii) from the spike waveforms (<bold>i</bold>), the leaves of which are recursively merged (iii and iv) to generate a clustering of the 1000 points (<bold>v</bold>). The dotted blue lines show which leaves of the tree in (ii) are merged to produce the tree in (iii). The nodes marked red in (ii) correspond to ‘distinct clusters’, i.e. clusters that are very different from the parent nodes. The leaves of (iii) are similarly merged to produce the tree in (iv). The colored leaves correspond to high-density clusters, i.e. clusters with more than 15 points and the black leaves correspond to low-density clusters. (<bold>C</bold>) Schematic illustrating splitting of spikes into low-density and high-density clusters. The set of input spike waveforms <inline-formula><mml:math id="inf11"><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math></inline-formula> is split into blocks of 1000 spikes (3 blocks shown in the figure) with each block split into low (colored black) and high density clusters (colored blue and red) using the procedure shown in panel B. The spikes from the low density clusters are pooled together to form <inline-formula><mml:math id="inf12"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math></inline-formula>. The centroids of the high density clusters form<inline-formula><mml:math id="inf13"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math></inline-formula>. (<bold>D</bold>) Number of spike waveforms in a 30 min period from one tetrode in various stages of the local clustering and de-noising algorithm. (<bold>E–F</bold>) Step 2 of FAST. (<bold>E</bold>) The output of the previous steps (averaged spike waveforms as per panels A-D) is split into a blocks of 1000 averaged spikes and converted into a sequence of cluster trees (5 trees shown in the figure). A subset of all possible links between adjacent cluster trees is chosen by maximizing the total similarity between linked nodes subject to the constraints depicted in panels F. The subset of chosen nodes and links are highlighted in color. Three sets of nodes connected by links, one in red and two in green, are shown. The two green chains are merged based on waveform similarity to produce a final sorting containing two units (red and green). (<bold>F</bold>) (Top) The constraint shown ensures that none of the 4 incoming links (<inline-formula><mml:math id="inf14"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>) are chosen if the node marked <inline-formula><mml:math id="inf15"><mml:mi>C</mml:mi></mml:math></inline-formula> is not chosen. It also ensures that if <inline-formula><mml:math id="inf16"><mml:mi>C</mml:mi></mml:math></inline-formula> is chosen, at most one of the incoming links is chosen. (Middle) Same as above, except for outgoing links. (Bottom) These constraints ensure that if a node is chosen then none of its parents or child nodes are.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig2-figsupp2-v2"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.007</object-id><label>Figure 2—figure supplement 3.</label><caption><title>Recommended workflow for manual verification step of FAST.</title><p>See Materials and methods for more details.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig2-figsupp3-v2"/></fig><fig id="fig2s4" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.008</object-id><label>Figure 2—figure supplement 4.</label><caption><title>Effect of median subtraction on recording noise in behaving rats.</title><p>2 s segment of an example 3-axis accelerometer trace (top) and high-pass filtered tetrode recording from the motor cortex (middle) during eating behavior. Note the presence of correlated noise on all 4 electrode channels, presumably arising from activation of muscles responsible for chewing. (Bottom) Subtracting the median activity of all channels (as described in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>) from individual electrode channels largely eliminates common-mode noise.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig2-figsupp4-v2"/></fig></fig-group><p>To parse and compress the raw data, FAST first identifies and extracts spike events (‘snippets’) by bandpass filtering and thresholding each electrode channel (Materials and methods, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). Four or more rounds of clustering are then performed on blocks of 1000 consecutive spike ‘snippets’ by means of an automated superparamagnetic clustering routine, a step we call ‘local clustering’ (<xref ref-type="bibr" rid="bib13">Blatt et al., 1996</xref>; <xref ref-type="bibr" rid="bib101">Quiroga et al., 2004</xref>) (Materials and methods, <xref ref-type="fig" rid="fig2">Figure 2B</xref> and <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A–D</xref>). Spikes in a block that belong to the same cluster are replaced by their centroid, a step that effectively de-noises and compresses the data by representing groups of similar spikes with a single waveform. The number of spikes per block was empirically determined to balance the trade-off between computation time and accuracy of superparamagnetic clustering (see Materials and methods). The goal of this step is not to reliably find all spike waveforms associated with a single unit, but to be reasonably certain that the waveforms being averaged over are similar enough to be from the same single unit.</p><p>Due to large differences in firing rates between units, the initial blocks of 1000 spikes will be dominated by high firing rate units. Spikes from more sparsely firing cells that do not contribute at least 15 spikes to a cluster in a given block are carried forward to the next round of local clustering, where previously assigned spikes have been removed (Materials and methods, <xref ref-type="fig" rid="fig2">Figure 2C</xref>, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A–D</xref>). Applying this method of pooling and local clustering sequentially four times generates a de-noised dataset that accounts for large differences in the firing rates of simultaneously recorded units (<xref ref-type="fig" rid="fig2">Figure 2C</xref>, Materials and methods).</p><p>The second step of the FAST algorithm is inspired by an automated method (‘segmentation fusion’) that links similar elements over cross-sections of longitudinal datasets in a globally optimal manner (Materials and methods, <xref ref-type="fig" rid="fig2">Figure 2D–E</xref>, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2E–F</xref>). Segmentation fusion has been used to trace processes of individual neurons across stacks of two-dimensional serial electron-microscope images (<xref ref-type="bibr" rid="bib66">Kasthuri et al., 2015</xref>; <xref ref-type="bibr" rid="bib124">Vazquez-Reina et al., 2011</xref>). We adapted this method to link similar de-noised spikes across consecutive blocks into ‘chains’ containing the spikes of putative single units over longer timescales (<xref ref-type="fig" rid="fig2">Figure 2F</xref>). This algorithm allows us to automatically track the same units over days and weeks of recording.</p><p>In a final post-processing and verification step, we use a semi-automated method (<xref ref-type="bibr" rid="bib28">Dhawale et al., 2017a</xref>) to link ‘chains’ belonging to the same putative single unit together, and perform visual inspection of each unit (<xref ref-type="fig" rid="fig2">Figure 2F–G</xref> and <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>). A detailed description of the various steps involved in the automated spike-sorting can be found in Materials and methods. Below, we describe how we validated the spike-sorting performance of FAST using ground-truth datasets.</p></sec><sec id="s2-3"><title>Validation of FAST on ground-truth datasets</title><p>To measure the spike-sorting capabilities of FAST, we used a publicly available dataset (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>; <xref ref-type="bibr" rid="bib57">Henze et al., 2009</xref>) comprising paired intracellular and extracellular (tetrode) recordings in the anesthetized rat hippocampus. The intracellular recordings can be used to determine the true spike-times for any unit also captured simultaneously on the tetrodes (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). To benchmark the performance of FAST, we compared its error rate to that of the best ellipsoidal error rate (BEER), a measure which represents the optimal performance achievable by standard clustering methods (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>) (see Materials and methods). We found that FAST performed as well as BEER on these relatively short (4–6 min long) recordings (<xref ref-type="fig" rid="fig3">Figure 3B</xref> and <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>, n = 5 recordings).</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.009</object-id><label>Figure 3.</label><caption><title>Validation of spike-sorting performance of FAST using ground-truth datasets.</title><p>(<bold>A</bold>) Example traces of simultaneous extracellular tetrode (black) and intracellular electrode (red) recordings from the anesthetized rat hippocampus (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>; <xref ref-type="bibr" rid="bib57">Henze et al., 2009</xref>). The intracellular trace can be used to identify ground-truth spike times of a single unit recorded on the tetrode. (<bold>B</bold>) Spike-sorting error rate of FAST on the paired extracellular-intracellular recording datasets (n = 5) from (<xref ref-type="bibr" rid="bib57">Henze et al., 2009</xref>), in comparison to the best ellipsoidal error rate (BEER), a measure of the optimal performance of standard spike-sorting algorithms (see Materials and methods, <xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>). The error rate was calculated by dividing the number of misclassified spikes (sum of false positives and false negatives) by the number of ground-truth spikes for each unit. (<bold>C</bold>) A representative synthetic tetrode recording dataset in which we model realistic fluctuations in spike amplitudes over 256 hr (see Materials and methods). The four plots show simulated spike amplitudes on the four channels of a tetrode. Colored dots indicate spikes from eight distinct units while gray dots represent multi-unit background activity. For visual clarity, we have plotted the amplitude of every 100<sup>th</sup> spike in the dataset. (<bold>D</bold>) Spike-sorting error rates of FAST (blue bars) applied to the synthetic tetrode datasets (n = 48 units from six tetrodes), in comparison to the BEER measure (red bars) over different durations of the simulated recordings. Error-bars represent standard error of the mean. * indicates p&lt;0.05 after applying the Šidák correction for multiple comparisons.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig3-v2"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.010</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Validation of spike-sorting performance of FAST using ground-truth extracellular-intracellular recordings and synthetic single electrode datasets.</title><p>(<bold>A</bold>) Comparison of spike-sorting performance of FAST (blue dots) and BEER (best ellipsoidal error rate, red lines) on 5 different units from the extracellular-intracellular recording datasets of (<xref ref-type="bibr" rid="bib57">Henze et al., 2009</xref>). Each plot shows the false positive versus miss (false negative) rate in clustering spikes of individual units in comparison to ground-truth. For BEER, we varied the relative misclassification cost of false-positive and miss errors in order to obtain a performance curve. SNR refers to the average signal-to-noise ratio of unit spikes in each recording. (<bold>B</bold>) Spike-sorting error rate of FAST (blue bars) applied to synthetic single electrode recordings with simulated amplitude drifts (n = 16 units from eight electrodes), in comparison to the BEER measure (red bars) over different durations of the simulated recordings ranging from 1 to the full 256 hr. Error-bars represent standard error of the mean. * indicates p&lt;0.05 after applying the Šidák correction for multiple comparisons.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig3-figsupp1-v2"/></fig><fig id="fig3s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.011</object-id><label>Figure 3—figure supplement 2.</label><caption><title>Analyzing long-term recordings in the DLS and MC to characterize variation in unit spike amplitude.</title><p>(<bold>A</bold>) Density plot of standard deviation of spike-amplitude versus mean spike amplitude computed in 1 hr blocks for all units in our DLS and MC datasets. Color scale indicates log counts. The slope of the white, dashed line of best fit represents the average signal-dependent variation in spike amplitude for the dataset (slope = 0.06). (<bold>B</bold>) Histogram of signal-dependent variation in spike amplitudes computed, as shown in A, separately for each unit in our dataset. (<bold>C</bold>) Each trace is a histogram of the difference in spike amplitudes over time-lags of 1 through 20 hr, colored as per legend, for all units in the dataset. The x-axis is plotted on a log-scale. (<bold>D</bold>) Standard deviation of histograms of log spike-amplitude differences over different time-lags from 1 to 20 hr, as shown in C. Dashed line indicates line of best fit. (<bold>E</bold>) Distribution of maximum spike amplitudes for all units in our dataset that we had recorded for at least 50 hr. The y-axis represents fractional unit counts on a log-scale. Dashed line indicates line of best fit whose slope characterizes the exponential fall-off in the fraction of units with increasing large spike amplitudes.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig3-figsupp2-v2"/></fig></fig-group><p>Next we wanted to quantify FAST’s ability to isolate and track units over time despite non-stationarity in their spike waveforms. Due to the unavailability of experimental ground-truth datasets recorded continuously over days to weeks-long timescales, we constructed synthetic tetrode recordings (<xref ref-type="bibr" rid="bib29">Dhawale et al., 2017b</xref>; <xref ref-type="bibr" rid="bib82">Martinez et al., 2009</xref>) from eight distinct units whose spike amplitudes fluctuated over 256 hr (10.7 days) following a geometric random walk process (<xref ref-type="bibr" rid="bib107">Rossant et al., 2016</xref>) (<xref ref-type="fig" rid="fig3">Figure 3C</xref>, <xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2</xref>, and Materials and methods). To make these synthetic recordings as realistic as possible, we measured several parameters including the variance of the random walk process, distribution of spike amplitudes, and degree of signal-dependent noise using our own long-term recordings in the rodent motor cortex and striatum (see <xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2</xref>, Materials and methods, and the section ‘Continuous long-term recordings from striatum and motor cortex’). We then compared the sorting performance of FAST to BEER on increasingly larger subsets – from 1 to the full 256 hr – of the synthetic recordings (n = 48 units from 6 simulated tetrodes). Our expectation was for the performance of BEER to, on average, decrease with accumulated time in the recording as drift increases the likelihood of overlap between different units in spike waveform feature space, and that is also what we observed (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). In contrast, the performance of FAST, which was comparable to BEER for short recording durations, significantly outperformed it when the recordings spanned days (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). FAST was also found to perform better than BEER over recording durations longer than 64 hr for single electrode recording configurations that are commonly used in non-human primates (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1B</xref>). The large differences in the sorting error rates between the experimental (<xref ref-type="fig" rid="fig3">Figure 3B</xref>) and synthetic datasets (<xref ref-type="fig" rid="fig3">Figure 3D</xref>) can be largely attributed to relatively small spike-amplitudes (&lt;100 µV) (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>) and, consequently, lower signal-to-noise ratio (SNR = 8.1 ± 5.3, mean ±SD, n = 5 units) of units identified in both intracellular and extracellular recordings in comparison to our in vivo extracellular recordings on which the simulated datasets are modeled (SNR = 15.0 ± 7.3, n = 2572 units, <xref ref-type="fig" rid="fig4">Figure 4F</xref>).</p><fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.012</object-id><label>Figure 4.</label><caption><title>Single units isolated and tracked from continuous months-long recordings made in dorsolateral striatum (DLS) and motor cortex (MC) of behaving rats.</title><p>(<bold>A</bold>) The results of applying FAST to a representative continuous tetrode recording in the rodent motor cortex spanning 45 hr. Each point represents spike amplitudes on channel 2 of a tetrode, with different colors representing distinct units. For visual clarity we have plotted the amplitude of de-noised spike centroids (see <xref ref-type="fig" rid="fig2">Figure 2</xref>), not raw spike amplitudes. Insets (bottom) show average spike waveforms of six example units on the four channels of the tetrode at 0, 24 and 44 hr into the recording. (<bold>B</bold>) Holding times for all units recorded in the DLS (left, green) and MC (right, orange), sorted by duration. (<bold>C</bold>) Temporal profile of units recorded in DLS (left) and MC (right) from two example rats over a period of ~3 months. Unit recording times are indicated by black bars, and are sorted by when they were first identified in the recording. Black triangles and dotted lines indicate times at which the electrode array was intentionally advanced into the brain by turning the micro-drive. Open triangles indicate times at which the population of recorded units changed spontaneously. Number of simultaneously recorded units in the DLS (left, green) and MC (right, orange) as a function of time in the two example recordings. (<bold>D</bold>) Number of simultaneously recorded units in the DLS (left, green) and MC (right, orange) as a function of time in the example recordings shown in C. (<bold>E</bold>) Cumulative distributions of average cluster isolation quality for all units recorded in DLS (left, green) and MC (right, orange). Cluster quality was measured by the isolation distance (top), L-ratio (middle), and fraction of inter-spike intervals under 2 ms (bottom). Dotted lines mark the quality thresholds for each of these measures. Shaded regions denote acceptable values. (<bold>F</bold>) Cumulative distributions of average signal-to-noise ratios for all units recorded in DLS (left, green) and MC (right, orange).</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-27702-fig4-v2"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.013</object-id><label>Figure 4—figure supplement 1.</label><caption><title>Benchmarking the performance of discontinuous unit-tracking methods using continuous long-term datasets sorted by FAST.</title><p>(<bold>A</bold>) Discontinuous tracking of units across daily recording sessions is error-prone. Similarity metrics between units isolated on consecutive days in hour-long recording sessions (data from an example DLS recording). Three out of six possible combinations of similarity features are presented here – spike waveform correlation (left), inter-spike interval histogram (ISI) correlation (middle) and absolute log firing rate difference (right) versus spike waveform Euclidean distance. Each dot represents the similarity between pairs of units recorded on the same tetrode and classified as the ‘same’ (blue dot) or ‘different’ (red dot) by our FAST algorithm. (<bold>B</bold>) Receiver-operator characteristic (ROC) curves for discontinuous tracking of units over time-periods of 1, 5, 10, 5 and 20 days. Each ROC curve was generated by systematically varying the desired false-positive error rate of a ‘same’ versus ‘different’ optimal linear classifier from 0% to 100%. Line colors indicate different tracking time-periods as per the plot legend. Note that the discontinuous tracking algorithm (see Materials and methods) matches pairs of units across days in order of their similarity, with highest similarity pairs being matched first. Due to this, the fraction of units mis-matched (false positive error rate of unit tracking) does not reach 100% even when the desired false-positive error rate of the ‘same’ v/s ‘different’ classifier is set to 100%. (<bold>C</bold>) (Left) Percentage of ‘same’ unit pairs identified by the FAST method that were successfully matched by discontinuous tracking at 1 day intervals, over time-periods ranging from 1 to 20 days. (Right) Percentage of discontinuously matched unit pairs that are classified as ‘different’ by FAST for time-periods ranging from 1 to 20 days. Graded colors correspond to different false positive rate thresholds of the ‘same’ versus ‘different’ optimal linear classifier (see Materials and methods) ranging from 0.2% (light gray) to 25% (black).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig4-figsupp1-v2"/></fig></fig-group><p>Having validated FAST’s spike-sorting performance on both experimental and synthetic datasets, we next describe how our algorithm parses data acquired from continuous long-term tetrode recordings, but we note that it can be adapted to efficiently analyze other types of electrode array or single electrode recordings – whether continuous or intermittent.</p></sec><sec id="s2-4"><title>Continuous long-term recordings from striatum and motor cortex</title><p>To demonstrate the utility of our experimental platform and analysis pipeline for long-term neural recordings, we implanted tetrode drives (16 tetrodes, 64 channels) into dorsolateral striatum (n = 2) or motor cortex (n = 3) of Long Evans rats (Materials and methods). We recorded electrophysiological and behavioral data continuously (<xref ref-type="fig" rid="fig4">Figure 4A</xref>), with only brief interruptions, for more than 3 months. We note that our recordings terminated not because of technical issues with the implant or recording apparatus, but because we deemed the experiments to have reached their end points.</p><p>We used our automated spike-sorting method (FAST) to cluster spike waveforms into putative single units, isolating a total of 1550 units from motor cortex and 1477 units from striatum (<xref ref-type="fig" rid="fig4">Figure 4</xref>). On average, we could track single units over several days (mean: 3.2 days for motor cortex and 7.4 days for striatum), with significant fractions of units tracked continuously for more than a week (11% and 36% in motor cortex and striatum, respectively) and even a month (0.4% in motor cortex and 1.7% in striatum, <xref ref-type="fig" rid="fig4">Figure 4B</xref>). Periods of stable recordings were interrupted by either intentional advancement of the electrode drive or spontaneous ‘events’ likely related to the sudden movement of the electrodes (<xref ref-type="fig" rid="fig4">Figure 4C</xref>). On average, we recorded simultaneously from 19 ± 15 units in motor cortex and 41 ± 20 units in striatum (mean ± standard deviation) (two example rats shown in <xref ref-type="fig" rid="fig4">Figure 4D</xref>).</p><p>The quality of single unit isolation was assessed by computing quantitative measures of cluster quality, that is, cluster isolation distance (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>), L-ratio (<xref ref-type="bibr" rid="bib111">Schmitzer-Torbert et al., 2005</xref>), and presence of a clean refractory period (<xref ref-type="bibr" rid="bib58">Hill et al., 2011</xref>; <xref ref-type="bibr" rid="bib72">Lewicki, 1998</xref>) (<xref ref-type="fig" rid="fig4">Figure 4E</xref>). Assessing the mean cluster quality of the units over their recording lifetimes, we found that 61.4% of motor cortical (n = 952) and 64.6% of striatal units (n = 954) satisfied our conservative criteria (<xref ref-type="bibr" rid="bib100">Quirk et al., 2009</xref>; <xref ref-type="bibr" rid="bib111">Schmitzer-Torbert et al., 2005</xref>; <xref ref-type="bibr" rid="bib114">Sigurdsson et al., 2010</xref>) (Isolation distance &gt;= 25, L-ratio &lt;= 0.3 and fraction of ISIs below 2 ms &lt;= 1%). However, 83.7% of motor cortical units (n = 1298) and 93.2% of striatal units (n = 1376) met these criteria for at least one hour of recording. The average signal-to-noise ratio of units isolated from the DLS and MC was found to be 15.4 ± 7.4 and 14.5 ± 7.2, respectively (<xref ref-type="fig" rid="fig4">Figure 4F</xref>).</p><p>Previous attempts to track populations of extracellularly recorded units over time have relied on matching units across discontinuous recording sessions based on similarity metrics such as spike waveform distance (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib49">Greenberg and Wilson, 2004</xref>; <xref ref-type="bibr" rid="bib64">Jackson and Fetz, 2007</xref>; <xref ref-type="bibr" rid="bib83">McMahon et al., 2014a</xref>; <xref ref-type="bibr" rid="bib94">Okun et al., 2016</xref>; <xref ref-type="bibr" rid="bib121">Thompson and Best, 1990</xref>; <xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>) and activity measures including firing rates and inter-spike interval histograms (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>). Given that spike waveforms of single-units can undergo significant changes even within a day (<xref ref-type="fig" rid="fig1">Figure 1C,D</xref>), a major concern with discontinuous tracking methods is the difficulty in verifying their performance. Since we were able to reliably track units continuously over weeks, we used the sorted single-units as ‘ground truth’ data with which to benchmark the performance of day-by-day discontinuous tracking methods (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). In our data set, we found discontinuous tracking over day-long gaps to be highly error-prone (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1B–C</xref>). When applying tolerant thresholds for tracking units across time, a large fraction of distinct units were labeled as the same (false positives), while at conservative thresholds only a small proportion of the units were reliably tracked across days (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1C</xref>).</p><p>The ability to record and analyze the activity of large populations of single units continuously over days and weeks allows neural processes that occur over long timescales to be interrogated. Below we analyze and describe single neuron activity, interneuronal correlations, and the relationship between neuronal dynamics and different behavioral states, over weeks-long timescales.</p></sec><sec id="s2-5"><title>Stability of neural activity</title><p>We clustered motor cortical and striatal units into putative principal neurons and interneurons based on their spike shapes and firing rates (<xref ref-type="bibr" rid="bib9">Barthó et al., 2004</xref>; <xref ref-type="bibr" rid="bib10">Berke et al., 2004</xref>; <xref ref-type="bibr" rid="bib25">Connors and Gutnick, 1990</xref>), thus identifying 366 fast spiking and 1111 medium spiny neurons in striatum, and 686 fast spiking and 864 regular spiking neurons in motor cortex (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). Consistent with previous reports (<xref ref-type="bibr" rid="bib62">Hromádka et al., 2008</xref>; <xref ref-type="bibr" rid="bib87">Mizuseki and Buzsáki, 2013</xref>), average firing rates appeared log-normally distributed and varied over more than three orders of magnitude (from 0.029 Hz to 40.2 Hz in striatum, and 0.031 Hz to 44.8 Hz in motor cortex; <xref ref-type="fig" rid="fig5">Figure 5A</xref>).</p><fig-group><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.014</object-id><label>Figure 5.</label><caption><title>Long-term stability of single unit activity.</title><p>(<bold>A</bold>) Histograms of average firing rates for units recorded in DLS (left) and MC (right). Putative cell-types, medium spiny neurons (MSN, blue) and fast-spiking interneurons (FSI, green) in DLS, and regular spiking (RS, brown) and fast spiking (FS, red) neurons in the MC, were classified based on spike shape and firing rate (Materials and methods). The continuous traces are log-normal fits to the firing rate distributions of each putative cell-type. Insets show average peak-normalized waveform shapes for MSNs (left-bottom) and FSIs (left-top), and RS (right-bottom) and FS (right-top) neurons. Shading represents the standard deviation of the spike waveforms. (<bold>B</bold>) Firing rates of DLS (left) and MC (right) units over 20 days of recording. The color scale indicates firing rate on a log-scale, calculated in one-hour blocks. Units have been sorted by average firing rate. (<bold>C</bold>) Scatter plots of unit firing rates over time-lags of 1 (left), 5 (middle) and 10 (right) days for DLS (top) and MC (bottom). The dashed lines indicate equality. Every dot is a comparison of a unit’s firing from a baseline day to 1, 5 or 10 days later. The color of the dot indicates putative cell-type as per (<bold>A</bold>). Each unit may contribute multiple data points, depending on the length of the recording. Day 1: n = 4398 comparisons for striatum and n = 1458 for cortex; Day 5: n = 2471 comparisons for striatum and n = 615 for cortex; Day 10: n = 1347 comparisons for striatum and n = 268 for cortex. (<bold>D</bold>) Stability of unit firing rates over time. The firing rate similarity (see Materials and methods) was measured across time-lags of 1 to 20 days for the same unit (within-unit, solid lines), or between simultaneously recorded units (across-unit, dashed lines) in DLS (left) and MC (right). Colored shaded regions indicate the standard deviation of within-unit firing rate similarity, over all units. Grey shaded regions indicate standard deviation of across-unit firing rate similarity, over all time-bins. (<bold>E</bold>) Inter-spike interval (ISI) histograms for example units in DLS (left, green) and MC (right, orange) over two weeks of continuous recordings. Each line represents the normalized ISI histogram measured on a particular day. (<bold>F</bold>) Stability of unit ISI distributions over time. Correlations between ISI distributions were measured across time-lags of 1 to 20 days for the same unit (within-unit, solid lines), or between simultaneously recorded units (across-unit, dashed lines) in DLS (left) and MC (right). Colored shaded regions indicate the standard deviation of within-unit ISI similarity, over all units. Grey shaded regions indicate standard deviation of across-unit ISI similarity, over all time-bins.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig5-v2"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.015</object-id><label>Figure 5—figure supplement 1.</label><caption><title>Stability over time of ISI distributions computed from spike chains that were automatically identified by FAST.</title><p>Stability of chain-derived ISI distributions over time. Correlations between ISI distributions were measured across time-lags of 1 to 9 days for the same chain in DLS (left) and across time-lags of 1 to 5 days for chains in MC (right). Colored shaded regions indicate the standard deviation of within-chain ISI similarity, over all chains.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig5-figsupp1-v2"/></fig></fig-group><p>Average firing rates remained largely unchanged even over 20 days of recording (<xref ref-type="fig" rid="fig5">Figure 5B–D</xref>), suggesting that activity levels of single units in both cortex and striatum are stable over long timescales, and that individual units maintain their own firing rate set-point (<xref ref-type="bibr" rid="bib56">Hengen et al., 2016</xref>; <xref ref-type="bibr" rid="bib80">Marder and Goaillard, 2006</xref>). We next asked whether neurons also maintain second-order spiking statistics. The inter-spike interval (ISI) distribution is a popular metric that is sensitive to a cell’s mode of spiking (bursting, tonic etc.) and other intrinsic properties, such as refractoriness and spike frequency adaptation. Similar to firing rate, we found that the ISI distribution of single units remained largely unchanged across days (<xref ref-type="fig" rid="fig5">Figure 5E–F</xref>). To verify whether our ISI similarity criterion for manual merging of FAST-generated spike chains (see Materials and methods) biased our measurements of ISI stability, we also analyzed the stability of the ISI computed from chains generated by the fully automated steps 1 and 2 of FAST, and found it to be similarly stable over multiple days (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>).</p><p>Measures of single unit activity do not adequately address the stability of the network in which the neurons are embedded, as they do not account for interneuronal correlations (<xref ref-type="bibr" rid="bib1">Abbott and Dayan, 1999</xref>; <xref ref-type="bibr" rid="bib35">Ecker et al., 2010</xref>; <xref ref-type="bibr" rid="bib91">Nienborg et al., 2012</xref>; <xref ref-type="bibr" rid="bib93">Okun et al., 2015</xref>; <xref ref-type="bibr" rid="bib109">Salinas and Sejnowski, 2001</xref>; <xref ref-type="bibr" rid="bib115">Singer, 1999</xref>). To address this, we calculated the cross-correlograms of all simultaneously recorded neuron pairs (<xref ref-type="fig" rid="fig6">Figure 6A</xref>, Materials and methods). We found that 21.1% of striatal pairs (n = 18697 pairs) and 37.6% motor cortex pairs (n = 9235 pairs) were significantly correlated (Materials and methods). The average absolute time-lag of significantly correlated pairs was 13.0 ± 26.3 ms (median: 4 ms) and 23.9 ± 28.8 ms (median: 13.0 ms) for striatum and motor cortex respectively. The pairwise spike correlations were remarkably stable, remaining essentially unchanged even after 10 days (<xref ref-type="fig" rid="fig6">Figure 6B–C</xref>), consistent with a very stable underlying network (<xref ref-type="bibr" rid="bib51">Grutzendler et al., 2002</xref>; <xref ref-type="bibr" rid="bib134">Yang et al., 2009</xref>).</p><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.016</object-id><label>Figure 6.</label><caption><title>Stability of network dynamics.</title><p>(<bold>A</bold>) Correlograms for example unit pairs from DLS (left) and MC (right) over 10+ days. Each line represents the normalized correlogram measured on a particular day. (<bold>B</bold>) Scatter plots comparing the correlogram amplitude (normalized) of a unit pair on a baseline day to the same pair’s peak correlation 1, 5 or 10 days later, for DLS (top) and MC (bottom). The black line indicates equality. Values &gt; 1 (or &lt;1) correspond to positive (or negative) correlations (see Materials and methods). Day 1: n = 48472 comparisons for DLS and n = 12148 for MC. Day 5: n = 19230 comparisons for DLS and n = 2881 for MC. Day 10: n = 7447 comparisons for DLS and n = 772 for MC. All unit pairs whose correlograms had at least 5000 spikes over a day’s period were included. (<bold>C</bold>) Stability of correlations over time. The correlogram similarity (see Materials and methods) was measured across time-lags of 1 to 10 days for pairs of units (solid lines) in DLS (top) and MC (bottom). Colored shaded regions indicate the standard deviation of the correlogram similarity between all pairs that had significant correlograms on at least one recording day (Materials and methods).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig6-v2"/></fig></sec><sec id="s2-6"><title>Stability of behavioral state-dependent activity</title><p>Our results demonstrated long-term stability in the time-averaged statistics of single units (<xref ref-type="fig" rid="fig5">Figure 5</xref>) as well as their interactions (<xref ref-type="fig" rid="fig6">Figure 6</xref>), both in motor cortex and striatum. However, the brain functions to control behavior, and the activity of both cortical and striatal units can be expected to differ for different behaviors. To better understand the relationship between the firing properties of single units and ongoing behavior, and to assess the stability of these relationships, we analyzed single unit activity in different behavioral states (<xref ref-type="fig" rid="fig7">Figure 7</xref>). To do this, we developed an algorithm for automatically classifying a rat’s behavior into ‘states’ using high-resolution measurements of head acceleration and local field potentials (LFPs). Our method distinguishes repetitive behaviors (such as grooming), eating, active exploration, task engagement as well as quiet wakefulness, rapid eye movement, and slow wave sleep (<xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib125">Venkatraman et al., 2010</xref>) (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>, Materials and methods), and assigns ~88% of the recording time to one of these states.</p><fig-group><fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.017</object-id><label>Figure 7.</label><caption><title>Stability of behavioral state-dependent activity patterns.</title><p>(<bold>A</bold>) Stability of average firing rates in different behavioral states (i.e. the unit’s ‘state-tuning’) across several days for example units recorded in the DLS (left) and MC (middle and right). The color-scale corresponds to the firing rate of a unit normalized by its average firing rate. The state abbreviations correspond to slow-wave sleep (SW), REM sleep (RM), quiet wakefulness (QW), repetitive (RP), active exploration (AX), eating (ET) and task execution (TK). (<bold>B</bold>) Stability of units’ state-tuning over time. Correlations between the state-tuning profiles (as in ‘A’) were measured across time-lags of 1 to 20 days for the same unit (within-unit, solid lines), or between simultaneously recorded units (across-unit, dashed lines) in MC (left) and DLS (right). Colored shaded regions indicate the standard deviation of within-unit state-tuning similarity, over all units. Grey shaded regions indicate standard deviation of across-unit state-tuning similarity, over all time-bins. (<bold>C</bold>) Diversity in state-tuning across all units recorded in the DLS (left) and MC (right). Units are sorted by the peak behavioral state in their state-tuning curves. (<bold>D</bold>) Cross-correlograms computed for example pairs of units in the DLS (left) and MC (right) in different behavioral states. Line colors represent behavioral state. (<bold>E</bold>) Stability of cross-correlograms measured within specific behavioral states. The correlation similarity (see Materials and methods) was measured across time-lags of 1 to 10 days (solid lines) in DLS (left) and MC (right). Line colors represent correlation similarity for different behavioral states, as per the plot legend.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig7-v2"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.018</object-id><label>Figure 7—figure supplement 1.</label><caption><title>Automated classification of behavioral states.</title><p>(<bold>A</bold>) (Top) Spectrograms of the accelerometer signal (top) and the LFP (middle) for an hour-long window of recording from the motor cortex. Below is the color-coded output of our automated classification algorithm. UL-unlabeled; SW-Slow wave sleep; RM-REM sleep; QW- quiet wakefulness, RP-repetitive behavior, AX-active exploration, ET-eating, TK-task. (<bold>B</bold>) Ethograms showing the proportion of time spent in each of the behavioral states over 40 consecutive days for two example rats. The ethograms do not include absence seizure-like states or unlabeled states (Materials and methods). (<bold>C</bold>) Circadian profiles of behavioral states over 40 days of recording for active and inactive states for the two rats in B. Behavioral states are color-coded as in A, with gray representing inactive (or active) and unlabeled states.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig7-figsupp1-v2"/></fig></fig-group><p>Behavioral state transitions, such as between sleep and wakefulness, have been shown to affect average firing rates (<xref ref-type="bibr" rid="bib39">Evarts, 1964</xref>; <xref ref-type="bibr" rid="bib71">Lee and Dan, 2012</xref>; <xref ref-type="bibr" rid="bib97">Peña et al., 1999</xref>; <xref ref-type="bibr" rid="bib110">Santhanam et al., 2007</xref>; <xref ref-type="bibr" rid="bib118">Steriade et al., 1974</xref>; <xref ref-type="bibr" rid="bib129">Vyazovskiy et al., 2009</xref>), inter-spike interval distributions (<xref ref-type="bibr" rid="bib78">Mahon et al., 2006</xref>; <xref ref-type="bibr" rid="bib129">Vyazovskiy et al., 2009</xref>), and neural synchrony (<xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib104">Ribeiro et al., 2004</xref>; <xref ref-type="bibr" rid="bib131">Wilson and McNaughton, 1994</xref>). However, most prior studies analyzed brief recording sessions in which only a narrow range of behavioral states could be sampled (<xref ref-type="bibr" rid="bib59">Hirase et al., 2001</xref>; <xref ref-type="bibr" rid="bib78">Mahon et al., 2006</xref>; <xref ref-type="bibr" rid="bib129">Vyazovskiy et al., 2009</xref>; <xref ref-type="bibr" rid="bib131">Wilson and McNaughton, 1994</xref>), leaving open the question of whether the modulation of neural dynamics across behavioral states is distinct for different neurons in a network and whether state-specific activity patterns of single neurons are stable over time. Not surprisingly, we found that firing rates of both striatal and motor cortical units depended on what the animal was doing (<xref ref-type="fig" rid="fig7">Figure 7A</xref>). Interestingly, the relative firing rates in different behavioral states (i.e. a cell’s ‘state tuning’) remained stable over several weeks-long timescales (<xref ref-type="fig" rid="fig7">Figure 7A–B</xref>), even as they varied substantially between different neurons (<xref ref-type="fig" rid="fig7">Figure 7A,C</xref>). Additionally, we observed that interneuronal spike correlations were also modulated by behavioral state (<xref ref-type="fig" rid="fig7">Figure 7D</xref>), and this dependence was also stable over time (<xref ref-type="fig" rid="fig7">Figure 7E</xref>).</p></sec><sec id="s2-7"><title>Stability in the coupling between neural and behavioral dynamics</title><p>Neurons in motor-related areas encode and generate motor output, yet the degree to which the relationship between single unit activity and various movement parameters (i.e. a cell’s ‘motor tuning’) is stable over days and weeks has been the subject of recent debate (<xref ref-type="bibr" rid="bib17">Carmena et al., 2005</xref>; <xref ref-type="bibr" rid="bib21">Chestek et al., 2007</xref>; <xref ref-type="bibr" rid="bib23">Clopath et al., 2017</xref>; <xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib73">Liberti et al., 2016</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib105">Rokni et al., 2007</xref>; <xref ref-type="bibr" rid="bib119">Stevenson et al., 2011</xref>). Long-term continuous recordings during natural and learned behaviors constitute unique datasets for characterizing the stability of movement coding at the level of single neurons.</p><p>We addressed this by computing the ‘response fields’ (<xref ref-type="bibr" rid="bib20">Cheney and Fetz, 1984</xref>; <xref ref-type="bibr" rid="bib26">Cullen et al., 1993</xref>; <xref ref-type="bibr" rid="bib112">Serruya et al., 2002</xref>; <xref ref-type="bibr" rid="bib130">Wessberg et al., 2000</xref>), i.e. the spike-triggered average (STA) accelerometer power (Materials and methods), of neurons in different active states (<xref ref-type="fig" rid="fig8">Figure 8A</xref>; Materials and methods). The percentage of units with significant response fields during repetitive behavior, exploration, and eating was 19.7% (n = 291), 9.5% (n = 140) and 18.4% (n = 272), respectively, for the striatum, and 18.7% (n = 290), 7.6% (n = 118) and 22.5% (n = 349) for the motor cortex. Movement STAs varied substantially between neurons and across behavioral states, but were stable for the same unit when compared over at least 20 days, within a particular state (<xref ref-type="fig" rid="fig8">Figure 8A–B</xref>).</p><fig-group><fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.019</object-id><label>Figure 8.</label><caption><title>Stability of behavioral representations.</title><p>(<bold>A</bold>) Spike-triggered average (STA) accelerometer power calculated daily in three different behavioral states – repetitive behavior (left), active exploration (middle) and eating (right). Shown are four example units recorded from DLS (top two rows) and MC (bottom two rows). (<bold>B</bold>) Stability of STAs over time. Correlations between STAs were measured across time-lags of 1 to 20 days for the same unit (within-unit, solid lines), or between simultaneously recorded units (across-unit, dashed lines) in DLS (left) and MC (right). Colored shaded regions indicate the standard deviation of within-unit STA similarity (averaged over the three behavioral states in ‘A’), over all units. Grey shaded regions indicate standard deviation of across-unit STA similarity, over all time-bins. (<bold>C</bold>) Peri-event time histograms (PETHs) of DLS (left) and MC (right) unit activity, aligned to the timing of a lever-press or nose-poke during the execution of a skilled motor task. Plotted are the PETHs of units that had significant modulations in their firing rate in a time-window ±200 ms around the time of the behavioral event (Materials and methods). The color scale indicates Z-scored firing rate. Units are sorted based on the times of peaks in their PETHs. (<bold>D</bold>) Spike raster of an example DLS unit over 12 days, aligned to the time of a nose-poke event. Each dot represents a spike-time on a particular trial. The color of the dot indicates day of recording. (<bold>E</bold>) PETHs computed over several days for example DLS (top) and MC (bottom) units to lever-press (left) and nose-poke (right) events in our task. (<bold>F</bold>) Stability of task PETHs over time. Correlations between PETHs were measured across time-lags of 1 to 20 days for the same unit (within-unit, solid lines), or between simultaneously recorded units (across-unit, dashed lines) in DLS (left) and MC (right). Colored shaded regions indicate the standard deviation of within-unit PETH similarity (averages across lever-press and nose-poke events), over all units. Grey shaded regions indicate standard deviation of across-unit PETH similarity (averaged across lever-press and nose-poke events), over all time-bins.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig8-v2"/></fig><fig id="fig8s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.27702.020</object-id><label>Figure 8—figure supplement 1.</label><caption><title>Measurements of long-term stability of neural dynamics and motor representations for individual units.</title><p>(<bold>A</bold>) Measuring firing rate stability for an example unit recorded in the DLS. The plot shows firing rate similarity (see <xref ref-type="fig" rid="fig5">Figure 5</xref> and Materials and methods) plotted against time-lag in days. Each dot represents a different comparison. The stability of firing rate similarity (the stability index) is measured by fitting a regression line (indicated by red dashes) to the data and calculating its slope and p-value. (<bold>B</bold>) Histograms of stability indices for different metrics of neural dynamics for all units recorded in the DLS (left) and MC (right), computed as shown in A. Shaded bars indicate counts of units with significantly low stability indices (stability index &lt; -0.025 day<sup>−1</sup> and p&lt;0.05 after applying the Šidák correction for multiple comparisons). See <xref ref-type="table" rid="table2">Table 2</xref> for quantification of the number of units with significantly low stability indices. The vertical dashed line indicates the stability threshold (0.025 day<sup>−1</sup>).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-27702-fig8-figsupp1-v2"/></fig></fig-group><p>Another measure used to characterize neural coding of behavior on fast timescales is the ‘peri-event time histogram’ (PETH), that is, the average neural activity around the time of a salient behavioral event. We calculated PETHs for two events reliably expressed during the execution of a skill our subjects performed in daily training sessions (<xref ref-type="bibr" rid="bib67">Kawai et al., 2015</xref>) (Materials and methods): (i) the first lever-press in a learned lever-press sequence and (ii) entry into the reward port after successful trials (‘nose-poke’). The fraction of units whose activity was significantly locked to the lever-press or nose-poke (see Materials and methods) was 22.2% (n = 328) and 23.2% (n = 343) in striatum, and 12.3% (n = 190) and 18.7% (n = 290) in motor cortex (<xref ref-type="fig" rid="fig8">Figure 8C</xref>), respectively. When comparing PETHs of different units for the same behavioral events, we observed that the times of peak firing were distributed over a range of delays relative to the time of the events (<xref ref-type="fig" rid="fig8">Figure 8C</xref>). However, despite the heterogeneity in PETHs across the population of units, the PETHs of individual units were remarkably similar when compared across days (<xref ref-type="fig" rid="fig8">Figure 8D–F</xref>).</p></sec><sec id="s2-8"><title>Stability of individual units</title><p>Our population-level analyses showed that many aspects of neural activity, such as firing rates, inter-spike intervals and behavioral representations are stable over many weeks. While these results are consistent with the majority of recorded units being stable over these timescales, they do not rule out the existence of a smaller subpopulation of units whose dynamics may be unstable over time. To probe this, we did a regression analysis to measure the dependence of different similarity metrics on elapsed time (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1A</xref>), and quantified the stability index of individual units as the slope of the best-fit line. The distribution of stability indices was unimodal and centered at 0 day<sup>−1</sup> for every similarity metric, indicating that the vast majority (between 88% and 98%) of recorded units were stable (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1B</xref>, <xref ref-type="table" rid="table2">Table 2</xref>) given a conservative threshold (slope &gt;= -0.025 day<sup>−1</sup> and p&gt;=0.05). Interestingly, a negative skew was also apparent in these distributions implying that a small fraction (~2–12%) of our recorded units were relatively less stable over longer timescales (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1B</xref>, <xref ref-type="table" rid="table2">Table 2</xref>); however no unit was found to have a stability index lower than -0.1 day<sup>−1</sup>.</p><table-wrap id="table2" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.021</object-id><label>Table 2.</label><caption><title>Proportion of units that have stable neural dynamics and motor representations in the striatum and motor cortex.</title></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2">Activity metric</th><th colspan="2">Dorsolateral striatum</th><th colspan="2">Motor cortex</th></tr><tr><th> <italic>% stable</italic></th><th><italic>n</italic></th><th><italic>% stable</italic></th><th><italic>n</italic></th></tr></thead><tbody><tr><td> Firing rate</td><td>90.3</td><td>186</td><td>88.1</td><td>42</td></tr><tr><td> ISI histogram</td><td>97.9</td><td>187</td><td>97.6</td><td>42</td></tr><tr><td> State tuning</td><td>93.9</td><td>163</td><td>92.7</td><td>41</td></tr><tr><td> STA</td><td>93.6</td><td>202</td><td>95.0</td><td>80</td></tr><tr><td> PETH</td><td>89.4</td><td>113</td><td>89.5</td><td>57</td></tr></tbody></table></table-wrap></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Recording from populations of single neurons in behaving animals has traditionally been a laborious undertaking both in terms of experimentation and analysis. Automating this process, and extending the recordings over weeks and months, increases the efficiency and power of such experiments in multiple ways. First, it eliminates the manual steps of intermittent recordings, such as transferring animals to and from their recording chambers, plugging and unplugging recording cables etc., which, besides being time-consuming, can be detrimental to the recordings (<xref ref-type="bibr" rid="bib16">Buzsáki et al., 2015</xref>) and stressful for the animals (<xref ref-type="bibr" rid="bib31">Dobrakovová and Jurcovicová, 1984</xref>; <xref ref-type="bibr" rid="bib75">Longordo et al., 2011</xref>). Second, when combined with fully automated home-cage training (<xref ref-type="bibr" rid="bib98">Poddar et al., 2013</xref>), this approach allows the neural correlates of weeks- and months-long learning processes to be studied in an efficient manner. Indeed, our system should enable a single researcher to supervise tens, if not hundreds, of recordings simultaneously, thus radically improving the ease and throughput with which such experiments can be performed. Third, continuous recordings allow the activity of the same neurons to be tracked over days and weeks, allowing their activity patterns to be pooled and compared for more trials, and across different experimental conditions and behavioral states, thus increasing the power with which the principles of neural function can be inferred (<xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>; <xref ref-type="bibr" rid="bib83">McMahon et al., 2014a</xref>).</p><p>Despite their many advantages, continuous long-term neural recordings are rarely performed. This is in large part because state-of-the-art methods for processing extracellular recordings require significant human input and hence make the analysis of large datasets prohibitively time-consuming (<xref ref-type="bibr" rid="bib56">Hengen et al., 2016</xref>). Our fast automated spike tracking (FAST) algorithm overcomes this bottleneck, thereby dramatically increasing the feasibility of continuous and high-throughput long-term recordings of extracellular signals in behaving animals.</p><sec id="s3-1"><title>Long-term stability of neural dynamics</title><p>Recording the activity of the same neuronal population over long time periods can be done by means of functional calcium imaging (<xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>). However, the calcium signal reports a relatively slow correlate of neural activity that can make it difficult to reliably resolve individual spike events and hence to assess fine timescale neuronal interactions (<xref ref-type="bibr" rid="bib50">Grienberger and Konnerth, 2012</xref>; <xref ref-type="bibr" rid="bib77">Lütcke et al., 2013</xref>). Furthermore, calcium indicators function as chelators of free calcium ions (<xref ref-type="bibr" rid="bib60">Hires et al., 2008</xref>; <xref ref-type="bibr" rid="bib123">Tsien, 1980</xref>) and could interfere with calcium-dependent plasticity processes (<xref ref-type="bibr" rid="bib136">Zucker, 1999</xref>) and, over the long-term, compromise the health of cells (<xref ref-type="bibr" rid="bib76">Looger and Griesbeck, 2012</xref>). These variables may have contributed to discrepancies in studies using longitudinal calcium imaging, with many reporting dramatic day-to-day fluctuations in neural activity patterns (<xref ref-type="bibr" rid="bib33">Driscoll et al., 2017</xref>; <xref ref-type="bibr" rid="bib63">Huber et al., 2012</xref>; <xref ref-type="bibr" rid="bib73">Liberti et al., 2016</xref>; <xref ref-type="bibr" rid="bib135">Ziv et al., 2013</xref>) while some others report more stable representations (<xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>), leaving open the question of how stable the brain really is (<xref ref-type="bibr" rid="bib23">Clopath et al., 2017</xref>).</p><p>While electrical measurements of spiking activity do not suffer from the same drawbacks, intermittent recordings may fail to reliably track the same neurons over multiple days (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1D–E</xref>) (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>). Attempts at inferring long-term stability of movement-related neural dynamics from such experiments have produced conflicting results, with many studies reporting stability (<xref ref-type="bibr" rid="bib14">Bondar et al., 2009</xref>; <xref ref-type="bibr" rid="bib21">Chestek et al., 2007</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib49">Greenberg and Wilson, 2004</xref>; <xref ref-type="bibr" rid="bib92">Nuyujukian et al., 2014</xref>), while others find significant fluctuations even within a single day (<xref ref-type="bibr" rid="bib17">Carmena et al., 2005</xref>; <xref ref-type="bibr" rid="bib79">Mankin et al., 2012</xref>; <xref ref-type="bibr" rid="bib95">Perge et al., 2013</xref>; <xref ref-type="bibr" rid="bib105">Rokni et al., 2007</xref>). Such contrasting findings could be due to systematic errors in unit tracking across discontinuous recording sessions (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>), or the choice of statistical framework used to assess stability (<xref ref-type="bibr" rid="bib105">Rokni et al., 2007</xref>; <xref ref-type="bibr" rid="bib119">Stevenson et al., 2011</xref>). Complications may also arise from the use of activity metrics, such as firing rate and ISI distributions, to track units in many studies (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>; <xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib49">Greenberg and Wilson, 2004</xref>; <xref ref-type="bibr" rid="bib64">Jackson and Fetz, 2007</xref>; <xref ref-type="bibr" rid="bib83">McMahon et al., 2014a</xref>; <xref ref-type="bibr" rid="bib94">Okun et al., 2016</xref>; <xref ref-type="bibr" rid="bib121">Thompson and Best, 1990</xref>; <xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>), which may bias datasets towards subsets of units whose spike waveforms (<xref ref-type="fig" rid="fig1">Figure 1C–D</xref>) and neural dynamics (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref>) do not change with time.</p><p>Our continuous recordings, which allow for the reliable characterization of single neuron properties over long time periods, suggest a remarkable stability in both spiking statistics (<xref ref-type="fig" rid="fig5">Figure 5</xref>), neuronal interactions (<xref ref-type="fig" rid="fig6">Figure 6</xref>), and tuning properties (<xref ref-type="fig" rid="fig7">Figures 7</xref> and <xref ref-type="fig" rid="fig8">8</xref>) of the majority of motor cortical and striatal units. Taken together with studies showing long-term structural stability at the level of synapses (<xref ref-type="bibr" rid="bib51">Grutzendler et al., 2002</xref>; <xref ref-type="bibr" rid="bib134">Yang et al., 2009</xref>), our findings support the view that these neural networks are, overall, highly stable systems, both in terms of their dynamics and connectivity.</p><p>Discrepancies between our findings and other studies that report long-term instability of neural activity could, in some cases, be due to inherent differences between brain areas. Neural dynamics of circuits involved in transient information storage such as the hippocampus (<xref ref-type="bibr" rid="bib79">Mankin et al., 2012</xref>; <xref ref-type="bibr" rid="bib135">Ziv et al., 2013</xref>), and flexible sensorimotor associations such as the parietal cortex (<xref ref-type="bibr" rid="bib88">Morcos and Harvey, 2016</xref>) may be intrinsically more unstable than circuits responsible for sensory processing or motor control (<xref ref-type="bibr" rid="bib44">Ganguly and Carmena, 2009</xref>; <xref ref-type="bibr" rid="bib84">McMahon et al., 2014b</xref>; <xref ref-type="bibr" rid="bib96">Peters et al., 2014</xref>; <xref ref-type="bibr" rid="bib106">Rose et al., 2016</xref>). In line with this hypothesis, recent studies have found higher synaptic turnover in the hippocampus (<xref ref-type="bibr" rid="bib7">Attardo et al., 2015</xref>) in comparison to primary sensory and motor cortices (<xref ref-type="bibr" rid="bib61">Holtmaat et al., 2005</xref>; <xref ref-type="bibr" rid="bib132">Xu et al., 2009</xref>; <xref ref-type="bibr" rid="bib134">Yang et al., 2009</xref>), although it is not clear whether structural plasticity functions to destabilize or stabilize neural activity (<xref ref-type="bibr" rid="bib23">Clopath et al., 2017</xref>). In this context, our long-term electrical recording and analysis platform could be used to verify whether spiking activity in these associative areas is as unstable as their reported calcium dynamics.</p><p>In this study we recorded from rats that had already learned a sequence task in order to answer the question: is the brain stable when behavior is stable? We hypothesize that neural activity would be far more variable when an animal is learning a task or motor skill (<xref ref-type="bibr" rid="bib67">Kawai et al., 2015</xref>). Our experimental platform makes it feasible to characterize learning-related changes in task representations and relate them to reorganization of network dynamics over long time-scales.</p></sec><sec id="s3-2"><title>Future improvements</title><p>There is a continued push to improve recording technology to increase the number of neurons that can be simultaneously recorded from (<xref ref-type="bibr" rid="bib11">Berényi et al., 2014</xref>; <xref ref-type="bibr" rid="bib16">Buzsáki et al., 2015</xref>; <xref ref-type="bibr" rid="bib34">Du et al., 2011</xref>; <xref ref-type="bibr" rid="bib126">Viventi et al., 2011</xref>), as well as make the recordings more stable (<xref ref-type="bibr" rid="bib3">Alivisatos et al., 2013</xref>; <xref ref-type="bibr" rid="bib22">Chestek et al., 2011</xref>; <xref ref-type="bibr" rid="bib24">Cogan, 2008</xref>; <xref ref-type="bibr" rid="bib43">Fu et al., 2016</xref>; <xref ref-type="bibr" rid="bib52">Guitchounts et al., 2013</xref>). Our modular and flexible experimental platform can easily incorporate such innovations. Importantly, our novel and automated analysis pipeline (FAST) solves a major bottleneck downstream of these solutions by allowing increasingly large datasets to be efficiently parsed, thus making automated recording and analysis of large populations of neurons in behaving animals a feasible prospect.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Animals</title><p>The care and experimental manipulation of all animals were reviewed and approved by the Harvard Institutional Animal Care and Use Committee. Experimental subjects were female Long Evans rats (RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/RGD_2308852">RGD_2308852</ext-link>), 3–8 months old at the start of the experiment (n = 5, Charles River).</p></sec><sec id="s4-2"><title>Behavioral training</title><p>Before implantation, rats were trained twice daily on a timed lever-pressing task (<xref ref-type="bibr" rid="bib67">Kawai et al., 2015</xref>) using our fully automated home-cage training system (<xref ref-type="bibr" rid="bib98">Poddar et al., 2013</xref>). Once animals reached asymptotic (expert) performance on the task, they underwent surgery to implant tetrode drives into dorsolateral striatum (n = 2) and motor cortex (n = 3) respectively. After 7 days of recovery, rats were returned to their home-cages, which had been outfitted with an electrophysiology recording extension (<xref ref-type="fig" rid="fig1">Figure 1A</xref>, <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). The cage was placed in an acoustic isolation box, and training on the task resumed. Neural and behavioral data was recorded continuously for 12–16 weeks with only brief interruptions (median time of 0.2 hr) for occasional troubleshooting.</p></sec><sec id="s4-3"><title>Continuous behavioral monitoring</title><p>To monitor the rats’ head movements continuously, we placed a small 3-axis accelerometer (ADXL 335, Analog Devices) on the recording head-stage (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). The output of the accelerometer was sampled at 7.5 kHz per axis. We also recorded 24/7 continuous video at 30 frames per second with a CCD camera (Flea 3, Point Grey) or a webcam (Agama V-1325R). Video was synchronized to electrophysiological signals by recording TTL pulses from the CCD cameras that signaled frame capture times.</p></sec><sec id="s4-4"><title>Surgery</title><p>Rats underwent surgery to implant a custom-built recording device (see ‘Tetrode arrays’). Animals were anesthetized with 1–3% isoflurane and placed in a stereotax. The skin was removed to expose the skull and five bone screws (MD-1310, BASi), including one soldered to a 200 µm diameter silver ground wire (786500, A-M Systems), were driven into the skull to anchor the implant. A stainless-steel reference wire (50 µm diameter, 790700, AM-Systems) was implanted in the external capsule to a depth of 2.5 mm, at a location posterior and contralateral to the implant site of the electrode array. A 4–5 mm diameter craniotomy was made at a location 2 mm anterior and 3 mm lateral to bregma for targeting electrodes to motor cortex, and 0.5 mm anterior and 4 mm lateral to bregma for targeting dorsolateral striatum. After removing the dura-mater, the pia-mater surrounding the implant site was glued to the skull with cyanoacrylate glue (Krazy glue). The pia-mater was then weakened using a solution of 20 mg/ml collagenase (Sigma) and 0.36 mM calcium chloride in 50 mM HEPES buffer (pH 7.4) in order to minimize dimpling of the brain surface during electrode penetration (<xref ref-type="bibr" rid="bib70">Kralik et al., 2001</xref>). The 16-tetrode array was then slowly lowered to the desired depth of 1.85 mm for motor cortex and 4.5 mm for striatum. The microdrive was encased in a protective shield and cemented to the skull by applying a base layer of Metabond luting cement (Parkell) followed by a layer of dental acrylic (A-M systems).</p></sec><sec id="s4-5"><title>Histology</title><p>At the end of the experiments, animals were anesthetized and anodal current (30 µA for 30 s) passed through select electrodes to create micro-lesions at the electrode tips. Animals were transcardially perfused with phosphate-buffered saline (PBS) and subsequently fixed with 4% paraformaldehyde (PFA, Electron Microscopy Sciences) in PBS. Brains were removed and post-fixed in 4% PFA. Coronal sections (60 µm) were cut on a Vibratome (Leica), mounted, and stained with cresyl violet to reconstruct the location of implanted electrodes. All electrode tracks were consistent with the recordings having been done in the targeted areas.</p></sec><sec id="s4-6"><title>Tetrode arrays</title><p>Tetrodes were fabricated by twisting together short lengths of four 12.5 µm diameter nichrome wires (Redi Ohm 800, Sandvik-Kanthal), after which they were bound together by melting their polyimide insulation with a heat-gun. An array of 16 such tetrodes was attached to a custom-built microdrive, advanced by a 0–80 threaded screw (~320 µm per full turn). The wires were electroplated in a gold (5355, SIFCO) and 0.1% carbon nanotubes (Cheap Tubes dispersed MWNTs, 95wt% &lt;8 nm) solution with 0.1% polyvinylpyrrolidone surfactant (PVP-40, Sigma-Aldrich) to lower electrode impedances to ~100–150 kΩ (<xref ref-type="bibr" rid="bib40">Ferguson et al., 2009</xref>; <xref ref-type="bibr" rid="bib69">Keefer et al., 2008</xref>). The prepared electrode array was then implanted into the motor cortex or striatum.</p></sec><sec id="s4-7"><title>Tethering system</title><p>We used extruded aluminum with integrated V-shaped rails for the linear-slide (Inventables, Part #25142–03), with matching wheels (with V-shaped grooves) on the carriage (Inventables, Part #25203–02). The bearings in the wheels were degreased and coated with WD-40 to minimize friction. The carriage plate was custom designed (design files available upon request) and fabricated by laser cutting 3 mm acrylic. A low-cost 15-channel commutator (SRC-022 slip-ring, Hangzhou-Prosper Ltd) was mounted onto the carriage plate. The commutator was suspended with a counterweight using low friction pulleys (Misumi Part # MBFN23-2.1). We used a 14 conductor cable (Mouser, Part # 517-3600B/14100SF) to connect our custom designed head-stage to the commutator. The outer PVC insulation of the cable bundle was removed to reduce the weight of the cable and to make it more flexible. The same cable was used to connect the commutator to a custom designed data acquisition system. This cable needs to be as flexible as possible to minimize forces on the animal’s head.</p></sec><sec id="s4-8"><title>Recording hardware</title><p>Our lightweight, low-noise and low-cost system for multi-channel extra-cellular electrophysiology (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>) uses a 64-channel custom-designed head-stage (made of 2 RHD2132 ICs from Intan Technologies), weighs less than four grams and measures 18 mm x 28 mm in size. The head-stage filters, amplifies, and digitizes extracellular neural signals at 16 bits/sample and 30 kHz per second per channel. An FPGA module (Opal Kelly XEM6010 with Xilinx Spartan-6 FPGA) interfaces the head-stage with a computer that stores and displays the acquired data. Since the neural signals are digitized at the head-stage, the system is low-noise and can support long cable lengths. Design files and a complete parts list for all components of the system are available on request. The parts for a complete 64-channel electrophysiology extension, including head-stage, FPGA board, commutator, and pulley system, but excluding the recording computer, cost less than $1500.</p></sec><sec id="s4-9"><title>Automatic classification of behavior</title><p>We developed an unsupervised algorithm to classify behaviors based on accelerometer data, LFPs, spike times, and task event times (<xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib125">Venkatraman et al., 2010</xref>). Behaviors were classified at 1 s resolution into one of the following ‘states’: repetitive (RP), eating (ET), active exploration (AX), task engagement (TK), quiet wakefulness (QW), rapid eye movement sleep (RM) or slow-wave sleep (SW).</p><sec id="s4-9-1"><title>Processing of accelerometer data</title><p>We computed the L<sup>2</sup> norm of the accelerometer signal <inline-formula><mml:math id="inf17"><mml:mfenced close="‖" open="‖" separators="|"><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> as follows:<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mfenced close="‖" open="‖" separators="|"><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:mfenced> <mml:mi mathvariant="normal"/><mml:mo>=</mml:mo><mml:msqrt><mml:msubsup><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:msqrt></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf18"><mml:msub><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the accelerometer signal on channel <inline-formula><mml:math id="inf19"><mml:mi>i</mml:mi></mml:math></inline-formula>. The accelerometer norm was then band-pass filtered between 0.5 Hz and 150 Hz using a fourth order Butterworth filter. We then computed the multitaper spectrogram (0–40 Hz) of the accelerometer signal in 1 s bins using Chronux (<xref ref-type="bibr" rid="bib86">Mitra and Bokil, 2007</xref>) and measured the total accelerometer power in the 2–5 Hz frequency bands. The accelerometer power had a bimodal distribution with one narrow peak at low values corresponding to immobility and a secondary broad peak corresponding to epochs of movement. Time-bins with accelerometer power within two standard deviations of the lower immobility peak were termed ‘inactive’, while time-bins with power greater than the ‘mobility threshold’ – four standard deviations above the immobility peak – were termed ‘active’.</p><p>To verify the accuracy of our accelerometer-based separation of active and inactive behaviors, we calculated the percent overlap between our automated separation with that of a human observer who manually scored active and inactive periods using simultaneously recorded webcam video data (n = 29831 s video from 4 rats).</p><p><table-wrap id="inlinetable1" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th/><th><italic>Inactive (auto)</italic></th><th><italic>Active (auto)</italic></th></tr></thead><tbody><tr><td><italic>Inactive (manual)</italic></td><td>92.9%</td><td>7.1%</td></tr><tr><td><italic>Active (manual)</italic></td><td>3.1%</td><td>96.9%</td></tr></tbody></table></table-wrap></p></sec><sec id="s4-9-2"><title>Processing of the LFP</title><p>We extracted LFPs by down-sampling the raw data 100-fold (from 30 kHz to 300 Hz) by two applications of a fourth order 5-fold decimating Chebychev filter followed by a single application of a fourth order 4-fold decimating Chebychev filter. We then computed the multitaper spectrogram (0–20 Hz) for the LFP signal recorded on each electrode with a moving window of width 5 s and step-size 1 s using Chronux (<xref ref-type="bibr" rid="bib86">Mitra and Bokil, 2007</xref>), and then averaged these spectrograms across all electrodes to yield the final LFP spectrogram. We used PCA to reduce the dimensionality of the spectrogram to 20 components and then fit a three component Gaussian mixture model to cluster the LFP spectrograms into three distinct brain states. Based on earlier studies (<xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib74">Lin et al., 2006</xref>), these states were characterized by high delta (0–4 Hz) power (e.g. slow wave sleep), high type-II theta (7–9 Hz) power (e.g. REM sleep or active exploration) and high type-I theta (5–7 Hz) power (e.g. quiet wakefulness or repetitive behaviors).</p></sec><sec id="s4-9-3"><title>Classification of inactive states – REM and slow-wave sleep, and quiet wakefulness</title><p>Inactive states, that is, when rats are immobile, were identified as bins with total accelerometer power below the immobility threshold (see ‘Processing of accelerometer data’ above). Slow-wave sleep (SW) states were distinguished by high delta power (see ‘Processing of the LFP’ above), REM sleep states (RM) were distinguished by high type-II theta power, and quiet wakefulness states (QW) were distinguished by high type-I theta power (<xref ref-type="bibr" rid="bib12">Bland, 1986</xref>; <xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib74">Lin et al., 2006</xref>). Consistent with prior studies (<xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>), we found that rats spent most of their time sleeping (44 ± 3%) or resting (6 ± 2%) (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1B</xref>). Sleep occurred at all hours, but was more frequent when lights were on (58 ± 7%) versus when they were off (33 ± 9%), consistent with the nocturnal habits of rats (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1C</xref>).</p></sec><sec id="s4-9-4"><title>Classification of active states – repetitive behaviors, eating, task engagement and active exploration</title><p>Active states were characterized by the accelerometer power being above the mobility threshold (see ‘Processing of accelerometer data’ above).</p><p><italic>Eating</italic> (ET) epochs were classified based on a strong, broad-band common-mode oscillatory signal on all electrodes, due to electrical interference from muscles of mastication. To extract eating epochs, we median-filtered the raw data across all channels, and computed a multitaper spectrogram between 0–40 Hz using Chronux, with window width 5 s and step-size 1 s. After reducing the dimensionality of the spectrogram to 20 by PCA, we fit a Gaussian mixture model and identified cluster(s) corresponding to the broad-band noise characteristic of eating.</p><p><italic>Task engagement</italic> (TK) was identified based on lever-press event times. If less than 2 s had elapsed between presses (corresponding to the average trial length) the time between them was classified as task engagement.</p><p>Active epochs that were not classified as eating or task engagement were classified as <italic>active exploration</italic> (AX) or <italic>repetitive behavior</italic> (RP) depending on whether they had high type II or high type I theta power in their LFP spectrograms, respectively, based on prior reports (<xref ref-type="bibr" rid="bib12">Bland, 1986</xref>; <xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib108">Sainsbury et al., 1987</xref>).</p><p>The algorithm labeled each time bin exclusively, i.e. only one label was possible for each bin. Bins corresponding to multiple states (e.g. eating and grooming) where classified as <italic>unlabeled</italic> (UL), as were times when no data was available due to brief pauses in the recording (9% of time-bins unlabeled).</p></sec><sec id="s4-9-5"><title>Removal of seizure-like epochs</title><p>Long Evans rats are susceptible to absence seizures, characterized by strong ~8 Hz synchronous oscillations in neural activity and associated whisker twitching (<xref ref-type="bibr" rid="bib10">Berke et al., 2004</xref>; <xref ref-type="bibr" rid="bib47">Gervasoni et al., 2004</xref>; <xref ref-type="bibr" rid="bib90">Nicolelis et al., 1995</xref>). To identify seizure-like episodes, we calculated the autocorrelation of the raw spike data on all electrodes in 2 s windows. To identify peaks associated with seizure-like states, we calculated the periodogram of each autocorrelation function and evaluated the power in the 7–9 Hz frequency range. The distribution of these values had a Gaussian shape with a non-Gaussian long tail towards high values. The threshold for seizure-like states was set to the 95<sup>th</sup> percentile of the Gaussian distribution. Using this classification, 11% of time-bins were classified as seizure (12 ± 2% for the DLS-implanted rats and 11 ± 2% for the MC-implanted rats) similar to previously published reports (<xref ref-type="bibr" rid="bib113">Shaw, 2004</xref>). These epochs were removed from the behavioral state analysis.</p></sec></sec><sec id="s4-10"><title>Data storage and computing infrastructure</title><sec id="s4-10-1"><title>Hardware setup</title><p>Our recordings (64-channels at 30 kHz per channel) generate 1 terabyte (TB) of raw data every 2 days. To cope with these demands, we developed a low-cost and reliable high I/O bandwidth storage solution with a custom lightweight fileserver. Each storage server consists of 24 4TB spinning SATA hard disks connected in parallel to a dual socket Intel server class motherboard via the high bandwidth PCI-E interface. The ZFS file-system (bundled with the open source SmartOS operating system) is used to manage the data in a redundant configuration that allows any two disks in the 24 disk array to simultaneously fail without data loss. Due to the redundancy, each server has 60 TB of usable space that can be read at approximately 16 gigabits per second (Gbps). This high I/O bandwidth is critical for data backup, recovery and integrity verification.</p></sec><sec id="s4-10-2"><title>Distributed computing software setup</title><p>To fully utilize available CPU and I/O resources, we parallelized the data processing (<xref ref-type="bibr" rid="bib27">Dean and Ghemawat, 2008</xref>). Thread-level parallelization inside a single process is the simplest approach and coordination between threads is orchestrated using memory shared between the threads. However, this approach only works for a single machine and does not scale to a cluster of computers. The typical approach to cluster-level parallelization is to coordinate the multiple parallel computations running both within a machine and across machines by exchanging messages between the concurrently running processes. The ‘map-reduce’ abstraction conceptualizes a computation as having two phases: a ‘map’ phase which first processes small subsets of the data in parallel and a ‘reduce’ phase which then serially aggregates the results of the ‘map’ phase. Since much of our data analysis is I/O limited (like computing statistics of spike waveform amplitudes), we developed a custom distributed computing infrastructure for ‘map-reduce’ like computations for the .NET platform. The major novelty in our framework is that rather than moving the output of the map computation over the network to a central node for performing the reduce computations, it instead moves the reduce computation to the machines containing the output of the map computations in the correct serial order. If the output of the map computation is voluminous compared to the output of each step of the reduce computation then our approach consumes significantly less time and I/O bandwidth. We have used this framework both in a virtual cluster of 5 virtual machines running on each of the afore-mentioned SmartOS-based storage servers and in Microsoft’s commercial cloud computing platform – Windows Azure.</p></sec></sec><sec id="s4-11"><title>Analysis of neural data</title><sec id="s4-11-1"><title>Automated spike-sorting algorithm</title><p>We developed a new and automated spike-sorting algorithm (<xref ref-type="bibr" rid="bib99">Poddar et al., 2017</xref>) that is able to efficiently track single units over long periods of time (code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Olveczky-Lab/FAST">https://github.com/Olveczky-Lab/FAST</ext-link>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/FAST">https://github.com/elifesciences-publications/FAST</ext-link>). Our offline algorithm first identifies the spikes from the raw recordings and then performs two fully automated processing steps. A list of important algorithm parameters and their recommended values is provided in <xref ref-type="table" rid="table1">Table 1</xref>.</p><table-wrap id="table1" position="float"><object-id pub-id-type="doi">10.7554/eLife.27702.022</object-id><label>Table 1.</label><caption><title>List of parameters for the fully automated steps of FAST and their recommended values.</title></caption><table frame="hsides" rules="groups"><thead><tr><th>Step</th><th valign="top">Parameter</th><th>Details</th><th>Recommended value</th></tr></thead><tbody><tr><td> Snippeting</td><td>block size</td><td>Length of data segment to filter and snippet per block</td><td>15 s</td></tr><tr><td> Snippeting</td><td>end padding</td><td>To account for edge effects in filtering</td><td>100 ms</td></tr><tr><td> Snippeting</td><td>waveform samples pre and post</td><td>Samples per spike snippet to record before and after peak (not including peak sample)</td><td>31 and 32 samples (total 64 samples @ 30 kHz sampling)</td></tr><tr><td> Snippeting</td><td>spike detection threshold</td><td>Threshold voltage to detect spikes</td><td>7 × median absolute deviation of recording</td></tr><tr><td> Snippeting</td><td>spike return threshold</td><td>Threshold voltage below which the spike detection process is reset</td><td>3 × median absolute deviation of recording</td></tr><tr><td> Snippeting</td><td>spike return number of samples</td><td>Number of samples the recorded voltage must stay under the spike return threshold to reset the spike detection process</td><td>8 samples (0.27 ms @ <break/>30 kHZ sampling rate)</td></tr><tr><td> Clustering: Step 1</td><td>spikes per block</td><td>Number of spikes per block for local clustering</td><td>1000 spikes</td></tr><tr><td> Clustering: Step 1</td><td>minimum and maximum SPC temps</td><td>Range of temperatures for super-paramagnetic clustering (SPC)</td><td>0, 15</td></tr><tr><td> Clustering: Step 1</td><td>Threshold for recursive merging of SPC tree (‘<italic>a’</italic>)</td><td>Threshold distance between leaf node and its parent node in the SPC tree below which the leaf node is merged with its parent.</td><td>20 µV</td></tr><tr><td> Clustering: Step 1</td><td>Minimum cluster size</td><td>Min. number of spikes in cluster to compute cluster centroid</td><td>15 spikes</td></tr><tr><td> Clustering: Step 1</td><td>Number of rounds of local clustering</td><td>Rounds of iterative multi-scale clustering</td><td>4</td></tr><tr><td> Clustering: Step 2</td><td>Spike centroids per block</td><td>Number of spike cluster centroids per block for generating SPC tree prior to segmentation fusion</td><td>1000 centroids</td></tr><tr><td> Clustering: Step 2</td><td>Cluster trees per block</td><td>Number of cluster trees per block for segmentation fusion</td><td>10 cluster trees</td></tr><tr><td> Clustering: Step 2</td><td>Segmentation fusion block overlap</td><td>Number of cluster trees overlap between blocks for segmentation fusion</td><td>5 cluster trees</td></tr><tr><td> Clustering: Step 2</td><td>‘<italic>s</italic>’, ‘<italic>k</italic>’</td><td>Parameters for sigmoid scaling of link weights to be between 0 and 1 in segmentation fusion</td><td><italic>s</italic> = 0.005, <italic>k</italic> = 0.03</td></tr><tr><td> Clustering: Step 2</td><td>Link similarity threshold</td><td>Similarity threshold for link weights between cluster trees in segmentation fusion</td><td>0.02 (range 0–1)</td></tr><tr><td> Clustering: Step 2</td><td>Link similarity threshold for straggler nodes</td><td>Similarity threshold for joining leftover nodes to an existing chain in segmentation fusion</td><td>0.02 (range 0–1)</td></tr></tbody></table></table-wrap></sec><sec id="s4-11-2"><title>Spike identification</title><p>We first extract spike snippets, that is, the extracellular voltage traces associated with action potentials, automatically from the raw data. A schematic of this process is shown in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>. First, the signal from each channel <inline-formula><mml:math id="inf20"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is partitioned into 15 s blocks with an additional 100 ms tacked onto each end of the block to account for edge effects in filtering. Then, for each block of each channel, the raw data is filtered with a fourth order elliptical band-pass filter (cut-off frequencies 300 Hz and 7500 Hz) first in the forward then the reverse direction to preserve accurate spike times and spike waveforms. For each sample in each block, the median across all channels is subtracted from every channel to eliminate common mode noise that may arise from rapid movement or behaviors such as eating (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4</xref>). Finally, a threshold crossing algorithm is used to detect spikes independently for each tetrode (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). In our recordings, we use a threshold of 50 µV, which corresponds to about 7 times the median absolute deviation (m.a.d.) of the signal (average m.a.d. = 7.6 ± 0.6 µV in our recordings), but we note that this value is not hard-coded in FAST and can be changed to an exact multiple of the measured noise. After detecting a threshold crossing, we find the sample that corresponds to the local maximum of the event, defined as the maximum of the absolute value across the four channels of a tetrode. A 2 ms (64 sample) snippet of the signal centered on the local maximum is extracted from all channels. Thus, each putative spike in a tetrode recording is characterized by the time of the local maximum and a 256 dimensional vector (64 samples x 4 channels).</p><p>Each 15 s block of each tetrode can be processed in parallel. However, since the number of spikes in any given 15 s block is not known in advance, the extracted spike snippets must be serially written to disk. Efficiently utilizing all the cores of the CPUs and simultaneously queuing disk read/write operations asynchronously is essential for keeping this step faster than real-time. In our storage server, the filtering/spike detection step runs 15 times faster than the acquisition rate. To extract LFPs, we down-sample the raw data 100-fold (from 30 kHz to 300 Hz) by two applications of a fourth order 5-fold decimating Chebychev filter followed by a single application of a fourth order 4-fold decimating Chebychev filter. After extracting the spike snippets and the LFPs, the raw data is deleted, resulting in a 5–10 fold reduction in storage space requirements.</p><p>A typical week-long recording from 16 tetrodes results in over a billion putative spikes. While most putative spikes are low amplitude and inseparable from noise, the spike detection threshold cannot be substantially increased without losing many cleanly isolatable single units. Assigning many billion putative spikes to clusters corresponding to single units in a largely automated fashion is critical for realizing the full potential of continuous 24/7 neural recordings.</p></sec><sec id="s4-11-3"><title>Automatic processing step 1. local clustering and de-noising</title><p>This step of the algorithm converts the sequence of all spike waveforms <inline-formula><mml:math id="inf21"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> from a tetrode to a sequence of averages of spike waveforms <inline-formula><mml:math id="inf22"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> with each averaging done over a set of approximately 100 raw spike waveforms (<inline-formula><mml:math id="inf23"><mml:mn>100</mml:mn><mml:mi>M</mml:mi><mml:mo>≅</mml:mo><mml:mi>N</mml:mi></mml:math></inline-formula>) with very similar shapes that are highly likely to be from the same unit. The output of this step of the algorithm is a partitioning of <inline-formula><mml:math id="inf24"><mml:mi>N</mml:mi></mml:math></inline-formula> spike waveforms into <inline-formula><mml:math id="inf25"><mml:mi>M</mml:mi></mml:math></inline-formula> groups. <inline-formula><mml:math id="inf26"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo> <mml:mi/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf27"><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi></mml:math></inline-formula>. Local clustering followed by averaging produces de-noised estimates of the spike waveform for each unit at each point in time. This results in a dataset of averaged spike waveforms that is about a hundred times smaller than the original dataset greatly aiding in speedily running the remaining half of the spike sorting algorithm and in visualizing the dataset.</p></sec><sec id="s4-11-4"><title>Super-paramagnetic clustering for dataset compression</title><p>Clustering is inherently a scale-dependent problem, that is, the ‘right’ number of clusters in a given dataset depends on the scale being considered. At the coarsest scale, all points can be considered members of a single cluster and at a very fine scale each point belongs to its own cluster. A formal, mathematically precise way of characterizing this tradeoff is to think of clustering as lossy compression (<xref ref-type="bibr" rid="bib117">Slonim et al., 2005</xref>). The amount of loss is defined as the amount of information lost by replacing each point in a cluster with their ‘average’ and the compression comes from characterizing the entire dataset with just the cluster averages. A simple loss measure is the sum of squared distances between each point in a cluster and the cluster centroid, that is, the within cluster variance. If each point is assigned its own unique cluster then the loss would be zero. Conversely, if all points were assigned the same cluster then the loss would simply be the variance of the entire set of points. For intermediate amount of loss between these two extremes, the fewest number of clusters, that is, the largest amount of compression, with at most that much loss, can, in principle, be computed. Conversely for a given number of clusters, one can compute the clustering that results in the smallest amount of loss.</p><p>We use the super-paramagnetic clustering (SPC) algorithm (<xref ref-type="bibr" rid="bib13">Blatt et al., 1996</xref>) in our spike sorting pipeline partly because it parameterizes the loss-compression tradeoff discussed above with a ‘temperature’ parameter. At low temperatures, the algorithm assigns all points to a single cluster. As the temperature parameter is increased new clusters appear until, at very high temperatures, each point is assigned its own cluster. Units with large spike waveforms or very distinctive spike shapes appear at relatively low temperatures. However, other units often appear at relatively high temperatures and clusters at higher temperatures often do not include spikes in the periphery of the cluster. In existing uses of this algorithm for spike sorting the ‘right’ temperature for each cluster is selected manually (<xref ref-type="bibr" rid="bib101">Quiroga et al., 2004</xref>). Often several clusters at a higher temperature need to be manually merged as they all correspond to the same single unit.</p><p>The SPC algorithm also requires a distance measure between pairs of points. In previous approaches to spike sorting, a small number of features (on the order of 10) are extracted from the full 256 dimensional dataset and the Euclidean distance between points in this new feature space is used as the distance measure for clustering (<xref ref-type="bibr" rid="bib101">Quiroga et al., 2004</xref>). In our experience the number of coefficients that are necessary to adequately capture the distinction between similar, but well isolated units varies substantially depending on the number of units being recorded on a tetrode and the signal-to-noise ratio of the recording. We find that simply using the Euclidean distance in the raw 256 dimensional space avoids this problem without being computationally prohibitive.</p></sec><sec id="s4-11-5"><title>Iterative multi-scale clustering for dataset compression</title><p>Two considerations determine the size of the batch for local clustering. First, SPC requires computing distances between every pair of points, making the algorithm quadratic in the number of points being clustered in one batch. In a typical desktop-class PC, a window size of 10000 spikes runs 8 times slower than real-time, whereas 1000 spike batches run faster than real-time. Second, changes in the spike waveform of a unit over time means that the space occupied by points belonging to a single cluster increases with the size of the temporal window (i.e. batch size), which in turn decreases the separation between clusters. Both of these considerations favor clustering relatively fewer spikes in a batch, and our algorithm does it in batches of 1000 spikes.</p><p>However, different neuron types can have very different firing rates (<xref ref-type="fig" rid="fig5">Figure 5</xref>). Therefore, a 1000 spike window might contain just a few or even no spikes from low firing rate units. To overcome this problem, we developed a multi-resolution approach for the local clustering step. It identifies clusters corresponding to units with high firing rates, then removes them from the dataset and then re-clusters the remaining spikes, repeating this process iteratively (<xref ref-type="fig" rid="fig2">Figure 2A–C</xref> and <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A–D</xref>).</p></sec><sec id="s4-11-6"><title>Detailed algorithm for local clustering and de-noising</title><p>The detailed steps of the algorithm for multi-resolution local clustering are described below and a schematic of the whole process is presented in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A–D</xref>.</p><list list-type="order"><list-item><p>The set of all spike waveforms is partitioned into blocks of 1000 consecutive points. Therefore, the first block contains points <inline-formula><mml:math id="inf28"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1000</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula>, the second block contains<inline-formula><mml:math id="inf29"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1001</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2000</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> and so on.</p></list-item><list-item><p>An SPC cluster tree is generated for each block independently. This is computed by first clustering the set of 1000 points at a range of temperatures<inline-formula><mml:math id="inf30"> <mml:mi/><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn><mml:mi>i</mml:mi><mml:mo>,</mml:mo> <mml:mi/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mn>15</mml:mn></mml:math></inline-formula>. This process assigns a cluster label to each point at each temperature. This matrix of cluster labels is then converted to a tree where each node in the tree corresponds to a cluster at some temperature, i.e. a subset of the 1000 points. The root node of the tree (depth 0) corresponds to a single cluster containing all 1000 points. The children of the root node (depth 1 nodes) correspond to a partition of the set of 1000 points based on the cluster labels at temperature 0.01. For each node in depth 1, the children of that node (depth 2 nodes) correspond to a partition of the points associated with that node based on the cluster labels of those points at A Series of Monographs and Textbooks (Academic Press). temperature 0.02. This is repeated for all temperatures to construct the full tree with depth equal to the number of temperature increments.</p></list-item><list-item><p>Each cluster tree is collapsed into a partition (a clustering) of the set of 1000 points (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>). The simplest technique for getting a partition from an SPC cluster tree is to use all the nodes at a fixed depth, i.e. clustering at a fixed temperature. In practice, this approach suffers from major drawbacks. The lowest temperature at which a cluster first separates from its neighbors varies from unit-to-unit and depends on the signal-to-noise ratio of the spike waveform, how distinct the spike waveform of that unit is, etc. Also, when units appear at relatively high temperatures, the clusters corresponding to single units at those temperatures don’t include many spikes at the periphery of those clusters. Therefore, instead of using a single temperature we recursively merge leaves of the cluster tree based on the loss-compression tradeoff discussed above to generate a partition. This is done by recursively collapsing the cluster tree one level at a time, a form of agglomerative hierarchical clustering (<xref ref-type="bibr" rid="bib5">Anderberg, 1973</xref>). Specifically,</p><list list-type="alpha-lower"><list-item><p>For each leaf node in the cluster tree, the similarity between the leaf node and its parent is first calculated. Let<inline-formula><mml:math id="inf31"> <mml:mi/><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math></inline-formula> be the leaf node which is specified by the indices of the subset of the 1000 points belonging to that node. Similarly, let<inline-formula><mml:math id="inf32"> <mml:mi/><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math></inline-formula> be the parent of the leaf node. Note that<inline-formula><mml:math id="inf33"> <mml:mi/><mml:mi>L</mml:mi> <mml:mi/><mml:mo>⊆</mml:mo><mml:mi>P</mml:mi></mml:math></inline-formula>. Let<inline-formula><mml:math id="inf34"> <mml:mi/><mml:mi mathvariant="bold-italic">l</mml:mi><mml:mo>=</mml:mo> <mml:mi/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> be the average spike waveform of the leaf node and <inline-formula><mml:math id="inf35"><mml:mi mathvariant="bold-italic">p</mml:mi></mml:math></inline-formula> be the average spike waveform of its parent. Let <inline-formula><mml:math id="inf36"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo> <mml:mi/><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>-</mml:mo> <mml:mi mathvariant="bold-italic"/><mml:mi mathvariant="bold-italic">l</mml:mi><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> be the total distance of points in the leaf node from their average and <inline-formula><mml:math id="inf37"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo> <mml:mi/><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>-</mml:mo> <mml:mi mathvariant="bold-italic"/><mml:mi mathvariant="bold-italic">p</mml:mi><mml:mo>|</mml:mo><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> be the distance from the parent node. The difference <inline-formula><mml:math id="inf38"><mml:mfrac bevelled="true"><mml:mrow><mml:msqrt><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:msqrt></mml:mrow><mml:mrow><mml:mi>ν</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, where <inline-formula><mml:math id="inf39"><mml:mi>ν</mml:mi></mml:math></inline-formula> is the degrees of freedom (256 waveform samples for a tetrode recording), measures how well the parent node approximates the leaf node, that is, how much additional loss is incurred in approximating the points in the leaf node with the cluster corresponding to the parent node.</p></list-item><list-item><p>Let<inline-formula><mml:math id="inf40"> <mml:mi/><mml:mi>L</mml:mi><mml:mo>=</mml:mo> <mml:mi/><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math></inline-formula> be the set of all N leaf nodes sharing the same parent node<inline-formula><mml:math id="inf41"> <mml:mi/><mml:mi>P</mml:mi></mml:math></inline-formula>. The set of leaf nodes that are poorly approximated by their parent (the well-isolated nodes<inline-formula><mml:math id="inf42"> <mml:mi/><mml:mi>I</mml:mi></mml:math></inline-formula>) are considered distinct clusters.<inline-formula><mml:math id="inf43"> <mml:mi/><mml:mi>I</mml:mi><mml:mo>⊆</mml:mo><mml:mi>L</mml:mi></mml:math></inline-formula>, where <inline-formula><mml:math id="inf44"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mi/><mml:mo>∈</mml:mo><mml:mi>I</mml:mi></mml:math></inline-formula> if<inline-formula><mml:math id="inf45"> <mml:mi/><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>a</mml:mi></mml:math></inline-formula>. This encodes the intuition that if a cluster at a given temperature splits into multiple sub-clusters at the next higher temperature that are each quite similar to the parent cluster, then treating each of these sub-clusters as distinct clusters is inappropriate. The parameter <inline-formula><mml:math id="inf46"><mml:mi>a</mml:mi></mml:math></inline-formula> provides an intuitive tradeoff between missing distinct clusters that appear at high temperatures and classifying spikes in the periphery of a single cluster into multiple distinct clusters. Let <inline-formula><mml:math id="inf47"><mml:mi>M</mml:mi></mml:math></inline-formula> be the number of elements in<inline-formula><mml:math id="inf48"> <mml:mi/><mml:mi>I</mml:mi></mml:math></inline-formula>. If any of the remaining <inline-formula><mml:math id="inf49"><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mi>M</mml:mi></mml:math></inline-formula> nodes are well approximated by one of the well-isolated nodes then they are merged together. For <inline-formula><mml:math id="inf50"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mi/><mml:mo>∈</mml:mo><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mi>I</mml:mi><mml:mo>,</mml:mo></mml:math></inline-formula> if<inline-formula><mml:math id="inf51"> <mml:mi/><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mi/><mml:mo>∈</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>-</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>&lt;</mml:mo><mml:mi>a</mml:mi></mml:math></inline-formula>, i.e. if node <inline-formula><mml:math id="inf52"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> approximates node <inline-formula><mml:math id="inf53"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> well then they are merged. Merging a set of nodes corresponds to creating a node containing all the points from each of the nodes being merged. This yields a set of augmented well-isolated nodes. Any remaining nodes, i.e. non-well-isolated nodes that are also not well-approximated by any of the well isolated nodes, are merged with each other. Therefore, this step results in converting the set of N leaf nodes sharing a parent into a set of <inline-formula><mml:math id="inf54"><mml:mi>M</mml:mi></mml:math></inline-formula>or <inline-formula><mml:math id="inf55"><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> nodes formed by merging some of them together. We set <inline-formula><mml:math id="inf56"><mml:mi>a</mml:mi></mml:math></inline-formula> to 20 µV, a value that was empirically determined to favor over-clustering of the SPC tree so as to prevent the incorporation of spikes from distinct units into the same local cluster.</p></list-item><list-item><p>A depth <inline-formula><mml:math id="inf57"><mml:mi>D</mml:mi></mml:math></inline-formula> tree is converted into a depth <inline-formula><mml:math id="inf58"><mml:mi>D</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> tree by replacing all the leaf nodes and their parents with the merged nodes derived in the previous step.</p></list-item><list-item><p>Step a – c are repeated recursively until the tree is of depth 1. The leaf nodes of this tree which are typically vastly fewer in number than the total number of leaf nodes of the original tree correspond to a partition of the set of 1000 points of each block.</p></list-item></list></list-item><list-item><p>The centroid of each cluster from the previous step containing at least 15 points contributes one element to the output of the local clustering step, the set of averaged spike waveforms<inline-formula><mml:math id="inf59"> <mml:mi/><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math></inline-formula> (<xref ref-type="fig" rid="fig2">Figure 2D</xref> and <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2C</xref>). In our datasets, clusters with at least 15 spikes in a 1000 spike window correspond to firing rates of approximately 1 Hz or greater, on average. The points belonging to the remaining clusters, that is, ones with fewer than 15 points, are all pooled together, ordered by their spike time and become the new<inline-formula><mml:math id="inf60"> <mml:mi/><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math></inline-formula>. The number of spikes in this new subset is approximately 10% of the original. Steps 1–4 are used to locally cluster this new subset of spikes and produce a second set of averaged spike waveforms<inline-formula><mml:math id="inf61"> <mml:mi/><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula>. This process of re-clustering the low-density clusters is repeated two more times. The averaged spike waveforms from all four scales are then grouped together to form the full set<inline-formula><mml:math id="inf62"> <mml:mi/><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> and ordered by the median spike time of set of spikes that were averaged to generate each<inline-formula><mml:math id="inf63"><mml:msub><mml:mrow> <mml:mi mathvariant="bold-italic"/><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. This process results in an assignment of over 98% of the original set of <inline-formula><mml:math id="inf64"><mml:mi>N</mml:mi></mml:math></inline-formula> spikes to a cluster with at least 15 spikes in one of the 4 scales. The firing rate of units in clusters with at least 15 spikes at the fourth scale is about 0.01 Hz in the sample dataset.</p></list-item></list></sec><sec id="s4-11-7"><title>Automatic processing step 2. sorting and tracking de-noised spike waveforms</title><p>This is FAST’s principal single-unit clustering and chaining step, that takes the sequence of averaged spike waveforms <inline-formula><mml:math id="inf65"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> computed in the previous step and identifies the subsets of <inline-formula><mml:math id="inf66"><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> that correspond to the same putative single unit. A subset of <inline-formula><mml:math id="inf67"><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> is considered to be the same single unit if distances between <inline-formula><mml:math id="inf68"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf69"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> are sufficiently small for the entire subset. As in the previous step, the set <inline-formula><mml:math id="inf70"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is first partitioned into blocks of 1000 consecutive points and an SPC cluster tree is independently computed for each block, this time for the temperature range<inline-formula><mml:math id="inf71"> <mml:mi/><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn><mml:mi>i</mml:mi><mml:mo>,</mml:mo> <mml:mi/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>i</mml:mi><mml:mo>≤</mml:mo><mml:mn>10</mml:mn></mml:math></inline-formula>. The rationale for the second round of SPC is to pool together averaged spike waveforms corresponding to the same unit both within and across the four iterations of local clustering and de-noising in Step 1 of FAST. In our datasets, Step 1 of FAST yields, on average, 8.0 ± 2.6 (mean ±SD, n = 80 tetrodes) cluster centroids per 1000 spike block. This means that a 1000 centroid block effectively encompasses ~125 blocks in Step 1, corresponding to 125000 spikes. Therefore, our multi-scale clustering approach ensures that single unit clusters are actually defined over relatively large windows spanning &gt;100000 spikes, thereby resulting in accurate clustering.</p><p>Next, we use a binary linear programming algorithm inspired by a computer vision problem called segmentation fusion (<xref ref-type="bibr" rid="bib124">Vazquez-Reina et al., 2011</xref>) to identify the nodes in each cluster tree that correspond to the same single unit.</p></sec><sec id="s4-11-8"><title>Binary linear programming allows units to be tracked over time</title><p>Tracking multiple single units over time from a sequence of cluster trees requires first selecting a subset of the nodes of each cluster tree that correspond to distinct units, followed by matching nodes from adjacent cluster trees that correspond to the same unit. Doing these steps manually is infeasible because of the large volumes of data. In our datasets, the local-clustering step results in ~100 million averaged spikes from the original set of ~10 billion spikes per rat. This produces a set of ~100,000 cluster trees making manual tracking impossibly labor intensive. We instead adapted the segmentation fusion algorithm, invented to solve the problem of reconstructing the full 3D structure of axons, dendrites and soma present in a volume of neuropil from a stack of 2D electron microscopy sections (<xref ref-type="bibr" rid="bib68">Kaynig et al., 2015</xref>; <xref ref-type="bibr" rid="bib124">Vazquez-Reina et al., 2011</xref>). A cluster tree is analogous to a multi-resolution segmentation of the 2D image. Identifying nodes across cluster trees that correspond to the same single unit is thus analogous to identifying the same segment across 2D sections as a neurite courses through the neuropil.</p><p>The algorithm finds a set of sequences of nodes from the sequence of cluster trees, where each sequence of nodes corresponds to a well isolated single unit. This is done by first enumerating all the nodes in all the cluster trees and all possible links between nodes in adjacent cluster trees. Then a constrained optimization problem is solved to find a subset of nodes and links that maximize a score that depends on the similarity between nodes represented by a link and the ‘quality’ of a node. This maximization is constrained to disallow assigning the same node to multiple single units and to ensure that if a link is selected in the final solution then so are the nodes on each side of the link.</p></sec><sec id="s4-11-9"><title>Details of the binary linear programming algorithm</title><p>Each step of the binary linear programming algorithm is detailed below (see also <xref ref-type="fig" rid="fig2">Figure 2D,E</xref> and <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2E,F</xref>).</p><list list-type="order"><list-item><p>The sequence of cluster trees is grouped into blocks of 10 consecutive trees with an overlap of 5 cluster trees. Solving the binary linear program for blocks larger than 10 trees is computationally prohibitive.</p></list-item><list-item><p>The segmentation fusion algorithm is run independently for each block of 10 cluster trees (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2E</xref>). Let <inline-formula><mml:math id="inf72"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi> <mml:mi/><mml:mo>=</mml:mo> <mml:mi/><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi> <mml:mi/><mml:mo>=</mml:mo> <mml:mi/><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> be the set of binary indicator variables representing all nodes in all 10 cluster trees where the cluster tree indexed by <inline-formula><mml:math id="inf73"><mml:mi>i</mml:mi></mml:math></inline-formula> contains a total of <inline-formula><mml:math id="inf74"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> nodes. The total number of nodes is<inline-formula><mml:math id="inf75"> <mml:mi/><mml:mi>N</mml:mi><mml:mo>=</mml:mo> <mml:mi/><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. Let <inline-formula><mml:math id="inf76"><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi> <mml:mi/><mml:mo>=</mml:mo> <mml:mi/><mml:mn>1</mml:mn><mml:mo>,</mml:mo> <mml:mi/><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo> <mml:mi/> <mml:mi/><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi> <mml:mi/><mml:mo>=</mml:mo> <mml:mi/><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>9</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> be the variables representing the set of all links between adjacent cluster trees. Link <inline-formula><mml:math id="inf77"><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> connects clusters <inline-formula><mml:math id="inf78"><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> and<inline-formula><mml:math id="inf79"><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula>. The total number of links is<inline-formula><mml:math id="inf80"> <mml:mi/><mml:mi>M</mml:mi><mml:mo>=</mml:mo> <mml:mi/><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>9</mml:mn></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. Solving the linear program requires choosing a <inline-formula><mml:math id="inf81"><mml:mo>{</mml:mo><mml:mn>0,1</mml:mn><mml:mo>}</mml:mo></mml:math></inline-formula> value for each of the <inline-formula><mml:math id="inf82"><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mi>M</mml:mi></mml:math></inline-formula> binary variables that maximizes the objective function<inline-formula><mml:math id="inf83"> <mml:mi/><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo> <mml:mi/><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:mn>0.02</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>. The objective function is a weighted linear sum of all the binary variables where the cluster weights <inline-formula><mml:math id="inf84"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> represent the ‘quality’ of the cluster and the link weights <inline-formula><mml:math id="inf85"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> represent the similarity of the clusters joined by the link. The link weights are numbers in the range <inline-formula><mml:math id="inf86"> <mml:mi/><mml:mo>(</mml:mo><mml:mn>0,1</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula>. The threshold of 0.02 serves to give negative weight to links between sufficiently dissimilar clusters, effectively constraining the value of the variables representing those links to 0. This objective function is to be optimized subject to three sets of constraints. The first<inline-formula><mml:math id="inf87"><mml:mo>,</mml:mo> <mml:mi/><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>≤</mml:mo> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo> <mml:mi/></mml:math></inline-formula>enforces the constraint that if the node variable <inline-formula><mml:math id="inf88"><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is assigned a value of 1 then out of all the outgoing links from the node <inline-formula><mml:math id="inf89"> <mml:mi/><mml:msubsup><mml:mrow><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:math></inline-formula>, at most one is chosen (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2F</xref>, top). Similarly, the second set of constraints, <inline-formula><mml:math id="inf90"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>≤</mml:mo><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, enforces the requirement that at most one incoming link to a node is chosen (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2F</xref>, middle). The third set of constraints enforces the requirement that for each of the 1000 points in a cluster tree at most one of the nodes containing that point is chosen (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2F</xref>, bottom). This translates to inequalities <inline-formula><mml:math id="inf91"><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi> <mml:mi/><mml:mo>∈</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> where the set of indices <inline-formula><mml:math id="inf92"><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents nodes in the path from the root of cluster tree <inline-formula><mml:math id="inf93"><mml:mi>i</mml:mi></mml:math></inline-formula> to the <inline-formula><mml:math id="inf94"><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> leaf node of the cluster tree. Therefore, the total number of constraints of this type for each cluster tree is the number of leaf nodes in that cluster tree. The link weight <inline-formula><mml:math id="inf95"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is the Euclidean distance between the average spike waveform of clusters <inline-formula><mml:math id="inf96"><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> and<inline-formula><mml:math id="inf97"><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> non-linearly scaled by a sigmoid function to fall in the range <inline-formula><mml:math id="inf98"> <mml:mi/><mml:mo>(</mml:mo><mml:mn>0,1</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula>. If <inline-formula><mml:math id="inf99"><mml:mi>d</mml:mi></mml:math></inline-formula> is the distance then<inline-formula><mml:math id="inf100"> <mml:mi/> <mml:mi/><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo> <mml:mi mathvariant="normal"/><mml:mi mathvariant="normal">a</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>-</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>d</mml:mi><mml:mo>-</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mo>,</mml:mo> <mml:mi/><mml:mi mathvariant="normal">s</mml:mi> <mml:mi mathvariant="normal"/><mml:mo>=</mml:mo> <mml:mi mathvariant="normal"/><mml:mn>0.005</mml:mn><mml:mo>,</mml:mo> <mml:mi mathvariant="normal"/><mml:mi mathvariant="normal">k</mml:mi><mml:mo>=</mml:mo><mml:mn>0.03</mml:mn></mml:math></inline-formula>. The parameter <inline-formula><mml:math id="inf101"><mml:mi>s</mml:mi></mml:math></inline-formula> controls the steepness of the sigmoid and the parameter <inline-formula><mml:math id="inf102"> <mml:mi/><mml:mi>k</mml:mi></mml:math></inline-formula> sets the distance <inline-formula><mml:math id="inf103"> <mml:mi/><mml:mi>d</mml:mi> <mml:mi/></mml:math></inline-formula>at which<inline-formula><mml:math id="inf104"> <mml:mi/><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:math></inline-formula>. The cluster weight <inline-formula><mml:math id="inf105"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup> <mml:mi/></mml:math></inline-formula>gives preference to clean well-isolated clusters, i.e. clusters that appear at low temperatures and retain most of their points across a large temperature range. Let <inline-formula><mml:math id="inf106"><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> be the number of points in the cluster corresponding to <inline-formula><mml:math id="inf107"> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>. Let <inline-formula><mml:math id="inf108"> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> be the largest cluster amongst the child nodes of <inline-formula><mml:math id="inf109"><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup> <mml:mi/></mml:math></inline-formula>and let <inline-formula><mml:math id="inf110"><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> be the number of points in <inline-formula><mml:math id="inf111"> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>. Similarly let <inline-formula><mml:math id="inf112"><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> be the number of points in the largest cluster among the child nodes of <inline-formula><mml:math id="inf113"> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>. Given the sequence of cluster sizes <inline-formula><mml:math id="inf114"><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo> <mml:mi/><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> where <inline-formula><mml:math id="inf115"><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> is the number of points in a leaf node of cluster tree, <inline-formula><mml:math id="inf116"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is defined as <inline-formula><mml:math id="inf117"> <mml:mi/><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:math></inline-formula>. This measure of cluster quality penalizes clusters that split into smaller clusters at higher temperatures and clusters that only appear at high temperatures.</p></list-item><list-item><p>The results of the previous step, i.e. the subset of the M links of each block that maximizes the objective function, are finally combined to produce a sorting that tracks single units over long time periods despite gradually changing waveforms. Links that are part of two instances of the segmentation fusion procedure due to the overlap mentioned in step 1 are only included in the final solution if both linear programs include them. The set of links chosen by the segmentation fusion algorithm are chained together to get long chains of clusters. For instance if links <inline-formula><mml:math id="inf118"><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow> <mml:mi/><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> are assigned values of 1 in the solution to the segmentation fusion linear program then all points in clusters <inline-formula><mml:math id="inf119"><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>,</mml:mo> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>,</mml:mo> <mml:mi/><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> belong to the same chain and hence the same single unit. Each point that does not belong to any chain is assigned to the chain containing points most similar to it (as measured using the sigmoidal distance of step 2) as long as the similarity <inline-formula><mml:math id="inf120"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0.02</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> (again the same threshold as used in step 2).</p></list-item></list></sec><sec id="s4-11-10"><title>Merging the chain of nodes and links identified by the binary linear programming algorithm</title><p>Often, spike waveforms have multiple equal amplitude local extrema. Since the waveforms are aligned to the local extrema with the largest amplitude during the spike identification phase, different waveforms from the same unit can be aligned to different features of the waveform. This results in multiple chains for the same single unit since the Euclidean distance between waveforms aligned to different features is very large. This is remedied by merging chains that contain spikes from the same recording interval if the translation-invariant distance between the spike waveforms of the chains is sufficiently low in the overlap region. The translation invariant distance is computed by first calculating the distance between a pair of spike waveforms for a range of relative shifts between the pair and then taking the minimum of this set of distances. Overlapping chains with the smallest translation-invariant distance are first merged. This is done recursively until either no overlap between chains remains or overlapping chains have distinct spike waveforms and hence correspond to different simultaneously recorded single units.</p></sec><sec id="s4-11-11"><title>Drift correction rate of the FAST algorithm</title><p>The time-period over which FAST assumes that spike waveforms are stable (the ‘tracking time-scale’) is a function of both the mean event detection rate and the number of distinct units simultaneously recorded on the electrode. The event detection rate sets the time-scale of the 1000 spike local-clustering block. The number of simultaneously recorded units scales with the average number of clusters in each 1000 spike block, and sets the time-scale of the 1000 centroid block.</p><p>In our recordings, the mean event detection rate was 62.4 ± 39.0 Hz (mean ± SD, n = 80 tetrode recordings), resulting in an average duration of 16 s for a 1000 spike block. If all spikes belonged to the same unit and the local clustering step yielded only 1 centroid per 1000 spike block, a 1000 centroid block would span 16*1000/1 = 16000 s or 4.5 hr; this represents the slowest possible tracking rate. On the other hand, if we were recording from 1000/15 ~ 66 distinct units with equal firing rates (so as to ensure that the number of spikes per unit per block exceeded the minimum cluster size of 15), the local clustering step would yield 66 centroids per 1000 spike block and a 1000 centroid block would span only 16*1000/66 = 242 s or 4 min; this represents the fastest possible tracking rate. In our own recordings, local clustering in Step 1 yielded centroids at a rate of 8.0 ± 2.6 per 1000 spike block. This yields an approximate tracking time-scale of 16*1000/8 = 2000 s or 33 min.</p><p>The ‘tracking time-scale’ should be treated more as a guideline than an upper limit on FAST’s drift correction rate. This is because FAST employs superparamagnetic clustering which can also sort the non-Gaussian shaped clusters that are an outcome of electrode drift (<xref ref-type="bibr" rid="bib101">Quiroga et al., 2004</xref>; <xref ref-type="bibr" rid="bib103">Rey et al., 2015b</xref>).</p></sec><sec id="s4-11-12"><title>Visualization and manual verification</title><p>The final output of the unsupervised spike sorting algorithm consists of long chains (median length = 10.2 hr) corresponding to single-unit spikes linked over time. However, our algorithm does not link spike chains over discontinuities in recording time (i.e. across recording files), or in the case of rapid changes in spike shape that occasionally occur during the recording, or when spike amplitudes drift under 75 μV for brief periods. In such cases, we have to link, or ‘merge’ chains across these discontinuities.</p><p>In order to visualize, merge and manually inspect the unsupervised chains, we developed a MATLAB program (<xref ref-type="bibr" rid="bib28">Dhawale et al., 2017a</xref>) with a graphical user interface (available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Olveczky-Lab/FAST-ChainViewer">https://github.com/Olveczky-Lab/FAST-ChainViewer</ext-link>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/FAST-ChainViewer">https://github.com/elifesciences-publications/FAST-ChainViewer</ext-link>). Our program allows users to semi-automatically merge chains belonging to the same unit across discontinuities, based on end-to-beginning similarity in their spike waveforms and inter-spike interval distributions (correlation coefficient between spike-waveforms or ISI distributions &gt;= 0.9). We merge chains only if the time-gap between the end of one chain and the beginning of the next is less than 5 hr of recording time, or up-to 24 hr in the case of gaps in recording time (which in the experiments we report on were, on average, 2 hr). In our dataset, the number of manual mergers required per unit was, on average, 14.7 ± 30.6 (mean ± SD), which translated to an average of 1.3 manual chain mergers per tetrode per day.</p><p>No automated spike-sorting method is perfect. Occasionally, the completely unsupervised section of the algorithm (Steps 1 and 2) makes errors in spike-sorting by merging spikes from multiple units in the same chain. This typically happens when spike amplitudes drift close to background noise, or when spike waveforms corresponding to distinct units are very similar to each other in segments of the recording. In order to identify such missorting, we visually inspect raw spike waveforms of those chains whose amplitudes are below 100 μV or whose average waveforms have a greater than 0.9 correlation to multiple preceding or succeeding chains using the manual spike-sorting MClust software (MClust 4.3, A. D. Redish et al). In the event of mis-sorting (only 2% of all unit chains, or 0.027 chains per tetrode per day), we manually split these chains using MClust.</p><p>We manually merge pairs of units with identical spike shapes, but distinct spike amplitudes, if their spike-time cross-correlograms are highly asymmetric around 0 ms and show a distinct refractory period, as these distinct clusters most likely arose from the same bursting unit. We typically exclude clusters whose spike-waveforms are complex and are likely to result from simultaneous spiking from multiple units.</p><p>In our hands, it takes about 8 human hours to perform manual verification of the automated output of FAST applied to a 3 month long recording on a single tetrode, or approximately 130 hrs to process all 16 tetrodes in our recording array. Thus manual verification proceeds at a rate about 5.5 times faster than the rate of data-acquisition, which is nearly twice as fast as the slowest automated step of FAST (Step 1). A recommended workflow for the manual steps is illustrated in <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>.</p><p>All subsequent analysis of neural data was carried out using custom scripts in Matlab (Mathworks). See the sections below for detailed description of the analyses.</p></sec></sec><sec id="s4-12"><title>Validation of FAST’s spike sorting performance with ground-truth datasets</title><sec id="s4-12-1"><title>Processing of simultaneous extracellular-intracellular recording datasets</title><p>We processed these datasets (<xref ref-type="bibr" rid="bib57">Henze et al., 2009</xref>) as described in earlier studies (<xref ref-type="bibr" rid="bib37">Ekanadham et al., 2014</xref>; <xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>). Briefly, we high-pass filtered the intracellular trace at 250 Hz with a third order Butterworth filter and detected peaks larger than four standard deviations of the baseline noise to identify intracellular (ground truth) spike times. Since FAST requires a minimum of ~10<sup>6</sup> spikes for clustering, we concatenated 20–50 identical copies of the relatively short duration recordings from (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>) to construct a ‘longer’ recording. After using FAST to spike-sort the concatenated recording, we measured its median sorting performance over all 20–50 copies of each dataset.</p></sec><sec id="s4-12-2"><title>Generation of synthetic long-term extracellular recordings</title><p>We created realistic synthetic long-term extracellular recordings (sample available at <xref ref-type="bibr" rid="bib29">Dhawale et al., 2017b</xref>) (n = 6, <xref ref-type="fig" rid="fig3">Figure 3C</xref>) as follows. To incorporate realistic signal-independent variability arising from thermal or amplifier noise, we identified a tetrode in our dataset with a negligible number of detected spikes. To this ‘blank’ recording, we added spikes from eight distinct simulated units. To do this, we first generated a ‘spike library’ of ~1000 different unit waveforms and firing rates varying over 3 orders of magnitude from our own long-term recordings in the motor cortex and striatum. From this library, we drew eight units at random per tetrode, ensuring that 20% of selected units were interneurons. For each unit, we generated spike times at 300 kHz precision over the 256 hr time-period of the simulated recording following a homogenous Poisson process with rate equal to the firing rate of that unit in our ‘spike library’, and an absolute refractory period of 1.5 ms. Spike waveforms corresponding to each unit were up-sampled to 300 kHz by cubic interpolation and scaled to an appropriate spike amplitude before being down-sampled to 30 kHz and added to the ‘blank’ tetrode recording. The up-sampling followed by down-sampling procedure was done to simulate jitter in the alignment of spike waveforms by the data acquisition and snippeting process (<xref ref-type="bibr" rid="bib107">Rossant et al., 2016</xref>).</p><p>The spike amplitude of each unit drifted over time according to a geometric random walk with bounds, as shown in <xref ref-type="disp-formula" rid="equ2">equation 2</xref> (<xref ref-type="bibr" rid="bib107">Rossant et al., 2016</xref>). We also add independent signal-dependent variability that scales with the spike amplitude, as shown in <xref ref-type="disp-formula" rid="equ2">equation 2</xref> (<xref ref-type="bibr" rid="bib82">Martinez et al., 2009</xref>; <xref ref-type="bibr" rid="bib107">Rossant et al., 2016</xref>).<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msqrt><mml:mi>β</mml:mi><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:msqrt><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfenced></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf121"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msqrt><mml:mi>β</mml:mi><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:msqrt><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf122"><mml:mi>ϵ</mml:mi><mml:mo>~</mml:mo><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula></p><p>where <inline-formula><mml:math id="inf123"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the amplitude of a unit’s spike at time <inline-formula><mml:math id="inf124"><mml:mi>t</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf125"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the amplitude of unit’s spike after time lag of <inline-formula><mml:math id="inf126"><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf127"><mml:mi>β</mml:mi><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:math></inline-formula> represents the variance of the geometric random walk, <inline-formula><mml:math id="inf128"><mml:mi>α</mml:mi></mml:math></inline-formula> represents the scaling parameter for the signal-dependent variability in spike amplitude, <inline-formula><mml:math id="inf129"><mml:mi>ϵ</mml:mi></mml:math></inline-formula> represents a random number drawn from the standard Gaussian distribution, and <inline-formula><mml:math id="inf130"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf131"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represent the minimum and maximum bounds, respectively, on the random walk, for a given electrode. We empirically determined the values for <inline-formula><mml:math id="inf132"><mml:mi>α</mml:mi></mml:math></inline-formula> (0.1) and <inline-formula><mml:math id="inf133"><mml:mi>β</mml:mi></mml:math></inline-formula> (10<sup>−6</sup> s<sup>−1</sup>) by analyzing variations in spike amplitudes in our long-term recordings, as shown in <xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2A–B and C–D</xref>, respectively. <inline-formula><mml:math id="inf134"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> was set to 75 µV for all electrodes to ensure that spike amplitudes did not drift below the spike detection threshold, while <inline-formula><mml:math id="inf135"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> was drawn independently for each electrode from an exponential distribution within the range 150 to 400 µV. The exponent of the <inline-formula><mml:math id="inf136"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> distribution (−0.005 µV<sup>−1</sup>) was empirically determined from the observed distribution of maximum spike amplitudes in our recording dataset (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2E</xref>). Finally, we also added low amplitude, multi-unit ‘background activity’ to the recording representing the contribution of units farther away from the recording electrode (<xref ref-type="bibr" rid="bib82">Martinez et al., 2009</xref>). This background activity consisted of 40 distinct units drawn from our spike library, each firing at 0.5 Hz to yield a total background firing rate of 20 Hz. Background spike amplitudes were drawn from a Gaussian distribution with mean 50 µV (our spike detection threshold) and standard deviation 25 µV.</p></sec><sec id="s4-12-3"><title>Calculation of best ellipsoidal error rate (BEER)</title><p>Our calculations of the BEER measure were similar to previous studies (<xref ref-type="bibr" rid="bib37">Ekanadham et al., 2014</xref>; <xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>). For each spike, we calculated a spike feature vector consisting of the top 3 principal component projections of the spike waveform on each of the 4 electrodes, yielding a total of 12 features per spike per tetrode. We then trained a support vector machine (SVM) classifier, using a training subset of the data, to find a quadratic boundary in feature space best separating spikes belonging to the unit of interest and all other detected spikes. We then tested the classification performance of the trained SVM on a separate test subset of spikes. As the synthetic datasets are extremely large - up to 5e7 spikes per tetrode - we used smaller subset of the spikes for training and testing the SVM (~1e5 spikes in each set), after verifying that this did not affect the accuracy of the classifier (data not shown). To vary the relative importance of false positive versus false negative errors, we systematically varied their relative classification costs for the SVM over two orders of magnitude to yield receiver-operator characteristic (ROC) curves, as shown in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref>. We considered the BEER error rate to be the minimum error on this ROC curve (i.e. assuming equal weight for false-positive and false-negative errors).</p></sec></sec><sec id="s4-13"><title>Analysis of long-term recordings</title><sec id="s4-13-1"><title>Cluster quality</title><p>After spike sorting, we computed standard measures of cluster quality, specifically the isolation distance (<xref ref-type="bibr" rid="bib55">Harris et al., 2000</xref>), L-ratio (<xref ref-type="bibr" rid="bib111">Schmitzer-Torbert et al., 2005</xref>) and fraction of inter-spike intervals violating the absolute refractory period (2 ms), for every unit within consecutive one-hour blocks. Isolation distances and L-ratios were calculated with four features for every electrode channel – the waveform peak, waveform energy (L<sup>2</sup> norm), and the projections of the spike waveforms on the first two principal components of all spike waveforms in the one-hour block. Only units meeting all of our quality criteria (isolation distance =&gt; 25, L-ratio &lt;= 0.3, fraction ISI less than 2 ms &lt;= 0.01) in a particular block were subjected to further analysis. The average signal-to-noise ratio (SNR) was for each unit was calculated by dividing the average spike amplitude by a consistent estimator of the standard deviation of the baseline – namely the median absolute deviation of the filtered recording multiplied by 1.4826. For every unit, we report its maximum SNR across the four electrode channels of a tetrode.</p></sec><sec id="s4-13-2"><title>Discontinuous tracking of units across days</title><p>We identified units present (&gt;=50 spikes fired) in daily one-hour ‘sessions’ from 10 to 11 am, during execution of a skilled motor sequence task (<xref ref-type="bibr" rid="bib67">Kawai et al., 2015</xref>). We computed four measures of unit similarity across consecutive days’ sessions (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1A</xref>), namely the Euclidean distance and correlation coefficient (<xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>) between average unit spike waveforms (waveforms recorded on different channels of a tetrode were concatenated together to yield a 256-element vector), the correlation coefficient between units’ inter-spike interval histograms (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>) (see below), and the absolute difference in firing rates (<xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>). Correlation coefficients were Fisher transformed, and spike waveform Euclidean distance and firing rates were log-transformed to appear more Gaussian (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>) (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1A</xref>). Similarity metrics were calculated for all pairs of units recorded on the same tetrode across consecutive sessions/days and classified as either the ‘same’ or ‘different’ as per our FAST algorithm. Linear discriminant analysis (LDA) (<xref ref-type="bibr" rid="bib122">Tolias et al., 2007</xref>) was then used to identify a similarity threshold that would best separate ‘same’ from ‘different’ unit pairs at false positive error rates ranging from 25% (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>) to 5% (<xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>), 1% and 0.2%. Here, false positive rates are defined as the proportion of ‘different’ units misclassified by the classifier as the ‘same’. We also tried a quadratic classifier (<xref ref-type="bibr" rid="bib30">Dickey et al., 2009</xref>; <xref ref-type="bibr" rid="bib42">Fraser and Schwartz, 2012</xref>) but found no significant difference in performance compared to the linear classifier. LDA fits multidimensional Gaussians to the similarity distributions identified by ‘same’ or ‘different’ class labels. Therefore, assuming a uniform prior, we can calculate the posterior probability of a unit pair being part of the ‘same’ distribution and use it as a similarity score. Units were matched across consecutive daily ‘sessions’ if their similarity scores exceeded the threshold set by the expected false positive rate, with highest similarity unit pairs being matched first (<xref ref-type="bibr" rid="bib38">Emondi et al., 2004</xref>). Thus, in order to track a unit across 20 days, it would have to be serially matched across 19 pairs of consecutive recording sessions.</p></sec><sec id="s4-13-3"><title>Identification of putative cell types</title><p>We used mean spike waveforms and average firing rate (<xref ref-type="bibr" rid="bib9">Barthó et al., 2004</xref>; <xref ref-type="bibr" rid="bib10">Berke et al., 2004</xref>) to separate units into putative cell types: medium spiny neurons (MSNs) and fast spiking neurons (FS) in the striatum, and regular spiking (RS) and fast spiking (FS) neurons in the cortex. Briefly, we performed k-means clustering of units based on their peak-normalized spike-waveform, concatenated with their log-transformed firing rates. The number of clusters (k = 2) was chosen by visual inspection of unit waveforms in three dimensional space, i.e. the first and second principal components of the spike waveform, and unit firing rate.</p></sec><sec id="s4-13-4"><title>Firing rate stability</title><p>Firing rate similarity compared across different days <inline-formula><mml:math id="inf137"><mml:mi>i</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf138"><mml:mi>j</mml:mi></mml:math></inline-formula> for the same unit, or when comparing distinct units <inline-formula><mml:math id="inf139"><mml:mi>i</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf140"><mml:mi>j</mml:mi></mml:math></inline-formula> recorded on the same day, was measured by the following formula:<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi> <mml:mi/><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf141"><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:math></inline-formula> is the firing rate. A firing rate similarity score of 1 means that the two firing rates <inline-formula><mml:math id="inf142"><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf143"><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are identical while a firing rate similarity score of −1 implies maximum dissimilarity in firing rates, such that one of the firing rates is 0. When comparing firing rates for the <italic>same unit across time</italic>, we calculated average firing rate similarity scores for time-lags ranging from 1 to 20 days. When comparing firing rates <italic>across units</italic> and within the same time-bin, we averaged together all similarity scores for pairs of units of the same putative unit-type recorded in that time-bin.</p></sec><sec id="s4-13-5"><title>Stability of inter-spike interval (ISI) distribution</title><p>We computed ISI histograms using 50 log-spaced time-bins spanning inter-spike intervals from 1 ms to 1000 s. We used Pearson’s correlation coefficient to measure the similarity between ISI distributions on different days for the same unit, and between ISI distributions of distinct units recorded on the same day. For each unit, as with the firing rate similarity measure described above, we averaged the ISI correlations for each time-lag ranging from 1 to 20 days. When comparing across units, we only compared their ISI distributions to other simultaneously recorded units of the same putative unit-type.</p></sec><sec id="s4-13-6"><title>Stability of state-tuning</title><p>We used the Pearson’s correlation coefficient to estimate the similarity between units’ state-dependent firing rate profiles (i.e. their state-tuning), either across days, or between different units recorded simultaneously.</p></sec><sec id="s4-13-7"><title>Spike-triggered averages (STA)</title><p>The spike-triggered average (STA) is commonly used in sensory neuroscience to characterize a neuron’s ‘receptive field’ in stimulus space (<xref ref-type="bibr" rid="bib81">Marmarelis and Naka, 1972</xref>; <xref ref-type="bibr" rid="bib85">Meister et al., 1994</xref>). We adapted this method to estimate ‘response fields’ in movement space (<xref ref-type="bibr" rid="bib20">Cheney and Fetz, 1984</xref>; <xref ref-type="bibr" rid="bib26">Cullen et al., 1993</xref>; <xref ref-type="bibr" rid="bib112">Serruya et al., 2002</xref>; <xref ref-type="bibr" rid="bib130">Wessberg et al., 2000</xref>). For each unit, we computed spike-triggered averages of accelerometer power in three different behavioral states – eating, grooming and active exploration. We calculated the norm of the accelerometer signal as per <xref ref-type="disp-formula" rid="equ1">equation (1)</xref>. The accelerometer norm was band-pass filtered between 0.5 Hz and 300 Hz using a third order Butterworth filter and zero-phase filtering. Spike-triggered averages (STA) were computed for each unit in a particular behavioral state by averaging, over spikes, the accelerometer signal norm in a window of ±500 ms centered on each spike. Formally,<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mi>T</mml:mi><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:mfenced close="‖" open="‖" separators="|"><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where τ is the time-lag, sampled at 300 Hz resolution, between spike and accelerometer power ranging from −500 to +500 ms, and <inline-formula><mml:math id="inf144"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the arrival times of unit spikes (a total of <inline-formula><mml:math id="inf145"><mml:mi>n</mml:mi></mml:math></inline-formula> spikes) in a particular behavioral state. We only considered ‘trigger-spikes’ that were at least 500 ms away from a behavioral state-transition.</p><p>To measure the significance of the resultant STA kernels, we computed noise STAs after jittering spike times by ±500 ms. We used the standard deviation of the noise STAs across time-bins to calculate the Z-scored STAs. Any STA having at least 2 bins equal to or exceeding a Z-score of 5 was considered statistically significant and used for further analysis.</p><p>Just as with ISI distribution similarity, we calculated the similarity between STAs for the same unit on different days using Pearson’s correlation coefficient. We also compared similarity of STAs across simultaneously recorded units, but only within the same behavioral state.</p></sec><sec id="s4-13-8"><title>Peri-event time histograms (PETHs)</title><p>We computed peri-event time histograms (PETHs) of instantaneous firing rates aligned to specific behavioral events during execution of a lever-pressing task (<xref ref-type="bibr" rid="bib67">Kawai et al., 2015</xref>). We computed PETHs in windows ± 200 ms around the first lever-press event of a trial, as well as at times of nose-pokes into the reward port following successful trials. In order to restrict our analysis of neural activity to periods of stereotyped behavior, we selected only rewarded trials that followed previously rewarded trials (to control for the rat's starting position), and these trials’ inter-press intervals had to be within 20% of the target inter-press interval of 700 ms (to ensure movement stereotypy). To estimate a unit’s instantaneous firing rate on each trial, we convolved its event-aligned spike train with a Gaussian kernel (σ = 20 ms). These firing rates were then averaged over the selected trials from a given day to yield the unit PETH. To determine whether a particular PETH had statistically significant modulation in firing rate, we estimated the p-value and Z-score for each bin in the PETH using a bootstrap approach. P-values were then pooled across days for all lever-press or nose-poke PETHs for a particular unit using Fisher’s method. A unit was deemed to have significant modulation in its time-averaged PETH if at least 2 bins had p-values&lt;1e-5. At this significance threshold the probability of getting &gt;1 false positive over 1000 neurons and 20 time-bins is less than 0.01.</p><p>Similarity across PETHs for the same unit across days, or between different units on the same day was computed using the Pearson’s correlation coefficient, similar to the measurement of similarity between ISI distributions and STAs. Similarities in lever-press and nose-poke PETH similarities were averaged for each unit for a particular time-lag (ranging from 1 to 20 days).</p></sec><sec id="s4-13-9"><title>Cross-correlograms</title><p>We computed cross-correlograms for all unit pairs recorded simultaneously using spikes recorded in all labeled behavioral states (<xref ref-type="fig" rid="fig6">Figure 6</xref>) or in specific behavioral states (<xref ref-type="fig" rid="fig7">Figure 7D,E</xref>). For each unit pair, we only calculated correlograms on days on which both units were simultaneosly recorded for at least 60% of the time (i.e., &gt;14 of 24 hr). Correlograms were calculated in 1 ms bins and smoothed with a 3 ms boxcar filter. Correlograms for unit pairs recorded on the same tetrode are, by design, zero at zero lag since only one spike event is allowed per tetrode in a 1 ms bin. For these pairs, the average of the preceding and following bins was used to approximate the value of the correlogram at zero lag. Correlations were considered significant if two consecutive bins of the correlogram were above a threshold set at three standard deviations of a shuffled correlogram computed for the same pair (one spike train was shuffled by adding ±400 ms random jitter to each spike). Only correlograms that had at least 5000 spikes could be considered significant. The normalized amplitude of each correlogram was measured as its maximum peak (positive correlation) or trough (negative correlation), averaged over 3 bins around the peak/trough and normalized by the average bin height of the shuffled correlogram. Thus an amplitude &gt;1 indicates a positive correlation whereas an amplitude &lt;1 indicates negative correlations. The lag was defined as the bin location of the peak/trough in the correlogram.</p></sec><sec id="s4-13-10"><title>Stability of correlograms</title><p>We used the Pearson’s correlation coefficient to quantify the similarity between correlogram distributions on different days.</p></sec><sec id="s4-13-11"><title>Tests of statistical significance</title><p>We used the Kruskal-Wallis one-way analysis of variance test to determine whether differences in within-unit similarity measures of firing rate, ISI distribution, interneuronal correlograms, behavioral state modulation of firing rate, spike-triggered averages and PETHs, over time-lags of 1 to 20 days were significant when compared to each other or to similarity measures computed across units. P-values were corrected for multiple comparisons by the Tukey-Kramer method. We used an alpha value of 0.05.</p></sec></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank Michelle Choi for behavioral scoring of videos, Mahmood M. Shad for help benchmarking the speed of the FAST algorithm, and Aliaksandr Iuleu for help with figures.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Data curation, Software, Formal analysis, Investigation</p></fn><fn fn-type="con" id="con3"><p>Data curation, Formal analysis</p></fn><fn fn-type="con" id="con4"><p>Software, Formal analysis, Visualization</p></fn><fn fn-type="con" id="con5"><p>Software, Formal analysis</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Supervision, Funding acquisition, Investigation, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: This study was performed in strict accordance with the recommendations in the Guide for the Care and Use of Laboratory Animals of the National Institutes of Health. All of the animals were handled according to approved institutional animal care and use committee (IACUC) protocols (#29-15) of the Harvard University. All surgery was performed under isoflurane anesthesia, and every effort was made to minimize suffering.</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.27702.023</object-id><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-27702-transrepform-v2.docx"/></supplementary-material><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following dataset was generated:</p><p><related-object content-type="generated-dataset" id="dataset1" source-id="https://doi.org/10.5281/zenodo.886516" source-id-type="uri"><collab collab-type="author">Mokri Y</collab><collab collab-type="author">Salazar RF</collab><collab collab-type="author">Goodell B</collab><collab collab-type="author">Baker J</collab><collab collab-type="author">Gray CM</collab><collab collab-type="author">Yen SC</collab><year>2017</year><source>Synthetic tetrode recording dataset with spike-waveform drift</source><ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.886516">https://doi.org/10.5281/zenodo.886516</ext-link><comment>Publicly available at the OpenAIRE project via Zenodo (https://zenodo.org/)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abbott</surname> <given-names>LF</given-names></name><name><surname>Dayan</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>The effect of correlated variability on the accuracy of a population code</article-title><source>Neural Computation</source><volume>11</volume><fpage>91</fpage><lpage>101</lpage><pub-id pub-id-type="doi">10.1162/089976699300016827</pub-id><pub-id pub-id-type="pmid">9950724</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aldridge</surname> <given-names>JW</given-names></name><name><surname>Berridge</surname> <given-names>KC</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Coding of serial order by neostriatal neurons: a &quot;natural action&quot; approach to movement sequence</article-title><source>Journal of Neuroscience</source><volume>18</volume><fpage>2777</fpage><lpage>2787</lpage><pub-id pub-id-type="pmid">9502834</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alivisatos</surname> <given-names>AP</given-names></name><name><surname>Andrews</surname> <given-names>AM</given-names></name><name><surname>Boyden</surname> <given-names>ES</given-names></name><name><surname>Chun</surname> <given-names>M</given-names></name><name><surname>Church</surname> <given-names>GM</given-names></name><name><surname>Deisseroth</surname> <given-names>K</given-names></name><name><surname>Donoghue</surname> <given-names>JP</given-names></name><name><surname>Fraser</surname> <given-names>SE</given-names></name><name><surname>Lippincott-Schwartz</surname> <given-names>J</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Masmanidis</surname> <given-names>S</given-names></name><name><surname>McEuen</surname> <given-names>PL</given-names></name><name><surname>Nurmikko</surname> <given-names>AV</given-names></name><name><surname>Park</surname> <given-names>H</given-names></name><name><surname>Peterka</surname> <given-names>DS</given-names></name><name><surname>Reid</surname> <given-names>C</given-names></name><name><surname>Roukes</surname> <given-names>ML</given-names></name><name><surname>Scherer</surname> <given-names>A</given-names></name><name><surname>Schnitzer</surname> <given-names>M</given-names></name><name><surname>Sejnowski</surname> <given-names>TJ</given-names></name><name><surname>Shepard</surname> <given-names>KL</given-names></name><name><surname>Tsao</surname> <given-names>D</given-names></name><name><surname>Turrigiano</surname> <given-names>G</given-names></name><name><surname>Weiss</surname> <given-names>PS</given-names></name><name><surname>Xu</surname> <given-names>C</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name><name><surname>Zhuang</surname> <given-names>X</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Nanotools for neuroscience and brain activity mapping</article-title><source>ACS Nano</source><volume>7</volume><fpage>1850</fpage><lpage>1866</lpage><pub-id pub-id-type="doi">10.1021/nn4012847</pub-id><pub-id pub-id-type="pmid">23514423</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ambrose</surname> <given-names>RE</given-names></name><name><surname>Pfeiffer</surname> <given-names>BE</given-names></name><name><surname>Foster</surname> <given-names>DJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Reverse Replay of Hippocampal Place Cells Is Uniquely Modulated by Changing Reward</article-title><source>Neuron</source><volume>91</volume><fpage>1124</fpage><lpage>1136</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2016.07.047</pub-id><pub-id pub-id-type="pmid">27568518</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Anderberg</surname> <given-names>MR</given-names></name></person-group><year iso-8601-date="1973">1973</year><chapter-title>Cluster Analysis for Applications. Probability and Mathematical Statistics</chapter-title><source>A Series of Monographs and Textbooks</source><publisher-name>Academic Press</publisher-name></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arieli</surname> <given-names>A</given-names></name><name><surname>Sterkin</surname> <given-names>A</given-names></name><name><surname>Grinvald</surname> <given-names>A</given-names></name><name><surname>Aertsen</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Dynamics of ongoing activity: explanation of the large variability in evoked cortical responses</article-title><source>Science</source><volume>273</volume><fpage>1868</fpage><lpage>1871</lpage><pub-id pub-id-type="doi">10.1126/science.273.5283.1868</pub-id><pub-id pub-id-type="pmid">8791593</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Attardo</surname> <given-names>A</given-names></name><name><surname>Fitzgerald</surname> <given-names>JE</given-names></name><name><surname>Schnitzer</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Impermanence of dendritic spines in live adult CA1 hippocampus</article-title><source>Nature</source><volume>523</volume><fpage>592</fpage><lpage>596</lpage><pub-id pub-id-type="doi">10.1038/nature14467</pub-id><pub-id pub-id-type="pmid">26098371</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bair</surname> <given-names>W</given-names></name><name><surname>Zohary</surname> <given-names>E</given-names></name><name><surname>Newsome</surname> <given-names>WT</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Correlated firing in macaque visual area MT: time scales and relationship to behavior</article-title><source>Journal of Neuroscience</source><volume>21</volume><fpage>1676</fpage><lpage>1697</lpage><pub-id pub-id-type="pmid">11222658</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barthó</surname> <given-names>P</given-names></name><name><surname>Hirase</surname> <given-names>H</given-names></name><name><surname>Monconduit</surname> <given-names>L</given-names></name><name><surname>Zugaro</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Characterization of neocortical principal cells and interneurons by network interactions and extracellular features</article-title><source>Journal of Neurophysiology</source><volume>92</volume><fpage>600</fpage><lpage>608</lpage><pub-id pub-id-type="doi">10.1152/jn.01170.2003</pub-id><pub-id pub-id-type="pmid">15056678</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berke</surname> <given-names>JD</given-names></name><name><surname>Okatan</surname> <given-names>M</given-names></name><name><surname>Skurski</surname> <given-names>J</given-names></name><name><surname>Eichenbaum</surname> <given-names>HB</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Oscillatory entrainment of striatal neurons in freely moving rats</article-title><source>Neuron</source><volume>43</volume><fpage>883</fpage><lpage>896</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2004.08.035</pub-id><pub-id pub-id-type="pmid">15363398</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berényi</surname> <given-names>A</given-names></name><name><surname>Somogyvári</surname> <given-names>Z</given-names></name><name><surname>Nagy</surname> <given-names>AJ</given-names></name><name><surname>Roux</surname> <given-names>L</given-names></name><name><surname>Long</surname> <given-names>JD</given-names></name><name><surname>Fujisawa</surname> <given-names>S</given-names></name><name><surname>Stark</surname> <given-names>E</given-names></name><name><surname>Leonardo</surname> <given-names>A</given-names></name><name><surname>Harris</surname> <given-names>TD</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Large-scale, high-density (up to 512 channels) recording of local circuits in behaving animals</article-title><source>Journal of Neurophysiology</source><volume>111</volume><fpage>1132</fpage><lpage>1149</lpage><pub-id pub-id-type="doi">10.1152/jn.00785.2013</pub-id><pub-id pub-id-type="pmid">24353300</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bland</surname> <given-names>BH</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>The physiology and pharmacology of hippocampal formation theta rhythms</article-title><source>Progress in Neurobiology</source><volume>26</volume><fpage>1</fpage><lpage>54</lpage><pub-id pub-id-type="doi">10.1016/0301-0082(86)90019-5</pub-id><pub-id pub-id-type="pmid">2870537</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blatt</surname> <given-names>M</given-names></name><name><surname>Wiseman</surname> <given-names>S</given-names></name><name><surname>Domany</surname> <given-names>E</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Superparamagnetic clustering of data</article-title><source>Physical Review Letters</source><volume>76</volume><fpage>3251</fpage><lpage>3254</lpage><pub-id pub-id-type="doi">10.1103/PhysRevLett.76.3251</pub-id><pub-id pub-id-type="pmid">10060920</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bondar</surname> <given-names>IV</given-names></name><name><surname>Leopold</surname> <given-names>DA</given-names></name><name><surname>Richmond</surname> <given-names>BJ</given-names></name><name><surname>Victor</surname> <given-names>JD</given-names></name><name><surname>Logothetis</surname> <given-names>NK</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Long-term stability of visual pattern selective responses of monkey temporal lobe neurons</article-title><source>PLoS One</source><volume>4</volume><elocation-id>e8222</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0008222</pub-id><pub-id pub-id-type="pmid">20011035</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Large-scale recording of neuronal ensembles</article-title><source>Nature Neuroscience</source><volume>7</volume><fpage>446</fpage><lpage>451</lpage><pub-id pub-id-type="doi">10.1038/nn1233</pub-id><pub-id pub-id-type="pmid">15114356</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname> <given-names>G</given-names></name><name><surname>Stark</surname> <given-names>E</given-names></name><name><surname>Berényi</surname> <given-names>A</given-names></name><name><surname>Khodagholy</surname> <given-names>D</given-names></name><name><surname>Kipke</surname> <given-names>DR</given-names></name><name><surname>Yoon</surname> <given-names>E</given-names></name><name><surname>Wise</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Tools for probing local circuits: high-density silicon probes combined with optogenetics</article-title><source>Neuron</source><volume>86</volume><fpage>92</fpage><lpage>105</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.01.028</pub-id><pub-id pub-id-type="pmid">25856489</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carmena</surname> <given-names>JM</given-names></name><name><surname>Lebedev</surname> <given-names>MA</given-names></name><name><surname>Henriquez</surname> <given-names>CS</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Stable ensemble performance with single-neuron variability during reaching movements in primates</article-title><source>Journal of Neuroscience</source><volume>25</volume><fpage>10712</fpage><lpage>10716</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.2772-05.2005</pub-id><pub-id pub-id-type="pmid">16291944</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carr</surname> <given-names>MF</given-names></name><name><surname>Jadhav</surname> <given-names>SP</given-names></name><name><surname>Frank</surname> <given-names>LM</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Hippocampal replay in the awake state: a potential substrate for memory consolidation and retrieval</article-title><source>Nature Neuroscience</source><volume>14</volume><fpage>147</fpage><lpage>153</lpage><pub-id pub-id-type="doi">10.1038/nn.2732</pub-id><pub-id pub-id-type="pmid">21270783</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chaisanguanthum</surname> <given-names>KS</given-names></name><name><surname>Shen</surname> <given-names>HH</given-names></name><name><surname>Sabes</surname> <given-names>PN</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Motor variability arises from a slow random walk in neural state</article-title><source>Journal of Neuroscience</source><volume>34</volume><fpage>12071</fpage><lpage>12080</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.3001-13.2014</pub-id><pub-id pub-id-type="pmid">25186752</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cheney</surname> <given-names>PD</given-names></name><name><surname>Fetz</surname> <given-names>EE</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>Corticomotoneuronal cells contribute to long-latency stretch reflexes in the rhesus monkey</article-title><source>The Journal of Physiology</source><volume>349</volume><fpage>249</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1113/jphysiol.1984.sp015155</pub-id><pub-id pub-id-type="pmid">6737294</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chestek</surname> <given-names>CA</given-names></name><name><surname>Batista</surname> <given-names>AP</given-names></name><name><surname>Santhanam</surname> <given-names>G</given-names></name><name><surname>Yu</surname> <given-names>BM</given-names></name><name><surname>Afshar</surname> <given-names>A</given-names></name><name><surname>Cunningham</surname> <given-names>JP</given-names></name><name><surname>Gilja</surname> <given-names>V</given-names></name><name><surname>Ryu</surname> <given-names>SI</given-names></name><name><surname>Churchland</surname> <given-names>MM</given-names></name><name><surname>Shenoy</surname> <given-names>KV</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Single-neuron stability during repeated reaching in macaque premotor cortex</article-title><source>Journal of Neuroscience</source><volume>27</volume><fpage>10742</fpage><lpage>10750</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0959-07.2007</pub-id><pub-id pub-id-type="pmid">17913908</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chestek</surname> <given-names>CA</given-names></name><name><surname>Gilja</surname> <given-names>V</given-names></name><name><surname>Nuyujukian</surname> <given-names>P</given-names></name><name><surname>Foster</surname> <given-names>JD</given-names></name><name><surname>Fan</surname> <given-names>JM</given-names></name><name><surname>Kaufman</surname> <given-names>MT</given-names></name><name><surname>Churchland</surname> <given-names>MM</given-names></name><name><surname>Rivera-Alvidrez</surname> <given-names>Z</given-names></name><name><surname>Cunningham</surname> <given-names>JP</given-names></name><name><surname>Ryu</surname> <given-names>SI</given-names></name><name><surname>Shenoy</surname> <given-names>KV</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Long-term stability of neural prosthetic control signals from silicon cortical arrays in rhesus macaque motor cortex</article-title><source>Journal of Neural Engineering</source><volume>8</volume><elocation-id>045005</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2560/8/4/045005</pub-id><pub-id pub-id-type="pmid">21775782</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clopath</surname> <given-names>C</given-names></name><name><surname>Bonhoeffer</surname> <given-names>T</given-names></name><name><surname>Hübener</surname> <given-names>M</given-names></name><name><surname>Rose</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Variance and invariance of neuronal long-term representations</article-title><source>Philosophical Transactions of the Royal Society B: Biological Sciences</source><volume>372</volume><fpage>20160161</fpage><pub-id pub-id-type="doi">10.1098/rstb.2016.0161</pub-id><pub-id pub-id-type="pmid">28093555</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cogan</surname> <given-names>SF</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Neural stimulation and recording electrodes</article-title><source>Annual Review of Biomedical Engineering</source><volume>10</volume><fpage>275</fpage><lpage>309</lpage><pub-id pub-id-type="doi">10.1146/annurev.bioeng.10.061807.160518</pub-id><pub-id pub-id-type="pmid">18429704</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Connors</surname> <given-names>BW</given-names></name><name><surname>Gutnick</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="1990">1990</year><article-title>Intrinsic firing patterns of diverse neocortical neurons</article-title><source>Trends in Neurosciences</source><volume>13</volume><fpage>99</fpage><lpage>104</lpage><pub-id pub-id-type="doi">10.1016/0166-2236(90)90185-D</pub-id><pub-id pub-id-type="pmid">1691879</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cullen</surname> <given-names>KE</given-names></name><name><surname>Chen-Huang</surname> <given-names>C</given-names></name><name><surname>McCrea</surname> <given-names>RA</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Firing behavior of brain stem neurons during voluntary cancellation of the horizontal vestibuloocular reflex. II. Eye movement related neurons</article-title><source>Journal of neurophysiology</source><volume>70</volume><fpage>844</fpage><lpage>856</lpage><pub-id pub-id-type="pmid">8410176</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dean</surname> <given-names>J</given-names></name><name><surname>Ghemawat</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>MapReduce: Simplified Data Processing on Large Clusters</article-title><source>Communications of the ACM</source><volume>51</volume><fpage>107</fpage><lpage>113</lpage></element-citation></ref><ref id="bib28"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Dhawale</surname> <given-names>AK</given-names></name><name><surname>Normand</surname> <given-names>VA</given-names></name><name><surname>Ölveczky</surname> <given-names>BP</given-names></name></person-group><year iso-8601-date="2017">2017a</year><data-title>FAST-ChainViewer</data-title><source>GitHub</source><version designator="7ca245f">7ca245f</version><ext-link ext-link-type="uri" xlink:href="https://github.com/Olveczky-Lab/FAST-ChainViewer">https://github.com/Olveczky-Lab/FAST-ChainViewer</ext-link></element-citation></ref><ref id="bib29"><element-citation publication-type="data"><person-group person-group-type="author"><name><surname>Dhawale</surname> <given-names>AK</given-names></name><name><surname>Poddar</surname> <given-names>R</given-names></name><name><surname>Ölveczky</surname> <given-names>BP</given-names></name></person-group><year iso-8601-date="2017">2017b</year><data-title>Synthetic tetrode recording dataset with spike-waveform drift</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.886516</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dickey</surname> <given-names>AS</given-names></name><name><surname>Suminski</surname> <given-names>A</given-names></name><name><surname>Amit</surname> <given-names>Y</given-names></name><name><surname>Hatsopoulos</surname> <given-names>NG</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Single-unit stability using chronically implanted multielectrode arrays</article-title><source>Journal of Neurophysiology</source><volume>102</volume><fpage>1331</fpage><lpage>1339</lpage><pub-id pub-id-type="doi">10.1152/jn.90920.2008</pub-id><pub-id pub-id-type="pmid">19535480</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dobrakovová</surname> <given-names>M</given-names></name><name><surname>Jurcovicová</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>Corticosterone and prolactin responses to repeated handling and transfer of male rats</article-title><source>Experimental and Clinical Endocrinology &amp; Diabetes</source><volume>83</volume><fpage>21</fpage><lpage>27</lpage><pub-id pub-id-type="doi">10.1055/s-0029-1210308</pub-id><pub-id pub-id-type="pmid">6539212</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dombeck</surname> <given-names>DA</given-names></name><name><surname>Khabbaz</surname> <given-names>AN</given-names></name><name><surname>Collman</surname> <given-names>F</given-names></name><name><surname>Adelman</surname> <given-names>TL</given-names></name><name><surname>Tank</surname> <given-names>DW</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Imaging large-scale neural activity with cellular resolution in awake, mobile mice</article-title><source>Neuron</source><volume>56</volume><fpage>43</fpage><lpage>57</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2007.08.003</pub-id><pub-id pub-id-type="pmid">17920014</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Driscoll</surname> <given-names>LN</given-names></name><name><surname>Pettit</surname> <given-names>NL</given-names></name><name><surname>Minderer</surname> <given-names>M</given-names></name><name><surname>Chettih</surname> <given-names>SN</given-names></name><name><surname>Harvey</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Dynamic reorganization of neuronal activity patterns in parietal cortex</article-title><source>Cell</source><volume>170</volume><fpage>986</fpage><lpage>999</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2017.07.021</pub-id><pub-id pub-id-type="pmid">28823559</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Du</surname> <given-names>J</given-names></name><name><surname>Blanche</surname> <given-names>TJ</given-names></name><name><surname>Harrison</surname> <given-names>RR</given-names></name><name><surname>Lester</surname> <given-names>HA</given-names></name><name><surname>Masmanidis</surname> <given-names>SC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Multiplexed, high density electrophysiology with nanofabricated neural probes</article-title><source>PLoS One</source><volume>6</volume><elocation-id>e26204</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0026204</pub-id><pub-id pub-id-type="pmid">22022568</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ecker</surname> <given-names>AS</given-names></name><name><surname>Berens</surname> <given-names>P</given-names></name><name><surname>Keliris</surname> <given-names>GA</given-names></name><name><surname>Bethge</surname> <given-names>M</given-names></name><name><surname>Logothetis</surname> <given-names>NK</given-names></name><name><surname>Tolias</surname> <given-names>AS</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Decorrelated neuronal firing in cortical microcircuits</article-title><source>Science</source><volume>327</volume><fpage>584</fpage><lpage>587</lpage><pub-id pub-id-type="doi">10.1126/science.1179867</pub-id><pub-id pub-id-type="pmid">20110506</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Einevoll</surname> <given-names>GT</given-names></name><name><surname>Franke</surname> <given-names>F</given-names></name><name><surname>Hagen</surname> <given-names>E</given-names></name><name><surname>Pouzat</surname> <given-names>C</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Towards reliable spike-train recordings from thousands of neurons with multielectrodes</article-title><source>Current Opinion in Neurobiology</source><volume>22</volume><fpage>11</fpage><lpage>17</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2011.10.001</pub-id><pub-id pub-id-type="pmid">22023727</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ekanadham</surname> <given-names>C</given-names></name><name><surname>Tranchina</surname> <given-names>D</given-names></name><name><surname>Simoncelli</surname> <given-names>EP</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A unified framework and method for automatic neural spike identification</article-title><source>Journal of Neuroscience Methods</source><volume>222</volume><fpage>47</fpage><lpage>55</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2013.10.001</pub-id><pub-id pub-id-type="pmid">24184059</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Emondi</surname> <given-names>AA</given-names></name><name><surname>Rebrik</surname> <given-names>SP</given-names></name><name><surname>Kurgansky</surname> <given-names>AV</given-names></name><name><surname>Miller</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Tracking neurons recorded from tetrodes across time</article-title><source>Journal of Neuroscience Methods</source><volume>135</volume><fpage>95</fpage><lpage>105</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2003.12.022</pub-id><pub-id pub-id-type="pmid">15020094</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Evarts</surname> <given-names>EV</given-names></name></person-group><year iso-8601-date="1964">1964</year><article-title>Temporal patterns of discharge of pyramidal tract neurons during sleep and waking in the monkey</article-title><source>Journal of Neurophysiology</source><volume>27</volume><fpage>152</fpage><lpage>171</lpage><pub-id pub-id-type="pmid">14129768</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ferguson</surname> <given-names>JE</given-names></name><name><surname>Boldt</surname> <given-names>C</given-names></name><name><surname>Redish</surname> <given-names>AD</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Creating low-impedance tetrodes by electroplating with additives</article-title><source>Sensors and Actuators A: Physical</source><volume>156</volume><fpage>388</fpage><lpage>393</lpage><pub-id pub-id-type="doi">10.1016/j.sna.2009.10.001</pub-id><pub-id pub-id-type="pmid">21379404</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Foster</surname> <given-names>DJ</given-names></name><name><surname>Wilson</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Reverse replay of behavioural sequences in hippocampal place cells during the awake state</article-title><source>Nature</source><volume>440</volume><fpage>680</fpage><lpage>683</lpage><pub-id pub-id-type="doi">10.1038/nature04587</pub-id><pub-id pub-id-type="pmid">16474382</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fraser</surname> <given-names>GW</given-names></name><name><surname>Schwartz</surname> <given-names>AB</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Recording from the same neurons chronically in motor cortex</article-title><source>Journal of Neurophysiology</source><volume>107</volume><fpage>1970</fpage><lpage>1978</lpage><pub-id pub-id-type="doi">10.1152/jn.01012.2010</pub-id><pub-id pub-id-type="pmid">22190623</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fu</surname> <given-names>TM</given-names></name><name><surname>Hong</surname> <given-names>G</given-names></name><name><surname>Zhou</surname> <given-names>T</given-names></name><name><surname>Schuhmann</surname> <given-names>TG</given-names></name><name><surname>Viveros</surname> <given-names>RD</given-names></name><name><surname>Lieber</surname> <given-names>CM</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Stable long-term chronic brain mapping at the single-neuron level</article-title><source>Nature Methods</source><volume>13</volume><fpage>875</fpage><lpage>882</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3969</pub-id><pub-id pub-id-type="pmid">27571550</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ganguly</surname> <given-names>K</given-names></name><name><surname>Carmena</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Emergence of a stable cortical map for neuroprosthetic control</article-title><source>PLoS Biology</source><volume>7</volume><elocation-id>e1000153</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pbio.1000153</pub-id><pub-id pub-id-type="pmid">19621062</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ganguly</surname> <given-names>K</given-names></name><name><surname>Dimitrov</surname> <given-names>DF</given-names></name><name><surname>Wallis</surname> <given-names>JD</given-names></name><name><surname>Carmena</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Reversible large-scale modification of cortical networks during neuroprosthetic control</article-title><source>Nature Neuroscience</source><volume>14</volume><fpage>662</fpage><lpage>667</lpage><pub-id pub-id-type="doi">10.1038/nn.2797</pub-id><pub-id pub-id-type="pmid">21499255</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Georgopoulos</surname> <given-names>AP</given-names></name><name><surname>Schwartz</surname> <given-names>AB</given-names></name><name><surname>Kettner</surname> <given-names>RE</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>Neuronal population coding of movement direction</article-title><source>Science</source><volume>233</volume><fpage>1416</fpage><lpage>1419</lpage><pub-id pub-id-type="doi">10.1126/science.3749885</pub-id><pub-id pub-id-type="pmid">3749885</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gervasoni</surname> <given-names>D</given-names></name><name><surname>Lin</surname> <given-names>SC</given-names></name><name><surname>Ribeiro</surname> <given-names>S</given-names></name><name><surname>Soares</surname> <given-names>ES</given-names></name><name><surname>Pantoja</surname> <given-names>J</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Global forebrain dynamics predict rat behavioral states and their transitions</article-title><source>Journal of Neuroscience</source><volume>24</volume><fpage>11137</fpage><lpage>11147</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.3524-04.2004</pub-id><pub-id pub-id-type="pmid">15590930</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gong</surname> <given-names>Y</given-names></name><name><surname>Huang</surname> <given-names>C</given-names></name><name><surname>Li</surname> <given-names>JZ</given-names></name><name><surname>Grewe</surname> <given-names>BF</given-names></name><name><surname>Zhang</surname> <given-names>Y</given-names></name><name><surname>Eismann</surname> <given-names>S</given-names></name><name><surname>Schnitzer</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>High-speed recording of neural spikes in awake mice and flies with a fluorescent voltage sensor</article-title><source>Science</source><volume>350</volume><fpage>1361</fpage><lpage>1366</lpage><pub-id pub-id-type="doi">10.1126/science.aab0810</pub-id><pub-id pub-id-type="pmid">26586188</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Greenberg</surname> <given-names>PA</given-names></name><name><surname>Wilson</surname> <given-names>FA</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Functional stability of dorsolateral prefrontal neurons</article-title><source>Journal of Neurophysiology</source><volume>92</volume><fpage>1042</fpage><lpage>1055</lpage><pub-id pub-id-type="doi">10.1152/jn.00062.2004</pub-id><pub-id pub-id-type="pmid">15084637</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grienberger</surname> <given-names>C</given-names></name><name><surname>Konnerth</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Imaging calcium in neurons</article-title><source>Neuron</source><volume>73</volume><fpage>862</fpage><lpage>885</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2012.02.011</pub-id><pub-id pub-id-type="pmid">22405199</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grutzendler</surname> <given-names>J</given-names></name><name><surname>Kasthuri</surname> <given-names>N</given-names></name><name><surname>Gan</surname> <given-names>WB</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Long-term dendritic spine stability in the adult cortex</article-title><source>Nature</source><volume>420</volume><fpage>812</fpage><lpage>816</lpage><pub-id pub-id-type="doi">10.1038/nature01276</pub-id><pub-id pub-id-type="pmid">12490949</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Guitchounts</surname> <given-names>G</given-names></name><name><surname>Markowitz</surname> <given-names>JE</given-names></name><name><surname>Liberti</surname> <given-names>WA</given-names></name><name><surname>Gardner</surname> <given-names>TJ</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>A carbon-fiber electrode array for long-term neural recording</article-title><source>Journal of Neural Engineering</source><volume>10</volume><elocation-id>046016</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2560/10/4/046016</pub-id><pub-id pub-id-type="pmid">23860226</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gulati</surname> <given-names>T</given-names></name><name><surname>Ramanathan</surname> <given-names>DS</given-names></name><name><surname>Wong</surname> <given-names>CC</given-names></name><name><surname>Ganguly</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Reactivation of emergent task-related ensembles during slow-wave sleep after neuroprosthetic learning</article-title><source>Nature Neuroscience</source><volume>17</volume><fpage>1107</fpage><lpage>1113</lpage><pub-id pub-id-type="doi">10.1038/nn.3759</pub-id><pub-id pub-id-type="pmid">24997761</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hanks</surname> <given-names>TD</given-names></name><name><surname>Kopec</surname> <given-names>CD</given-names></name><name><surname>Brunton</surname> <given-names>BW</given-names></name><name><surname>Duan</surname> <given-names>CA</given-names></name><name><surname>Erlich</surname> <given-names>JC</given-names></name><name><surname>Brody</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Distinct relationships of parietal and prefrontal cortices to evidence accumulation</article-title><source>Nature</source><volume>520</volume><fpage>220</fpage><lpage>223</lpage><pub-id pub-id-type="doi">10.1038/nature14066</pub-id><pub-id pub-id-type="pmid">25600270</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Henze</surname> <given-names>DA</given-names></name><name><surname>Csicsvari</surname> <given-names>J</given-names></name><name><surname>Hirase</surname> <given-names>H</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Accuracy of tetrode spike separation as determined by simultaneous intracellular and extracellular measurements</article-title><source>Journal of neurophysiology</source><volume>84</volume><fpage>401</fpage><lpage>414</lpage><pub-id pub-id-type="pmid">10899214</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hengen</surname> <given-names>KB</given-names></name><name><surname>Torrado Pacheco</surname> <given-names>A</given-names></name><name><surname>McGregor</surname> <given-names>JN</given-names></name><name><surname>Van Hooser</surname> <given-names>SD</given-names></name><name><surname>Turrigiano</surname> <given-names>GG</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Neuronal firing rate homeostasis is inhibited by sleep and promoted by wake</article-title><source>Cell</source><volume>165</volume><fpage>180</fpage><lpage>191</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2016.01.046</pub-id><pub-id pub-id-type="pmid">26997481</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="data"><person-group person-group-type="author"><name><surname>Henze</surname> <given-names>DA</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Borhegyi</surname> <given-names>Z</given-names></name><name><surname>Csicsvari</surname> <given-names>J</given-names></name><name><surname>Mamiya</surname> <given-names>A</given-names></name><name><surname>Hirase</surname> <given-names>H</given-names></name><name><surname>Sirota</surname> <given-names>A</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2009">2009</year><data-title>Simultaneous intracellular and extracellular recordings from hippocampus region CA1 of anesthetized rats</data-title><source>CRCNS.org</source></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hill</surname> <given-names>DN</given-names></name><name><surname>Mehta</surname> <given-names>SB</given-names></name><name><surname>Kleinfeld</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Quality metrics to accompany spike sorting of extracellular signals</article-title><source>Journal of Neuroscience</source><volume>31</volume><fpage>8699</fpage><lpage>8705</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0971-11.2011</pub-id><pub-id pub-id-type="pmid">21677152</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hirase</surname> <given-names>H</given-names></name><name><surname>Leinekugel</surname> <given-names>X</given-names></name><name><surname>Czurkó</surname> <given-names>A</given-names></name><name><surname>Csicsvari</surname> <given-names>J</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Firing rates of hippocampal neurons are preserved during subsequent sleep episodes and modified by novel awake experience</article-title><source>PNAS</source><volume>98</volume><fpage>9386</fpage><lpage>9390</lpage><pub-id pub-id-type="doi">10.1073/pnas.161274398</pub-id><pub-id pub-id-type="pmid">11470910</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hires</surname> <given-names>SA</given-names></name><name><surname>Tian</surname> <given-names>L</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Reporting neural activity with genetically encoded calcium indicators</article-title><source>Brain Cell Biology</source><volume>36</volume><fpage>69</fpage><lpage>86</lpage><pub-id pub-id-type="doi">10.1007/s11068-008-9029-4</pub-id><pub-id pub-id-type="pmid">18941901</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holtmaat</surname> <given-names>AJ</given-names></name><name><surname>Trachtenberg</surname> <given-names>JT</given-names></name><name><surname>Wilbrecht</surname> <given-names>L</given-names></name><name><surname>Shepherd</surname> <given-names>GM</given-names></name><name><surname>Zhang</surname> <given-names>X</given-names></name><name><surname>Knott</surname> <given-names>GW</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Transient and persistent dendritic spines in the neocortex in vivo</article-title><source>Neuron</source><volume>45</volume><fpage>279</fpage><lpage>291</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2005.01.003</pub-id><pub-id pub-id-type="pmid">15664179</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hromádka</surname> <given-names>T</given-names></name><name><surname>Deweese</surname> <given-names>MR</given-names></name><name><surname>Zador</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Sparse representation of sounds in the unanesthetized auditory cortex</article-title><source>PLoS Biology</source><volume>6</volume><elocation-id>e16</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pbio.0060016</pub-id><pub-id pub-id-type="pmid">18232737</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huber</surname> <given-names>D</given-names></name><name><surname>Gutnisky</surname> <given-names>DA</given-names></name><name><surname>Peron</surname> <given-names>S</given-names></name><name><surname>O'Connor</surname> <given-names>DH</given-names></name><name><surname>Wiegert</surname> <given-names>JS</given-names></name><name><surname>Tian</surname> <given-names>L</given-names></name><name><surname>Oertner</surname> <given-names>TG</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Multiple dynamic representations in the motor cortex during sensorimotor learning</article-title><source>Nature</source><volume>484</volume><fpage>473</fpage><lpage>478</lpage><pub-id pub-id-type="doi">10.1038/nature11039</pub-id><pub-id pub-id-type="pmid">22538608</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jackson</surname> <given-names>A</given-names></name><name><surname>Fetz</surname> <given-names>EE</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Compact movable microwire array for long-term chronic unit recording in cerebral cortex of primates</article-title><source>Journal of Neurophysiology</source><volume>98</volume><fpage>3109</fpage><lpage>3118</lpage><pub-id pub-id-type="doi">10.1152/jn.00569.2007</pub-id><pub-id pub-id-type="pmid">17855584</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jog</surname> <given-names>MS</given-names></name><name><surname>Kubota</surname> <given-names>Y</given-names></name><name><surname>Connolly</surname> <given-names>CI</given-names></name><name><surname>Hillegaart</surname> <given-names>V</given-names></name><name><surname>Graybiel</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Building neural representations of habits</article-title><source>Science</source><volume>286</volume><fpage>1745</fpage><lpage>1749</lpage><pub-id pub-id-type="doi">10.1126/science.286.5445.1745</pub-id><pub-id pub-id-type="pmid">10576743</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kasthuri</surname> <given-names>N</given-names></name><name><surname>Hayworth</surname> <given-names>KJ</given-names></name><name><surname>Berger</surname> <given-names>DR</given-names></name><name><surname>Schalek</surname> <given-names>RL</given-names></name><name><surname>Conchello</surname> <given-names>JA</given-names></name><name><surname>Knowles-Barley</surname> <given-names>S</given-names></name><name><surname>Lee</surname> <given-names>D</given-names></name><name><surname>Vázquez-Reina</surname> <given-names>A</given-names></name><name><surname>Kaynig</surname> <given-names>V</given-names></name><name><surname>Jones</surname> <given-names>TR</given-names></name><name><surname>Roberts</surname> <given-names>M</given-names></name><name><surname>Morgan</surname> <given-names>JL</given-names></name><name><surname>Tapia</surname> <given-names>JC</given-names></name><name><surname>Seung</surname> <given-names>HS</given-names></name><name><surname>Roncal</surname> <given-names>WG</given-names></name><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Burns</surname> <given-names>R</given-names></name><name><surname>Sussman</surname> <given-names>DL</given-names></name><name><surname>Priebe</surname> <given-names>CE</given-names></name><name><surname>Pfister</surname> <given-names>H</given-names></name><name><surname>Lichtman</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Saturated reconstruction of a volume of neocortex</article-title><source>Cell</source><volume>162</volume><fpage>648</fpage><lpage>661</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.06.054</pub-id><pub-id pub-id-type="pmid">26232230</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kawai</surname> <given-names>R</given-names></name><name><surname>Markman</surname> <given-names>T</given-names></name><name><surname>Poddar</surname> <given-names>R</given-names></name><name><surname>Ko</surname> <given-names>R</given-names></name><name><surname>Fantana</surname> <given-names>AL</given-names></name><name><surname>Dhawale</surname> <given-names>AK</given-names></name><name><surname>Kampff</surname> <given-names>AR</given-names></name><name><surname>Ölveczky</surname> <given-names>BP</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Motor cortex is required for learning but not for executing a motor skill</article-title><source>Neuron</source><volume>86</volume><fpage>800</fpage><lpage>812</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.03.024</pub-id><pub-id pub-id-type="pmid">25892304</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kaynig</surname> <given-names>V</given-names></name><name><surname>Vazquez-Reina</surname> <given-names>A</given-names></name><name><surname>Knowles-Barley</surname> <given-names>S</given-names></name><name><surname>Roberts</surname> <given-names>M</given-names></name><name><surname>Jones</surname> <given-names>TR</given-names></name><name><surname>Kasthuri</surname> <given-names>N</given-names></name><name><surname>Miller</surname> <given-names>E</given-names></name><name><surname>Lichtman</surname> <given-names>J</given-names></name><name><surname>Pfister</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Large-scale automatic reconstruction of neuronal processes from electron microscopy images</article-title><source>Medical Image Analysis</source><volume>22</volume><fpage>77</fpage><lpage>88</lpage><pub-id pub-id-type="doi">10.1016/j.media.2015.02.001</pub-id><pub-id pub-id-type="pmid">25791436</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keefer</surname> <given-names>EW</given-names></name><name><surname>Botterman</surname> <given-names>BR</given-names></name><name><surname>Romero</surname> <given-names>MI</given-names></name><name><surname>Rossi</surname> <given-names>AF</given-names></name><name><surname>Gross</surname> <given-names>GW</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Carbon nanotube coating improves neuronal recordings</article-title><source>Nature Nanotechnology</source><volume>3</volume><fpage>434</fpage><lpage>439</lpage><pub-id pub-id-type="doi">10.1038/nnano.2008.174</pub-id><pub-id pub-id-type="pmid">18654569</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kralik</surname> <given-names>JD</given-names></name><name><surname>Dimitrov</surname> <given-names>DF</given-names></name><name><surname>Krupa</surname> <given-names>DJ</given-names></name><name><surname>Katz</surname> <given-names>DB</given-names></name><name><surname>Cohen</surname> <given-names>D</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Techniques for long-term multisite neuronal ensemble recordings in behaving animals</article-title><source>Methods</source><volume>25</volume><fpage>121</fpage><lpage>150</lpage><pub-id pub-id-type="doi">10.1006/meth.2001.1231</pub-id><pub-id pub-id-type="pmid">11812202</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname> <given-names>SH</given-names></name><name><surname>Dan</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Neuromodulation of brain states</article-title><source>Neuron</source><volume>76</volume><fpage>209</fpage><lpage>222</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2012.09.012</pub-id><pub-id pub-id-type="pmid">23040816</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lewicki</surname> <given-names>MS</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>A review of methods for spike sorting: the detection and classification of neural action potentials</article-title><source>Network: Computation in Neural Systems</source><volume>9</volume><fpage>R53</fpage><lpage>R78</lpage><pub-id pub-id-type="doi">10.1088/0954-898X_9_4_001</pub-id><pub-id pub-id-type="pmid">10221571</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liberti</surname> <given-names>WA</given-names></name><name><surname>Markowitz</surname> <given-names>JE</given-names></name><name><surname>Perkins</surname> <given-names>LN</given-names></name><name><surname>Liberti</surname> <given-names>DC</given-names></name><name><surname>Leman</surname> <given-names>DP</given-names></name><name><surname>Guitchounts</surname> <given-names>G</given-names></name><name><surname>Velho</surname> <given-names>T</given-names></name><name><surname>Kotton</surname> <given-names>DN</given-names></name><name><surname>Lois</surname> <given-names>C</given-names></name><name><surname>Gardner</surname> <given-names>TJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Unstable neurons underlie a stable learned behavior</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>1665</fpage><lpage>1671</lpage><pub-id pub-id-type="doi">10.1038/nn.4405</pub-id><pub-id pub-id-type="pmid">27723744</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname> <given-names>SC</given-names></name><name><surname>Gervasoni</surname> <given-names>D</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Fast modulation of prefrontal cortex activity by basal forebrain noncholinergic neuronal ensembles</article-title><source>Journal of Neurophysiology</source><volume>96</volume><fpage>3209</fpage><lpage>3219</lpage><pub-id pub-id-type="doi">10.1152/jn.00524.2006</pub-id><pub-id pub-id-type="pmid">16928796</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Longordo</surname> <given-names>F</given-names></name><name><surname>Fan</surname> <given-names>J</given-names></name><name><surname>Steimer</surname> <given-names>T</given-names></name><name><surname>Kopp</surname> <given-names>C</given-names></name><name><surname>Lüthi</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Do mice habituate to &quot;gentle handling?&quot; A comparison of resting behavior, corticosterone levels and synaptic function in handled and undisturbed C57BL/6J mice</article-title><source>Sleep</source><volume>34</volume><fpage>679</fpage><lpage>681</lpage><pub-id pub-id-type="doi">10.1093/sleep/34.5.679</pub-id><pub-id pub-id-type="pmid">21532962</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Griesbeck</surname> <given-names>O</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Genetically encoded neural activity indicators</article-title><source>Current Opinion in Neurobiology</source><volume>22</volume><fpage>18</fpage><lpage>23</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2011.10.024</pub-id><pub-id pub-id-type="pmid">22104761</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lütcke</surname> <given-names>H</given-names></name><name><surname>Margolis</surname> <given-names>DJ</given-names></name><name><surname>Helmchen</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Steady or changing? Long-term monitoring of neuronal population activity</article-title><source>Trends in Neurosciences</source><volume>36</volume><fpage>375</fpage><lpage>384</lpage><pub-id pub-id-type="doi">10.1016/j.tins.2013.03.008</pub-id><pub-id pub-id-type="pmid">23608298</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mahon</surname> <given-names>S</given-names></name><name><surname>Vautrelle</surname> <given-names>N</given-names></name><name><surname>Pezard</surname> <given-names>L</given-names></name><name><surname>Slaght</surname> <given-names>SJ</given-names></name><name><surname>Deniau</surname> <given-names>JM</given-names></name><name><surname>Chouvet</surname> <given-names>G</given-names></name><name><surname>Charpier</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Distinct patterns of striatal medium spiny neuron activity during the natural sleep-wake cycle</article-title><source>Journal of Neuroscience</source><volume>26</volume><fpage>12587</fpage><lpage>12595</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.3987-06.2006</pub-id><pub-id pub-id-type="pmid">17135420</pub-id></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mankin</surname> <given-names>EA</given-names></name><name><surname>Sparks</surname> <given-names>FT</given-names></name><name><surname>Slayyeh</surname> <given-names>B</given-names></name><name><surname>Sutherland</surname> <given-names>RJ</given-names></name><name><surname>Leutgeb</surname> <given-names>S</given-names></name><name><surname>Leutgeb</surname> <given-names>JK</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Neuronal code for extended time in the hippocampus</article-title><source>PNAS</source><volume>109</volume><fpage>19462</fpage><lpage>19467</lpage><pub-id pub-id-type="doi">10.1073/pnas.1214107109</pub-id><pub-id pub-id-type="pmid">23132944</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marder</surname> <given-names>E</given-names></name><name><surname>Goaillard</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Variability, compensation and homeostasis in neuron and network function</article-title><source>Nature Reviews Neuroscience</source><volume>7</volume><fpage>563</fpage><lpage>574</lpage><pub-id pub-id-type="doi">10.1038/nrn1949</pub-id><pub-id pub-id-type="pmid">16791145</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marmarelis</surname> <given-names>PZ</given-names></name><name><surname>Naka</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="1972">1972</year><article-title>White-noise analysis of a neuron chain: an application of the Wiener theory</article-title><source>Science</source><volume>175</volume><fpage>1276</fpage><lpage>1278</lpage><pub-id pub-id-type="doi">10.1126/science.175.4027.1276</pub-id><pub-id pub-id-type="pmid">5061252</pub-id></element-citation></ref><ref id="bib82"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martinez</surname> <given-names>J</given-names></name><name><surname>Pedreira</surname> <given-names>C</given-names></name><name><surname>Ison</surname> <given-names>MJ</given-names></name><name><surname>Quian Quiroga</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Realistic simulation of extracellular recordings</article-title><source>Journal of Neuroscience Methods</source><volume>184</volume><fpage>285</fpage><lpage>293</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2009.08.017</pub-id><pub-id pub-id-type="pmid">19703490</pub-id></element-citation></ref><ref id="bib83"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McMahon</surname> <given-names>DB</given-names></name><name><surname>Bondar</surname> <given-names>IV</given-names></name><name><surname>Afuwape</surname> <given-names>OA</given-names></name><name><surname>Ide</surname> <given-names>DC</given-names></name><name><surname>Leopold</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2014">2014a</year><article-title>One month in the life of a neuron: longitudinal single-unit electrophysiology in the monkey visual system</article-title><source>Journal of Neurophysiology</source><volume>112</volume><fpage>1748</fpage><lpage>1762</lpage><pub-id pub-id-type="doi">10.1152/jn.00052.2014</pub-id><pub-id pub-id-type="pmid">24966298</pub-id></element-citation></ref><ref id="bib84"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McMahon</surname> <given-names>DB</given-names></name><name><surname>Jones</surname> <given-names>AP</given-names></name><name><surname>Bondar</surname> <given-names>IV</given-names></name><name><surname>Leopold</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2014">2014b</year><article-title>Face-selective neurons maintain consistent visual responses across months</article-title><source>PNAS</source><volume>111</volume><fpage>8251</fpage><lpage>8256</lpage><pub-id pub-id-type="doi">10.1073/pnas.1318331111</pub-id><pub-id pub-id-type="pmid">24799679</pub-id></element-citation></ref><ref id="bib85"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meister</surname> <given-names>M</given-names></name><name><surname>Pine</surname> <given-names>J</given-names></name><name><surname>Baylor</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Multi-neuronal signals from the retina: acquisition and analysis</article-title><source>Journal of Neuroscience Methods</source><volume>51</volume><fpage>95</fpage><lpage>106</lpage><pub-id pub-id-type="doi">10.1016/0165-0270(94)90030-2</pub-id><pub-id pub-id-type="pmid">8189755</pub-id></element-citation></ref><ref id="bib86"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Mitra</surname> <given-names>P</given-names></name><name><surname>Bokil</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2007">2007</year><source>Observed Brain Dynamics</source><publisher-loc>Oxford</publisher-loc><publisher-name>Oxford University Press</publisher-name></element-citation></ref><ref id="bib87"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mizuseki</surname> <given-names>K</given-names></name><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Preconfigured, skewed distribution of firing rates in the hippocampus and entorhinal cortex</article-title><source>Cell Reports</source><volume>4</volume><fpage>1010</fpage><lpage>1021</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2013.07.039</pub-id><pub-id pub-id-type="pmid">23994479</pub-id></element-citation></ref><ref id="bib88"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morcos</surname> <given-names>AS</given-names></name><name><surname>Harvey</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>History-dependent variability in population dynamics during evidence accumulation in cortex</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>1672</fpage><lpage>1681</lpage><pub-id pub-id-type="doi">10.1038/nn.4403</pub-id><pub-id pub-id-type="pmid">27694990</pub-id></element-citation></ref><ref id="bib89"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murakami</surname> <given-names>M</given-names></name><name><surname>Vicente</surname> <given-names>MI</given-names></name><name><surname>Costa</surname> <given-names>GM</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Neural antecedents of self-initiated actions in secondary motor cortex</article-title><source>Nature Neuroscience</source><volume>17</volume><fpage>1574</fpage><lpage>1582</lpage><pub-id pub-id-type="doi">10.1038/nn.3826</pub-id><pub-id pub-id-type="pmid">25262496</pub-id></element-citation></ref><ref id="bib90"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nicolelis</surname> <given-names>MA</given-names></name><name><surname>Baccala</surname> <given-names>LA</given-names></name><name><surname>Lin</surname> <given-names>RC</given-names></name><name><surname>Chapin</surname> <given-names>JK</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Sensorimotor encoding by synchronous neural ensemble activity at multiple levels of the somatosensory system</article-title><source>Science</source><volume>268</volume><fpage>1353</fpage><lpage>1358</lpage><pub-id pub-id-type="doi">10.1126/science.7761855</pub-id><pub-id pub-id-type="pmid">7761855</pub-id></element-citation></ref><ref id="bib91"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nienborg</surname> <given-names>H</given-names></name><name><surname>Cohen</surname> <given-names>MR</given-names></name><name><surname>Cumming</surname> <given-names>BG</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Decision-related activity in sensory neurons: correlations among neurons and with behavior</article-title><source>Annual Review of Neuroscience</source><volume>35</volume><fpage>463</fpage><lpage>483</lpage><pub-id pub-id-type="doi">10.1146/annurev-neuro-062111-150403</pub-id><pub-id pub-id-type="pmid">22483043</pub-id></element-citation></ref><ref id="bib92"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nuyujukian</surname> <given-names>P</given-names></name><name><surname>Kao</surname> <given-names>JC</given-names></name><name><surname>Fan</surname> <given-names>JM</given-names></name><name><surname>Stavisky</surname> <given-names>SD</given-names></name><name><surname>Ryu</surname> <given-names>SI</given-names></name><name><surname>Shenoy</surname> <given-names>KV</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Performance sustaining intracortical neural prostheses</article-title><source>Journal of Neural Engineering</source><volume>11</volume><elocation-id>066003</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2560/11/6/066003</pub-id><pub-id pub-id-type="pmid">25307561</pub-id></element-citation></ref><ref id="bib93"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okun</surname> <given-names>M</given-names></name><name><surname>Steinmetz</surname> <given-names>N</given-names></name><name><surname>Cossell</surname> <given-names>L</given-names></name><name><surname>Iacaruso</surname> <given-names>MF</given-names></name><name><surname>Ko</surname> <given-names>H</given-names></name><name><surname>Barthó</surname> <given-names>P</given-names></name><name><surname>Moore</surname> <given-names>T</given-names></name><name><surname>Hofer</surname> <given-names>SB</given-names></name><name><surname>Mrsic-Flogel</surname> <given-names>TD</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Diverse coupling of neurons to populations in sensory cortex</article-title><source>Nature</source><volume>521</volume><fpage>511</fpage><lpage>515</lpage><pub-id pub-id-type="doi">10.1038/nature14273</pub-id><pub-id pub-id-type="pmid">25849776</pub-id></element-citation></ref><ref id="bib94"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okun</surname> <given-names>M</given-names></name><name><surname>Lak</surname> <given-names>A</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Long term recordings with immobile silicon probes in the mouse cortex</article-title><source>Plos One</source><volume>11</volume><elocation-id>e0151180</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0151180</pub-id><pub-id pub-id-type="pmid">26959638</pub-id></element-citation></ref><ref id="bib95"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Perge</surname> <given-names>JA</given-names></name><name><surname>Homer</surname> <given-names>ML</given-names></name><name><surname>Malik</surname> <given-names>WQ</given-names></name><name><surname>Cash</surname> <given-names>S</given-names></name><name><surname>Eskandar</surname> <given-names>E</given-names></name><name><surname>Friehs</surname> <given-names>G</given-names></name><name><surname>Donoghue</surname> <given-names>JP</given-names></name><name><surname>Hochberg</surname> <given-names>LR</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Intra-day signal instabilities affect decoding performance in an intracortical neural interface system</article-title><source>Journal of Neural Engineering</source><volume>10</volume><elocation-id>036004</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2560/10/3/036004</pub-id><pub-id pub-id-type="pmid">23574741</pub-id></element-citation></ref><ref id="bib96"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peters</surname> <given-names>AJ</given-names></name><name><surname>Chen</surname> <given-names>SX</given-names></name><name><surname>Komiyama</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Emergence of reproducible spatiotemporal activity during motor learning</article-title><source>Nature</source><volume>510</volume><fpage>263</fpage><lpage>267</lpage><pub-id pub-id-type="doi">10.1038/nature13235</pub-id><pub-id pub-id-type="pmid">24805237</pub-id></element-citation></ref><ref id="bib97"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peña</surname> <given-names>JL</given-names></name><name><surname>Pérez-Perera</surname> <given-names>L</given-names></name><name><surname>Bouvier</surname> <given-names>M</given-names></name><name><surname>Velluti</surname> <given-names>RA</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Sleep and wakefulness modulation of the neuronal firing in the auditory cortex of the guinea pig</article-title><source>Brain Research</source><volume>816</volume><fpage>463</fpage><lpage>470</lpage><pub-id pub-id-type="doi">10.1016/S0006-8993(98)01194-9</pub-id><pub-id pub-id-type="pmid">9878870</pub-id></element-citation></ref><ref id="bib98"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Poddar</surname> <given-names>R</given-names></name><name><surname>Kawai</surname> <given-names>R</given-names></name><name><surname>Ölveczky</surname> <given-names>BP</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>A fully automated high-throughput training system for rodents</article-title><source>PLoS One</source><volume>8</volume><elocation-id>e83171</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0083171</pub-id><pub-id pub-id-type="pmid">24349451</pub-id></element-citation></ref><ref id="bib99"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Poddar</surname> <given-names>R</given-names></name><name><surname>Dhawale</surname> <given-names>AK</given-names></name><name><surname>Ölveczky</surname> <given-names>BP</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>Fast Automated Spike Tracker</data-title><source>GitHub</source><version designator="4114dea">4114dea</version><ext-link ext-link-type="uri" xlink:href="https://github.com/Olveczky-Lab/FAST">https://github.com/Olveczky-Lab/FAST</ext-link></element-citation></ref><ref id="bib100"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quirk</surname> <given-names>MC</given-names></name><name><surname>Sosulski</surname> <given-names>DL</given-names></name><name><surname>Feierstein</surname> <given-names>CE</given-names></name><name><surname>Uchida</surname> <given-names>N</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>A defined network of fast-spiking interneurons in orbitofrontal cortex: responses to behavioral contingencies and ketamine administration</article-title><source>Frontiers in Systems Neuroscience</source><volume>3</volume><elocation-id>13</elocation-id><pub-id pub-id-type="doi">10.3389/neuro.06.013.2009</pub-id><pub-id pub-id-type="pmid">20057934</pub-id></element-citation></ref><ref id="bib101"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quiroga</surname> <given-names>RQ</given-names></name><name><surname>Nadasdy</surname> <given-names>Z</given-names></name><name><surname>Ben-Shaul</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Unsupervised spike detection and sorting with wavelets and superparamagnetic clustering</article-title><source>Neural Computation</source><volume>16</volume><fpage>1661</fpage><lpage>1687</lpage><pub-id pub-id-type="doi">10.1162/089976604774201631</pub-id><pub-id pub-id-type="pmid">15228749</pub-id></element-citation></ref><ref id="bib102"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rey</surname> <given-names>HG</given-names></name><name><surname>Pedreira</surname> <given-names>C</given-names></name><name><surname>Quian Quiroga</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2015">2015a</year><article-title>Past, present and future of spike sorting techniques</article-title><source>Brain Research Bulletin</source><volume>119</volume><fpage>106</fpage><lpage>117</lpage><pub-id pub-id-type="doi">10.1016/j.brainresbull.2015.04.007</pub-id></element-citation></ref><ref id="bib103"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rey</surname> <given-names>HG</given-names></name><name><surname>Pedreira</surname> <given-names>C</given-names></name><name><surname>Quian Quiroga</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2015">2015b</year><article-title>Past, present and future of spike sorting techniques</article-title><source>Brain Research Bulletin</source><volume>119</volume><fpage>106</fpage><lpage>117</lpage><pub-id pub-id-type="doi">10.1016/j.brainresbull.2015.04.007</pub-id><pub-id pub-id-type="pmid">25931392</pub-id></element-citation></ref><ref id="bib104"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ribeiro</surname> <given-names>S</given-names></name><name><surname>Gervasoni</surname> <given-names>D</given-names></name><name><surname>Soares</surname> <given-names>ES</given-names></name><name><surname>Zhou</surname> <given-names>Y</given-names></name><name><surname>Lin</surname> <given-names>SC</given-names></name><name><surname>Pantoja</surname> <given-names>J</given-names></name><name><surname>Lavine</surname> <given-names>M</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Long-lasting novelty-induced neuronal reverberation during slow-wave sleep in multiple forebrain areas</article-title><source>PLoS Biology</source><volume>2</volume><elocation-id>e24</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pbio.0020024</pub-id><pub-id pub-id-type="pmid">14737198</pub-id></element-citation></ref><ref id="bib105"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rokni</surname> <given-names>U</given-names></name><name><surname>Richardson</surname> <given-names>AG</given-names></name><name><surname>Bizzi</surname> <given-names>E</given-names></name><name><surname>Seung</surname> <given-names>HS</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Motor learning with unstable neural representations</article-title><source>Neuron</source><volume>54</volume><fpage>653</fpage><lpage>666</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2007.04.030</pub-id><pub-id pub-id-type="pmid">17521576</pub-id></element-citation></ref><ref id="bib106"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rose</surname> <given-names>T</given-names></name><name><surname>Jaepel</surname> <given-names>J</given-names></name><name><surname>Hübener</surname> <given-names>M</given-names></name><name><surname>Bonhoeffer</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Cell-specific restoration of stimulus preference after monocular deprivation in the visual cortex</article-title><source>Science</source><volume>352</volume><fpage>1319</fpage><lpage>1322</lpage><pub-id pub-id-type="doi">10.1126/science.aad3358</pub-id><pub-id pub-id-type="pmid">27284193</pub-id></element-citation></ref><ref id="bib107"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rossant</surname> <given-names>C</given-names></name><name><surname>Kadir</surname> <given-names>SN</given-names></name><name><surname>Goodman</surname> <given-names>DFM</given-names></name><name><surname>Schulman</surname> <given-names>J</given-names></name><name><surname>Hunter</surname> <given-names>MLD</given-names></name><name><surname>Saleem</surname> <given-names>AB</given-names></name><name><surname>Grosmark</surname> <given-names>A</given-names></name><name><surname>Belluscio</surname> <given-names>M</given-names></name><name><surname>Denfield</surname> <given-names>GH</given-names></name><name><surname>Ecker</surname> <given-names>AS</given-names></name><name><surname>Tolias</surname> <given-names>AS</given-names></name><name><surname>Solomon</surname> <given-names>S</given-names></name><name><surname>Buzsaki</surname> <given-names>G</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Spike sorting for large, dense electrode arrays</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>634</fpage><lpage>641</lpage><pub-id pub-id-type="doi">10.1038/nn.4268</pub-id><pub-id pub-id-type="pmid">26974951</pub-id></element-citation></ref><ref id="bib108"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sainsbury</surname> <given-names>RS</given-names></name><name><surname>Heynen</surname> <given-names>A</given-names></name><name><surname>Montoya</surname> <given-names>CP</given-names></name></person-group><year iso-8601-date="1987">1987</year><article-title>Behavioral correlates of hippocampal type 2 theta in the rat</article-title><source>Physiology &amp; Behavior</source><volume>39</volume><fpage>513</fpage><lpage>519</lpage><pub-id pub-id-type="doi">10.1016/0031-9384(87)90382-9</pub-id><pub-id pub-id-type="pmid">3575499</pub-id></element-citation></ref><ref id="bib109"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salinas</surname> <given-names>E</given-names></name><name><surname>Sejnowski</surname> <given-names>TJ</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Correlated neuronal activity and the flow of neural information</article-title><source>Nature Reviews Neuroscience</source><volume>2</volume><fpage>539</fpage><lpage>550</lpage><pub-id pub-id-type="doi">10.1038/35086012</pub-id><pub-id pub-id-type="pmid">11483997</pub-id></element-citation></ref><ref id="bib110"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Santhanam</surname> <given-names>G</given-names></name><name><surname>Linderman</surname> <given-names>MD</given-names></name><name><surname>Gilja</surname> <given-names>V</given-names></name><name><surname>Afshar</surname> <given-names>A</given-names></name><name><surname>Ryu</surname> <given-names>SI</given-names></name><name><surname>Meng</surname> <given-names>TH</given-names></name><name><surname>Shenoy</surname> <given-names>KV</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>HermesB: a continuous neural recording system for freely behaving primates</article-title><source>IEEE Transactions on Biomedical Engineering</source><volume>54</volume><fpage>2037</fpage><lpage>2050</lpage><pub-id pub-id-type="doi">10.1109/TBME.2007.895753</pub-id><pub-id pub-id-type="pmid">18018699</pub-id></element-citation></ref><ref id="bib111"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmitzer-Torbert</surname> <given-names>N</given-names></name><name><surname>Jackson</surname> <given-names>J</given-names></name><name><surname>Henze</surname> <given-names>D</given-names></name><name><surname>Harris</surname> <given-names>K</given-names></name><name><surname>Redish</surname> <given-names>AD</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Quantitative measures of cluster quality for use in extracellular recordings</article-title><source>Neuroscience</source><volume>131</volume><fpage>1</fpage><lpage>11</lpage><pub-id pub-id-type="doi">10.1016/j.neuroscience.2004.09.066</pub-id><pub-id pub-id-type="pmid">15680687</pub-id></element-citation></ref><ref id="bib112"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Serruya</surname> <given-names>MD</given-names></name><name><surname>Hatsopoulos</surname> <given-names>NG</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name><name><surname>Fellows</surname> <given-names>MR</given-names></name><name><surname>Donoghue</surname> <given-names>JP</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Brain-machine interface: Instant neural control of a movement signal</article-title><source>Nature</source><volume>416</volume><fpage>141</fpage><lpage>142</lpage><pub-id pub-id-type="doi">10.1038/416141a</pub-id></element-citation></ref><ref id="bib113"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shaw</surname> <given-names>FZ</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Is spontaneous high-voltage rhythmic spike discharge in Long Evans rats an absence-like seizure activity?</article-title><source>Journal of Neurophysiology</source><volume>91</volume><fpage>63</fpage><lpage>77</lpage><pub-id pub-id-type="doi">10.1152/jn.00487.2003</pub-id><pub-id pub-id-type="pmid">12826656</pub-id></element-citation></ref><ref id="bib114"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sigurdsson</surname> <given-names>T</given-names></name><name><surname>Stark</surname> <given-names>KL</given-names></name><name><surname>Karayiorgou</surname> <given-names>M</given-names></name><name><surname>Gogos</surname> <given-names>JA</given-names></name><name><surname>Gordon</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Impaired hippocampal-prefrontal synchrony in a genetic mouse model of schizophrenia</article-title><source>Nature</source><volume>464</volume><fpage>763</fpage><lpage>767</lpage><pub-id pub-id-type="doi">10.1038/nature08855</pub-id><pub-id pub-id-type="pmid">20360742</pub-id></element-citation></ref><ref id="bib115"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Singer</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Neuronal synchrony: a versatile code for the definition of relations?</article-title><source>Neuron</source><volume>24</volume><fpage>49</fpage><lpage>65</lpage><pub-id pub-id-type="doi">10.1016/S0896-6273(00)80821-1</pub-id><pub-id pub-id-type="pmid">10677026</pub-id></element-citation></ref><ref id="bib116"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Singer</surname> <given-names>AC</given-names></name><name><surname>Carr</surname> <given-names>MF</given-names></name><name><surname>Karlsson</surname> <given-names>MP</given-names></name><name><surname>Frank</surname> <given-names>LM</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Hippocampal SWR activity predicts correct decisions during the initial learning of an alternation task</article-title><source>Neuron</source><volume>77</volume><fpage>1163</fpage><lpage>1173</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.01.027</pub-id><pub-id pub-id-type="pmid">23522050</pub-id></element-citation></ref><ref id="bib117"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Slonim</surname> <given-names>N</given-names></name><name><surname>Atwal</surname> <given-names>GS</given-names></name><name><surname>Tkacik</surname> <given-names>G</given-names></name><name><surname>Bialek</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Information-based clustering</article-title><source>PNAS</source><volume>102</volume><fpage>18297</fpage><lpage>18302</lpage><pub-id pub-id-type="doi">10.1073/pnas.0507432102</pub-id><pub-id pub-id-type="pmid">16352721</pub-id></element-citation></ref><ref id="bib118"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Steriade</surname> <given-names>M</given-names></name><name><surname>Deschênes</surname> <given-names>M</given-names></name><name><surname>Oakson</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1974">1974</year><article-title>Inhibitory processes and interneuronal apparatus in motor cortex during sleep and waking. I. Background firing and responsiveness of pyramidal tract neurons and interneurons</article-title><source>Journal of Neurophysiology</source><volume>37</volume><fpage>1065</fpage><lpage>1092</lpage><pub-id pub-id-type="pmid">4370112</pub-id></element-citation></ref><ref id="bib119"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stevenson</surname> <given-names>IH</given-names></name><name><surname>Cherian</surname> <given-names>A</given-names></name><name><surname>London</surname> <given-names>BM</given-names></name><name><surname>Sachs</surname> <given-names>NA</given-names></name><name><surname>Lindberg</surname> <given-names>E</given-names></name><name><surname>Reimer</surname> <given-names>J</given-names></name><name><surname>Slutzky</surname> <given-names>MW</given-names></name><name><surname>Hatsopoulos</surname> <given-names>NG</given-names></name><name><surname>Miller</surname> <given-names>LE</given-names></name><name><surname>Kording</surname> <given-names>KP</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Statistical assessment of the stability of neural movement representations</article-title><source>Journal of Neurophysiology</source><volume>106</volume><fpage>764</fpage><lpage>774</lpage><pub-id pub-id-type="doi">10.1152/jn.00626.2010</pub-id><pub-id pub-id-type="pmid">21613593</pub-id></element-citation></ref><ref id="bib120"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sutton</surname> <given-names>D</given-names></name><name><surname>Miller</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="1963">1963</year><article-title>Implanted electrodes: cable coupler for elimination of movement artifact</article-title><source>Science</source><volume>140</volume><fpage>988</fpage><lpage>989</lpage><pub-id pub-id-type="doi">10.1126/science.140.3570.988</pub-id><pub-id pub-id-type="pmid">13979420</pub-id></element-citation></ref><ref id="bib121"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thompson</surname> <given-names>LT</given-names></name><name><surname>Best</surname> <given-names>PJ</given-names></name></person-group><year iso-8601-date="1990">1990</year><article-title>Long-term stability of the place-field activity of single units recorded from the dorsal hippocampus of freely behaving rats</article-title><source>Brain Research</source><volume>509</volume><fpage>299</fpage><lpage>308</lpage><pub-id pub-id-type="doi">10.1016/0006-8993(90)90555-P</pub-id><pub-id pub-id-type="pmid">2322825</pub-id></element-citation></ref><ref id="bib122"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tolias</surname> <given-names>AS</given-names></name><name><surname>Ecker</surname> <given-names>AS</given-names></name><name><surname>Siapas</surname> <given-names>AG</given-names></name><name><surname>Hoenselaar</surname> <given-names>A</given-names></name><name><surname>Keliris</surname> <given-names>GA</given-names></name><name><surname>Logothetis</surname> <given-names>NK</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Recording chronically from the same neurons in awake, behaving primates</article-title><source>Journal of Neurophysiology</source><volume>98</volume><fpage>3780</fpage><lpage>3790</lpage><pub-id pub-id-type="doi">10.1152/jn.00260.2007</pub-id><pub-id pub-id-type="pmid">17942615</pub-id></element-citation></ref><ref id="bib123"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsien</surname> <given-names>RY</given-names></name></person-group><year iso-8601-date="1980">1980</year><article-title>New calcium indicators and buffers with high selectivity against magnesium and protons: design, synthesis, and properties of prototype structures</article-title><source>Biochemistry</source><volume>19</volume><fpage>2396</fpage><lpage>2404</lpage><pub-id pub-id-type="doi">10.1021/bi00552a018</pub-id><pub-id pub-id-type="pmid">6770893</pub-id></element-citation></ref><ref id="bib124"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Vazquez-Reina</surname> <given-names>A</given-names></name><name><surname>Gelbart</surname> <given-names>M</given-names></name><name><surname>Huang</surname> <given-names>D</given-names></name><name><surname>Lichtman</surname> <given-names>J</given-names></name><name><surname>Miller</surname> <given-names>E</given-names></name><name><surname>Pfister</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Segmentation fusion for connectomics</article-title><conf-name><italic>2011 IEEE International Conference on Computer Vision (ICCV)</italic></conf-name><fpage>177</fpage><lpage>184</lpage></element-citation></ref><ref id="bib125"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Venkatraman</surname> <given-names>S</given-names></name><name><surname>Jin</surname> <given-names>X</given-names></name><name><surname>Costa</surname> <given-names>RM</given-names></name><name><surname>Carmena</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Investigating neural correlates of behavior in freely behaving rodents using inertial sensors</article-title><source>Journal of Neurophysiology</source><volume>104</volume><fpage>569</fpage><lpage>575</lpage><pub-id pub-id-type="doi">10.1152/jn.00121.2010</pub-id><pub-id pub-id-type="pmid">20427622</pub-id></element-citation></ref><ref id="bib126"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Viventi</surname> <given-names>J</given-names></name><name><surname>Kim</surname> <given-names>DH</given-names></name><name><surname>Vigeland</surname> <given-names>L</given-names></name><name><surname>Frechette</surname> <given-names>ES</given-names></name><name><surname>Blanco</surname> <given-names>JA</given-names></name><name><surname>Kim</surname> <given-names>YS</given-names></name><name><surname>Avrin</surname> <given-names>AE</given-names></name><name><surname>Tiruvadi</surname> <given-names>VR</given-names></name><name><surname>Hwang</surname> <given-names>SW</given-names></name><name><surname>Vanleer</surname> <given-names>AC</given-names></name><name><surname>Wulsin</surname> <given-names>DF</given-names></name><name><surname>Davis</surname> <given-names>K</given-names></name><name><surname>Gelber</surname> <given-names>CE</given-names></name><name><surname>Palmer</surname> <given-names>L</given-names></name><name><surname>Van der Spiegel</surname> <given-names>J</given-names></name><name><surname>Wu</surname> <given-names>J</given-names></name><name><surname>Xiao</surname> <given-names>J</given-names></name><name><surname>Huang</surname> <given-names>Y</given-names></name><name><surname>Contreras</surname> <given-names>D</given-names></name><name><surname>Rogers</surname> <given-names>JA</given-names></name><name><surname>Litt</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Flexible, foldable, actively multiplexed, high-density electrode array for mapping brain activity in vivo</article-title><source>Nature Neuroscience</source><volume>14</volume><fpage>1599</fpage><lpage>1605</lpage><pub-id pub-id-type="doi">10.1038/nn.2973</pub-id><pub-id pub-id-type="pmid">22081157</pub-id></element-citation></ref><ref id="bib127"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Watson</surname> <given-names>BO</given-names></name><name><surname>Packer</surname> <given-names>AM</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name><name><surname>Jedynak</surname> <given-names>B</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Spike inference from calcium imaging using sequential Monte Carlo methods</article-title><source>Biophysical Journal</source><volume>97</volume><fpage>636</fpage><lpage>655</lpage><pub-id pub-id-type="doi">10.1016/j.bpj.2008.08.005</pub-id><pub-id pub-id-type="pmid">19619479</pub-id></element-citation></ref><ref id="bib128"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Packer</surname> <given-names>AM</given-names></name><name><surname>Machado</surname> <given-names>TA</given-names></name><name><surname>Sippy</surname> <given-names>T</given-names></name><name><surname>Babadi</surname> <given-names>B</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Fast nonnegative deconvolution for spike train inference from population calcium imaging</article-title><source>Journal of Neurophysiology</source><volume>104</volume><fpage>3691</fpage><lpage>3704</lpage><pub-id pub-id-type="doi">10.1152/jn.01073.2009</pub-id><pub-id pub-id-type="pmid">20554834</pub-id></element-citation></ref><ref id="bib129"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vyazovskiy</surname> <given-names>VV</given-names></name><name><surname>Olcese</surname> <given-names>U</given-names></name><name><surname>Lazimy</surname> <given-names>YM</given-names></name><name><surname>Faraguna</surname> <given-names>U</given-names></name><name><surname>Esser</surname> <given-names>SK</given-names></name><name><surname>Williams</surname> <given-names>JC</given-names></name><name><surname>Cirelli</surname> <given-names>C</given-names></name><name><surname>Tononi</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Cortical firing and sleep homeostasis</article-title><source>Neuron</source><volume>63</volume><fpage>865</fpage><lpage>878</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2009.08.024</pub-id><pub-id pub-id-type="pmid">19778514</pub-id></element-citation></ref><ref id="bib130"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wessberg</surname> <given-names>J</given-names></name><name><surname>Stambaugh</surname> <given-names>CR</given-names></name><name><surname>Kralik</surname> <given-names>JD</given-names></name><name><surname>Beck</surname> <given-names>PD</given-names></name><name><surname>Laubach</surname> <given-names>M</given-names></name><name><surname>Chapin</surname> <given-names>JK</given-names></name><name><surname>Kim</surname> <given-names>J</given-names></name><name><surname>Biggs</surname> <given-names>SJ</given-names></name><name><surname>Srinivasan</surname> <given-names>MA</given-names></name><name><surname>Nicolelis</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Real-time prediction of hand trajectory by ensembles of cortical neurons in primates</article-title><source>Nature</source><volume>408</volume><fpage>361</fpage><lpage>365</lpage><pub-id pub-id-type="doi">10.1038/35042582</pub-id><pub-id pub-id-type="pmid">11099043</pub-id></element-citation></ref><ref id="bib131"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname> <given-names>MA</given-names></name><name><surname>McNaughton</surname> <given-names>BL</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Reactivation of hippocampal ensemble memories during sleep</article-title><source>Science</source><volume>265</volume><fpage>676</fpage><lpage>679</lpage><pub-id pub-id-type="doi">10.1126/science.8036517</pub-id><pub-id pub-id-type="pmid">8036517</pub-id></element-citation></ref><ref id="bib132"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xu</surname> <given-names>T</given-names></name><name><surname>Yu</surname> <given-names>X</given-names></name><name><surname>Perlik</surname> <given-names>AJ</given-names></name><name><surname>Tobin</surname> <given-names>WF</given-names></name><name><surname>Zweig</surname> <given-names>JA</given-names></name><name><surname>Tennant</surname> <given-names>K</given-names></name><name><surname>Jones</surname> <given-names>T</given-names></name><name><surname>Zuo</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Rapid formation and selective stabilization of synapses for enduring motor memories</article-title><source>Nature</source><volume>462</volume><fpage>915</fpage><lpage>919</lpage><pub-id pub-id-type="doi">10.1038/nature08389</pub-id><pub-id pub-id-type="pmid">19946267</pub-id></element-citation></ref><ref id="bib133"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yaksi</surname> <given-names>E</given-names></name><name><surname>Friedrich</surname> <given-names>RW</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Reconstruction of firing rate changes across neuronal populations by temporally deconvolved Ca2+ imaging</article-title><source>Nature Methods</source><volume>3</volume><fpage>377</fpage><lpage>383</lpage><pub-id pub-id-type="doi">10.1038/nmeth874</pub-id><pub-id pub-id-type="pmid">16628208</pub-id></element-citation></ref><ref id="bib134"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname> <given-names>G</given-names></name><name><surname>Pan</surname> <given-names>F</given-names></name><name><surname>Gan</surname> <given-names>WB</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Stably maintained dendritic spines are associated with lifelong memories</article-title><source>Nature</source><volume>462</volume><fpage>920</fpage><lpage>924</lpage><pub-id pub-id-type="doi">10.1038/nature08577</pub-id><pub-id pub-id-type="pmid">19946265</pub-id></element-citation></ref><ref id="bib135"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ziv</surname> <given-names>Y</given-names></name><name><surname>Burns</surname> <given-names>LD</given-names></name><name><surname>Cocker</surname> <given-names>ED</given-names></name><name><surname>Hamel</surname> <given-names>EO</given-names></name><name><surname>Ghosh</surname> <given-names>KK</given-names></name><name><surname>Kitch</surname> <given-names>LJ</given-names></name><name><surname>El Gamal</surname> <given-names>A</given-names></name><name><surname>Schnitzer</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Long-term dynamics of CA1 hippocampal place codes</article-title><source>Nature Neuroscience</source><volume>16</volume><fpage>264</fpage><lpage>266</lpage><pub-id pub-id-type="doi">10.1038/nn.3329</pub-id><pub-id pub-id-type="pmid">23396101</pub-id></element-citation></ref><ref id="bib136"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zucker</surname> <given-names>RS</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Calcium- and activity-dependent synaptic plasticity</article-title><source>Current Opinion in Neurobiology</source><volume>9</volume><fpage>305</fpage><lpage>313</lpage><pub-id pub-id-type="doi">10.1016/S0959-4388(99)80045-2</pub-id><pub-id pub-id-type="pmid">10395573</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.27702.026</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>King</surname><given-names>Andrew J</given-names></name><role>Reviewing Editor</role><aff><institution>University of Oxford</institution><country>United Kingdom</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Automated long-term recording and analysis of neural activity in behaving animals&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by three peer reviewers, and the evaluation has been overseen by Andrew King as the Senior Editor and Reviewing Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Frédéric Theunissen (Reviewer #1); Karunesh Ganguly (Reviewer #2); Nicholas Steinmetz (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>This manuscript describes an experimental set up and, more significantly, an automated spike sorting algorithm that allows the activity of ensembles of neurons to be tracked over multiple recordings days in behaving rats. Using simulations and analyses of real data, the authors show that this new approach (which they call Fully Automated Spike Tracker or FAST) outperforms other state-of-the-art spike sorting methods and is able to cope with movement of the brain relative to the electrodes. The recordings from motor cortex and striatum that are presented in the manuscript are remarkably stable in their first and second order statistics, such as average spike rate, inter-spike intervals and pair-wise correlations.</p><p>Essential revisions:</p><p>The reviewers agreed that this manuscript provides a thorough and relatively complete description of a recording system and analytical framework that will likely set new benchmarks and therefore be of great interest to the neuroscience community. As set out in the following numbered points, the principal issues raised concerned the stability of the recordings and a need to compare the spike sorting algorithm, which combines established and innovative methods for spike clustering, with other approaches. The reviewers also found aspects of the spike sorting algorithm difficult to assess, and have requested more information about this. Finally, they were struck by how stable the recording parameters were over multiple days and wish to see how this compares for &quot;earlier&quot; trials (i.e. several thousand) versus really trials (i.e. after 10,000 to 20,000 trials).</p><p>1) The spike sorting method does not seem to be fully automatic, since there is a manual verification stage (merging of chains during &quot;step F&quot; appears to require manual input). The name adopted by the authors for this method (Fully Automated Spike Tracker) is therefore a little misleading and should probably change. More information is needed about the manual steps in order to avoid a lack of reliability when used by others. For example, there is no indication of how long the manual verification takes (e.g. in units of &quot;human-hours per rat per day&quot; or &quot;number of manual chain merges/breaks required per tetrode per day&quot;/&quot;number of junk clusters manually excluded per rat per day&quot;), which is central to the claim that the algorithm is an improvement on existing methods.</p><p>2) The authors say that manual merges of chains were done only in cases where ISI distributions had &gt;0.9 correlation. How does this not invalidate <xref ref-type="fig" rid="fig5">Figure 5E and F</xref>, since they seem to have selected units to be the &quot;same&quot; on the basis of this very property? Please explain this.</p><p>3) The field of spike sorting is plagued by a proliferation of papers that aren't compared against each other and often aren't even testable by the reader. Unfortunately this work is guilty on both counts: the results of the new algorithm are not compared to any existing algorithm (some of which do have drift-correction features, e.g. Calabrese and Paninski, 2011, J Neurosci Methods 196:159-169, and Jun et al., 2017, bioRxiv:1-29), and there is no way to test the code – following the github link, we get only an undocumented mess of folders with F# code; this needs to be fully explained. Independent of the paper's value scientifically, its value as a technical report is severely compromised by this oversight.</p><p>4) The initial clustering step of the algorithm (prior to any merging across time) is suspect since it uses a small number of spikes at a time (1000) and uses a clustering method (SPM) that, according to the authors, is typically hand-tuned for its key parameter (temperature). Here they use a multi-temperature method, but it ultimately comes down to a parameter &quot;a&quot; (subsection “Detailed algorithm for local clustering and de-noising”, point 3b) that enforces a similar trade-off between over- and under-clustering. The value of this parameter is not provided nor is there a description of the criteria on which its value was set. While the stability results probably could not have arisen if the spike sorting method failed to link related groups of spikes altogether, it certainly could have arisen if the groups of spikes (units) that were linked across time corresponded to over-clustered fractions of the true set of spikes from individual neurons, or if the units corresponded to under-clustered multi-unit activity (MUA). The argument that the units do not represent MUA rests on <xref ref-type="fig" rid="fig4">Figure 4E</xref>, and specifically on the ISI quantification (since isolation distance can be high for a MU cluster that is well-separated from other clusters). But this quantification is difficult to interpret since the effective &quot;censure period&quot; of the spike detection algorithm is not quantified. This is actually not a minor detail: a spike with a width of, say, 0.75ms (not unusual for motor cortex) would be declared &quot;ended&quot; at the soonest 8 samples later, i.e. the next detected spike could not be detected &lt;1ms after a broad waveform. For such units, the Fraction ISI &lt;1ms will be zero <italic>by construction</italic>. The authors could quantify this easily: simulate a trace with gaussian noise and add the mean waveform of a neuron they recorded at completely random times. They could then run their spike detection directly on the trace and plot an ISI distribution of all detected spikes. If the mean waveform employed was broad, this will have &lt;1% ISI &lt;1ms, though in reality the data were created with no refractory period whatsoever. If that's the case, a longer refractory period should be used. At present, it appears that the authors have not demonstrated that their algorithm avoids over/under-clustering (a problem it seems likely to have), and an improved ISI analysis would help their case. Failing that, a discussion of the implications for the science if such errors were present would be helpful.</p><p>5) While the notion of accounting for apparently sparsely firing neurons is admirable, there are real concerns about whether these are indeed independent neurons. It seems equally likely that they could be spikes from an existing neuron that happens to stochastically fall outside of a cluster. Would defining clusters using &gt;1000 spikes (e.g. 10,000) still result in this?</p><p>6) By clustering over 1000 spikes, and then over 1000 centroids, the algorithm puts a cap on the speed of probe-brain movement that can be tracked. Some discussion of this property would help readers to understand the algorithm, and even better would be if the authors were able to use their nice simulation from <xref ref-type="fig" rid="fig3">Figure 3C</xref> to quantify this: adjust the drift speed in the simulation and track how well the algorithm does for a range of speeds (this would also be useful for a range of firing rates).</p><p>7) The use of 50 microvolts for spike detection seems to be somewhat arbitrary. What is the typical noise level and the justification for this threshold? Was there an absolute upper-level threshold for a putative unit to eliminate artefacts?</p><p>8) The spike sorting method is a mixture of well-established algorithms and heuristics. While this is understandable, the heuristics have a number of &quot;parameters&quot; that clearly work well for the authors but might not generalize well to other systems. It would be useful to add a table of these parameters (tweaking knobs…) with range of values that you might recommend, so that readers and potential users are aware of these values. Here is the beginning of a long list: local chunks of 1000 spikes, 3x iteration for leftover spikes, 7 times the median of the absolute deviation for a threshold to get snippets, 15/1000 spikes for the leftover group, 1000 points for the second clustering, 10 cluster trees in the part 2, 0.02 threshold, etc.</p><p>9) How were the accelerometer data and the label of immobility (i.e. 2 SD threshold) validated?</p><p>10) The claims of stability are based on relatively simply behavioral markers. This is important because some of the cited papers used much more complex tasks in non-human primates. One might imagine more task-related variability for cue-dependent tasks with more degrees-of-freedom. Were the data analyzed during periods of very stable performance (e.g. after around 20,000 trials)? This might have a bearing on stability of neural activity, especially if the animals are in a crystallized and perhaps habitual mode. Did the authors analyze data from the earlier period of training (several thousand trials)? If so, was there any increased variability?</p><p>11) The discussion on the long-term stability of neural dynamics could be improved. The manuscript mentions that statistical frameworks could contribute (i.e. the Carmena 2005 and the Rokni papers). Also there is mention that methodological factors could contribute. It would be helpful to place their own findings in context and address these issues more directly. As mentioned above, could the over trained performance have contributed?</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.27702.027</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>The reviewers agreed that this manuscript provides a thorough and relatively complete description of a recording system and analytical framework that will likely set new benchmarks and therefore be of great interest to the neuroscience community. As set out in the following numbered points, the principal issues raised concerned the stability of the recordings and a need to compare the spike sorting algorithm, which combines established and innovative methods for spike clustering, with other approaches. The reviewers also found aspects of the spike sorting algorithm difficult to assess, and have requested more information about this. Finally, they were struck by how stable the recording parameters were over multiple days and wish to see how this compares for &quot;earlier&quot; trials (i.e. several thousand) versus really trials (i.e. after 10,000 to 20,000 trials).</p><p>1) The spike sorting method does not seem to be fully automatic, since there is a manual verification stage (merging of chains during &quot;step F&quot; appears to require manual input). The name adopted by the authors for this method (Fully Automated Spike Tracker) is therefore a little misleading and should probably change. More information is needed about the manual steps in order to avoid a lack of reliability when used by others. For example, there is no indication of how long the manual verification takes (e.g. in units of &quot;human-hours per rat per day&quot; or &quot;number of manual chain merges/breaks required per tetrode per day&quot;/&quot;number of junk clusters manually excluded per rat per day&quot;), which is central to the claim that the algorithm is an improvement on existing methods.</p></disp-quote><p>Although FAST is largely automated, we agree with the reviewers that the need for a final manual verification step means that we cannot call it “Fully Automated Spike Tracker”. Our primary claim is that FAST greatly speeds up spike-sorting of continuously acquired neural data to make feasible truly long-term recordings from the same units over weeks and months. For these reasons, we have changed the name of our algorithm to “Fast Automated Spike Tracker”.</p><p>We apologize for the lack of information about the manual verification stage and now provide additional details in the Materials and methods section. It takes, on average, 8 human-hours to process 3 months of data recorded on a single tetrode, or ~130 hours for 16 tetrodes. This is about 5.5 times faster than the rate of data acquisition and is almost twice the rate of the slowest step (Step 1) in the automated processing pipeline. The number of manual mergers required per unit is, on average, 14.7 ± 30.6 (mean ± SD), which translates to an average of 1.3 manual chain mergers per tetrode per day. We had to manually split 2.0% of automatically clustered chains, corresponding to 0.027 chain splits per tetrode per day. This is now all documented in the manuscript.</p><p>Prompted by the reviewers’ comments, we have also illustrated our recommended workflow for the manual step in a new figure (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>).</p><disp-quote content-type="editor-comment"><p>2) The authors say that manual merges of chains were done only in cases where ISI distributions had &gt;0.9 correlation. How does this not invalidate <xref ref-type="fig" rid="fig5">Figure 5E and F</xref>, since they seem to have selected units to be the &quot;same&quot; on the basis of this very property? Please explain this.</p></disp-quote><p>We thank the reviewers for highlighting this potential concern with the ISI stability analysis. We manually merged chains over relatively short time-gaps – less than 5 hours when the chains were part of the same continuous recording, or 24 hours if the chains originated from different recording files. Furthermore, when manually merging chains, we measured inter-chain similarity of ISI distributions using spikes recorded from the last hour of the preceding chain and the first hour of the succeeding chain. Thus, the process of manual merging does not prevent drift of the ISI distribution <italic>within</italic> an automatically defined cluster chain, or over time-scales longer than 24 hours.</p><p>To check if the ISI similarity requirement for chain merging biased our calculation of ISI stability, we performed the stability analysis at an earlier stage of the clustering process, on the chains generated by the fully automated steps 1-2 of FAST, i.e. prior to manual merging in step 3. The results are described in the text and shown in a new supplementary figure (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>), and confirm our previous finding that ISI distributions are indeed stable over several days (<xref ref-type="fig" rid="fig5">Figure 5E-F</xref>).</p><disp-quote content-type="editor-comment"><p>3) The field of spike sorting is plagued by a proliferation of papers that aren't compared against each other and often aren't even testable by the reader. Unfortunately this work is guilty on both counts: the results of the new algorithm are not compared to any existing algorithm (some of which do have drift-correction features, e.g. Calabrese and Paninski, 2011, J Neurosci Methods 196:159-169, and Jun et al., 2017, bioRxiv:1-29), and there is no way to test the code – following the github link, we get only an undocumented mess of folders with F# code; this needs to be fully explained. Independent of the paper's value scientifically, its value as a technical report is severely compromised by this oversight.</p></disp-quote><p>We fully agree with the reviewers that the performance of a novel spike-sorting algorithm should be tested against a known standard. For these reasons, we had applied FAST to both experimental and simulated ground-truth datasets, and compared its performance to the best ellipsoidal error rate (BEER), a metric that represents the best possible performance of standard spike-sorting algorithms that assume waveform stationarity.</p><p>The reviewers also recommended that we test the performance of FAST against other spike-sorting algorithms that have drift-correction features. FAST was specifically designed and optimized to process large, terabyte sized long-term datasets comprising upwards of 10<sup>10</sup> spikes. Even our 10 day long simulated recordings that accurately model experimentally observed spike waveform drift alone comprise ~25 million spikes per tetrode. Although spike-sorting methods such as the Kalman filter mixture model (KFMM) approach (Calabrese and Paninski, 2011) offer interesting alternatives to FAST, they are not yet available as usable spike-sorting solutions. For instance, the KFMM release is proof-of-concept Matlab code that has not yet been optimized to deal with large numbers of spikes, and does not incorporate a method to automatically determine the appropriate number of clusters in a dataset. Under these circumstances, we feel that the extensive work required to get this algorithm to cluster our synthetic ground-truth data is beyond the scope of this study.</p><p>In contrast, the second spike-sorting algorithm cited by the reviewers (JRClust, Jun et al., 2017) has been optimized to run on large datasets. However, their approach to drift-correction is not a general solution to the problem of tracking non-stationary spike waveforms. Rather, their drift-correction algorithm is intimately tied to the design of their recording hardware – high-density ‘Neuropixels’ probes that allows them to spatially localize individual units along the surface of the electrode. The spatial localization afforded by such probes enables the use of a relatively simple drift correction algorithm for <italic>global</italic> motion of brain tissue relative to the probe. In contrast, FAST offers a more general <italic>local</italic> solution to drift correction that can work at the scale of single electrodes. Due to the additional hardware requirements for JRClust, we believe it is not directly comparable to spike waveform tracking by FAST.</p><p>We completely agree with the reviewers’ recommendation that we release FAST in a form that is easily testable by the reader. To that end, we have completely reorganized our GitHub repository (https://github.com/Olveczky-Lab/FAST) to provide a release of the FAST algorithm (v 1.0) that can even be installed on a standard desktop computer running the Windows OS. We have also written a detailed manual to provide installation and run time instructions. We successfully tested the clarity and completeness of these instructions by asking a naïve member of our lab to install FAST from scratch and then use it to parse a test dataset. Furthermore, to help readers visualize and perform manual merging and corrections on the automated output of FAST, we have also provided the code for a Matlab GUI we use in our manual verification step (https://github.com/Olveczky-Lab/FAST-ChainViewer). Finally, we would like to add that we are have recently hired a scientific programmer to develop FAST into an integrated, cross-platform program with an easy-to-use graphical user interface. We anticipate the release of FAST version 2.0 early next year.</p><disp-quote content-type="editor-comment"><p>4) The initial clustering step of the algorithm (prior to any merging across time) is suspect since it uses a small number of spikes at a time (1000) and uses a clustering method (SPM) that, according to the authors, is typically hand-tuned for its key parameter (temperature). Here they use a multi-temperature method, but it ultimately comes down to a parameter &quot;a&quot; (subsection “Detailed algorithm for local clustering and de-noising”, point 3b) that enforces a similar trade-off between over- and under-clustering. The value of this parameter is not provided nor is there a description of the criteria on which its value was set. While the stability results probably could not have arisen if the spike sorting method failed to link related groups of spikes altogether, it certainly could have arisen if the groups of spikes (units) that were linked across time corresponded to over-clustered fractions of the true set of spikes from individual neurons, or if the units corresponded to under-clustered multi-unit activity (MUA). The argument that the units do not represent MUA rests on <xref ref-type="fig" rid="fig4">Figure 4E</xref>, and specifically on the ISI quantification (since isolation distance can be high for a MU cluster that is well-separated from other clusters). But this quantification is difficult to interpret since the effective &quot;censure period&quot; of the spike detection algorithm is not quantified. This is actually not a minor detail: a spike with a width of, say, 0.75ms (not unusual for motor cortex) would be declared &quot;ended&quot; at the soonest 8 samples later, i.e. the next detected spike could not be detected &lt;1ms after a broad waveform. For such units, the Fraction ISI &lt;1ms will be zero by construction. The authors could quantify this easily: simulate a trace with gaussian noise and add the mean waveform of a neuron they recorded at completely random times. They could then run their spike detection directly on the trace and plot an ISI distribution of all detected spikes. If the mean waveform employed was broad, this will have &lt;1% ISI &lt;1ms, though in reality the data were created with no refractory period whatsoever. If that's the case, a longer refractory period should be used. At present, it appears that the authors have not demonstrated that their algorithm avoids over/under-clustering (a problem it seems likely to have), and an improved ISI analysis would help their case. Failing that, a discussion of the implications for the science if such errors were present would be helpful.</p></disp-quote><p>We regret the misunderstanding that has arisen due to our inadequate descriptions of the rationale underlying various stages of the FAST algorithm. The initial clustering step in FAST can be more accurately thought of as a local ‘denoising’ procedure, whose outputs, the cluster centroids, represent a lossy compression of the raw spike dataset. We apologize for not providing more details about the parameter ‘a’ that is important for tuning the degree of this compression. As we now report in <xref ref-type="table" rid="table1">Table 1</xref>, the parameter ‘a’ was set to 20 µV, a value that was chosen empirically to favor over-clustering rather than under-clustering in order to prevent the incorporation of spikes from distinct units into the same local cluster. The rationale behind this stage is that Step 1 of FAST serves primarily to reduce the size and complexity of the dataset for the tracking algorithms implemented in Step 2 of FAST and does not, by itself, define the identity of the final single-unit clusters.</p><p>In Step 2, the cluster centroids computed in Step 1 are pooled into blocks of 1000 and then subjected to another round of superparamagnetic clustering across a range of different temperature values. This time, the cluster tree is not collapsed as in Step 1; instead we use a segmentation fusion algorithm to link together nodes of neighboring clustering trees that have high similarity, resulting in automatically defined single-unit cluster ‘chains’. Thus, Step 2 of FAST is actually the stage that defines cluster identity of centroid spikes and the relevant time-scale for single-unit clustering is defined by the span of the 1000 centroid block in Step 2 of FAST, not the 1000 spike block of the initial clustering step. In our datasets, Step 1 of FAST yields, on average, 8.0 ± 2.6 (mean ± SD, n = 80 tetrodes) cluster centroids per 1000 spike block. This means that a 1000 centroid block effectively encompasses ~125 blocks in Step 1, corresponding to 125000 spikes. Therefore, our multi-scale clustering approach ensures that single unit clusters are actually defined over relatively large windows spanning &gt;100000 spikes, thereby resulting in accurate clustering.</p><p>We have modified our descriptions of the FAST algorithm in the Results and Methods sections to more effectively convey these points.</p><p>We thank the reviewers for raising an important concern about our spike-sorting quality check. Prompted by their comments, we estimated the censure time for our spike-detection method from the mean waveform of all isolated units, calculated in hour long time-bins. Indeed, we found that the censure time can be rather long – on average, 0.74 ± 0.07 ms and 0.46 ± 0.1 ms for medium spiny neurons and fast-spiking interneurons in the striatum, and 0.68 ± 0.07 ms and 0.44 ± 0.08 ms for regular spiking and fast spiking units in the motor cortex (mean ± SD), respectively. As the reviewers correctly point out, this would artificially reduce the fraction of ISIs &lt; 1 ms, especially for regular spiking and MSN units.</p><p>As suggested, we revised our measures of unit quality using a longer 2 ms definition of the absolute refractory period (<xref ref-type="fig" rid="fig4">Figure 4E</xref>). This caused a minor reduction in the fraction of hourly unit-time bins that passed the quality check (5.4% fewer bins), so we redid all our population-level analyses of long-term stability of unit activity (presented in <xref ref-type="fig" rid="fig5">Figures 5</xref>–<xref ref-type="fig" rid="fig8">8</xref> and their supplemental figures). Our earlier finding that firing rates, inter-spike interval histograms, correlations and behavioral representations are stable over 10-20 day time-scales remains unchanged.</p><disp-quote content-type="editor-comment"><p>5) While the notion of accounting for apparently sparsely firing neurons is admirable, there are real concerns about whether these are indeed independent neurons. It seems equally likely that they could be spikes from an existing neuron that happens to stochastically fall outside of a cluster. Would defining clusters using &gt;1000 spikes (e.g. 10,000) still result in this?</p></disp-quote><p>We thank the reviewers for bringing up this important point. We were primarily concerned about two kinds of outliers – ‘stochastic’ outliers that fall outside cluster boundaries by chance due to background noise, and ‘systematic’ outliers that arise due to changes in spike amplitude during bursts or coincident spiking of two or more units with distinct waveforms. Regardless of their origin, we can easily detect an outlier cluster in the manual verification step (described in Materials and methods and <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref> of the revised manuscript) by the presence of a refractory period in spike-timecross-correlograms and close resemblance of spike waveforms with respect to a ‘parent’ cluster.</p><p>We rarely observe chains of stochastic outliers in our datasets. This is due to two factors. First, we impose a minimum cluster size of 15 spikes for every 1000 spike block in FAST’s local clustering step (Step 1). Per definition, stochastic outlier spikes are unlikely to have similar waveforms to each other and are therefore unlikely to form local clusters larger than this 15 spike threshold. Second, the cluster centroids obtained in Step 1 are subject to another round of clustering in Step 2 so as to merge multiple centroids that correspond to the same unit, as described in our response to reviewer comment #4. The factors that are more relevant in determining the extent of stochastic outliers are (1) the parameter ‘a’, which tunes the degree of under/over-clustering of a unit’s spikes into different local clusters, (2) the minimum cluster size threshold, and (3) the effective number of spikes encompassed by the 1000 centroid block in Step 2 of FAST.</p><p>Occasionally, we do observe short ‘satellite’ chains comprising stochastic outliers of parent units that have high firing rates. In the manual verification step, we merge any outlier chains we have identified with the parent cluster. Systematic outliers are more commonly observed in our datasets. We manually merge pairs of units with identical spike shapes but distinct spike amplitudes, if their spike-time cross-correlograms are highly asymmetric around 0 ms and show a distinct refractory period, as these distinct clusters most likely arose from the same bursting unit. Finally, we reject all clusters with complex waveforms that are the result of simultaneous spiking of two or more units, as it is a computational challenge to identify the parent units. In the future, we hope to extend FAST to deal with simultaneous spiking of multiple units by incorporating ideas from recent efforts to tackle this problem (Ekanadham et al., 2014).</p><p>We have added a description of our procedures to deal with outlier spikes to the Materials and methods section of the revised manuscript.</p><disp-quote content-type="editor-comment"><p>6) By clustering over 1000 spikes, and then over 1000 centroids, the algorithm puts a cap on the speed of probe-brain movement that can be tracked. Some discussion of this property would help readers to understand the algorithm, and even better would be if the authors were able to use their nice simulation from <xref ref-type="fig" rid="fig3">Figure 3C</xref> to quantify this: adjust the drift speed in the simulation and track how well the algorithm does for a range of speeds (this would also be useful for a range of firing rates).</p></disp-quote><p>This is a great suggestion. We have added a paragraph on estimating the time-scales of drift correction by FAST to the Materials and methods section of our manuscript:</p><p>“The time-period over which FAST assumes that spike waveforms are stable (the ‘tracking time-scale’) is a function of both the mean event (spike) detection rate and the number of distinct units simultaneously recorded on the electrode. […] This is because FAST employs superparamagnetic clustering which can also sort the non-Gaussian shaped clusters that are an outcome of electrode drift (Quiroga et al., 2004; Rey et al., 2015).”</p><disp-quote content-type="editor-comment"><p>7) The use of 50 microvolts for spike detection seems to be somewhat arbitrary. What is the typical noise level and the justification for this threshold? Was there an absolute upper-level threshold for a putative unit to eliminate artefacts?</p></disp-quote><p>The average noise level (median absolute deviation*1.4826) in our recordings was 11.3 ± 0.9 µV (mean ± SD), with very little variation across recording electrodes. Our 50 µV spike detection threshold is approximately 5 times this noise level. We note that this value is not hard-coded in FAST and can be easily altered to a multiple of the measured noise; we simply used this number for convenience. We have updated the text to include this information.</p><p>We did not have an absolute upper-level threshold to eliminate artefacts as we sometimes recorded spikes with large amplitudes exceeding 2 mV. Instead, artefacts that did not resemble spikes were eliminated in the subsequent clustering steps of the FAST algorithm.</p><disp-quote content-type="editor-comment"><p>8) The spike sorting method is a mixture of well-established algorithms and heuristics. While this is understandable, the heuristics have a number of &quot;parameters&quot; that clearly work well for the authors but might not generalize well to other systems. It would be useful to add a table of these parameters (tweaking knobs…) with range of values that you might recommend, so that readers and potential users are aware of these values. Here is the beginning of a long list: local chunks of 1000 spikes, 3x iteration for leftover spikes, 7 times the median of the absolute deviation for a threshold to get snippets, 15/1000 spikes for the leftover group, 1000 points for the second clustering, 10 cluster trees in the part 2, 0.02 threshold, etc.</p></disp-quote><p>We thank the reviewers for this excellent suggestion. We have prepared a new table (<xref ref-type="table" rid="table1">Table 1</xref>) listing the FAST parameter values that we found to work well for both the dorsolateral striatum and motor cortex.</p><disp-quote content-type="editor-comment"><p>9) How were the accelerometer data and the label of immobility (i.e. 2 SD threshold) validated?</p></disp-quote><p>We used video data recorded by the overhead web camera to validate this. Active and inactive periods of behavior were scored from &gt;8 hours of video (n=2 rats) at 1 s resolution by a human observer. The agreement between automatic and manual classifications was 94.3% . We have now included a table in the manuscript, showing the overlap between inactive and active periods in the manual and automatic classifications.</p><disp-quote content-type="editor-comment"><p>10) The claims of stability are based on relatively simply behavioral markers. This is important because some of the cited papers used much more complex tasks in non-human primates. One might imagine more task-related variability for cue-dependent tasks with more degrees-of-freedom. Were the data analyzed during periods of very stable performance (e.g. after around 20,000 trials)? This might have a bearing on stability of neural activity, especially if the animals are in a crystallized and perhaps habitual mode. Did the authors analyze data from the earlier period of training (several thousand trials)? If so, was there any increased variability?</p></disp-quote><p>We thank the reviewers for the opportunity to clarify our views on this topic.</p><p>We agree that the behaviors we train our rats on are, in some aspects, less complex than the tasks performed by non-human primates (NHPs) in previous studies, since the latter behaviors tend to be cue-driven and require greater trial-to-trial flexibility in motor planning. However, in other ways, our behavioral paradigms can be considered to be more complex in that animals generate sequences of precisely timed actions in contrast to the single ballistic movements performed by NHPs in center-out reaching tasks. In addition to the prescribed task (<xref ref-type="fig" rid="fig8">Figure 8C-F</xref>), our study also assays motor representations of many naturalistic behaviors such as grooming, active exploration and eating (<xref ref-type="fig" rid="fig8">Figure 8A-B</xref>). Furthermore, most studies in non-human primates have usually reported on stability of low-dimensional features of motor representations such as spike-count tuning curves or preferred movement direction. In contrast, we assay the stability of higher dimensional measures of motor representations such as spike-triggered averages and peri-event time histograms. In light of ongoing debates about motor coding in areas such as the motor cortex (Churchland et al., 2012; Georgopoulos et al., 1986; Kakei et al., 1999; Todorov, 2000) and striatum (Desmurget and Turner, 2010; Dudman and Krakauer, 2016; Graybiel, 1998), we believe that our measures make fewer assumptions about the encoding schemes in these circuits.</p><p>The animals used in our study had achieved expert performance on the interval pressing task prior to implantation of electrode arrays. The rationale behind this decision was that we wanted to assay stability of motor representations under conditions of stable behavior. We agree that it would be interesting to assay the stability of neural activity during the early learning phase of the task and we are actively pursuing this question in our laboratory, but we believe this experiment goes beyond the scope of the present study for the following reasons. First, many prior studies have reported instability of single neuron representations even under conditions of stable behavior (Carmena et al., 2005; Huber et al., 2012; Libertine et al., 2016; Mankin et al., 2012; Morcos and Harvey, 2016; Rokni et al., 2007; Ziv et al., 2013). Second, rats’ movement sequences in the early phase of the interval-pressing task are highly variable from one trial to the next (Kawai et al., 2015). Without knowing the neural code for movement in the motor cortex and striatum, this increased behavioral variability can confound measurements of the stability of motor representations.</p><disp-quote content-type="editor-comment"><p>11) The discussion on the long-term stability of neural dynamics could be improved. The manuscript mentions that statistical frameworks could contribute (i.e. the Carmena 2005 and the Rokni papers). Also there is mention that methodological factors could contribute. It would be helpful to place their own findings in context and address these issues more directly. As mentioned above, could the over trained performance have contributed?</p></disp-quote><p>We thank the reviewers for this suggestion. We have included the following paragraph to our discussion of long-term stability of neural dynamics.</p><p>“Discrepancies between our findings and other studies that report long-term instability of neural activity could, in some cases, be due to inherent differences between brain areas. […] Our experimental platform makes it feasible to characterize learning-related changes in task representations and relate them to reorganization of network dynamics over long time-scales.”</p></body></sub-article></article>