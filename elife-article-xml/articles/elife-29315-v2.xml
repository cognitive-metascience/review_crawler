<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">29315</article-id><article-id pub-id-type="doi">10.7554/eLife.29315</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Computer assisted detection of axonal bouton structural plasticity in <italic>in vivo</italic> time-lapse images</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-91592"><name><surname>Gala</surname><given-names>Rohan</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-1872-0957</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-91593"><name><surname>Lebrecht</surname><given-names>Daniel</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-91594"><name><surname>Sahlender</surname><given-names>Daniela A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0510-9529</contrib-id><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-73963"><name><surname>Jorstad</surname><given-names>Anne</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-6438-1979</contrib-id><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-17021"><name><surname>Knott</surname><given-names>Graham</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-2956-9052</contrib-id><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-1278"><name><surname>Holtmaat</surname><given-names>Anthony</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-7577-0769</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-89798"><name><surname>Stepanyants</surname><given-names>Armen</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-9387-2320</contrib-id><email>a.stepanyants@neu.edu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Department of Physics and Center for Interdisciplinary Research on Complex Systems</institution><institution>Northeastern University</institution><addr-line><named-content content-type="city">Boston</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Basic Neurosciences, Faculty of Medicine</institution><institution>University of Geneva</institution><addr-line><named-content content-type="city">Geneva</named-content></addr-line><country>Switzerland</country></aff><aff id="aff3"><label>3</label><institution>Lemanic Neuroscience Doctoral School</institution><country>Switzerland</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Biological Electron Microscopy Facility, Centre of Electron Microscopy</institution><institution>École Polytechnique Fédérale de Lausanne</institution><addr-line><named-content content-type="city">Lausanne</named-content></addr-line><country>Switzerland</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-1021"><name><surname>Marder</surname><given-names>Eve</given-names></name><role>Reviewing Editor</role><aff><institution>Brandeis University</institution><country>United States</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>23</day><month>10</month><year>2017</year></pub-date><pub-date pub-type="collection"><year>2017</year></pub-date><volume>6</volume><elocation-id>e29315</elocation-id><history><date date-type="received" iso-8601-date="2017-06-06"><day>06</day><month>06</month><year>2017</year></date><date date-type="accepted" iso-8601-date="2017-10-22"><day>22</day><month>10</month><year>2017</year></date></history><permissions><copyright-statement>© 2017, Gala et al</copyright-statement><copyright-year>2017</copyright-year><copyright-holder>Gala et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-29315-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.29315.001</object-id><p>The ability to measure minute structural changes in neural circuits is essential for long-term in vivo imaging studies. Here, we propose a methodology for detection and measurement of structural changes in axonal boutons imaged with time-lapse two-photon laser scanning microscopy (2PLSM). Correlative 2PLSM and 3D electron microscopy (EM) analysis, performed in mouse barrel cortex, showed that the proposed method has low fractions of false positive/negative bouton detections (2/0 out of 18), and that 2PLSM-based bouton weights are correlated with their volumes measured in EM (<italic>r</italic> = 0.93). Next, the method was applied to a set of axons imaged in quick succession to characterize measurement uncertainty. The results were used to construct a statistical model in which bouton addition, elimination, and size changes are described probabilistically, rather than being treated as deterministic events. Finally, we demonstrate that the model can be used to quantify significant structural changes in boutons in long-term imaging experiments.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>bouton detection</kwd><kwd>bouton volume</kwd><kwd>structural plasticity</kwd><kwd>time-lapse imaging</kwd><kwd>synaptic strength</kwd><kwd>CLEM</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01 NS091421</award-id><principal-award-recipient><name><surname>Stepanyants</surname><given-names>Armen</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000181</institution-id><institution>Air Force Office of Scientific Research</institution></institution-wrap></funding-source><award-id>FA9550-15-1-0398</award-id><principal-award-recipient><name><surname>Stepanyants</surname><given-names>Armen</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001711</institution-id><institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung</institution></institution-wrap></funding-source><award-id>331003A_153448</award-id><principal-award-recipient><name><surname>Holtmaat</surname><given-names>Anthony</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001711</institution-id><institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung</institution></institution-wrap></funding-source><award-id>CRSII3-154453</award-id><principal-award-recipient><name><surname>Knott</surname><given-names>Graham</given-names></name><name><surname>Holtmaat</surname><given-names>Anthony</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001711</institution-id><institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung</institution></institution-wrap></funding-source><award-id>51NF40_158776</award-id><principal-award-recipient><name><surname>Holtmaat</surname><given-names>Anthony</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001708</institution-id><institution>International Foundation for Research in Paraplegia</institution></institution-wrap></funding-source><award-id>Chair Alain Rossier</award-id><principal-award-recipient><name><surname>Holtmaat</surname><given-names>Anthony</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>BoutonAnalyzer software makes it possible to detect axonal boutons and measure their structural plasticity in long-term <italic>in vivo</italic> imaging experiments.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>The repertoire of synaptic connectivity within neuronal networks is immensely increased through the continuous formation and elimination of synapses (<xref ref-type="bibr" rid="bib4">Chklovskii et al., 2004</xref>; <xref ref-type="bibr" rid="bib32">Stepanyants et al., 2002</xref>). Indeed, in vivo imaging studies over the last 15 years have shown that synaptic structures remain dynamic throughout adulthood (<xref ref-type="bibr" rid="bib14">Holtmaat and Svoboda, 2009</xref>; <xref ref-type="bibr" rid="bib35">Trachtenberg et al., 2002</xref>). This structural plasticity, i.e. the appearance, disappearance, and the morphological modifications of synapses in the adult brain has been established as a fundamental underpinning of learning and experience-dependent changes in neuronal circuits (<xref ref-type="bibr" rid="bib15">Holtmaat and Caroni, 2016</xref>; <xref ref-type="bibr" rid="bib14">Holtmaat and Svoboda, 2009</xref>; <xref ref-type="bibr" rid="bib33">Stepanyants and Chklovskii, 2005</xref>).</p><p>Synapses in the central nervous system are morphologically distinct structures, visible only in electron microscopy (EM). In light microscopy (LM) a synapse can be detected based on the presence of a swelling on the axon, referred to as bouton, or a protrusion from the dendrite, known as spine. In the cerebral cortex, the majority of excitatory synapses and a minority of inhibitory synapses occur on dendritic spines (<xref ref-type="bibr" rid="bib9">Gray, 1959</xref>). Spines can easily be detected, hence most studies of structural plasticity have used manual or semi-automated tracking of these structures in time-lapse images to infer circuit changes (<xref ref-type="bibr" rid="bib14">Holtmaat and Svoboda, 2009</xref>). Yet, studies relying on tracking of dendritic spines may not reveal the full extent of synaptic plasticity because synapses can also occur on dendritic shafts. On the other hand, a dendrite’s presynaptic apposition can be detected as an irregularity or swelling on the axon. Similar to dendritic spines, such axonal boutons have long since been recognized as sites of functional connections between neurons (<xref ref-type="bibr" rid="bib36">Van Gehuchten, 1904</xref>). Therefore, the detection of these structures would provide a powerful means to analyze synaptic connectivity (<xref ref-type="bibr" rid="bib23">Markram et al., 2015</xref>; <xref ref-type="bibr" rid="bib24">Meyer et al., 2010</xref>)</p><p>Many EM studies have revealed a variety of presynaptic morphologies and the arrangements of vesicles, endoplasmic reticulum, and mitochondria therein (<xref ref-type="bibr" rid="bib11">Harris and Weinberg, 2012</xref>). This is the only method capable of verifying that LM observations of axonal boutons do indeed correspond to synaptic contacts, but applying such a method every time is difficult across large volumes and impossible at more than one time point. The few real-time imaging studies of presynaptic plasticity in vivo used semi-automatic detection methods to track individual axonal boutons in LM time-lapse images (<xref ref-type="bibr" rid="bib3">Chen et al., 2015</xref>; <xref ref-type="bibr" rid="bib6">De Paola et al., 2006</xref>; <xref ref-type="bibr" rid="bib10">Grillo et al., 2013</xref>; <xref ref-type="bibr" rid="bib13">Holtmaat et al., 2009</xref>; <xref ref-type="bibr" rid="bib16">Johnson et al., 2016</xref>; <xref ref-type="bibr" rid="bib19">Keck et al., 2011</xref>; <xref ref-type="bibr" rid="bib22">Majewska et al., 2006</xref>; <xref ref-type="bibr" rid="bib25">Mostany et al., 2013</xref>; <xref ref-type="bibr" rid="bib28">Qiao et al., 2016</xref>; <xref ref-type="bibr" rid="bib34">Stettler et al., 2006</xref>; <xref ref-type="bibr" rid="bib37">Yang et al., 2016</xref>). Visually isolated axons were segmented, and axonal boutons, as presumed synaptic contacts, were scored by virtue of their integrated fluorescence (<xref ref-type="bibr" rid="bib6">De Paola et al., 2006</xref>; <xref ref-type="bibr" rid="bib10">Grillo et al., 2013</xref>). Based on arbitrarily defined thresholds, boutons are usually scored in a binary fashion, i.e. present or absent. However, due to jitter in fluorescence caused by fluctuations in imaging conditions, binary scoring of boutons may lead to high false positive/negative rates.</p><p>Several computer-assisted methods aid axon segmentation (<xref ref-type="bibr" rid="bib1">Acciai et al., 2016</xref>; <xref ref-type="bibr" rid="bib26">Parekh and Ascoli, 2013</xref>) and bouton detection (<xref ref-type="bibr" rid="bib31">Song et al., 2016</xref>) in sparsely labeled tissue, but many challenges remain. The most difficult challenges to overcome are due to the limited resolution of two-photon microscopy (mainly along the optical axis, <italic>z</italic>). For example, due to the high density of boutons on cortical axons, boutons often lie in close proximity to one another and can appear fused in microscopy images (<xref ref-type="fig" rid="fig1">Figure 1</xref>). In densely labeled tissue bouton detection is further confounded by the fact that axons can also appear fused to one another which locally increases the integrated fluorescence. Furthermore, spatially and temporally non-uniform expression levels and the variability in axon caliber complicate the tracking of boutons over time. Such complications lead to inconsistencies and bias in LM-based bouton detection methods. The bias will affect bouton density estimates, while the inconsistencies, combined with binary scoring of boutons, will lead to an apparent increase in the bouton turnover rate.</p><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.002</object-id><label>Figure 1.</label><caption><title>Challenges in LM-based bouton detection and measurement.</title><p>(<bold>A</bold>) Maximum intensity <italic>xy</italic> projection of an image stack showing axons of fluorescently labeled neurons in superficial layers of mouse barrel cortex. High density of labeled axons makes it difficult to automatically detect boutons and track their structural changes over time. Scale bar is 20 μm. (<bold>B</bold>) A subset of labeled axons from the region outlined in (<bold>A</bold>). To improve visibility, image intensity beyond five voxels from the axon centerlines was set to zero. Bouton detection and bouton size measurement are confounded by large variations in fluorescence levels across axons. (<bold>C</bold>) Axons from (<bold>B</bold>) shown on the <italic>zx</italic> maximum intensity projection. Horizontal scale bars in (<bold>B</bold>) and (<bold>C</bold>) are 5 μm. Vertical scale bar in (<bold>C</bold>) is 15 μm. Lower resolution in <italic>z</italic> compared to <italic>xy</italic> is yet another challenge in bouton analyses. (<bold>D–F</bold>) Magnified views of the highlighted boutons from (<bold>B</bold>). Close proximity of boutons on an axon (<bold>D</bold>), large range of bouton sizes (<bold>E</bold>), and large range of bouton fluorescence levels (<bold>D–F</bold>), present additional obstacles to accurate bouton detection and measurement. Scale bar in (<bold>D–F</bold>) is 1.25 μm.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig1-v2"/></fig><p>Here, we describe semi-automated methodology for bouton detection and tracking in images acquired by 2-photon laser scanning microscopy (2PLSM) in vivo. We validate the results of the method with correlative 3D EM of in vivo imaged axons, and by applying the detection method to images acquired under various conditions that mimic the variability in time-lapse imaging. We quantify variability in bouton detection and propose a statistical model to deal with the inherent uncertainties of this LM-based detection method.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>LM-based bouton detection and measurement of structural changes</title><p>Here, we describe and evaluate a heuristic strategy that utilizes axon traces to detect and quantify boutons in 2PLSM images taken through a cranial window in vivo. This procedure consists of the following major steps: (1) tracing axons in 3D, (2) optimization of traces, (3) generation of axon intensity profiles, (4) detection of putative boutons based on the profiles, (5) normalization of intensity profiles and calculation of bouton weights, and (6) matching putative boutons across time-lapse images.</p><p>Axons can be traced automatically or manually with various tools (<xref ref-type="bibr" rid="bib1">Acciai et al., 2016</xref>; <xref ref-type="bibr" rid="bib26">Parekh and Ascoli, 2013</xref>). In this study, high density of labeled axons (<xref ref-type="fig" rid="fig1">Figure 1A</xref>) precluded the possibility of automated tracing. Therefore, axons were traced manually by using NCTracer software (<xref ref-type="bibr" rid="bib5">Chothani et al., 2011</xref>; <xref ref-type="bibr" rid="bib7">Gala et al., 2014</xref>), and traces were optimized as described in Materials and methods. Following optimization, two intensity profiles were generated for each axon by convolving specifically designed filters with the image at all trace node positions and scaling the results to unit means. While various filters can be used to generate axon intensity profiles, in this study, we settled on the following two: (1) a modified, multi-scale Laplacian of Gaussian filter (<italic>LoG<sub>xy</sub></italic>) to detect putative boutons and (2) a fixed size Gaussian filter (<italic>G</italic>) to provide an estimate of axon intensity in the regions devoid of boutons (see Materials and methods for details). In the following we will refer to such inter-bouton regions as axon shaft.<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>4</mml:mn><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo fence="true" maxsize="1.2em" minsize="1.2em" stretchy="true" symmetric="true">/</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>z</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mo fence="true" maxsize="1.2em" minsize="1.2em" stretchy="true" symmetric="true">/</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mi>z</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mi>π</mml:mi></mml:msqrt><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>G</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mi>z</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo fence="true" maxsize="1.2em" minsize="1.2em" stretchy="true" symmetric="true">/</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>π</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mrow><mml:mrow><mml:mo fence="true" stretchy="true" symmetric="true">/</mml:mo><mml:mrow/><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p><xref ref-type="fig" rid="fig2">Figure 2A and B</xref> show that distinct putative boutons can be identified as peaks in the <italic>LoG<sub>xy</sub></italic> profile plotted against node positions along the trace, <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. This is because the <italic>LoG<sub>xy</sub></italic> filter is designed to sharpen boundaries between boutons by suppressing intensity in the regions immediately adjacent to boutons. In contrast, the <italic>G</italic> filter yields a smoother profile, <inline-formula><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mi>G</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, which is not very useful for resolving putative boutons that are in close proximity (arrows in <xref ref-type="fig" rid="fig2">Figure 2C</xref>), but is well suited for estimating shaft intensity. For these reasons, <italic>LoG<sub>xy</sub></italic> profiles were used to identify putative boutons, while <italic>G</italic> profiles were used to determine intensities of axon shafts.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.003</object-id><label>Figure 2.</label><caption><title>Detection of putative boutons as peaks on axon intensity profiles.</title><p>(<bold>A</bold>) Maximum intensity <italic>xy</italic> projection of an axon segment showing multiple putative boutons. Yellow line is the optimized trace of this axon. (<bold>B</bold>) Putative boutons visible in (<bold>A</bold>) correspond to peaks on the <italic>LoG<sub>xy</sub></italic> intensity profile (black line). Foreground peaks (cyan lines) and local background (red line) are fitted to the intensity profile as described in the text. The overall fit (thick yellow line), which is the sum of foreground peaks and background, closely matches the intensity profile. (<bold>C</bold>) <italic>G</italic> intensity profile is obtained by sliding a fixed size Gaussian filter along the optimized trace. Small or closely positioned peaks cannot be resolved on the <italic>G</italic> profile (arrows). Peak amplitudes from the <italic>LoG<sub>xy</sub></italic> profile and background from the <italic>G</italic> profile are used to define bouton weights.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.29315.004</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Optimization is required for trace-based bouton detection and measurement.</title><p>(<bold>A</bold>) Five users traced the same set of 16 axon segments using manual tracing module of NCTracer software. Manual traces (colored lines) are shown superimposed on <italic>zx</italic> (top), <italic>yz</italic> (left), and <italic>xy</italic> (center) maximum intensity projection images of an axon segment. To improve visibility, image intensity beyond five voxels from the axon centerline was set to zero. While on the <italic>xy</italic> projection, manual traces closely match the underlying axon intensity, variability between traces becomes apparent by viewing the <italic>zx</italic> and <italic>yz</italic> projections. (<bold>B</bold>) User traces after optimization are virtually indistinguishable on all projections. (<bold>C</bold>) Axon intensity profiles can be obtained by sliding various filters along manual traces. Here, we show <italic>LoG<sub>xy</sub></italic> intensity profiles for the five manual user traces. Note that slight tracing inaccuracies may lead to large variability in axon intensity profiles, e.g. absent peak in the User four trace profile (dashed line). (<bold>D</bold>) Inter-user variability in axon intensity profiles is virtually eliminated after trace optimization.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig2-figsupp1-v2"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.29315.005</object-id><label>Figure 2—figure supplement 2.</label><caption><title>Trace optimization reduces variability in bouton detection and weight measurement.</title><p>(<bold>A</bold>) Putative boutons were automatically detected based on manual traces of 5 users. Differences in user traces lead to variability in putative bouton detection. The fraction of inter-user conflicts is particularly high for low weight boutons. (<bold>B</bold>) Trace optimization reduces the fraction of inter-user conflicts. (<bold>C</bold>) Trace optimization also reduces inter-user bias and variability in bouton weight measurements. (<bold>D</bold>) Root mean square (RMS) weight difference, calculated for putative boutons detected on manual (red points) and optimized traces (blue points), shows that optimization reduces variability in the entire range of bouton weights.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig2-figsupp2-v2"/></fig></fig-group><p>To automatically detect putative boutons in an <italic>LoG<sub>xy</sub></italic> profile we used an algorithm that is similar to the Backward-Stepwise Subset Selection method (<xref ref-type="bibr" rid="bib12">Hastie et al., 2009</xref>). Here, a varying number of foreground peaks, <inline-formula><mml:math id="inf3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, and a constant number of background peaks, <inline-formula><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, was fitted to <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> by minimizing the following objective function of peak positions, <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>and <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, amplitudes, <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>and <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, and widths, <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>and <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> (see Materials and methods for details):<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">min</mml:mo></mml:mrow><mml:mrow><mml:mfrac linethickness="0"><mml:mstyle displaystyle="false" scriptlevel="1"><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mstyle><mml:mstyle displaystyle="false" scriptlevel="1"><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mstyle></mml:mfrac></mml:mrow></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mspace width="thinmathspace"/><mml:mrow><mml:mo>≥</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:mn>0</mml:mn><mml:mo>;</mml:mo><mml:mspace width="1em"/><mml:mn>0.5</mml:mn><mml:mi>μ</mml:mi><mml:mi>m</mml:mi><mml:mo>≤</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>2.0</mml:mn><mml:mi>μ</mml:mi><mml:mi>m</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>;</mml:mo><mml:mspace width="1em"/><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mo>≥</mml:mo><mml:mn>20</mml:mn><mml:mi>μ</mml:mi><mml:mi>m</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We note that, though profile background was fit with a sum of spatially distributed peak functions, constraints imposed on their widths (<inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mo>≥</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> 20 μm) ensure that the fit varies slowly along the axon (red line in <xref ref-type="fig" rid="fig2">Figure 2B</xref>).</p><p>Following the detection of putative boutons, intensity of bouton <inline-formula><mml:math id="inf13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> was defined as the sum of the <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>-th foreground peak amplitude and background intensity at the peak location:<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Shaft intensity was estimated from the <italic>G</italic> profile by incorporating information about the positions of detected putative boutons, <xref ref-type="fig" rid="fig2">Figure 2C</xref>. To that end, we initialized the above described peak detection algorithm with the foreground and background peaks detected on the <italic>LoG<sub>xy</sub></italic> profile, but ran the algorithm on the <italic>G</italic> intensity profile. Shaft intensity for a given axon was defined as the fitted background intensity on the <italic>G</italic> profile, averaged over trace nodes,<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:msubsup><mml:mi>I</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>⟨</mml:mo><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>⟩</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In this expression, index <italic>G</italic> in the superscripts of peak amplitudes, <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, positions, <italic>μ</italic>, and widths, <italic>σ</italic>, was added to emphasize that these quantities are calculated based on the <italic>G</italic> intensity profile. We note that background intensity, <inline-formula><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, is designed to vary smoothly along the axon (red line in <xref ref-type="fig" rid="fig2">Figure 2C</xref>) and be independent of bouton density, providing a robust estimate of axon shaft intensity.</p><p>Our goal is to use intensity profiles to extract structural information related to the physical sizes of boutons. This task is hindered by the facts that axon intensity depends strongly on expression levels of fluorescent molecules (<xref ref-type="fig" rid="fig1">Figure 1A</xref>) and microscopy conditions. Therefore, to measure unbiased structural information, intensity profiles must be properly normalized. One may consider using median (or mean) profile intensity or local shaft intensity for normalization. However, these types of normalizations can lead to errors. For example, if density of boutons varies across axons, normalization with the median (or mean) may bias boutons on higher bouton density axons towards lower intensity values. Also, if density of boutons is sufficiently large, normalization with local shaft intensity can lead to variability as the latter cannot be measured reliably between closely positioned boutons.</p><p>Our heuristic normalization approach is based on the idea that by convolving the <italic>LoG<sub>xy</sub></italic> or <italic>G</italic> filter with the image at a trace node position <inline-formula><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> along axon <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in imaging session <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, we obtain a quantity that is proportional to three factors: <inline-formula><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, a factor related to imaging conditions [e.g. laser power, photomultiplier tube (PMT) voltage, and cranial window quality], <italic><inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic>, volume density of fluorescent molecules, and <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, a structural factor which has been linked to axon cross-section area (drawn perpendicular to the <italic>xy</italic> projection of the axon centerline) convolved with the microscope point-spread function (<xref ref-type="bibr" rid="bib31">Song et al., 2016</xref>) and profile filter:<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In creating the <italic>LoG<sub>xy</sub></italic> and <italic>G</italic> profiles (<xref ref-type="fig" rid="fig2">Figure 2</xref>) we rescale <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> to unit means in order to minimize effects related to imaging conditions and expression levels, thus isolating structural information:<disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⟩</mml:mo></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:mrow><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="thickmathspace"/><mml:mi>G</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⟩</mml:mo></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>It may be tempting to use putative bouton intensity, <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ3">Equation (3)</xref>, which is detected based on <inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> as proxy for bouton size. However, this may lead to bias as the denominators in <xref ref-type="disp-formula" rid="equ6">Equation (6)</xref> depend strongly on bouton density. To address this issue, we use axon shaft intensity detected from <italic>G</italic> intensity profiles, <inline-formula><mml:math id="inf27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ4">Equation (4)</xref>, for normalization. The resulting quantity, referred to as bouton weight, <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, conveys structural information, which is effectively independent of the above-mentioned bias,<disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mi>B</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p></sec><sec id="s2-2"><title>Validation of LM-based bouton detection methodology with EM</title><p>Correlative light and electron microscopy (CLEM) was used to validate the described bouton detection procedure (<xref ref-type="fig" rid="fig3">Figure 3</xref> and <xref ref-type="video" rid="fig3video1">Figure 3—video 1</xref>). Four axon segments were selected for this analysis (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). The axon segments were imaged in vivo with 2PLSM, the brain tissue was fixed shortly after, and subsequently imaged with EM (see Materials and methods for details). Putative boutons in the 2PLSM stack of images were detected and quantified as described above (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). Axons in EM images were reconstructed in 3D (<xref ref-type="fig" rid="fig3">Figure 3C</xref>) and rendered in Blender software for further analysis.</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.006</object-id><label>Figure 3.</label><caption><title>Correlative light and electron microscopy.</title><p>(<bold>A</bold>) Maximum intensity <italic>xy</italic> projection of an image stack used for CLEM analysis. White box demarcates the region imaged with EM. Colored lines are traces of four axon segments chosen for EM reconstruction. Scale bar is 10 μm. (<bold>B</bold>) Region outlined in (<bold>A</bold>) is shown at 4x magnification with background removed. (<bold>C</bold>) 3D EM reconstruction of the four axon segments shown in (<bold>B</bold>). Red areas mark PSDs, and blue volumes outline mitochondria. Most varicosities identified in EM are clearly visible in 2PLSM images (<bold>B</bold>). (<bold>D</bold>) Higher magnifications and different orientations of a subset of reconstructed varicosities shows that structural swellings on axons may or may not be associated with PSDs and/or contain mitochondria. Numbers in (<bold>B–D</bold>) enumerate distinct varicosities identified in EM.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig3-v2"/></fig><media id="fig3video1" mime-subtype="mp4" mimetype="video" xlink:href="elife-29315-fig3-video1.mp4"><object-id pub-id-type="doi">10.7554/eLife.29315.007</object-id><label>Figure 3—video 1.</label><caption><title>Illustration of correlative light and electron microscopy analysis.</title><p>LM-based bouton detection on four axon segments is validated with 3D EM-based reconstruction of the same axons. Dots indicate putative boutons detected automatically in LM. Their size is proportional to bouton weight. Color-code is the same as in <xref ref-type="fig" rid="fig3">Figure 3</xref>.</p></caption></media></fig-group><p>Putative boutons detected in 2PLSM images could be unambiguously matched with varicosities identified in EM (<xref ref-type="video" rid="fig3video1">Figure 3—video 1</xref>, asterisks in <xref ref-type="fig" rid="fig4">Figure 4A–D</xref>, and <xref ref-type="table" rid="table1">Table 1</xref>). We used positions of the centers of matched boutons to register LM traces and EM centerlines with an optimal linear transformation (<xref ref-type="bibr" rid="bib12">Hastie et al., 2009</xref>). Average distance between the registered traces (<xref ref-type="bibr" rid="bib7">Gala et al., 2014</xref>) was small, 0.34 ± 0.17 μm (mean ± s.d.), confirming that the same set of axons was reconstructed in LM and EM. A small discrepancy between registered traces may be attributed to non-linear distortion of tissue in the EM experiment and the relatively low <italic>z</italic>-resolution of LM. Overall, 16 boutons <italic>en passant</italic> and one bouton <italic>terminaux</italic> could be identified in EM. The bouton <italic>terminaux</italic> was detected with our method, but was excluded from further analysis because it is not located on the axon centerline. With the omission of this bouton, the LM-based procedure detected 18 putative boutons with 0 false negatives and two false positives, both of which were small (1.1 and 2.2 in weight, #18 and #19 in <xref ref-type="table" rid="table1">Table 1</xref>).</p><fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.008</object-id><label>Figure 4.</label><caption><title>Normalized intensity profile is correlated with axon cross-section area, while bouton weight is indicative of bouton volume.</title><p>(<bold>A–D</bold>) Top row: EM reconstructions of axons are shown next to the corresponding 2PLSM maximum intensity projections. Varicosities identified in EM are marked with grey asterisks, and putative boutons automatically detected based on the intensity profiles are marked with green asterisks. Second row: Normalized intensity profiles of the same axons plotted as functions of position along axon centerlines obtained in EM. Third row: <italic>z</italic> cross-section areas of axons, including (black) and excluding (blue) mitochondria, are well correlated with intensity profiles. These cross-sections are drawn perpendicular to the 2PLSM <italic>xy</italic> projections of the axon centerlines. Fourth row: Normal cross-section areas showing the extents of boutons (green) based on criteria described in Materials and methods. (<bold>E</bold>) Demarcated boutons shown in 3D (green). Bouton weights are highly correlated with their EM-based volumes that include (<bold>F</bold>) or exclude (<bold>G</bold>) mitochondrial volumes. Grey regions in (<bold>B</bold>) highlight two spurious peaks in the normalized intensity profile, one resulting from a close apposition of two axons and another caused by the presence of a terminal bouton. Such regions were annotated in 2PLSM images and were excluded from all analyses. In addition, bouton #7 (red box in B, F, and G) was excluded from the correlation analysis because it is directly adjacent to a branch point, which biases weight calculation.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig4-v2"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.29315.009</object-id><label>Figure 4—figure supplement 1.</label><caption><title>Filter type, filter size, and profile normalization can affect bouton detection and measurement.</title><p>(<bold>A–D</bold>) Comparison of axon intensity profiles obtained with different filters. Each profile is plotted as a function of position on axon trace obtained in LM. Top row: EM reconstructions and 2PLSM maximum intensity projections for the four axons included in CLEM analyses (same as shown in <xref ref-type="fig" rid="fig4">Figure 4</xref>). Rows 2–8 show intensity profiles of these axons generated by using raw voxel intensities along the trace, mean filters of box sizes 3 × 3 × 3 and 5 × 5 × 5, Gaussian filters [see <xref ref-type="disp-formula" rid="equ1">Equation (1)</xref>] of sizes <italic>R</italic> = 1 and <italic>R</italic> = 2, and median filters of box sizes 3 × 3 × 3 and 5 × 5 × 5. Each profile was normalized by its median profile intensity. Row 9 shows multi-scale <italic>LoG<sub>xy</sub></italic> profiles normalized by shaft intensities. In the absence of filtering, profiles appear jagged, which may lead to false positives in peak detection (arrows). On the other hand, large filters (5 × 5 × 5 and <italic>R</italic> = 2) may not resolve small boutons or closely positioned boutons (arrows). When the filter size is carefully tuned (3 × 3 × 3 and <italic>R</italic> = 1 in this case) profiles generated by various filters may appear similar to those obtained with the multi-scale <italic>LoG<sub>xy</sub></italic>. (<bold>E</bold>) Bouton measurements based on these profiles were compared to bouton volumes measured in EM. <italic>LoG<sub>xy</sub></italic> filter profile normalized with shaft intensity leads to both accurate bouton detection and highest degree of correlation between peak amplitudes on the profiles and bouton volumes.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig4-figsupp1-v2"/></fig></fig-group><table-wrap id="table1" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.010</object-id><label>Table 1.</label><caption><title>Comparison of LM-based and EM measurements.</title><p>Bouton IDs match those in <xref ref-type="fig" rid="fig3">Figures 3</xref> and <xref ref-type="fig" rid="fig4">4</xref>. The probability that a putative bouton belongs to the category of LM boutons, <italic><inline-formula><mml:math id="inf29"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula></italic> was calculated according to <xref ref-type="disp-formula" rid="equ9">Equation (9)</xref> with <inline-formula><mml:math id="inf30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0. Bouton #8 (grey) was excluded from the analyses as it is a terminal bouton. Hyphens indicate that boutons, mitochondria, or PSDs were not detected in EM.</p></caption><table frame="hsides" rules="groups"><thead><tr><th/><th/><th colspan="2"><italic>2PLSM measurements</italic></th><th colspan="3"><italic>EM measurements</italic></th></tr><tr><th/><th>Bouton ID</th><th>Putative bouton weight, <italic>w</italic></th><th><italic>P(bouton</italic> | <italic>w)</italic></th><th>Bouton volume [μm<sup>3</sup>]</th><th>Mitochondria volume [μm<sup>3</sup>]</th><th>PSD surface area [μm<sup>2</sup>]</th></tr></thead><tbody><tr><td rowspan="6"><italic>Axon 1</italic></td><td>1</td><td>13.5</td><td>1.00</td><td>0.919</td><td>0.189</td><td>0.666</td></tr><tr><td>2</td><td>10.8</td><td>1.00</td><td>0.779</td><td>0.170</td><td>0.595</td></tr><tr><td>3</td><td>1.98</td><td>0.48</td><td>0.093</td><td>-</td><td>0.371</td></tr><tr><td>4</td><td>10.1</td><td>1.00</td><td>0.998</td><td>0.225</td><td>1.92</td></tr><tr><td>5</td><td>8.65</td><td>1.00</td><td>0.669</td><td>0.139</td><td>1.83</td></tr><tr><td>6</td><td>6.25</td><td>1.00</td><td>0.219</td><td>0.043</td><td>0.138</td></tr><tr><td rowspan="3"><italic>Axon 2</italic></td><td>7</td><td>3.63</td><td>0.93</td><td>0.483</td><td>0.111</td><td>0.612</td></tr><tr><td style="author-callout-style-b8">8</td><td style="author-callout-style-b8">N/A</td><td style="author-callout-style-b8">N/A</td><td style="author-callout-style-b8">0.574</td><td style="author-callout-style-b8">-</td><td style="author-callout-style-b8">2.75</td></tr><tr><td>9</td><td>5.57</td><td>1.00</td><td>0.372</td><td>0.027</td><td>1.28</td></tr><tr><td rowspan="4"><italic>Axon 3</italic></td><td>10</td><td>9.54</td><td>1.00</td><td>0.632</td><td>0.182</td><td>0.645</td></tr><tr><td>11</td><td>1.99</td><td>0.49</td><td>0.102</td><td>-</td><td>-</td></tr><tr><td>12</td><td>8.51</td><td>1.00</td><td>0.456</td><td>-</td><td>1.23</td></tr><tr><td>13</td><td>10.8</td><td>1.00</td><td>0.704</td><td>0.161</td><td>1.49</td></tr><tr><td rowspan="6"><italic>Axon 4</italic></td><td>14</td><td>5.80</td><td>1.00</td><td>0.308</td><td>-</td><td>0.867</td></tr><tr><td>15</td><td>4.23</td><td>1.00</td><td>0.198</td><td>-</td><td>0.686</td></tr><tr><td>16</td><td>5.96</td><td>1.00</td><td>0.229</td><td>0.027</td><td>0.402</td></tr><tr><td>17</td><td>2.85</td><td>0.93</td><td>0.140</td><td>-</td><td>-</td></tr><tr><td>18</td><td>1.14</td><td>0.01</td><td>-</td><td>-</td><td>-</td></tr><tr><td>19</td><td>2.19</td><td>0.65</td><td>-</td><td>-</td><td>-</td></tr></tbody></table></table-wrap><p>We tested the idea that 2PLSM intensity is correlated to the area of axon cross-section drawn perpendicular to the <italic>xy</italic> projection of axon centerline (<xref ref-type="bibr" rid="bib31">Song et al., 2016</xref>). We refer to such cross-sections as <italic>z</italic> cross-sections (third row in <xref ref-type="fig" rid="fig4">Figure 4A–D</xref>) to distinguish them from normal cross-sections, which are drawn perpendicular to the axon centerline. For this, we calculated the normalized axon intensity profile, <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>o</mml:mi><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, and compared it to EM <italic>z</italic> cross-section areas including and excluding mitochondrial <italic>z</italic> cross-section areas. Both <italic>z</italic> cross-section areas appear to be well correlated with normalized intensity profiles. However, it is clear from visual inspection that the normalized intensity profiles do not resolve small changes in axon cross-section, which is the result of limited resolution of 2PLSM.</p><p>To examine the extent to which LM-based measurements provide information about bouton size, we plotted bouton weight against bouton volumes including (<xref ref-type="fig" rid="fig4">Figure 4F</xref>) and excluding (<xref ref-type="fig" rid="fig4">Figure 4G</xref>) mitochondrial volume. Normal axon cross-sections were used to identify bouton boundaries and calculate bouton volume as described in Materials and methods (fourth row in <xref ref-type="fig" rid="fig4">Figure 4A–D</xref> and <xref ref-type="fig" rid="fig4">Figure 4E</xref>). Bouton #7 (red box in <xref ref-type="fig" rid="fig4">Figure 4B</xref>) was excluded from these analyses, because it is bounded on one side by the terminal bouton branch which biases weight measurement. The results show high degree of correlation in both cases (Pearson’s <italic>r</italic> = 0.93), supporting the idea that LM-based measurements can be used to quantify volumes of even very small varicosities (#3, 0.093 μm<sup>3</sup>). The results also provide support for the choice of filters, <xref ref-type="disp-formula" rid="equ1">Equation (1)</xref>, and the normalization procedure, <xref ref-type="disp-formula" rid="equ7">Equation (7)</xref>, showing that the proposed method could overcome axon-specific differences in the expression levels and bouton density, capturing meaningful fine-scale structural information.</p><p>It is important to emphasize that we did not attempt to find the best procedure for fitting the EM data. It is possible that some other combinations of filter types, normalizations, and parameters would lead to marginally better correlations. However, due to the small sample size, this would likely be a case of over-fitting. The described procedure was designed based on theoretical considerations, and the parameters were chosen based on the observed range of bouton sizes (see Materials and methods). Nonetheless, we explored alternative filtering and normalization strategies. <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref> shows profiles derived from raw voxel intensities, and profiles obtained with mean, Gaussian, and median filters of different but fixed sizes. Each of these profiles was normalized by its median value. The figure makes it clear that some amount of filtering benefits bouton detection, as jagged unfiltered profiles can lead to false positives. Similarly, relatively large filters of fixed size (e.g. 5 × 5 × 5 and <italic>R</italic> = 2) are not well suited for bouton detection as they often suppress intensities of small boutons and merge closely positioned boutons. When the filter size is carefully tuned (3 × 3 × 3 and <italic>R</italic> = 1), resulting profiles can look similar to those of multi-scale <italic>LoG<sub>xy</sub></italic>, although higher baselines in these profiles can make peak detection more challenging. Furthermore, we examined the combined effect of filtering and normalization on bouton measurement by comparing the amplitudes of profile peaks to corresponding bouton volumes. Multi-scale <italic>LoG<sub>xy</sub></italic> profile normalized with shaft intensity as described above leads to the highest correlation compared to the best considered alternatives (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1E</xref>).</p></sec><sec id="s2-3"><title>Effects of imaging conditions on bouton analysis</title><p>Next, we sought to evaluate the effects of various imaging conditions on bouton detection and measurement. To that end, a set of fluorescently labeled axons was imaged seven times in a span of 80 min with different laser power (LP) and PMT voltage (see inset in <xref ref-type="fig" rid="fig5">Figure 5A</xref>). In addition, in condition E, a thin layer of agarose was applied to the cranial window to mimic deterioration of window quality which often accompanies long-term imaging experiments. In the following, we assume that there is negligible structural plasticity of boutons throughout the duration of this short-term imaging experiment, and therefore differences in bouton measurements can be attributed to the effects of imaging conditions and measurement uncertainties. The inset in <xref ref-type="fig" rid="fig5">Figure 5B</xref> shows the maximum intensity projections of an axon segment imaged in all seven conditions. This inset illustrates that increasing (decreasing) LP and/or PMT voltage results in an overall increase (decrease) in intensity, and therefore proper normalization procedure must be used to minimize the effects of such changes on bouton measurements.</p><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.011</object-id><label>Figure 5.</label><caption><title>Probabilistic definition of an LM bouton based on measurement uncertainty derived from short-term imaging experiments.</title><p>The same set of axons was imaged 7 times within 80 min with various microscope settings and cranial window conditions (inset in A). Putative boutons detected based on the first imaging session (condition A) were chosen to be the gold standard. Precision (<bold>A</bold>) and recall (<bold>B</bold>) in bouton detection were measured under the remaining conditions, B-G. Both precision and recall increase with bouton weight. While for very small boutons (<inline-formula><mml:math id="inf32"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &lt; 2.0, dashed line) detection is unreliable, agreement with the gold standard is achieved across all imaging conditions in 95% of boutons with weights greater than 2.0. Numbers of boutons in the gold standard are indicated next to the data points in (<bold>A</bold>). Inset in (<bold>B</bold>) shows an example of one axon segment imaged in conditions A-G. (<bold>C</bold>) Bouton weights under different imaging conditions are plotted against the gold standard weight. Best fit lines show no significant bias for conditions B and C, however small, but significant reduction in mean bouton weight was observed in the remaining four conditions (all p &lt; 0.03, two-sample <italic>t</italic>-test). Abbreviations used in the inset of A: LP is laser power in mW, PMT denotes photomultiplier tube voltage in Volts, and WC is cranial window condition, where ‘n’ stands for normal and ‘a’ indicates presence of a thin layer of agarose. Color code used in (<bold>A–C</bold>) is defined by the inset table in (<bold>A</bold>). (<bold>D</bold>) CDFs for differences in bouton weights across imaging conditions. Data from all conditions were pooled. Different lines show CDFs for various intervals of mean bouton weight. (<bold>E</bold>) Variance in bouton weight difference increases linearly with mean bouton weight (<italic>χ</italic><sup>2</sup> linear regression with <inline-formula><mml:math id="inf33"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi>var</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mrow><mml:mo>⟨</mml:mo><mml:mi>w</mml:mi><mml:mo>⟩</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, p <italic>= </italic>0.33, <italic>α</italic> = 0.24 ± 0.01, mean ± s.d.). Error-bars indicate standard deviations obtained with bootstrap sampling with replacement. (<bold>F</bold>) Red line shows the distribution of true bouton weight for a putative bouton of measured weight <inline-formula><mml:math id="inf34"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 1.5. Area under the curve to the right of <inline-formula><mml:math id="inf35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0 gives <inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> = 0.12. Large putative boutons (e.g. blue curve, <inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 3.0) have high probability of being LM boutons.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig5-v2"/></fig><p>Putative boutons on 16 axon segments were detected in all conditions independently (400 putative boutons per condition on average). Custom software was used to match the same putative boutons across conditions. Putative boutons detected in condition A were chosen to be the gold standard, and precision/recall in bouton detection in the remaining conditions B-G were evaluated as functions of bouton weight (<xref ref-type="fig" rid="fig5">Figure 5A and B</xref>). The results show that for 95% of putative boutons of weight <inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 2.0 both precision and recall equal one in all conditions. This number of unambiguously detected putative boutons goes up to 99% for <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 2.5 and 100% for <inline-formula><mml:math id="inf40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 3.1. For reference, <inline-formula><mml:math id="inf41"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0 corresponds to the weights of the two smallest varicosities identified in EM (#3 and #11 in <xref ref-type="table" rid="table1">Table 1</xref>), and the weight of the next smallest bouton (#17) is <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.8. Therefore, all but very small boutons can be detected with our method with high confidence.</p><p>To examine the effects of imaging conditions on bouton weight, we tested a subset of 290 putative boutons that were detected and matched across all seven experiments. <xref ref-type="fig" rid="fig5">Figure 5C</xref> shows bouton weights in conditions B-G plotted against the corresponding weights in condition A. Although axon intensities in conditions B and C are drastically different from A (see inset in <xref ref-type="fig" rid="fig5">Figure 5B</xref>), the normalization procedure could correct for these differences (blue and red lines in <xref ref-type="fig" rid="fig5">Figure 5C</xref>). However, small (≈ 7%) but significant bias was present in conditions D-G, which may have been caused by bleaching due to prolonged imaging. <xref ref-type="fig" rid="fig5">Figure 5C</xref> also reveals a considerable amount of variability in weight measurements. This variability, reflected in the <italic>R</italic><sup>2</sup> coefficients, was similar across all comparisons, including the imaging experiments performed under the same conditions (e.g. A and G, cyan points). Therefore, bouton weight measurements are accompanied with uncertainty which is inherent to the LM-based methodology. This uncertainty cannot be eliminated entirely, and hence, it must be explicitly incorporated into models that derive biological information from bouton measurements.</p></sec><sec id="s2-4"><title>Statistical framework for the analysis of structural plasticity of boutons</title><p>To model the variability observed in <xref ref-type="fig" rid="fig5">Figure 5C</xref>, we examined bouton weight differences for all pairs of imaging conditions, <inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>w</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. Because such changes clearly depend on bouton size, we looked at the statistics of <inline-formula><mml:math id="inf44"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in various intervals of average bouton weight, <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:mi>w</mml:mi><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>. <xref ref-type="fig" rid="fig5">Figure 5D</xref> shows the cumulative distribution functions (CDFs) of bouton weight differences in eight intervals of <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:mi>w</mml:mi><mml:mo>⟩</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. These distributions are not significantly different from Gaussian distributions, and their variances are roughly proportional to the mean bouton weights, <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi>var</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mrow><mml:mo>⟨</mml:mo><mml:mi>w</mml:mi><mml:mo>⟩</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, <xref ref-type="fig" rid="fig5">Figure 5E</xref>. Therefore, all CDFs shown in <xref ref-type="fig" rid="fig5">Figure 5D</xref> could be standardized by rescaling the weight differences as <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msqrt><mml:mi>α</mml:mi><mml:mrow><mml:mo>⟨</mml:mo><mml:mi>w</mml:mi><mml:mo>⟩</mml:mo></mml:mrow></mml:msqrt></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, leading to distributions that are statistically indistinguishable from the Standard Normal CDF (all p &gt; 0.05, one-sample KS test).</p><p>Based on this result, we propose a statistical model in which measured bouton weight, <inline-formula><mml:math id="inf49"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, is the sum of the true weight, <inline-formula><mml:math id="inf50"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, and a noise term, <italic>δ</italic>. The latter is randomly drawn from a Gaussian distribution with variance proportional to the measured weight, <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi>var</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>α</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ8"><label>(8)</label><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>;</mml:mo><mml:mspace width="1em"/><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mi>δ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo fence="true" stretchy="true" symmetric="true">/</mml:mo><mml:mrow><mml:mrow><mml:mpadded width="0"><mml:mphantom><mml:mrow><mml:mrow><mml:msup><mml:mi>δ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mi>α</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:mphantom></mml:mpadded></mml:mrow></mml:mrow><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow><mml:mrow><mml:mi>α</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mi>π</mml:mi><mml:mi>α</mml:mi><mml:mi>w</mml:mi></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p><xref ref-type="disp-formula" rid="equ8">Equation (8)</xref> quantifies uncertainties in bouton weight measurements, making it possible to define bouton presence probabilistically. To that end, we impose a threshold on true bouton weight, <italic><inline-formula><mml:math id="inf52"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></italic>, and refer to putative boutons with <inline-formula><mml:math id="inf53"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; <inline-formula><mml:math id="inf54"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, as LM (light microscopy) boutons. In the following we set <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0, which is motivated by several considerations. First, this value equals twice the average normalized axon shaft intensity. Therefore, by using <inline-formula><mml:math id="inf56"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0 we are only including peaks that are substantially larger than the axon shaft intensity. Second, <inline-formula><mml:math id="inf57"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 2.0 corresponds to the weights of the two smallest varicosities detected in EM (#3 and #11 in <xref ref-type="table" rid="table1">Table 1</xref>). Finally, detection of putative boutons becomes unreliable for <inline-formula><mml:math id="inf58"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &lt; 2.0 (<xref ref-type="fig" rid="fig5">Figure 5A and B</xref>). We note that as an alternative to choosing a single threshold value to define LM boutons, one could vary the threshold in a certain range (e.g. 1–3) and report results as functions of this parameter.</p><p>The probability that a putative bouton of measured weight <inline-formula><mml:math id="inf59"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> belongs to the category of LM boutons, <inline-formula><mml:math id="inf60"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, can be calculated based on the noise model of <xref ref-type="disp-formula" rid="equ8">Equation (8)</xref>:<disp-formula id="equ9"><label>(9)</label><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mi>α</mml:mi><mml:mi>w</mml:mi></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>In this expression, <inline-formula><mml:math id="inf61"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> denotes the error function. Shaded regions in <xref ref-type="fig" rid="fig5">Figure 5F</xref> illustrate these probabilities for two putative boutons of measured weights <inline-formula><mml:math id="inf62"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 1.5 and <inline-formula><mml:math id="inf63"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> = 3.0. Note that even when <inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> is less than <inline-formula><mml:math id="inf65"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, there is a non-zero probability that the detected peak is an LM bouton. For large <inline-formula><mml:math id="inf66"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> (e.g. greater than 3), this probability approaches unity, and the LM bouton definition becomes virtually deterministic.</p><p>LM bouton definition can be used to calculate the probabilities of bouton addition, elimination, potentiation, and depression based on the measured weights in two imaging sessions (initial and final), <inline-formula><mml:math id="inf67"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf68"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ10"><label>(10)</label><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd/><mml:mtd><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd/></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>×</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We would like to clarify that LM boutons may or may not correspond to varicosities seen in EM (<xref ref-type="table" rid="table1">Table 1</xref>), and the latter may not always be associated with postsynaptic densities (PSDs) and, thus, functional synapses (<xref ref-type="bibr" rid="bib30">Shepherd and Harris, 1998</xref>). Therefore, the relationship between an LM bouton and a synapse is not deterministic and is likely to contain false-positives and false-negatives. However, the number of such errors is expected to decrease with increasing <inline-formula><mml:math id="inf69"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. For example, <xref ref-type="table" rid="table1">Table 1</xref> shows that all LM boutons of <inline-formula><mml:math id="inf70"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 2.2 correspond to EM varicosities, and all LM boutons of <inline-formula><mml:math id="inf71"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &gt; 2.9 are varicosities associated with PSDs.</p></sec><sec id="s2-5"><title>Bouton changes can be resolved despite the uncertainty in measurements</title><p>Next, we set out to determine if the above described bouton detection procedure can be used to identify significant structural changes in long-term, in vivo imaging experiments. To that end, axons of GFP labeled neurons were imaged in superficial layers of barrel cortex in five mice. Imaging was performed at 4 day intervals over a 24 day period (seven imaging sessions). On average, 968 bouton sites were detected on 20 axon segments in each animal and imaging session. These sites were tracked over the duration of the experiment (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>) to quantify bouton addition, elimination, and weight changes as compared to the initial state of the circuit. The short-term imaging experiment of <xref ref-type="fig" rid="fig5">Figure 5</xref> was used as control. Here, conditions B-G were compared to condition A, and the results were pooled.</p><p><xref ref-type="fig" rid="fig6">Figure 6A</xref> shows the fraction of added LM boutons over time, as compared to the first imaging session. Specifically, we only consider significant bouton addition events, i.e. those for which the probability of addition according to <xref ref-type="disp-formula" rid="equ10">Equation (10)</xref> is greater than 0.95. Analogous plots for the fractions of significant bouton eliminations and significant bouton weight changes (potentiation and depression combined) are shown in <xref ref-type="fig" rid="fig6">Figure 6B and C</xref> respectively. As was expected, the fractions of significant changes in the short-term imaging experiment (red points in <xref ref-type="fig" rid="fig6">Figure 6</xref>) are at the chance levels (dashed red lines). The latter was obtained with a bootstrap procedure in which the weights of individual boutons were independently shuffled across conditions. In contrast, in the long-term imaging experiment, the fractions of significant bouton additions, eliminations, and weight changes are significantly larger than chance already by the second imaging session (after 4 days), and these fractions continue to increase with time, consistent with the idea of gradual modification of the circuit. These results illustrate that the described methodology can be used to quantify circuit changes, despite the numerous challenges associated with long-term, in vivo imaging experiments.</p><fig-group><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.29315.012</object-id><label>Figure 6.</label><caption><title>Structural change in boutons can be resolved in long-term in vivo imaging experiments despite measurement noise.</title><p>(<bold>A</bold>) Fraction of boutons that are absent on day 0 and are present at a later time with joint probability of 0.95 or greater (significant bouton addition). Red point (error-bars are too small to be visible) shows this fraction in images acquired within 80 min (conditions A-G). Black points show the results for a long-term imaging experiment. Statistically significant fraction of added boutons is detected after 4 days (interval between imaging sessions), and this fraction grows with time, consistent with the idea of gradual modification of the initial circuit. Similar trends were observed for the fractions of significant bouton eliminations (<bold>B</bold>) and significant bouton weight changes. Dashed red lines in (<bold>A–C</bold>) indicate baseline circuit changes expected from the statistical model. Error-bars indicate standard deviations based on Poisson statistics.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig6-v2"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.29315.013</object-id><label>Figure 6—figure supplement 1.</label><caption><title>Matching boutons in time-lapse images.</title><p>(<bold>A</bold>). <italic>xy</italic> projection of an axon segment that was imaged at 4 day intervals over a period of 68 days. Image intensity in each session is normalized independently as described for intensity profiles. Colored lines link corresponding putative boutons. These lines do not always run in parallel due to small rotations of the brain, nonlinear tissue distortions, and movements of boutons. (<bold>B</bold>). Normalized and aligned intensity profiles of the axon from A (see Materials and methods for details). Arrows indicate two locations on the axon where a bouton present on day 0 was eliminated after few imaging sessions.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29315-fig6-figsupp1-v2"/></fig></fig-group></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Detection of structural changes in boutons is hindered by various technical challenges and fundamental limitations of light microscopy. Unfortunately, any uncertainty that enters the analysis of long-term in vivo imaging data manifests itself as spurious structural plasticity. Therefore, it is important to account for all sources of errors, minimize their effect, and incorporate the residual uncertainty into the interpretation of results. Below, we describe various sources of errors affecting bouton measurements.</p><p>First, fluorescence based measurements provide only indirect evidence of bouton size. Therefore, such measurements need to be validated by showing that they are informative of bouton structures. In this study, we used CLEM to show that bouton weight, defined based on 2PLSM data, is well correlated with bouton volume (<xref ref-type="fig" rid="fig4">Figure 4F and G</xref>). Second, variability in expression levels of fluorescent proteins across axons and within axons over time makes it difficult to compare boutons on different axons and to identify true structural changes. Here, these problems were mitigated by a specifically designed normalization procedure (<xref ref-type="fig" rid="fig2">Figure 2</xref>), which was verified with CLEM (<xref ref-type="fig" rid="fig4">Figure 4</xref>) and was tested in the short-term imaging experiment (<xref ref-type="fig" rid="fig5">Figure 5A–C</xref>). Third, because the resolution of 2PLSM (≈ 0.3 µm in <italic>xy</italic>) is not much smaller than bouton size (≈ 1 µm for small boutons in <xref ref-type="fig" rid="fig3">Figure 3</xref>), there are inherent uncertainties in detection of small boutons, differentiation of closely positioned boutons, and measurement of bouton size changes. These uncertainties of the imaging method cannot be eliminated, and, therefore, they must be modeled to ensure that bouton measurements are interpreted correctly (<xref ref-type="fig" rid="fig5">Figure 5D–F</xref>).</p><p>Many other technical issues can add to the uncertainty and introduce bias in bouton measurements. For example, deterioration of cranial window quality with time, deformation of brain tissue, small changes in brain orientation relative to the microscope, and slight movement of boutons along axons can lead to the perception of increased plasticity. In contrast, limited temporal resolution of long-term imaging experiments, typically few days between imaging sessions, can lead to an underestimate of plasticity, as changes that occur between imaging sessions remain unaccounted. Finally, uncertainty can arise from the computational method used to detect boutons. <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref> shows that computational uncertainty of the method described in this study is small and can be ignored considering contributions from other sources (<xref ref-type="fig" rid="fig5">Figure 5C</xref>).</p><p>It is important to emphasize that not every putative bouton detected in LM will correspond to a varicosity if imaged with EM. This is particularly so for very small putative boutons (<inline-formula><mml:math id="inf72"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> &lt; 2.0, bouton volume &lt; 0.1 μm<sup>3</sup>) which can result from noise in fluorescence or inhomogeneity in labeling. In the absence of a reliable synaptic marker, the only reasonable way to eliminate such functionally irrelevant putative boutons is by imposing a threshold on bouton weight. In this study, we refer to putative boutons whose true weight exceeds the threshold as LM boutons and suggest setting this threshold at 2.0 based on CLEM and short-term imaging experiments. In practice, one may vary the threshold in a small range to ensure that specific conclusions are robust to the choice of this parameter.</p><p>Using a threshold to define an LM bouton as an all-or-none entity may impose a bias since the true bouton weight is unknown due to measurement uncertainty. The problem is exacerbated by the unimodal shape of bouton weight distributions (see <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>), because of which a large fraction of weights will lie within the range of uncertainty around the threshold, regardless of its value. Such ambiguous boutons can either be discarded, which may bias biological interpretation, or, otherwise, they must be treated probabilistically. For example, probabilistic description is essential for calculation of the expected number of LM boutons. Simply counting the number of above threshold weights would result in an underestimate as bouton weight distribution is monotonically decreasing. Similar considerations apply to calculations of expected numbers of added, eliminated, potentiated, and depressed boutons. As most bouton structures are stable and do not change substantially over days-to-weeks, their weight changes often lie within the range of measurement uncertainty and must also be described probabilistically. Furthermore, probabilistic description is necessary for calculation of error-bars and for establishing statistical significance of results. To illustrate the feasibility of this approach, we applied it to a dataset of 4840 bouton sites tracked over 24 days. <xref ref-type="fig" rid="fig6">Figure 6</xref> shows that statistically significant changes in LM boutons can be detected in long-term imaging experiments. It remains to be seen if the detected changes are informative of circuit alterations that subserve the many functions of the brain.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>In vivo imaging</title><p>All experiments were performed according to the guidelines of the Swiss Federal Act on Animal Protection and Swiss Animal Protection Ordinance. The ethics committee of the University of Geneva and the Cantonal Veterinary Office of Geneva, Switzerland (approval code GE/61/17) approved all experiments.</p><p>For development of the detection methodology we used data from mice that had been repeatedly imaged as part of a larger optical micro-stimulation and behavioral study (not yet published). Only the methodology that is relevant for the present study will be mentioned. Adeno-associated viral (AAV) vectors encoding floxed GFP (AAV2/9.CAG.flex.eGFP.WPRE.bGH2 [Upen]) were co-injected with an AAV vector encoding Cre (AAV2/9.hSynapsin.hGHintron.GFP-Cre.WPRE.SV40 [Upen]) at a ratio of 0.15 × 10<sup>9</sup>: 1 (genome copies: genome copies). This produced an average of about 150 GFP-expressing cells per animal, mostly in L2/3 and L5 of the barrel cortex. We exclusively imaged the processes of these neurons in the upper layers of the cortex. Hence, the source of the fluorescent signal in the green channel is dominated by cytosolic GFP.</p><p>Following the AAV injection, we implanted a 3 mm diameter glass window over the barrel cortex as previously described (<xref ref-type="bibr" rid="bib13">Holtmaat et al., 2009</xref>). Imaging experiments were started 6 weeks after the virus injection. Imaging was performed under anaesthesia (0.5–1.5% isoflurane). A custom-built alignment system was used to ensure identical positioning of the mouse’s cranial window at different time points, and to avoid rotations relative to the axial dimension of the objective. The system was based on aligning a beam reflected by the cranial window through two apertures, which uniquely determines a line in three spatial dimensions. The apertures and the laser position were constant, and the only free variables were the cranial window position and rotation (i.e., the <italic>x</italic>, <italic>y</italic>, and <italic>z</italic>-positions, as well as the row and pitch needed to be identical between sessions to satisfy the passage of light through the two apertures). We used a custom built 2PLSM (Janelia Research Campus, model Non-MIMMS in vivo microscope) to acquire in vivo anatomical images of the anesthetized animals through the cranial window. We used the ScanImage software (Janelia Research Campus, Vidrio Technologies) (<xref ref-type="bibr" rid="bib27">Pologruto et al., 2003</xref>) to record the 2PLSM images, and additional custom software to align anatomical structures present on the central image stack by using a red-green overlay between current and past images.</p><p>For imaging we used a 20x water immersion objective (NA 0.95, XLUMPlanFI, Olympus, Japan). Images were acquired at a voxel volume of ≈ 0.13 × 0.26 × 0.8 μm<sup>3</sup> (<italic>x</italic> × <italic>y</italic> × z). We binned the data in the <italic>x</italic> dimension to generate isometric voxels in <italic>x</italic> and <italic>y</italic> for all analyses. The voxel dwell time was 0.8 μs for the full resolution images (and thus twice as high after 2x binning of the <italic>x</italic> dimension). Each ROI comprised an image stack of ≈ 270 × 270 × 250 μm<sup>3</sup>. As the imaging light source we used a Ti:sapphire femtosecond pulsed laser (Chameleon ultra II, Coherent) that was lasing at 1010 nm. Emitted fluorescence light was split into two channels using a dichroic mirror (Semrock, FF735-Di01−35.5 × 49.0) and two bandpass filters (red channel, Semrock FF01-607/70; green channel, Semrock FF01-530/70). Each channel was equipped with a PMT (red channel, Hamamatsu R3896; green channel, Hamamatsu H10770PA-40SEL). Images were analyzed only in the green channel.</p></sec><sec id="s4-2"><title>Correlative 3D EM</title><p>Electron microscopy was carried out on the region outlined in <xref ref-type="fig" rid="fig3">Figure 3A</xref> using a previously described method (<xref ref-type="bibr" rid="bib21">Maco et al., 2014</xref>; <xref ref-type="bibr" rid="bib20">Maco et al., 2013</xref>). An image of the blood vessel pattern below the cranial window was taken immediately after the last 2PLSM imaging session. The anesthetized animal was then chemically fixed by perfusing, via the heart, 10 ml of isotonic PBS immediately followed by 200 ml of 2.5% glutaraldehyde and 2% paraformaldehyde in phosphate buffer (0.1 M, pH 7.4). Two hours later, the brain was removed and 60-μm-vibratome sections cut from the imaged region, tangential to the cortical surface. The region containing the imaged axons was located in these sections by matching the pattern of blood vessels seen in the first 2–3 sections with the image of the brain’s surface taken prior to the perfusion. The 2-photon laser was then used to burn lines into the fixed section around the region of interest. The laser was tuned to <italic>λ</italic> = 850 nm with a power of ~300 mW at the back focal plane of the objective. A rectangle of ~25 μm x 25 μm was burnt around the ROI using the line scan mode (2 ms/line). This shape acts as a fiducial mark that can be seen after the tissue has been stained, and resin embedded, ready for election microscopy. This section was then washed in sodium cacodylate buffer (0.1 M, pH 7.4) 5 × 3 min, postfixed and stained in reduced osmium (1.5% potassium ferrocyanide with 1% osmium tetroxide in 0.1 M sodium cacodylate buffer) for 40 min, followed by another 40 min incubation with 1% osmium tetroxide in the same buffer, and finally for 40 min with 1% aqueous uranyl acetate. Next, the section was dehydrated in a series of increasing concentrations of alcohol, then infiltrated in 100% Durcupan resin, and flat embedded between two glass slides and placed in a 60°C oven for 24 hr.</p><p>A small piece of the section (2 mm x 2 mm), containing the laser marked region, was trimmed from the rest of the section and glued onto a slab of blank resin, keeping the region of interest closest to the surface. This block was then trimmed in the ultramicrotome, using glass knives, so that the laser marks were within 5 μm of its surface, and less than 2 μm from one edge. The block was then mounted on a 45° aluminum stub, using conductive carbon paint, so that this edge was uppermost. It was then sputter coated with a 30 nm thick layer of gold. The sample was then placed in the focused ion beam scanning electron microscope chamber (FIBSEM; Zeiss NVision 40, Zeiss SMT, Germany) and orientated so that the ion beam could mill parallel to the laser marks, and therefore parallel to the 2PLSM plane of focus. The sample was imaged with an electron beam of 1.7 kV and a probe current of 1.1 nA using the back-scattered electron detector (ESB). Images with a pixel size of 6 nm were collected with a dwell time of 12 μs per pixel. The ion beam removed 12 nm of resin after each image, using a current of 700 pA, with an energy of 30 kV.</p><p>The serial electron micrographs were aligned in FIJI (<ext-link ext-link-type="uri" xlink:href="http://fiji.sc">http://fiji.sc</ext-link>; <xref ref-type="bibr" rid="bib29">Schindelin et al., 2012</xref>) and the structures of interest segmented in the TrakEM2 part of the software (<xref ref-type="bibr" rid="bib2">Cardona et al., 2012</xref>). Models were then exported to the Blender software (Blender Foundation, Amsterdam; <ext-link ext-link-type="uri" xlink:href="http://www.blender.org">http://www.blender.org</ext-link>), and the NeuroMorph toolset (<ext-link ext-link-type="uri" xlink:href="http://neuromorph.epfl.ch">http://neuromorph.epfl.ch</ext-link>; <xref ref-type="bibr" rid="bib17">Jorstad et al., 2015</xref>) was used to measure axon cross-section areas, bouton and mitochondrial volumes, and PSD surface areas. The beginning and end of each bouton were defined, using the centerline processing tool, as the points along the axon where its normal cross-section area changed by more than 30% within a distance of 0.2 μm. The boutons were then delineated and their volumes calculated in the measurement tool (fourth row in <xref ref-type="fig" rid="fig4">Figure 4A–D</xref> and <xref ref-type="fig" rid="fig4">Figure 4E</xref>).</p></sec><sec id="s4-3"><title>Trace optimization</title><p><xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref> shows three maximum intensity projection views of an axon segment, which was traced independently by five users. Inter-user trace variability, which is usually more pronounced along the <italic>z</italic>-dimension (optical axis), can hinder bouton detection and measurement. Therefore, it is essential to optimize the layout of manual traces, ensuring that they accurately follow axon centerlines in the underlying image.</p><p>In this study, we used the optimization algorithm described in (<xref ref-type="bibr" rid="bib5">Chothani et al., 2011</xref>). In this version of the algorithm, positions of trace nodes <inline-formula><mml:math id="inf73"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> are updated to optimize a fitness function, which includes intensity integrated along the trace and a regularizing constraint on the positions of neighboring trace nodes:<disp-formula id="equ11"><label>(11)</label><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="script">ℱ</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>λ</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>m</mml:mi></mml:munder><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo symmetric="true">‖</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo symmetric="true">‖</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mi>λ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo symmetric="true">‖</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Here, vectors <inline-formula><mml:math id="inf74"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> denote the positions of voxel centers in the image stack, index <inline-formula><mml:math id="inf75"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula> enumerates the neighbors of node <inline-formula><mml:math id="inf76"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, parameter <italic>λ</italic> denotes the average density of nodes in the trace (number of nodes per voxel), and Lagrange multiplier <italic>α</italic> &gt; 0 controls the stiffness of the trace. The first term in this expression represents convolution of the image with the Laplacian of Gaussian filter of size <italic>R</italic>, and due to the fast decay of the Gaussian factor, summation in this term can be restricted to a small number of voxels in the vicinity of the trace. The following parameter values were used to produce the results of this study. <italic>R</italic> was set to three voxels (roughly equal to axon diameter in the images), <italic>λ</italic> was set to 0.5, and <italic>α</italic> equaled 0.001. The fitness function was maximized with Newton’s method as previously described (<xref ref-type="bibr" rid="bib7">Gala et al., 2014</xref>). Trace node positions were synchronously updated at every iteration step, and optimization terminated when the relative change in <inline-formula><mml:math id="inf77"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="script">ℱ</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> fell below 10<sup>−6</sup>.</p><p>Results of this optimization procedure (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>) show marked improvement over manual traces. The optimized traces are smoother, closer to one another in <italic>z</italic>, and follow the underlying axon intensity in the image more accurately. Following optimization, all traces were subdivided to a higher density of nodes, <italic>λ</italic> = 4.</p></sec><sec id="s4-4"><title>Generation of axon intensity profiles</title><p>Parameters of filters used to generate the axon intensity profiles, <xref ref-type="disp-formula" rid="equ1">Equation (1)</xref>, were chosen in the following way. The <italic>xy</italic> size of the multi-scale <italic>LoG<sub>xy</sub></italic> filter was chosen to span bouton sizes observed in 2PLSM images, <italic>R<sub>xy </sub></italic>∈ [1.5, 3.0] voxels (0.39 μm to 0.78 μm). Since the observed bouton size in the <italic>z</italic> dimension is dominated by the point spread function of the microscope, a single size was chosen for the <italic>z</italic> component of the filter, <italic>R<sub>z</sub></italic> = 2 voxels (1.6 μm). Upon convolution with the image, this multi-scale filter returns the maximum intensity calculated over the specified range of sizes. The Gaussian filter, <italic>G</italic>, was chosen to have a fixed size of <italic>R</italic> = 2 voxels in all three dimensions. This size was selected to be roughly equal to the typical axon shaft radius observed in the images (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>).</p><p><xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1C</xref> shows <italic>LoG<sub>xy</sub></italic> profiles for the five manual traces from <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>. Small differences in the layout of manual traces can lead to significant variability in intensity profiles, which is undesirable. Trace optimization reduces this variability to an extent undetectable by visual inspection, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1D</xref>.</p></sec><sec id="s4-5"><title>Detection of putative boutons</title><p>Peak detection algorithm, <xref ref-type="disp-formula" rid="equ2">Equation (2)</xref>, was initialized with a number of foreground peaks, <inline-formula><mml:math id="inf78"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>0.5</mml:mn><mml:mspace width="thickmathspace"/><mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, which is much larger than the expected number of putative boutons. In this expression, <inline-formula><mml:math id="inf79"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mspace width="thinmathspace"/></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> denotes the ceiling function and <inline-formula><mml:math id="inf80"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> is the trace length in micrometers. The number of background peaks, <inline-formula><mml:math id="inf81"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>25</mml:mn><mml:mspace width="thickmathspace"/><mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, was determined based on the observed spatial scale of background variability. The peaks were initially distributed uniformly along the entire length of the trace. Both, Gaussian and Lorentzian peak functions were tested, but only the former was used in this study as it provided a better fit to intensity profiles as judged by the value of the objective function.</p><p>The objective function was minimized with the gradient descent method. Gradient steps were taken simultaneously along the <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf83"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf84"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf85"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf86"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mi>f</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>, and <inline-formula><mml:math id="inf87"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> dimensions. At every gradient step, parameters that moved outside the bounds specified in <xref ref-type="disp-formula" rid="equ2">Equation (2)</xref> were set to these bounds. Upon convergence, that is, when the relative change in the value of the objective function became less than 10<sup>−6</sup>, one small foreground peak was eliminated or a pair of closely positioned foreground peaks was merged, and the resulting set of peaks was re-optimized. This procedure was continued until there were no peaks left that passed the following heuristic criteria: (1) a single foreground peak is marked for elimination if the peak amplitude is less than 0.3, and (2) a pair of overlapping foreground peaks is marked for merger if distance between the peaks is less than 1.0 μm or overlap area of the peaks exceeds 50% of either area. Here, the threshold of 0.3 was set to exclude small profile peaks that result from fluctuations of intensity along the axon. This threshold was chosen to be significantly lower than the mean profile intensity, which is one according to <xref ref-type="disp-formula" rid="equ6">Equation (6)</xref>. Distance threshold of 1.0 μm (size of a small bouton, see e.g. <xref ref-type="fig" rid="fig3">Figure 3</xref>) and threshold on inter-peak overlap were introduced to merge peaks corresponding to the same varicosity.</p></sec><sec id="s4-6"><title>Matching putative boutons across imaging sessions</title><p>Custom software was used to match putative boutons over time. Because most large boutons remains stable over weeks to months, they can serve as fiducial points to match the remaining boutons. Here, piecewise linear registration of normalized intensity profiles was performed based on few fiducial boutons marked by users across imaging sessions (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). This was followed by matching the remaining putative boutons with a greedy, distance-based algorithm. All results were then validated with visual inspection. For putative boutons detected in some, but not all imaging sessions the missing bouton weights were filled in with the normalized intensity profile values at the corresponding registered positions. This procedure was performed for axons traced by different users (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>), axons repeatedly imaged under different conditions (<xref ref-type="fig" rid="fig5">Figure 5</xref>), and axons monitored in the long-term imaging experiment (<xref ref-type="fig" rid="fig6">Figure 6</xref>).</p></sec><sec id="s4-7"><title>Quantifying precision of bouton detection methodology</title><p>Small inaccuracies in layout of axon traces can introduce errors in bouton detection. Therefore, it is essential to verify that trace optimization can guarantee sufficiently high precision in bouton detection. For this test, putative boutons were detected automatically, both with and without trace optimization, on the same set of 16 axon segment traced manually by five users. In the absence of trace optimization, a total of 578 candidate bouton sites were identified and matched across all five user traces (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>). A candidate bouton site here is defined as a position on an axon where a putative bouton was detected based on at least one user trace. For the majority of candidate bouton sites, 348 (60%), a putative bouton was present in all five user traces, and thus, there was a full consensus in bouton detection. However, 141 (24%) candidate bouton sites had one conflict and 89 (16%) had two. A conflict is defined as a dissent from the majority, and given five traces, the maximum number of conflicts is two. In contrast, after trace optimization, 474 candidate bouton sites were detected, of which 409 (86%) had full consensus, 39 (8%) had one conflict, and 26 (6%) had two (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>). With trace optimization, it was possible to obtain complete agreement in all putative boutons of weights greater than 2.5. This is a marked improvement over bouton detection with no trace optimization where 17 putative boutons of weights greater than 2.5 had one or more conflicts.</p><p>Tracing inaccuracies also affect the weights of detected putative boutons. <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2C</xref>, shows that inaccurate manual traces can contribute to bias (slope difference from 1) and variance (deviation from the best fit line) in bouton weight, and that trace optimization significantly reduces such errors. To quantify the uncertainty in bouton weight we calculated root mean square (RMS) weight difference for putative boutons detected with no conflicts (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>). As was expected, trace optimization dramatically reduces this uncertainty in the entire range of bouton weights.</p><p>We would like to point out that some amount of uncertainty in bouton detection (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>) and measurement (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>) remains even after trace optimization. However, as shown in <xref ref-type="fig" rid="fig5">Figure 5A–C</xref> this uncertainty of the method is much smaller than variability originating from the experimental sources, and therefore, it is not a limiting factor in structural plasticity measurements.</p></sec><sec id="s4-8"><title>Implementation</title><p>Axons of fluorescently labeled neurons were traced by using the manual tracing module of NCTracer software (<ext-link ext-link-type="uri" xlink:href="http://www.neurogeometry.org">http://www.neurogeometry.org</ext-link>). Custom software written in MATLAB, BoutonAnalyzer (<xref ref-type="bibr" rid="bib8">Gala et al., 2017</xref>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/BoutonAnalyzer)..">https://github.com/elifesciences-publications/BoutonAnalyzer</ext-link>), was used to optimize the traces, generate intensity profiles, detect putative boutons, and match these boutons across multiple user traces and imaging sessions. BoutonAnalyzer enables the user to visually inspect the results of bouton detection and matching and edit them if necessary. The NeuroMorph Centerline Processing and NeuroMorph Measurement tools were used to measure axon cross-section areas, bouton and mitochondrial volumes, and PSD surface areas (<xref ref-type="bibr" rid="bib18">Jorstad and Knott, 2017</xref>). A copy is archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications/NeuroMorph">https://github.com/elifesciences-publications/NeuroMorph</ext-link>.</p></sec><sec id="s4-9"><title>Data availability</title><p>Data used in the CLEM experiment are available in the Dryad Digital Repository (<ext-link ext-link-type="uri" xlink:href="https://dx.doi.org/10.5061/dryad.3q50t">https://dx.doi.org/10.5061/dryad.3q50t</ext-link>). This dataset includes a 2PLSM image stack in TIFF format (<xref ref-type="fig" rid="fig3">Figure 3A</xref>), optimized traces of four axon segments in SWC format (<xref ref-type="fig" rid="fig3">Figure 3A</xref>), and 3D EM reconstructions of these axons in Blender format (<xref ref-type="fig" rid="fig3">Figure 3C</xref>).</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We are grateful to Jerome Blanc, Raeann Dalton, Rammy Dang, and Chi Zhang for their help in tracing neurons and annotating boutons. This work was supported by the NIH grant R01 NS091421 and AFOSR grant FA9550-15-1-0398 to AS, Swiss National Science Foundation (SNF) grants 331003A_153448 and 51NF40_158776 (National Centre for Competence in Research, SYNAPSY), and the International Foundation for Research on Paraplegia (chair Alain Rossier) to AH, and SNF grant CRSII3-154453 to AH and GK.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Software, Formal analysis, Validation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Resources, Validation, Investigation, Methodology, Writing—review and editing</p></fn><fn fn-type="con" id="con3"><p>Resources, Validation, Investigation, Writing—review and editing</p></fn><fn fn-type="con" id="con4"><p>Resources, Software, Validation, Investigation, Writing—review and editing</p></fn><fn fn-type="con" id="con5"><p>Resources, Investigation, Software, Supervision, Funding acquisition, Validation, Methodology, Project administration, Writing—review and editing</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Resources, Supervision, Funding acquisition, Validation, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Formal analysis, Supervision, Funding acquisition, Validation, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: All experiments were performed according to the guidelines of the Swiss Federal Act on Animal Protection and Swiss Animal Protection Ordinance. The ethics committee of the University of Geneva and the Cantonal Veterinary Office of Geneva, Switzerland (approval code GE/61/17) approved all experiments.</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.29315.014</object-id><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-29315-transrepform-v2.docx"/></supplementary-material><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following dataset was generated:</p><p><related-object content-type="generated-dataset" id="dataset1" source-id="http://dx.doi.org/10.5061/dryad.3q50t" source-id-type="uri"><collab collab-type="author">Gala R</collab><collab collab-type="author">Lebrecht D</collab><collab collab-type="author">Sahlender DA</collab><collab collab-type="author">Jorstad A</collab><collab collab-type="author">Knott G</collab><collab collab-type="author">Holtmaat A</collab><collab collab-type="author">Stepanyants A</collab><year>2017</year><source>Data from: Computer assisted detection of axonal bouton structural plasticity in in vivo time-lapse images</source><ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5061/dryad.3q50t">http://dx.doi.org/10.5061/dryad.3q50t</ext-link><comment>Available at Dryad Digital Repository under a CC0 Public Domain Dedication</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Acciai</surname> <given-names>L</given-names></name><name><surname>Soda</surname> <given-names>P</given-names></name><name><surname>Iannello</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Automated neuron tracing methods: An updated account</article-title><source>Neuroinformatics</source><volume>14</volume><fpage>353</fpage><lpage>367</lpage><pub-id pub-id-type="doi">10.1007/s12021-016-9310-0</pub-id><pub-id pub-id-type="pmid">27447185</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cardona</surname> <given-names>A</given-names></name><name><surname>Saalfeld</surname> <given-names>S</given-names></name><name><surname>Schindelin</surname> <given-names>J</given-names></name><name><surname>Arganda-Carreras</surname> <given-names>I</given-names></name><name><surname>Preibisch</surname> <given-names>S</given-names></name><name><surname>Longair</surname> <given-names>M</given-names></name><name><surname>Tomancak</surname> <given-names>P</given-names></name><name><surname>Hartenstein</surname> <given-names>V</given-names></name><name><surname>Douglas</surname> <given-names>RJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>TrakEM2 software for neural circuit reconstruction</article-title><source>PLoS One</source><volume>7</volume><elocation-id>e38011</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0038011</pub-id><pub-id pub-id-type="pmid">22723842</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>SX</given-names></name><name><surname>Kim</surname> <given-names>AN</given-names></name><name><surname>Peters</surname> <given-names>AJ</given-names></name><name><surname>Komiyama</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Subtype-specific plasticity of inhibitory circuits in motor cortex during motor learning</article-title><source>Nature Neuroscience</source><volume>18</volume><fpage>1109</fpage><lpage>1115</lpage><pub-id pub-id-type="doi">10.1038/nn.4049</pub-id><pub-id pub-id-type="pmid">26098758</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chklovskii</surname> <given-names>DB</given-names></name><name><surname>Mel</surname> <given-names>BW</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Cortical rewiring and information storage</article-title><source>Nature</source><volume>431</volume><fpage>782</fpage><lpage>788</lpage><pub-id pub-id-type="doi">10.1038/nature03012</pub-id><pub-id pub-id-type="pmid">15483599</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chothani</surname> <given-names>P</given-names></name><name><surname>Mehta</surname> <given-names>V</given-names></name><name><surname>Stepanyants</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Automated tracing of neurites from light microscopy stacks of images</article-title><source>Neuroinformatics</source><volume>9</volume><fpage>263</fpage><lpage>278</lpage><pub-id pub-id-type="doi">10.1007/s12021-011-9121-2</pub-id><pub-id pub-id-type="pmid">21562803</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>De Paola</surname> <given-names>V</given-names></name><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name><name><surname>Song</surname> <given-names>S</given-names></name><name><surname>Wilbrecht</surname> <given-names>L</given-names></name><name><surname>Caroni</surname> <given-names>P</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Cell type-specific structural plasticity of axonal branches and boutons in the adult neocortex</article-title><source>Neuron</source><volume>49</volume><fpage>861</fpage><lpage>875</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2006.02.017</pub-id><pub-id pub-id-type="pmid">16543134</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gala</surname> <given-names>R</given-names></name><name><surname>Chapeton</surname> <given-names>J</given-names></name><name><surname>Jitesh</surname> <given-names>J</given-names></name><name><surname>Bhavsar</surname> <given-names>C</given-names></name><name><surname>Stepanyants</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Active learning of neuron morphology for accurate automated tracing of neurites</article-title><source>Frontiers in Neuroanatomy</source><volume>8</volume><elocation-id>37</elocation-id><pub-id pub-id-type="doi">10.3389/fnana.2014.00037</pub-id><pub-id pub-id-type="pmid">24904306</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Gala</surname> <given-names>R</given-names></name><name><surname>Lebrecht</surname> <given-names>D</given-names></name><name><surname>Sahlender</surname> <given-names>DA</given-names></name><name><surname>Jorstad</surname> <given-names>A</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Stepanyants</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>BoutonAnalyzer</data-title><source>GitHub</source><version designator="531a792">531a792</version><ext-link ext-link-type="uri" xlink:href="https://github.com/neurogeometry/BoutonAnalyzer">https://github.com/neurogeometry/BoutonAnalyzer</ext-link></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gray</surname> <given-names>EG</given-names></name></person-group><year iso-8601-date="1959">1959</year><article-title>Axo-somatic and axo-dendritic synapses of the cerebral cortex: an electron microscope study</article-title><source>Journal of Anatomy</source><volume>93</volume><fpage>420</fpage><lpage>433</lpage><pub-id pub-id-type="pmid">13829103</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grillo</surname> <given-names>FW</given-names></name><name><surname>Song</surname> <given-names>S</given-names></name><name><surname>Teles-Grilo Ruivo</surname> <given-names>LM</given-names></name><name><surname>Huang</surname> <given-names>L</given-names></name><name><surname>Gao</surname> <given-names>G</given-names></name><name><surname>Knott</surname> <given-names>GW</given-names></name><name><surname>Maco</surname> <given-names>B</given-names></name><name><surname>Ferretti</surname> <given-names>V</given-names></name><name><surname>Thompson</surname> <given-names>D</given-names></name><name><surname>Little</surname> <given-names>GE</given-names></name><name><surname>De Paola</surname></name></person-group><year iso-8601-date="2013">2013</year><article-title>Increased axonal bouton dynamics in the aging mouse cortex</article-title><source>PNAS</source><volume>110</volume><fpage>E1514</fpage><lpage>E1523</lpage><pub-id pub-id-type="doi">10.1073/pnas.1218731110</pub-id><pub-id pub-id-type="pmid">23542382</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname> <given-names>KM</given-names></name><name><surname>Weinberg</surname> <given-names>RJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Ultrastructure of synapses in the mammalian brain</article-title><source>Cold Spring Harbor Perspectives in Biology</source><volume>4</volume><elocation-id>a005587</elocation-id><pub-id pub-id-type="doi">10.1101/cshperspect.a005587</pub-id><pub-id pub-id-type="pmid">22357909</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hastie</surname> <given-names>T</given-names></name></person-group><person-group person-group-type="author"><name><surname>Tibshirani</surname> <given-names>R</given-names></name></person-group><person-group person-group-type="author"><name><surname>Friedman</surname> <given-names>JH</given-names></name></person-group><year iso-8601-date="2009">2009</year><source>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</source><edition>2nd ed</edition><publisher-loc>New York</publisher-loc><publisher-name>Springer</publisher-name></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Bonhoeffer</surname> <given-names>T</given-names></name><name><surname>Chow</surname> <given-names>DK</given-names></name><name><surname>Chuckowree</surname> <given-names>J</given-names></name><name><surname>De Paola</surname></name><name><surname>Hofer</surname> <given-names>SB</given-names></name><name><surname>Hübener</surname> <given-names>M</given-names></name><name><surname>Keck</surname> <given-names>T</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name><name><surname>Lee</surname> <given-names>WC</given-names></name><name><surname>Mostany</surname> <given-names>R</given-names></name><name><surname>Mrsic-Flogel</surname> <given-names>TD</given-names></name><name><surname>Nedivi</surname> <given-names>E</given-names></name><name><surname>Portera-Cailliau</surname> <given-names>C</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Trachtenberg</surname> <given-names>JT</given-names></name><name><surname>Wilbrecht</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Long-term, high-resolution imaging in the mouse neocortex through a chronic cranial window</article-title><source>Nature Protocols</source><volume>4</volume><fpage>1128</fpage><lpage>1144</lpage><pub-id pub-id-type="doi">10.1038/nprot.2009.89</pub-id><pub-id pub-id-type="pmid">19617885</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Experience-dependent structural synaptic plasticity in the mammalian brain</article-title><source>Nature Reviews Neuroscience</source><volume>10</volume><fpage>647</fpage><lpage>658</lpage><pub-id pub-id-type="doi">10.1038/nrn2699</pub-id><pub-id pub-id-type="pmid">19693029</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Caroni</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Functional and structural underpinnings of neuronal assembly formation in learning</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>1553</fpage><lpage>1562</lpage><pub-id pub-id-type="doi">10.1038/nn.4418</pub-id><pub-id pub-id-type="pmid">27749830</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Johnson</surname> <given-names>CM</given-names></name><name><surname>Peckler</surname> <given-names>H</given-names></name><name><surname>Tai</surname> <given-names>LH</given-names></name><name><surname>Wilbrecht</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Rule learning enhances structural plasticity of long-range axons in frontal cortex</article-title><source>Nature Communications</source><volume>7</volume><elocation-id>10785</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms10785</pub-id><pub-id pub-id-type="pmid">26949122</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jorstad</surname> <given-names>A</given-names></name><name><surname>Nigro</surname> <given-names>B</given-names></name><name><surname>Cali</surname> <given-names>C</given-names></name><name><surname>Wawrzyniak</surname> <given-names>M</given-names></name><name><surname>Fua</surname> <given-names>P</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>NeuroMorph: a toolset for the morphometric analysis and visualization of 3D models derived from electron microscopy image stacks</article-title><source>Neuroinformatics</source><volume>13</volume><fpage>83</fpage><lpage>92</lpage><pub-id pub-id-type="doi">10.1007/s12021-014-9242-5</pub-id><pub-id pub-id-type="pmid">25240318</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Jorstad</surname> <given-names>A</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>NeuroMorph/NeuroMorph_CenterLines_CrossSections</data-title><source>GitHub</source><version designator="1b3da6e">1b3da6e</version><ext-link ext-link-type="uri" xlink:href="https://github.com/NeuroMorph-EPFL/NeuroMorph/tree/master/NeuroMorph_CenterLines_CrossSections">https://github.com/NeuroMorph-EPFL/NeuroMorph/tree/master/NeuroMorph_CenterLines_CrossSections</ext-link></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keck</surname> <given-names>T</given-names></name><name><surname>Scheuss</surname> <given-names>V</given-names></name><name><surname>Jacobsen</surname> <given-names>RI</given-names></name><name><surname>Wierenga</surname> <given-names>CJ</given-names></name><name><surname>Eysel</surname> <given-names>UT</given-names></name><name><surname>Bonhoeffer</surname> <given-names>T</given-names></name><name><surname>Hübener</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Loss of sensory input causes rapid structural changes of inhibitory neurons in adult mouse visual cortex</article-title><source>Neuron</source><volume>71</volume><fpage>869</fpage><lpage>882</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2011.06.034</pub-id><pub-id pub-id-type="pmid">21903080</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maco</surname> <given-names>B</given-names></name><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Cantoni</surname> <given-names>M</given-names></name><name><surname>Kreshuk</surname> <given-names>A</given-names></name><name><surname>Straehle</surname> <given-names>CN</given-names></name><name><surname>Hamprecht</surname> <given-names>FA</given-names></name><name><surname>Knott</surname> <given-names>GW</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Correlative in vivo 2 photon and focused ion beam scanning electron microscopy of cortical neurons</article-title><source>PLoS One</source><volume>8</volume><elocation-id>e57405</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0057405</pub-id><pub-id pub-id-type="pmid">23468982</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maco</surname> <given-names>B</given-names></name><name><surname>Cantoni</surname> <given-names>M</given-names></name><name><surname>Holtmaat</surname> <given-names>A</given-names></name><name><surname>Kreshuk</surname> <given-names>A</given-names></name><name><surname>Hamprecht</surname> <given-names>FA</given-names></name><name><surname>Knott</surname> <given-names>GW</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Semiautomated correlative 3D electron microscopy of in vivo-imaged axons and dendrites</article-title><source>Nature Protocols</source><volume>9</volume><fpage>1354</fpage><lpage>1366</lpage><pub-id pub-id-type="doi">10.1038/nprot.2014.101</pub-id><pub-id pub-id-type="pmid">24833174</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Majewska</surname> <given-names>AK</given-names></name><name><surname>Newton</surname> <given-names>JR</given-names></name><name><surname>Sur</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Remodeling of synaptic structure in sensory cortical areas in vivo</article-title><source>Journal of Neuroscience</source><volume>26</volume><fpage>3021</fpage><lpage>3029</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.4454-05.2006</pub-id><pub-id pub-id-type="pmid">16540580</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Markram</surname> <given-names>H</given-names></name><name><surname>Muller</surname> <given-names>E</given-names></name><name><surname>Ramaswamy</surname> <given-names>S</given-names></name><name><surname>Reimann</surname> <given-names>MW</given-names></name><name><surname>Abdellah</surname> <given-names>M</given-names></name><name><surname>Sanchez</surname> <given-names>CA</given-names></name><name><surname>Ailamaki</surname> <given-names>A</given-names></name><name><surname>Alonso-Nanclares</surname> <given-names>L</given-names></name><name><surname>Antille</surname> <given-names>N</given-names></name><name><surname>Arsever</surname> <given-names>S</given-names></name><name><surname>Kahou</surname> <given-names>GA</given-names></name><name><surname>Berger</surname> <given-names>TK</given-names></name><name><surname>Bilgili</surname> <given-names>A</given-names></name><name><surname>Buncic</surname> <given-names>N</given-names></name><name><surname>Chalimourda</surname> <given-names>A</given-names></name><name><surname>Chindemi</surname> <given-names>G</given-names></name><name><surname>Courcol</surname> <given-names>JD</given-names></name><name><surname>Delalondre</surname> <given-names>F</given-names></name><name><surname>Delattre</surname> <given-names>V</given-names></name><name><surname>Druckmann</surname> <given-names>S</given-names></name><name><surname>Dumusc</surname> <given-names>R</given-names></name><name><surname>Dynes</surname> <given-names>J</given-names></name><name><surname>Eilemann</surname> <given-names>S</given-names></name><name><surname>Gal</surname> <given-names>E</given-names></name><name><surname>Gevaert</surname> <given-names>ME</given-names></name><name><surname>Ghobril</surname> <given-names>JP</given-names></name><name><surname>Gidon</surname> <given-names>A</given-names></name><name><surname>Graham</surname> <given-names>JW</given-names></name><name><surname>Gupta</surname> <given-names>A</given-names></name><name><surname>Haenel</surname> <given-names>V</given-names></name><name><surname>Hay</surname> <given-names>E</given-names></name><name><surname>Heinis</surname> <given-names>T</given-names></name><name><surname>Hernando</surname> <given-names>JB</given-names></name><name><surname>Hines</surname> <given-names>M</given-names></name><name><surname>Kanari</surname> <given-names>L</given-names></name><name><surname>Keller</surname> <given-names>D</given-names></name><name><surname>Kenyon</surname> <given-names>J</given-names></name><name><surname>Khazen</surname> <given-names>G</given-names></name><name><surname>Kim</surname> <given-names>Y</given-names></name><name><surname>King</surname> <given-names>JG</given-names></name><name><surname>Kisvarday</surname> <given-names>Z</given-names></name><name><surname>Kumbhar</surname> <given-names>P</given-names></name><name><surname>Lasserre</surname> <given-names>S</given-names></name><name><surname>Le Bé</surname> <given-names>JV</given-names></name><name><surname>Magalhães</surname> <given-names>BR</given-names></name><name><surname>Merchán-Pérez</surname> <given-names>A</given-names></name><name><surname>Meystre</surname> <given-names>J</given-names></name><name><surname>Morrice</surname> <given-names>BR</given-names></name><name><surname>Muller</surname> <given-names>J</given-names></name><name><surname>Muñoz-Céspedes</surname> <given-names>A</given-names></name><name><surname>Muralidhar</surname> <given-names>S</given-names></name><name><surname>Muthurasa</surname> <given-names>K</given-names></name><name><surname>Nachbaur</surname> <given-names>D</given-names></name><name><surname>Newton</surname> <given-names>TH</given-names></name><name><surname>Nolte</surname> <given-names>M</given-names></name><name><surname>Ovcharenko</surname> <given-names>A</given-names></name><name><surname>Palacios</surname> <given-names>J</given-names></name><name><surname>Pastor</surname> <given-names>L</given-names></name><name><surname>Perin</surname> <given-names>R</given-names></name><name><surname>Ranjan</surname> <given-names>R</given-names></name><name><surname>Riachi</surname> <given-names>I</given-names></name><name><surname>Rodríguez</surname> <given-names>JR</given-names></name><name><surname>Riquelme</surname> <given-names>JL</given-names></name><name><surname>Rössert</surname> <given-names>C</given-names></name><name><surname>Sfyrakis</surname> <given-names>K</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name><name><surname>Shillcock</surname> <given-names>JC</given-names></name><name><surname>Silberberg</surname> <given-names>G</given-names></name><name><surname>Silva</surname> <given-names>R</given-names></name><name><surname>Tauheed</surname> <given-names>F</given-names></name><name><surname>Telefont</surname> <given-names>M</given-names></name><name><surname>Toledo-Rodriguez</surname> <given-names>M</given-names></name><name><surname>Tränkler</surname> <given-names>T</given-names></name><name><surname>Van Geit</surname> <given-names>W</given-names></name><name><surname>Díaz</surname> <given-names>JV</given-names></name><name><surname>Walker</surname> <given-names>R</given-names></name><name><surname>Wang</surname> <given-names>Y</given-names></name><name><surname>Zaninetta</surname> <given-names>SM</given-names></name><name><surname>DeFelipe</surname> <given-names>J</given-names></name><name><surname>Hill</surname> <given-names>SL</given-names></name><name><surname>Segev</surname> <given-names>I</given-names></name><name><surname>Schürmann</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Reconstruction and Simulation of Neocortical Microcircuitry</article-title><source>Cell</source><volume>163</volume><fpage>456</fpage><lpage>492</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.09.029</pub-id><pub-id pub-id-type="pmid">26451489</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meyer</surname> <given-names>HS</given-names></name><name><surname>Wimmer</surname> <given-names>VC</given-names></name><name><surname>Hemberger</surname> <given-names>M</given-names></name><name><surname>Bruno</surname> <given-names>RM</given-names></name><name><surname>de Kock</surname> <given-names>CP</given-names></name><name><surname>Frick</surname> <given-names>A</given-names></name><name><surname>Sakmann</surname> <given-names>B</given-names></name><name><surname>Helmstaedter</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Cell type-specific thalamic innervation in a column of rat vibrissal cortex</article-title><source>Cerebral Cortex</source><volume>20</volume><fpage>2287</fpage><lpage>2303</lpage><pub-id pub-id-type="doi">10.1093/cercor/bhq069</pub-id><pub-id pub-id-type="pmid">20534783</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mostany</surname> <given-names>R</given-names></name><name><surname>Anstey</surname> <given-names>JE</given-names></name><name><surname>Crump</surname> <given-names>KL</given-names></name><name><surname>Maco</surname> <given-names>B</given-names></name><name><surname>Knott</surname> <given-names>G</given-names></name><name><surname>Portera-Cailliau</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Altered synaptic dynamics during normal brain aging</article-title><source>Journal of Neuroscience</source><volume>33</volume><fpage>4094</fpage><lpage>4104</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.4825-12.2013</pub-id><pub-id pub-id-type="pmid">23447617</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parekh</surname> <given-names>R</given-names></name><name><surname>Ascoli</surname> <given-names>GA</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Neuronal morphology goes digital: a research hub for cellular and system neuroscience</article-title><source>Neuron</source><volume>77</volume><fpage>1017</fpage><lpage>1038</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.03.008</pub-id><pub-id pub-id-type="pmid">23522039</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pologruto</surname> <given-names>TA</given-names></name><name><surname>Sabatini</surname> <given-names>BL</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>ScanImage: flexible software for operating laser scanning microscopes</article-title><source>BioMedical Engineering OnLine</source><volume>2</volume><elocation-id>13</elocation-id><pub-id pub-id-type="doi">10.1186/1475-925X-2-13</pub-id><pub-id pub-id-type="pmid">12801419</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qiao</surname> <given-names>Q</given-names></name><name><surname>Ma</surname> <given-names>L</given-names></name><name><surname>Li</surname> <given-names>W</given-names></name><name><surname>Tsai</surname> <given-names>JW</given-names></name><name><surname>Yang</surname> <given-names>G</given-names></name><name><surname>Gan</surname> <given-names>WB</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Long-term stability of axonal boutons in the mouse barrel cortex</article-title><source>Developmental Neurobiology</source><volume>76</volume><fpage>252</fpage><lpage>261</lpage><pub-id pub-id-type="doi">10.1002/dneu.22311</pub-id><pub-id pub-id-type="pmid">26058471</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schindelin</surname> <given-names>J</given-names></name><name><surname>Arganda-Carreras</surname> <given-names>I</given-names></name><name><surname>Frise</surname> <given-names>E</given-names></name><name><surname>Kaynig</surname> <given-names>V</given-names></name><name><surname>Longair</surname> <given-names>M</given-names></name><name><surname>Pietzsch</surname> <given-names>T</given-names></name><name><surname>Preibisch</surname> <given-names>S</given-names></name><name><surname>Rueden</surname> <given-names>C</given-names></name><name><surname>Saalfeld</surname> <given-names>S</given-names></name><name><surname>Schmid</surname> <given-names>B</given-names></name><name><surname>Tinevez</surname> <given-names>JY</given-names></name><name><surname>White</surname> <given-names>DJ</given-names></name><name><surname>Hartenstein</surname> <given-names>V</given-names></name><name><surname>Eliceiri</surname> <given-names>K</given-names></name><name><surname>Tomancak</surname> <given-names>P</given-names></name><name><surname>Cardona</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Fiji: an open-source platform for biological-image analysis</article-title><source>Nature Methods</source><volume>9</volume><fpage>676</fpage><lpage>682</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id><pub-id pub-id-type="pmid">22743772</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shepherd</surname> <given-names>GM</given-names></name><name><surname>Harris</surname> <given-names>KM</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Three-dimensional structure and composition of CA3--&gt;CA1 axons in rat hippocampal slices: implications for presynaptic connectivity and compartmentalization</article-title><source>Journal of Neuroscience</source><volume>18</volume><fpage>8300</fpage><lpage>8310</lpage><pub-id pub-id-type="pmid">9763474</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname> <given-names>S</given-names></name><name><surname>Grillo</surname> <given-names>FW</given-names></name><name><surname>Xi</surname> <given-names>J</given-names></name><name><surname>Ferretti</surname> <given-names>V</given-names></name><name><surname>Gao</surname> <given-names>G</given-names></name><name><surname>De Paola</surname></name></person-group><year iso-8601-date="2016">2016</year><article-title>EPBscore: a Novel Method for Computer-Assisted Analysis of Axonal Structure and Dynamics</article-title><source>Neuroinformatics</source><volume>14</volume><fpage>121</fpage><lpage>127</lpage><pub-id pub-id-type="doi">10.1007/s12021-015-9274-5</pub-id><pub-id pub-id-type="pmid">26163988</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stepanyants</surname> <given-names>A</given-names></name><name><surname>Hof</surname> <given-names>PR</given-names></name><name><surname>Chklovskii</surname> <given-names>DB</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Geometry and structural plasticity of synaptic connectivity</article-title><source>Neuron</source><volume>34</volume><fpage>275</fpage><lpage>288</lpage><pub-id pub-id-type="doi">10.1016/S0896-6273(02)00652-9</pub-id><pub-id pub-id-type="pmid">11970869</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stepanyants</surname> <given-names>A</given-names></name><name><surname>Chklovskii</surname> <given-names>DB</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Neurogeometry and potential synaptic connectivity</article-title><source>Trends in Neurosciences</source><volume>28</volume><fpage>387</fpage><lpage>394</lpage><pub-id pub-id-type="doi">10.1016/j.tins.2005.05.006</pub-id><pub-id pub-id-type="pmid">15935485</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stettler</surname> <given-names>DD</given-names></name><name><surname>Yamahachi</surname> <given-names>H</given-names></name><name><surname>Li</surname> <given-names>W</given-names></name><name><surname>Denk</surname> <given-names>W</given-names></name><name><surname>Gilbert</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Axons and synaptic boutons are highly dynamic in adult visual cortex</article-title><source>Neuron</source><volume>49</volume><fpage>877</fpage><lpage>887</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2006.02.018</pub-id><pub-id pub-id-type="pmid">16543135</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trachtenberg</surname> <given-names>JT</given-names></name><name><surname>Chen</surname> <given-names>BE</given-names></name><name><surname>Knott</surname> <given-names>GW</given-names></name><name><surname>Feng</surname> <given-names>G</given-names></name><name><surname>Sanes</surname> <given-names>JR</given-names></name><name><surname>Welker</surname> <given-names>E</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Long-term in vivo imaging of experience-dependent synaptic plasticity in adult cortex</article-title><source>Nature</source><volume>420</volume><fpage>788</fpage><lpage>794</lpage><pub-id pub-id-type="doi">10.1038/nature01273</pub-id><pub-id pub-id-type="pmid">12490942</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gehuchten</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="1904">1904</year><article-title>Boutons terminaux et reseau pericellulaire</article-title><source>Nevraxe</source><volume>8</volume><fpage>81</fpage><lpage>116</lpage></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname> <given-names>Y</given-names></name><name><surname>Liu</surname> <given-names>DQ</given-names></name><name><surname>Huang</surname> <given-names>W</given-names></name><name><surname>Deng</surname> <given-names>J</given-names></name><name><surname>Sun</surname> <given-names>Y</given-names></name><name><surname>Zuo</surname> <given-names>Y</given-names></name><name><surname>Poo</surname> <given-names>MM</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Selective synaptic remodeling of amygdalocortical connections associated with fear memory</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>1348</fpage><lpage>1355</lpage><pub-id pub-id-type="doi">10.1038/nn.4370</pub-id><pub-id pub-id-type="pmid">27595384</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.29315.017</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Marder</surname><given-names>Eve</given-names></name><role>Reviewing Editor</role><aff><institution>Brandeis University</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Computer assisted detection of axonal bouton structural plasticity in in vivo time-lapse images&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by three peer reviewers, and the evaluation has been overseen by Eve Marder as the Senior Editor and Reviewing Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Sen Song (Reviewer #1); Albert Cardona (Reviewer #2). A further reviewer remains anonymous.</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>The authors proposed new algorithms to analyze in vivo two-photon time-lapse images for axonal bouton structural plasticity and validated the method against EM reconstructions of the same tissue. The manuscript reports on a new method for quantifying synaptic boutons in light-microscopy images of fluorescently labeled axons, and validates the method and parameter choices by using correlative light-electron microscopy, providing the nanometer-scale reconstruction of axons and synaptic surfaces of the micrometer-scale light-microscopy images. The method models sources of variability, both controllable and non-controllable, while also acknowledging and including the inherent ambiguity of synaptic boutons in predicting the presence of a synaptic surface (not all boutons house synapses or, as the author's put it, postsynaptic densities). The normalization approach is appropriate and accurate, and its structure reveals the careful, neuroanatomy-based reasoning that led to its design. The method applies to both small varicosities and varying imaging conditions, including low-intensity and low-contrast conditions, and reports a precision and recall good enough that, together with the modeling of variability and the ability to track varicosities over time on the same axons, essentially sets the stage for fully-automated estimation of synaptic weights from light-microscopy images of brain tissue for chronic studies.</p><p>Essential revisions:</p><p>1) One of the issues that arose during the review is that some of your previously published methods are inaccessible without paying exorbitant fees to other publishers. Consequently, please include all of the methods you used in detail here, so that this paper stands alone and exists in the OPEN ACCESS world with all of its methods. <italic>eLife</italic> does not restrict the space that can be used for methods, so it will be a service to the community to have the methods here. Among specific issues raised by the reviewers:</p><p>a) There is an insufficiently detailed EM fixation and counterstaining protocol: no concentrations given for aldehydes, osmium, uranyl acetate, and no specifications on the individual steps.</p><p>b) More detail on the trace optimization method.</p><p>c) No open source code repository is reported, which would be critical to distributing the software to facilitate the application of this novel method and provide commit hashes for reference when reporting the use of the method, towards ensuring reproducibility of results. Attaching the source code to the paper is an old practice from when public source code repositories were rare or hard to setup, and while the practice ensures archiving of the source code, it is not conducive to further corrections, extensions or modifications. Which source version control repository hosts the code, and what hash / commit number corresponds to the attached code zip file? This is critical for <italic>eLife</italic> publication!</p><p>2) Please address the issue of whether the laplacian of gaussian filter for detection of boutons introduces biases in estimating bouton intensities. <xref ref-type="fig" rid="fig4">Figure 4</xref> addresses some of those issues, but the profile intensities there are after several further steps of processing. This issue need to be explored in a bit more depth by perhaps comparing with some other methods. Address how the parameters were chosen for the LOG filter.</p><p>3) One reviewer says, &quot;The detection of putative boutons based on the Backward-Stepwise Subset Selection method is also novel. I think the fitting of foreground peaks using a variable size gaussian filter is a very good idea. But I am less convinced of fitting the background peaks also with Gaussian functions. There is no a priori reason why the background is also peaky. Have the authors explored other functions for fitting the background. What is the physical intuition of the background peaks?&quot;</p><p>4) For the shaft intensity, why did you choose the positions where the boutons were present for measurement? It seems more intuitive to measure from areas which are devoid of boutons. The current method seems more like an average bouton intensity. Normalizing the image by this kind of quantity suffers from one drawback, which is if a large fraction of boutons are gained or lost, this might lead to a bias.</p><p>5) Fitting the bouton gain and loss functions using a probabilistic function is a very good idea. But it is not very clear how this could benefit final biological measurements and interpretation. Is it useful for taking/getting more meaningful interpretation for different amounts of measurement noises? Some discussion of this would be useful.</p><p>6) The correlation with EM looks quite good, but is it better than previous methods? Some comparison would be useful.</p><p>Optional: One reviewer felt that one potential way to increase the impact is to demonstrate its robustness for data previously published by other labs. Other reviewers did not feel this was necessary, but we wanted you to think about this.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.29315.018</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) One of the issues that arose during the review is that some of your previously published methods are inaccessible without paying exorbitant fees to other publishers. Consequently, please include all of the methods you used in detail here, so that this paper stands alone and exists in the OPEN ACCESS world with all of its methods. eLife does not restrict the space that can be used for methods, so it will be a service to the community to have the methods here. Among specific issues raised by the reviewers:</p><p>a) There is an insufficiently detailed EM fixation and counterstaining protocol: no concentrations given for aldehydes, osmium, uranyl acetate, and no specifications on the individual steps.</p><p>b) More detail on the trace optimization method.</p><p>c) No open source code repository is reported, which would be critical to distributing the software to facilitate the application of this novel method and provide commit hashes for reference when reporting the use of the method, towards ensuring reproducibility of results. Attaching the source code to the paper is an old practice from when public source code repositories were rare or hard to setup, and while the practice ensures archiving of the source code, it is not conducive to further corrections, extensions or modifications. Which source version control repository hosts the code, and what hash / commit number corresponds to the attached code zip file? This is critical for eLife publication!</p></disp-quote><p>We have expanded the Materials and methods section to include additional details related to EM methods and trace optimization. The source code of BoutonAnalyzer is now hosted on GitHub, and the version tagged v1.0 (commit number 531a792) is used in conjunction with the manuscript.</p><disp-quote content-type="editor-comment"><p>2) Please address the issue of whether the laplacian of gaussian filter for detection of boutons introduces biases in estimating bouton intensities. <xref ref-type="fig" rid="fig4">Figure 4</xref> addresses some of those issues, but the profile intensities there are after several further steps of processing. This issue need to be explored in a bit more depth by perhaps comparing with some other methods. Address how the parameters were chosen for the LOG filter.</p></disp-quote><p>Axon intensity profiles are produced in two steps, (1) sliding the LoG<sub>xy</sub> filter along the trace and (2) normalizing the result with the shaft intensity. In this heuristic procedure, normalization was included to remove bias due to axon specific calibers and fluorophore expression levels. CLEM analysis shows that bouton weights resulting from this procedure are well correlated with bouton volumes, and therefore, we have no reason to think that the LoG<sub>xy</sub> filter biases the results. It is difficult to be more conclusive here, because the size of the CLEM dataset is relatively small.</p><p>Nevertheless, we explored this issue in some detail and now provide comparisons with other plausible bouton detection strategies in our manuscript. We added <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref> showing intensity profiles obtained without filtering (raw voxel intensities along the trace), and produced with mean, Gaussian, and median filters of different but fixed sizes. This figure shows that in the absence of filtering, profiles appear jagged, which hinders bouton detection. At the other extreme, large filters suppress small boutons and merge closely positioned boutons. By tuning sizes of the considered filters we were able to obtain profiles that appear similar to those of multi-scale LoG<sub>xy</sub>, although with higher baselines. Still, we prefer LoG<sub>xy</sub> because its negative surround produces near-zero baselines, which simplifies bouton detection. In addition, the multi-scale feature of this filter eliminates the need for size tuning.</p><p>We also examined the combined effect of filtering and normalization on bouton measurement by comparing the amplitudes of profile peaks to corresponding bouton volumes. <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1E</xref> shows that the overall procedure described in the manuscript leads to the highest correlation as compared to the best of the considered alternatives.</p><p>We would like to emphasize that we did not attempt to find the best procedure to fit the CLEM dataset. Some other combination of filter type, normalization, and parameters may perform marginally better, but this would likely be a case of over-fitting the data. Instead, our procedure was designed based on theoretical considerations, and the parameters were chosen based on observed bouton sizes. These points are now mentioned in the last paragraph of the Results subsection “Validation of LM-based bouton detection methodology with EM”.</p><disp-quote content-type="editor-comment"><p>3) One reviewer says, &quot;The detection of putative boutons based on the Backward-Stepwise Subset Selection method is also novel. I think the fitting of foreground peaks using a variable size gaussian filter is a very good idea. But I am less convinced of fitting the background peaks also with Gaussian functions. There is no a priori reason why the background is also peaky. Have the authors explored other functions for fitting the background. What is the physical intuition of the background peaks?&quot;</p></disp-quote><p>Axon background intensity defined in the manuscript is the intensity an axon intensity profile would have in the absence of boutons. If bouton density were sufficiently low, background intensity could be deduced from inter-bouton portions on the axon. However, for high bouton densities, which is often the case for cortical axons, background intensity has to be disentangled from bouton contributions. We did this with a two-step fitting procedure described in the manuscript. To fit the background, we used multiple, relatively wide Gaussian peaks (σ<sub>k</sub><sup>b</sup> ≥ 20 μm, <xref ref-type="disp-formula" rid="equ2">Equation 2</xref>). This was done to account for the possibility of variations in background intensity over relatively large distances along the axon (&gt;&gt; 1 μm or bouton size). Such variations in intensity may result from changes in axon caliber or changes in density of fluorescent molecules. Gaussian peaks were used for convenience, but any other slowly varying function would work as well. We would like to emphasize that the resulting background, which is a sum of multiple overlapping Gaussians, varies very smoothly and excludes intensity of putative boutons as shown in <xref ref-type="fig" rid="fig2">Figure 2C</xref> (red line). We now emphasize these points in the subsection “LM-based bouton detection and measurement of structural changes”.</p><disp-quote content-type="editor-comment"><p>4) For the shaft intensity, why did you choose the positions where the boutons were present for measurement? It seems more intuitive to measure from areas which are devoid of boutons. The current method seems more like an average bouton intensity. Normalizing the image by this kind of quantity suffers from one drawback, which is if a large fraction of boutons are gained or lost, this might lead to a bias.</p></disp-quote><p>Our method was designed to produce robust results, regardless of bouton density. In particular, when density of boutons is high, e.g. <xref ref-type="fig" rid="fig2">Figure 2</xref>, identifying areas devoid of boutons can be next to impossible. Therefore, we infer shaft intensity by using a fitting procedure which disentangles it from bouton contributions. Specifically, axon intensity profiles are fitted simultaneously with foreground and background peak functions, and only the background peak functions are used to determine the shaft intensity (red line in <xref ref-type="fig" rid="fig2">Figure 2C</xref>). The resulting shaft intensity is independent of bouton density, and, thus, it is expected to be insensitive to changes in density arising from bouton addition or elimination. We now clarify this point in the subsection “LM-based bouton detection and measurement of structural changes”.</p><disp-quote content-type="editor-comment"><p>5) Fitting the bouton gain and loss functions using a probabilistic function is a very good idea. But it is not very clear how this could benefit final biological measurements and interpretation. Is it useful for taking/getting more meaningful interpretation for different amounts of measurement noises? Some discussion of this would be useful.</p></disp-quote><p>When the measured bouton weight is well above/below w<sub>threshold</sub>, it may be said with confidence that an LM bouton is present/absent. In such cases, deterministic definition of a bouton is sufficient, and it is in agreement with <xref ref-type="disp-formula" rid="equ10">Equation 10</xref>. In practice, because the distribution of bouton weights is unimodal (see <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>), a large fraction of weights will lie within the range of uncertainty of w<sub>threshold</sub>, regardless of its value. Such ambiguous boutons could be discarded, which may bias biological interpretation. Alternatively, they could be treated probabilistically as described in the manuscript, which is our preferred method. We think that this method may offer distinct benefits for biological interpretation. One could consider the following specific examples of biological measurements where a probabilistic approach is essential. (1) Estimate of expected number of LM boutons. Here, since bouton weight distribution is non-uniform (monotonically decreasing), one cannot simply count the number of weights above w<sub>threshold</sub> to estimate the expected number of LM boutons, even for a large sample size. This count would result in an underestimate, as many more measured sub-threshold weights may have a true weight &gt; w<sub>threshold</sub> than the other way around. Thus, it is essential to add LM bouton probabilities defined by <xref ref-type="disp-formula" rid="equ10">Equation 10</xref>. (2) The same argument holds for calculations of the expected numbers of added, eliminated, potentiated, and depressed boutons. (3) Most bouton structures are stable and do not change substantially over days-to-weeks. Therefore, changes in weight often lie within the range of measurement uncertainty and can only be described probabilistically according to <xref ref-type="disp-formula" rid="equ11">Equation 11</xref>. More importantly, probabilistic description is required for calculation of error-bars and establishing significance of experimental measurements. This is absolutely essential for correct biological interpretation of results. These points are now mentioned in the last paragraph of the Discussion.</p><disp-quote content-type="editor-comment"><p>6) The correlation with EM looks quite good, but is it better than previous methods? Some comparison would be useful.</p></disp-quote><p>We are aware of only one publicly available software tool for bouton detection and measurement, EPBscore (Song et al., 2016), which we cite in our manuscript. This software generates an axon intensity profile based on a combination of fixed-size Gaussian and median filters, and subsequently normalizes it by its median. It is designed to work well on isolated axons. However, when multiple axons in close proximity cross paths, which is the case in our CLEM dataset, EPBscore does not provide a utility to segment individual axons or to obtain accurate traces of axons in 3D. Thus, unfortunately, we were not able to successfully use EPBscore here due to a relatively high density of labeled axons in our dataset (see e.g. <xref ref-type="fig" rid="fig1">Figure 1</xref>).</p><p>There are several other publications related to bouton detection and measurement. Some of these studies use local shaft intensity for normalization, but this can only be done for low bouton density axons. Other studies use complex sequences of thresholds to determine normalization, which is unlikely to generalize on different types of images. There are also studies that normalize by the mean or median axon intensity. These normalizations are reasonable for low bouton density axons, but can otherwise bias the results. Absence of publicly available tools and/or source codes precluded direct comparisons of these studies with our method.</p><p>Instead, we incorporated several of the above strategies into our bouton detection framework and now directly compare them to the method described in this study (see <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref> and related discussion in response to Essential revision 2).</p><disp-quote content-type="editor-comment"><p>Optional: One reviewer felt that one potential way to increase the impact is to demonstrate its robustness for data previously published by other labs. Other reviewers did not feel this was necessary, but we wanted you to think about this.</p></disp-quote><p>We would like to test the software on other CLEM datasets, but we are not aware of any datasets that are publicly available. Based on our knowledge of the literature, such data are extremely rare and usually include small numbers of reconstructed en passant boutons. For example, one of the largest CLEM datasets we know (Grillo et al., PNAS 2013), contains only 9 en passant boutons. If the reviewers know of available CLEM data, we would be happy to perform the analyses and include the results in the manuscript.</p></body></sub-article></article>