<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">42166</article-id><article-id pub-id-type="doi">10.7554/eLife.42166</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Structural Biology and Molecular Biophysics</subject></subj-group></article-categories><title-group><article-title>New tools for automated high-resolution cryo-EM structure determination in RELION-3</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-122170"><name><surname>Zivanov</surname><given-names>Jasenko</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-8407-0759</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-109538"><name><surname>Nakane</surname><given-names>Takanori</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2697-2767</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-60381"><name><surname>Forsberg</surname><given-names>Björn O</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-122171"><name><surname>Kimanius</surname><given-names>Dari</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-122172"><name><surname>Hagen</surname><given-names>Wim JH</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-6229-2692</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-122173"><name><surname>Lindahl</surname><given-names>Erik</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-2734-2794</contrib-id><email>erik.lindahl@scilifelab.se</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-3361"><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0462-6540</contrib-id><email>scheres@mrc-lmb.cam.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf2"/></contrib><aff id="aff1"><label>1</label><institution>MRC Laboratory of Molecular Biology</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Biochemistry and Biophysics, Science for Life Laboratory</institution><institution>Stockholm University</institution><addr-line><named-content content-type="city">Stockholm</named-content></addr-line><country>Sweden</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Structural and Computational Biology Unit</institution><institution>European Molecular Biology Laboratory</institution><addr-line><named-content content-type="city">Heidelberg</named-content></addr-line><country>Germany</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Cryo-Electron Microscopy Service Platform</institution><institution>European Molecular Biology Laboratory</institution><addr-line><named-content content-type="city">Heidelberg</named-content></addr-line><country>Germany</country></aff><aff id="aff5"><label>5</label><institution content-type="dept">Department of Applied Physics, Swedish e-Science Research Center</institution><institution>KTH Royal Institute of Technology</institution><addr-line><named-content content-type="city">Stockholm</named-content></addr-line><country>Sweden</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Egelman</surname><given-names>Edward H</given-names></name><role>Reviewing Editor</role><aff><institution>University of Virginia</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Kuriyan</surname><given-names>John</given-names></name><role>Senior Editor</role><aff><institution>University of California, Berkeley</institution><country>United States</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>09</day><month>11</month><year>2018</year></pub-date><pub-date pub-type="collection"><year>2018</year></pub-date><volume>7</volume><elocation-id>e42166</elocation-id><history><date date-type="received" iso-8601-date="2018-09-19"><day>19</day><month>09</month><year>2018</year></date><date date-type="accepted" iso-8601-date="2018-11-06"><day>06</day><month>11</month><year>2018</year></date></history><permissions><copyright-statement>© 2018, Zivanov et al</copyright-statement><copyright-year>2018</copyright-year><copyright-holder>Zivanov et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-42166-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.42166.001</object-id><p>Here, we describe the third major release of RELION. CPU-based vector acceleration has been added in addition to GPU support, which provides flexibility in use of resources and avoids memory limitations. Reference-free autopicking with Laplacian-of-Gaussian filtering and execution of jobs from python allows non-interactive processing during acquisition, including 2D-classification, <italic>de novo</italic> model generation and 3D-classification. Per-particle refinement of CTF parameters and correction of estimated beam tilt provides higher resolution reconstructions when particles are at different heights in the ice, and/or coma-free alignment has not been optimal. Ewald sphere curvature correction improves resolution for large particles. We illustrate these developments with publicly available data sets: together with a Bayesian approach to beam-induced motion correction it leads to resolution improvements of 0.2–0.7 Å compared to previous RELION versions.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>software</kwd><kwd>Cryo-EM</kwd><kwd>single-particle analysis</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>None</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001711</institution-id><institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung</institution></institution-wrap></funding-source><award-id>SNF: P2BSP2 168735</award-id><principal-award-recipient><name><surname>Zivanov</surname><given-names>Jasenko</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001691</institution-id><institution>Japan Society for the Promotion of Science</institution></institution-wrap></funding-source><award-id>Overseas Research Fellowship</award-id><principal-award-recipient><name><surname>Nakane</surname><given-names>Takanori</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution>Swedish National Infrastructure for Computing</institution></institution-wrap></funding-source><award-id>2017/12-54</award-id><principal-award-recipient><name><surname>Lindahl</surname><given-names>Erik</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004359</institution-id><institution>Vetenskapsrådet</institution></institution-wrap></funding-source><award-id>2017-04641</award-id><principal-award-recipient><name><surname>Lindahl</surname><given-names>Erik</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004063</institution-id><institution>Knut och Alice Wallenbergs Stiftelse</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Lindahl</surname><given-names>Erik</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id><institution>Medical Research Council</institution></institution-wrap></funding-source><award-id>MC_UP_A025_1013</award-id><principal-award-recipient><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>RELION-3 calculates single-particle reconstructions to higher resolution and with less user-interactions than previously available versions.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Macromolecular structure determination by single-particle analysis of electron cryo-microscopy (cryo-EM) images has undergone rapid progress in recent years. Before 2010, cryo-EM structures to resolutions beyond 4 Å had only been obtained for large icosahedral viruses, for example <xref ref-type="bibr" rid="bib25">Jiang et al., 2008</xref>, <xref ref-type="bibr" rid="bib59">Yu et al., 2008</xref>, and <xref ref-type="bibr" rid="bib61">Zhang et al., 2008</xref>. Since then, cryo-EM structures to resolutions that are sufficient for de novo atomic modelling have been achieved for a wide range of samples (<xref ref-type="bibr" rid="bib16">Fernandez-Leiro and Scheres, 2016</xref>), and several structures beyond 2 Å resolution have been reported (<xref ref-type="bibr" rid="bib34">Merk et al., 2016</xref>; <xref ref-type="bibr" rid="bib5">Bartesaghi et al., 2018</xref>). In 2012, the availability of the first prototypes of direct electron detectors, which recorded images with unprecedented signal-to-noise ratios (<xref ref-type="bibr" rid="bib33">McMullan et al., 2009</xref>), represented a crucial step forward. This advance was closely followed and partially overlapped with important improvements in image processing software. Together, they led to what was termed the ’resolution revolution’ in cryo-EM structure determination (<xref ref-type="bibr" rid="bib29">Kuhlbrandt, 2014</xref>).</p><p>Since the start of this revolution, many new software solutions have been introduced. Some new programs exploited specific opportunities provided by the new detectors, like the correction of beam-induced motions through movie processing (<xref ref-type="bibr" rid="bib8">Brilot et al., 2012</xref>; <xref ref-type="bibr" rid="bib30">Li et al., 2013</xref>; <xref ref-type="bibr" rid="bib44">Rubinstein and Brubaker, 2015</xref>; <xref ref-type="bibr" rid="bib1">Abrishami et al., 2015</xref>; <xref ref-type="bibr" rid="bib32">McLeod et al., 2017</xref>; <xref ref-type="bibr" rid="bib63">Zheng et al., 2017</xref>). Other programs tackled individual steps in the single-particle workflow, like fast and robust estimation of the contrast transfer function (CTF) (<xref ref-type="bibr" rid="bib42">Rohou and Grigorieff, 2015</xref>; <xref ref-type="bibr" rid="bib62">Zhang, 2016</xref>), local-resolution estimation (<xref ref-type="bibr" rid="bib28">Kucukelbir et al., 2014</xref>), or on-the-fly processing of images while they are being acquired at the microscope (<xref ref-type="bibr" rid="bib11">de la Rosa-Trevín et al., 2016</xref>; <xref ref-type="bibr" rid="bib7">Biyani et al., 2017</xref>). In the mean time, also general-purpose programs that already existed, like EMAN2 (<xref ref-type="bibr" rid="bib53">Tang et al., 2007</xref>), Frealign (<xref ref-type="bibr" rid="bib20">Grigorieff, 2007</xref>) or IMAGIC (<xref ref-type="bibr" rid="bib55">van Heel et al., 1996</xref>), were further improved and used for high-resolution structure determination. Both old and new programs benefitted from the increase in image signal-to-noise ratios provided by the new detectors.</p><p>The availability of the first direct-electron detectors coincided with the introduction of the RELION software (<xref ref-type="bibr" rid="bib49">Scheres, 2012b</xref>). This computer program introduced an empirical Bayesian approach, in which optimal Fourier filters for alignment and reconstruction are derived from the data in a fully automated manner (<xref ref-type="bibr" rid="bib48">Scheres, 2012a</xref>). This strongly reduced the need for user expertise in tuning <italic>ad-hoc</italic> filter parameters compared to existing programs, and probably contributed to the rapid uptake of cryo-EM structure determination by non-expert groups. Nowadays, RELION is widely used (<xref ref-type="bibr" rid="bib40">Patwardhan, 2017</xref>), and similar statistical approaches have been implemented in software packages that were developed since: cryoSPARC (<xref ref-type="bibr" rid="bib41">Punjani et al., 2017</xref>) uses the same regularised likelihood optimisation target as RELION, and SPHIRE (<xref ref-type="bibr" rid="bib36">Moriya et al., 2017</xref>) and cisTEM (<xref ref-type="bibr" rid="bib19">Grant et al., 2018</xref>) implement likelihood-based classification methods.</p><p>RELION underwent a major change in 2016 with the release of its second version, which comprised a pipelined approach for the entire single-particle workflow (<xref ref-type="bibr" rid="bib16">Fernandez-Leiro and Scheres, 2016</xref>) and used acceleration on graphical procesing units (GPUs) to reduce its computational costs (<xref ref-type="bibr" rid="bib26">Kimanius et al., 2016</xref>). In addition, its functionality was expanded with the incorporation of sub-tomogram averaging (<xref ref-type="bibr" rid="bib6">Bharat et al., 2015</xref>) and helical reconstruction (<xref ref-type="bibr" rid="bib22">He and Scheres, 2017</xref>). In this paper, we introduce version 3 of RELION. In the Materials and methods section, we describe algorithmic improvements and changes in implementation that have been made throughout the single-particle pipeline in RELION-3. In the Results and Discussion section, we illustrate how these changes allow for improved automation, fast accelerated reconstruction on normal hardware (CPUs) in addition to GPUs, and how the new features enable higher resolution reconstructions compared to previous releases.</p></sec><sec id="s2" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th>Reagent type</th><th>Designation</th><th>Reference</th><th>Identifier</th></tr></thead><tbody><tr><td>software</td><td>RELION</td><td><xref ref-type="bibr" rid="bib49">Scheres, 2012b</xref></td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_016274">SCR_016274</ext-link></td></tr></tbody></table></table-wrap><sec id="s2-1"><title>Laplacian-of-Gaussian auto-picking</title><p>The recommended procedure for the selection of particles from micrographs in previous versions of RELION was to calculate templates for reference-based auto-picking from particles that were manually picked in a subset of the micrographs (<xref ref-type="bibr" rid="bib50">Scheres, 2015</xref>). To allow non-interactive, on-the-fly processing, we implemented a reference-free particle picking method based on the Laplacian-of-Gaussian (LoG) filter. Our method is related to the approach in DoGpicker (<xref ref-type="bibr" rid="bib56">Voss et al., 2009</xref>), which uses a Difference-of-Gaussian (DoG) filter. Similar to the implementation in swarmPS (<xref ref-type="bibr" rid="bib58">Woolford et al., 2007</xref>), we apply a LoG-filter with an optimum response for blobs of size <inline-formula><mml:math id="inf1"><mml:mi>d</mml:mi></mml:math></inline-formula> by multiplying the Fourier transform of a micrograph by<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:mfrac><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo maxsize="160%" minsize="160%">(</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:mfrac><mml:mo maxsize="160%" minsize="160%">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf2"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> is the image frequency, <inline-formula><mml:math id="inf3"><mml:mrow><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, and the division by <inline-formula><mml:math id="inf4"><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> outside the exponentiation provides a normalised response of the filter for different values of <inline-formula><mml:math id="inf5"><mml:mi>d</mml:mi></mml:math></inline-formula>.</p><p>In order to deal with elongated particles, the user specifies a minimum (<inline-formula><mml:math id="inf6"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>) and maximum (<inline-formula><mml:math id="inf7"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>) particle diameter. The program then applies four LoG-filters to detect areas in the micrograph with blobs that are smaller than <inline-formula><mml:math id="inf8"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (with <inline-formula><mml:math id="inf9"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf10"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> or <inline-formula><mml:math id="inf11"><mml:mn>5</mml:mn></mml:math></inline-formula>); four filters to detect blobs that are larger than <inline-formula><mml:math id="inf12"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (with <inline-formula><mml:math id="inf13"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf14"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> or <inline-formula><mml:math id="inf15"><mml:mn>5</mml:mn></mml:math></inline-formula>); and three filters to detect blobs within the user-specified particle size (with <inline-formula><mml:math id="inf16"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf17"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf18"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>).</p><p>Only pixels for which the highest LoG-filtered value over all eleven filtered micrographs (<inline-formula><mml:math id="inf19"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>) is above a user-controlled threshold and the corresponding blob size <inline-formula><mml:math id="inf20"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is in the user-specified particle diameter range are considered for particle picking. Particles are picked iteratively at the highest remaining <inline-formula><mml:math id="inf21"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> value, and around each picked particle one discards all pixels within a circle with diameter <inline-formula><mml:math id="inf22"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. This process is repeated until no suitable pixels remain. To normalise the threshold for <inline-formula><mml:math id="inf23"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> over many different data sets, the default threshold is set to the mean of all <inline-formula><mml:math id="inf24"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> values for which the corresponding <inline-formula><mml:math id="inf25"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is in the user-specified particle diameter range, and deviations from the default are expressed in standard deviations of those same values.</p></sec><sec id="s2-2"><title>CTF refinement</title><p>In RELION, per-micrograph CTF parameters are determined through wrappers to CTFFIND (<xref ref-type="bibr" rid="bib42">Rohou and Grigorieff, 2015</xref>) or Gctf (<xref ref-type="bibr" rid="bib62">Zhang, 2016</xref>). These programs fit CTFs to the Thon rings visible in the power spectra of (patches of) micrographs. In RELION-3, we have implemented a program to refine the CTF parameters, that is to re-estimate defocus and astigmatism, using a 3D reference structure. This allows CTF estimation to exploit both the phases and the amplitudes of the experimental images, instead of having to rely exclusively on their power spectra. This approach thus produces significantly more reliable estimates, due to higher signal-to-noise ratios and also because it does not require separation of the Thon rings from the background intensity of the power spectrum. This is illustrated in <xref ref-type="fig" rid="fig1">Figure 1</xref>. The increased stability of the CTF fitting can be leveraged to estimate independent defoci for individual particles. Similar functionality also exists in Frealign (<xref ref-type="bibr" rid="bib20">Grigorieff, 2007</xref>) and cisTEM (<xref ref-type="bibr" rid="bib19">Grant et al., 2018</xref>).</p><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.002</object-id><label>Figure 1.</label><caption><title>Comparison of the traditional power-spectrum-based CTF estimation technique with reference-map-based CTF refinement.</title><p>Top: Sum over the power spectra <inline-formula><mml:math id="inf26"><mml:mrow><mml:mo fence="true">||</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo fence="true">||</mml:mo></mml:mrow></mml:math></inline-formula> of all polished particle images in micrograph EMD-2984_0000 of EMPIAR-10061 (left) and the averages and standard deviations of that sum over Fourier rings between 10 Å and 2.5 Å (right). The dashed grey curves are located one std. deviation of each ring above and below the average. The overall rise in spectral power as a function of frequency is a consequence of particle polishing. Bottom: The corresponding plot for the sum over the real components of <inline-formula><mml:math id="inf27"><mml:mrow><mml:msubsup><mml:mi>V</mml:mi><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>⁢</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, instead of the power spectra. Note that the latter term is not only centered around zero, obviating the need to estimate the background intensity, but it also offers a higher signal-to-noise ratio.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig1-v2"/></fig><p>Formally, CTF refinement in RELION-3 works as follows. Let <inline-formula><mml:math id="inf28"><mml:mi>V</mml:mi></mml:math></inline-formula> be the (complex-valued) Fourier-space representation of the reference structure. We assume the viewing direction and particle position to be known for each observed particle <inline-formula><mml:math id="inf29"><mml:mi>p</mml:mi></mml:math></inline-formula>. This allows us to project and shift the 3D reference, yielding <inline-formula><mml:math id="inf30"><mml:msub><mml:mi>V</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula>, the corresponding reference projection in 2D. The Fourier space representation of experimental particle image <inline-formula><mml:math id="inf31"><mml:msub><mml:mi>X</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> is now assumed equal to <inline-formula><mml:math id="inf32"><mml:msub><mml:mi>V</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula>, multiplied by the CTF and distorted by noise. We could then estimate the optimal CTF from <inline-formula><mml:math id="inf33"><mml:msub><mml:mi>V</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf34"><mml:msub><mml:mi>X</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> by determining a set of CTF-parameters <inline-formula><mml:math id="inf35"><mml:mi>θ</mml:mi></mml:math></inline-formula> that minimises the squared difference between them:<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:munder><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">(</mml:mo></mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>g</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mtext>CTF</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Instead, we maximise their correlation:<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:mrow><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:munder><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">(</mml:mo></mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>g</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mtext>CTF</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mtext>Re</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula>where the asterisk indicates complex conjugation, <inline-formula><mml:math id="inf36"><mml:mi>k</mml:mi></mml:math></inline-formula> is the 2D Fourier-space frequency and per-frequency weights <inline-formula><mml:math id="inf37"><mml:msub><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> are given by the FSC between two independently refined half-maps – this a heuristic that serves to attenuate the effect of frequencies where the reference is less reliable.</p><p>The value of the CTF for a spatial frequency <inline-formula><mml:math id="inf38"><mml:mi>k</mml:mi></mml:math></inline-formula> is defined as follows:<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mrow><mml:mrow><mml:mrow><mml:mtext>CTF</mml:mtext><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo maxsize="160%" minsize="160%">(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:mo>⁢</mml:mo><mml:mi>λ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo maxsize="120%" minsize="120%">(</mml:mo><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo maxsize="120%" minsize="120%">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mo>⁢</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:msup><mml:mi>λ</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo>⁢</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mi>χ</mml:mi></mml:mrow><mml:mo maxsize="160%" minsize="160%">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf39"><mml:mi>λ</mml:mi></mml:math></inline-formula> is the wavelength of the electrons, <inline-formula><mml:math id="inf40"><mml:msub><mml:mi>δ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> the average defocus, <inline-formula><mml:math id="inf41"><mml:msub><mml:mi>δ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:math></inline-formula> half the difference between the two effective defoci resulting from astigmatism, <inline-formula><mml:math id="inf42"><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf43"><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:math></inline-formula> are the azimuthal angles of <inline-formula><mml:math id="inf44"><mml:mi>k</mml:mi></mml:math></inline-formula> and the major astigmatism axis, respectively, <inline-formula><mml:math id="inf45"><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> is the spherical aberration constant of the microscope and <inline-formula><mml:math id="inf46"><mml:mi>χ</mml:mi></mml:math></inline-formula> the overall phase shift resulting from amplitude contrast and, if one is used, a phase plate.</p><p>The expression in <xref ref-type="disp-formula" rid="equ3">Equation 3</xref> allows the CTF-parameters <inline-formula><mml:math id="inf47"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>χ</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> to be determined either as constant for all particles in an entire micrograph or for every particle separately. In the latter case, the second sum consists of one single term corresponding to the index <inline-formula><mml:math id="inf48"><mml:mi>p</mml:mi></mml:math></inline-formula> of the particle in question, and the result will be independent on the number of particles per micrograph. Our implementation allows for the estimation of <inline-formula><mml:math id="inf49"><mml:msub><mml:mi>δ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> on a per-particle basis, <inline-formula><mml:math id="inf50"><mml:msub><mml:mi>δ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf51"><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:math></inline-formula> on a per-particle or per-micrograph basis, and <inline-formula><mml:math id="inf52"><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf53"><mml:mi>χ</mml:mi></mml:math></inline-formula> on a per-micrograph basis. In our experiments, we have found that for many data sets the best results are obtained by estimating only <inline-formula><mml:math id="inf54"><mml:msub><mml:mi>δ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> for individual particles, while leaving all the other parameters unchanged.</p><p>Because the large number of CTF-parameters for a given dataset introduces the risk of overfitting, it is important to maintain a strict separation between the two independently refined half-sets. For that reason, the reference image <inline-formula><mml:math id="inf55"><mml:msub><mml:mi>V</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> used to estimate the parameters of particle <inline-formula><mml:math id="inf56"><mml:mi>p</mml:mi></mml:math></inline-formula> is always obtained by projecting the reference map computed from the half-set to which particle <inline-formula><mml:math id="inf57"><mml:mi>p</mml:mi></mml:math></inline-formula> belongs. For completeness, we note that by default RELION combines the lowest frequencies of the two half-set reconstructions in order to avoid a situation where the two refinements converge onto reconstructions with small differences in orientation. Since this combination is only done for frequencies below 40 Å, this does not have noticeable effects on the CTF refinement.</p></sec><sec id="s2-3"><title>Beam-tilt estimation and correction</title><p>A tilted beam alters the phase delays of the scattered beam components with respect to the unscattered reference beam. The delays <inline-formula><mml:math id="inf58"><mml:msub><mml:mi>ψ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf59"><mml:msub><mml:mi>ψ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></inline-formula> for a pair of corresponding Friedel mates are then no longer identical. We can decompose them into a symmetrical component <inline-formula><mml:math id="inf60"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> and an anti-symmetrical one, <inline-formula><mml:math id="inf61"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. The symmetrical part only induces astigmatism, which is already being modelled reasonably by our CTF model (<xref ref-type="disp-formula" rid="equ4">Equation 4</xref>). The anti-symmetrical part, however, induces axial coma, that is a phase shift <inline-formula><mml:math id="inf62"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> in the respective image frequencies. The magnitude of <inline-formula><mml:math id="inf63"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> as a function of tilt <inline-formula><mml:math id="inf64"><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> is given by (<xref ref-type="bibr" rid="bib18">Glaeser et al., 2011</xref>; <xref ref-type="bibr" rid="bib60">Zemlin et al., 1978</xref>):<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>π</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:msup><mml:mi>λ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>&lt;</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>&gt;</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf65"><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> is the spherical aberration constant of the microscope, <inline-formula><mml:math id="inf66"><mml:mi>λ</mml:mi></mml:math></inline-formula> the wavelength of the electrons and <inline-formula><mml:math id="inf67"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mo>,</mml:mo><mml:mo>&gt;</mml:mo></mml:mrow></mml:math></inline-formula> denotes the scalar product in 2D.</p><p>We have developed an efficient method to determine the tilt vector <inline-formula><mml:math id="inf68"><mml:mi>b</mml:mi></mml:math></inline-formula> from a set of observations of a particle and the corresponding high-resolution reference. Let <inline-formula><mml:math id="inf69"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℂ</mml:mi></mml:mrow></mml:math></inline-formula> denote the predicted complex amplitude of image frequency <inline-formula><mml:math id="inf70"><mml:mi>k</mml:mi></mml:math></inline-formula> of particle <inline-formula><mml:math id="inf71"><mml:mi>j</mml:mi></mml:math></inline-formula> (including the effects of the CTF) and <inline-formula><mml:math id="inf72"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">C</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> the corresponding amplitude observed in the experimental image <inline-formula><mml:math id="inf73"><mml:mi>X</mml:mi></mml:math></inline-formula>. We aim to find a vector <inline-formula><mml:math id="inf74"><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> that minimises the squared difference between the observations and the prediction: <disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mi>β</mml:mi></mml:munder><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula>where the phase shift is expressed as a multiplication with a complex number: <inline-formula><mml:math id="inf75"><mml:mrow><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. Since the error in <xref ref-type="disp-formula" rid="equ6">Equation 6</xref> is a sum of quadratic functions, the equation can be transformed into: <disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mi>β</mml:mi></mml:munder><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula>with the per-pixel optima <inline-formula><mml:math id="inf76"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℂ</mml:mi></mml:mrow></mml:math></inline-formula> and weights <inline-formula><mml:math id="inf77"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:mrow></mml:math></inline-formula> given by:<disp-formula id="equ8"><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="right left right left right left right left right left right left" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true" rowspacing="3pt"><mml:mlabeledtr><mml:mtd><mml:mtext>(8)</mml:mtext></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:mtd><mml:mtd/></mml:mlabeledtr><mml:mlabeledtr><mml:mtd><mml:mtext>(9)</mml:mtext></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mtd><mml:mtd/></mml:mlabeledtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula>where the asterisk indicates complex conjugation. The computation of <inline-formula><mml:math id="inf78"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> can be thought of as an averaging of the phase differences between the projected reference and the experimental images for Fourier-space pixel <inline-formula><mml:math id="inf79"><mml:mi>k</mml:mi></mml:math></inline-formula> over all the images. Because of the cyclical nature of phase angles, a naive average over the angles themselves would not produce the desired result.</p><p>This formulation allows us to first compute <inline-formula><mml:math id="inf80"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf81"><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> for each pixel by only iterating over the dataset once. This takes less than one hour for most datasets. Once the <inline-formula><mml:math id="inf82"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf83"><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> are known, we can fit the optimal <inline-formula><mml:math id="inf84"><mml:mi>b</mml:mi></mml:math></inline-formula> to them using an iterative non-linear method, such as Nelder-Mead downhill simplex (<xref ref-type="bibr" rid="bib39">Nelder and Mead, 1965</xref>). Due to the small number of <inline-formula><mml:math id="inf85"><mml:mi>k</mml:mi></mml:math></inline-formula>, this iterative optimisation then only takes seconds.</p><p>In addition, inspecting the phases of <inline-formula><mml:math id="inf86"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> allows us to ascertain that the effects observed are really those of a tilted beam. If we were to merely fit the optimal tilt vector <inline-formula><mml:math id="inf87"><mml:mi>b</mml:mi></mml:math></inline-formula> to the data directly, we would run the risk of fitting <inline-formula><mml:math id="inf88"><mml:mi>b</mml:mi></mml:math></inline-formula> to noise. Example plots of phase angles of <inline-formula><mml:math id="inf89"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> are shown in <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>. Furthermore, such phase-error plots make it possible to observe the effects of higher-order anti-symmetrical aberrations, such as three-fold astigmatism (<xref ref-type="bibr" rid="bib46">Saxton, 1995</xref>; <xref ref-type="bibr" rid="bib27">Krivanek and Stadelmann, 1995</xref>). Although no methods are available to correct for these yet, we are currently investigating these.</p><p>Once the tilt vector <inline-formula><mml:math id="inf90"><mml:mi>b</mml:mi></mml:math></inline-formula> is known, it can be used to account for the expected phase error in <inline-formula><mml:math id="inf91"><mml:mi>X</mml:mi></mml:math></inline-formula> during refinement and reconstruction. This functionality has already been present in RELION since release 2.0, but no practical methods were available to estimate <inline-formula><mml:math id="inf92"><mml:mi>b</mml:mi></mml:math></inline-formula> until now.</p></sec><sec id="s2-4"><title>Ewald sphere correction</title><p>We implemented the single-side band algorithm to correct for Ewald sphere curvature as proposed by (<xref ref-type="bibr" rid="bib45">Russo and Henderson, 2018</xref>), which bears resemblance to the method implemented in Frealign (<xref ref-type="bibr" rid="bib20">Grigorieff, 2007</xref>; <xref ref-type="bibr" rid="bib57">Wolf et al., 2006</xref>). Our implementation was made in the <monospace>relion_reconstruct</monospace> program, which was also parallelised using the message-passing interface (MPI) standard.</p><p>Briefly, one divides the Fourier transform of each extracted particle into two halves and multiplies each half with one of the following single-side band CTFs:<disp-formula id="equ9"><label>(10)</label><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="right left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>C</mml:mi><mml:mi>T</mml:mi><mml:mi>F</mml:mi><mml:mi>P</mml:mi></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>+</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo>+</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mtext> and</mml:mtext></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>C</mml:mi><mml:mi>T</mml:mi><mml:mi>F</mml:mi><mml:mi>Q</mml:mi></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo>+</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf93"><mml:mi>ψ</mml:mi></mml:math></inline-formula> is the phase shift of the electron wave caused by the objective lens, and the term <inline-formula><mml:math id="inf94"><mml:mrow><mml:mi>π</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> is the phase shift upon scattering by the specimen. These complex multiplications leave the amplitudes of the Fourier components intact, but change the phases, resulting in a breakage of Friedel symmetry. To avoid discontinuities at the edge between the two halves of the Fourier transform, the multiplication is done in sectors by rotating the edge between the two halves. Two Fourier transforms, one for each side-band, are then obtained for each particle by combination of those parts of the Fourier transform that are furthest away from the edge in the different sectors. The number of sectors can be controlled by the user. By default it is set to two.</p><p>The two Fourier transforms of each particle sample the 3D transform in positions that are slightly above and below the central section. Both are back-transformed, masked in real space to remove noise in the area around the particle, and then transformed back into Fourier space before being inserted into their correct position in the 3D transform. The user has the option to use either upward or downward curvature of the Ewald sphere. The distance <inline-formula><mml:math id="inf95"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>z</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> from the central section is calculated as:<disp-formula id="equ10"><label>(11)</label><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:msup><mml:mi>z</mml:mi><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Because an unknown number of mirroring operations may have been introduced during the data acquisition and image processing, the actual direction of curvature of the Ewald sphere is often unknown for a given data set. Therefore, the user may typically want to perform Ewald sphere correction with both directions. For this purpose, we implemented the <monospace>--reverse_curvature</monospace> option. If Ewald sphere curvature is a limiting factor for the resolution of a reconstruction, one direction of curvature should yield a higher resolution map than the other. <xref ref-type="bibr" rid="bib13">DeRosier (2000)</xref> estimates that the frequency <inline-formula><mml:math id="inf96"><mml:msup><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> for which Ewald sphere curvature becomes limiting for a particle with diameter <inline-formula><mml:math id="inf97"><mml:mi>d</mml:mi></mml:math></inline-formula> is approximated by:<disp-formula id="equ11"><label>(12)</label><mml:math id="m11"><mml:mrow><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mn>1.4</mml:mn><mml:mrow><mml:mi>d</mml:mi><mml:mo>⁢</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:mfrac></mml:msqrt></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p></sec><sec id="s2-5"><title>CPU vector acceleration</title><p>The large computational load of the cryo-EM pipeline requires RELION to be highly parallel. In RELION-2, a new code-path was introduced, which off-loaded the core computations onto graphical processing units (GPUs) (<xref ref-type="bibr" rid="bib26">Kimanius et al., 2016</xref>). This new path was by design less demanding of double precision arithmetics and memory, and provided a large improvement in data throughput by virtue of the greatly increased speed. However, the GPU acceleration is only available for cards from a single vendor, and it cannot use many of the large-scale computational resources available in existing centres, local clusters, or even researchers’ laptops. In addition, the memory available on typical GPUs limits the box sizes that can be used, which could turn into a severe bottleneck for large particles. For RELION-3, we have developed a new general code path where CPU algorithms have been rewritten to mirror the GPU acceleration, which provides <italic>dual</italic> execution branches of the code that work very efficiently both on accelerators as well as the single-instruction, multiple-data vector units present on traditional CPUs. This has enabled lower precision arithmetics, it reduces memory requirements considerably, and it also makes it possible to exploit the very large amounts of memory that can be fitted on CPU servers. In addition, it provides a transparent source code where new algorithms may be accelerated immediately, and it enables a significant speedup compared to the <italic>legacy</italic> code path, which is nonetheless still present in RELION-3 for comparative purposes.</p></sec><sec id="s2-6"><title>Python scripts for automated processing</title><p>As of release 2.0, RELION has used a pipelined approach, where the execution of individual command-line programs is organised into <italic>jobs</italic>. Multiple different types of jobs exist for the different tasks in the single-particle workflow, for example there are specific jobs for CTF estimation, particle picking, 2D classification and 3D refinement. Each job takes specific types of files, called <italic>nodes</italic> as input and produces other nodes as output. By using output nodes from one job as input for the next job, the entire process of structure determination is expressed as a directional graph. Parameters for jobs are typically provided through the GUI, where jobs can be executed or scheduled for later, possibly repeated, execution.</p><p>In RELION-3, we have expanded the functionality to schedule and execute jobs from the GUI to the command line by modifications in the <monospace>relion_pipeliner</monospace> program. This has allowed the generation of (python) scripts to perform complicated, standardised tasks by execution of a series of jobs. All jobs executed by these scripts become part of the standard pipeline, and one can use the GUI to follow the process live, or to do other things in the same directory meanwhile. With RELION-3, we distribute two example scripts. We envision that these will serve as inspiration for scripts written by others to reflect their specific needs.</p><p>The first example script is called <monospace>bfactor_plot.py</monospace>. It automatically runs multiple 3D refinements on random subsets of an input data set, where each time the size of the subset is doubled from a user-specified minimum number of particles. The script then automatically generated a B-factor plot according to Rosenthal and Henderson (<xref ref-type="bibr" rid="bib43">Rosenthal and Henderson, 2003</xref>), where <inline-formula><mml:math id="inf98"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>, with <inline-formula><mml:math id="inf99"><mml:mi>d</mml:mi></mml:math></inline-formula> being the resolution of each refinement, is plotted against the logarithm of the number of particles in the subset. The script also calculates the B-factor from the slope of a fitted line through the plotted points, and uses extrapolation of this line to make predictions about the number of particles needed to achieve higher resolutions.</p><p>The second example script is called <monospace>relion_it.py</monospace>. It is designed to provide on-the-fly feedback on the quality of micrographs, while they are being acquired at the microscope. The script repeatedly executes jobs for micrograph-based motion correction, CTF estimation, LoG-based auto-picking and particle extraction. In the mean time, the script keeps track of how many particles have been extracted, and can also execute 2D and/or 3D classification jobs in batches of a user-defined number of particles. If no 3D reference is available for 3D classification, an SGD initial model generation job will be executed to create one automatically. In addition, it is possible to replace the LoG-based auto-picking job by a template-based auto-picking job once a suitable 3D reference has been obtained from 3D classification of the LoG-picked particles.</p><p>Although almost all parameters from the GUI are accessible through the <monospace>relion_it.py</monospace> script, the procedure has been designed to rely on only a few dataset-specific parameters. Besides parameters describing the microscopy and computational setup, the most important parameters are <inline-formula><mml:math id="inf100"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf101"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for the LoG-based auto-picking and box sizes for the extracted particles. The default thresholds for the LoG-based and template-based auto-picking jobs are set to relatively low values. This typically results in many false positives in the picking, which are then sorted out in the subsequent classifications. This way, completely non-interactive, on-the-fly feedback on data quality may be achieved.</p></sec><sec id="s2-7"><title>Other developments</title><p>Besides the developments described above, RELION-3 comprises two major algorithmic advances that have already been described elsewhere.</p><p>Firstly, Bayesian particle polishing implements a Gaussian Process regression algorithm for estimating beam-induced motion tracks for individual particles, and an improved B-factor estimation algorithm for resolution-dependent weighting of individual movie frames. Although not strictly necessary, Bayesian polishing is typically performed after motion-correction at the micrograph (patch) level by MotionCor2 (<xref ref-type="bibr" rid="bib63">Zheng et al., 2017</xref>). To expose the metadata of this algorithm better to the Bayesian polishing approach, we also implemented our own version of the MotionCor2 algorithm. Unlike the UCSF implementation, our version does not use GPU-acceleration but runs on multi-core CPUs using OpenMP multi-threading. For <inline-formula><mml:math id="inf102"><mml:mrow><mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>×</mml:mo><mml:mn>4</mml:mn></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> movies, and using 12 cores, our program runs at comparable speeds to the UCSF implementation. More details about the Bayesian polishing and our implementation of the MotionCor2 algorithm have been described by <xref ref-type="bibr" rid="bib65">Zivanov et al, (2018)</xref>.</p><p>Secondly, multi-body refinement implements an automated and iterative approach for focused refinement with partial signal subtraction on multiple independently moving parts of a complex (<xref ref-type="bibr" rid="bib37">Nakane et al., 2018</xref>). This approach is useful for improving densities of flexible multi-domain complexes, and yields insights into the type of inter-domain motions that are present in those.</p><p>In addition, many smaller programs and functionalities have been added throughout the single-particle processing workflow. We highlight the following. The motion correction, CTF estimation and auto-picking jobs now output PDF files with metadata plots for all micrographs. We have improved our 3D initial model generation by adopting a stochastic gradient descent (SGD) procedure that follows the implementation in cryoSPARC much more closely than our previous version. We achieved considerably speedups in 2D and 3D classification by using subsets of particles in the first few iterations, which was inspired by a similar implementation in cistem (<xref ref-type="bibr" rid="bib19">Grant et al., 2018</xref>). We have added a program called <monospace>relion_star_handler</monospace> that implements a range of useful operations for metadata files in the star format (<xref ref-type="bibr" rid="bib21">Hall, 1991</xref>). And we have implemented a program called <monospace>relion_align_symmetry</monospace> that aligns the symmetry axes of a 3D map in arbitrary orientation according to the conventions in RELION.</p></sec></sec><sec id="s3" sec-type="results|discussion"><title>Results and discussion</title><sec id="s3-1"><title>CPU vector acceleration</title><p>The functions that perform the expectation step (particle alignment) in RELION-3 can now use the same code path and structure as the GPU-accelerated code that was introduced in RELION-2, even if executing on systems without GPUs. This has led to several key improvements. First, the algorithm strength reductions first introduced for the GPU code makes it possible to use single precision in most places, which cuts the memory footprint in half for large parts of the code. Second, data has been organised to better fit modern hardware. The legacy CPU code would for instance allocate space for all <italic>possible</italic> orientations under the current sampling level, while the new CPU code makes use of coalesced memory allocation limited to the orientations that will be investigated. These type of changes result in a higher compute intensity with more coalesced memory access in smaller allocations. It is evident that the generalised and more streamlined code path facilitates compiler optimisation compared to the previous CPU version. The standard 3D benchmark for example runs 1.5x and 2.5x faster on the previous (Broadwell) and current (Skylake) generations of x86 processors, respectively (<xref ref-type="fig" rid="fig2">Figure 2A,B</xref>), without compromising the results (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). However, the new coalesced memory allocation also makes it possible to instruct the compiler to generate efficient code targeting the single-instruction, multiple-data (SIMD) vector units present in modern CPUs. These operate on many input data elements at once, somewhat similar to GPUs, and typically also provide better throughput for single-precision data. Examples of this includes the so-called avx (advanced vector extensions) instructions present in all 64-bit x86 CPUs that operate on eight single-precision floating-point numbers, or the avx512 instructions present in the newest CPUs that extend the width to 16 single-precision numbers. By explicitly instructing the compiler to use avx-instructions for the new generalised code path, we see a further performance increase of 5.4x on Skylake-generation CPUs (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). This enables x86 CPU nodes to approach the cost-efficiency of professional GPU hardware (<xref ref-type="fig" rid="fig2">Figure 2C</xref>), with results that are qualitatively identical to the legacy code path (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>).</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.003</object-id><label>Figure 2.</label><caption><title>Accelerated CPU performance (<bold>A</bold>) Even when specific vector instructions are disabled, RELION-3 runs faster than RELION-2 even on the previous-generation Broadwell processors that are ubiquitous in many cryo-EM clusters worldwide.</title><p>Enabling vectorisation during compilation with the Intel compiler benefits the new streamlined code path, but not the legacy code. (<bold>B</bold>) For latest-generation Skylake CPUs, the difference is much larger even with only AVX2 vectorisation enabled, and when enabling the new AVX512 instructions the performance is roughly 4.5x higher than the legacy code path. (<bold>C</bold>) The accelerated CPU code executing on dual-socket x86 nodes provides cost-efficiency that is at least approaching that of professional-class GPU hardware (but not consumer GPUs).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.004</object-id><label>Figure 2—figure supplement 1.</label><caption><title>FCSs comparing half-sets in each type of run, legacy-CPU, acc-CPU, and acc-GPU, all reach the same resolution and sampling accuracy.</title><p>Additional FSCs compare the reconstruction of the acc-CPU and acc-GPU using the legacy-CPU as a base of comparison, showing numerical agreement beyond the reconstructed signal threshold. This validates that the quality of results has not been compromised from using lower precision or compiler optimisation.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig2-figsupp1-v2"/></fig></fig-group><p>Notably, use of AVX-instructions does not improve on performance for legacy CPU-execution at all since the code parallelism is not expressed clearly enough for the compiler to recognise it. The performance also depends on which compiler is used, as they are able to optimise the program to varying degrees. The GNU compiler (GCC, verison 7.3) seems less able to convert RELIONs current formulation to efficient parallel instructions than the Intel compiler (ICC, version 2018.3.222), and presently the former provides no additional benefit on a Broadwell-generation CPU when the slightly newer AVX2 instructions are enabled. The better performance of icc is not unreasonable given that these benchmarks target Intel CPUs, although the negligible benefit of enabling AVX2 support in GCC is a bit surprising - hopefully this will improve in future compiler versions.</p><p>A handful of things are worth emphasising:</p><list list-type="bullet"><list-item><p>While the code has been streamlined to allow compilers to generate efficient x86 SIMD vector instructions, only preprocessor directives are used to aid the acceleration, and the new code path is therefore portable to any architecture.</p></list-item><list-item><p>Since the vector acceleration executes on the CPU, it is straightforward to expand memory and use arbitrarily large box sizes (in contrast to the limitations present when offloading to (GPU) accelerators).</p></list-item><list-item><p>For now, the legacy CPU execution is preserved for comparison. Legacy execution can be run with any relion_refine program by omitting the --gpu and/or --cpu flag.</p></list-item><list-item><p>Due to complex compiler dependencies for GPU support, it might not be possible to enable simultaneous CPU and GPU acceleration support. Similarly, since the CPU acceleration targets the same routines as the GPU acceleration, it will not <italic>per se</italic> alleviate any CPU bottlenecks during GPU execution. The generalised path means RELION will branch into functions that launch highly parallel <italic>either</italic> on the CPU or GPU.</p></list-item><list-item><p>Owing to the higher performance achieved through use of the non-free icc compiler, and the fact that current gcc versions do not yet automatically generate AVX512 instructions, we will provide pre-build RELION-3 binaries optimised for the latest CPUs in addition to source code distribution.</p></list-item></list></sec><sec id="s3-2"><title>Per-particle defocus correction</title><p>Per-particle defocus variations within a micrograph arise from different particles being situated at different heights within the field of view. This may happen when the ice layer is relatively thick, and/or when the ice layer is not perpendicular to the electron beam. The latter may occur when the sample support film wrinkles upon flash freezing or when the sample stage is tilted in the microscope, for example to ameliorate a problem of preferred particle orientations (<xref ref-type="bibr" rid="bib51">Tan et al., 2017</xref>; <xref ref-type="bibr" rid="bib38">Naydenova and Russo, 2017</xref>). As an extreme case of non-horizontal samples, we re-processed an influenza virus hemagglutinin dataset (EMPIAR-10097) that was collected at 40 degree stage tilt to overcome a strong preferred orientation of the particles (<xref ref-type="bibr" rid="bib51">Tan et al., 2017</xref>). At this tilt angle, the height differences within a single micrograph are more than 4000 Å. A reconstruction from this data set was originally published at 4.2 Å resolution. Recently, the same data were also re-processed in Warp and cryoSPARC, resulting in an improved resolution of 3.2 Å (<xref ref-type="bibr" rid="bib54">Tegunov and Cramer, 2018</xref>).</p><p>We aligned and dose-weighted the 668 movies with our own implementation of the MotionCor2 algorithm, and estimated per-micrograph defocus parameters using CTFFIND4 (<xref ref-type="bibr" rid="bib42">Rohou and Grigorieff, 2015</xref>). Because of the high tilt, Thon rings were very weak and the estimated resolution from CTFFIND4 was limited to about 10 Å. We applied LoG autopicking to an initial subset of 210 micrographs, and subjected the resulting 75,360 particles to 2D classification. We then used four good 2D class averages as templates for reference-based autopicking of all micrographs. The resulting 608,919 particles were then classified into 100 2D classes, from which we selected 361,507 particles that contributed to reasonable 2D class averages. We generated an initial 3D model using the SGD algorithm with C3 symmetry. Up to this point, we did not perform CTF-amplitude correction at resolutions lower than their first peak. A first 3D refinement with full CTF correction yielded only 6.6 Å resolution, and the FSC curve between the two half-maps showed strong oscillations, indicating inaccuracies in the CTF correction (<xref ref-type="fig" rid="fig3">Figure 3A,B</xref>). We then refined the per-particle defoci with a search range of ±2500 Å, which improved the resolution to 4.4 Å. Repeating per-particle defocus refinement and 3D refinement two more times yielded 4.0 and 3.8 Å. Since a fourth iteration did not improve the resolution any further, we then proceeded with Bayesian polishing, which improved the resolution to 3.5 Å. We then used 3D classification into six classes to select a subset of 152,960 particles contributing to the best class, again resulting in 3.5 Å resolution after 3D refinement. CTF refinement with beam-tilt correction and 3D refinement were then again iterated three times, giving 3.3 Å, 3.2 Å, and finally 3.1 Å resolution. During these refinements, 1364 particles were translated within 30 Å of their closest neighbour. Since duplicated particles may invalidate gold-standard separation and thereby inflate resolution, we removed these duplicate particles before the final 3D refinement using new functionality in the 'Subset selection’ jobtype on the GUI. Plots of the final defocus values for particles within a single micrograph clearly replicate the tilt geometry of the experiment (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>).</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.005</object-id><label>Figure 3.</label><caption><title>Per-particle defocus correction (<bold>A</bold>) FSC curves between independently refined half-maps for the different stages of processing as explained in the main text.</title><p>(<bold>B</bold>) As in A, but FSC curves are between the cryo-EM maps and the corresponding atomic model (PDB-4FNK) (<xref ref-type="bibr" rid="bib15">Ekiert et al., 2012</xref>). (<bold>C</bold>) Representative density features for some of the maps for which FSC curves are shown in A and B.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig3-v2"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.006</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Per-particle defocus estimates (along Z) are plotted against the X,Y-coordinates of the particles in a representative micrograph.</title></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig3-figsupp1-v2"/></fig></fig-group><p>This example demonstrates that even for models with intermediate resolution (in this case 6.6 Å) our per-particle defocus refinement can yield improved defoci. It also illustrates the robustness of the method against the initial values being far off. Using initial defoci that are closer to the correct ones will reduce the need for performing multiple cycles of per-particle defocus refinement. Therefore, in practice it would probably be faster to start from defoci provided by local CTF estimation programs, such as CTFTILT (<xref ref-type="bibr" rid="bib35">Mindell and Grigorieff, 2003</xref>), Gctf (<xref ref-type="bibr" rid="bib62">Zhang, 2016</xref>) or Warp (<xref ref-type="bibr" rid="bib54">Tegunov and Cramer, 2018</xref>). Currently, this requires some scripting by the user, as the wrappers to CTFFIND4 and Gctf on the RELION-3 GUI do not allow local CTF estimation.</p></sec><sec id="s3-3"><title>Beam tilt correction</title><p>Until to date, beam tilt has been largely ignored in cryo-EM single-particle analysis. Prior to the resolution revolution, the amount of beam tilt present in typical data sets did not affect their achievable resolution to a noticeable extent. More recently, even though methods to correct for beam tilt already existed in RELION and Frealign, the lack of reliable tools to estimate beam tilt meant these corrections were hardly ever used. Beam tilt results from sub-optimal coma-free alignment of the microscope. Based on our experience, we estimate that currently available microscope alignment procedures may still leave up to a quarter mrad of beam tilt in the data. This will not limit the resolution of 3 Å structures, but as shown for <inline-formula><mml:math id="inf103"><mml:mi>β</mml:mi></mml:math></inline-formula>-galactosidase in section 3.6, such amounts of beam tilt are limiting for 2 Å structures. Therefore, as resolutions keep improving, beam tilt correction will gain in importance.</p><p>There are data acquisition scenarios where beam tilt becomes a limiting factor at much lower resolutions. With the elevated costs of high-end electron microscopes, faster data acquisition methods are highly sought after. A rate-limiting step in many data acquisition schemes is to physically move the sample stage from one hole in the carbon to the next, as one needs to wait for mechanical stage drift to settle. Because it is much faster to shift the electron beam instead, one could achieve higher data acquisition rates by using beam-shift to image multiple holes before shifting the stage. Beam-shift is already used extensively to take multiple images within a single hole, but because it introduces beam tilt, its use for imaging multiple holes has only recently attracted attention (<xref ref-type="bibr" rid="bib10">Cheng et al., 2018</xref>). Although it is possible to actively compensate for the introduced beam tilt using the microscope’s deflection coils (<xref ref-type="bibr" rid="bib14">Eades, 2006</xref>; <xref ref-type="bibr" rid="bib18">Glaeser et al., 2011</xref>), this procedure puts more stringent requirements on microscope alignment.</p><p>We evaluated our methods for beam tilt estimation and correction using two data sets on horse spleen apo-ferritin (purchased from Sigma), which were acquired with or without active beam tilt compensation. The data were recorded using serialEM (<xref ref-type="bibr" rid="bib31">Mastronarde, 2005</xref>) in combination with a patch in the Thermo Fischer microscope software to perform active beam tilt compensation. (At the time of our experiment, active beam-tilt compensation was not yet implemented in serialEM.) For both data sets, we used the same R2/2 Quantifoil grid; the same Titan Krios microscope with a Gatan energy filter (with a slit width of 20 eV); the same K2-summit detector; and we used beam-shift to take five images in nine holes each before shifting the stage. This procedure was repeated nine times for the first data set and ten times for the second, because the area imaged in the latter contained fewer particles. We only used active beam tilt compensation for the first data set. Movies with a total dose of 41 electrons per Å<inline-formula><mml:math id="inf104"><mml:msup><mml:mi/><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> were fractionated into 40 frames with a pixel size of 1.04 Å. Template-based auto-picking yielded 104,992 particles for the first and 109,646 particles for the second data set. After selection of suitable 2D classes, the first and second data sets comprised 79,985 and 65,131 particles, respectively.</p><p>The first data set, with active beam tilt compensation, yielded a resolution of 2.3 Å after standard 3D auto-refinement, and 2.2 Å after Bayesian polishing and a second round of refinement (<xref ref-type="fig" rid="fig4">Figure 4A,B</xref>). The second data set, without active beam tilt compensation, yielded 2.9 Å after the first refinement, and 2.8 Å after Bayesian polishing. Beam tilt estimation was then performed independently for nine subsets of the data: one subset for each of the nine holes that were imaged before shifting the stage, and each subset thus comprising <inline-formula><mml:math id="inf105"><mml:mrow><mml:mn>10</mml:mn><mml:mo>×</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula> movies.</p><p>Plots of the phase differences measured for each of the nine holes clearly show the effects of beam tilt at higher resolution (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). Smaller phase shifts in the opposite direction at intermediate resolution indicate that during refinement, the images have shifted off-center in an attempt to compensate for the beam tilt-induced phase shifts. A third round of refinement with correction for the estimated beam tilts improved the resolution to 2.2 Å. Plots of the estimated beam tilt against the beam-shift recorded by serialEM (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>) revealed a linear relationship of 0.19 mrad of beam tilt per <inline-formula><mml:math id="inf106"><mml:mi>μ</mml:mi></mml:math></inline-formula>m of beam-shift in both the X and Y directions. We then also ran a fourth refinement, where we predicted the beam tilt for each movie separately based on the recorded beam-shift values by serial EM. This resulted in a resolution of 2.2 Å. Features in the reconstructed density confirmed the improvement in resolution caused by beam tilt correction (<xref ref-type="fig" rid="fig4">Figure 4C</xref>). These results illustrate that beam tilt estimation and correction in RELION-3 may be a feasible alternative to active beam tilt compensation at the microscope. Future studies will need to explore which of these methods is preferable under different experimental conditions.</p><fig-group><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.007</object-id><label>Figure 4.</label><caption><title>Beam tilt correction (<bold>A</bold>) FSC curves between independently refined half-maps for the different stages of processing as explained in the main text.</title><p>(<bold>B</bold>) As in A, but FSC curves are between the cryo-EM maps and the corresponding atomic model (PDB-2W0O) (<xref ref-type="bibr" rid="bib12">de Val et al., 2012</xref>). (<bold>C</bold>) Representative density features from the 2.2 Å map from the data set with active beam tilt compensation (left); the 2.9 Å map from the data set without active beam tilt compensation and without beam tilt correction (middle); and the 2.2 Å map from the data set without active beam tilt compensation but with beam tilt correction (right).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig4-v2"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.008</object-id><label>Figure 4—figure supplement 1.</label><caption><title>The average per-pixel phase differences (in radiants) between reference projections and the individual experimental particle images (i.e. the phase angle of <inline-formula><mml:math id="inf107"><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ8">Equation 8</xref>).</title><p>The nine plots correspond to subsets of images collected at the nine different holes without active beam-tilt compensation. Note that the applied beam shift values have been recorded in stage coordinates giving a 175 degree X-axis rotation for the magnification used, which is reflected in the relative position of the nine plots. The inside regions showing the opposite slope to the global trend result from a systematic error in particle alignment caused by beam tilt.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig4-figsupp1-v2"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.009</object-id><label>Figure 4—figure supplement 2.</label><caption><title>The estimated beam tilt is plotted against the beam-shift values from serialEM in the X-direction (black circles) and in the Y-direction (red circles).</title><p>Linear fits through these points indicate there is 0.19 mrad of beam tilt for each <inline-formula><mml:math id="inf108"><mml:mi>μ</mml:mi></mml:math></inline-formula>m of beam shift.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig4-figsupp2-v2"/></fig></fig-group></sec><sec id="s3-4"><title>Ewald sphere correction</title><p>Ewald sphere correction has also been largely ignored, although a few contributions have recently described high-resolution reconstructions where Ewald sphere correction did make a difference (<xref ref-type="bibr" rid="bib52">Tan et al., 2018</xref>; <xref ref-type="bibr" rid="bib64">Zhu et al., 2018</xref>). To test our Ewald-sphere correction implementation, we used particle images of the P22 virion capsid protein (<xref ref-type="bibr" rid="bib23">Hryc et al., 2017</xref>), which we downloaded from EMPIAR-10083 (<xref ref-type="bibr" rid="bib24">Iudin et al., 2016</xref>). The diameter of the P22 virion is approximately 700 Å, which leads to an estimated resolution limit of 3.1 Å due to Ewald sphere curvature (<xref ref-type="bibr" rid="bib13">DeRosier, 2000</xref>). To reduce memory consumption and to accelerate the processing, we down-sampled the particles to 1.54 Å/pixel, and skipped Fourier padding during refinement. As we did not have access to the original micrographs, we used the defocus parameters for 45,150 particles as they were refined by JSPR in the original publication, which were kindly provided by Wah Chiu. We ignored variations in magnification as estimated by JSPR, because magnification correction is not implemented in RELION-3. Standard 3D auto-refinement, with correction for an estimated beam tilt of 0.6 mrad in X and −0.13 mrad in Y, gave a reconstruction with an estimated resolution of 3.5 Å (<xref ref-type="fig" rid="fig5">Figure 5A,B</xref>). Subsequent Ewald sphere correction improved this to 3.3 Å. Features in the reconstructed density confirmed the improvement in resolution caused by beam tilt correction (<xref ref-type="fig" rid="fig5">Figure 5C</xref>). Ewald sphere correction with the opposite curvature gave only 3.9 Å. In theory, if one knows the number of mirroring operations during data acquisition and image processing, Ewald sphere correction could therefore also be used to determine the absolute hand of a structure. However, at the resolutions where Ewald sphere correction matters, this is often no longer a relevant question.</p><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.010</object-id><label>Figure 5.</label><caption><title>Ewald sphere correction (<bold>A</bold>) FSC curves between independently refined half-maps without Ewald sphere correction (grey); with Ewald sphere correction with the correct curvature (green) and with Ewald sphere correction with the inverse curvature (orange).</title><p>(<bold>B</bold>) As in A, but FSC curves are between the cryo-EM and the corresponding atomic model (PDB-5UU5) (<xref ref-type="bibr" rid="bib23">Hryc et al., 2017</xref>). (<bold>C</bold>) Representative density features without Ewald sphere correction (grey) with Ewald sphere correction and the correct curvature (green) and with Ewald sphere correction and the reverse curvature (orange).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig5-v2"/></fig></sec><sec id="s3-5"><title>Non-interactive data exploration</title><p>To illustrate the general applicability of the <monospace>relion_it.py</monospace> script, we re-processed our previously published <inline-formula><mml:math id="inf109"><mml:mi>γ</mml:mi></mml:math></inline-formula>-secretase data set (<xref ref-type="bibr" rid="bib3">Bai et al., 2015b</xref>; <xref ref-type="bibr" rid="bib2">Bai et al., 2015a</xref>), which we deposited at EMPIAR-10194. We chose this data set as a representative of a non-straightforward data set, as <inline-formula><mml:math id="inf110"><mml:mi>γ</mml:mi></mml:math></inline-formula>-secretase is a small (130 kDa ordered mass), asymmetrical, membrane-embedded protein complex.</p><p>Using default parameters, we performed motion correction of the 2,925 16-frame movies in our own implementation of the MotionCor2 algorithm, and estimated CTF parameters in Gctf (<xref ref-type="bibr" rid="bib62">Zhang, 2016</xref>). LoG-based picking (with <inline-formula><mml:math id="inf111"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>120</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf112"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>180</mml:mn></mml:mrow></mml:math></inline-formula>) at the default threshold led to 2.6 million particles (<xref ref-type="fig" rid="fig6">Figure 6A</xref>), which were divided in batches of 10,000 particles. Only the first batch was used for 2D classification, which revealed the presence of different views of the complex (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). The script could have run similar 2D classification on all batches, for example to monitor data quality during data acquisition.</p><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.011</object-id><label>Figure 6.</label><caption><title>Non-interactive data pre-processing.</title><p>(<bold>A</bold>) Particle positions as selected by the LoG-based auto-picking algorithm are shown as yellow dots. (<bold>B</bold>) The 2D class averages for the eight largest classes after LoG-based autopicking of the first batch of 10,000 particles. (<bold>C</bold>) 3D models generated by the script: after SGD initial model generation (left), and after 3D classification for the largest class (middle) and the second largest class (right). The two maps after 3D classification are thresholded at the same intensity level. (<bold>D</bold>) FSC curves between independently refined half-maps for EMD-3061 (grey), for the map obtained after non-interactive pre-processing (orange) and for the map obtained after processing of the originally published subset of particles in RELION-3. (<bold>E</bold>) FSC curves between PDB-5A63 and the same maps as in D. (<bold>F</bold>) Representative density features for the maps in E and F.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig6-v2"/></fig><p>Instead, we chose to let the script proceed with SGD initial model generation and 3D classification on the same batch of 10,000 particles (<xref ref-type="fig" rid="fig6">Figure 6C</xref>). After 3D classification, the script automatically selects the 3D class with the highest resolution reconstruction. As all four classes had an equal resolution of 23 Å, the script selected the largest class (with an accumulated weight of 34.5%). However, the second largest class (with an accumulated weight of 34.4%) was actually the correct structure, which was obvious from a visual inspection of the density (<xref ref-type="fig" rid="fig6">Figure 6C</xref>). At this stage, we intervened. We stopped the script and edited the file <monospace>RELION_IT_2NDPASS_3DREF</monospace> to point to the correct map. This intervention probably reflects the weakest point in our otherwise non-interactive procedure. Robust, non-interactive selection of 3D class reconstructions (or 2D class averages) is a subject of ongoing research in our groups.</p><p>Upon re-starting the script, template-based auto-picking with the correct 3D structure and the default threshold (0.4) led to 1.8 million particles, which were then used for 2D classification into 200 classes. At this point, the non-interactive script finished and the rest of the data processing was performed manually. Selection of the best 2D class averages led to a subset comprising 665,102 particles, which were subjected to Bayesian particle polishing and two rounds of 3D classification into eight classes. Two classes, comprising 333,377 particles, were selected for refinement of the per-particle defocus values and separate estimations of the beam tilt in the six microscopy sessions that this data set comprises. A second 3D classification yielded a majority class with 240,777 particles, which led to a final resolution of 3.3 Å (<xref ref-type="fig" rid="fig6">Figure 6E–G</xref>).</p><p>When we originally processed this data set in RELION-1.3, we obtained a map at 3.4 Å resolution from 159,549 particles, which were selected after 3D classification of 412,272 polished particles (<xref ref-type="bibr" rid="bib3">Bai et al., 2015b</xref>). This set of particles was obtained through careful tuning of template-based auto-picking parameters for each of the six microscopy sessions, and careful selection of 2D and 3D classes. To assess whether the non-interactive pre-processing procedure can compete with this expert-driven approach, we used the same set of 412,272 particles also for Bayesian polishing, refinement of per-particle defocus values, beam tilt estimation and 3D classification. The resulting selection of 246,602 particles gave a final resolution of 3.2 Å (<xref ref-type="fig" rid="fig6">Figure 6E–G</xref>). The improvement from 3.4 Å to 3.2 Å represents the contribution of the new functionality in RELION-3, whereas the gain from 3.3 Å to 3.2 Å represents the added value of the expert user. However, the map from the automatically pre-processed data does not correlate with the atomic model as well as one would expect from the half-map FSC curves. This suggests a higher fraction of false positives in the data resulting from the <monospace>relion_it.py</monospace> script compared to the expert selection, which may be caused by the relatively low default for the auto-picking threshold in the script. These results illustrate that non-interactive pre-processing gets close to the performance of a human expert, but for challenging data sets there is still a benefit in careful tuning of parameters. Future investigations will aim to reduce this gap.</p></sec><sec id="s3-6"><title>High-resolution refinement I: <inline-formula><mml:math id="inf113"><mml:mi>β</mml:mi></mml:math></inline-formula>-galactosidase</title><p>To illustrate the combined effects of the RELION-3 implementation on high-resolution structure determination, we re-processed the <inline-formula><mml:math id="inf114"><mml:mi>β</mml:mi></mml:math></inline-formula>-galactosidase data set at EMPIAR-10061 (<xref ref-type="bibr" rid="bib4">Bartesaghi et al., 2015</xref>) that we also used to illustrate RELION-2.0 (<xref ref-type="bibr" rid="bib26">Kimanius et al., 2016</xref>). This data set was made available to the community by the Subramaniam group. Using RELION-2.0, we previously obtained a 2.2 Å resolution reconstruction (EMD-4116).</p><p>We aligned the original, super-resolution movies using the UCSF implementation of MotionCor2 (version 1.0.5) (<xref ref-type="bibr" rid="bib63">Zheng et al., 2017</xref>) in four by four patches with dose weighting and two-fold binning. CTF parameters were estimated using CTFFIND 4.1.10 (<xref ref-type="bibr" rid="bib42">Rohou and Grigorieff, 2015</xref>). We initially picked 4084 particles using the LoG-based algorithm from a subset of 462 movies and classified these particles into 20 2D classes. Six of the resulting 2D class averages were used for template-based auto-picking of 229,553 particles from the entire data set. After an initial 2D classification into 200 classes, we chose to reject only the most obvious outliers, resulting in a data set of 217,752 particles. Although many of the selected particles were probably sub-optimal, we chose to keep them until the Bayesian polishing step, where relatively high particle numbers per micrograph may improve the description of the motion tracks. An initial 3D auto-refinement with these particles yielded a map with an estimated resolution of 2.3 Å (<xref ref-type="fig" rid="fig7">Figure 7A,B</xref>). Re-refining the same data set after only per-particle defocus refinement or beam tilt estimation improved the resolution to 2.2 in both cases. Application of both methods gave 2.1 Å resolution. We then performed Bayesian polishing, which gave 1.94 Å, and classified the resulting shiny particles into six classes. The 134,900 particles that contributed to the three best 3D classes were then re-refined to 1.92 Å resolution. A second round of per-particle defocus refinement and beam tilt estimation, followed by another 3D auto-refinement yielded a final resolution of 1.90 Å. Ewald sphere correction for this data set did not improve the resolution by at least one Fourier shell, although a small increase in FSC values near the estimated resolution was visible. The reconstructed density showed features that one would expect at this resolution (<xref ref-type="fig" rid="fig7">Figure 7C</xref>). FSC curves between the maps and PDB-5A1A confirmed that RELION-3 improved resolution by 0.3 Å compared to RELION-2.0 (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>). Application of the <monospace>bfactor_plot.py</monospace> script produced an estimate for the overall B-factor of 56 Å<sup>2</sup> (<xref ref-type="fig" rid="fig7s2">Figure 7—figure supplement 2</xref>). By extrapolation, the script predicts a resolution of 1.75 Å when using four times more particles, and 1.69 Å when using eight times more particles.</p><fig-group><fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.012</object-id><label>Figure 7.</label><caption><title>High-resolution refinement: <inline-formula><mml:math id="inf115"><mml:mi>β</mml:mi></mml:math></inline-formula>-galactosidase (<bold>A</bold>) FSC curves between independently refined half-maps for the different stages of processing as explained in the main text.</title><p>(<bold>B</bold>) FSC curves between PDB-5A1A and the maps at the same stages of processing as in A. (<bold>C</bold>) Representative density features for some of the maps for which FSC curves are shown in A and B.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig7-v2"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.013</object-id><label>Figure 7—figure supplement 1.</label><caption><title>FSC curves between PDB-5A1A and EMD-4116, EMD-7770 and the new map reconstructed in RELION-3.</title></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig7-figsupp1-v2"/></fig><fig id="fig7s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.014</object-id><label>Figure 7—figure supplement 2.</label><caption><title>The B-factor plot that was generated automatically by the bfactor_plot.py script.</title><p>The script performed nine 3D refinement and post-processing jobs with subsets of increasing sizes for the beta-galactosidase data set. Fitting a straight line through the inverse of the resolution squared of each refinement against the natural logarithm of the number of particles in the corresponding subset yielded an estimated B-factor of 56 Å<sup>2</sup>.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig7-figsupp2-v2"/></fig></fig-group><p>Recently, the Subramaniam group also re-processed this data set using new methods for defocus estimation, motion correction and radiation damage weighting (<xref ref-type="bibr" rid="bib5">Bartesaghi et al., 2018</xref>). The resulting map (EMD-7770) was reported as an atomic resolution structure. The resolution according to the 0.143 FSC criterion was 1.9 Å. Despite the same nominal resolution of 1.9 Å, the RELION-3 map correlated with PDB-5A1A to 0.15 Å higher resolution than EMD-7770 (<xref ref-type="fig" rid="fig7s2">Figure 7—figure supplement 2</xref>). In <xref ref-type="bibr" rid="bib5">Bartesaghi et al. (2018)</xref> it is argued that the FSC curves may under-estimate the true resolution of cryo-EM maps, and a point is made for showing figures of high-resolution density features to claim atomic resolution instead. We disagree. The high-resolution figures in that paper were made using a map that was sharpened to resolutions well beyond the true resolution, resulting in high levels of noise. This noise was subsequently removed from regions outside the protein density with a high-resolution mask. As this noise still exists within the protein region, the resulting map is prone to incorrect interpretations. FSC curves between half-maps and between model and map are not without their own problems. They do not account for modelling errors or local variations in resolution, and they can be inflated by overfitting or the use of suboptimal masks. Nevertheless, provided suitably soft and low-resolution masks are used and care is taken to avoid overfitting (<xref ref-type="bibr" rid="bib47">Scheres and Chen, 2012</xref>; <xref ref-type="bibr" rid="bib9">Brown et al., 2015</xref>), FSC curves provide an objective overall assessment of map quality. Discarding this information in favour of a few selected density figures would be a mistake.</p></sec><sec id="s3-7"><title>High-resolution refinement II: human apo-ferritin</title><p>For a final illustration of the combined functionality in RELION-3, we processed a data set on a human apo-ferritin sample, which was a gift from Fei Sun. These data were collected on the same K2 detector and Titan Krios microscope as the horse spleen apo-ferritin data set in section 3.3. We used serialEM to record seven images per hole in the R2/2 Quantifoil grid, before moving the stage to the next hole. Movies with a total dose of 47 electrons per Å<inline-formula><mml:math id="inf116"><mml:msup><mml:mi/><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> were fractionated into 40 frames with a pixel size of 0.814 Å. We have deposited these data at EMPIAR-10200.</p><p>We again used the <monospace>relion_it.py</monospace> script for non-interactive pre-processing of the data. Using default parameters, the script launched motion correction of the 1255 40-frame movies in our own implementation of the MotionCor2 algorithm, and estimated CTF parameters in Gctf (<xref ref-type="bibr" rid="bib62">Zhang, 2016</xref>). LoG-based picking (with <inline-formula><mml:math id="inf117"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>110</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf118"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>150</mml:mn></mml:mrow></mml:math></inline-formula>) at the default threshold led to 723,524 particles, which were divided in batches of 10,000 particles. Only the first batch was used for initial model generation and 3D classification. Automated selection of the highest resolution 3D class (at 6.5 Å) yielded a good apo-ferritin model, which was used for template-based auto-picking using the default (0.4) threshold. The resulting 427,694 particles were used for 2D classification into 200 classes.</p><p>We then proceeded processing in an interactive manner. Selection of suitable 2D class averages led to a subset of 426,450 particles, which were subjected to Bayesian polishing and per-particle defocus refinement. A final 3D refinement yielded a resolution of 1.65 Å, which is two resolution shells below the Nyquist frequency (<xref ref-type="fig" rid="fig8">Figure 8A,B</xref>). Estimation of the beam tilt yielded values below 0.1 mrad, and refinement with these values did not improve the map. As expected at this resolution, the map shows spherical-like features around some of the atoms (<xref ref-type="fig" rid="fig8">Figure 8C</xref>). However, as these are not yet separated, it would be a stretch to call this an atomic resolution structure. Application of the <monospace>bfactor_plot.py</monospace> script produced an estimate for the overall B-factor of 66 Å<sup>2</sup>﻿ (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref>).</p><fig-group><fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.42166.015</object-id><label>Figure 8.</label><caption><title>High-resolution refinement: apo-ferritin (<bold>A</bold>) FSC curves between independently refined half-maps at different stages of the processing.</title><p>(<bold>B</bold>) FSC curves between PDB-5N27 (<xref ref-type="bibr" rid="bib17">Ferraro et al., 2017</xref>) and the cryo-EM map at different stages of the processing. (<bold>C</bold>) Representative density features at different stages of the processing.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig8-v2"/></fig><fig id="fig8s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.42166.016</object-id><label>Figure 8—figure supplement 1.</label><caption><title>The B-factor plot that was generated automatically by the bfactor_plot.py script.</title><p>The script performed ten 3D refinement and post-processing jobs with subsets of increasing sizes for the high-resolution apo-ferritin data set. Fitting a straight line through the inverse of the resolution squared of each refinement against the natural logarithm of the number of particles in the corresponding subset yielded an estimated B-factor of 66 Å<sup>2</sup>.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-42166-fig8-figsupp1-v2"/></fig></fig-group><p>Besides the selection of suitable 2D and 3D classes, which as mentioned is a topic of ongoing research in our groups, all of the calculations performed to yield this map could be incorporated into an extended version of the <monospace>relion_it.py</monospace> script. Thereby, completely automated, high-resolution cryo-EM structure determination of relatively straightforward samples like apo-ferritin is within close reach. This will be useful for the standardised processing of data sets on test samples to assess microscope performance. In the future, improved versions of procedures like this may facilitate high-throughput cryo-EM structure determination, for example for the screening of small-molecule compounds bound to drug targets.</p></sec><sec id="s3-8"><title>Conclusions</title><p>The new functionality in RELION-3 allows faster, more automated and higher resolution cryo-EM structure determination compared to previous versions. CPU acceleration makes it possible to use a much wider range of hardware efficiently for RELION, including laptops and desktops, and it avoids the box size limits still present when offloading to GPU accelerators. The functionality to schedule and execute jobs from the command-line, coupled with python scripting, provides a versatile and extendable platform to standardise and automate complicated tasks. Corrections for per-particle defocus variations, beam tilt and the Ewald sphere already improve resolutions for currently available data sets, and will become even more important as the resolutions of typical cryo-EM structures improve in the future. RELION is distributed under the GNU General Public License (GPL, version 2), meaning it is completely free to use or modify by anyone, which we hope will maximise its usefulness to the community.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank Charles W Congdon from Intel for extensive assistance with implementing the accelerated CPU code; Chris Russo and Richard Henderson for helpful discussions; and Jake Grimmett, Toby Darling and Stefan Fleischmann for help with high-performance computing. This work was funded by the UK Medical Research Council (MC_UP_A025_1013 to SHWS); the Swiss National Science Foundation (SNF: P2BSP2 168735 to JZ); the Japan Society for the Promotion of Science (Overseas Research Fellowship to TN); the Swedish Research Council (2017–04641 to EL) and the Knut and Alice Wallenberg Foundation (to EL).</p></ack><sec id="s4" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf2"><p>Reviewing editor, <italic>eLife</italic></p></fn><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Software, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Data curation, Software, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Software, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Software, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Resources, Formal analysis, Investigation, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Software, Formal analysis, Supervision, Investigation, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Data curation, Software, Formal analysis, Supervision, Funding acquisition, Validation, Investigation, Visualization, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s5" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.42166.017</object-id><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-42166-transrepform-v2.docx"/></supplementary-material><sec id="s6" sec-type="data-availability"><title>Data availability</title><p>We mostly use publicly available data sets from the EMPIAR data base at EMBL-EBI. For this study, we have submitted to this data base our own data on the human gamma-secretase complex (EMPIAR-10194) and on the high-resolution apo-ferritin sample described in the text (EMPIAR-10200).</p><p>The following datasets were generated:</p><p><element-citation id="dataset1" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Bai</surname><given-names>XC</given-names></name><name><surname>Scheres</surname><given-names>SHW</given-names></name><name><surname>Bai</surname><given-names>XC</given-names></name><name><surname>Yan</surname><given-names>C</given-names></name><name><surname>Yang</surname><given-names>G</given-names></name><name><surname>Lu</surname><given-names>P</given-names></name><name><surname>Ma</surname><given-names>D</given-names></name><name><surname>Sun</surname><given-names>L</given-names></name><name><surname>Zhou</surname><given-names>R</given-names></name><name><surname>Shi</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>An atomic structure of human gamma-secretase [2925 multi-frame micrographs composed of 20 frames each in MRCS format]</data-title><source>Electron Microscopy Public Image Archive</source><pub-id assigning-authority="EBI" pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10194/">EMPIAR-10194</pub-id></element-citation></p><p><element-citation id="dataset2" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Zivanov</surname><given-names>J</given-names></name><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Hagen</surname><given-names>WJH</given-names></name><name><surname>Scheres</surname><given-names>SHW</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Human apo-ferritin reconstructed in RELION-3.0</data-title><source>Electron Microscopy Public Image Archive</source><pub-id assigning-authority="EBI" pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10200/">EMPIAR-10200</pub-id></element-citation></p><p>The following previously published datasets were used:</p><p><element-citation id="dataset3" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Bartesaghi</surname><given-names>A</given-names></name><name><surname>Merk</surname><given-names>A</given-names></name><name><surname>Banerjee</surname><given-names>S</given-names></name><name><surname>Matthies</surname><given-names>D</given-names></name><name><surname>Wu</surname><given-names>X</given-names></name><name><surname>Milne</surname><given-names>JL</given-names></name><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><data-title>2.2 A resolution cryo-EM structure of beta-galactosidase in complex with a cell-permeant inhibitor</data-title><source>Electron Microscopy Public Image Archive</source><pub-id assigning-authority="EBI" pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10061/">EMPIAR-10061</pub-id></element-citation></p><p><element-citation id="dataset4" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Tan</surname><given-names>YZ</given-names></name><name><surname>Lyumkis</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>40 Degree Tilted Single-Particle CryoEM of Highly Preferred Orientated Influenza Hemagglutinin Trimer</data-title><source>Electron Microscopy Public Image Archive</source><pub-id assigning-authority="EBI" pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10097/">EMPIAR-10097</pub-id></element-citation></p><p><element-citation id="dataset5" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>DH</given-names></name><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Jakana</surname><given-names>J</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Haase-Pettingell</surname><given-names>C</given-names></name><name><surname>Jiang</surname><given-names>W</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name><name><surname>King</surname><given-names>JA</given-names></name><name><surname>Schmid</surname><given-names>MF</given-names></name><name><surname>Chiu</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>Bacteriophage P22 mature virion capsid protein</data-title><source>Electron Microscopy Public Image Archive</source><pub-id assigning-authority="EBI" pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10083/">EMPIAR-10083</pub-id></element-citation></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abrishami</surname> <given-names>V</given-names></name><name><surname>Vargas</surname> <given-names>J</given-names></name><name><surname>Li</surname> <given-names>X</given-names></name><name><surname>Cheng</surname> <given-names>Y</given-names></name><name><surname>Marabini</surname> <given-names>R</given-names></name><name><surname>Sorzano</surname> <given-names>CÓ</given-names></name><name><surname>Carazo</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Alignment of direct detection device micrographs using a robust Optical Flow approach</article-title><source>Journal of Structural Biology</source><volume>189</volume><fpage>163</fpage><lpage>176</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2015.02.001</pub-id><pub-id pub-id-type="pmid">25681631</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname> <given-names>XC</given-names></name><name><surname>Rajendra</surname> <given-names>E</given-names></name><name><surname>Yang</surname> <given-names>G</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2015">2015a</year><article-title>Sampling the conformational space of the catalytic subunit of human gamma-secretase</article-title><source>eLife</source><volume>4</volume><elocation-id>e11182</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.11182</pub-id><pub-id pub-id-type="pmid">26623517</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname> <given-names>XC</given-names></name><name><surname>Yan</surname> <given-names>C</given-names></name><name><surname>Yang</surname> <given-names>G</given-names></name><name><surname>Lu</surname> <given-names>P</given-names></name><name><surname>Ma</surname> <given-names>D</given-names></name><name><surname>Sun</surname> <given-names>L</given-names></name><name><surname>Zhou</surname> <given-names>R</given-names></name><name><surname>Scheres</surname> <given-names>SHW</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015b</year><article-title>An atomic structure of human γ-secretase</article-title><source>Nature</source><volume>525</volume><fpage>212</fpage><lpage>217</lpage><pub-id pub-id-type="doi">10.1038/nature14892</pub-id><pub-id pub-id-type="pmid">26280335</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartesaghi</surname> <given-names>A</given-names></name><name><surname>Merk</surname> <given-names>A</given-names></name><name><surname>Banerjee</surname> <given-names>S</given-names></name><name><surname>Matthies</surname> <given-names>D</given-names></name><name><surname>Wu</surname> <given-names>X</given-names></name><name><surname>Milne</surname> <given-names>JL</given-names></name><name><surname>Subramaniam</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>2.2 Å resolution cryo-EM structure of β-galactosidase in complex with a cell-permeant inhibitor</article-title><source>Science</source><volume>348</volume><fpage>1147</fpage><lpage>1151</lpage><pub-id pub-id-type="doi">10.1126/science.aab1576</pub-id><pub-id pub-id-type="pmid">25953817</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartesaghi</surname> <given-names>A</given-names></name><name><surname>Aguerrebere</surname> <given-names>C</given-names></name><name><surname>Falconieri</surname> <given-names>V</given-names></name><name><surname>Banerjee</surname> <given-names>S</given-names></name><name><surname>Earl</surname> <given-names>LA</given-names></name><name><surname>Zhu</surname> <given-names>X</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name><name><surname>Milne</surname> <given-names>JLS</given-names></name><name><surname>Sapiro</surname> <given-names>G</given-names></name><name><surname>Wu</surname> <given-names>X</given-names></name><name><surname>Subramaniam</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Atomic Resolution Cryo-EM Structure of β-Galactosidase</article-title><source>Structure</source><volume>26</volume><fpage>848</fpage><lpage>856</lpage><pub-id pub-id-type="doi">10.1016/j.str.2018.04.004</pub-id><pub-id pub-id-type="pmid">29754826</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bharat</surname> <given-names>TAM</given-names></name><name><surname>Russo</surname> <given-names>CJ</given-names></name><name><surname>Löwe</surname> <given-names>J</given-names></name><name><surname>Passmore</surname> <given-names>LA</given-names></name><name><surname>Scheres</surname> <given-names>SHW</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Advances in Single-Particle Electron Cryomicroscopy Structure Determination applied to Sub-tomogram Averaging</article-title><source>Structure</source><volume>23</volume><fpage>1743</fpage><lpage>1753</lpage><pub-id pub-id-type="doi">10.1016/j.str.2015.06.026</pub-id><pub-id pub-id-type="pmid">26256537</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Biyani</surname> <given-names>N</given-names></name><name><surname>Righetto</surname> <given-names>RD</given-names></name><name><surname>McLeod</surname> <given-names>R</given-names></name><name><surname>Caujolle-Bert</surname> <given-names>D</given-names></name><name><surname>Castano-Diez</surname> <given-names>D</given-names></name><name><surname>Goldie</surname> <given-names>KN</given-names></name><name><surname>Stahlberg</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Focus: The interface between data collection and data processing in cryo-EM</article-title><source>Journal of Structural Biology</source><volume>198</volume><fpage>124</fpage><lpage>133</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2017.03.007</pub-id><pub-id pub-id-type="pmid">28344036</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brilot</surname> <given-names>AF</given-names></name><name><surname>Chen</surname> <given-names>JZ</given-names></name><name><surname>Cheng</surname> <given-names>A</given-names></name><name><surname>Pan</surname> <given-names>J</given-names></name><name><surname>Harrison</surname> <given-names>SC</given-names></name><name><surname>Potter</surname> <given-names>CS</given-names></name><name><surname>Carragher</surname> <given-names>B</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Beam-induced motion of vitrified specimen on holey carbon film</article-title><source>Journal of Structural Biology</source><volume>177</volume><fpage>630</fpage><lpage>637</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2012.02.003</pub-id><pub-id pub-id-type="pmid">22366277</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname> <given-names>A</given-names></name><name><surname>Long</surname> <given-names>F</given-names></name><name><surname>Nicholls</surname> <given-names>RA</given-names></name><name><surname>Toots</surname> <given-names>J</given-names></name><name><surname>Emsley</surname> <given-names>P</given-names></name><name><surname>Murshudov</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Tools for macromolecular model building and refinement into electron cryo-microscopy reconstructions</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>71</volume><fpage>136</fpage><lpage>153</lpage><pub-id pub-id-type="doi">10.1107/S1399004714021683</pub-id><pub-id pub-id-type="pmid">25615868</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Cheng</surname> <given-names>A</given-names></name><name><surname>Eng</surname> <given-names>ET</given-names></name><name><surname>Alink</surname> <given-names>L</given-names></name><name><surname>Rice</surname> <given-names>WJ</given-names></name><name><surname>Jordan</surname> <given-names>KD</given-names></name><name><surname>Kim</surname> <given-names>LY</given-names></name><name><surname>Potter</surname> <given-names>CS</given-names></name><name><surname>Carragher</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>High Resolution Single Particle Cryo-Electron Microscopy using Beam-Image Shift</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/306241</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de la Rosa-Trevín</surname> <given-names>JM</given-names></name><name><surname>Quintana</surname> <given-names>A</given-names></name><name><surname>Del Cano</surname> <given-names>L</given-names></name><name><surname>Zaldívar</surname> <given-names>A</given-names></name><name><surname>Foche</surname> <given-names>I</given-names></name><name><surname>Gutiérrez</surname> <given-names>J</given-names></name><name><surname>Gómez-Blanco</surname> <given-names>J</given-names></name><name><surname>Burguet-Castell</surname> <given-names>J</given-names></name><name><surname>Cuenca-Alba</surname> <given-names>J</given-names></name><name><surname>Abrishami</surname> <given-names>V</given-names></name><name><surname>Vargas</surname> <given-names>J</given-names></name><name><surname>Otón</surname> <given-names>J</given-names></name><name><surname>Sharov</surname> <given-names>G</given-names></name><name><surname>Vilas</surname> <given-names>JL</given-names></name><name><surname>Navas</surname> <given-names>J</given-names></name><name><surname>Conesa</surname> <given-names>P</given-names></name><name><surname>Kazemi</surname> <given-names>M</given-names></name><name><surname>Marabini</surname> <given-names>R</given-names></name><name><surname>Sorzano</surname> <given-names>CO</given-names></name><name><surname>Carazo</surname> <given-names>JM</given-names></name><name><surname>OtÃ³n</surname> <given-names>G</given-names></name><name><surname>Sharov</surname> <given-names>JL</given-names></name><name><surname>Marabini</surname> <given-names>COS</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Scipion: A software framework toward integration, reproducibility and validation in 3D electron microscopy</article-title><source>Journal of Structural Biology</source><volume>195</volume><fpage>93</fpage><lpage>99</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2016.04.010</pub-id><pub-id pub-id-type="pmid">27108186</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Val</surname> <given-names>N</given-names></name><name><surname>Declercq</surname> <given-names>JP</given-names></name><name><surname>Lim</surname> <given-names>CK</given-names></name><name><surname>Crichton</surname> <given-names>RR</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Structural analysis of haemin demetallation by L-chain apoferritins</article-title><source>Journal of Inorganic Biochemistry</source><volume>112</volume><fpage>77</fpage><lpage>84</lpage><pub-id pub-id-type="doi">10.1016/j.jinorgbio.2012.02.031</pub-id><pub-id pub-id-type="pmid">22561545</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DeRosier</surname> <given-names>DJ</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Correction of high-resolution data for curvature of the Ewald sphere</article-title><source>Ultramicroscopy</source><volume>81</volume><fpage>83</fpage><lpage>98</lpage><pub-id pub-id-type="doi">10.1016/S0304-3991(99)00120-5</pub-id><pub-id pub-id-type="pmid">10998793</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eades</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Obtaining TEM images with a uniform deviation parameter</article-title><source>Ultramicroscopy</source><volume>106</volume><fpage>432</fpage><lpage>438</lpage><pub-id pub-id-type="doi">10.1016/j.ultramic.2005.12.002</pub-id><pub-id pub-id-type="pmid">16442733</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ekiert</surname> <given-names>DC</given-names></name><name><surname>Kashyap</surname> <given-names>AK</given-names></name><name><surname>Steel</surname> <given-names>J</given-names></name><name><surname>Rubrum</surname> <given-names>A</given-names></name><name><surname>Bhabha</surname> <given-names>G</given-names></name><name><surname>Khayat</surname> <given-names>R</given-names></name><name><surname>Lee</surname> <given-names>JH</given-names></name><name><surname>Dillon</surname> <given-names>MA</given-names></name><name><surname>O'Neil</surname> <given-names>RE</given-names></name><name><surname>Faynboym</surname> <given-names>AM</given-names></name><name><surname>Horowitz</surname> <given-names>M</given-names></name><name><surname>Horowitz</surname> <given-names>L</given-names></name><name><surname>Ward</surname> <given-names>AB</given-names></name><name><surname>Palese</surname> <given-names>P</given-names></name><name><surname>Webby</surname> <given-names>R</given-names></name><name><surname>Lerner</surname> <given-names>RA</given-names></name><name><surname>Bhatt</surname> <given-names>RR</given-names></name><name><surname>Wilson</surname> <given-names>IA</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Cross-neutralization of influenza A viruses mediated by a single antibody loop</article-title><source>Nature</source><volume>489</volume><fpage>526</fpage><lpage>532</lpage><pub-id pub-id-type="doi">10.1038/nature11414</pub-id><pub-id pub-id-type="pmid">22982990</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernandez-Leiro</surname> <given-names>R</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Unravelling biological macromolecules with cryo-electron microscopy</article-title><source>Nature</source><volume>537</volume><fpage>339</fpage><lpage>346</lpage><pub-id pub-id-type="doi">10.1038/nature19948</pub-id><pub-id pub-id-type="pmid">27629640</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ferraro</surname> <given-names>G</given-names></name><name><surname>Ciambellotti</surname> <given-names>S</given-names></name><name><surname>Messori</surname> <given-names>L</given-names></name><name><surname>Merlino</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Cisplatin Binding Sites in Human H-Chain Ferritin</article-title><source>Inorganic Chemistry</source><volume>56</volume><fpage>9064</fpage><lpage>9070</lpage><pub-id pub-id-type="doi">10.1021/acs.inorgchem.7b01072</pub-id><pub-id pub-id-type="pmid">28737381</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Glaeser</surname> <given-names>RM</given-names></name><name><surname>Typke</surname> <given-names>D</given-names></name><name><surname>Tiemeijer</surname> <given-names>PC</given-names></name><name><surname>Pulokas</surname> <given-names>J</given-names></name><name><surname>Cheng</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Precise beam-tilt alignment and collimation are required to minimize the phase error associated with coma in high-resolution cryo-EM</article-title><source>Journal of Structural Biology</source><volume>174</volume><fpage>1</fpage><lpage>10</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2010.12.005</pub-id><pub-id pub-id-type="pmid">21182964</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grant</surname> <given-names>T</given-names></name><name><surname>Rohou</surname> <given-names>A</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title><italic>cis</italic>TEM, user-friendly software for single-particle image processing</article-title><source>eLife</source><volume>7</volume><elocation-id>e35383</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.35383</pub-id><pub-id pub-id-type="pmid">29513216</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>FREALIGN: high-resolution refinement of single particle structures</article-title><source>Journal of Structural Biology</source><volume>157</volume><fpage>117</fpage><lpage>125</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2006.05.004</pub-id><pub-id pub-id-type="pmid">16828314</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hall</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="1991">1991</year><article-title>The STAR file: a new format for electronic data transfer and archiving</article-title><source>Journal of Chemical Information and Modeling</source><volume>31</volume><fpage>326</fpage><lpage>333</lpage><pub-id pub-id-type="doi">10.1021/ci00002a020</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname> <given-names>S</given-names></name><name><surname>Scheres</surname> <given-names>SHW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Helical reconstruction in RELION</article-title><source>Journal of Structural Biology</source><volume>198</volume><fpage>163</fpage><lpage>176</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2017.02.003</pub-id><pub-id pub-id-type="pmid">28193500</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hryc</surname> <given-names>CF</given-names></name><name><surname>Chen</surname> <given-names>DH</given-names></name><name><surname>Afonine</surname> <given-names>PV</given-names></name><name><surname>Jakana</surname> <given-names>J</given-names></name><name><surname>Wang</surname> <given-names>Z</given-names></name><name><surname>Haase-Pettingell</surname> <given-names>C</given-names></name><name><surname>Jiang</surname> <given-names>W</given-names></name><name><surname>Adams</surname> <given-names>PD</given-names></name><name><surname>King</surname> <given-names>JA</given-names></name><name><surname>Schmid</surname> <given-names>MF</given-names></name><name><surname>Chiu</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Accurate model annotation of a near-atomic resolution cryo-EM map</article-title><source>PNAS</source><volume>114</volume><fpage>3103</fpage><lpage>3108</lpage><pub-id pub-id-type="doi">10.1073/pnas.1621152114</pub-id><pub-id pub-id-type="pmid">28270620</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Iudin</surname> <given-names>A</given-names></name><name><surname>Korir</surname> <given-names>PK</given-names></name><name><surname>Salavert-Torres</surname> <given-names>J</given-names></name><name><surname>Kleywegt</surname> <given-names>GJ</given-names></name><name><surname>Patwardhan</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>EMPIAR: a public archive for raw electron microscopy image data</article-title><source>Nature Methods</source><volume>13</volume><fpage>387</fpage><lpage>388</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3806</pub-id><pub-id pub-id-type="pmid">27067018</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jiang</surname> <given-names>W</given-names></name><name><surname>Baker</surname> <given-names>ML</given-names></name><name><surname>Jakana</surname> <given-names>J</given-names></name><name><surname>Weigele</surname> <given-names>PR</given-names></name><name><surname>King</surname> <given-names>J</given-names></name><name><surname>Chiu</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Backbone structure of the infectious epsilon15 virus capsid revealed by electron cryomicroscopy</article-title><source>Nature</source><volume>451</volume><fpage>1130</fpage><lpage>1134</lpage><pub-id pub-id-type="doi">10.1038/nature06665</pub-id><pub-id pub-id-type="pmid">18305544</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimanius</surname> <given-names>D</given-names></name><name><surname>Forsberg</surname> <given-names>BO</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Lindahl</surname> <given-names>E</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Accelerated cryo-EM structure determination with parallelisation using GPUs in RELION-2</article-title><source>eLife</source><volume>5</volume><elocation-id>e18722</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.18722</pub-id><pub-id pub-id-type="pmid">27845625</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krivanek</surname> <given-names>OL</given-names></name><name><surname>Stadelmann</surname> <given-names>PA</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Effect of three-fold astigmatism on high resolution electron micrographs</article-title><source>Ultramicroscopy</source><volume>60</volume><fpage>103</fpage><lpage>113</lpage><pub-id pub-id-type="doi">10.1016/0304-3991(95)00050-B</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kucukelbir</surname> <given-names>A</given-names></name><name><surname>Sigworth</surname> <given-names>FJ</given-names></name><name><surname>Tagare</surname> <given-names>HD</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Quantifying the local resolution of cryo-EM density maps</article-title><source>Nature Methods</source><volume>11</volume><fpage>63</fpage><lpage>65</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2727</pub-id><pub-id pub-id-type="pmid">24213166</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuhlbrandt</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The Resolution Revolution</article-title><source>Science</source><volume>343</volume><fpage>1443</fpage><lpage>1444</lpage><pub-id pub-id-type="doi">10.1126/science.1251652</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname> <given-names>X</given-names></name><name><surname>Mooney</surname> <given-names>P</given-names></name><name><surname>Zheng</surname> <given-names>S</given-names></name><name><surname>Booth</surname> <given-names>CR</given-names></name><name><surname>Braunfeld</surname> <given-names>MB</given-names></name><name><surname>Gubbens</surname> <given-names>S</given-names></name><name><surname>Agard</surname> <given-names>DA</given-names></name><name><surname>Cheng</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Electron counting and beam-induced motion correction enable near-atomic-resolution single-particle cryo-EM</article-title><source>Nature Methods</source><volume>10</volume><fpage>584</fpage><lpage>590</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2472</pub-id><pub-id pub-id-type="pmid">23644547</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mastronarde</surname> <given-names>DN</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Automated electron microscope tomography using robust prediction of specimen movements</article-title><source>Journal of Structural Biology</source><volume>152</volume><fpage>36</fpage><lpage>51</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2005.07.007</pub-id><pub-id pub-id-type="pmid">16182563</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McLeod</surname> <given-names>RA</given-names></name><name><surname>Kowal</surname> <given-names>J</given-names></name><name><surname>Ringler</surname> <given-names>P</given-names></name><name><surname>Stahlberg</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Robust image alignment for cryogenic transmission electron microscopy</article-title><source>Journal of Structural Biology</source><volume>197</volume><fpage>279</fpage><lpage>293</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2016.12.006</pub-id><pub-id pub-id-type="pmid">28038834</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McMullan</surname> <given-names>G</given-names></name><name><surname>Chen</surname> <given-names>S</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name><name><surname>Faruqi</surname> <given-names>AR</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Detective quantum efficiency of electron area detectors in electron microscopy</article-title><source>Ultramicroscopy</source><volume>109</volume><fpage>1126</fpage><lpage>1143</lpage><pub-id pub-id-type="doi">10.1016/j.ultramic.2009.04.002</pub-id><pub-id pub-id-type="pmid">19497671</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Merk</surname> <given-names>A</given-names></name><name><surname>Bartesaghi</surname> <given-names>A</given-names></name><name><surname>Banerjee</surname> <given-names>S</given-names></name><name><surname>Falconieri</surname> <given-names>V</given-names></name><name><surname>Rao</surname> <given-names>P</given-names></name><name><surname>Davis</surname> <given-names>MI</given-names></name><name><surname>Pragani</surname> <given-names>R</given-names></name><name><surname>Boxer</surname> <given-names>MB</given-names></name><name><surname>Earl</surname> <given-names>LA</given-names></name><name><surname>Milne</surname> <given-names>JLS</given-names></name><name><surname>Subramaniam</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Breaking Cryo-EM Resolution Barriers to Facilitate Drug Discovery</article-title><source>Cell</source><volume>165</volume><fpage>1698</fpage><lpage>1707</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2016.05.040</pub-id><pub-id pub-id-type="pmid">27238019</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mindell</surname> <given-names>JA</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Accurate determination of local defocus and specimen tilt in electron microscopy</article-title><source>Journal of Structural Biology</source><volume>142</volume><fpage>334</fpage><lpage>347</lpage><pub-id pub-id-type="doi">10.1016/S1047-8477(03)00069-8</pub-id><pub-id pub-id-type="pmid">12781660</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moriya</surname> <given-names>T</given-names></name><name><surname>Saur</surname> <given-names>M</given-names></name><name><surname>Stabrin</surname> <given-names>M</given-names></name><name><surname>Merino</surname> <given-names>F</given-names></name><name><surname>Voicu</surname> <given-names>H</given-names></name><name><surname>Huang</surname> <given-names>Z</given-names></name><name><surname>Penczek</surname> <given-names>PA</given-names></name><name><surname>Raunser</surname> <given-names>S</given-names></name><name><surname>Gatsogiannis</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>High-resolution Single Particle Analysis from Electron Cryo-microscopy Images Using SPHIRE</article-title><source>Journal of Visualized Experiments</source><volume>123</volume><pub-id pub-id-type="doi">10.3791/55448</pub-id><pub-id pub-id-type="pmid">28570515</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakane</surname> <given-names>T</given-names></name><name><surname>Kimanius</surname> <given-names>D</given-names></name><name><surname>Lindahl</surname> <given-names>E</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Characterisation of molecular motions in cryo-EM single-particle data by multi-body refinement in RELION</article-title><source>eLife</source><volume>7</volume><elocation-id>e36861</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.36861</pub-id><pub-id pub-id-type="pmid">29856314</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Naydenova</surname> <given-names>K</given-names></name><name><surname>Russo</surname> <given-names>CJ</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Measuring the effects of particle orientation to improve the efficiency of electron cryomicroscopy</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>629</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-017-00782-3</pub-id><pub-id pub-id-type="pmid">28931821</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nelder</surname> <given-names>JA</given-names></name><name><surname>Mead</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="1965">1965</year><article-title>A Simplex Method for Function Minimization</article-title><source>The Computer Journal</source><volume>7</volume><fpage>308</fpage><lpage>313</lpage><pub-id pub-id-type="doi">10.1093/comjnl/7.4.308</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Patwardhan</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Trends in the Electron Microscopy Data Bank (EMDB)</article-title><source>Acta Crystallographica Section D Structural Biology</source><volume>73</volume><fpage>503</fpage><lpage>508</lpage><pub-id pub-id-type="doi">10.1107/S2059798317004181</pub-id><pub-id pub-id-type="pmid">28580912</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Punjani</surname> <given-names>A</given-names></name><name><surname>Rubinstein</surname> <given-names>JL</given-names></name><name><surname>Fleet</surname> <given-names>DJ</given-names></name><name><surname>Brubaker</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title><source>Nature Methods</source><volume>14</volume><fpage>290</fpage><lpage>296</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4169</pub-id><pub-id pub-id-type="pmid">28165473</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rohou</surname> <given-names>A</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>CTFFIND4: Fast and accurate defocus estimation from electron micrographs</article-title><source>Journal of Structural Biology</source><volume>192</volume><fpage>216</fpage><lpage>221</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2015.08.008</pub-id><pub-id pub-id-type="pmid">26278980</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rosenthal</surname> <given-names>PB</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Optimal determination of particle orientation, absolute hand, and contrast loss in single-particle electron cryomicroscopy</article-title><source>Journal of Molecular Biology</source><volume>333</volume><fpage>721</fpage><lpage>745</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2003.07.013</pub-id><pub-id pub-id-type="pmid">14568533</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rubinstein</surname> <given-names>JL</given-names></name><name><surname>Brubaker</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Alignment of cryo-EM movies of individual particles by optimization of image translations</article-title><source>Journal of Structural Biology</source><volume>192</volume><fpage>188</fpage><lpage>195</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2015.08.007</pub-id><pub-id pub-id-type="pmid">26296328</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Russo</surname> <given-names>CJ</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Ewald sphere correction using a single side-band image processing algorithm</article-title><source>Ultramicroscopy</source><volume>187</volume><fpage>26</fpage><lpage>33</lpage><pub-id pub-id-type="doi">10.1016/j.ultramic.2017.11.001</pub-id><pub-id pub-id-type="pmid">29413409</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saxton</surname> <given-names>WO</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Observation of lens aberrations for very high-resolution electron microscopy. I. Theory</article-title><source>Journal of Microscopy</source><volume>179</volume><fpage>201</fpage><lpage>213</lpage><pub-id pub-id-type="doi">10.1111/j.1365-2818.1995.tb03633.x</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Chen</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Prevention of overfitting in cryo-EM structure determination</article-title><source>Nature Methods</source><volume>9</volume><fpage>853</fpage><lpage>854</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2115</pub-id><pub-id pub-id-type="pmid">22842542</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012a</year><article-title>A Bayesian view on cryo-EM structure determination</article-title><source>Journal of Molecular Biology</source><volume>415</volume><fpage>406</fpage><lpage>418</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2011.11.010</pub-id><pub-id pub-id-type="pmid">22100448</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012b</year><article-title>RELION: implementation of a Bayesian approach to cryo-EM structure determination</article-title><source>Journal of Structural Biology</source><volume>180</volume><fpage>519</fpage><lpage>530</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2012.09.006</pub-id><pub-id pub-id-type="pmid">23000701</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Semi-automated selection of cryo-EM particles in RELION-1.3</article-title><source>Journal of Structural Biology</source><volume>189</volume><fpage>114</fpage><lpage>122</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2014.11.010</pub-id><pub-id pub-id-type="pmid">25486611</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tan</surname> <given-names>YZ</given-names></name><name><surname>Baldwin</surname> <given-names>PR</given-names></name><name><surname>Davis</surname> <given-names>JH</given-names></name><name><surname>Williamson</surname> <given-names>JR</given-names></name><name><surname>Potter</surname> <given-names>CS</given-names></name><name><surname>Carragher</surname> <given-names>B</given-names></name><name><surname>Lyumkis</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Addressing preferred specimen orientation in single-particle cryo-EM through tilting</article-title><source>Nature Methods</source><volume>14</volume><fpage>793</fpage><lpage>796</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4347</pub-id><pub-id pub-id-type="pmid">28671674</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Tan</surname> <given-names>YZ</given-names></name><name><surname>Aiyer</surname> <given-names>S</given-names></name><name><surname>Mietzsch</surname> <given-names>M</given-names></name><name><surname>Hull</surname> <given-names>JA</given-names></name><name><surname>McKenna</surname> <given-names>R</given-names></name><name><surname>Grieger</surname> <given-names>J</given-names></name><name><surname>Jude Samulski</surname> <given-names>R</given-names></name><name><surname>Baker</surname> <given-names>TS</given-names></name><name><surname>Agbandje-McKenna</surname> <given-names>M</given-names></name><name><surname>Lyumkis</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Sub-2 Å Ewald Curvature Corrected Single-Particle Cryo-EM</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/305599</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tang</surname> <given-names>G</given-names></name><name><surname>Peng</surname> <given-names>L</given-names></name><name><surname>Baldwin</surname> <given-names>PR</given-names></name><name><surname>Mann</surname> <given-names>DS</given-names></name><name><surname>Jiang</surname> <given-names>W</given-names></name><name><surname>Rees</surname> <given-names>I</given-names></name><name><surname>Ludtke</surname> <given-names>SJ</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>EMAN2: an extensible image processing suite for electron microscopy</article-title><source>Journal of Structural Biology</source><volume>157</volume><fpage>38</fpage><lpage>46</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2006.05.009</pub-id><pub-id pub-id-type="pmid">16859925</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tegunov</surname> <given-names>D</given-names></name><name><surname>Cramer</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Real-time cryo-EM data pre-processing with Warp</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/338558</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Heel</surname> <given-names>M</given-names></name><name><surname>Harauz</surname> <given-names>G</given-names></name><name><surname>Orlova</surname> <given-names>EV</given-names></name><name><surname>Schmidt</surname> <given-names>R</given-names></name><name><surname>Schatz</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>A new generation of the IMAGIC image processing system</article-title><source>Journal of Structural Biology</source><volume>116</volume><fpage>17</fpage><lpage>24</lpage><pub-id pub-id-type="doi">10.1006/jsbi.1996.0004</pub-id><pub-id pub-id-type="pmid">8742718</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Voss</surname> <given-names>NR</given-names></name><name><surname>Yoshioka</surname> <given-names>CK</given-names></name><name><surname>Radermacher</surname> <given-names>M</given-names></name><name><surname>Potter</surname> <given-names>CS</given-names></name><name><surname>Carragher</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>DoG Picker and TiltPicker: software tools to facilitate particle selection in single particle electron microscopy</article-title><source>Journal of Structural Biology</source><volume>166</volume><fpage>205</fpage><lpage>213</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2009.01.004</pub-id><pub-id pub-id-type="pmid">19374019</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname> <given-names>M</given-names></name><name><surname>DeRosier</surname> <given-names>DJ</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Ewald sphere correction for single-particle electron microscopy</article-title><source>Ultramicroscopy</source><volume>106</volume><fpage>376</fpage><lpage>382</lpage><pub-id pub-id-type="doi">10.1016/j.ultramic.2005.11.001</pub-id><pub-id pub-id-type="pmid">16384646</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Woolford</surname> <given-names>D</given-names></name><name><surname>Hankamer</surname> <given-names>B</given-names></name><name><surname>Ericksson</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>The Laplacian of Gaussian and arbitrary z-crossings approach applied to automated single particle reconstruction</article-title><source>Journal of Structural Biology</source><volume>159</volume><fpage>122</fpage><lpage>134</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2007.03.003</pub-id><pub-id pub-id-type="pmid">17490891</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yu</surname> <given-names>X</given-names></name><name><surname>Jin</surname> <given-names>L</given-names></name><name><surname>Zhou</surname> <given-names>ZH</given-names></name><name><surname>Hong Zhou</surname> <given-names>Z</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>3.88 A structure of cytoplasmic polyhedrosis virus by cryo-electron microscopy</article-title><source>Nature</source><volume>453</volume><fpage>415</fpage><lpage>419</lpage><pub-id pub-id-type="doi">10.1038/nature06893</pub-id><pub-id pub-id-type="pmid">18449192</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zemlin</surname> <given-names>F</given-names></name><name><surname>Weiss</surname> <given-names>K</given-names></name><name><surname>Schiske</surname> <given-names>P</given-names></name><name><surname>Kunath</surname> <given-names>W</given-names></name><name><surname>Herrmann</surname> <given-names>K-H</given-names></name></person-group><year iso-8601-date="1978">1978</year><article-title>Coma-free alignment of high resolution electron microscopes with the aid of optical diffractograms</article-title><source>Ultramicroscopy</source><volume>3</volume><fpage>49</fpage><lpage>60</lpage><pub-id pub-id-type="doi">10.1016/S0304-3991(78)80006-0</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname> <given-names>X</given-names></name><name><surname>Settembre</surname> <given-names>E</given-names></name><name><surname>Xu</surname> <given-names>C</given-names></name><name><surname>Dormitzer</surname> <given-names>PR</given-names></name><name><surname>Bellamy</surname> <given-names>R</given-names></name><name><surname>Harrison</surname> <given-names>SC</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Near-atomic resolution using electron cryomicroscopy and single-particle reconstruction</article-title><source>PNAS</source><volume>105</volume><fpage>1867</fpage><lpage>1872</lpage><pub-id pub-id-type="doi">10.1073/pnas.0711623105</pub-id><pub-id pub-id-type="pmid">18238898</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Gctf: Real-time CTF determination and correction</article-title><source>Journal of Structural Biology</source><volume>193</volume><fpage>1</fpage><lpage>12</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2015.11.003</pub-id><pub-id pub-id-type="pmid">26592709</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname> <given-names>SQ</given-names></name><name><surname>Palovcak</surname> <given-names>E</given-names></name><name><surname>Armache</surname> <given-names>JP</given-names></name><name><surname>Verba</surname> <given-names>KA</given-names></name><name><surname>Cheng</surname> <given-names>Y</given-names></name><name><surname>Agard</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>MotionCor2: anisotropic correction of beam-induced motion for improved cryo-electron microscopy</article-title><source>Nature Methods</source><volume>14</volume><fpage>331</fpage><lpage>332</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4193</pub-id><pub-id pub-id-type="pmid">28250466</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhu</surname> <given-names>D</given-names></name><name><surname>Wang</surname> <given-names>X</given-names></name><name><surname>Fang</surname> <given-names>Q</given-names></name><name><surname>Van Etten</surname> <given-names>JL</given-names></name><name><surname>Rossmann</surname> <given-names>MG</given-names></name><name><surname>Rao</surname> <given-names>Z</given-names></name><name><surname>Zhang</surname> <given-names>X</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Pushing the resolution limit by correcting the Ewald sphere effect in single-particle Cryo-EM reconstructions</article-title><source>Nature Communications</source><volume>9</volume><elocation-id>1552</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-018-04051-9</pub-id><pub-id pub-id-type="pmid">29674632</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Zivanov</surname> <given-names>J</given-names></name><name><surname>Nakane</surname> <given-names>T</given-names></name><name><surname>Scheres</surname> <given-names>SHW</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A Bayesian approach to beam-induced motion correction in cryo-EM single-particle analysis</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/384537</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.42166.029</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Egelman</surname><given-names>Edward H</given-names></name><role>Reviewing Editor</role><aff><institution>University of Virginia</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;RELION-3: new tools for automated high-resolution cryo-EM structure determination&quot; for consideration by <italic>eLife</italic>. Your article has been favorably reviewed by three peer reviewers, including Edward H Egelman as the Reviewing Editor and Reviewer #1, and the evaluation has been overseen by John Kuriyan as the Senior Editor. The following individuals involved in review of your submission have also agreed to reveal their identity: John L Rubinstein (Reviewer #2); Eva Nogales (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>All reviewers agreed that this paper would be an excellent contribution to the Tools or Resources category in <italic>eLife</italic>, and would be helpful to many people currently using cryo-EM as well as those hoping to use cryo-EM. The new algorithms described in the paper, including CTF/Defocus refinement of individual particles, Ewald sphere correction and beam-tilt correction, appear promising, and it is clear that Relion 3.0 will be an important software package for many people. No major concerns were raised, only minor points that can be easily addressed.</p><p>Minor points:</p><p>1) The authors estimate the resolution in some instances to a hundredth of an Å. This level of precision makes no sense in cryo-EM, where the FSC curve is never monotonic, and results are easily influenced by masking. In addition, Sjors recently wrote in a CCPEM forum that &quot;we have seen artificially high FSC curves in cases of strong 'rotational smearing' of the particles due to extremely broad posterior probability functions of the orientations.&quot; So simply smearing the map can improve the FSC, as previously noted by Grigorieff. Thus, defining the FSC resolution, which can be easily altered by tenths of an Å by masking and smearing, to a precision of a hundredth of an Å defies common sense. Therefore, 3.49 should be 3.5, and 3.11 should be 3.1.</p><p>2) Figure 1 needs the y-axes to be labelled in both parts. Without knowing precisely what is being plotted, it is confusing that the function oscillates about zero (I had guessed correlation, but that would be positive everywhere there is correlation).</p><p>3) CTF refinement: It might be useful to add a few statements regarding the performance of the per-particle CTF refinement algorithm when dealing with i) particles of different size (e.g. are smaller particles less reliably fit), ii) reconstructions of different resolution (e.g. will using a low-resolution reference structure lead to degraded defocus estimates; if so, at which resolutions has this been observed?), and iii) micrographs with different numbers of particles. Regarding the last point, it appears that the algorithm does not use the particle population of a micrograph to improve the accuracy of CTF fitting, e.g. by fitting a plane or to avoid outliers (e.g. Figure 4, supplement 1). This would imply that the number of particles per micrograph does not play a role in the per-particle use case – is this correct?</p><p>Also, since the refined map is needed for CTF refinement, how reliable is the procedure with reconstructions at medium resolution (in the 5-7Å regime)? Finally, have the authors compared their method with the local CTF estimation method done using Gctf, where no input map is needed?</p><p>4) Ewald sphere correction: Could the authors give the radius of the test specimen used, and the resolutions at which Ewald sphere curvature becomes limiting for this radius, according to previous estimates in the literature (e.g. by DeRosier, Grigorieff, and others)?</p><p>5) Automated data exploration: The script failed to select the correct structure because it used, at equal resolution, the largest class. Did any of the other refinement parameters point to the correct structure (e.g. translation or rotation accuracies from the alignment)?</p><p>6) Β-galactosidase: The comparison to previous reconstructions from the same and other groups is insightful and the emphasis on using proper validation statistics is important.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.42166.030</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Minor points:</p><p>1) The authors estimate the resolution in some instances to a hundredth of an Å. This level of precision makes no sense in cryo-EM, where the FSC curve is never monotonic, and results are easily influenced by masking. In addition, Sjors recently wrote in a CCPEM forum that &quot;we have seen artificially high FSC curves in cases of strong 'rotational smearing' of the particles due to extremely broad posterior probability functions of the orientations.&quot; So simply smearing the map can improve the FSC, as previously noted by Grigorieff. Thus, defining the FSC resolution, which can be easily altered by tenths of an Å by masking and smearing, to a precision of a hundredth of an Å defies common sense. Therefore, 3.49 should be 3.5, and 3.11 should be 3.1.</p></disp-quote><p>Leaving such precise numbers for the lower resolutions was an oversight, which we have corrected in the revised version. Note that we have left the precise values for resolutions beyond 2 Angstroms, where improvements in the third digit do become relevant.</p><disp-quote content-type="editor-comment"><p>2) Figure 1 needs the y-axes to be labelled in both parts. Without knowing precisely what is being plotted, it is confusing that the function oscillates about zero (I had guessed correlation, but that would be positive everywhere there is correlation).</p></disp-quote><p>We have added labels to the Y-axes in Figure 1.</p><disp-quote content-type="editor-comment"><p>3) CTF refinement: It might be useful to add a few statements regarding the performance of the per-particle CTF refinement algorithm when dealing with i) particles of different size (e.g. are smaller particles less reliably fit).</p></disp-quote><p>We have not observed any issues with the defocus estimation of small particles, although this is not described in the paper. It could be that their orientation determination (with five parameters) is more difficult than their defocus determination (with only a single parameter).</p><disp-quote content-type="editor-comment"><p>ii) Reconstructions of different resolution (e.g. will using a low-resolution reference structure lead to degraded defocus estimates; if so, at which resolutions has this been observed?).</p></disp-quote><p>The higher the resolution in the reference, the more information in principle is available to estimate the defocus. Our hemagglutinin example shows that at least 6.6A does not seem to be a problem. We added the following sentence: &quot;This example demonstrates that even for models with intermediate resolution (in this case 6.6 Å) our per-particle defocus refinement can yield improved defoci.&quot;</p><disp-quote content-type="editor-comment"><p>iii) micrographs with different numbers of particles. Regarding the last point, it appears that the algorithm does not use the particle population of a micrograph to improve the accuracy of CTF fitting, e.g. by fitting a plane or to avoid outliers (e.g. Figure 4, supplement 1). This would imply that the number of particles per micrograph does not play a role in the per-particle use case – is this correct?</p></disp-quote><p>This is correct. We have modified the following sentence: &quot;The expression in Equation 3 allows the CTF-parameters θ = {δ0, δA, φA, Cs, χ} to be determined either as constant for all particles in an entire micrograph or for every particle separately. In the latter case, the second sum consists of one single term corresponding to the index p of the particle in question, and the result will be independent on the number of particles per micrograph.&quot;</p><disp-quote content-type="editor-comment"><p>Also, since the refined map is needed for CTF refinement, how reliable is the procedure with reconstructions at medium resolution (in the 5-7Å regime)? Finally, have the authors compared their method with the local CTF estimation method done using Gctf, where no input map is needed?</p></disp-quote><p>We haven't. The idea, as per Figure 1, is that one would run gCTF before refining the defoci in RELION. The text reads: &quot;Therefore, in practice it would probably be faster to start from defoci provided by local CTF estimation programs, such as ctftilt [Mindell and Grigorieff, 2003], gctf [Zhang, 2016] or Warp [Tegunov and Cramer, 2018].&quot;</p><disp-quote content-type="editor-comment"><p>4) Ewald sphere correction: Could the authors give the radius of the test specimen used, and the resolutions at which Ewald sphere curvature becomes limiting for this radius, according to previous estimates in the literature (e.g. by DeRosier, Grigorieff, and others)?</p></disp-quote><p>We have added the following text: &quot;DeRosier, [2000] estimates that the frequency <italic>k</italic>* for which Ewald sphere curvature becomes limiting for a particle with diameter d is approximated by:</p><p>k*=1.4dλ.</p><p>And: &quot;The diameter of the P22 virion is approximately 700Å, which leads to an estimated resolution limit of 3.1Å due to Ewald sphere curvature [DeRosier, 2000].&quot;</p><disp-quote content-type="editor-comment"><p>5) Automated data exploration: The script failed to select the correct structure because it used, at equal resolution, the largest class. Did any of the other refinement parameters point to the correct structure (e.g. translation or rotation accuracies from the alignment)?</p></disp-quote><p>We have implemented the script to make choices on what we thought was the optimal procedure for general applicability: i.e. to select classes based on resolution, and in case of equal resolution, on class size. We considered it a better reflection of the power of the current implementation to openly describe its limitations, rather than tuning it to this specific case and getting a non- representative (overly optimistic) result. We do not expect that merely changing resolution for accuracy in alignment as a decision criterion will enhance the general applicability of the script. As mentioned in the manuscript, we are currently investigating how to improve the automated procedures, and we expect that the actual script will change considerably in the future. The main advance in implementation is the scriptable interface, which allows such developments to happen independently from the RELION source code, and therefore also easily by others.</p><disp-quote content-type="editor-comment"><p>6) Β-galactosidase: The comparison to previous reconstructions from the same and other groups is insightful and the emphasis on using proper validation statistics is important.</p></disp-quote><p>Your support is appreciated. Although we try to avoid direct comparisons with work from others in general, we felt that we needed to warn against suboptimal procedures in this case.</p></body></sub-article></article>