<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">36861</article-id><article-id pub-id-type="doi">10.7554/eLife.36861</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Structural Biology and Molecular Biophysics</subject></subj-group></article-categories><title-group><article-title>Characterisation of molecular motions in cryo-EM single-particle data by multi-body refinement in RELION</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-109538"><name><surname>Nakane</surname><given-names>Takanori</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2697-2767</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-60380"><name><surname>Kimanius</surname><given-names>Dari</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-2662-6373</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-109539"><name><surname>Lindahl</surname><given-names>Erik</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-2734-2794</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-3361"><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0462-6540</contrib-id><email>scheres@mrc-lmb.cam.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf2"/><xref ref-type="other" rid="dataset1"/><xref ref-type="other" rid="dataset2"/></contrib><aff id="aff1"><label>1</label><institution>MRC Laboratory of Molecular Biology</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Biochemistry and Biophysics, Science for Life Laboratory</institution><institution>Stockholm University</institution><addr-line><named-content content-type="city">Stockholm</named-content></addr-line><country>Sweden</country></aff><aff id="aff3"><label>3</label><institution>Swedish e-Science Research Center, KTH Royal Institute of Technology</institution><addr-line><named-content content-type="city">Stockholm</named-content></addr-line><country>Sweden</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-1054"><name><surname>Brunger</surname><given-names>Axel T</given-names></name><role>Reviewing Editor</role><aff id="aff4"><institution>Stanford University Medical Center</institution><country>United States</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>01</day><month>06</month><year>2018</year></pub-date><pub-date pub-type="collection"><year>2018</year></pub-date><volume>7</volume><elocation-id>e36861</elocation-id><history><date date-type="received" iso-8601-date="2018-03-22"><day>22</day><month>03</month><year>2018</year></date><date date-type="accepted" iso-8601-date="2018-05-31"><day>31</day><month>05</month><year>2018</year></date></history><permissions><copyright-statement>© 2018, Nakane et al</copyright-statement><copyright-year>2018</copyright-year><copyright-holder>Nakane et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-36861-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.36861.001</object-id><p>Macromolecular complexes that exhibit continuous forms of structural flexibility pose a challenge for many existing tools in cryo-EM single-particle analysis. We describe a new tool, called multi-body refinement, which models flexible complexes as a user-defined number of rigid bodies that move independently from each other. Using separate focused refinements with iteratively improved partial signal subtraction, the new tool generates improved reconstructions for each of the defined bodies in a fully automated manner. Moreover, using principal component analysis on the relative orientations of the bodies over all particle images in the data set, we generate movies that describe the most important motions in the data. Our results on two test cases, a cytoplasmic ribosome from <italic>Plasmodium falciparum</italic>, and the spliceosomal B-complex from yeast, illustrate how multi-body refinement can be useful to gain unique insights into the structure and dynamics of large and flexible macromolecular complexes.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>cryo-electron microscopy</kwd><kwd>single-particle analysis</kwd><kwd>maximum likelihood</kwd><kwd>image processing</kwd><kwd>focused refinement</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd><italic>S. cerevisiae</italic></kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id><institution>Medical Research Council</institution></institution-wrap></funding-source><award-id>MC UP A025 1013</award-id><principal-award-recipient><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001862</institution-id><institution>Svenska Forskningsrådet Formas</institution></institution-wrap></funding-source><award-id>2017-04641</award-id><principal-award-recipient><name><surname>Lindahl</surname><given-names>Erik</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Multi-body refinement in RELION allows high-resolution reconstruction and visualisation of molecular motions in cryo-EM single-particle data sets with continuous forms of structural heterogeneity.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>In electron cryo-microscopy (cryo-EM) single-particle analysis, biological macromolecules are embedded in a thin layer of vitrified buffer and imaged in a transmission electron microscope. In principle, this represents a single-molecule imaging technique that provides unique information about the structure of individual macromolecular complexes. However, because the electron dose needs to be carefully limited to reduce radiation damage, cryo-EM images are typically extremely noisy and one needs to combine projections of many molecules supposedly in the same state to reliably recover high-resolution information. In recent years, with the development of direct-electron detectors and improved image processing procedures, this technique has allowed structure determination of many macromolecular complexes with enough detail to allow de novo atomic modelling (<xref ref-type="bibr" rid="bib5">Fernandez-Leiro and Scheres, 2016</xref>).</p><p>Because macromolecular complexes often undergo conformational transitions as part of their functional cycles, many cryo-EM samples contain mixtures of different conformations. This type of structural heterogeneity may co-exist with incomplete complex formation or samples that have not been purified to homogeneity. In order to achieve high-resolution reconstructions, the presence of multiple different structures in the data needs to be dealt with during cryo-EM single-particle analysis. Many popular image classification approaches are based on competitive refinement of a user-defined number of references. These methods effectively divide the data into a discrete number of subsets or classes, each of which is assumed to be structurally homogeneous, for example see <xref ref-type="bibr" rid="bib10">Heymann et al. (2004</xref>) and <xref ref-type="bibr" rid="bib6">Gao et al. (2004</xref>) for early applications. Particularly useful are so-called unsupervised classification approaches, which do not require prior knowledge about the structural heterogeneity in the data. Unsupervised classification of a discrete number of three-dimensional states became possible with the introduction of maximum likelihood classification methods (<xref ref-type="bibr" rid="bib26">Scheres et al., 2007</xref>), which have since then been implemented in multiple image processing packages (<xref ref-type="bibr" rid="bib30">Sorzano et al., 2004</xref>; <xref ref-type="bibr" rid="bib25">Scheres, 2012b</xref>; <xref ref-type="bibr" rid="bib16">Lyumkis et al., 2013</xref>; <xref ref-type="bibr" rid="bib20">Punjani et al., 2017</xref>; <xref ref-type="bibr" rid="bib7">Grant et al., 2018</xref>). Using many classes, competitive multi-reference refinement approaches have also been used to deduce energy landscapes from Boltzmann distributions of the relative number of particle images assigned to each of the class for flexible molecular complexes like the 26S proteasome (<xref ref-type="bibr" rid="bib9">Haselbach et al., 2017</xref>) and the spliceosome (<xref ref-type="bibr" rid="bib8">Haselbach et al., 2018</xref>).</p><p>However, discrete classification approaches are ultimately not well suited when macromolecular complexes exhibit continuous molecular motions. In principle, an infinite amount of classes would be needed to describe a continuum, and given a finite data size the number of particle images per class would approach zero. When a limited number of classes is used instead, each class will still contain residual structural heterogeneity. Several approaches have been proposed to deal with continuous heterogeneity in cryo-EM data. Moreover, classification based on multi-reference refinement aims to optimise the metric used in the target function (e.g. a marginal likelihood), which is not necessarily the optimal classification to understand the conformational transitions in the data. An early approach to describe continuous heterogeneity used normal-mode analysis to deduce macromolecular motions from low-resolution maps (<xref ref-type="bibr" rid="bib31">Tama et al., 2002</xref>), and such predictions have also been used to guide alignment and discrete classification of cryo-EM images (<xref ref-type="bibr" rid="bib13">Jin et al., 2014</xref>). Normal-mode re-parametrisation has also been used to describe continuous deviations from helical symmetry in filamentous protein assemblies (<xref ref-type="bibr" rid="bib22">Rohou and Grigorieff, 2014</xref>). An approach that in principle allows one to extract any three-dimensional state along a continuum is based on manifold embedding (<xref ref-type="bibr" rid="bib4">Dashti et al., 2014</xref>). In this approach, each particle image represents a point in a multi-dimensional hyperspace, and a continuous manifold is deduced from the cloud of all points in the data set. Moving along this manifold then represents moving along the continuum of conformational changes. The manifold would ideally be calculated from the particle images alone, but currently available methods require prior alignment of the particle images against a single consensus reference. This may limit its effectiveness in cases where orientational and conformational assignments are intertwined.</p><p>Perhaps, a favourable case of continuous structural heterogeneity is when the molecular motion can be described by two or more rigid bodies that maintain their own internal structure but differ in their relative orientations. This model relies on the observation that tertiary protein structure often remains relatively constant upon domain movement. In case of such rigid-body motions, masked or focused refinements provide an efficient way to obtain high-resolution reconstructions. In this approach, at every iteration of the refinement process one masks away all density from the reference structure that does not correspond to a user-defined part of the complex. Thereby, the variability in the orientation of that part relative to the rest of the complex is ignored, and the part can be reconstructed to higher resolution. This procedure allowed atomic modelling in the presence of continuous variability in the relative orientations of ribosomal subunits for the yeast mitochondrial ribosome (<xref ref-type="bibr" rid="bib1">Amunts et al., 2014</xref>) and the <italic>Plasmodium falciparum</italic> cytoplasmic ribosome (<xref ref-type="bibr" rid="bib32">Wong et al., 2014</xref>). Later, this approach was improved by partial signal subtraction, where density corresponding to the rest of the complex is subtracted from the experimental particle images prior to performing focused refinements (<xref ref-type="bibr" rid="bib2">Bai et al., 2015</xref>; <xref ref-type="bibr" rid="bib34">Zhou et al., 2015</xref>; <xref ref-type="bibr" rid="bib11">Ilca et al., 2015</xref>). Partial signal subtraction typically uses a so-called consensus refinement of all particle images against a single reference, and subtracts projections of the resulting consensus reconstruction in the directions of the consensus orientations from the experimental images. A limitation of the focused refinement approach is that each domain that is refined separately needs to be large enough to allow alignment of the individual subtracted particle images. To overcome this problem, a new approach called WarpCraft was described recently for the structure determination of transcription pre-initiation complexes with TFIIH and Mediator (<xref ref-type="bibr" rid="bib28">Schilbach et al., 2017</xref>). WarpCraft uses normal mode analysis on a pseudo-atomic model of the cryo-EM map to restrain the motions between different regions in the map, thereby allowing reconstructions of much smaller regions than in focused refinement. However, there will exist a balance between separating highly flexible structures into many pieces and the amount of data available to reconstruct each piece.</p><p>In general, dealing with both discrete and continuous structural heterogeneity in cryo-EM data sets not only allows one to obtain higher-resolution maps, but also provides unique insights into the conformational landscape of macromolecular complexes. The presence of continuous forms of structural heterogeneity represents one of the most important open questions in cryo-EM single-particle analysis. Nowadays, many groups apply combinations of different approaches to disentangle structural heterogeneity in high-resolution cryo-EM data sets, and optimal results depend strongly on user expertise in designing this strategy (<xref ref-type="bibr" rid="bib5">Fernandez-Leiro and Scheres, 2016</xref>).</p><p>Here, we introduce a new approach to describe continuous structural heterogeneity in cryo-EM single-particle data in a user-friendly and fully automated manner. This approach, called multi-body refinement, builds on the approach of focused refinement with partial signal subtraction, and relies on the user to divide the reconstructed map from a consensus refinement into a discrete number of independently moving bodies. The multi-body model provides a balance between being able to describe large conformational transitions, while still being able to average (parts of) projections from the entire data set. During every iteration of multi-body refinement, the best relative orientation of each body is determined for every particle image, while the signal from the other bodies is subtracted on-the-fly. By keeping track of the relative orientations of all bodies for each particle image from the previous iteration, the partial signal subtraction is continually improved. Moreover, we use the refined relative orientations of all bodies upon convergence of the multi-body refinement to generate movies of the principal motions that exist within the data set. We first used an early implementation of our multi-body refinement to improve the density of mobile domains in the spliceosomal tri-snRNP complex (<xref ref-type="bibr" rid="bib17">Nguyen et al., 2015</xref>). Since then, an approach that updates the relative orientations of different parts of a molecule was also implemented by others (<xref ref-type="bibr" rid="bib29">Schoebel et al., 2017</xref>). In this paper, we formally introduce the multi-body approach and its implementation in <sc>relion</sc>, and describe its application to two test cases: the cytoplasmic ribosome (<xref ref-type="bibr" rid="bib32">Wong et al., 2014</xref>) from <italic>Plasmodium falciparum</italic>, and the spliceosomal B-complex from yeast (<xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>). These results showcase how multi-body refinement can improve cryo-EM reconstructions and provide insights into the conformational landscape of large and flexible macromolecular complexes.</p></sec><sec id="s2" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th valign="top">Reagent type</th><th valign="top">Designation</th><th valign="top">Reference</th><th valign="top">Identifier</th></tr></thead><tbody><tr><td valign="top"> software</td><td valign="top"><sc>relion</sc></td><td valign="top">(<xref ref-type="bibr" rid="bib25">Scheres, 2012b</xref>)</td><td valign="top">RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_016274">SCR_016274</ext-link></td></tr></tbody></table></table-wrap><sec id="s2-1"><title>Theoretical background</title><p>Multi-body refinement in <sc>relion</sc> is based on the assumption that all particles in a cryo-EM data set comprise the same macromolecular complex, that is, it is stoichiometrically homogeneous. Where multi-body refinement deviates from the standard approach for refinement of a single structure (or class) in <sc>relion</sc> (<xref ref-type="bibr" rid="bib24">Scheres, 2012a</xref>), is in the assumption that the macromolecular complex of interest behaves as <inline-formula><mml:math id="inf1"><mml:mi>B</mml:mi></mml:math></inline-formula> separate rigid bodies. These bodies are identical in all particles, but their relative orientations are permitted to vary among the particles.</p><p>In Fourier space, the model is described as follows:<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mtext>CTF</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover></mml:mstyle><mml:mtext> </mml:mtext><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mtext> </mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where:</p><list list-type="bullet"><list-item><p><inline-formula><mml:math id="inf2"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the 2D Fourier transform of the projection image of the <inline-formula><mml:math id="inf3"><mml:mi>i</mml:mi></mml:math></inline-formula>th particle, with <inline-formula><mml:math id="inf4"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p><inline-formula><mml:math id="inf5"><mml:mrow><mml:msub><mml:mrow><mml:mtext>CTF</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the 2D contrast transfer function for <inline-formula><mml:math id="inf6"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p><inline-formula><mml:math id="inf7"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the 3D Fourier transform of the <inline-formula><mml:math id="inf8"><mml:mi>b</mml:mi></mml:math></inline-formula>th rigid body. Its 3D Fourier components are assumed to be independent, zero-mean, Gaussian-distributed with variance <inline-formula><mml:math id="inf9"><mml:mrow><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, which varies with spatial frequency.</p></list-item><list-item><p><inline-formula><mml:math id="inf10"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> represents the operation that extracts a slice out of the 3D Fourier transform of the <inline-formula><mml:math id="inf11"><mml:mi>b</mml:mi></mml:math></inline-formula>th body, and <inline-formula><mml:math id="inf12"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> defines the orientation of that body with respect to the particle, comprising a 3D rotation and a phase shift according to a 2D translation in the image plane.</p></list-item><list-item><p><inline-formula><mml:math id="inf13"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is independent, zero-mean Gaussian noise in the 2D complex plane with variance <inline-formula><mml:math id="inf14"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>, which varies with spatial frequency.</p></list-item></list><p>In analogy to standard refinement in <sc>relion</sc>, optimisation of a regularised, marginal likelihood function is performed using expectation-maximisation (<xref ref-type="bibr" rid="bib25">Scheres, 2012b</xref>). Because the sum of the <inline-formula><mml:math id="inf15"><mml:mi>B</mml:mi></mml:math></inline-formula> bodies represents the same underlying 3D structure as in the standard refinement, the main difference in multi-body refinement is a <inline-formula><mml:math id="inf16"><mml:mi>B</mml:mi></mml:math></inline-formula>-fold increase in the number of hidden variables <inline-formula><mml:math id="inf17"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> to describe the orientations of all bodies in every particle image. Based on the model in <xref ref-type="disp-formula" rid="equ1">Equation (1)</xref>, the likelihood <inline-formula><mml:math id="inf18"><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> of observing the <inline-formula><mml:math id="inf19"><mml:mi>i</mml:mi></mml:math></inline-formula>th experimental image given the current model parameter set <inline-formula><mml:math id="inf20"><mml:mrow><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> and any combination <inline-formula><mml:math id="inf21"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> of all orientations <inline-formula><mml:math id="inf22"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> can be calculated as a multivariate Gaussian centred on the difference between the particle image and the corresponding reference projection:<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:munderover><mml:mtext> </mml:mtext><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>To prevent having to integrate for each body <inline-formula><mml:math id="inf23"><mml:mi>b</mml:mi></mml:math></inline-formula> over the orientations <inline-formula><mml:math id="inf24"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow></mml:math></inline-formula> of all the other bodies <inline-formula><mml:math id="inf25"><mml:mrow><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>, we treat each body <inline-formula><mml:math id="inf26"><mml:mi>b</mml:mi></mml:math></inline-formula> separately and assume that the most likely orientations of the other bodies as determined for that particle image in the previous iteration (<inline-formula><mml:math id="inf27"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>) are the correct ones. Thereby, we can rewrite <xref ref-type="disp-formula" rid="equ2">Eq (2)</xref> as:<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf28"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the <inline-formula><mml:math id="inf29"><mml:mi>i</mml:mi></mml:math></inline-formula>th particle image, from which the CTF-modulated reference projections of all the other bodies <inline-formula><mml:math id="inf30"><mml:mrow><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> have been subtracted:<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mtext>CTF</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mstyle displaystyle="true"><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:munderover></mml:mstyle><mml:mtext> </mml:mtext><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow></mml:math></disp-formula></p><p>By calculating all <inline-formula><mml:math id="inf31"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> on-the-fly during every expectation step, we can use <xref ref-type="disp-formula" rid="equ3">Eq (3)</xref> to obtain posterior distributions <inline-formula><mml:math id="inf32"><mml:mrow><mml:msub><mml:mi>Γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of all orientations <inline-formula><mml:math id="inf33"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> being the correct one for the <inline-formula><mml:math id="inf34"><mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula> particle image given the model estimates at the current iteration <inline-formula><mml:math id="inf35"><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>:<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mrow><mml:msubsup><mml:mi>Γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>X</mml:mi></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mstyle displaystyle="true" mathsize="140%"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mstyle><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:mtext> </mml:mtext><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>X</mml:mi></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mstyle displaystyle="true" mathsize="140%"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mstyle><mml:mi>b</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mstyle displaystyle="true" mathsize="140%"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mstyle><mml:mi>b</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mstyle displaystyle="true" mathsize="140%"><mml:msup><mml:mi>ϕ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mstyle><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mtext> </mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf36"><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> expresses prior information about <inline-formula><mml:math id="inf37"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. In our current implementation, <inline-formula><mml:math id="inf38"><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is implemented as a Gaussian function centred on the rotations and translations of the consensus refinement (see below), and with user-defined standard deviations.</p><p>During the maximisation step, the posterior distributions are used to obtain updated estimates for each body <inline-formula><mml:math id="inf39"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, and the optimal orientations <inline-formula><mml:math id="inf40"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> of all bodies in every particle image using:<disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mrow><mml:msubsup><mml:mi>V</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup></mml:mstyle><mml:mtext> </mml:mtext><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>Γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>b</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mtext>T</mml:mtext></mml:msubsup><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>CTF</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mstyle><mml:mi>d</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup></mml:mstyle><mml:mtext> </mml:mtext><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>Γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>b</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mtext>T</mml:mtext></mml:msubsup><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mtext>CTF</mml:mtext></mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mstyle><mml:mi>d</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:munder><mml:msubsup><mml:mi>Γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Thereby, multi-body refinement is closely related to focused refinement with partial signal subtraction (<xref ref-type="bibr" rid="bib2">Bai et al., 2015</xref>). However, whereas partial signal subtraction is typically performed once with a consensus model prior to starting a focused refinement, in multi-body refinement the partial signal subtraction is performed at every iteration with updated estimates for the reconstructed bodies and their relative orientations. A schematic overview of the multi-body approach is shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p><fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.36861.002</object-id><label>Figure 1.</label><caption><title>A schematic overview of multi-body refinement.</title><p>After a consensus 3D auto-refinement in RELION, the three-dimensional consensus map is split into <inline-formula><mml:math id="inf41"><mml:mi>B</mml:mi></mml:math></inline-formula> separate bodies using user-defined masks. In this example, <inline-formula><mml:math id="inf42"><mml:mrow><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> and the letters ’M’ (orange), ’R’ (green) and ’C’ (puple) each represent a body, and the corresponding spherical masks are shown with transparency. During multi-body refinement, one performs focused refinement for all experimental particle images <inline-formula><mml:math id="inf43"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, with local rotational and translational searches around the orientations from the consensus refinement. The yellow crosses in the reference projections for the focused refinements of each body indicate the centre-of-mass of each body’s mask, around which all rotations are made.For each body, partial signal subtraction is performed with projections along the current estimates for the respective orientations of the other <inline-formula><mml:math id="inf44"><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> bodies. This leads to <inline-formula><mml:math id="inf45"><mml:mi>B</mml:mi></mml:math></inline-formula> subtracted versions of each experimental particle image during every iteration, which are aligned against projections of the corresponding body. The resulting optimal orientations <inline-formula><mml:math id="inf46"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> for each body are used for the partial signal subtraction in the next iteration. Iterative alignment and reconstruction of all three bodiesis is repeated until convergence, which is when resolutions no longer improve and changes in the relative orientations of all bodies become small.</p><p><supplementary-material id="fig1sdata1"><object-id pub-id-type="doi">10.7554/eLife.36861.005</object-id><label>Figure 1—source data 1.</label><caption><title>The body definition STAR file.</title><p>Example of a STAR file that defines the bodies in <xref ref-type="fig" rid="fig1">Figure 1</xref>. The column labelled rlnBodyMaskName defines the file names for the corresponding masks; the relative orientations of eachbody are defined by the columns (rlnBodyRotateRelativeTo); and the priors on the rotations and translations of the bodies are given by rlnBodySigmaAngles and rlnBodySigmaOffset, respectively.</p></caption><media mime-subtype="plain" mimetype="text" xlink:href="elife-36861-fig1-data1-v2.txt"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig1-v2"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.003</object-id><label>Figure 1—figure supplement 1.</label><caption><title>Overlapping body masks.</title><p>(<bold>A</bold>) Overlapping masks for the example shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>. For the partial signal subtraction for focused refinement of the ’M’ body, the density of the ’R’ body within the ’R’ mask but not within the ’M’ mask will be subtracted, together with the density of the ’C’ body within the ’C’ mask, but not within the ’R’ mask (left). Partial signal subtraction for focused refinement of the ’R’ body comprises the density of the ’M’ body within the ’M’mask that does not overlap with the ’R’ mask and the density of the ’C’ body within the ’C’ mask that does not overlap with the ’R’ mask (middle). Similarly, for focused refinement of the ’C’ body, partial signal subtraction comprises the density of the entire ’M’ body and the density of the ’R’ body within the ’R’ mask that does not overlap with either the ’M’ mask or the ’C’ mask. A total of seven different masked maps needs to be stored in computer memory. (<bold>B</bold>) As in A, but for an example whereall three masks overlap with each other. A total of nine different masked maps needs to be stored in computer memory.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig1-figsupp1-v2"/></fig><fig id="fig1s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.004</object-id><label>Figure 1—figure supplement 2.</label><caption><title>Relative body orientations.</title><p>The density for each body is placed with the centre-of-mass of its mask (indicated with orange and green dots for the ’M’ body and ’R’ body, respectively) at the centre of the three-dimensional box, and all rotations are around this centre. Each body rotates relative to a neighbouring body, as defined using the rlnBodyRotateRelativeTo column in the input body STAR file (<xref ref-type="supplementary-material" rid="fig1sdata1">Figure 1—source data 1</xref>). In this example, the ’M’ body rotates relative to the ’R’ body. The rotation is expressed in Euler angles around an axis perpendicular to the vector between the centre-of-mass of the two bodies to prevent ambiguities in Euler-angle definitions around zero values for the second Euler angle (tilt). The cone illustrates the width at half the maximum value (FWHM) of a Gaussian-shaped prior on the rot-tilt tuple. A separate Gaussian-shaped prior exists on the third Euler angle (psi).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig1-figsupp2-v2"/></fig></fig-group></sec><sec id="s2-2"><title>Implementation details</title><p>Multi-body refinement has been implemented as a continuation of a standard 3D auto-refine job (in the program relion_refine_mpi) and is hardware-accelerated on both CPU or GPU (<xref ref-type="bibr" rid="bib15">Kimanius et al., 2016</xref>). We will refer to the previous standard refinement as the consensus refinement. It provides an initial estimate for the reconstructed density of each body, relative orientations for all particle images with respect to the consensus reconstruction, and estimates for the resolution-dependent variance in the experimental noise <inline-formula><mml:math id="inf47"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>.</p><p>The definition of the <inline-formula><mml:math id="inf48"><mml:mi>B</mml:mi></mml:math></inline-formula> separate bodies is provided by the user through a dedicated metadata file in STAR format (<xref ref-type="supplementary-material" rid="fig1sdata1">Figure 1—source data 1</xref>). The table in this file contains a single row for each body, where the entry rlnBodyMaskName points to a real-space mask that defines the outline of the corresponding body. Because sharp edges on masks cause artefacts in the Fourier-space refinements inside <sc>relion</sc>, the user should provide masks with soft edges, i.e. they contain grey values between zero outside the body, and one inside the body. Although <xref ref-type="disp-formula" rid="equ1">Equation (1)</xref> only holds for non-overlapping masks, our actual implementation also allows for overlapping masks between the different bodies, and the program will subtract only the non-overlapping parts of the masks of the other bodies when calculating <inline-formula><mml:math id="inf49"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> for the focused refinements. For example, in <xref ref-type="fig" rid="fig1">Figure 1</xref>, when calculating the subtracted image for the first body, the program will only subtract projections of the second body corresponding to the volume that does not overlap with the first body; and of the volume of the third body that does not overlap with the first or the second body (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2A</xref>). Likewise, when calculating subtracted images for the second body, only the volume of the first body that does not overlap with the second will be subtracted, and only the volume of the third body that does not overlap with the first or second body will be subtracted, etc. Because bodies that are higher up in the STAR file are subtracted first, and only non-overlapping parts of subsequent bodies are subtracted, one should position larger bodies above smaller ones in the STAR file. This treatment of overlapping bodies results in an overhead in required computer memory, as besides the 3D Fourier transforms of the <inline-formula><mml:math id="inf50"><mml:mi>B</mml:mi></mml:math></inline-formula> bodies, one also needs to store Fourier transforms of their non-overlapping parts. Therefore, if all bodies overlap with all other bodies, <inline-formula><mml:math id="inf51"><mml:mrow><mml:msup><mml:mi>B</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> 3D Fourier transforms are stored in memory (see <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2B</xref>).</p><p>The optimal orientations <inline-formula><mml:math id="inf52"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> for all bodies of all particle images are stored in additional tables (called data_images_body_b, with <inline-formula><mml:math id="inf53"><mml:mi>b</mml:mi></mml:math></inline-formula> being the body number) in the _data.star file that is written out at every iteration. These orientations are defined as residual rotations and translations that need to be applied on top of the orientations from the consensus refinement. Internally, every body is reconstructed with the centre-of-mass of its mask in the centre of the particle image box, and rotations are performed around this centre. The entry called rlnBodyRotateRelativeTo in the bodies STAR file defines the vector around which the rotations of the corresponding body are made: from its own centre-of-mass to the centre-of-mass of the body defined by this entry. For example, according to the STAR file defined in <xref ref-type="supplementary-material" rid="fig1sdata1">Figure 1—source data 1</xref>, the letters ’M’ and ’R’ rotate relative to each other, while the letter ’C’ rotates relative to the letter ’R’. This description of rotations permits meaningful priors, <inline-formula><mml:math id="inf54"><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mi>Θ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mtext>n</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, for the residual rotations of the bodies: the entries rlnBodySigmaAngles define the standard deviation (10 degrees for the bodies defined in <xref ref-type="supplementary-material" rid="fig1sdata1">Figure 1—source data 1</xref>) of a Gaussian-shaped prior on the Euler angles of the three bodies. Thereby, larger rotations are down-weighted and rotational searches are limited from −30 to +30 degrees (i.e. ±3 times the standard deviation) around the consensus rotation for each of the three Euler angles. To avoid ambiguities in rotations where the second Euler angle (rlnAngleTilt) is close to zero, the stored Euler angles represent a rotation around a vector that is orthogonal to the vector between the centres-of-mass of the bodies. Thereby, the residual rotations are all around the Euler-angle values rlnAngleRot = 0, rlnAngleTilt = 90 and rlnAnglePsi = 0 (see <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>). The entries for rlnBodySigmaOffset in the bodies STAR file define the standard deviation (in pixels) of a Gaussian prior on the translational offsets for each of the bodies, which again are relative to the translations for the entire particles as defined in the consensus refinement.</p><p>Running as a continuation of a consensus 3D auto-refinement, the multi-body refinement will estimate the power of the signal <inline-formula><mml:math id="inf55"><mml:mrow><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> for each body from the Fourier shell correlation (FSC) between two independently-refined half-sets of the data. Because the individual bodies occupy a relatively small volume in the particle image box, the option &quot;-–solvent_correct_fsc&quot; is activated by default. This option performs an internal correction to the FSC curves that accounts for the convolution effects of the mask, much like the post-processing job-type does in the standard <sc>relion</sc> approach (<xref ref-type="bibr" rid="bib3">Chen et al., 2013</xref>). The multi-body refinement approach is started from user-defined initial sampling rates for the rotations and translations, which are automatically increased during the refinement process. At every iteration the algorithm assesses whether the resolution is still increasing and whether the orientational assignments are still changing. The orientations of an individual body will be kept fixed once the angular sampling becomes finer than the estimated accuracy of the rotations for that body, and the algorithm converges once the resolutions no longer increase, changes in the orientations become small, and the sampling rate is finer than the angular accuracies of all bodies.</p><p>In case of extensive structural heterogeneity, the initial extent of the body masks will be hard to assess in blurry parts of the consensus reconstruction. In such cases, an initial multi-body refinement may be run with a relatively large mask that comprises the entire blurry region of each body. The resulting maps after the first multi-body refinement may then allow the definition of tighter masks for one or more of the bodies. To allow a second multi-body refinement to proceed from the higher resolution reconstructions of the bodies in the first multi-body refinement, one can then provide an optional column in the body STAR file called rlnBodyReferenceName, which points towards the initial reference map for each of the bodies. An example of this is given below for the spliceosome test case.</p></sec><sec id="s2-3"><title>Analysis of multi-body orientations</title><p>Besides potentially improved densities for the individual bodies, multi-body refinement also outputs the optimal orientations <inline-formula><mml:math id="inf56"><mml:mrow><mml:msubsup><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>b</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> for all bodies and for all particle images in the data set. This information can be used to assess the molecular flexibility in the macromolecular complex. To this end, we have implemented a program called relion_flex_analyse. This program has two main applications. Firstly, it can write out subtracted images which may be useful in subsequent focused refinements or classifications outside the framework of multi-body refinement. To allow smaller image sizes and more meaningful priors in the subsequent refinements, the subtracted images are centered on the projected centre-of-mass of the remaining density after subtraction.</p><p>Secondly, the relion_flex_analyse program can also perform a principal component analysis on the relative orientations of the bodies of all particle images in the data set. For the principal component analysis, the three Euler angles describing the relative orientations of the bodies are taken into account, together with the two translations in the projection plane. In order to compare the two translational offsets in different projection directions, they are converted into three translations on the three-dimensional Cartesian grid of the reconstructions by setting the translations along the projection direction to zero. Thereby, principal component analysis is performed on six variables per body. The corresponding columns in the principal component analysis are normalised by the squared difference of the intensity values in the maps for each of the bodies after rotating them one degree or translating them one pixel in each of the directions. For each specified eigenvector, the program then outputs a user-specified number of maps (<inline-formula><mml:math id="inf57"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> by default). This is done by dividing the histogram of the amplitudes along the eigenvector of interest into <inline-formula><mml:math id="inf58"><mml:mi>M</mml:mi></mml:math></inline-formula> equi-populated bins, that is each bin contains <inline-formula><mml:math id="inf59"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>th of the particle images. For each bin, the same reconstructed densities of the <inline-formula><mml:math id="inf60"><mml:mi>B</mml:mi></mml:math></inline-formula> bodies are positioned relative to each other according to the rotations and translations that correspond to the centre amplitude of that bin, and a combined map is generated by adding all repositioned body densities together. This generates <inline-formula><mml:math id="inf61"><mml:mi>M</mml:mi></mml:math></inline-formula> combined maps for the entire complex with different relative orientations of the bodies, each corresponding to the median orientations for <inline-formula><mml:math id="inf62"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>th of the particle images in the data set. These maps can then be used to generate a movie that visualises the motion along that eigenvector. Movies can be made, for example, using the ‘Volume Series’ utility in UCSF Chimera (<xref ref-type="bibr" rid="bib18">Pettersen et al., 2004</xref>) or using CueMol (<ext-link ext-link-type="uri" xlink:href="http://www.cuemol.org">www.cuemol.org</ext-link>), which we used to generate the images and movies in this paper. When analysing these movies, it is useful to consider that the principal components describe the largest variations in the data along orthogonal degrees of freedom, and that general motions in the data are formed by linear combinations of multiple principal components. Alternatively, the program can also be used to output a subset of particle images within a user-specified range of amplitudes along one of the eigenvectors. The latter can be used to classify particle images based on the extent of a specific motion in the data set. An example of the latter is shown below for the ribosome test case.</p></sec></sec><sec id="s3" sec-type="results"><title>Results</title><sec id="s3-1"><title>A ribosome test case</title><p>The multi-body refinement approach was tested on two previously published, experimental data sets. The first data set comprises 105,247 particle images of a <italic>Plasmodium falciparum</italic> ribosome bound to the drug emetine (<xref ref-type="bibr" rid="bib32">Wong et al., 2014</xref>). This data set is available as entry 10028 on the EMPIAR data base (<xref ref-type="bibr" rid="bib12">Iudin et al., 2016</xref>) and is used as a standard benchmark for <sc>relion</sc>. We used the so-called polished particle images, that is particle images after movie-refinement and radiation damage weighting in <sc>relion</sc> (<xref ref-type="bibr" rid="bib27">Scheres, 2014</xref>).</p><p>The consensus refinement was started from a 60 Å low-pass filtered version of EMDB entry 2660, and yielded an overall resolution estimate of 3.2 Å after standard <sc>relion</sc> post-processing to account for the solvent effects of the mask on the FSC curve (<xref ref-type="bibr" rid="bib3">Chen et al., 2013</xref>). The estimated B-factor for sharpening this map was −61 Å<inline-formula><mml:math id="inf63"><mml:mrow><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib23">Rosenthal and Henderson, 2003</xref>). In accordance with results described previously (<xref ref-type="bibr" rid="bib32">Wong et al., 2014</xref>), the consensus map showed excellent density for the large ribosomal subunit, but the density was worse in the small subunit. In particular, the so-called head region of the small subunit exhibited much more fuzzy density than the rest of the complex. Therefore, we decided to split the ribosome into three bodies, which we named ’LSU’ for the large subunit; ’SSU’ for the small subunit without the head; and ’head’ for the head region (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). The corresponding masks were made using a 30 Å low-pass filtered version of the consensus map to define the boundary with the solvent region, and relied on available atomic models (PDB entries 3J79 and 3J7A) to determine the boundaries between the bodies. By placing soft-edges with a width of 11 Å on the boundaries of the masks, all three bodies overlapped with each other.</p><fig-group><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.36861.006</object-id><label>Figure 2.</label><caption><title>The ribosome test case.</title><p>(<bold>A</bold>) The ribosome consensus map with the three transparent body masks (LSU, SSU and head) superimposed. (<bold>B</bold>) Slices through the density of the three bodies after the consensus refinement (top) and after multi-body refinement (down). (<bold>C</bold>) Local resolution estimates (in Å) calculated in <sc>relion</sc> after the consensus refinement (left) and after multi-body refinement (right). (<bold>D</bold>) The contributions of all eigenvectors to the variance. The first eigenvector, for which the maps at the extremes are shown in panel F, is highlighted in red. (<bold>E</bold>) Histograms of the amplitudes along the first and second eigenvectors for all particle images in the data set. The histogram of the amplitudes along the first eigenvector shows a bimodal distribution. The data set was split into two subsets: particle images with the amplitude along the first eigenvector smaller than −14 (red arrow) and particle images with that amplitude larger than −14 (blue arrow). (<bold>F</bold>) Refined maps for the two subsets in the same colors. As observed in the movie along the first eigenvector, the SSU rolls with respect to the the LSU and the head swivels with respect to the SSU, <italic>cf</italic> <xref ref-type="video" rid="video1">Video 1</xref>.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-36861-fig2-v2"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.007</object-id><label>Figure 2—figure supplement 1.</label><caption><title>Fourier shell correlation curves calculated from independently refined halves of the data for the three bodies after consensus refinement (dashed lines) and after the second multi-body refinement (solid lines).</title></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig2-figsupp1-v2"/></fig></fig-group><media id="video1" mime-subtype="mp4" mimetype="video" xlink:href="elife-36861-video1.mp4"><object-id pub-id-type="doi">10.7554/eLife.36861.008</object-id><label>Video 1.</label><caption><title>Repositioning of the reconstructed body densities along the first eigenvector for the ribosome case reveals a rolling-like motion of the SSU with respect to the LSU and a concomitant swiveling of the head.</title></caption></media><p>In a first multi-body refinement, the standard deviation of the Gaussian prior on the rotations was set to 10 degrees for all three bodies, and the standard deviations on the body translations were all set to two pixels (2.7 Å). These values represent an estimate of the amount of flexibility present in the different domains. Based on the domain architecture of the ribosome, the LSU and SSU were set to rotate with respect to each other, while the head was rotating with respect to the SSU. Multi-body refinement was started using an initial angular sampling rate of 1.8 degrees and an initial translational sampling rate of 0.25 pixels (0.33 Å). The choice for the initial angular sampling rate reflects a compromise between computational cost and a sufficiently fine sampling to describe the estimated flexibility. The initial translational sampling rate is similar to the estimated accuracy of the translations in the consensus refinement. Convergence of the multi-body refinement occured after 16 iterations, which took 16 hr on a single GPU work station with four <sc>nvidia</sc> 1080Ti GPUs, a 3.2 GHz Intel Xeon CPU, and 256 GB of RAM. Upon convergence, the solvent-corrected resolution estimates for the three bodies were: 3.1 Å for the LSU, 3.2 Å for the SSU, and 3.7 Å for the head. To test the influence of the mask boundaries on the results, we repeated the multi-body refinement with masks where the boundaries between the three bodies were defined by spheres that were manually positioned using the Volume Eraser tool in UCSF Chimera (<xref ref-type="bibr" rid="bib18">Pettersen et al., 2004</xref>) to approximate the boundaries between the LSU, SSU and head. To test the influence of the standard deviations of the priors on the rotations and translations of the bodies, we also repeated multi-body refinement with standard deviations of 5 and 20 degrees on the rotations, and standard deviations of 1 pixel and 5 pixels on the translations of all three bodies. For all repeated multi-body refinements, the estimated resolutions in the three bodies did not differ by more than a single resolution shell (<inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> Å) from the first multi-body-refinement, indicating that the approach is relatively robust to the choice of these parameters.</p><p>To assess the improvement in reconstructed density after multi-body refinement, we post-processed the maps after the consensus refinement using the three body masks and compared the resulting maps with the post-processed maps of the three bodies after multi-body refinement (<xref ref-type="fig" rid="fig2">Figure 2B,C</xref>). The same B-factor of −61 Å<inline-formula><mml:math id="inf65"><mml:mrow><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> was applied to all maps. The improvements for the LSU and SSU were modest, with average resolution in the LSU improving from 3.2 to 3.1 Å, and in the SSU from 3.3 to 3.2 Å, and visual inspection of the maps did not reveal major improvements (not shown). The improvements for the head were larger. In this region, the average resolution improved from 4.0 to 3.7 Å, and the reconstructed density improved considerably upon visual inspection. In particular, in the region furthest away from the centre of the ribosome, the reconstructed density for the head improved to such an extent that previously unmodelled regions became interpretable.</p><p>Application of the principal component analysis in the relion_flex_analyse program revealed that approximately 30% of the variance in the rotations and translations of the three bodies is explained by the first two eigenvectors (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). Movies of the reconstructed body densities repositioned along these eigenvectors reveal that the first eigenvector corresponds to a rolling-like motion of the SSU with respect to the LSU and a concomittant swiveling of the head (<xref ref-type="video" rid="video1">Video 1</xref>), whereas the motion along the second eigenvector is more reminiscent of a ratchet-like motion of the SSU with respect to the LSU together with a displacement of the head (<xref ref-type="video" rid="video2">Video 2</xref>). With the exception of the amplitudes along the first eigenvector, histograms of all other amplitudes were monomodal. For the histogram of the amplitudes along the first eigenvector, a shoulder was visible on the negative side of the histogram, indicating that the structural heterogeneity along the first eigenvector may not be continuous. We then used the relion_flex_analyse program to write out two separate STAR files with 11,431 particle images for which the amplitude along the first eigenvector is less than −14, and 93,816 particle images for which the amplitude along the first eigenvector is greater than −14 (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). Separate refinements of these subsets yielded overall resolution estimates of 4.4 and 3.2 Å, respectively. The differences between the two maps reveal similar differences in the orientation of the SSU and head as observed in <xref ref-type="video" rid="video1">Video 1</xref> (<xref ref-type="fig" rid="fig2">Figure 2F</xref>). This sort of discrete structural heterogeneity had remained undetected in our previous analysis (<xref ref-type="bibr" rid="bib32">Wong et al., 2014</xref>), and re-running conventional 3D classifications on this data set (with six or eight classes, and with exhaustive, local or no alignments of the particle images after the consensus refinement; results not shown) did not yield class reconstructions with meaningful differences between them.</p><media id="video2" mime-subtype="mp4" mimetype="video" xlink:href="elife-36861-video2.mp4"><object-id pub-id-type="doi">10.7554/eLife.36861.009</object-id><label>Video 2.</label><caption><title>Repositioning of the reconstructed body densities along the second eigenvector for the ribosome case reveals a ratchet-like motion of the SSU with respect to the LSU together with a displacement of the head.</title></caption></media></sec><sec id="s3-2"><title>A spliceosome test case</title><p>The second data set on which we tested multi-body refinement comprised 327,490 polished particle images of a spliceosomal B-complex from yeast (<xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>). With the submission of this paper, we also submitted this data set to the EMPIAR data base, where it is now available under entry 10180. In the original study describing this data set (<xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>), different parts of the complex were refined separately using focused refinement with partial image subtraction. Here, we used four masks that were generated in the original study for multi-body refinement: ’core’ for the centre of the tri-snSNP structure, ’foot’ for the tri-snSNP foot domains, ’helicase’ for the helicase domain, and ’SF3b’ for the SF3b subunits (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). Note that the centre of the tri-snSNP structure is often called ’body’ in the spliceosome literature, but we chose to call it the core to prevent confusion with the more general definition of body in this paper. The body masks were generated using a combination of the Volume Eraser tool in UCSF Chimera (<xref ref-type="bibr" rid="bib18">Pettersen et al., 2004</xref>) and relion_mask_create. The masks were large enough to enclose the blurred, weak densities at the periphery of the complex, that is in the foot, helicase and SF3b domains. To reduce memory consumption, polished particle images used in the previous study (<xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>) were down-sampled to 1.7 Å per pixel and re-windowed into a 320 pixel box. All refinements were perfomed without Fourier space padding by specifying the &quot;––pad 1&quot; option.</p><fig-group><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.36861.010</object-id><label>Figure 3.</label><caption><title>The spliceosome test case.</title><p>(<bold>A</bold>) The four body masks used for the first splicesome multi-body refinement are shown in semi-transparent colours on top of the consensus map on the left; the resulting density after the first multi-body refinement and the masks used for the second multi-body refinement are shown on the right. (<bold>B</bold>) Slices through the density of the four bodies after the consensus refinement (top) and after multi-body refinement (down). (<bold>C</bold>) Local resolution estimates (in Å) calculated in RELION after the consensus refinement (left) and after multi-body refinement (right). (<bold>D</bold>) The contributions of all eigenvectors to the variance. The second eigenvector, for which the maps at the extremes are shown in panel E, is highlighted in red. (<bold>E</bold>) Motion represented by the second eigenvector, <italic>cf</italic> <xref ref-type="video" rid="video4">Video 4</xref>. The helix that connects the core of the spliceosome and the LSm ring of the SF3b body that gets broken during the repositioning of the bodies in the eigenvector movies and the combined maps is indicated with an asterisk (also see main text).</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig3-v2"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.011</object-id><label>Figure 3—figure supplement 1.</label><caption><title>Fourier shell correlation curves calculated from independently refined halves of the data for the four bodies after consensus refinement (dashed lines), for the largest class of a discrete 3D classification (dotted lines) and after the second multi-body refinement (solid lines).</title></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig3-figsupp1-v2"/></fig><fig id="fig3s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.012</object-id><label>Figure 3—figure supplement 2.</label><caption><title>Local resolution estimates (in Å) for the SF3b region after multi-body refinement (left) and after subsequent partial signal subtraction in relion_flex_analyse followed by focused classification and refinement of the best class (right).</title></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig3-figsupp2-v2"/></fig><fig id="fig3s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.36861.013</object-id><label>Figure 3—figure supplement 3.</label><caption><title>The largest two classes of a 3D classification with eight classes (right) represent a similar motion as identified by the first principal component from the multi-body approach (left).</title><p>For the latter, the third and eight out of ten movie frames are shown.</p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-36861-fig3-figsupp3-v2"/></fig></fig-group><p>The consensus refinement was started from the B complex map in (<xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>), which was low-pass filtered to 40 Å. The overall resolution after the consensus refinement, using a mask around the entire complex for post-processing, was 4.3 Å. The estimated B-factor for map sharpening was −148 Å<inline-formula><mml:math id="inf66"><mml:mrow><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>. When postprocessed with individual masks for the four bodies, the core, foot, helicase and SF3b gave resolutions of 3.9, 4.2, 4.6 and 9.2 Å, respectively. Consistent with these values, the density for the SF3b was weak and blurred (<xref ref-type="fig" rid="fig3">Figure 3C,D</xref>).</p><p>For multi-body refinement, the core and the foot were set to rotate against each other. The helicase and the SF3b were set to rotate relative to the core. Based on similar considerations as for the ribosome case, the initial angular sampling rate was set to 1.8 degrees, and the initial translational sampling range and rate were set to three pixel (5.1 Å) and 0.75 pixel (1.3 Å), respectively. The standard deviations of the angular and the translational prior were set to 10 degrees and two pixels (3.4 Å) for all bodies. The multi-body refinement converged in 15 iterations, which took 33 hr on the same GPU workstation as used for the ribosome case. Upon covergence, the estimated resolutions for the core, foot, helicase and SF3b domains were 3.8, 4.0, 4.5 and 5.1 Å, respectively.</p><p>Next, we ran a second round of multi-body refinement using tighter masks that were generated from the body reconstructions from the first multi-body refinement. These masks were generated by low-pass filtering the reconstruction for each body from the first multi-body refinement to 30 Å, extending the binarised maps by 10 pixels, and adding a soft edge of 5 pixels. In addition, we used 7 Å low-pass filtered maps of each body obtained in the first multi-body refinement as initial references for the second run using the rlnBodyReferenceName label in the body STAR file. The second multi-body refinement converged in 12 iterations, and took 40 hr on our GPU workstation. The resolutions of the core, foot and helicase remained essentially the same as in the first multi-body refinement (3.7, 4.0 and 4.5 Å, respectively), while that of the SF3b improved to 4.4 Å (<xref ref-type="fig" rid="fig3">Figure 3C</xref>; <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). Despite the reasonable overall resolutions for each of the bodies, the densities for the U4 Sm ring within the helicase domain and the LSm ring and Rse1’s <inline-formula><mml:math id="inf67"><mml:mi>β</mml:mi></mml:math></inline-formula>-propeller B (BPB) within the SF3b domain remained relatively fuzzy, indicating remaining flexibilities and/or compositional heterogeneity within these bodies.</p><p>In an attempt to address the remaining structural heterogeneity within the SF3b body, and as an illustration of how multi-body refinement can be combined with existing refinement approaches, we then used the relion_flex_analyse program to subtract the other three bodies from all experimental particle images, and performed a focused 3D classification on the SF3b without alignments. Using six classes, we identified a single class (containing 126,186 particle images) with better defined density than the other classes. A separate refinement of this class led to a SF3b map with improved local resolution of its central region (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2</xref>) and an overall resolution of 4.0 Å. Subsequent focused refinements and classifications with partial signal subtraction on only the LSm ring did not yield better resolution maps (not shown).</p><p>We also examined the effect of wider search ranges for the rotations and translations of the bodies by changing the standard deviation of the angular and the translational priors to 20 degrees and 4 pixels. The resulting resolutions were within one or two resolution shells (&lt;0.5Å) of those with the default values of 10 degrees and 2 pixels, which is consistent with the observations for the ribosome dataset.</p><p>Principal component analysis by relion_flex_analyse revealed that the first two components describe approximately 30% of the variance in the rotations and translations (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). In contrast to the ribosome discussed above, the histograms were unimodal, suggesting that these motions were of a continuous nature. The first component corresponded to a rocking motion of the SF3b over the core (<xref ref-type="video" rid="video3">Video 3</xref>). The second represented concerted rocking of the helicase and SF3b (<xref ref-type="video" rid="video4">Video 4</xref>). Interestingly, the latter motion may resemble an early phase of the transition from the B complex (this structure) to the B<inline-formula><mml:math id="inf68"><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> complex, where the SF3b regions moves towards the U6 snRNA ACAGAGA stem to form the spliceosome active site (<xref ref-type="bibr" rid="bib33">Yan et al., 2016</xref>; <xref ref-type="bibr" rid="bib21">Rauhut et al., 2016</xref>; <xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>).</p><media id="video3" mime-subtype="mp4" mimetype="video" xlink:href="elife-36861-video3.mp4"><object-id pub-id-type="doi">10.7554/eLife.36861.014</object-id><label>Video 3.</label><caption><title>Repositioning of the reconstructed body densities along the first eigenvector for the spliceosome case reveals a rocking motion of the SF3b domain over the core.</title></caption></media><media id="video4" mime-subtype="mp4" mimetype="video" xlink:href="elife-36861-video4.mp4"><object-id pub-id-type="doi">10.7554/eLife.36861.015</object-id><label>Video 4.</label><caption><title>Repositioning of the reconstructed body densities along the second eigenvector for the spliceosome case reveals a concerted rocking motion of the helicase and SF3b over the core.</title></caption></media><p>Finally, we compared the results from multi-body refinement with those from discrete classification. The two largest classes of a 3D classification run with eight classes (keeping the orientations fixed at those determined in the consensus refinement) comprised 40% and 27% of the particle images. These two classes represent a similar motion as identified by the first component in the relion_flex_analyse program (<xref ref-type="fig" rid="fig3s3">Figure 3—figure supplement 3</xref>). However, even for the largest class, the local resolutions for the SF3b, the core and the foot domain were lower than those obtained using multi-body refinement (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>).</p></sec></sec><sec id="s4" sec-type="discussion"><title>Discussion</title><p>The main assumption in conventional cryo-EM single-particle analysis is that every experimental particle image is a two-dimensional projection of a common three-dimensional structure. This assumption no longer holds in the presence of continuous structural heterogeneity in the data set. Instead, multi-body refinement assumes that the continuous structural heterogeneity can be modelled as independent movements between rigid bodies, that is bodies that adopt the same structure but have different relative orientations among the data set. This assumption is probably reasonable for many macromolecular complexes, as tertiary protein structure often remains intact upon changes in quaternary structure. This is because within individual protein domains, the chemical environment of each amino acid does not change much upon movements of the entire domain. A major advantage of the multi-body model is that it allows one to use the entire data set for the reconstruction of each body, that is no subdivision of the data is required to describe the structural heterogeneity. The usefulness of this model is illustrated by the observation that multi-body refinement yields marked improvements over consensus refinement in the maps of flexible domains for both the ribosome and the spliceosome. For both test cases, parts of the consensus map that were not interpretable in terms of an atomic model improved to resolutions around 4 Å after multi-body refinement. For the ribosome case, conventional 3D classification into a discrete number of classes turned out to be difficult and following standard procedures did not yield insights into the structural heterogeneity present. For the spliceosome case, multi-body refinement provided better maps than those obtained by conventional classification into a discrete number of classes. This is explained by the lower number of particle images that contribute to each class in discrete classification, whereas multi-body refinement allows the use of all particle images for each of the bodies. Moreover, in the presence of continuous heterogeneity, each discrete class will still correspond to a mixture of different structures. Therefore, we anticipate that multi-body refinement will be a useful tool in generating atomic models for domains that adopt multiple different orientations with respect to the rest of the complex.</p><p>Whereas the internal structure of protein domains may change little when a body moves relative to a neighbour, significant changes in the chemical environment are expected for amino acids at the interfaces between the bodies. As one domain moves relative to another, continuous or multiple discrete conformational changes may occur at the interface. Ultimately, these changes may also affect the internal structure of the protein domains, in which case multi-body refinement would no longer be justified, but in general the structural variability will be largest at the interfaces. Our implementation allows the definition of overlapping body masks. Thereby, each body can be defined to include the interface with its neighbouring bodies. Provided this interface density is not large enough to affect the particle image alignments, the resulting blurry density may help to better understand the nature of the structural variability at these interfaces.</p><p>Our implementation outputs a separate reconstruction for each of the bodies, which may then be used to build atomic models for the different bodies. Often, the experimentalist may want to combine these separately built atomic models into a single atomic model describing the entire complex. Such a combined atomic model can then be used to make figures for publication, or for submission to the Protein Data Bank. For example, in the original study on the spliceosomal B-complex, a combined atomic model was generated by rigid-body fitting the models that were built into maps resulting from separate focused refinements with partial signal subtraction, and a similar procedure could be used after multi-body refinement. However, we note that this representation of a single atomic model for the entire complex is in principle not supported by the data. Besides creating a false impression of structural homogeneity, in particular the conformations of residues at the interfaces of the rigid-body fitted atomic models may not reflect the true interface with the relative orientation of the bodies observed in the combined model. For example, a helix connecting the core of the spliceosome and the LSm ring of the SF3b body (marked by asterisks in <xref ref-type="fig" rid="fig3">Figure 3D,E,G</xref>) looks broken in combined multi-body reconstructions, which is chemically unfeasible. This is where the rigid body assumption no longer holds. In reality, the interface should rearrange to keep the helix intact. As many different interface structures may exist in the data set, reconstruction of all these different densities and the generation of atomic models for these may not be possible. One could propose to keep the atomic models for each of the bodies separate, as this would prevent the impression of a well-defined structure at the interface. However, such a solution would still not reflect the variability in conformations of residues at the interface, and would be more difficult to analyse by non-experts. How to tackle the problem of reflecting continuous structural heterogeneity with atomic models will require community-wide discussion.</p><p>Multi-body refinement improved the maps for flexible parts of both the ribosome and spliceosome test cases. Similar improvements can also be achieved by existing focused refinement or classification approaches with partial signal subtraction. In fact, in the original study describing the spliceosomal B-complex, parts of the SF3b region were reconstructed to higher resolutions (3.9 Å) than achieved in multi-body refinement (4.4 Å). Multi-body refinement has the advantage of iteratively improving the partial signal subtraction, whereas focused refinement and classification is typically done with fixed subtracted particle images. On the other hand, combining multiple focused classifications and/or refinement runs, each with its own user-specified sampling and mask parameters, is more flexible than the fully automated multi-body refinement, but requires more user expertise. To combine the advantages of both approaches, the relion_flex_analyse program can output subtracted images according to the iteratively refined relative orientations from a multi-body refinement. The resulting subtracted particle images can then be used in subsequent focused classifications and/or refinements. An additional advantage of this program over previously existing subtraction tools in <sc>relion</sc> is the centering at the projected centre-of-mass of the subtracted particle images, which allows the use of more meaningful priors and smaller box sizes. The use of this procedure was illustrated for the SF3b region of the spliceosome, where focused classification and refinement after subtraction in the relion_flex_analyse program led to a resolution of 4.0 Å, which is close to the resolution of 3.9 Å obtained for this region in the original study.</p><p>Besides improved reconstructed density for flexible domains, multi-body refinement also provides information about the relative orientations of all bodies for every particle image in the data set. The proposed principal component analysis on the relative rotations and translations of all bodies allows convenient visualisation of the principal motions that exist within the data set through the generation of movies. These movies provide the user with unique insights into how different bodies move with respect to each other, which bodies move together with others, etc. However, we do again point out that (as outlined above for the analysis of atomic models) densities at the interfaces between different bodies are not well-defined in these movies. For the ribosome, analysis of the movies for the first two eigenvectors revealed the presence of the typical ribosome motions of rolling and ratcheting of the SSU relative to the LSU. In addition, the presence of a bimodal histogram for the amplitudes along the first eigenvector indicated the presence of non-continuous heterogeneity in the rolling motion. In the general case of discrete heterogeneity, the movies generated from such non-unimodal histograms will display a discontinuous jump from one conformation to the other. Subsequent classification of the particle images based on the amplitude along the first eigenvector was also used to obtain two separately refined maps of the two states, which confirmed the motion observed along that eigenvector. For the spliceosome, rotations of the helicase and SF3b with respect to the core were observed. Interestingly, the motion corresponding to the second eigenvector resembles an early phase of the transition from the B complex to the B<inline-formula><mml:math id="inf69"><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> state in the spliceosome functional cycle (<xref ref-type="bibr" rid="bib33">Yan et al., 2016</xref>; <xref ref-type="bibr" rid="bib21">Rauhut et al., 2016</xref>; <xref ref-type="bibr" rid="bib19">Plaschka et al., 2017</xref>). These results illustrate that the movies generated by the relion_flex_analyser program may be useful in exploring biologically relevant molecular motions.</p><p>One of the main limitations of multi-body refinement, and focused refinement in general, is that when the size of individual bodies decreases the signal becomes too weak for reliable alignment of the subtracted particle images. Refinement of macromolecular complexes with molecular weights below 100 kDa becomes progressively difficult, although smaller complexes have been refined, and phase-plate imaging (<xref ref-type="bibr" rid="bib14">Khoshouei et al., 2017</xref>) can help to reduce the size limits. In the case of perfect partial signal subtraction, similar limits on the minimum size of the bodies are expected for multi-body refinement. In practice, partial signal subtraction will contain errors, and larger bodies may be required. The smallest body presented in this paper, the foot of the spliceosome, has a molecular weight of approximately 290 kDa. The current implementation allows keeping very small bodies fixed (by setting the standard deviations on their rotational and translational priors to zero). Thereby, at least the consensus density can be subtracted for the alignment of the other bodies.</p><p>Ultimately, one would aim to introduce dependencies between the alignments of bodies, such that simultaneous alignment of many small bodies would become feasible. This would allow modelling of much more complicated forms of continuous structural heterogeneity. The approach in WarpCraft represents a step in that direction. WarpCraft could be considered as a many-body approach, where the flexibility is re-parametrised using normal mode analysis. This reduces the number of degrees of freedom from five per body (three Euler angles and two in-plane shifts) to the number of normal modes considered, regardless of the number of bodies. Consequently, WarpCraft may perform well in cases where the structural flexibility can be described by a few correlated local motions, as was probably the case for the Mediator complex (<xref ref-type="bibr" rid="bib28">Schilbach et al., 2017</xref>). However, when multiple independently moving bodies are present, one again needs many normal modes to describe the entire conformational landscape, and the advantage of the normal-mode re-parametrisation would disappear. Moreover, the presence of domain rotations, which are highly non-linear deformations, as well as the presence of discrete heterogeneity are difficult to describe by normal modes. In such cases, provided the individual bodies are large enough, one would expect the multi-body approach to perform better than the approach implemented in WarpCraft. Probably, both approaches will suffer from similar problems at the boundaries between bodies that undergo large motions, as many data sets will not contain sufficient information to describe those. Currently, the exploration of new re-parametrisation schemes that allow modelling of commonly occurring types of flexibility in macromolecular complexes is a topic of active research in our groups.</p><p>Meanwhile, the multi-body approach presented here offers a convenient tool to improve the reconstructed density of flexible regions in macromolecular complexes that can be described as multiple moving rigid bodies, and to provide unique insights into the nature of these movements. The computer programs described in this paper will be distributed as part of release 3.0 of <sc>relion</sc>, which is completely free for any user. As this software is distributed as open-source, others can contribute their own modifications and improvements of the presented algorithms, as has happened for partial signal subtraction approaches in the past (<xref ref-type="bibr" rid="bib34">Zhou et al., 2015</xref>; <xref ref-type="bibr" rid="bib11">Ilca et al., 2015</xref>; <xref ref-type="bibr" rid="bib29">Schoebel et al., 2017</xref>). Based on the observations described here, we anticipate that multi-body refinement, possibly combined with existing classification and refinement approaches, will be a useful tool to extract more information from cryo-EM data sets on macromolecular complexes exhibiting continuous structural heterogeneity.</p></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We are grateful to Jake Grimmett and Toby Darling for assistance with computing. The ribosome data set in this paper was collected by Xiao-chen Bai from samples made by Wilson Wong. The spliceosome sample was made and the spliceosome data were collected by Clemens Plaschka and Pei-Chun Lin from the group of Kiyoshi Nagai. We thank Clemens Plaschka, Kiyoshi Nagai and Vish Chandrasekaran for helpful discussions and critical reading of the manuscript. This work was funded by the UK Medical Research Council through grant MC_UP_A025_1013 to SHWS and the Swedish Research Council through grant 2017–04641 to EL.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf2"><p>Reviewing editor, <italic>eLife</italic></p></fn><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing—original draft, Writing—review and editing</p></fn><fn fn-type="con" id="con2"><p>Software, Investigation, Visualization, Methodology, Writing—review and editing</p></fn><fn fn-type="con" id="con3"><p>Software, Supervision, Writing—review and editing</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Software, Formal analysis, Supervision, Validation, Investigation, Visualization, Methodology, Writing—original draft, Project administration, Writing—review and editing</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>The ribosome dataset was downloaded from the EMPIAR database (entry number 10028). The spliceosome dataset has been uploaded to the EMPIAR database as well, and is now available under entry number 10180.</p><p>The following dataset was generated:</p><p><related-object content-type="generated-dataset" id="dataset1" source-id="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10180/" source-id-type="uri"><collab collab-type="author">Sjors HW Scheres</collab><year>2018</year><source>Structure of a pre-catalytic spliceosome</source><ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10180/">https://www.ebi.ac.uk/pdbe/emdb/empiar/entry/10180/</ext-link><comment>Publicly available at the Electron Microscopy Public Image Archive (accession no. EMPIAR-10180)</comment></related-object></p><p>The following previously published dataset was used:</p><p><related-object content-type="generated-dataset" id="dataset2" source-id="http://dx.doi.org/10.6019/EMPIAR-10028" source-id-type="uri"><collab collab-type="author">Sjors HW Scheres</collab><year>2015</year><source>Cryo-EM structure of the Plasmodium falciparum 80S ribosome bound to the anti-protozoan drug emetine</source><ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.6019/EMPIAR-10028">http://dx.doi.org/10.6019/EMPIAR-10028</ext-link><comment>Publicly available at the Electron Microscopy Public Image Archive (accession no. EMPIAR-10028)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amunts</surname> <given-names>A</given-names></name><name><surname>Brown</surname> <given-names>A</given-names></name><name><surname>Bai</surname> <given-names>XC</given-names></name><name><surname>Llácer</surname> <given-names>JL</given-names></name><name><surname>Hussain</surname> <given-names>T</given-names></name><name><surname>Emsley</surname> <given-names>P</given-names></name><name><surname>Long</surname> <given-names>F</given-names></name><name><surname>Murshudov</surname> <given-names>G</given-names></name><name><surname>Scheres</surname> <given-names>SHW</given-names></name><name><surname>Ramakrishnan</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Structure of the yeast mitochondrial large ribosomal subunit</article-title><source>Science</source><volume>343</volume><fpage>1485</fpage><lpage>1489</lpage><pub-id pub-id-type="doi">10.1126/science.1249410</pub-id><pub-id pub-id-type="pmid">24675956</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname> <given-names>XC</given-names></name><name><surname>Rajendra</surname> <given-names>E</given-names></name><name><surname>Yang</surname> <given-names>G</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Sampling the conformational space of the catalytic subunit of human γ-secretase</article-title><source>eLife</source><volume>4</volume><elocation-id>e11182</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.11182</pub-id><pub-id pub-id-type="pmid">26623517</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>S</given-names></name><name><surname>McMullan</surname> <given-names>G</given-names></name><name><surname>Faruqi</surname> <given-names>AR</given-names></name><name><surname>Murshudov</surname> <given-names>GN</given-names></name><name><surname>Short</surname> <given-names>JM</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>High-resolution noise substitution to measure overfitting and validate resolution in 3D structure determination by single particle electron cryomicroscopy</article-title><source>Ultramicroscopy</source><volume>135</volume><fpage>24</fpage><lpage>35</lpage><pub-id pub-id-type="doi">10.1016/j.ultramic.2013.06.004</pub-id><pub-id pub-id-type="pmid">23872039</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dashti</surname> <given-names>A</given-names></name><name><surname>Schwander</surname> <given-names>P</given-names></name><name><surname>Langlois</surname> <given-names>R</given-names></name><name><surname>Fung</surname> <given-names>R</given-names></name><name><surname>Li</surname> <given-names>W</given-names></name><name><surname>Hosseinizadeh</surname> <given-names>A</given-names></name><name><surname>Liao</surname> <given-names>HY</given-names></name><name><surname>Pallesen</surname> <given-names>J</given-names></name><name><surname>Sharma</surname> <given-names>G</given-names></name><name><surname>Stupina</surname> <given-names>VA</given-names></name><name><surname>Simon</surname> <given-names>AE</given-names></name><name><surname>Dinman</surname> <given-names>JD</given-names></name><name><surname>Frank</surname> <given-names>J</given-names></name><name><surname>Ourmazd</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Trajectories of the ribosome as a Brownian nanomachine</article-title><source>PNAS</source><volume>111</volume><fpage>17492</fpage><lpage>17497</lpage><pub-id pub-id-type="doi">10.1073/pnas.1419276111</pub-id><pub-id pub-id-type="pmid">25422471</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernandez-Leiro</surname> <given-names>R</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Unravelling biological macromolecules with cryo-electron microscopy</article-title><source>Nature</source><volume>537</volume><fpage>339</fpage><lpage>346</lpage><pub-id pub-id-type="doi">10.1038/nature19948</pub-id><pub-id pub-id-type="pmid">27629640</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gao</surname> <given-names>H</given-names></name><name><surname>Valle</surname> <given-names>M</given-names></name><name><surname>Ehrenberg</surname> <given-names>M</given-names></name><name><surname>Frank</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Dynamics of EF-G interaction with the ribosome explored by classification of a heterogeneous cryo-EM dataset</article-title><source>Journal of Structural Biology</source><volume>147</volume><fpage>283</fpage><lpage>290</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2004.02.008</pub-id><pub-id pub-id-type="pmid">15450297</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grant</surname> <given-names>T</given-names></name><name><surname>Rohou</surname> <given-names>A</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title><italic>cis</italic>TEM, user-friendly software for single-particle image processing</article-title><source>eLife</source><volume>7</volume><elocation-id>e35383</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.35383</pub-id><pub-id pub-id-type="pmid">29513216</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haselbach</surname> <given-names>D</given-names></name><name><surname>Komarov</surname> <given-names>I</given-names></name><name><surname>Agafonov</surname> <given-names>DE</given-names></name><name><surname>Hartmuth</surname> <given-names>K</given-names></name><name><surname>Graf</surname> <given-names>B</given-names></name><name><surname>Dybkov</surname> <given-names>O</given-names></name><name><surname>Urlaub</surname> <given-names>H</given-names></name><name><surname>Kastner</surname> <given-names>B</given-names></name><name><surname>Lührmann</surname> <given-names>R</given-names></name><name><surname>Stark</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Structure and conformational dynamics of the human spliceosomal B<sup>act</sup> Complex</article-title><source>Cell</source><volume>172</volume><fpage>454</fpage><lpage>464</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2018.01.010</pub-id><pub-id pub-id-type="pmid">29361316</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haselbach</surname> <given-names>D</given-names></name><name><surname>Schrader</surname> <given-names>J</given-names></name><name><surname>Lambrecht</surname> <given-names>F</given-names></name><name><surname>Henneberg</surname> <given-names>F</given-names></name><name><surname>Chari</surname> <given-names>A</given-names></name><name><surname>Stark</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Long-range allosteric regulation of the human 26S proteasome by 20S proteasome-targeting cancer drugs</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>15578</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms15578</pub-id><pub-id pub-id-type="pmid">28541292</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heymann</surname> <given-names>JB</given-names></name><name><surname>Conway</surname> <given-names>JF</given-names></name><name><surname>Steven</surname> <given-names>AC</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Molecular dynamics of protein complexes from four-dimensional cryo-electron microscopy</article-title><source>Journal of Structural Biology</source><volume>147</volume><fpage>291</fpage><lpage>301</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2004.02.006</pub-id><pub-id pub-id-type="pmid">15450298</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ilca</surname> <given-names>SL</given-names></name><name><surname>Kotecha</surname> <given-names>A</given-names></name><name><surname>Sun</surname> <given-names>X</given-names></name><name><surname>Poranen</surname> <given-names>MM</given-names></name><name><surname>Stuart</surname> <given-names>DI</given-names></name><name><surname>Huiskonen</surname> <given-names>JT</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Localized reconstruction of subunits from electron cryomicroscopy images of macromolecular complexes</article-title><source>Nature Communications</source><volume>6</volume><elocation-id>8843</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms9843</pub-id><pub-id pub-id-type="pmid">26534841</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Iudin</surname> <given-names>A</given-names></name><name><surname>Korir</surname> <given-names>PK</given-names></name><name><surname>Salavert-Torres</surname> <given-names>J</given-names></name><name><surname>Kleywegt</surname> <given-names>GJ</given-names></name><name><surname>Patwardhan</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>EMPIAR: a public archive for raw electron microscopy image data</article-title><source>Nature Methods</source><volume>13</volume><fpage>387</fpage><lpage>388</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3806</pub-id><pub-id pub-id-type="pmid">27067018</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jin</surname> <given-names>Q</given-names></name><name><surname>Sorzano</surname> <given-names>CO</given-names></name><name><surname>de la Rosa-Trevín</surname> <given-names>JM</given-names></name><name><surname>Bilbao-Castro</surname> <given-names>JR</given-names></name><name><surname>Núñez-Ramírez</surname> <given-names>R</given-names></name><name><surname>Llorca</surname> <given-names>O</given-names></name><name><surname>Tama</surname> <given-names>F</given-names></name><name><surname>Jonić</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Iterative elastic 3D-to-2D alignment method using normal modes for studying structural dynamics of large macromolecular complexes</article-title><source>Structure</source><volume>22</volume><fpage>496</fpage><lpage>506</lpage><pub-id pub-id-type="doi">10.1016/j.str.2014.01.004</pub-id><pub-id pub-id-type="pmid">24508340</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khoshouei</surname> <given-names>M</given-names></name><name><surname>Radjainia</surname> <given-names>M</given-names></name><name><surname>Baumeister</surname> <given-names>W</given-names></name><name><surname>Danev</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Cryo-EM structure of haemoglobin at 3.2 Å determined with the Volta phase plate</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>16099</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms16099</pub-id><pub-id pub-id-type="pmid">28665412</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimanius</surname> <given-names>D</given-names></name><name><surname>Forsberg</surname> <given-names>BO</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Lindahl</surname> <given-names>E</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Accelerated cryo-EM structure determination with parallelisation using GPUs in RELION-2</article-title><source>eLife</source><volume>5</volume><elocation-id>e18722</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.18722</pub-id><pub-id pub-id-type="pmid">27845625</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lyumkis</surname> <given-names>D</given-names></name><name><surname>Brilot</surname> <given-names>AF</given-names></name><name><surname>Theobald</surname> <given-names>DL</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Likelihood-based classification of cryo-EM images using FREALIGN</article-title><source>Journal of Structural Biology</source><volume>183</volume><fpage>377</fpage><lpage>388</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2013.07.005</pub-id><pub-id pub-id-type="pmid">23872434</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nguyen</surname> <given-names>TH</given-names></name><name><surname>Galej</surname> <given-names>WP</given-names></name><name><surname>Bai</surname> <given-names>XC</given-names></name><name><surname>Savva</surname> <given-names>CG</given-names></name><name><surname>Newman</surname> <given-names>AJ</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Nagai</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>The architecture of the spliceosomal U4/U6.U5 tri-snRNP</article-title><source>Nature</source><volume>523</volume><fpage>47</fpage><lpage>52</lpage><pub-id pub-id-type="doi">10.1038/nature14548</pub-id><pub-id pub-id-type="pmid">26106855</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pettersen</surname> <given-names>EF</given-names></name><name><surname>Goddard</surname> <given-names>TD</given-names></name><name><surname>Huang</surname> <given-names>CC</given-names></name><name><surname>Couch</surname> <given-names>GS</given-names></name><name><surname>Greenblatt</surname> <given-names>DM</given-names></name><name><surname>Meng</surname> <given-names>EC</given-names></name><name><surname>Ferrin</surname> <given-names>TE</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>UCSF Chimera--a visualization system for exploratory research and analysis</article-title><source>Journal of Computational Chemistry</source><volume>25</volume><fpage>1605</fpage><lpage>1612</lpage><pub-id pub-id-type="doi">10.1002/jcc.20084</pub-id><pub-id pub-id-type="pmid">15264254</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Plaschka</surname> <given-names>C</given-names></name><name><surname>Lin</surname> <given-names>PC</given-names></name><name><surname>Nagai</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Structure of a pre-catalytic spliceosome</article-title><source>Nature</source><volume>546</volume><fpage>617</fpage><lpage>621</lpage><pub-id pub-id-type="doi">10.1038/nature22799</pub-id><pub-id pub-id-type="pmid">28530653</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Punjani</surname> <given-names>A</given-names></name><name><surname>Rubinstein</surname> <given-names>JL</given-names></name><name><surname>Fleet</surname> <given-names>DJ</given-names></name><name><surname>Brubaker</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title><source>Nature Methods</source><volume>14</volume><fpage>290</fpage><lpage>296</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4169</pub-id><pub-id pub-id-type="pmid">28165473</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rauhut</surname> <given-names>R</given-names></name><name><surname>Fabrizio</surname> <given-names>P</given-names></name><name><surname>Dybkov</surname> <given-names>O</given-names></name><name><surname>Hartmuth</surname> <given-names>K</given-names></name><name><surname>Pena</surname> <given-names>V</given-names></name><name><surname>Chari</surname> <given-names>A</given-names></name><name><surname>Kumar</surname> <given-names>V</given-names></name><name><surname>Lee</surname> <given-names>CT</given-names></name><name><surname>Urlaub</surname> <given-names>H</given-names></name><name><surname>Kastner</surname> <given-names>B</given-names></name><name><surname>Stark</surname> <given-names>H</given-names></name><name><surname>Lührmann</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Molecular architecture of the Saccharomyces cerevisiae activated spliceosome</article-title><source>Science</source><volume>353</volume><fpage>1399</fpage><lpage>1405</lpage><pub-id pub-id-type="doi">10.1126/science.aag1906</pub-id><pub-id pub-id-type="pmid">27562955</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rohou</surname> <given-names>A</given-names></name><name><surname>Grigorieff</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Frealix: model-based refinement of helical filament structures from electron micrographs</article-title><source>Journal of Structural Biology</source><volume>186</volume><fpage>234</fpage><lpage>244</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2014.03.012</pub-id><pub-id pub-id-type="pmid">24657230</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rosenthal</surname> <given-names>PB</given-names></name><name><surname>Henderson</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Optimal determination of particle orientation, absolute hand, and contrast loss in single-particle electron cryomicroscopy</article-title><source>Journal of Molecular Biology</source><volume>333</volume><fpage>721</fpage><lpage>745</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2003.07.013</pub-id><pub-id pub-id-type="pmid">14568533</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012a</year><article-title>A bayesian view on cryo-EM structure determination</article-title><source>Journal of Molecular Biology</source><volume>415</volume><fpage>406</fpage><lpage>418</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2011.11.010</pub-id><pub-id pub-id-type="pmid">22100448</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012b</year><article-title>RELION: implementation of a bayesian approach to cryo-EM structure determination</article-title><source>Journal of Structural Biology</source><volume>180</volume><fpage>519</fpage><lpage>530</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2012.09.006</pub-id><pub-id pub-id-type="pmid">23000701</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Gao</surname> <given-names>H</given-names></name><name><surname>Valle</surname> <given-names>M</given-names></name><name><surname>Herman</surname> <given-names>GT</given-names></name><name><surname>Eggermont</surname> <given-names>PP</given-names></name><name><surname>Frank</surname> <given-names>J</given-names></name><name><surname>Carazo</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Disentangling conformational states of macromolecules in 3D-EM through likelihood optimization</article-title><source>Nature Methods</source><volume>4</volume><fpage>27</fpage><lpage>29</lpage><pub-id pub-id-type="doi">10.1038/nmeth992</pub-id><pub-id pub-id-type="pmid">17179934</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Beam-induced motion correction for sub-megadalton cryo-EM particles</article-title><source>eLife</source><volume>3</volume><elocation-id>e03665</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.03665</pub-id><pub-id pub-id-type="pmid">25122622</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schilbach</surname> <given-names>S</given-names></name><name><surname>Hantsche</surname> <given-names>M</given-names></name><name><surname>Tegunov</surname> <given-names>D</given-names></name><name><surname>Dienemann</surname> <given-names>C</given-names></name><name><surname>Wigge</surname> <given-names>C</given-names></name><name><surname>Urlaub</surname> <given-names>H</given-names></name><name><surname>Cramer</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Structures of transcription pre-initiation complex with TFIIH and Mediator</article-title><source>Nature</source><volume>551</volume><fpage>204</fpage><lpage>209</lpage><pub-id pub-id-type="doi">10.1038/nature24282</pub-id><pub-id pub-id-type="pmid">29088706</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schoebel</surname> <given-names>S</given-names></name><name><surname>Mi</surname> <given-names>W</given-names></name><name><surname>Stein</surname> <given-names>A</given-names></name><name><surname>Ovchinnikov</surname> <given-names>S</given-names></name><name><surname>Pavlovicz</surname> <given-names>R</given-names></name><name><surname>DiMaio</surname> <given-names>F</given-names></name><name><surname>Baker</surname> <given-names>D</given-names></name><name><surname>Chambers</surname> <given-names>MG</given-names></name><name><surname>Su</surname> <given-names>H</given-names></name><name><surname>Li</surname> <given-names>D</given-names></name><name><surname>Rapoport</surname> <given-names>TA</given-names></name><name><surname>Liao</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Cryo-EM structure of the protein-conducting ERAD channel Hrd1 in complex with Hrd3</article-title><source>Nature</source><volume>548</volume><fpage>352</fpage><lpage>355</lpage><pub-id pub-id-type="doi">10.1038/nature23314</pub-id><pub-id pub-id-type="pmid">28682307</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sorzano</surname> <given-names>CO</given-names></name><name><surname>Marabini</surname> <given-names>R</given-names></name><name><surname>Velázquez-Muriel</surname> <given-names>J</given-names></name><name><surname>Bilbao-Castro</surname> <given-names>JR</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name><name><surname>Carazo</surname> <given-names>JM</given-names></name><name><surname>Pascual-Montano</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>XMIPP: a new generation of an open-source image processing package for electron microscopy</article-title><source>Journal of Structural Biology</source><volume>148</volume><fpage>194</fpage><lpage>204</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2004.06.006</pub-id><pub-id pub-id-type="pmid">15477099</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tama</surname> <given-names>F</given-names></name><name><surname>Wriggers</surname> <given-names>W</given-names></name><name><surname>Brooks</surname> <given-names>CL</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Exploring global distortions of biological macromolecules and assemblies from low-resolution structural information and elastic network theory</article-title><source>Journal of Molecular Biology</source><volume>321</volume><fpage>297</fpage><lpage>305</lpage><pub-id pub-id-type="doi">10.1016/S0022-2836(02)00627-7</pub-id><pub-id pub-id-type="pmid">12144786</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname> <given-names>W</given-names></name><name><surname>Bai</surname> <given-names>X-chen</given-names></name><name><surname>Brown</surname> <given-names>A</given-names></name><name><surname>Fernandez</surname> <given-names>IS</given-names></name><name><surname>Hanssen</surname> <given-names>E</given-names></name><name><surname>Condron</surname> <given-names>M</given-names></name><name><surname>Tan</surname> <given-names>YH</given-names></name><name><surname>Baum</surname> <given-names>J</given-names></name><name><surname>Scheres</surname> <given-names>SH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Cryo-EM structure of the plasmodium falciparum 80S ribosome bound to the anti-protozoan drug emetine</article-title><source>eLife</source><volume>3</volume><elocation-id>e03080</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.03080</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yan</surname> <given-names>C</given-names></name><name><surname>Wan</surname> <given-names>R</given-names></name><name><surname>Bai</surname> <given-names>R</given-names></name><name><surname>Huang</surname> <given-names>G</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Structure of a yeast activated spliceosome at 3.5 å resolution</article-title><source>Science</source><volume>353</volume><fpage>904</fpage><lpage>911</lpage><pub-id pub-id-type="doi">10.1126/science.aag0291</pub-id><pub-id pub-id-type="pmid">27445306</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname> <given-names>Q</given-names></name><name><surname>Huang</surname> <given-names>X</given-names></name><name><surname>Sun</surname> <given-names>S</given-names></name><name><surname>Li</surname> <given-names>X</given-names></name><name><surname>Wang</surname> <given-names>HW</given-names></name><name><surname>Sui</surname> <given-names>SF</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Cryo-EM structure of SNAP-SNARE assembly in 20S particle</article-title><source>Cell Research</source><volume>25</volume><fpage>551</fpage><lpage>560</lpage><pub-id pub-id-type="doi">10.1038/cr.2015.47</pub-id><pub-id pub-id-type="pmid">25906996</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.36861.021</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Brunger</surname><given-names>Axel T</given-names></name><role>Reviewing Editor</role><aff id="aff5"><institution>Stanford University Medical Center</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Characterisation of molecular motions in cryo-EM single-particle data by multi-body refinement in RELION&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by three peer reviewers, and the evaluation has been overseen by Axel Brunger as the Reviewing Editor and Andrea Musacchio as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: John L Rubinstein (Reviewer #2); Nikolaus Grigorieff (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>Scheres and colleagues describe an extension – multi-body refinement – of their software, RELION, to process images of single particles displaying large continuous heterogeneity that can be represented as motion of several independent rigid subdomains (the &quot;bodies&quot;). Their implementation follows a strategy that was applied previously, for example, to the ribosome and the spliceosome. The new tool is user-friendly and automates the steps established in these previous projects: masking of rigid subdomains by pre-defined masks, signal subtraction of parts of the particle outside the mask, focused refinement of the remaining domain, and combination of the separately refined domains to reconstitute the complete particle. In addition, the angles and translations for the subdomains can be analyzed using principal component analysis, and reconstructions with domains in intermediate positions can be calculated to visualize the motions. The new tool is applied to two previously published datasets, of Plasmodium ribosome and yeast spliceosome. Focused refinement itself is not new, but the new automated implementation in Relion should make it much easier to use when multiple focused regions (or multiple bodies) are necessary.</p><p>The multi-body refinement addresses an important problem in single-particle cryo-EM that occurs when domains of a complex move against each other without assuming distinct positions (conformations) relative to each other. This is one type of continuous heterogeneity that occurs frequently in large macromolecular machines. The authors demonstrate that multi-body refinement is an effective tool to improve the resolution of the subdomains. As they point out, features at the interfaces between the domains will not be reconstructed correctly.</p><p>Essential revisions:</p><p>The WarpCraft approach appears to be superior in preserving details at domain interfaces. The authors should discuss situations in which their multi-body approach would be preferred.</p><p>How does the visualization of the motion by principal component analysis work when the motion is not continuous, i.e. there are only a few discrete states? What if dividing the particles into <italic>M</italic> equi-populated bins according to the chosen eigenvalue is not possible because there are not sufficient particles for some bins?</p><p>The multi-body refinement results are compared with the consensus refinement results that were obtained by refining a single class. A more interesting comparison would be with the results obtained using traditional 3D classification assuming discrete states. In the ribosome example, this may yield results similar to the multi-body approach.</p><p>Some explanation of the rationale for choice of parameters subsection “A ribosome test case”and subsection “A spliceosome test case” would be valuable.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Characterisation of molecular motions in cryo-EM single-particle data by multi-body refinement in RELION&quot; for further consideration at <italic>eLife</italic>. Your revised article has been favorably evaluated by Andrea Musacchio (Senior Editor), a Reviewing Editor, and three reviewers.</p><p>Reviewer #1:</p><p>I am satisfied with how the authors have addressed the concerns raised by the first round of reviews.</p><p>I caught a few typos.</p><p>Reviewer #2:</p><p>I am satisfied by the changes and think the paper should be published</p><p>Reviewer #3:</p><p>I read the authors' rebuttal and am happy with their replies. I think that the manuscript is ready for publication in <italic>eLife</italic>.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.36861.022</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>The WarpCraft approach appears to be superior in preserving details at domain interfaces. The authors should discuss situations in which their multi-body approach would be preferred.</p></disp-quote><p>We thank the reviewers for pointing out that our manuscript apparently gave the false impression that the WarpCraft approach would be superior. We do not think this is the case. The WarpCraft approach is probably best suited for a different type of heterogeneity compared to the multi-body refinement in RELION, while none of the approaches is well suited to deal with heterogeneity at domain interfaces. To better describe the differences between the two methods, we have added the following paragraph to the Discussion section: &quot;Ultimately, one would aim to introduce dependencies between the alignments of bodies, such that simultaneous alignment of many small bodies would become feasible. This would allow modelling of much more complicated forms of continuous structural heterogeneity. The approach in WarpCraft represents a step in that direction. WarpCraft could be considered as a many-body approach, where the flexibility is re-parametrised using normal mode analysis. This reduces the number of degrees of freedom from five per body (three Euler angles and two in-plane shifts) to the number of normal modes considered, regardless of the number of bodies. Consequently, WarpCraft may perform well in cases where the structural flexibility can be described by a few correlated, local motions, as was probably the case for the Mediator complex (Schilbach et al., 2017). However, when multiple independently moving bodies are present, one again needs many normal modes to describe the entire conformational landscape, and the advantage of the normal-mode re-parametrisation would disappear. Moreover, the presence of domain rotations, which are highly non-linear deformations, as well as the presence of discrete heterogeneity are difficult to describe by normal modes. In such cases, provided the individual bodies are large enough, one would expect the multi-body approach to perform better than the approach implemented in WarpCraft. Probably, both approaches will suffer from similar problems at the boundaries between bodies that undergo large motions, as many data sets will not contain sufficient information to describe those. Currently, the exploration of new re-parametrisation schemes that allow modelling of commonly occurring types of flexibility in macromolecular complexes is a topic of active research in our groups.&quot;</p><disp-quote content-type="editor-comment"><p>How does the visualization of the motion by principal component analysis work when the motion is not continuous, i.e. there are only a few discrete states?</p></disp-quote><p>In that case, the histogram of the amplitudes along the eigenvector becomes multi-modal, and the movie will contain a discontinuous jump from one confirmation to the other. To a limited extent, the ribosome case represents an example of this type of heterogeneity. In the Discussion section, we have modified the text below to reflect these observations.</p><p>&quot;For the ribosome, analysis of the movies for the first two eigenvectors revealed the presence of the typical ribosome motions of rolling and ratcheting of the SSU relative to the LSU. In addition, the presence of a bimodal histogram for the amplitudes along the first eigenvector indicated the presence of non-continuous heterogeneity in the rolling motion. In the general case of discrete heterogeneity, the movies generated from such non-unimodal histograms will display a discontinuous jump from one conformation to the other.&quot;</p><disp-quote content-type="editor-comment"><p>What if dividing the particles into M equi-populated bins according to the chosen eigenvalue is not possible because there are not sufficient particles for some bins?</p></disp-quote><p>This question reveals a misunderstanding by the reviewer. As the bins are equi-populated, there are equal numbers of particles represented by each bin. E.g. for the default ten bins, there are always one-tenth of the data set in each bin. (Note that we have also modified the term 'eigenvalues' to the more correct 'amplitudes along the eigenvector'.) To prevent further misunderstandings by the readers, we have modified the following sentence in subsection “Analysis of multi-body orientations”:</p><p>&quot;This is done by dividing the histogram of the amplitudes along the eigenvector of interest into <italic>M</italic> equi-populated bins, i.e. each bin contains 1/<italic>M</italic>th of the particle images. For each bin, the same reconstructed densities of the <italic>B</italic> bodies are positioned relative to each other according to the rotations and translations that correspond to the centre amplitude of that bin, and a combined map is generated by adding all repositioned body densities together.&quot;</p><disp-quote content-type="editor-comment"><p>The multi-body refinement results are compared with the consensus refinement results that were obtained by refining a single class. A more interesting comparison would be with the results obtained using traditional 3D classification assuming discrete states. In the ribosome example, this may yield results similar to the multi-body approach.</p></disp-quote><p>We have now performed standard discrete classifications for both the spliceosome and the ribosome. For the ribosome, 3D classification (using several runs) did not reveal any meaningful insights into the structural heterogeneity, which is in line with our observation when we originally published this data set. For the spliceosome, a discrete classification captured the overall motion observed in the first eigenvector of the multi-body analysis, but the resolution of the different bodies obtained in multi-body refinement is higher. In addition, the discrete classification did not yield insight in as many types of motions as detected by the principal components analysis of the multi-body approach. These new results have been added to Figure 3—figure supplement 1 and Figure 3—figure supplement 3. Apart from describing these observations in the Results section, we also added the following remark to the Discussion section:</p><p>&quot;For the ribosome case, conventional 3D classification into a discrete number of classes turned out to be difficult and following standard procedures did not yield insights into the structural heterogeneity present. For the spliceosome case, multi-body refinement provided better maps than those obtained by conventional classification into a discrete number of classes. This is explained by the lower number of particle images that contribute to each class in discrete classification, whereas multi-body refinement allows the use of all particle images for each of the bodies. Moreover, in the presence of continuous heterogeneity. each discrete class will still correspond to a mixture of different structures.&quot;</p><disp-quote content-type="editor-comment"><p>Some explanation of the rationale for choice of parameters for subsection “A ribosome test case” and subsection “A spliceosome test case” would be valuable.</p></disp-quote><p>In subsection <italic>“A ribosome test case”</italic> we modified:</p><p>&quot;In a first multi-body refinement, the standard deviation of the Gaussian prior on the rotations was set to 10 degrees for all three bodies, and the standard deviations on the body translations were all set to 2 pixels. These values represent an estimate of the total flexibility present in the different domains. Based on the domain architecture of the ribosome, the LSU and SSU were set to rotate with respect to each other, while the head was rotating with respect to the SSU. Multi-body refinement was started using an initial angular sampling rate of 1.8 degrees and an initial translational sampling rate of 0.25 pixels. The choice for the initial angular sampling rate reflects a compromise between computational cost and a sufficiently fine sampling to describe the estimated flexibility. The initial translational sampling rate is similar to the estimated accuracy of the translations in the consensus refinement.&quot;</p><p>In subsection “A spliceosome test case” we modified:</p><p>&quot;Based on similar considerations as for the ribosome case, the initial angular sampling rate was set to 1.8 degrees, and the initial translational sampling range and rate were set to 3 and 0.75 pixels, respectively. The standard deviations of the angular and the translational prior were set to 10 degrees and 2 pixels for all bodies.&quot;</p></body></sub-article></article>